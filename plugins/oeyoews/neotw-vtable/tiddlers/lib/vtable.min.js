!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).VTable={})}(this,(function(t){"use strict";class e{static GenAutoIncrementId(){return e.auto_increment_id++}}e.auto_increment_id=0;class i{constructor(t){this.id=e.GenAutoIncrementId(),this.registry=t}}const r="named",o="inject",n="multi_inject",s="inversify:tagged",a="inversify:paramtypes";class l{constructor(t,e){this.key=t,this.value=e}toString(){return this.key===r?`named: ${String(this.value).toString()} `:`tagged: { key:${this.key.toString()}, value: ${String(this.value)} }`}}var h=function(t){var e;return function(t){const e=Object.prototype.hasOwnProperty,i="function"==typeof Symbol,r=i&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",o=i&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",n="function"==typeof Object.create,s={__proto__:[]}instanceof Array,a=!n&&!s,l={create:n?function(){return S(Object.create(null))}:s?function(){return S({__proto__:null})}:function(){return S({})},has:a?function(t,i){return e.call(t,i)}:function(t,e){return e in t},get:a?function(t,i){return e.call(t,i)?t[i]:void 0}:function(t,e){return t[e]}},h=Object.getPrototypeOf(Function),c="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,d=c||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){const t={},e=[],i=function(){function t(t,e,i){this._index=0,this._keys=t,this._values=e,this._selector=i}return t.prototype["@@iterator"]=function(){return this},t.prototype[o]=function(){return this},t.prototype.next=function(){const t=this._index;if(t>=0&&t<this._keys.length){const i=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:i,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){const e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){const i=this._find(t,!0);return this._values[i]=e,this},e.prototype.delete=function(e){const i=this._find(e,!1);if(i>=0){const r=this._keys.length;for(let t=i+1;t<r;t++)this._keys[t-1]=this._keys[t],this._values[t-1]=this._values[t];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new i(this._keys,this._values,r)},e.prototype.values=function(){return new i(this._keys,this._values,n)},e.prototype.entries=function(){return new i(this._keys,this._values,s)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[o]=function(){return this.entries()},e.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function r(t,e){return t}function n(t,e){return e}function s(t,e){return[t,e]}}():Map,u=(c||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function t(){this._map=new d}Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[o]=function(){return this.keys()}}():Set,new(c||"function"!=typeof WeakMap?function(){const t=16,i=l.create(),r=o();return function(){function t(){this._key=o()}return t.prototype.has=function(t){const e=n(t,!1);return void 0!==e&&l.has(e,this._key)},t.prototype.get=function(t){const e=n(t,!1);return void 0!==e?l.get(e,this._key):void 0},t.prototype.set=function(t,e){return n(t,!0)[this._key]=e,this},t.prototype.delete=function(t){const e=n(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=o()},t}();function o(){let t;do{t="@@WeakMap@@"+a()}while(l.has(i,t));return i[t]=!0,t}function n(t,i){if(!e.call(t,r)){if(!i)return;Object.defineProperty(t,r,{value:l.create()})}return t[r]}function s(t,e){for(let i=0;i<e;++i)t[i]=255*Math.random()|0;return t}function a(){const e=(i=t,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(i)):s(new Uint8Array(i),i):s(new Array(i),i));var i;e[6]=79&e[6]|64,e[8]=191&e[8]|128;let r="";for(let i=0;i<t;++i){const t=e[i];4!==i&&6!==i&&8!==i||(r+="-"),t<16&&(r+="0"),r+=t.toString(16).toLowerCase()}return r}}():WeakMap));function g(t,e,i){let r=u.get(t);if(b(r)){if(!i)return;r=new d,u.set(t,r)}let o=r.get(e);if(b(o)){if(!i)return;o=new d,r.set(e,o)}return o}function p(t,e,i){if(f(t,e,i))return!0;const r=_(e);return!y(r)&&p(t,r,i)}function f(t,e,i){const r=g(e,i,!1);return!b(r)&&!!r.has(t)}function m(t,e,i){if(f(t,e,i))return function(t,e,i){const r=g(e,i,!1);if(!b(r))return r.get(t)}(t,e,i);const r=_(e);return y(r)?void 0:m(t,r,i)}function b(t){return void 0===t}function y(t){return null===t}function C(t){return"object"==typeof t?null!==t:"function"==typeof t}function w(t,e){switch(function(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}const i=3===e?"string":5===e?"number":"default",o=function(t,e){const i=t[e];if(null!=i){if(!x(i))throw new TypeError;return i}}(t,r);if(void 0!==o){const e=o.call(t,i);if(C(e))throw new TypeError;return e}return function(t,e){if("string"===e){const e=t.toString;if(x(e)){const i=e.call(t);if(!C(i))return i}const i=t.valueOf;if(x(i)){const e=i.call(t);if(!C(e))return e}}else{const e=t.valueOf;if(x(e)){const i=e.call(t);if(!C(i))return i}const i=t.toString;if(x(i)){const e=i.call(t);if(!C(e))return e}}throw new TypeError}(t,"default"===i?"number":i)}function v(t){const e=w(t,3);return"symbol"==typeof e?e:function(t){return""+t}(e)}function x(t){return"function"==typeof t}function _(t){const e=Object.getPrototypeOf(t);if("function"!=typeof t||t===h)return e;if(e!==h)return e;const i=t.prototype,r=i&&Object.getPrototypeOf(i);if(null==r||r===Object.prototype)return e;const o=r.constructor;return"function"!=typeof o||o===t?e:o}function S(t){return t.__=void 0,delete t.__,t}t("defineMetadata",(function(t,e,i,r){if(!C(i))throw new TypeError;return o=t,n=e,void g(i,r,!0).set(o,n);var o,n})),t("hasMetadata",(function(t,e,i){if(!C(e))throw new TypeError;return b(i)||(i=v(i)),p(t,e,i)})),t("hasOwnMetadata",(function(t,e,i){if(!C(e))throw new TypeError;return b(i)||(i=v(i)),f(t,e,i)})),t("getMetadata",(function(t,e,i){if(!C(e))throw new TypeError;return b(i)||(i=v(i)),m(t,e,i)}))}((e=t,function(t,i){"function"!=typeof e[t]&&Object.defineProperty(e,t,{configurable:!0,writable:!0,value:i})})),t}({});function c(t,e,i,r){!function(t,e,i,r){const o=[r];let n={};h.hasOwnMetadata(t,e)&&(n=h.getMetadata(t,e));let s=n[i];void 0===s&&(s=[]),s.push(...o),n[i]=s,h.defineMetadata(t,n,e)}(s,t,i.toString(),r)}function d(t){return(e,i,r)=>{c(e,0,r,t)}}function u(t){return e=>(i,r,o)=>d(new l(t,e))(i,r,o)}const g=u(o),p=u(n);function f(){return function(t){return h.defineMetadata(a,null,t),t}}function m(t){return d(new l(r,t))}const b="Singleton",y="Transient",C="ConstantValue",w="DynamicValue",v="Factory",x="Function",_="Instance",S="Invalid";class A{constructor(t,i){this.id=e.GenAutoIncrementId(),this.activated=!1,this.serviceIdentifier=t,this.scope=i,this.type=S,this.constraint=t=>!0,this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.dynamicValue=null}clone(){const t=new A(this.serviceIdentifier,this.scope);return t.activated=t.scope===b&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.provider=this.provider,t.constraint=this.constraint,t.cache=this.cache,t}}class R{getConstructorMetadata(t){return{compilerGeneratedMetadata:h.getMetadata(a,t),userGeneratedMetadata:h.getMetadata(s,t)||{}}}getPropertiesMetadata(t){throw new Error("暂未实现")}}const B=(M=r,t=>{const e=e=>{if(null==e)return!1;if(e.key===M&&e.value===t)return!0;if(null==e.constructorArgsMetadata)return!1;const i=e.constructorArgsMetadata;for(let e=0;e<i.length;e++)if(i[e].key===M&&i[e].value===t)return!0;return!1};return e.metaData=new l(M,t),e});var M;class T{constructor(t){this._binding=t}inRequestScope(){throw new Error("暂未实现")}inSingletonScope(){return this._binding.scope=b,this}inTransientScope(){return this._binding.scope=y,this}whenTargetNamed(t){return this._binding.constraint=B(t),this}}class P{constructor(t){this._binding=t}to(t){return this._binding.type=_,this._binding.implementationType=t,new T(this._binding)}toSelf(){const t=this._binding.serviceIdentifier;return this.to(t)}toDynamicValue(t){return this._binding.type=w,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new T(this._binding)}toConstantValue(t){return this._binding.type=C,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=b,new T(this._binding)}toFactory(t){return this._binding.type=v,this._binding.factory=t,this._binding.scope=b,new T(this._binding)}toService(t){this.toDynamicValue((e=>e.container.get(t)))}}const H=Symbol("ContributionProvider");class E{constructor(t,e){this.serviceIdentifier=t,this.container=e}getContributions(){return this.caches||(this.caches=[],this.container&&this.container.isBound(this.serviceIdentifier)&&this.caches.push(...this.container.getAll(this.serviceIdentifier))),this.caches}}function k(t,e){t(H).toDynamicValue((t=>{let{container:i}=t;return new E(e,i)})).inSingletonScope().whenTargetNamed(e)}class L{constructor(t,e){this._args=t,this.name=e,this.taps=[]}tap(t,e){this._tap("sync",t,e)}unTap(t,e){const i="string"==typeof t?t.trim():t.name;i&&(this.taps=this.taps.filter((t=>t.name!==i&&(!e||t.fn===e))))}_parseOptions(t,e,i){let r;if("string"==typeof e)r={name:e.trim()};else if("object"!=typeof e||null===e)throw new Error("Invalid tap options");if("string"!=typeof r.name||""===r.name)throw new Error("Missing name for tap");return r=Object.assign({type:t,fn:i},r),r}_tap(t,e,i){this._insert(this._parseOptions(t,e,i))}_insert(t){let e;"string"==typeof t.before?e=new Set([t.before]):Array.isArray(t.before)&&(e=new Set(t.before));let i=0;"number"==typeof t.stage&&(i=t.stage);let r=this.taps.length;for(;r>0;){r--;const t=this.taps[r];this.taps[r+1]=t;const o=t.stage||0;if(e){if(e.has(t.name)){e.delete(t.name);continue}if(e.size>0)continue}if(!(o>i)){r++;break}}this.taps[r]=t}}class F extends L{call(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.taps.map((t=>t.fn)).forEach((t=>t(...e)))}}const I=Symbol.for("EnvContribution"),z=Symbol.for("VGlobal");var O=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},D=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},W=function(t,e){return function(i,r){e(i,r,t)}};let N=class{get env(){return this._env}get devicePixelRatio(){return this._env||this.setEnv("browser"),this.envContribution.getDevicePixelRatio()}get supportEvent(){return this._env||this.setEnv("browser"),this.envContribution.supportEvent}set supportEvent(t){this._env||this.setEnv("browser"),this.envContribution.supportEvent=t}get supportsTouchEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsTouchEvents}set supportsTouchEvents(t){this._env||this.setEnv("browser"),this.envContribution.supportsTouchEvents=t}get supportsPointerEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsPointerEvents}set supportsPointerEvents(t){this._env||this.setEnv("browser"),this.envContribution.supportsPointerEvents=t}get supportsMouseEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsMouseEvents}set supportsMouseEvents(t){this._env||this.setEnv("browser"),this.envContribution.supportsMouseEvents=t}get applyStyles(){return this._env||this.setEnv("browser"),this.envContribution.applyStyles}set applyStyles(t){this._env||this.setEnv("browser"),this.envContribution.applyStyles=t}constructor(t){this.contributions=t,this.id=e.GenAutoIncrementId(),this.hooks={onSetEnv:new F(["lastEnv","env","global"])},this.measureTextMethod="native",this.optimizeVisible=!1}bindContribution(t){const e=[];if(this.contributions.getContributions().forEach((i=>{const r=i.configure(this,t);r&&r.then&&e.push(r)})),e.length)return Promise.all(e)}getDynamicCanvasCount(){return this._env||this.setEnv("browser"),this.envContribution.getDynamicCanvasCount()}getStaticCanvasCount(){return this._env||this.setEnv("browser"),this.envContribution.getStaticCanvasCount()}setEnv(t,e){if(e&&!0===e.force||this._env!==t)return this.deactiveCurrentEnv(),this.activeEnv(t,e)}deactiveCurrentEnv(){this.envContribution&&this.envContribution.release()}activeEnv(t,e){const i=this._env;this._env=t;const r=this.bindContribution(e);if(r&&r.then)return r.then((()=>{this.envParams=e,this.hooks.onSetEnv.call(i,t,this)}));this.envParams=e,this.hooks.onSetEnv.call(i,t,this)}setActiveEnvContribution(t){this.envContribution=t}createCanvas(t){return this._env||this.setEnv("browser"),this.envContribution.createCanvas(t)}createOffscreenCanvas(t){return this._env||this.setEnv("browser"),this.envContribution.createOffscreenCanvas(t)}releaseCanvas(t){return this._env||this.setEnv("browser"),this.envContribution.releaseCanvas(t)}addEventListener(t,e,i){return this._env||this.setEnv("browser"),this.envContribution.addEventListener(t,e,i)}removeEventListener(t,e,i){return this._env||this.setEnv("browser"),this.envContribution.removeEventListener(t,e,i)}dispatchEvent(t){return this._env||this.setEnv("browser"),this.envContribution.dispatchEvent(t)}getRequestAnimationFrame(){return this._env||this.setEnv("browser"),this.envContribution.getRequestAnimationFrame()}getCancelAnimationFrame(){return this._env||this.setEnv("browser"),this.envContribution.getCancelAnimationFrame()}getElementById(t){return this._env||this.setEnv("browser"),this.envContribution.getElementById?this.envContribution.getElementById(t):null}getRootElement(){return this._env||this.setEnv("browser"),this.envContribution.getRootElement?this.envContribution.getRootElement():null}getDocument(){return this._env||this.setEnv("browser"),this.envContribution.getDocument?this.envContribution.getDocument():null}mapToCanvasPoint(t,e){return this._env||this.setEnv("browser"),this.envContribution.mapToCanvasPoint?this.envContribution.mapToCanvasPoint(t,e):null}loadImage(t){return this._env||this.setEnv("browser"),this.envContribution.loadImage(t)}loadSvg(t){return this._env||this.setEnv("browser"),this.envContribution.loadSvg(t)}loadJson(t){return this._env||this.setEnv("browser"),this.envContribution.loadJson(t)}loadArrayBuffer(t){return this._env||this.setEnv("browser"),this.envContribution.loadArrayBuffer(t)}loadBlob(t){return this._env||this.setEnv("browser"),this.envContribution.loadBlob(t)}isChrome(){return null!=this._isChrome||(this._env||this.setEnv("browser"),this._isChrome="browser"===this._env&&navigator.userAgent.indexOf("Chrome")>-1),this._isChrome}isSafari(){return null!=this._isSafari||(this._env||this.setEnv("browser"),this._isSafari="browser"===this._env&&/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)),this._isSafari}getNativeAABBBounds(t){return this._env||this.setEnv("browser"),this.envContribution.getNativeAABBBounds(t)}removeDom(t){return this._env||this.setEnv("browser"),this.envContribution.removeDom(t)}createDom(t){return this._env||this.setEnv("browser"),this.envContribution.createDom(t)}getElementTop(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._env||this.setEnv("browser"),this.envContribution.getElementTop(t,e)}getElementLeft(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._env||this.setEnv("browser"),this.envContribution.getElementLeft(t,e)}getElementTopLeft(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._env||this.setEnv("browser"),this.envContribution.getElementTopLeft(t,e)}};function G(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}N=O([f(),W(0,g(H)),W(0,m(I)),D("design:paramtypes",[Object])],N);var j={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,i="~";function r(){}function o(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function n(t,e,r,n,s){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new o(r,n||t,s),l=i?i+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],a]:t._events[l].push(a):(t._events[l]=a,t._eventsCount++),t}function s(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(i=!1)),a.prototype.eventNames=function(){var t,r,o=[];if(0===this._eventsCount)return o;for(r in t=this._events)e.call(t,r)&&o.push(i?r.slice(1):r);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},a.prototype.listeners=function(t){var e=i?i+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var o=0,n=r.length,s=new Array(n);o<n;o++)s[o]=r[o].fn;return s},a.prototype.listenerCount=function(t){var e=i?i+t:t,r=this._events[e];return r?r.fn?1:r.length:0},a.prototype.emit=function(t,e,r,o,n,s){var a=i?i+t:t;if(!this._events[a])return!1;var l,h,c=this._events[a],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,r),!0;case 4:return c.fn.call(c.context,e,r,o),!0;case 5:return c.fn.call(c.context,e,r,o,n),!0;case 6:return c.fn.call(c.context,e,r,o,n,s),!0}for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];c.fn.apply(c.context,l)}else{var u,g=c.length;for(h=0;h<g;h++)switch(c[h].once&&this.removeListener(t,c[h].fn,void 0,!0),d){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,e);break;case 3:c[h].fn.call(c[h].context,e,r);break;case 4:c[h].fn.call(c[h].context,e,r,o);break;default:if(!l)for(u=1,l=new Array(d-1);u<d;u++)l[u-1]=arguments[u];c[h].fn.apply(c[h].context,l)}}return!0},a.prototype.on=function(t,e,i){return n(this,t,e,i,!1)},a.prototype.once=function(t,e,i){return n(this,t,e,i,!0)},a.prototype.removeListener=function(t,e,r,o){var n=i?i+t:t;if(!this._events[n])return this;if(!e)return s(this,n),this;var a=this._events[n];if(a.fn)a.fn!==e||o&&!a.once||r&&a.context!==r||s(this,n);else{for(var l=0,h=[],c=a.length;l<c;l++)(a[l].fn!==e||o&&!a[l].once||r&&a[l].context!==r)&&h.push(a[l]);h.length?this._events[n]=1===h.length?h[0]:h:s(this,n)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&s(this,e)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,t.exports=a}(j);var V=G(j.exports);var U=(t,e)=>Object.prototype.toString.call(t)===`[object ${e}]`;var K=function(t){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"boolean"==typeof t:!0===t||!1===t||U(t,"Boolean")};var $=t=>"function"==typeof t;var X=t=>null==t;var Y=t=>null!=t;var q=t=>{const e=typeof t;return null!==t&&"object"===e||"function"===e};var Z=t=>"object"==typeof t&&null!==t;var J=function(t){if(!Z(t)||!U(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;let e=t;for(;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e};var Q=t=>void 0===t;var tt=function(t){const e=typeof t;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"string"===e:"string"===e||U(t,"String")};var et=t=>Array.isArray?Array.isArray(t):U(t,"Array");var it=function(t){return null!==t&&"function"!=typeof t&&Number.isFinite(t.length)};var rt=t=>U(t,"Date");var ot=function(t){const e=typeof t;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"number"===e:"number"===e||U(t,"Number")};var nt=t=>ot(t)&&Number.isFinite(t);var st=t=>new RegExp(/^(http(s)?:\/\/)\w+[^\s]+(\.[^\s]+){1,}$/).test(t);var at=t=>new RegExp(/^data:image\/(?:gif|png|jpeg|bmp|webp|svg\+xml)(?:;charset=utf-8)?;base64,(?:[A-Za-z0-9]|[+/])+={0,2}/g).test(t);var lt=t=>({}.toString.call(t).replace(/^\[object /,"").replace(/]$/,""));const ht=Object.prototype;var ct=function(t){const e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||ht)};const dt=Object.prototype.hasOwnProperty;function ut(t){if(X(t))return!0;if(it(t))return!t.length;const e=lt(t);if("Map"===e||"Set"===e)return!t.size;if(ct(t))return!Object.keys(t).length;for(const e in t)if(dt.call(t,e))return!1;return!0}var gt=(t,e,i)=>{const r=tt(e)?e.split("."):e;for(let e=0;e<r.length;e++)t=t?t[r[e]]:void 0;return void 0===t?i:t};const pt=Object.prototype.hasOwnProperty;var ft=(t,e)=>null!=t&&pt.call(t,e);function mt(t){let e;if(!Y(t)||"object"!=typeof t)return t;const i=et(t),r=t.length;e=i?new Array(r):"object"==typeof t?{}:K(t)||ot(t)||tt(t)?t:rt(t)?new Date(+t):void 0;const o=i?void 0:Object.keys(Object(t));let n=-1;if(e)for(;++n<(o||t).length;){const i=o?o[n]:n,r=t[i];e[i]=mt(r)}return e}function bt(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e){if(t===e)return;if(Y(e)&&"object"==typeof e){const r=Object(e),o=[];for(const t in r)o.push(t);let{length:n}=o,s=-1;for(;n--;){const n=o[++s];Y(r[n])&&"object"==typeof r[n]?yt(t,e,n,i):Ct(t,n,r[n])}}}}function yt(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=t[i],n=e[i];let s=e[i],a=!0;if(et(n)){if(r)s=[];else if(et(o))s=o;else if(it(o)){s=new Array(o.length);let t=-1;const e=o.length;for(;++t<e;)s[t]=o[t]}}else J(n)?(s=o,"function"!=typeof o&&"object"==typeof o||(s={})):a=!1;a&&bt(s,n,r),Ct(t,i,s)}function Ct(t,e,i){(void 0!==i&&!function(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}(t[e],i)||void 0===i&&!(e in t))&&(t[e]=i)}function wt(t){let e=-1;const i=arguments.length<=1?0:arguments.length-1;for(;++e<i;)bt(t,e+1<1||arguments.length<=e+1?void 0:arguments[e+1],!0);return t}function vt(t){return Object.prototype.toString.call(t)}function xt(t){return Object.keys(t)}function _t(t,e,i){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(null==t||null==e)return!1;if(Number.isNaN(t)&&Number.isNaN(e))return!0;if(vt(t)!==vt(e))return!1;if($(t))return!!(null==i?void 0:i.skipFunction);if("object"!=typeof t)return!1;if(et(t)){if(t.length!==e.length)return!1;for(let r=t.length-1;r>=0;r--)if(!_t(t[r],e[r],i))return!1;return!0}if(!J(t))return!1;const r=xt(t),o=xt(e);if(r.length!==o.length)return!1;r.sort(),o.sort();for(let t=r.length-1;t>=0;t--)if(r[t]!=o[t])return!1;for(let o=r.length-1;o>=0;o--){const n=r[o];if(!_t(t[n],e[n],i))return!1}return!0}function St(t,e,i){const r=function(t){if(!t)return[];if(Object.keys)return Object.keys(t);const e=[];for(const i in t)t.hasOwnProperty(i)&&e.push(i);return e}(e);for(let o=0;o<r.length;o++){const n=r[o];(i?null!=e[n]:null==t[n])&&(t[n]=e[n])}return t}function At(t){return Y(t)?et(t)?t:[t]:[]}function Rt(t){if(it(t))return t[t.length-1]}const Bt=(t,e)=>{var i;if(0===t.length)return;let r=t[0];for(let o=1;o<t.length;o++){const n=t[o];(null!==(i=null==e?void 0:e(n,r))&&void 0!==i?i:n-r>0)&&(r=n)}return r},Mt=(t,e)=>{var i;if(0===t.length)return;let r=t[0];for(let o=1;o<t.length;o++){const n=t[o];(null!==(i=null==e?void 0:e(n,r))&&void 0!==i?i:n-r<0)&&(r=n)}return r};function Tt(t,e){if(!et(t)||!et(e))return!1;if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function Pt(t){if(!et(t))return[t];const e=[];for(const i of t)e.push(...Pt(i));return e}function Ht(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Et(t){return Number(t)}const kt=1e-10,Lt=1e-10;function Ft(t,e){const i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:kt,r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:Lt)*Math.max(t,e);return Math.abs(t-e)<=Math.max(i,r)}function It(t,e,i,r){return t>e&&!Ft(t,e,i,r)}function zt(t,e,i,r){return t<e&&!Ft(t,e,i,r)}const Ot=t=>{let e=null,i=null;return function(){for(var r=arguments.length,o=new Array(r),n=0;n<r;n++)o[n]=arguments[n];return e&&o.every(((t,i)=>t===e[i]))||(e=o,i=t(...o)),i}};var Dt=function(t,e,i){return t<e?e:t>i?i:t};var Wt=(t,e,i)=>{let[r,o]=t;o<r&&(r=t[1],o=t[0]);const n=o-r;return n>=i-e?[e,i]:(r=Math.min(Math.max(r,e),i-n),[r,r+n])};function Nt(t,e){let i;return t>e&&(i=t,t=e,e=i),i=>Math.max(t,Math.min(e,i))}let Gt=!1;try{Gt="function"==typeof requestAnimationFrame&&"function"==typeof cancelAnimationFrame}catch(t){Gt=!1}function jt(t,e,i){let r,o,n,s,a,l,h=0,c=!1,d=!1,u=!0;const g=!e&&0!==e&&Gt;if("function"!=typeof t)throw new TypeError("Expected a function");function p(e){const i=r,n=o;return r=o=void 0,h=e,s=t.apply(n,i),s}function f(t,e){return g?(cancelAnimationFrame(a),requestAnimationFrame(t)):setTimeout(t,e)}function m(t){const i=t-l;return void 0===l||i>=e||i<0||d&&t-h>=n}function b(){const t=Date.now();if(m(t))return y(t);a=f(b,function(t){const i=t-h,r=e-(t-l);return d?Math.min(r,n-i):r}(t))}function y(t){return a=void 0,u&&r?p(t):(r=o=void 0,s)}function C(){const t=Date.now(),i=m(t);for(var n=arguments.length,u=new Array(n),g=0;g<n;g++)u[g]=arguments[g];if(r=u,o=this,l=t,i){if(void 0===a)return function(t){return h=t,a=f(b,e),c?p(t):s}(l);if(d)return a=f(b,e),p(l)}return void 0===a&&(a=f(b,e)),s}return e=+e||0,q(i)&&(c=!!i.leading,d="maxWait"in i,d&&(n=Math.max(nt(i.maxWait)?i.maxWait:0,e)),u="trailing"in i?!!i.trailing:u),C.cancel=function(){void 0!==a&&function(t){if(g)return cancelAnimationFrame(t);clearTimeout(t)}(a),h=0,r=l=o=a=void 0},C.flush=function(){return void 0===a?s:y(Date.now())},C.pending=function(){return void 0!==a},C}function Vt(t,e){return i=>t*(1-i)+e*i}function Ut(t,e){return function(i){return Math.round(t*(1-i)+e*i)}}Gt=!1;const Kt=1e-12,$t=Math.PI,Xt=$t/2,Yt=2*$t,qt=2*Math.PI,Zt=Math.abs,Jt=Math.atan2,Qt=Math.cos,te=Math.max,ee=Math.min,ie=Math.sin,re=Math.sqrt,oe=Math.pow;function ne(t){return t>1?0:t<-1?$t:Math.acos(t)}function se(t){return t>=1?Xt:t<=-1?-Xt:Math.asin(t)}function ae(t,e,i,r,o){let n,s;return"number"==typeof t&&"number"==typeof i&&(n=(1-o)*t+o*i),"number"==typeof e&&"number"==typeof r&&(s=(1-o)*e+o*r),{x:n,y:s}}class le{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this.x=0,this.y=0,this.x=t,this.y=e,this.x1=i,this.y1=r}clone(){return new le(this.x,this.y)}copyFrom(t){return this.x=t.x,this.y=t.y,this.x1=t.x1,this.y1=t.y1,this.defined=t.defined,this.context=t.context,this}set(t,e){return this.x=t,this.y=e,this}add(t){return ot(t)?(this.x+=t,void(this.y+=t)):(this.x+=t.x,this.y+=t.y,this)}sub(t){return ot(t)?(this.x-=t,void(this.y-=t)):(this.x-=t.x,this.y-=t.y,this)}multi(t){throw new Error("暂不支持")}div(t){throw new Error("暂不支持")}}class he{static distancePP(t,e){return re(oe(t.x-e.x,2)+oe(t.y-e.y,2))}static distanceNN(t,e,i,r){return re(oe(t-i,2)+oe(e-r,2))}static distancePN(t,e,i){return re(oe(e-t.x,2)+oe(i-t.y,2))}static pointAtPP(t,e,i){return new le((e.x-t.x)*i+t.x,(e.y-t.y)*i+t.y)}}function ce(t,e,i){const{x1:r,y1:o,x2:n,y2:s}=e;return i.onlyTranslate()?(t!==e&&t.setValue(e.x1,e.y1,e.x2,e.y2),t.translate(i.e,i.f),e):(t.clear(),t.add(i.a*r+i.c*o+i.e,i.b*r+i.d*o+i.f),t.add(i.a*n+i.c*o+i.e,i.b*n+i.d*o+i.f),t.add(i.a*n+i.c*s+i.e,i.b*n+i.d*s+i.f),t.add(i.a*r+i.c*s+i.e,i.b*r+i.d*s+i.f),e)}class de{constructor(t){t?this.setValue(t.x1,t.y1,t.x2,t.y2):this.clear()}clone(){return new de(this)}clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this}empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE}equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2}setValue(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.x1=t,this.y1=e,this.x2=i,this.y2=r,this}set(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return i<t?(this.x2=t,this.x1=i):(this.x1=t,this.x2=i),r<e?(this.y2=e,this.y1=r):(this.y1=e,this.y2=r),this}add(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this}expand(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return et(t)?(this.y1-=t[0],this.x2+=t[1],this.y2+=t[2],this.x1-=t[3]):(this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t),this}round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this}translate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this}rotate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=this.rotatedPoints(t,e,i);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])}scale(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const o=this.scalePoints(t,e,i,r);return this.clear().add(o[0],o[1]).add(o[2],o[3])}union(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this}intersect(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this}encloses(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2}alignsWith(t){return t&&(this.x1===t.x1||this.x2===t.x2||this.y1===t.y1||this.y2===t.y2)}intersects(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)}contains(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)}containsPoint(t){return!(t.x<this.x1||t.x>this.x2||t.y<this.y1||t.y>this.y2)}width(){return this.empty()?0:this.x2-this.x1}height(){return this.empty()?0:this.y2-this.y1}scaleX(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.x1*=t,this.x2*=t,this}scaleY(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.y1*=t,this.y2*=t,this}transformWithMatrix(t){return ce(this,this,t),this}copy(t){return this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2,this}rotatedPoints(t,e,i){const{x1:r,y1:o,x2:n,y2:s}=this,a=Math.cos(t),l=Math.sin(t),h=e-e*a+i*l,c=i-e*l-i*a;return[a*r-l*o+h,l*r+a*o+c,a*r-l*s+h,l*r+a*s+c,a*n-l*o+h,l*n+a*o+c,a*n-l*s+h,l*n+a*s+c]}scalePoints(t,e,i,r){const{x1:o,y1:n,x2:s,y2:a}=this;return[t*o+(1-t)*i,e*n+(1-e)*r,t*s+(1-t)*i,e*a+(1-e)*r]}}class ue extends de{}function ge(t){return t*(Math.PI/180)}const pe=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(t<0)for(;t<-Yt;)t+=Yt;else if(t>0)for(;t>Yt;)t-=Yt;return t};class fe{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.a=t,this.b=e,this.c=i,this.d=r,this.e=o,this.f=n}equalToMatrix(t){return!(this.e!==t.e||this.f!==t.f||this.a!==t.a||this.d!==t.d||this.b!==t.b||this.c!==t.c)}equalTo(t,e,i,r,o,n){return!(this.e!==o||this.f!==n||this.a!==t||this.d!==r||this.b!==e||this.c!==i)}setValue(t,e,i,r,o,n){return this.a=t,this.b=e,this.c=i,this.d=r,this.e=o,this.f=n,this}reset(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}getInverse(){const t=this.a,e=this.b,i=this.c,r=this.d,o=this.e,n=this.f,s=new fe,a=t*r-e*i;return s.a=r/a,s.b=-e/a,s.c=-i/a,s.d=t/a,s.e=(i*n-r*o)/a,s.f=-(t*n-e*o)/a,s}rotate(t){const e=Math.cos(t),i=Math.sin(t),r=this.a*e+this.c*i,o=this.b*e+this.d*i,n=this.a*-i+this.c*e,s=this.b*-i+this.d*e;return this.a=r,this.b=o,this.c=n,this.d=s,this}rotateByCenter(t,e,i){const r=Math.cos(t),o=Math.sin(t),n=(1-r)*e+o*i,s=(1-r)*i-o*e,a=r*this.a-o*this.b,l=o*this.a+r*this.b,h=r*this.c-o*this.d,c=o*this.c+r*this.d,d=r*this.e-o*this.f+n,u=o*this.e+r*this.f+s;return this.a=a,this.b=l,this.c=h,this.d=c,this.e=d,this.f=u,this}scale(t,e){return this.a*=t,this.b*=t,this.c*=e,this.d*=e,this}setScale(t,e){return this.b=this.b/this.a*t,this.c=this.c/this.d*e,this.a=t,this.d=e,this}transform(t,e,i,r,o,n){return this.multiply(t,e,i,r,o,n),this}translate(t,e){return this.e+=this.a*t+this.c*e,this.f+=this.b*t+this.d*e,this}transpose(){const{a:t,b:e,c:i,d:r,e:o,f:n}=this;return this.a=e,this.b=t,this.c=r,this.d=i,this.e=n,this.f=o,this}multiply(t,e,i,r,o,n){const s=this.a,a=this.b,l=this.c,h=this.d,c=s*t+l*e,d=a*t+h*e,u=s*i+l*r,g=a*i+h*r,p=s*o+l*n+this.e,f=a*o+h*n+this.f;return this.a=c,this.b=d,this.c=u,this.d=g,this.e=p,this.f=f,this}interpolate(t,e){const i=new fe;return i.a=this.a+(t.a-this.a)*e,i.b=this.b+(t.b-this.b)*e,i.c=this.c+(t.c-this.c)*e,i.d=this.d+(t.d-this.d)*e,i.e=this.e+(t.e-this.e)*e,i.f=this.f+(t.f-this.f)*e,i}transformPoint(t,e){const{a:i,b:r,c:o,d:n,e:s,f:a}=this,l=i*n-r*o,h=n/l,c=-r/l,d=-o/l,u=i/l,g=(o*a-n*s)/l,p=-(i*a-r*s)/l,{x:f,y:m}=t;e.x=f*h+m*d+g,e.y=f*c+m*u+p}onlyTranslate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.a===t&&0===this.b&&0===this.c&&this.d===t}clone(){return new fe(this.a,this.b,this.c,this.d,this.e,this.f)}toTransformAttrs(){const t=this.a,e=this.b,i=this.c,r=this.d,o=t*r-e*i,n={x:this.e,y:this.f,rotateDeg:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(0!==t||0!==e){const s=Math.sqrt(t*t+e*e);n.rotateDeg=e>0?Math.acos(t/s):-Math.acos(t/s),n.scaleX=s,n.scaleY=o/s,n.skewX=(t*i+e*r)/o,n.skewY=0}else if(0!==i||0!==r){const s=Math.sqrt(i*i+r*r);n.rotateDeg=Math.PI/2-(r>0?Math.acos(-i/s):-Math.acos(i/s)),n.scaleX=o/s,n.scaleY=s,n.skewX=0,n.skewY=(t*i+e*r)/o}return n.rotateDeg=180*n.rotateDeg/Math.PI,n}}class me{constructor(){this.CLEAN_THRESHOLD=1e3,this.L_TIME=1e3,this.R_COUNT=1,this.R_TIMESTAMP_MAX_SIZE=20}clearCache(t,e){const{CLEAN_THRESHOLD:i=this.CLEAN_THRESHOLD,L_TIME:r=this.L_TIME,R_COUNT:o=this.R_COUNT}=e;if(t.size<i)return 0;let n=0;const s=e=>{n++,t.delete(e)},a=Date.now();return t.forEach(((t,e)=>{if(t.timestamp.length<o)return s(e);let i=0;for(;a-t.timestamp[t.timestamp.length-1-i]<r&&(i++,!(i>=o)););if(i<o)return s(e);for(;a-t.timestamp[0]>r;)t.timestamp.shift()})),n}addLimitedTimestamp(t,e,i){const{R_TIMESTAMP_MAX_SIZE:r=this.R_TIMESTAMP_MAX_SIZE}=i;t.timestamp.length>r&&t.timestamp.shift(),t.timestamp.push(e)}clearTimeStamp(t,e){const{L_TIME:i=this.L_TIME}=e,r=Date.now();t.forEach((t=>{for(;r-t.timestamp[0]>i;)t.timestamp.shift()}))}clearItemTimestamp(t,e){const{L_TIME:i=this.L_TIME}=e,r=Date.now();for(;r-t.timestamp[0]>i;)t.timestamp.shift()}}function be(t,e,i){e/=100,i/=100;const r=(1-Math.abs(2*i-1))*e,o=r*(1-Math.abs(t/60%2-1)),n=i-r/2;let s=0,a=0,l=0;return 0<=t&&t<60?(s=r,a=o,l=0):60<=t&&t<120?(s=o,a=r,l=0):120<=t&&t<180?(s=0,a=r,l=o):180<=t&&t<240?(s=0,a=o,l=r):240<=t&&t<300?(s=o,a=0,l=r):300<=t&&t<360&&(s=r,a=0,l=o),s=Math.round(255*(s+n)),a=Math.round(255*(a+n)),l=Math.round(255*(l+n)),{r:s,g:a,b:l}}function ye(t,e,i){t/=255,e/=255,i/=255;const r=Math.min(t,e,i),o=Math.max(t,e,i),n=o-r;let s=0,a=0,l=0;return s=0===n?0:o===t?(e-i)/n%6:o===e?(i-t)/n+2:(t-e)/n+4,s=Math.round(60*s),s<0&&(s+=360),l=(o+r)/2,a=0===n?0:n/(1-Math.abs(2*l-1)),a=+(100*a).toFixed(1),l=+(100*l).toFixed(1),{h:s,s:a,l:l}}const Ce=/^#([0-9a-f]{3,8})$/,we={transparent:4294967040},ve={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function xe(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function _e(t){return ot(t)?new Be(t>>16,t>>8&255,255&t,1):et(t)?new Be(t[0],t[1],t[2]):new Be(255,255,255)}function Se(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Ae(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}let Re=class t{static Brighter(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return 1===i?e:new t(e).brighter(i).toRGBA()}static SetOpacity(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return 1===i?e:new t(e).setOpacity(i).toRGBA()}static getColorBrightness(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"hsl";const r=e instanceof t?e:new t(e);switch(i){case"hsv":default:return r.getHSVBrightness();case"hsl":return r.getHSLBrightness();case"lum":return r.getLuminance();case"lum2":return r.getLuminance2();case"lum3":return r.getLuminance3()}}static parseColorString(t){if(Y(we[t]))return function(t){return ot(t)?new Be(t>>>24,t>>>16&255,t>>>8&255,255&t):et(t)?new Be(t[0],t[1],t[2],t[3]):new Be(255,255,255,1)}(we[t]);if(Y(ve[t]))return _e(ve[t]);const e=`${t}`.trim().toLowerCase(),i=Ce.exec(e);if(i){const t=parseInt(i[1],16),e=i[1].length;return 3===e?new Be((t>>8&15)+((t>>8&15)<<4),(t>>4&15)+((t>>4&15)<<4),(15&t)+((15&t)<<4),1):6===e?_e(t):8===e?new Be(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):void 0}if(/^(rgb|RGB|rgba|RGBA)/.test(e)){const t=e.replace(/(?:\(|\)|rgba|RGBA|rgb|RGB)*/g,"").split(",");return new Be(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10),parseFloat(t[3]))}if(/^(hsl|HSL|hsla|HSLA)/.test(e)){const t=e.replace(/(?:\(|\)|hsla|HSLA|hsl|HSL)*/g,"").split(","),i=be(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10));return new Be(i.r,i.g,i.b,parseFloat(t[3]))}}constructor(e){const i=t.parseColorString(e);this.color=i||new Be(255,255,255)}toRGBA(){return this.color.formatRgb()}toString(){return this.color.formatRgb()}toHex(){return this.color.formatHex()}toHsl(){return this.color.formatHsl()}brighter(t){const{r:e,g:i,b:r}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t))),this.color.b=Math.max(0,Math.min(255,Math.floor(r*t))),this}add(t){const{r:e,g:i,b:r}=this.color;return this.color.r+=Math.min(255,e+t.color.r),this.color.g+=Math.min(255,i+t.color.g),this.color.b+=Math.min(255,r+t.color.b),this}sub(t){return this.color.r=Math.max(0,this.color.r-t.color.r),this.color.g=Math.max(0,this.color.g-t.color.g),this.color.b=Math.max(0,this.color.b-t.color.b),this}multiply(t){const{r:e,g:i,b:r}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t.color.r))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t.color.g))),this.color.b=Math.max(0,Math.min(255,Math.floor(r*t.color.b))),this}getHSVBrightness(){return Math.max(this.color.r,this.color.g,this.color.b)/255}getHSLBrightness(){return.5*(Math.max(this.color.r,this.color.g,this.color.b)/255+Math.min(this.color.r,this.color.g,this.color.b)/255)}setHsl(t,e,i){const r=this.color.opacity,o=ye(this.color.r,this.color.g,this.color.b),n=be(X(t)?o.h:Dt(t,0,360),X(e)?o.s:e>=0&&e<=1?100*e:e,X(i)?o.l:i<=1&&i>=0?100*i:i);return this.color=new Be(n.r,n.g,n.b,r),this}setRGB(t,e,i){return!X(t)&&(this.color.r=t),!X(e)&&(this.color.g=e),!X(i)&&(this.color.b=i),this}setHex(t){const e=`${t}`.trim().toLowerCase(),i=Ce.exec(e),r=parseInt(i[1],16),o=i[1].length;return 3===o?new Be((r>>8&15)+((r>>8&15)<<4),(r>>4&15)+((r>>4&15)<<4),(15&r)+((15&r)<<4),1):6===o?_e(r):8===o?new Be(r>>24&255,r>>16&255,r>>8&255,(255&r)/255):this}setColorName(t){const e=ve[t.toLowerCase()];return void 0!==e&&this.setHex(e),this}setScalar(t){return this.color.r=t,this.color.g=t,this.color.b=t,this}setOpacity(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.color.opacity=t,this}getLuminance(){return(.2126*this.color.r+.7152*this.color.g+.0722*this.color.b)/255}getLuminance2(){return(.2627*this.color.r+.678*this.color.g+.0593*this.color.b)/255}getLuminance3(){return(.299*this.color.r+.587*this.color.g+.114*this.color.b)/255}clone(){return new t(this.color.toString())}copyGammaToLinear(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return this.color.r=Math.pow(t.color.r,e),this.color.g=Math.pow(t.color.g,e),this.color.b=Math.pow(t.color.b,e),this}copyLinearToGamma(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const i=e>0?1/e:1;return this.color.r=Math.pow(t.color.r,i),this.color.g=Math.pow(t.color.g,i),this.color.b=Math.pow(t.color.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.color.r=Se(t.color.r),this.color.g=Se(t.color.g),this.color.b=Se(t.color.b),this}copyLinearToSRGB(t){return this.color.r=Ae(t.color.r),this.color.g=Ae(t.color.g),this.color.b=Ae(t.color.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}},Be=class{constructor(t,e,i,r){this.r=isNaN(+t)?255:Math.max(0,Math.min(255,+t)),this.g=isNaN(+e)?255:Math.max(0,Math.min(255,+e)),this.b=isNaN(+i)?255:Math.max(0,Math.min(255,+i)),Y(r)?this.opacity=isNaN(+r)?1:Math.max(0,Math.min(1,+r)):this.opacity=1}formatHex(){return`#${xe(this.r)+xe(this.g)+xe(this.b)+(1===this.opacity?"":xe(255*this.opacity))}`}formatRgb(){const t=this.opacity;return`${1===t?"rgb(":"rgba("}${this.r},${this.g},${this.b}${1===t?")":`,${t})`}`}formatHsl(){const t=this.opacity,{h:e,s:i,l:r}=ye(this.r,this.g,this.b);return`${1===t?"hsl(":"hsla("}${e},${i}%,${r}%${1===t?")":`,${t})`}`}toString(){return this.formatHex()}};var Me=Object.freeze({__proto__:null,Color:Re,DEFAULT_COLORS:ve,RGB:Be,hexToRgb:function(t){let e="",i="",r="";const o="#"===t[0]?1:0;for(let n=o;n<t.length;n++)"#"!==t[n]&&(n<o+2?e+=t[n]:n<o+4?i+=t[n]:n<o+6&&(r+=t[n]));return[parseInt(e,16),parseInt(i,16),parseInt(r,16)]},hslToRgb:be,interpolateRgb:function(t,e){const i=t.r,r=e.r,o=t.g,n=e.g,s=t.b,a=e.b,l=t.opacity,h=e.opacity;return t=>{const e=Math.round(i*(1-t)+r*t),c=Math.round(o*(1-t)+n*t),d=Math.round(s*(1-t)+a*t);return new Be(e,c,d,l*(1-t)+h*t)}},rgbToHex:function(t,e,i){return Number((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)},rgbToHsl:ye});let Te,Pe,He,Ee,ke,Le,Fe,Ie;function ze(t,e,i){return null===t?e:null===e?t:(Te=t.x1,Pe=t.x2,He=t.y1,Ee=t.y2,ke=e.x1,Le=e.x2,Fe=e.y1,Ie=e.y2,i&&(Te>Pe&&([Te,Pe]=[Pe,Te]),He>Ee&&([He,Ee]=[Ee,He]),ke>Le&&([ke,Le]=[Le,ke]),Fe>Ie&&([Fe,Ie]=[Ie,Fe])),Te>=Le||Pe<=ke||He>=Ie||Ee<=Fe?{x1:0,y1:0,x2:0,y2:0}:{x1:Math.max(Te,ke),y1:Math.max(He,Fe),x2:Math.min(Pe,Le),y2:Math.min(Ee,Ie)})}var Oe;function De(t,e,i){return!(t&&e&&(i?(Te=t.x1,Pe=t.x2,He=t.y1,Ee=t.y2,ke=e.x1,Le=e.x2,Fe=e.y1,Ie=e.y2,Te>Pe&&([Te,Pe]=[Pe,Te]),He>Ee&&([He,Ee]=[Ee,He]),ke>Le&&([ke,Le]=[Le,ke]),Fe>Ie&&([Fe,Ie]=[Ie,Fe]),Te>Le||Pe<ke||He>Ie||Ee<Fe):t.x1>e.x2||t.x2<e.x1||t.y1>e.y2||t.y2<e.y1))}function We(t,e){return Math.abs(e[0]*t[0]+e[1]*t[1])}function Ne(t,e){let{x:i,y:r}=t,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0};return{x:(i-o.x)*Math.cos(e)+(r-o.y)*Math.sin(e)+o.x,y:(i-o.x)*Math.sin(e)+(o.y-r)*Math.cos(e)+o.y}}function Ge(t){return t/180*Math.PI}function je(t){return{x:(t.x1+t.x2)/2,y:(t.y1+t.y2)/2}}function Ve(t,e){const i=e?t.angle:Ge(t.angle),r=je(t);return[Ne({x:t.x1,y:t.y1},i,r),Ne({x:t.x2,y:t.y1},i,r),Ne({x:t.x2,y:t.y2},i,r),Ne({x:t.x1,y:t.y2},i,r)]}!function(t){t[t.NONE=0]="NONE",t[t.BBOX1=1]="BBOX1",t[t.BBOX2=2]="BBOX2"}(Oe||(Oe={}));const Ue=t=>{let e=t.charCodeAt(0),i=2===t.length?t.charCodeAt(1):0,r=e;return 55296<=e&&e<=56319&&56320<=i&&i<=57343&&(e&=1023,i&=1023,r=e<<10|i,r+=65536),12288===r||65281<=r&&r<=65376||65504<=r&&r<=65510?"F":8361===r||65377<=r&&r<=65470||65474<=r&&r<=65479||65482<=r&&r<=65487||65490<=r&&r<=65495||65498<=r&&r<=65500||65512<=r&&r<=65518?"H":4352<=r&&r<=4447||4515<=r&&r<=4519||4602<=r&&r<=4607||9001<=r&&r<=9002||11904<=r&&r<=11929||11931<=r&&r<=12019||12032<=r&&r<=12245||12272<=r&&r<=12283||12289<=r&&r<=12350||12353<=r&&r<=12438||12441<=r&&r<=12543||12549<=r&&r<=12589||12593<=r&&r<=12686||12688<=r&&r<=12730||12736<=r&&r<=12771||12784<=r&&r<=12830||12832<=r&&r<=12871||12880<=r&&r<=13054||13056<=r&&r<=19903||19968<=r&&r<=42124||42128<=r&&r<=42182||43360<=r&&r<=43388||44032<=r&&r<=55203||55216<=r&&r<=55238||55243<=r&&r<=55291||63744<=r&&r<=64255||65040<=r&&r<=65049||65072<=r&&r<=65106||65108<=r&&r<=65126||65128<=r&&r<=65131||110592<=r&&r<=110593||127488<=r&&r<=127490||127504<=r&&r<=127546||127552<=r&&r<=127560||127568<=r&&r<=127569||131072<=r&&r<=194367||177984<=r&&r<=196605||196608<=r&&r<=262141?"W":32<=r&&r<=126||162<=r&&r<=163||165<=r&&r<=166||172===r||175===r||10214<=r&&r<=10221||10629<=r&&r<=10630?"Na":161===r||164===r||167<=r&&r<=168||170===r||173<=r&&r<=174||176<=r&&r<=180||182<=r&&r<=186||188<=r&&r<=191||198===r||208===r||215<=r&&r<=216||222<=r&&r<=225||230===r||232<=r&&r<=234||236<=r&&r<=237||240===r||242<=r&&r<=243||247<=r&&r<=250||252===r||254===r||257===r||273===r||275===r||283===r||294<=r&&r<=295||299===r||305<=r&&r<=307||312===r||319<=r&&r<=322||324===r||328<=r&&r<=331||333===r||338<=r&&r<=339||358<=r&&r<=359||363===r||462===r||464===r||466===r||468===r||470===r||472===r||474===r||476===r||593===r||609===r||708===r||711===r||713<=r&&r<=715||717===r||720===r||728<=r&&r<=731||733===r||735===r||768<=r&&r<=879||913<=r&&r<=929||931<=r&&r<=937||945<=r&&r<=961||963<=r&&r<=969||1025===r||1040<=r&&r<=1103||1105===r||8208===r||8211<=r&&r<=8214||8216<=r&&r<=8217||8220<=r&&r<=8221||8224<=r&&r<=8226||8228<=r&&r<=8231||8240===r||8242<=r&&r<=8243||8245===r||8251===r||8254===r||8308===r||8319===r||8321<=r&&r<=8324||8364===r||8451===r||8453===r||8457===r||8467===r||8470===r||8481<=r&&r<=8482||8486===r||8491===r||8531<=r&&r<=8532||8539<=r&&r<=8542||8544<=r&&r<=8555||8560<=r&&r<=8569||8585===r||8592<=r&&r<=8601||8632<=r&&r<=8633||8658===r||8660===r||8679===r||8704===r||8706<=r&&r<=8707||8711<=r&&r<=8712||8715===r||8719===r||8721===r||8725===r||8730===r||8733<=r&&r<=8736||8739===r||8741===r||8743<=r&&r<=8748||8750===r||8756<=r&&r<=8759||8764<=r&&r<=8765||8776===r||8780===r||8786===r||8800<=r&&r<=8801||8804<=r&&r<=8807||8810<=r&&r<=8811||8814<=r&&r<=8815||8834<=r&&r<=8835||8838<=r&&r<=8839||8853===r||8857===r||8869===r||8895===r||8978===r||9312<=r&&r<=9449||9451<=r&&r<=9547||9552<=r&&r<=9587||9600<=r&&r<=9615||9618<=r&&r<=9621||9632<=r&&r<=9633||9635<=r&&r<=9641||9650<=r&&r<=9651||9654<=r&&r<=9655||9660<=r&&r<=9661||9664<=r&&r<=9665||9670<=r&&r<=9672||9675===r||9678<=r&&r<=9681||9698<=r&&r<=9701||9711===r||9733<=r&&r<=9734||9737===r||9742<=r&&r<=9743||9748<=r&&r<=9749||9756===r||9758===r||9792===r||9794===r||9824<=r&&r<=9825||9827<=r&&r<=9829||9831<=r&&r<=9834||9836<=r&&r<=9837||9839===r||9886<=r&&r<=9887||9918<=r&&r<=9919||9924<=r&&r<=9933||9935<=r&&r<=9953||9955===r||9960<=r&&r<=9983||10045===r||10071===r||10102<=r&&r<=10111||11093<=r&&r<=11097||12872<=r&&r<=12879||57344<=r&&r<=63743||65024<=r&&r<=65039||65533===r||127232<=r&&r<=127242||127248<=r&&r<=127277||127280<=r&&r<=127337||127344<=r&&r<=127386||917760<=r&&r<=917999||983040<=r&&r<=1048573||1048576<=r&&r<=1114109?"A":"N"};class Ke{constructor(t,e){this._numberCharSize=null,this._fullCharSize=null,this._letterCharSize=null,this._specialCharSizeMap={},this._canvas=null,this._context=null,this._contextSaved=!1,this._notSupportCanvas=!1,this._notSupportVRender=!1,this._userSpec={},this.specialCharSet="-/: .,@%'\"~",this._option=t,this._userSpec=null!=e?e:{},this.textSpec=this._initSpec(),Y(t.specialCharSet)&&(this.specialCharSet=t.specialCharSet),this._standardMethod=Y(t.getTextBounds)?this.fullMeasure.bind(this):this.measureWithNaiveCanvas.bind(this)}initContext(){if(this._notSupportCanvas)return!1;if(X(this._canvas)&&(Y(this._option.getCanvasForMeasure)&&(this._canvas=this._option.getCanvasForMeasure()),X(this._canvas)&&"undefined"!=typeof window&&void 0!==window.document&&globalThis&&Y(globalThis.document)&&(this._canvas=globalThis.document.createElement("canvas"))),X(this._context)&&Y(this._canvas)){const t=this._canvas.getContext("2d");Y(t)&&(t.save(),t.font=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{fontStyle:i=e.fontStyle,fontVariant:r=e.fontVariant,fontWeight:o=e.fontWeight,fontSize:n=e.fontSize,fontFamily:s=e.fontFamily}=t;return(i?i+" ":"")+(r?r+" ":"")+(o?o+" ":"")+n+"px "+(s||"sans-serif")}(this.textSpec),this._contextSaved=!0,this._context=t)}return!X(this._context)||(this._notSupportCanvas=!0,!1)}_initSpec(){var t,e,i;const{defaultFontParams:r={}}=this._option,{fontStyle:o=r.fontStyle,fontVariant:n=r.fontVariant,fontWeight:s=(null!==(t=r.fontWeight)&&void 0!==t?t:"normal"),fontSize:a=(null!==(e=r.fontSize)&&void 0!==e?e:12),fontFamily:l=(null!==(i=r.fontFamily)&&void 0!==i?i:"sans-serif"),align:h,textAlign:c=(null!=h?h:"center"),baseline:d,textBaseline:u=(null!=d?d:"middle"),ellipsis:g,limit:p}=this._userSpec;let{lineHeight:f=a}=this._userSpec;if(tt(f)&&"%"===f[f.length-1]){const t=Number.parseFloat(f.substring(0,f.length-1))/100;f=a*t}return{fontStyle:o,fontVariant:n,fontFamily:l,fontSize:a,fontWeight:s,textAlign:c,textBaseline:u,ellipsis:g,limit:p,lineHeight:f}}measure(t,e){switch(e){case"vrender":case"canopus":return this.fullMeasure(t);case"canvas":return this.measureWithNaiveCanvas(t);case"simple":return this.quickMeasureWithoutCanvas(t);default:return this.quickMeasure(t)}}fullMeasure(t){if(X(t))return{width:0,height:0};if(X(this._option.getTextBounds)||!this._notSupportVRender)return this.measureWithNaiveCanvas(t);const{fontFamily:e,fontSize:i,fontWeight:r,textAlign:o,textBaseline:n,ellipsis:s,limit:a,lineHeight:l}=this.textSpec;let h;try{const c=this._option.getTextBounds({text:t,fontFamily:e,fontSize:i,fontWeight:r,textAlign:o,textBaseline:n,ellipsis:!!s,maxLineWidth:a||1/0,lineHeight:l});h={width:c.width(),height:c.height()}}catch(e){this._notSupportVRender=!0,h=this.measureWithNaiveCanvas(t)}return h}measureWithNaiveCanvas(t){return this._measureReduce(t,this._measureWithNaiveCanvas.bind(this))}_measureWithNaiveCanvas(t){var e;if(!this.initContext())return this._quickMeasureWithoutCanvas(t);const i=this._context.measureText(t),{fontSize:r,lineHeight:o}=this.textSpec;return{width:i.width,height:null!==(e=o)&&void 0!==e?e:r}}quickMeasure(t){return this._measureReduce(t,this._quickMeasure.bind(this))}_quickMeasure(t){const e={width:0,height:0};for(let i=0;i<t.length;i++){const r=t[i];let o=this._measureSpecialChar(r);X(o)&&Ke.NUMBERS_CHAR_SET.includes(r)&&(o=this._measureNumberChar()),X(o)&&["F","W"].includes(Ue(r))&&(o=this._measureFullSizeChar()),X(o)&&(o=this._measureLetterChar()),e.width+=o.width,e.height=Math.max(e.height,o.height)}return e}quickMeasureWithoutCanvas(t){return this._measureReduce(t,this._quickMeasureWithoutCanvas.bind(this))}_quickMeasureWithoutCanvas(t){var e;const i={width:0,height:0},{fontSize:r,lineHeight:o}=this.textSpec;for(let e=0;e<t.length;e++){const o=t[e],n=["F","W"].includes(Ue(o))?1:.53;i.width+=n*r}return i.height=null!==(e=o)&&void 0!==e?e:r,i}_measureReduce(t,e){var i;const{fontSize:r,lineHeight:o}=this.textSpec,n={width:0,height:0};if(X(t))return n;if(et(t)){const s=t.filter(Y).map((t=>t.toString()));return 0===s.length?n:1===s.length?e(s[0]):{width:s.reduce(((t,i)=>Math.max(t,e(i).width)),0),height:s.length*((null!==(i=o)&&void 0!==i?i:r)+1)+1}}return e(t.toString())}_measureNumberChar(){if(X(this._numberCharSize)){const t=this._standardMethod(Ke.NUMBERS_CHAR_SET);this._numberCharSize={width:t.width/Ke.NUMBERS_CHAR_SET.length,height:t.height}}return this._numberCharSize}_measureFullSizeChar(){return X(this._fullCharSize)&&(this._fullCharSize=this._standardMethod(Ke.FULL_SIZE_CHAR)),this._fullCharSize}_measureLetterChar(){if(X(this._letterCharSize)){const t=this._standardMethod(Ke.ALPHABET_CHAR_SET);this._letterCharSize={width:t.width/Ke.ALPHABET_CHAR_SET.length,height:t.height}}return this._letterCharSize}_measureSpecialChar(t){return Y(this._specialCharSizeMap[t])?this._specialCharSizeMap[t]:this.specialCharSet.includes(t)?(this._specialCharSizeMap[t]=this._standardMethod(t),this._specialCharSizeMap[t]):null}release(){Y(this._canvas)&&(this._canvas=null),Y(this._context)&&(this._contextSaved&&(this._context.restore(),this._contextSaved=!1),this._context=null)}}Ke.ALPHABET_CHAR_SET="abcdefghijklmnopqrstuvwxyz",Ke.NUMBERS_CHAR_SET="0123456789",Ke.FULL_SIZE_CHAR="字";const $e="undefined"!=typeof console;function Xe(t,e,i){const r=[e].concat([].slice.call(i));$e&&console[t].apply(console,r)}var Ye;!function(t){t[t.None=0]="None",t[t.Error=1]="Error",t[t.Warn=2]="Warn",t[t.Info=3]="Info",t[t.Debug=4]="Debug"}(Ye||(Ye={}));class qe{static getInstance(t,e){return qe._instance&&ot(t)?qe._instance.level(t):qe._instance||(qe._instance=new qe(t,e)),qe._instance}static setInstance(t){return qe._instance=t}static setInstanceLevel(t){qe._instance?qe._instance.level(t):qe._instance=new qe(t)}static clearInstance(){qe._instance=null}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ye.None,e=arguments.length>1?arguments[1]:void 0;this._onErrorHandler=[],this._level=t,this._method=e}addErrorHandler(t){this._onErrorHandler.find((e=>e===t))||this._onErrorHandler.push(t)}removeErrorHandler(t){const e=this._onErrorHandler.findIndex((e=>e===t));e<0||this._onErrorHandler.splice(e,1)}callErrorHandler(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this._onErrorHandler.forEach((t=>t(...e)))}canLogInfo(){return this._level>=Ye.Info}canLogDebug(){return this._level>=Ye.Debug}canLogError(){return this._level>=Ye.Error}canLogWarn(){return this._level>=Ye.Warn}level(t){return arguments.length?(this._level=+t,this):this._level}error(){for(var t,e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];return this._level>=Ye.Error&&(this._onErrorHandler.length?this.callErrorHandler(...i):Xe(null!==(t=this._method)&&void 0!==t?t:"error","ERROR",i)),this}warn(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this._level>=Ye.Warn&&Xe(this._method||"warn","WARN",e),this}info(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this._level>=Ye.Info&&Xe(this._method||"log","INFO",e),this}debug(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this._level>=Ye.Debug&&Xe(this._method||"log","DEBUG",e),this}}function Ze(t){if(nt(t))return[t,t,t,t];if(et(t)){const e=t.length;if(1===e){const e=t[0];return[e,e,e,e]}if(2===e){const[e,i]=t;return[e,i,e,i]}if(3===e){const[e,i,r]=t;return[e,i,r,i]}if(4===e)return t}if(q(t)){const{top:e=0,right:i=0,bottom:r=0,left:o=0}=t;return[e,i,r,o]}return[0,0,0,0]}qe._instance=null;const Je=Yt-1e-8;class Qe{constructor(t){this.init(t)}init(t){this.bounds=t}arc(t,e,i,r,o,n){if(Math.abs(o-r)>Je)return this.bounds.add(t-i,e-i),void this.bounds.add(t+i,e+i);let s,a,l,h,c=1/0,d=-1/0,u=1/0,g=-1/0;function p(t){l=i*Math.cos(t),h=i*Math.sin(t),l<c&&(c=l),l>d&&(d=l),h<u&&(u=h),h>g&&(g=h)}if(p(r),p(o),o!==r)if((r%=Yt)<0&&(r+=Yt),(o%=Yt)<0&&(o+=Yt),o<r&&(n=!n,s=r,r=o,o=s),n)for(o-=Yt,s=r-r%Xt,a=0;a<4&&s>o;++a,s-=Xt)p(s);else for(s=r-r%Xt+Xt,a=0;a<4&&s<o;++a,s+=Xt)p(s);this.bounds.add(t+c,e+u),this.bounds.add(t+d,e+g)}arcTo(t,e,i,r,o){throw new Error("不支持arcTo")}bezierCurveTo(t,e,i,r,o,n){this.bounds.add(t,e),this.bounds.add(i,r),this.bounds.add(o,n)}closePath(){}ellipse(){throw new Error("不支持ellipse")}lineTo(t,e){this.bounds.add(t,e)}moveTo(t,e){this.bounds.add(t,e)}quadraticCurveTo(t,e,i,r){this.bounds.add(t,e),this.bounds.add(i,r)}rect(t,e,i,r){this.bounds.add(t,e),this.bounds.add(t+i,e+r)}clear(){this.bounds.clear()}release(){}}class ti{constructor(){this.curves=[],this.bounds=new ue}getCurveLengths(){return this.curves.map((t=>t.getLength()))}getPointAt(t){return{x:0,y:0}}getLength(){return 0}getBounds(){return this.bounds}}const ei=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,ii={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,M:2,L:2,H:1,V:1,C:6,S:4,Q:4,T:2,A:7},ri=0,oi=1,ni=2,si=3,ai=4,li=5,hi=6,ci=7,di=8;let ui,gi,pi,fi,mi,bi;var yi,Ci,wi,vi,xi,_i,Si,Ai,Ri;function Bi(t){const e=t[0],i=t[1],r=t[2],o=t[3],n=t[4],s=t[5],a=t[6],l=t[7],h=l*n,c=-a*s,d=a*n,u=l*s,g=Math.cos(r),p=Math.sin(r),f=Math.cos(o),m=Math.sin(o),b=.5*(o-r),y=Math.sin(.5*b),C=8/3*y*y/Math.sin(b),w=e+g-C*p,v=i+p+C*g,x=e+f,_=i+m,S=x+C*m,A=_-C*f;return[h*w+c*v,d*w+u*v,h*S+c*A,d*S+u*A,h*x+c*_,d*x+u*_]}function Mi(t,e,i,r){const o=function(t,e,i,r,o,n,s,a,l){const h=ge(s),c=Math.sin(h),d=Math.cos(h),u=d*(a-t)*.5+c*(l-e)*.5,g=d*(l-e)*.5-c*(a-t)*.5;let p=u*u/((i=Math.abs(i))*i)+g*g/((r=Math.abs(r))*r);p>1&&(p=Math.sqrt(p),i*=p,r*=p);const f=d/i,m=c/i,b=-c/r,y=d/r,C=f*a+m*l,w=b*a+y*l,v=f*t+m*e,x=b*t+y*e;let _=1/((v-C)*(v-C)+(x-w)*(x-w))-.25;_<0&&(_=0);let S=Math.sqrt(_);n===o&&(S=-S);const A=.5*(C+v)-S*(x-w),R=.5*(w+x)+S*(v-C),B=Math.atan2(w-R,C-A);let M=Math.atan2(x-R,v-A)-B;M<0&&1===n?M+=Yt:M>0&&0===n&&(M-=Yt);const T=Math.ceil(Math.abs(M/(Xt+.001))),P=[];for(let t=0;t<T;++t){const e=B+t*M/T,o=B+(t+1)*M/T;P[t]=[A,R,e,o,i,r,c,d]}return P}(r[5],r[6],r[0],r[1],r[3],r[4],r[2],e,i);for(let e=0;e<o.length;++e){const i=Bi(o[e]);t.bezierCurveTo(i[0],i[1],i[2],i[3],i[4],i[5])}}!function(t){t[t.NONE=0]="NONE",t[t.UPDATE_BOUNDS=1]="UPDATE_BOUNDS",t[t.UPDATE_SHAPE=2]="UPDATE_SHAPE",t[t.CLEAR_SHAPE=253]="CLEAR_SHAPE",t[t.UPDATE_SHAPE_AND_BOUNDS=3]="UPDATE_SHAPE_AND_BOUNDS",t[t.INIT=179]="INIT",t[t.CLEAR_BOUNDS=254]="CLEAR_BOUNDS",t[t.UPDATE_GLOBAL_MATRIX=32]="UPDATE_GLOBAL_MATRIX",t[t.CLEAR_GLOBAL_MATRIX=223]="CLEAR_GLOBAL_MATRIX",t[t.UPDATE_LOCAL_MATRIX=16]="UPDATE_LOCAL_MATRIX",t[t.CLEAR_LOCAL_MATRIX=239]="CLEAR_LOCAL_MATRIX",t[t.UPDATE_GLOBAL_LOCAL_MATRIX=48]="UPDATE_GLOBAL_LOCAL_MATRIX",t[t.UPDATE_LAYOUT=128]="UPDATE_LAYOUT",t[t.CLEAR_LAYOUT=127]="CLEAR_LAYOUT"}(yi||(yi={})),function(t){t[t.GLOBAL=1]="GLOBAL",t[t.LOCAL=16]="LOCAL",t[t.GLOBAL_ACCURATE=3]="GLOBAL_ACCURATE",t[t.LOCAL_ACCURATE=48]="LOCAL_ACCURATE"}(Ci||(Ci={})),function(t){t[t.INIT=0]="INIT",t[t.DEFAULT=1]="DEFAULT",t[t.STATE=2]="STATE",t[t.ANIMATE_BIND=10]="ANIMATE_BIND",t[t.ANIMATE_PLAY=11]="ANIMATE_PLAY",t[t.ANIMATE_START=12]="ANIMATE_START",t[t.ANIMATE_UPDATE=13]="ANIMATE_UPDATE",t[t.ANIMATE_END=14]="ANIMATE_END",t[t.TRANSLATE=20]="TRANSLATE",t[t.TRANSLATE_TO=21]="TRANSLATE_TO",t[t.SCALE=22]="SCALE",t[t.SCALE_TO=23]="SCALE_TO",t[t.ROTATE=24]="ROTATE",t[t.ROTATE_TO=25]="ROTATE_TO"}(wi||(wi={})),function(t){t[t.INITIAL=0]="INITIAL",t[t.RUNNING=1]="RUNNING",t[t.PAUSED=2]="PAUSED",t[t.END=3]="END"}(vi||(vi={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.SET_ATTR_IMMEDIATELY=1]="SET_ATTR_IMMEDIATELY"}(xi||(xi={})),function(t){t.wait="wait",t.from="from",t.to="to",t.customAnimate="customAnimate"}(_i||(_i={})),function(t){t[t.ROW=1]="ROW",t[t.COLUMN=2]="COLUMN"}(Si||(Si={})),function(t){t[t.CubicBezierCurve=0]="CubicBezierCurve",t[t.QuadraticBezierCurve=1]="QuadraticBezierCurve",t[t.ArcCurve=2]="ArcCurve",t[t.LineCurve=3]="LineCurve",t[t.EllipseCurve=4]="EllipseCurve",t[t.MoveCurve=5]="MoveCurve"}(Ai||(Ai={})),function(t){t[t.beforeFillStroke=0]="beforeFillStroke",t[t.afterFillStroke=1]="afterFillStroke"}(Ri||(Ri={}));const Ti=[(t,e,i,r,o,n,s)=>e.arc(t[1]*o+i,t[2]*n+r,t[3]*(o+n)/2,t[4],t[5],t[6],s),(t,e,i,r,o,n,s)=>e.arcTo(t[1]*o+i,t[2]*n+r,t[3]*o+i,t[4]*n+r,t[5]*(o+n)/2,s),(t,e,i,r,o,n,s)=>e.bezierCurveTo(t[1]*o+i,t[2]*n+r,t[3]*o+i,t[4]*n+r,t[5]*o+i,t[6]*n+r,s),(t,e,i,r)=>e.closePath(),(t,e,i,r,o,n)=>e.ellipse(t[1]*o+i,t[2]*n+r,t[3]*o,t[4]*n,t[5],t[6],t[7],t[8]),(t,e,i,r,o,n,s)=>e.lineTo(t[1]*o+i,t[2]*n+r,s),(t,e,i,r,o,n,s)=>e.moveTo(t[1]*o+i,t[2]*n+r,s),(t,e,i,r,o,n,s)=>e.quadraticCurveTo(t[1]*o+i,t[2]*n+r,t[3]*o+i,t[4]*n+r,s),(t,e,i,r,o,n,s)=>e.rect(t[1]*o+i,t[2]*n+r,t[3]*o,t[4]*n,s)];function Pi(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=arguments.length>6?arguments[6]:void 0;for(let a=0;a<t.length;a++){const l=t[a];Ti[l[0]](l,e,i,r,o,n,s)}}class Hi{getLength(t){return null!=t?this.calcProjLength(t):(Number.isFinite(this.length)||(this.length=this.calcLength()),this.length)}}function Ei(t,e,i,r,o){return function(t,e){let i=0;const r=t.length;for(let o=0;o<r;o++){const n=t[o],s=e[o],a=t[(o+1)%r],l=e[(o+1)%r];i+=he.distanceNN(n,s,a,l)}return i/2}([t.x,e.x,i.x,r.x],[t.y,e.y,i.y,r.y])}function ki(t,e,i,r,o){const n=1-o;return n*n*n*t+3*e*o*n*n+3*i*o*o*n+r*o*o*o}function Li(t,e,i,r,o){const n=ki(t.x,e.x,i.x,r.x,o),s=ki(t.y,e.y,i.y,r.y,o);return new le(n,s)}function Fi(t,e){const{p0:i,p1:r,p2:o,p3:n}=t,s=Li(i,r,o,n,e),a=he.pointAtPP(i,r,e),l=he.pointAtPP(r,o,e),h=he.pointAtPP(o,n,e),c=he.pointAtPP(a,l,e),d=he.pointAtPP(l,h,e);return[new Ii(i,a,c,s),new Ii(s,d,h,n)]}class Ii extends Hi{constructor(t,e,i,r){super(),this.type=Ai.CubicBezierCurve,this.p0=t,this.p1=e,this.p2=i,this.p3=r}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y+this.p2.x+this.p2.y+this.p3.x+this.p3.y)}getPointAt(t){if(!1!==this.defined)return Li(this.p0,this.p1,this.p2,this.p3,t);throw new Error("defined为false的点不能getPointAt")}calcLength(){return this._validPoint()?Ei(this.p0,this.p1,this.p2,this.p3):60}calcProjLength(t){return t===Si.ROW?Zt(this.p0.x-this.p3.x):t===Si.COLUMN?Zt(this.p0.y-this.p3.y):0}getAngleAt(t){const e=te(t-.01,0),i=ee(t+.01,1),r=this.getPointAt(e),o=this.getPointAt(i);return Jt(o.y-r.y,o.x-r.x)}}function zi(t,e){const{p0:i,p1:r}=t,o=he.pointAtPP(i,r,e);return[new Oi(i,o),new Oi(o,r)]}class Oi extends Hi{constructor(t,e){super(),this.type=Ai.LineCurve,this.p0=t,this.p1=e}getPointAt(t){if(!1!==this.defined)return he.pointAtPP(this.p0,this.p1,t);throw new Error("defined为false的点不能getPointAt")}getAngleAt(t){return null==this.angle&&(this.angle=Jt(this.p1.y-this.p0.y,this.p1.x-this.p0.x)),this.angle}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y)}calcLength(){return this._validPoint()?he.distancePP(this.p0,this.p1):60}calcProjLength(t){return t===Si.ROW?Zt(this.p0.x-this.p1.x):t===Si.COLUMN?Zt(this.p0.y-this.p1.y):0}}class Di{get endX(){return this._lastX}get endY(){return this._lastY}constructor(t,e){this.init(t,e)}init(t,e){this._lastX=this._lastY=this._startX=this._startY=0,this.curveType=t,this.direction=e,this.curves=[]}bezierCurveTo(t,e,i,r,o,n,s,a){const l=new Ii(new le(this._lastX,this._lastY),new le(t,e),new le(i,r),new le(o,n));l.originP1=this._lastOriginP,l.originP2=a,l.defined=s,this.curves.push(l),this._lastX=o,this._lastY=n,this._lastOriginP=a}closePath(){if(this.curves.length<2)return;const t=this.curves[this.curves.length-1];this.lineTo(this._startX,this._startY,t.defined,this._startOriginP)}ellipse(){throw new Error("SegContext不支持调用ellipse")}lineTo(t,e,i,r){const o=this.addLinearCurve(t,e,i,this._lastOriginP,r);this.curves.push(o),this._lastX=t,this._lastY=e,this._lastOriginP=r}moveTo(t,e,i){return this._lastX=this._startX=t,this._lastY=this._startY=e,this._lastOriginP=i,this._startOriginP=i,this}quadraticCurveTo(t,e,i,r){throw new Error("SegContext不支持调用quadraticCurveTo")}clear(){this.curves=[],this.length=NaN}tryUpdateLength(t){return this.getLength(t)}addLinearCurve(t,e,i,r,o){const n=new Oi(new le(this._lastX,this._lastY),new le(t,e));return n.originP1=r,n.originP2=o,n.defined=i,n}getPointAt(t){throw new Error("暂未实现")}getCurveLengths(){return[]}getLength(t){var e,i;if(t===Si.COLUMN){if(!this.curves.length)return 0;const t=this.curves[0],i=this.curves[this.curves.length-1],r=null!==(e=i.p3)&&void 0!==e?e:i.p1;return Zt(t.p0.y-r.y)}if(t===Si.ROW){if(!this.curves.length)return 0;const t=this.curves[0],e=this.curves[this.curves.length-1],r=null!==(i=e.p3)&&void 0!==i?i:e.p1;return Zt(t.p0.x-r.x)}return Number.isFinite(this.length)||(this.length=this.curves.reduce(((t,e)=>t+e.getLength()),0)),this.length}}class Wi extends Di{bezierCurveTo(t,e,i,r,o,n,s,a){return super.bezierCurveTo(e,t,r,i,n,o,s,a)}lineTo(t,e,i,r){return super.lineTo(e,t,i,r)}moveTo(t,e,i){return super.moveTo(e,t,i)}clear(){return super.clear()}}function Ni(t,e){let i=!1;for(let r=0,o=e.length;r<=o;r++)r>=o===i&&((i=!i)?t.lineStart():t.lineEnd()),i&&t.point(e[r])}function Gi(t,e,i){const r=null!=e?e:Zt(i[i.length-1].x-i[0].x)>Zt(i[i.length-1].y-i[0].y)?Si.ROW:Si.COLUMN;return"monotoneY"===t?new Wi(t,r):new Di(t,r)}class ji{constructor(t,e){this.context=t,e&&(this.startPoint=e)}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){(this._line||0!==this._line&&1===this._point)&&this.context.closePath(),this._line=1-this._line}point(t){const e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,!1!==this._lastDefined&&!1!==t.defined,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;default:this.context.lineTo(e,i,!1!==this._lastDefined&&!1!==t.defined,t)}this._lastDefined=t.defined}tryUpdateLength(){return this.context.tryUpdateLength()}}function Vi(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{direction:i,startPoint:r}=e;if(t.length<2-Number(!!r))return null;const o=Gi("linear",i,t);return function(t,e){Ni(t,e)}(new ji(o,r),t),o}function Ui(t,e,i,r,o){t.context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+i)/6,r,t.lastPoint1)}class Ki{constructor(t,e){this.context=t,this.startPoint=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){2===this._point&&Ui(this,6*this._x1-(this._x0+4*this._x1),6*this._y1-(this._y0+4*this._y1),!1!==this._lastDefined1&&!1!==this._lastDefined2,this.lastPoint1),(this._line||0!==this._line&&1===this._point)&&this.context.closePath(),this._line=1-this._line}point(t){const e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,!1!==this._lastDefined1&&!1!==this._lastDefined2,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;break;default:Ui(this,e,i,!1!==this._lastDefined1&&!1!==this._lastDefined2)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}}function $i(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{direction:i,startPoint:r}=e;if(t.length<2-Number(!!r))return null;if(t.length<3-Number(!!r))return Vi(t,e);const o=Gi("basis",i,t);return function(t,e){Ni(t,e)}(new Ki(o,r),t),o}function Xi(t){return t<0?-1:1}function Yi(t,e,i){const r=t._x1-t._x0,o=e-t._x1,n=(t._y1-t._y0)/(r||Number(o<0&&-0)),s=(i-t._y1)/(o||Number(r<0&&-0)),a=(n*o+s*r)/(r+o);return(Xi(n)+Xi(s))*Math.min(Math.abs(n),Math.abs(s),.5*Math.abs(a))||0}function qi(t,e){const i=t._x1-t._x0;return i?(3*(t._y1-t._y0)/i-e)/2:e}function Zi(t,e,i,r,o){const n=t._x0,s=t._y0,a=t._x1,l=t._y1,h=(a-n)/3;t.context.bezierCurveTo(n+h,s+h*e,a-h,l-h*i,a,l,r,t.lastPoint1)}class Ji{constructor(t,e){this.context=t,this.startPoint=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){switch(this._point){case 2:this.context.lineTo(this._x1,this._y1,!1!==this._lastDefined1&&!1!==this._lastDefined2,this.lastPoint1);break;case 3:Zi(this,this._t0,qi(this,this._t0),!1!==this._lastDefined1&&!1!==this._lastDefined2,this.lastPoint1)}(this._line||0!==this._line&&1===this._point)&&this.context.closePath(),this._line=1-this._line}point(t){let e=NaN;const i=t.x,r=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(i,r,!1!==this._lastDefined1&&!1!==this._lastDefined2,t):this.context.moveTo(i,r,t);break;case 1:this._point=2;break;case 2:this._point=3,Zi(this,qi(this,e=Yi(this,i,r)),e,!1!==this._lastDefined1&&!1!==this._lastDefined2);break;default:Zi(this,this._t0,e=Yi(this,i,r),!1!==this._lastDefined1&&!1!==this._lastDefined2)}this._x0=this._x1,this._x1=i,this._y0=this._y1,this._y1=r,this._t0=e,this._lastDefined1=this._lastDefined2,this._lastDefined2=!1!==t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}}class Qi extends Ji{constructor(t,e){super(t,e)}point(t){return super.point({y:t.x,x:t.y,defined:t.defined})}}function tr(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{direction:i,startPoint:r}=e;if(t.length<2-Number(!!r))return null;if(t.length<3-Number(!!r))return Vi(t,e);const o=Gi("monotoneX",i,t);return function(t,e){Ni(t,e)}(new Ji(o,r),t),o}function er(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{direction:i,startPoint:r}=e;if(t.length<2-Number(!!r))return null;if(t.length<3-Number(!!r))return Vi(t,e);const o=Gi("monotoneY",i,t);return function(t,e){Ni(t,e)}(new Qi(o,r),t),o}let ir=class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=arguments.length>2?arguments[2]:void 0;this.context=t,this._t=e,this.startPoint=i}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x=this._y=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){0<this._t&&this._t<1&&2===this._point&&this.context.lineTo(this._x,this._y,!1!==this._lastDefined,this.lastPoint),(this._line||0!==this._line&&1===this._point)&&this.context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)}point(t){const e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,!1!==this._lastDefined&&!1!==t.defined,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;default:if(this._t<=0)this.context.lineTo(this._x,i,!1!==this._lastDefined&&!1!==t.defined,this.lastPoint),this.context.lineTo(e,i,!1!==this._lastDefined&&!1!==t.defined,t);else{const r=this._x*(1-this._t)+e*this._t;this.context.lineTo(r,this._y,!1!==this._lastDefined&&!1!==t.defined,this.lastPoint),this.context.lineTo(r,i,!1!==this._lastDefined&&!1!==t.defined,t)}}this._lastDefined=t.defined,this._x=e,this._y=i,this.lastPoint=t}tryUpdateLength(){return this.context.tryUpdateLength()}};function rr(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{direction:r,startPoint:o}=i;if(t.length<2-Number(!!o))return null;const n=new Di("step",null!=r?r:Zt(t[t.length-1].x-t[0].x)>Zt(t[t.length-1].y-t[0].y)?Si.ROW:Si.COLUMN);return function(t,e){Ni(t,e)}(new ir(n,e,o),t),n}class or extends ji{lineEnd(){this.context.closePath()}}function nr(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{direction:i,startPoint:r}=e;if(t.length<2-Number(!!r))return null;const o=Gi("linear",i,t);return function(t,e){Ni(t,e)}(new or(o,r),t),o}function sr(t,e,i){switch(e){case"linear":default:return Vi(t,i);case"basis":return $i(t,i);case"monotoneX":return tr(t,i);case"monotoneY":return er(t,i);case"step":return rr(t,.5,i);case"stepBefore":return rr(t,0,i);case"stepAfter":return rr(t,1,i);case"linearClosed":return nr(t,i)}}class ar extends ti{constructor(t){super(),this.commandList=[],t&&(this._ctx=t),this._boundsContext=new Qe(this.bounds)}setCtx(t){this._ctx=t}moveTo(t,e){return this.commandList.push([hi,t,e]),this._ctx&&this._ctx.moveTo(t,e),this}lineTo(t,e){return this.commandList.push([li,t,e]),this._ctx&&this._ctx.lineTo(t,e),this}quadraticCurveTo(t,e,i,r){return this.commandList.push([ci,t,e,i,r]),this._ctx&&this._ctx.quadraticCurveTo(t,e,i,r),this}bezierCurveTo(t,e,i,r,o,n){return this.commandList.push([ni,t,e,i,r,o,n]),this._ctx&&this._ctx.bezierCurveTo(t,e,i,r,o,n),this}arcTo(t,e,i,r,o){return this.commandList.push([oi,t,e,i,r,o]),this._ctx&&this._ctx.arcTo(t,e,i,r,o),this}ellipse(t,e,i,r,o,n,s,a){return this.commandList.push([ai,t,e,i,r,o,n,s,a]),this._ctx&&this._ctx.ellipse(t,e,i,r,o,n,s,a),this}rect(t,e,i,r){return this.commandList.push([di,t,e,i,r]),this._ctx&&this._ctx.rect(t,e,i,r),this}arc(t,e,i,r,o,n){return this.commandList.push([ri,t,e,i,r,o,n]),this._ctx&&this._ctx.arc(t,e,i,r,o,n),this}closePath(){return this.commandList.push([si]),this._ctx&&this._ctx.closePath(),this}addCurve(t){this.curves.push(t)}clear(){this.transformCbList=null,this.commandList.length=0,this.curves.length=0}beginPath(){this.clear()}toString(){if(!this.toStringCbList){const t=[];t[hi]=t=>`M${t[1]} ${t[2]}`,t[li]=t=>`L${t[1]} ${t[2]}`,t[ci]=t=>`Q${t[1]} ${t[2]} ${t[3]} ${t[4]}`,t[ni]=t=>`C${t[1]} ${t[2]} ${t[3]} ${t[4]} ${t[5]} ${t[6]}`,t[ri]=t=>{const e=[];((t,e,i,r,o,n,s)=>{const a=Math.abs(i-e),l=4*Math.tan(a/4)/3,h=i<e?-1:1,c=Math.cos(e),d=Math.sin(e),u=Math.cos(i),g=Math.sin(i),p=c*n+r,f=d*s+o,m=u*n+r,b=g*s+o,y=n*l*h,C=s*l*h;t.push(p-y*d,f+C*c,m+y*g,b-C*u,m,b)})(e,t[4],t[5],t[1],t[2],t[3],t[3]);let i="";for(let t=0;t<e.length;t+=6)i+=`C${e[t]} ${e[t+1]} ${e[t+2]} ${e[t+3]} ${e[t+4]} ${e[t+5]}`;return i},t[di]=t=>`M${t[1]} ${t[2]} h${t[3]} v${t[4]} H${t[1]}Z`,t[si]=t=>"Z",this.toStringCbList=t}const t=this.toStringCbList;let e="";return this.commandList.forEach((i=>{e+=t[i[0]](i)})),e}fromString(t,e,i,r,o){this.clear();const n=function(t){if(!t)return[];const e=t.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(null===e)return[];let i,r;const o=[];for(let t=0,n=e.length;t<n;t++)if(ui=e[t],gi=ui.slice(1),pi=ui[0],i=[pi],r=gi.match(ei),null!==r){for(let t=0,e=r.length;t<e;t++)fi=r[t],mi=parseFloat(fi),Number.isNaN(mi)||i.push(mi);if(bi=ii[pi],i.length-1>bi){let t;for(let e=1,r=i.length;e<r;e+=bi){t=[pi];for(let r=e,o=e+bi;r<o;r++)t.push(i[r]);o.push(t)}}else o.push(i)}else o.push(i);return o}(t);return this._runCommandStrList(n,e,i,r,o),this._updateBounds(),this}fromLine(t){const{points:e,curveType:i,clipRangeByDimension:r}=t.attribute;if(!e)return;const o=sr(e,i);"x"===r?this.direction=Si.ROW:"y"===r?this.direction=Si.COLUMN:"auto"===r&&(this.direction=o.direction),this.curves=o.curves}fromCustomPath2D(t,e,i,r,o){return this.clear(),this._runCommandList(t.commandList,e,i,r,o),this._updateBounds(),this}transform(t,e,i,r){const o=this.commandList;if(!this.transformCbList){const t=[];t[hi]=this.moveToTransform,t[li]=this.lineToTransform,t[ci]=this.quadraticCurveToTransform,t[ni]=this.bezierCurveToTransform,t[oi]=this.arcToTransform,t[ai]=this.ellipseTransform,t[di]=this.rectTransform,t[ri]=this.arcTransform,t[si]=this.closePathTransform,this.transformCbList=t}o.forEach((o=>{this.transformCbList[o[0]](o,t,e,i,r)})),this._updateBounds()}moveToTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i}lineToTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i}quadraticCurveToTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i,t[3]=t[3]*r+e,t[4]=t[4]*o+i}bezierCurveToTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i,t[3]=t[3]*r+e,t[4]=t[4]*o+i,t[5]=t[5]*r+e,t[6]=t[6]*o+i}arcToTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i,t[3]=t[3]*r+e,t[4]=t[4]*o+i,t[5]=t[5]*(r+o)/2}ellipseTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i,t[3]=t[3]*r,t[4]=t[4]*o}rectTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i,t[3]=t[3]*r,t[4]=t[4]*o}arcTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i,t[3]=t[3]*(r+o)/2}closePathTransform(){}_runCommandStrList(t){let e,i,r,o,n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,c=null,d=0,u=0,g=0,p=0;for(let f=0,m=t.length;f<m;++f){switch(e=t[f],1===l&&1===h||(e=hr(e,l,h)),e[0]){case"l":d+=e[1],u+=e[2],this.lineTo(d+s,u+a);break;case"L":d=e[1],u=e[2],this.lineTo(d+s,u+a);break;case"h":d+=e[1],this.lineTo(d+s,u+a);break;case"H":d=e[1],this.lineTo(d+s,u+a);break;case"v":u+=e[1],this.lineTo(d+s,u+a);break;case"V":u=e[1],this.lineTo(d+s,u+a);break;case"m":d+=e[1],u+=e[2],this.moveTo(d+s,u+a);break;case"M":d=e[1],u=e[2],this.moveTo(d+s,u+a);break;case"c":i=d+e[5],r=u+e[6],g=d+e[3],p=u+e[4],this.bezierCurveTo(d+e[1]+s,u+e[2]+a,g+s,p+a,i+s,r+a),d=i,u=r;break;case"C":d=e[5],u=e[6],g=e[3],p=e[4],this.bezierCurveTo(e[1]+s,e[2]+a,g+s,p+a,d+s,u+a);break;case"s":i=d+e[3],r=u+e[4],g=2*d-g,p=2*u-p,this.bezierCurveTo(g+s,p+a,d+e[1]+s,u+e[2]+a,i+s,r+a),g=d+e[1],p=u+e[2],d=i,u=r;break;case"S":i=e[3],r=e[4],g=2*d-g,p=2*u-p,this.bezierCurveTo(g+s,p+a,e[1]+s,e[2]+a,i+s,r+a),d=i,u=r,g=e[1],p=e[2];break;case"q":i=d+e[3],r=u+e[4],g=d+e[1],p=u+e[2],this.quadraticCurveTo(g+s,p+a,i+s,r+a),d=i,u=r;break;case"Q":i=e[3],r=e[4],this.quadraticCurveTo(e[1]+s,e[2]+a,i+s,r+a),d=i,u=r,g=e[1],p=e[2];break;case"t":i=d+e[1],r=u+e[2],null===c[0].match(/[QqTt]/)?(g=d,p=u):"t"===c[0]?(g=2*d-o,p=2*u-n):"q"===c[0]&&(g=2*d-g,p=2*u-p),o=g,n=p,this.quadraticCurveTo(g+s,p+a,i+s,r+a),d=i,u=r,g=d+e[1],p=u+e[2];break;case"T":i=e[1],r=e[2],g=2*d-g,p=2*u-p,this.quadraticCurveTo(g+s,p+a,i+s,r+a),d=i,u=r;break;case"a":Mi(this,d+s,u+a,[e[1],e[2],e[3],e[4],e[5],e[6]+d+s,e[7]+u+a]),d+=e[6],u+=e[7];break;case"A":Mi(this,d+s,u+a,[e[1],e[2],e[3],e[4],e[5],e[6]+s,e[7]+a]),d=e[6],u=e[7];break;case"z":case"Z":this.closePath()}c=e}}_runCommandList(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(0!==e||0!==i||1!==r||1!==o)for(let n=0,s=t.length;n<s;++n){const s=t[n].slice();switch(s[0]){case li:this.lineToTransform(s,e,i,r,o);break;case hi:this.moveToTransform(s,e,i,r,o);break;case ni:this.bezierCurveToTransform(s,e,i,r,o);break;case ci:this.quadraticCurveToTransform(s,e,i,r,o);break;case ri:this.arcToTransform(s,e,i,r,o);break;case ai:this.ellipseTransform(s,e,i,r,o);break;case di:this.rectTransform(s,e,i,r,o);break;case oi:this.arcToTransform(s,e,i,r,o);break;case si:this.closePath()}}else this.commandList=t.map((t=>t.slice()))}_updateBounds(){this.bounds.clear(),Pi(this.commandList,this._boundsContext)}release(){this.commandList=[],this._boundsContext=null,this._ctx=null}getLength(){if(this.direction===Si.COLUMN){if(!this.curves.length)return 0;const t=this.curves[0],e=this.curves[this.curves.length-1];return Zt(t.p0.y-e.p1.y)}if(this.direction===Si.ROW){if(!this.curves.length)return 0;const t=this.curves[0],e=this.curves[this.curves.length-1];return Zt(t.p0.x-e.p1.x)}return this.curves.reduce(((t,e)=>t+e.getLength()),0)}getAttrAt(t){if(!this.curves)return{pos:{x:0,y:0},angle:0};let e,i=0;for(let r=0;r<this.curves.length;r++){e=this.curves[r];const o=e.getLength(this.direction);if(i+o>=t)break;i+=o}const r=(t-i)/e.getLength(this.direction);return{pos:e.getPointAt(r),angle:e.getAngleAt(r)}}}const lr=["l",0,0,0,0,0,0,0];function hr(t,e,i){const r=lr[0]=t[0];if("a"===r||"A"===r)lr[1]=e*t[1],lr[2]=i*t[2],lr[3]=t[3],lr[4]=t[4],lr[5]=t[5],lr[6]=e*t[6],lr[7]=i*t[7];else if("h"===r||"H"===r)lr[1]=e*t[1];else if("v"===r||"V"===r)lr[1]=i*t[1];else for(let r=1,o=t.length;r<o;++r)lr[r]=(r%2==1?e:i)*t[r];return lr}const cr={x:0,y:0,z:0,dx:0,dy:0,dz:0,scrollX:0,scrollY:0,scaleX:1,scaleY:1,scaleZ:1,angle:0,alpha:0,beta:0,scaleCenter:[0,0],anchor:[0,0],anchor3d:[0,0],postMatrix:new fe},dr={fillOpacity:1,fill:!1,shadowBlur:0,shadowColor:"black",shadowOffsetX:0,shadowOffsetY:0},ur={strokeOpacity:1,lineDash:[],lineDashOffset:0,lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,strokeBoundsBuffer:2,stroke:!1},gr=Object.assign({outerBorder:Object.assign(Object.assign({},ur),{distance:0}),innerBorder:Object.assign(Object.assign({},ur),{distance:0})},ur),pr={text:"",maxLineWidth:1/0,textAlign:"left",textBaseline:"alphabetic",fontSize:16,fontFamily:"PingFang SC,Microsoft Yahei,system-ui,-apple-system,segoe ui,\n    Roboto,Helvetica,Arial,sans-serif, apple color emoji,segoe ui emoji,segoe ui symbol",fontWeight:"",ellipsis:"…",fontVariant:"",fontStyle:"",lineHeight:void 0,underline:0,lineThrough:0,scaleIn3d:!1,direction:"horizontal",wordBreak:"break-all",ignoreBuf:!1,verticalMode:0,wrap:!1,whiteSpace:"no-wrap",heightLimit:1/0,lineClamp:1/0,suffixPosition:"end",underlineDash:[],underlineOffset:0,disableAutoClipedPoptip:void 0},fr=Object.assign(Object.assign(Object.assign(Object.assign({opacity:1,background:null,backgroundOpacity:1,backgroundCornerRadius:0,texture:null,textureColor:"black",textureSize:10,texturePadding:2,backgroundMode:"no-repeat",backgroundFit:!0,blur:0,cursor:null,html:null,react:null},dr),gr),{alignSelf:"auto"}),{pickStrokeBuffer:0}),mr={connectedType:"none",connectedStyle:{},connectedX:NaN,connectedY:NaN},br=Object.assign(Object.assign(Object.assign({strokeSeg:null,pickable:!0,childrenPickable:!0,fillPickable:!0,strokePickable:!0,visible:!0,zIndex:0,layout:null,boundsPadding:0,renderStyle:"default",pickMode:"accurate",customPickShape:null,boundsMode:"accurate",keepDirIn3d:!0,shadowRootIdx:1,globalZIndex:1,globalCompositeOperation:"",overflow:"hidden"},{_debug_bounds:!1}),fr),cr),yr=Object.assign(Object.assign({},br),{startAngle:0,endAngle:qt,innerRadius:0,outerRadius:1,innerPadding:0,outerPadding:0,cornerRadius:0,padRadius:0,padAngle:0,cap:!1,forceShowCap:!1}),Cr=Object.assign(Object.assign(Object.assign({},br),mr),{points:[],segments:[],curveType:"linear",clipRange:1,closePath:!1}),wr=Object.assign(Object.assign({},br),{radius:1,startAngle:0,endAngle:qt}),vr=Object.assign(Object.assign({},br),{width:0,height:0,cornerRadius:0,path:[],clip:!1,visibleAll:!0,display:"relative",flexDirection:"row",flexWrap:"wrap",justifyContent:"flex-start",alignItems:"flex-start",alignContent:"flex-start"}),xr=Object.assign(Object.assign({},br),{path:"",width:0,height:0,cornerRadius:0,clip:!1}),_r=Object.assign(Object.assign(Object.assign({},br),mr),{points:[],segments:[],curveType:"linear",clipRange:1,clipRangeByDimension:"default",closePath:!1}),Sr=Object.assign(Object.assign({},br),{path:new ar,customPath:()=>{qe.getInstance().warn("空函数")}}),Ar=Object.assign(Object.assign({},br),{points:[],cornerRadius:0,closePath:!0}),Rr=Object.assign(Object.assign({},br),{width:0,height:0,x1:0,y1:0,strokeBoundsBuffer:0,cornerRadius:0}),Br=Object.assign(Object.assign({},br),{width:0,height:0,x1:0,y1:0,cornerRadius:0,length:0}),Mr=Object.assign(Object.assign({},br),{symbolType:"circle",size:10,keepDirIn3d:!0}),Tr=Object.assign(Object.assign(Object.assign({},br),pr),{strokeBoundsBuffer:0,keepDirIn3d:!0}),Pr=Object.assign(Object.assign(Object.assign({},br),pr),{width:300,height:300,ellipsis:!0,wordBreak:"break-word",verticalDirection:"top",textAlign:"left",textBaseline:"top",layoutDirection:"horizontal",textConfig:[],maxHeight:void 0,maxWidth:void 0,singleLine:!1}),Hr=Object.assign(Object.assign({repeatX:"no-repeat",repeatY:"no-repeat",image:"",width:0,height:0},br),{fill:!0,cornerRadius:0}),Er=Object.assign(Object.assign({},Hr),{backgroundShowMode:"never",backgroundWidth:0,backgroundHeight:0,textAlign:"left",textBaseline:"middle",direction:"horizontal",margin:0,id:"",width:20,height:20,backgroundFill:"rgba(101, 117, 168, 0.1)",backgroundFillOpacity:1,backgroundStroke:!1,backgroundStrokeOpacity:1,backgroundRadius:4,opacity:1});const kr=new class{},Lr={horizontal:{width:"width",height:"height",left:"left",top:"top",x:"x",y:"y",bottom:"bottom"},vertical:{width:"height",height:"width",left:"top",top:"left",x:"y",y:"x",bottom:"right"}},Fr=!0,Ir=!1,zr=/\w|\(|\)|-/,Or=/[.?!,;:/，。？！、；：]/,Dr=/\S/;function Wr(t,e,i,r,o){if(!e||e<=0)return 0;const n=kr.graphicUtil.textMeasure;let s=r,a=t.slice(0,s),l=Math.floor(n.measureText(a,i).width),h=t.slice(0,s+1),c=Math.floor(n.measureText(h,i).width);for(;l>e||c<=e;){if(l>e?s--:s++,s>t.length){s=t.length;break}if(s<0){s=0;break}a=t.slice(0,s),l=Math.floor(n.measureText(a,i).width),h=t.slice(0,s+1),c=Math.floor(n.measureText(h,i).width)}return o&&(s=Nr(t,s)),s}function Nr(t,e){let i=e;for(;zr.test(t[i-1])&&zr.test(t[i])||Or.test(t[i]);)if(i--,i<=0)return e;return i}function Gr(t,e){const i=kr.graphicUtil.textMeasure.measureText(t,e),r={ascent:0,height:0,descent:0,width:0};return"number"!=typeof i.actualBoundingBoxAscent||"number"!=typeof i.actualBoundingBoxDescent?(r.width=Math.floor(i.width),r.height=e.fontSize||0,r.ascent=r.height,r.descent=0):(r.width=Math.floor(i.width),r.height=Math.floor(i.actualBoundingBoxAscent+i.actualBoundingBoxDescent),r.ascent=Math.floor(i.actualBoundingBoxAscent),r.descent=r.height-r.ascent),r}var jr=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let Vr=class{configure(t,e){this.canvas=t.canvas,this.context=t.context,t.bindTextMeasure(this)}measureTextWidth(t,e){return this.context?(this.context.setTextStyleWithoutAlignBaseline(e),this.context.measureText(t).width):this.estimate(t,e).width}estimate(t,e){let{fontSize:i=Tr.fontSize}=e,r=0,o=0;for(let e=0;e<t.length;e++)t.charCodeAt(e)<128?r++:o++;return{width:~~(.8*r*i+o*i),height:i}}measureTextPixelHeight(t,e){var i;if(!this.context)return null!==(i=e.fontSize)&&void 0!==i?i:pr.fontSize;this.context.setTextStyleWithoutAlignBaseline(e);const r=this.context.measureText(t);return Math.abs(r.actualBoundingBoxAscent-r.actualBoundingBoxDescent)}measureTextBoundHieght(t,e){var i;if(!this.context)return null!==(i=e.fontSize)&&void 0!==i?i:pr.fontSize;this.context.setTextStyleWithoutAlignBaseline(e);const r=this.context.measureText(t);return Math.abs(r.fontBoundingBoxAscent-r.fontBoundingBoxDescent)}measureText(t,e){return this.context?(this.context.setTextStyleWithoutAlignBaseline(e),this.context.measureText(t)):this.estimate(t,e)}clipTextVertical(t,e,i,r){if(0===t.length)return{verticalList:t,width:0};const{fontSize:o=12}=e;t.forEach((t=>{t.width=0===t.direction?o:this.measureTextWidth(t.text,e)}));const n=[];let s=0,a=0;for(;a<t.length&&s+t[a].width<i;a++)s+=t[a].width,n.push(t[a]);if(t[a]&&t[a].text.length>1){const o=this._clipText(t[a].text,e,i-s,0,t[a].text.length-1,"end",!1);if(r&&o.str!==t[a].text){let i="",r=0;for(let e=0;e<a;e++){const o=t[e];i+=o.text,r+=o.text.length}i+=t[a].text;let n=Nr(i,r+o.str.length);n-=r,n!==o.str.length-1&&(o.str=o.str.substring(0,n),o.width=this.measureTextWidth(o.str,e))}n.push(Object.assign(Object.assign({},t[a]),{text:o.str,width:o.width})),s+=o.width}return{verticalList:n,width:s}}clipText(t,e,i,r){if(0===t.length)return{str:"",width:0};let o=this.measureTextWidth(t,e);if(o<=i)return{str:t,width:o};if(o=this.measureTextWidth(t[0],e),o>i)return{str:"",width:0};const n=this._clipText(t,e,i,0,t.length-1,"end",!1);if(r&&n.str!==t){const i=Nr(t,n.str.length);i!==n.str.length&&(n.str=t.substring(0,i),n.width=this.measureTextWidth(n.str,e))}return n}_clipText(t,e,i,r,o,n,s){let a;if("start"===n)a=this._clipTextStart(t,e,i,r,o),s&&(a.result=s+a.str);else if("middle"===n){const r=this._clipTextMiddle(t,e,i,"","",0,0,1);a={str:"none",width:r.width,result:r.left+s+r.right}}else a=this._clipTextEnd(t,e,i,r,o),s&&(a.result=a.str+s);return a}_clipTextEnd(t,e,i,r,o){const n=Math.floor((r+o)/2),s=t.substring(0,n+1),a=this.measureTextWidth(s,e);let l;if(a>i){if(s.length<=1)return{str:"",width:0};const o=t.substring(0,n);return l=this.measureTextWidth(o,e),l<=i?{str:o,width:l}:this._clipTextEnd(t,e,i,r,n)}if(a<i){if(n>=t.length-1)return{str:t,width:this.measureTextWidth(t,e)};const r=t.substring(0,n+2);return l=this.measureTextWidth(r,e),l>=i?{str:s,width:a}:this._clipTextEnd(t,e,i,n,o)}return{str:s,width:a}}_clipTextStart(t,e,i,r,o){const n=Math.ceil((r+o)/2),s=t.substring(n-1,t.length-1),a=this.measureTextWidth(s,e);let l;if(a>i){if(s.length<=1)return{str:"",width:0};const r=t.substring(n,t.length-1);return l=this.measureTextWidth(r,e),l<=i?{str:r,width:l}:this._clipTextStart(t,e,i,n,t.length-1)}if(a<i){if(n<=0)return{str:t,width:this.measureTextWidth(t,e)};const o=t.substring(n-2,t.length-1);return l=this.measureTextWidth(o,e),l>=i?{str:s,width:a}:this._clipTextStart(t,e,i,r,n)}return{str:s,width:a}}_clipTextMiddle(t,e,i,r,o,n,s,a){const l=t.substring(0,a),h=this.measureTextWidth(l,e);if(h+s>i)return{left:r,right:o,width:n+s};const c=t.substring(t.length-a,t.length),d=this.measureTextWidth(c,e);return h+d>i?{left:l,right:o,width:h+s}:this._clipTextMiddle(t,e,i,l,c,h,d,a+1)}clipTextWithSuffixVertical(t,e,i,r,o,n){if(""===r)return this.clipTextVertical(t,e,i,o);if(0===t.length)return{verticalList:t,width:0};const s=this.clipTextVertical(t,e,i,o);if(s.verticalList.length===t.length&&s.verticalList[s.verticalList.length-1].width===t[t.length-1].width)return s;const a=this.measureTextWidth(r,e);if(a>i)return s;let l;if(i-=a,"start"===n){const n=this.revertVerticalList(t);l=this.clipTextVertical(n,e,i,o);const s=this.revertVerticalList(l.verticalList);s.unshift({text:r,direction:1,width:a}),l.verticalList=s}else if("middle"===n){const n=this.clipTextVertical(t,e,i/2,o),s=this.revertVerticalList(t),h=this.clipTextVertical(s,e,i/2,o);n.verticalList.push({text:r,direction:1,width:a}),this.revertVerticalList(h.verticalList).forEach((t=>n.verticalList.push(t))),l={verticalList:n.verticalList,width:n.width+h.width}}else l=this.clipTextVertical(t,e,i,o),l.verticalList.push({text:r,direction:1,width:a});return l.width+=a,l}revertVerticalList(t){return t.reverse().map((t=>{const e=t.text.split("").reverse().join("");return Object.assign(Object.assign({},t),{text:e})}))}clipTextWithSuffix(t,e,i,r,o,n){let s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(""===r)return this.clipText(t,e,i,o);if(0===t.length)return{str:"",width:0};const a=this.measureTextWidth(t,e);if(!s&&a<=i)return{str:t,width:a};const l=this.measureTextWidth(r,e);if(l>i)return{str:"",width:0};if(s&&a+l<=i)return{str:t+r,width:a+l};i-=l;const h=this._clipText(t,e,i,0,t.length-1,n,r);if(o&&h.str!==t){const i=Nr(t,h.str.length);i!==h.str.length&&(h.result=t.substring(0,i),h.width=this.measureTextWidth(h.str,e))}else s&&h.str===t&&(h.result=t+r);return h.str=h.result,h.width+=l,h}};Vr=jr([f()],Vr);var Ur=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};const Kr=Symbol.for("TextMeasureContribution");let $r=class extends Vr{};$r=Ur([f()],$r);const Xr=new class{constructor(t){const i=t||{};i.defaultScope=i.defaultScope||y,this.options=i,this.id=e.GenAutoIncrementId(),this._bindingDictionary=new Map,this._metadataReader=new R}load(t){const e=this._getContainerModuleHelpersFactory()(t.id);t.registry(e.bindFunction,e.unbindFunction,e.isboundFunction,e.rebindFunction)}get(t){const e=this._getNotAllArgs(t,!1);return this._get(e)}getAll(t){const e=this._getAllArgs(t);return this._get(e)}getTagged(t,e,i){const r=this._getNotAllArgs(t,!1,e,i);return this._get(r)}getNamed(t,e){return this.getTagged(t,r,e)}isBound(t){return this._bindingDictionary.has(t)}bind(t){const e=this.options.defaultScope,i=new A(t,e),r=this._bindingDictionary.get(t)||[];return r.push(i),this._bindingDictionary.set(t,r),new P(i)}unbind(t){this._bindingDictionary.delete(t)}rebind(t){return this.unbind(t),this.bind(t)}_getContainerModuleHelpersFactory(){const t=(t,e)=>{t._binding.moduleId=e},e=e=>i=>{const r=this.bind(i);return t(r,e),r},i=()=>t=>this.unbind(t),r=()=>t=>this.isBound(t),o=e=>i=>{const r=this.rebind(i);return t(r,e),r};return t=>({bindFunction:e(t),isboundFunction:r(),rebindFunction:o(t),unbindFunction:i(),unbindAsyncFunction:t=>null})}_getNotAllArgs(t,e,i,r){return{avoidConstraints:!1,isMultiInject:e,serviceIdentifier:t,key:i,value:r}}_getAllArgs(t){return{avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:t}}_get(t){const e=[];return this._bindingDictionary.get(t.serviceIdentifier).filter((e=>e.constraint(t))).forEach((t=>{e.push(this._resolveFromBinding(t))})),t.isMultiInject||1!==e.length?e:e[0]}_getChildRequest(t){const e=t.implementationType,{userGeneratedMetadata:i}=this._metadataReader.getConstructorMetadata(e),r=Object.keys(i),s=[];for(let t=0;t<r.length;t++){const e=i[t],r={};e.forEach((t=>{r[t.key]=t.value}));const a={inject:r[o],multiInject:r[n]},l=a.inject||a.multiInject,h={serviceIdentifier:l,constructorArgsMetadata:e},c={injectIdentifier:l,metadata:e,bindings:this._bindingDictionary.get(l).filter((t=>t.constraint(h)))};s.push(c)}return s}_resolveFromBinding(t){const e=this._getResolvedFromBinding(t);return this._saveToScope(t,e),e}_getResolvedFromBinding(t){let e;switch(t.type){case C:case x:e=t.cache;break;case _:e=this._resolveInstance(t,t.implementationType);break;default:e=t.dynamicValue({container:this})}return e}_resolveInstance(t,e){if(t.activated)return t.cache;const i=this._getChildRequest(t);return this._createInstance(e,i)}_createInstance(t,e){return e.length?new t(...this._resolveRequests(e)):new t}_resolveRequests(t){return t.map((t=>t.bindings.length>1?t.bindings.map((t=>this._resolveFromBinding(t))):this._resolveFromBinding(t.bindings[0])))}_saveToScope(t,e){t.scope===b&&(t.cache=e,t.activated=!0)}},Yr=Symbol.for("CanvasFactory"),qr=Symbol.for("Context2dFactory");function Zr(t){return Xr.getNamed(Yr,kr.global.env)(t)}const Jr=new class{constructor(){this.pools=[],this.allocatedCanvas=[]}shareCanvas(){return this.allocatedCanvas.length?this.allocatedCanvas[0]:this.getCommonCanvas()}getCommonCanvas(){return this._commonCanvas||(this._commonCanvas=this.allocate({width:100,height:100,dpr:2})),this._commonCanvas}allocate(t){if(!this.pools.length){const e=Zr(Object.assign({nativeCanvas:kr.global.createCanvas(t)},t));return this.allocatedCanvas.push(e),e}const e=this.pools.pop();return e.resize(t.width,t.height),e.dpr=t.dpr,e}allocateByObj(t){if(!this.pools.length){const e={width:t.width/t.dpr,height:t.height/t.dpr,dpr:t.dpr},i=Zr(Object.assign({nativeCanvas:kr.global.createCanvas(e)},e));return this.allocatedCanvas.push(i),i}const e=this.pools.pop();return e.width=t.width,e.height=t.height,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(){this.pools=[]}};var Qr=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},to=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};const eo=Symbol.for("VWindow"),io=Symbol.for("WindowHandlerContribution");let ro=class{get width(){if(this._handler){const t=this._handler.getWH();return this._width=t.width}return this._width}get height(){if(this._handler){const t=this._handler.getWH();return this._height=t.height}return this._height}get dpr(){return this._handler.getDpr()}constructor(){this.hooks={onChange:new F(["x","y","width","height"])},this.active=()=>{const t=this.global;t.env&&!this.actived&&(Xr.getNamed(io,t.env).configure(this,t),this.actived=!0)},this._uid=e.GenAutoIncrementId(),this.global=kr.global,this.postInit()}postInit(){this.global.hooks.onSetEnv.tap("window",this.active),this.active()}get style(){var t;return null!==(t=this._handler.getStyle())&&void 0!==t?t:{}}set style(t){this._handler.setStyle(t)}create(t){var e,i;this._handler.createWindow(t);const r=this._handler.getWH();this._width=r.width,this._height=r.height,t.viewBox?this.setViewBox(t.viewBox):!1!==t.canvasControled?this.setViewBox({x1:0,y1:0,x2:this._width,y2:this._height}):this.setViewBox({x1:0,y1:0,x2:null!==(e=t.width)&&void 0!==e?e:this._width,y2:null!==(i=t.height)&&void 0!==i?i:this._height}),this.title=this._handler.getTitle(),this.resizable=!0}setWindowHandler(t){this._handler=t}setDpr(t){return this._handler.setDpr(t)}resize(t,e){return this._handler.resizeWindow(t,e)}configure(){throw new Error("暂不支持")}release(){return this.global.hooks.onSetEnv.unTap("window",this.active),this._handler.releaseWindow()}getContext(){return this._handler.getContext()}getNativeHandler(){return this._handler.getNativeHandler()}getImageBuffer(t){return this._handler.getImageBuffer?this._handler.getImageBuffer(t):null}addEventListener(t,e,i){return this._handler.addEventListener(t,e,i)}removeEventListener(t,e,i){return this._handler.removeEventListener(t,e,i)}dispatchEvent(t){return this._handler.dispatchEvent(t)}getBoundingClientRect(){return this._handler.getBoundingClientRect()}getContainer(){return this._handler.container}clearViewBox(t){this._handler.clearViewBox(t)}setViewBox(t){this._handler.setViewBox(t)}setViewBoxTransform(t,e,i,r,o,n){this._handler.setViewBoxTransform(t,e,i,r,o,n)}getViewBox(){return this._handler.getViewBox()}getViewBoxTransform(){return this._handler.getViewBoxTransform()}pointTransform(t,e){const i=this._handler.getViewBox(),r={x:t,y:e};return this._handler.getViewBoxTransform().transformPoint({x:t,y:e},r),r.x-=i.x1,r.y-=i.y1,r}hasSubView(){const t=this._handler.getViewBox();return!(0===t.x1&&0===t.y1&&this.width===t.width()&&this.height===t.height())}isVisible(t){return this._handler.isVisible(t)}onVisibleChange(t){return this._handler.onVisibleChange(t)}getTopLeft(t){return this._handler.getTopLeft(t)}};ro=Qr([f(),to("design:paramtypes",[])],ro);var oo=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},no=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},so=function(t,e){return function(i,r){e(i,r,t)}};let ao=class{get canvas(){return this.tryInitCanvas(),this._canvas}get context(){return this.tryInitCanvas(),this._context}constructor(t){this.contributions=t,this.configured=!1,this.global=kr.global,this.global.hooks.onSetEnv.tap("graphic-util",((t,e,i)=>{this.configured=!1,this.configure(i,e)}))}get textMeasure(){return this._textMeasure||this.configure(this.global,this.global.env),this._textMeasure}configure(t,e){this.configured||(this.contributions.getContributions().forEach((t=>{t.configure(this,e)})),this.configured=!0)}tryInitCanvas(){if(!this._canvas){const t=Jr.shareCanvas();this._canvas=t,this._context=t.getContext("2d")}}bindTextMeasure(t){this._textMeasure=t}measureText(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"native";var r;this.configure(this.global,this.global.env);const o=this.global.measureTextMethod;this.global.measureTextMethod=i;const n={width:this._textMeasure.measureTextWidth(t,e),height:null!==(r=e.fontSize)&&void 0!==r?r:pr.fontSize};return this.global.measureTextMethod=o,n}createTextMeasureInstance(t,e,i){return this.configure(this.global,this.global.env),new Ke(Object.assign({defaultFontParams:{fontFamily:pr.fontFamily,fontSize:pr.fontSize},getCanvasForMeasure:i||(()=>this.canvas),getTextBounds:void 0,specialCharSet:"-/: .,@%'\"~"+Ke.ALPHABET_CHAR_SET+Ke.ALPHABET_CHAR_SET.toUpperCase()},null!=e?e:{}),t)}drawGraphicToCanvas(t,e,i){if(!e.defaultLayer)return null;const r=Xr.get(eo),o=t.AABBBounds,n=o.width(),s=o.height(),a=-o.x1,l=-o.y1;r.create({viewBox:{x1:a,y1:l,x2:o.x2,y2:o.y2},width:n,height:s,canvas:i,dpr:e.window.dpr,canvasControled:!0,offscreen:!0,title:""});const h=e.params.optimize.disableCheckGraphicWidthOutRange;e.params.optimize.disableCheckGraphicWidthOutRange=!0,e.defaultLayer.getNativeHandler().drawTo(r,[t],{transMatrix:r.getViewBoxTransform(),viewBox:r.getViewBox(),stage:e,layer:e.defaultLayer,renderService:e.renderService,background:"transparent",clear:!0,updateBounds:!1}),e.params.optimize.disableCheckGraphicWidthOutRange=h;const c=r.getNativeHandler();return c.nativeCanvas?c.nativeCanvas:null}};var lo;ao=oo([f(),so(0,g(H)),so(0,m(Kr)),no("design:paramtypes",[Object])],ao),function(t){t[t.transform=0]="transform",t[t.matrix=1]="matrix"}(lo||(lo={}));const ho=new fe;let co=class{constructor(){this.matrix=new fe}init(t){return this.mode=lo.transform,this.originTransform=t,this.matrix.reset(),this}fromMatrix(t,e){return this.mode=lo.matrix,this.outSourceMatrix=t,this.outTargetMatrix=e,this}scaleMatrix(t,e,i){const r=this.outSourceMatrix;if(ho.setValue(r.a,r.b,r.c,r.d,r.e,r.f),this.outTargetMatrix.reset(),i){const{x:r,y:o}=i;this.outTargetMatrix.translate(r,o),this.outTargetMatrix.scale(t,e),this.outTargetMatrix.translate(-r,-o)}else this.outTargetMatrix.scale(t,e);return this.outTargetMatrix.multiply(ho.a,ho.b,ho.c,ho.d,ho.e,ho.f),this}rotateMatrix(t,e){const i=this.outSourceMatrix;if(ho.setValue(i.a,i.b,i.c,i.d,i.e,i.f),this.outTargetMatrix.reset(),e){const{x:i,y:r}=e;this.outTargetMatrix.translate(i,r),this.outTargetMatrix.rotate(t),this.outTargetMatrix.translate(-i,-r)}else this.outTargetMatrix.rotate(t);return this.outTargetMatrix.multiply(ho.a,ho.b,ho.c,ho.d,ho.e,ho.f),this}scale(t,e,i){return this.mode===lo.matrix?this.scaleMatrix(t,e,i):this}rotate(t,e){return this.mode===lo.matrix?this.rotateMatrix(t,e):this}translateMatrix(t,e){const i=this.outSourceMatrix;return ho.setValue(i.a,i.b,i.c,i.d,i.e,i.f),this.outTargetMatrix.reset(),this.outTargetMatrix.translate(t,e),this.outTargetMatrix.multiply(ho.a,ho.b,ho.c,ho.d,ho.e,ho.f),this}translate(t,e){return this.mode===lo.matrix?this.translateMatrix(t,e):this}simplify(t){return this.mode===lo.matrix?this.simplifyMatrix(t):this}simplifyMatrix(t){return this}};co=oo([f(),no("design:paramtypes",[])],co);const uo={arc:yr,area:Cr,circle:wr,line:_r,path:Sr,symbol:Mr,text:Tr,rect:Rr,rect3d:Br,polygon:Ar,richtext:Pr,richtextIcon:Er,image:Hr,group:vr,glyph:xr},go=Object.keys(uo);function po(t,e){Object.keys(e).forEach((i=>{t[i]=e[i]}))}const fo={arc:Object.assign({},uo.arc),area:Object.assign({},uo.area),circle:Object.assign({},uo.circle),line:Object.assign({},uo.line),path:Object.assign({},uo.path),symbol:Object.assign({},uo.symbol),text:Object.assign({},uo.text),rect:Object.assign({},uo.rect),rect3d:Object.assign({},uo.rect3d),polygon:Object.assign({},uo.polygon),richtext:Object.assign({},uo.richtext),richtextIcon:Object.assign({},uo.richtextIcon),image:Object.assign({},uo.image),group:Object.assign({},uo.group),glyph:Object.assign({},uo.glyph)};class mo{constructor(){this.initTheme(),this.dirty=!1}initTheme(){this._defaultTheme={},go.forEach((t=>{this._defaultTheme[t]=Object.create(fo[t])})),this.combinedTheme=this._defaultTheme}getTheme(t){if(!t)return this.combinedTheme;if(!this.dirty)return this.combinedTheme;let e={};const i=this.getParentWithTheme(t);return i&&(e=i.theme),this.applyTheme(t,e),this.combinedTheme}getParentWithTheme(t){for(;t.parent;)if((t=t.parent).theme)return t;return null}applyTheme(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.dirty){const r=this.getParentWithTheme(t);if(r){const t=r.theme;(t.dirty||i)&&t.applyTheme(r,e,!0)}this.userTheme?this.doCombine(r&&r.theme.combinedTheme):(r?this.combinedTheme=r.theme.combinedTheme:(this.combinedTheme=this._defaultTheme,qe.getInstance().warn("未知错误，走到不应该走的区域里")),this.dirty=!1)}return this.combinedTheme}doCombine(t){const e=this.userTheme,i=this.combinedTheme;go.forEach((r=>{const o=Object.create(fo[r]);t&&t[r]&&po(o,t[r]),i[r]&&po(o,i[r]),e[r]&&po(o,e[r]),this.combinedTheme[r]=o})),e.common&&go.forEach((t=>{po(this.combinedTheme[t],e.common)})),this.dirty=!1}setTheme(t,e){let i=this.userTheme;i?Object.keys(t).forEach((e=>{i[e]?Object.assign(i[e],t[e]):i[e]=Object.assign({},t[e])})):i=t,this.userTheme=i,this.dirty=!0,this.dirtyChildren(e)}resetTheme(t,e){this.userTheme=t,this.dirty=!0,this.dirtyChildren(e)}dirtyChildren(t){t.forEachChildren((t=>{t.isContainer&&(t.theme&&(t.theme.dirty=!0),this.dirtyChildren(t))}))}}const bo=new mo;function yo(t,e){return t.glyphHost?yo(t.glyphHost):e?(t.isContainer,e):function(t){let e;if(e=t.isContainer?t:t.parent,e){for(;e&&!e.theme;)e=e.parent;return e?(e.theme||e.createTheme(),e.theme.getTheme(e)):bo.getTheme()}return null}(t)||t.attachedThemeGraphic&&yo(t.attachedThemeGraphic)||bo.getTheme()}var Co=function(t,e,i,r){return new(i||(i=Promise))((function(o,n){function s(t){try{l(r.next(t))}catch(t){n(t)}}function a(t){try{l(r.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((r=r.apply(t,e||[])).next())}))};class wo extends V{get previousSibling(){return this._prev}get nextSibling(){return this._next}get children(){return this.getChildren()}get firstChild(){return this._firstChild}get lastChild(){return this._lastChild}get count(){return this._count}get childrenCount(){return this._idMap?this._idMap.size:0}constructor(){super(),this._uid=e.GenAutoIncrementId(),this._firstChild=null,this._lastChild=null,this.parent=null,this._count=1}forEachChildren(t){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){let e=this._lastChild,i=0;for(;e;){if(t(e,i++))return;e=e._prev}}else{let e=this._firstChild,i=0;for(;e;){if(t(e,i++))return;e=e._next}}}forEachChildrenAsync(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Co(this,void 0,void 0,(function*(){if(e){let e=this._lastChild,i=0;for(;e;){let r=t(e,i++);if(r.then&&(r=yield r),r)return;e=e._prev}}else{let e=this._firstChild,i=0;for(;e;){let r=t(e,i++);if(r.then&&(r=yield r),r)return;e=e._next}}}))}forEach(t){return this.forEachChildren(t)}appendChild(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this._uid===t._uid)return null;if(!e&&t.isAncestorsOf(this))throw new Error("【Node::appendChild】不能将父辈元素append为子元素");return t.parent&&t.parent.removeChild(t),t.parent=this,this._lastChild?(this._lastChild._next=t,t._prev=this._lastChild,this._lastChild=t):(this._firstChild=this._lastChild=t,t._prev=t._next=null),this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this.setCount(t.count),this._structEdit=!0,t}appendChildArrHighPerformance(t){return t}insertBefore(t,e){if(!e)return this.appendChild(t);if(this._uid===t._uid)return null;if(t.isAncestorsOf(this))throw new Error("【Node::insertBefore】不能将父辈元素insert为子元素");return e.parent!==this?null:(t.parent&&t.parent.removeChild(t),t.parent=this,t._prev=e._prev,e._prev?e._prev._next=t:this._firstChild=t,e._prev=t,t._next=e,this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t)}insertAfter(t,e){if(!e)return this.appendChild(t);if(this._uid===t._uid)return null;if(t.isAncestorsOf(this))throw new Error("【Node::insertAfter】不能将父辈元素insert为子元素");return e.parent!==this?null:(t.parent&&t.parent.removeChild(t),t.parent=this,e._next?(e._next._prev=t,t._next=e._next):this._lastChild=t,e._next=t,t._prev=e,this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t)}insertInto(t,e){if(!this._ignoreWarn&&this._nodeList&&qe.getInstance().warn("insertIntoKeepIdx和insertInto混用可能会存在错误"),e>=this.childrenCount)return this.appendChild(t);if(this._uid===t._uid)return null;if(t.isAncestorsOf(this))throw new Error("【Node::insertBefore】不能将父辈元素insert为子元素");if(t.parent&&t.parent.removeChild(t),t.parent=this,0===e)t._next=this._firstChild,this._firstChild&&(this._firstChild._prev=t),t._prev=null,this._firstChild=t;else{let i=this._firstChild;for(let t=0;t<e;t++){if(!i)return null;t>0&&(i=i._next)}if(!i)return null;t._next=i._next,t._prev=i,i._next=t,t._next&&(t._next._prev=t)}return this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t}insertIntoKeepIdx(t,e){if(this._nodeList||(this._nodeList=this.children),this._nodeList[e]){const i=this._nodeList[e];return this._nodeList.splice(e,0,t),this.insertBefore(t,i)}let i;this._nodeList[e]=t;for(let t=e-1;t>=0&&(i=this._nodeList[t],!i);t--);if(i)return i._next?this.insertBefore(t,i._next):this.appendChild(t);this._ignoreWarn=!0;const r=this.insertInto(t,0);return this._ignoreWarn=!1,r}removeChild(t){if(!this._idMap)return null;if(!this._idMap.has(t._uid))return null;if(this._idMap.delete(t._uid),this._nodeList){const e=this._nodeList.findIndex((e=>e===t));e>0&&this._nodeList.splice(e,1)}return t._prev?t._prev._next=t._next:this._firstChild=t._next,t._next?t._next._prev=t._prev:this._lastChild=t._prev,t.parent=null,t._prev=null,t._next=null,this._structEdit=!0,this.setCount(-t.count),t}delete(){this.parent&&this.parent.removeChild(this)}removeAllChild(t){if(!this._idMap)return;let e=this._firstChild;for(;e;){const t=e._next;e.parent=null,e._prev=null,e._next=null,e=e._next,e=t}this._firstChild=null,this._lastChild=null,this._idMap.clear(),this._structEdit=!0,this.setCount(1-this._count)}replaceChild(t,e){throw new Error("暂不支持")}find(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=null;return this.forEachChildren(((e,r)=>!(e===this||!t(e,r)||(i=e,0)))),e&&this.forEachChildren((e=>{if(e.isContainer){const r=e.find(t,!0);if(r)return i=r,!0}return!1})),i}findAll(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=[];return this.forEachChildren(((e,r)=>{e!==this&&t(e,r)&&i.push(e)})),e&&this.forEachChildren((e=>{if(e.isContainer){const r=e.findAll(t,!0);r.length&&(i=i.concat(r))}})),i}getElementById(t){return this.find((e=>e.id===t),!0)}findChildById(t){return this.getElementById(t)}findChildByUid(t){return this._idMap&&this._idMap.get(t)||null}getElementsByName(t){return this.findAll((e=>e.name===t),!0)}findChildrenByName(t){return this.getElementsByName(t)}getElementsByType(t){return this.findAll((e=>e.type===t),!0)}getChildByName(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.find((e=>e.name===t),e)}getChildAt(t){let e=this._firstChild;if(!e)return null;for(let i=0;i<t;i++){if(!e._next)return null;e=e._next}return e}at(t){return this.getChildAt(t)}containNode(t){if(!this._idMap)return!1;if(this._idMap.has(t._uid))return!0;let e=this._firstChild;for(;e;){if(e.containNode(t))return!0;e=e._next}return!1}getRootNode(){let t=this.parent;for(;null==t?void 0:t.parent;)t=t.parent;return t||this}hasChildNodes(){return null!==this._firstChild}addChild(t){return this.appendChild(t)}add(t){return this.appendChild(t)}getChildren(){const t=[];let e=this._firstChild;for(;e;)t.push(e),e=e._next;return t}isChildOf(t){return!!this.parent&&this.parent._uid===t._uid}isParentOf(t){return t.isChildOf(this)}isDescendantsOf(t){let e=this.parent;if(!e)return!1;do{if(e._uid===t._uid)return!0;e=e.parent}while(null!==e);return!1}isAncestorsOf(t){return t.isDescendantsOf(this)}getAncestor(t){throw new Error("暂不支持")}setAllDescendantsProps(t,e){let i=this._firstChild;for(;i;)i[t]=e,i.setAllDescendantsProps(t,e),i=i._next}setCount(t){this._count+=t;let e=this.parent;if(e)do{e._count+=t,e=e.parent}while(null!==e)}clone(){throw new Error("暂不支持")}cloneTo(t){throw new Error("暂不支持")}getParent(){return this.parent}del(t){return this.removeChild(t)}addEventListener(t,e,i){const r=K(i,!0)&&i||q(i)&&i.capture,o=q(i)&&i.once,n=$(e)?void 0:e;return t=r?`${t}capture`:t,e=$(e)?e:e.handleEvent,o?super.once(t,e,n):super.on(t,e,n),this}on(t,e,i){return this.addEventListener(t,e,i)}removeEventListener(t,e,i){const r=K(i,!0)&&i||q(i)&&i.capture,o=$(e)?void 0:e;t=r?`${t}capture`:t,e=$(e)?e:e.handleEvent;const n=q(i)&&i.once;return super.off(t,e,o,n),this}off(t,e,i){return this.removeEventListener(t,e,i)}once(t,e,i){return q(i)?(i.once=!0,this.addEventListener(t,e,i)):this.addEventListener(t,e,{once:!0})}removeAllEventListeners(){return super.removeAllListeners(),this}removeAllListeners(){return this.removeAllEventListeners()}dispatchEvent(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return super.emit(t.type,t,...i),!t.defaultPrevented}emit(t,e){return this.dispatchEvent(t,e)}release(){this.removeAllListeners()}}class vo{get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get x(){return this.canvas.x}get y(){return this.canvas.y}get canvasX(){return this.canvas.x}get canvasY(){return this.canvas.y}get viewX(){return this.viewport.x}get viewY(){return this.viewport.y}constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=vo.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer={x:0,y:0},this.page={x:0,y:0},this.canvas={x:0,y:0},this.viewport={x:0,y:0},this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.stopPropagation(),this.propagationStopped=!0}initEvent(){}initUIEvent(){}clone(){throw new Error("Method not implemented.")}}class xo extends vo{constructor(){super(...arguments),this.client={x:0,y:0},this.movement={x:0,y:0},this.offset={x:0,y:0},this.global={x:0,y:0},this.screen={x:0,y:0}}get clientX(){return this.client.x}get clientY(){return this.client.y}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p){throw new Error("Method not implemented.")}}class _o extends xo{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}clone(){var t,e,i;const r=new _o(this.manager);return r.eventPhase=r.NONE,r.currentTarget=null,r.path=[],r.target=null,r.nativeEvent=this.nativeEvent,r.originalEvent=this.originalEvent,null===(t=this.manager)||void 0===t||t.copyPointerData(this,r),null===(e=this.manager)||void 0===e||e.copyMouseData(this,r),null===(i=this.manager)||void 0===i||i.copyData(this,r),r.target=this.target,r.path=this.composedPath().slice(),r.type=this.type,r}}class So extends xo{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}clone(){var t,e,i;const r=new So(this.manager);return r.eventPhase=r.NONE,r.currentTarget=null,r.path=[],r.target=null,r.nativeEvent=this.nativeEvent,r.originalEvent=this.originalEvent,null===(t=this.manager)||void 0===t||t.copyWheelData(this,r),null===(e=this.manager)||void 0===e||e.copyMouseData(this,r),null===(i=this.manager)||void 0===i||i.copyData(this,r),r.target=this.target,r.path=this.composedPath().slice(),r.type=this.type,r}}So.DOM_DELTA_PIXEL=0,So.DOM_DELTA_LINE=1,So.DOM_DELTA_PAGE=2;class Ao extends vo{constructor(t,e){super(),this.type=t,this.detail=e}}const Ro="object"==typeof performance&&performance.now?performance:Date;function Bo(t){return"mouse"===t||"pen"===t}const Mo={dispatchEvent(t){var e;if(!(t instanceof vo))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=[],t.target=this,null===(e=null==t?void 0:t.manager)||void 0===e||e.dispatchEvent(t),!t.defaultPrevented},emit(t,e){return this.dispatchEvent(new Ao(t,e))}},To={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class Po{constructor(t){this.resolution=1,this.onPointerDown=t=>{if(this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let t=0,i=e.length;t<i;t++){const i=e[t],r=this.bootstrapEvent(this.rootPointerEvent,i);this.manager.mapEvent(r)}this.setCursor(this.manager.cursor,this.manager.cursorTarget)},this.onPointerMove=t=>{if(this.supportsTouchEvents&&"touch"===t.pointerType)return;if(this.isEventOutsideOfTargetElement(t))return;const e=this.normalizeToPointerData(t);for(let t=0,i=e.length;t<i;t++){const i=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.manager.mapEvent(i)}this.setCursor(this.manager.cursor,this.manager.cursorTarget)},this.onPointerUp=t=>{if(this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.isEventOutsideOfTargetViewPort(t)?"outside":"",i=this.normalizeToPointerData(t);for(let t=0,r=i.length;t<r;t++){const r=this.bootstrapEvent(this.rootPointerEvent,i[t]);r.type+=e,this.manager.mapEvent(r)}this.setCursor(this.manager.cursor,this.manager.cursorTarget)},this.onPointerOverOut=t=>{if(this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);for(let t=0,i=e.length;t<i;t++){const i=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.manager.mapEvent(i)}this.setCursor(this.manager.cursor,this.manager.cursorTarget)},this.onWheel=t=>{const e=this.normalizeWheelEvent(t);this.manager.mapEvent(e)};const{targetElement:e,resolution:i,rootNode:r,global:o,autoPreventDefault:n=!1,clickInterval:s,supportsTouchEvents:a=o.supportsTouchEvents,supportsPointerEvents:l=o.supportsPointerEvents}=t;this.manager=new class{constructor(t,e){this.dispatch=new V,this.cursorTarget=null,this.mappingState={trackingData:{}},this.eventPool=new Map,this.onPointerDown=(t,e)=>{if(!(t instanceof _o))return void qe.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const i=this.createPointerEvent(t,t.type,e);if(this.dispatchEvent(i,"pointerdown"),"touch"===i.pointerType)this.dispatchEvent(i,"touchstart");else if(Bo(i.pointerType)){const t=2===i.button;this.dispatchEvent(i,t?"rightdown":"mousedown")}this.trackingData(t.pointerId).pressTargetsByButton[t.button]=i.composedPath(),this.freeEvent(i)},this.onPointerMove=(t,e)=>{var i,r;if(!(t instanceof _o))return void qe.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const o=this.createPointerEvent(t,t.type,e),n=Bo(o.pointerType),s=this.trackingData(t.pointerId),a=this.findMountedTarget(s.overTargets);if(s.overTargets&&a&&a!==this.rootTarget&&a!==o.target){const e="mousemove"===t.type?"mouseout":"pointerout",i=this.createPointerEvent(t,e,a||void 0);if(this.dispatchEvent(i,"pointerout"),n&&this.dispatchEvent(i,"mouseout"),!o.composedPath().includes(a)){const e=this.createPointerEvent(t,"pointerleave",a||void 0);for(e.eventPhase=e.AT_TARGET;e.target&&!o.composedPath().includes(e.target);)e.currentTarget=e.target,this.notifyTarget(e),n&&this.notifyTarget(e,"mouseleave"),e.target=e.target.parent;this.freeEvent(e)}this.freeEvent(i)}if(a!==o.target){const e="mousemove"===t.type?"mouseover":"pointerover",i=this.clonePointerEvent(o,e);this.dispatchEvent(i,"pointerover"),n&&this.dispatchEvent(i,"mouseover");let r=null==a?void 0:a.parent;for(;r&&r!==this.rootTarget.parent&&r!==o.target;)r=r.parent;if(!r||r===this.rootTarget.parent){const t=this.clonePointerEvent(o,"pointerenter");t.eventPhase=t.AT_TARGET;let e=t.target;const i=new Set;let r=a;for(;r&&r!==this.rootTarget;)i.add(r),r=r.parent;for(;e&&e!==a&&e!==this.rootTarget.parent;)i.has(e)||(t.currentTarget=e,this.notifyTarget(t),n&&this.notifyTarget(t,"mouseenter")),e=e.parent;this.freeEvent(t)}this.freeEvent(i)}this.dispatchEvent(o,"pointermove"),"touch"===o.pointerType&&this.dispatchEvent(o,"touchmove"),n&&(this.dispatchEvent(o,"mousemove"),this.cursorTarget=o.target,this.cursor=(null===(r=null===(i=o.target)||void 0===i?void 0:i.attribute)||void 0===r?void 0:r.cursor)||this.rootTarget.getCursor()),s.overTargets=o.composedPath(),this.freeEvent(o)},this.onPointerOver=(t,e)=>{var i,r;if(!(t instanceof _o))return void qe.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const o=this.trackingData(t.pointerId),n=this.createPointerEvent(t,t.type,e),s=Bo(n.pointerType);this.dispatchEvent(n,"pointerover"),s&&this.dispatchEvent(n,"mouseover"),"mouse"===n.pointerType&&(this.cursorTarget=n.target,this.cursor=(null===(r=null===(i=n.target)||void 0===i?void 0:i.attribute)||void 0===r?void 0:r.cursor)||this.rootTarget.getCursor());const a=this.clonePointerEvent(n,"pointerenter");for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==this.rootTarget.parent;)a.currentTarget=a.target,this.notifyTarget(a),s&&this.notifyTarget(a,"mouseenter"),a.target=a.target.parent;o.overTargets=n.composedPath(),this.freeEvent(n),this.freeEvent(a)},this.onPointerOut=(t,e)=>{if(!(t instanceof _o))return void qe.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const i=this.trackingData(t.pointerId);if(i.overTargets){const e=Bo(t.pointerType),r=this.findMountedTarget(i.overTargets),o=this.createPointerEvent(t,"pointerout",r||void 0);this.dispatchEvent(o),e&&this.dispatchEvent(o,"mouseout");const n=this.createPointerEvent(t,"pointerleave",r||void 0);for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),e&&this.notifyTarget(n,"mouseleave"),n.target=n.target.parent;i.overTargets=[],this.freeEvent(o),this.freeEvent(n)}this.cursorTarget=null,this.cursor=""},this.onPointerUp=(t,e)=>{var i;if(!(t instanceof _o))return void qe.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const r=Ro.now(),o=this.createPointerEvent(t,t.type,e);if(this.dispatchEvent(o,"pointerup"),"touch"===o.pointerType)this.dispatchEvent(o,"touchend");else if(Bo(o.pointerType)){const t=2===o.button;this.dispatchEvent(o,t?"rightup":"mouseup")}const n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.pressTargetsByButton[t.button]);let a=s;if(s&&!o.composedPath().includes(s)){let e=s;for(;e&&!o.composedPath().includes(e);){if(o.currentTarget=e,this.notifyTarget(o,"pointerupoutside"),"touch"===o.pointerType)this.notifyTarget(o,"touchendoutside");else if(Bo(o.pointerType)){const t=2===o.button;this.notifyTarget(o,t?"rightupoutside":"mouseupoutside")}e=e.parent}delete n.pressTargetsByButton[t.button],a=e}if(a){const e=this.clonePointerEvent(o,"click");e.target=a,e.path=[],n.clicksByButton[t.button]||(n.clicksByButton[t.button]={clickCount:0,target:e.target,timeStamp:r});const s=n.clicksByButton[t.button];s.target===e.target&&r-s.timeStamp<(null!==(i=this._config.clickInterval)&&void 0!==i?i:200)?++s.clickCount:s.clickCount=1,s.target=e.target,s.timeStamp=r,e.detail=s.clickCount,Bo(e.pointerType)?(this.dispatchEvent(e,"click"),2===s.clickCount&&this.dispatchEvent(e,"dblclick")):"touch"===e.pointerType&&(this.dispatchEvent(e,"tap"),2===s.clickCount&&this.dispatchEvent(e,"dbltap")),this.dispatchEvent(e,"pointertap"),this.freeEvent(e)}this.freeEvent(o)},this.onPointerUpOutside=(t,e)=>{if(!(t instanceof _o))return void qe.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const i=this.trackingData(t.pointerId),r=this.findMountedTarget(i.pressTargetsByButton[t.button]),o=this.createPointerEvent(t,t.type,e);if(r){let e=r;for(;e;)o.currentTarget=e,this.notifyTarget(o,"pointerupoutside"),"touch"===o.pointerType?this.notifyTarget(o,"touchendoutside"):Bo(o.pointerType)&&this.notifyTarget(o,2===o.button?"rightupoutside":"mouseupoutside"),e=e.parent;delete i.pressTargetsByButton[t.button]}this.freeEvent(o)},this.onWheel=(t,e)=>{if(!(t instanceof So))return void qe.getInstance().warn("EventManager cannot map a non-wheel event as a wheel event");const i=this.createWheelEvent(t,e);this.dispatchEvent(i),this.freeEvent(i)},this.rootTarget=t,this.mappingTable={},this._config=Object.assign({clickInterval:200},e),this.addEventMapping("pointerdown",this.onPointerDown),this.addEventMapping("pointermove",this.onPointerMove),this.addEventMapping("pointerout",this.onPointerOut),this.addEventMapping("pointerleave",this.onPointerOut),this.addEventMapping("pointerover",this.onPointerOver),this.addEventMapping("pointerup",this.onPointerUp),this.addEventMapping("pointerupoutside",this.onPointerUpOutside),this.addEventMapping("wheel",this.onWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort(((t,e)=>t.priority-e.priority))}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){var e,i,r,o,n,s,a;if(!this.rootTarget)return;const l=this.mappingTable[t.type];let h;const c=`${t.canvasX}-${t.canvasY}`;if((null===(e=this._prePointTargetCache)||void 0===e?void 0:e[c])&&(null===(r=null===(i=this._prePointTargetCache)||void 0===i?void 0:i[c])||void 0===r?void 0:r.stage)&&(null===(n=null===(o=this._prePointTargetCache)||void 0===o?void 0:o[c])||void 0===n?void 0:n.stage.renderCount)===(null===(s=this._prePointTargetCache)||void 0===s?void 0:s.stageRenderCount)?h=this._prePointTargetCache[c]:(h=this.pickTarget(t.viewX,t.viewY,t),t.pickParams||(this._prePointTargetCache={[c]:h,stageRenderCount:null!==(a=null==h?void 0:h.stage.renderCount)&&void 0!==a?a:-1})),l)for(let e=0,i=l.length;e<i;e++)l[e].fn(t,h);else qe.getInstance().warn(`[EventManager]: Event mapping not defined for ${t.type}`)}propagate(t,e){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let r=0,o=i.length-1;r<o;r++)if(t.currentTarget=i[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let r=i.length-2;r>=0;r--)if(t.currentTarget=i[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}propagationPath(t){const e=[t];for(let i=0;i<2048&&t!==this.rootTarget&&t.parent;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}notifyTarget(t,e){e=null!=e?e:t.type;const i=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,i),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){var r,o;const n=this.allocateEvent(_o);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=i||this.pickTarget(null!==(r=n.viewX)&&void 0!==r?r:n.global.x,null!==(o=n.viewY)&&void 0!==o?o:n.global.y,n),"string"==typeof e&&(n.type=e),n}createWheelEvent(t,e){var i,r;const o=this.allocateEvent(So);return this.copyWheelData(t,o),this.copyMouseData(t,o),this.copyData(t,o),o.nativeEvent=t.nativeEvent,o.originalEvent=t,o.target=e||this.pickTarget(null!==(i=o.viewX)&&void 0!==i?i:o.global.x,null!==(r=o.viewY)&&void 0!==r?r:o.global.y,o),o}clonePointerEvent(t,e){const i=this.allocateEvent(_o);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=null!=e?e:i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof _o&&e instanceof _o&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof xo&&e instanceof xo&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.ctrlKey=t.ctrlKey,e.shiftKey=t.shiftKey,e.metaKey=t.metaKey,["client","movement","canvas","screen","global","offset","viewport"].forEach((i=>{e[i].x=t[i].x,e[i].y=t[i].y})))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=Ro.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.x=t.layer.x,e.layer.y=t.layer.y,e.page.x=t.page.x,e.page.y=t.page.y,e.pickParams=t.pickParams}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){var e;this.eventPool.has(t)||this.eventPool.set(t,[]);const i=(null===(e=this.eventPool.get(t))||void 0===e?void 0:e.pop())||new t(this);return i.eventPhase=i.NONE,i.currentTarget=null,i.path=[],i.target=null,i}freeEvent(t){var e;if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventManager!");const i=t.constructor;this.eventPool.has(i)||this.eventPool.set(i,[]),null===(e=this.eventPool.get(i))||void 0===e||e.push(t)}notifyListeners(t,e){const i=t.currentTarget._events[e];if(i)if("fn"in i)i.once&&t.currentTarget.removeEventListener(e,i.fn,{once:!0}),i.fn.call(i.context,t);else for(let r=0,o=i.length;r<o&&!t.propagationImmediatelyStopped;r++)i[r].once&&t.currentTarget.removeEventListener(e,i[r].fn,{once:!0}),i[r].fn.call(i[r].context,t);this.emitDelegation(t,e)}emitDelegation(t,e){const i=t.currentTarget._events["*"];if(i)if("fn"in i)i.fn.call(i.context,t,e);else for(let r=0,o=i.length;r<o&&!t.propagationImmediatelyStopped;r++)i[r].fn.call(i[r].context,t,e)}pickTarget(t,e,i){let r;const o=this.rootTarget.pick(t,e);return r=o&&o.graphic?o.graphic:o&&o.group?o.group:this.rootTarget.AABBBounds.contains(t,e)?this.rootTarget:null,i&&(i.pickParams=o.params),r}release(){this.dispatch.removeAllListeners(),this.eventPool.clear(),this.rootTarget=null,this.mappingTable=null,this.mappingState=null,this.cursorTarget=null}}(r,{clickInterval:s}),this.globalObj=o,this.supportsPointerEvents=l,this.supportsTouchEvents=a,this.supportsMouseEvents=o.supportsMouseEvents,this.applyStyles=o.applyStyles,this.autoPreventDefault=n,this.eventsAdded=!1,this.rootPointerEvent=new _o,this.rootWheelEvent=new So,this.cursorStyles={default:"inherit",pointer:"pointer"},this.resolution=i,this.setTargetElement(e)}release(){this.removeEvents(),this.manager&&this.manager.release(),this.domElement=null,this.manager=null,this.globalObj=null}setCursor(t,e){if(!e&&!this.manager.rootTarget.window._handler.canvas.controled)return;t||(t="default");const{applyStyles:i,domElement:r}=this;if(this.currentCursor===t)return;this.currentCursor=t;const o=this.cursorStyles[t];o?"string"==typeof o&&i?r.style.cursor=o:"function"==typeof o?o(t):"object"==typeof o&&i&&Object.assign(r.style,o):i&&tt(t)&&!ft(this.cursorStyles,t)&&(r.style.cursor=t)}setTargetElement(t){this.removeEvents(),this.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const{globalObj:t,domElement:e}=this;this.supportsPointerEvents?(t.getDocument()?(t.getDocument().addEventListener("pointermove",this.onPointerMove,!0),t.getDocument().addEventListener("pointerup",this.onPointerUp,!0)):(e.addEventListener("pointermove",this.onPointerMove,!0),e.addEventListener("pointerup",this.onPointerUp,!0)),e.addEventListener("pointerdown",this.onPointerDown,!0),e.addEventListener("pointerleave",this.onPointerOverOut,!0),e.addEventListener("pointerover",this.onPointerOverOut,!0)):(t.getDocument()?(t.getDocument().addEventListener("mousemove",this.onPointerMove,!0),t.getDocument().addEventListener("mouseup",this.onPointerUp,!0)):(e.addEventListener("mousemove",this.onPointerMove,!0),e.addEventListener("mouseup",this.onPointerUp,!0)),e.addEventListener("mousedown",this.onPointerDown,!0),e.addEventListener("mouseout",this.onPointerOverOut,!0),e.addEventListener("mouseover",this.onPointerOverOut,!0)),this.supportsTouchEvents&&(e.addEventListener("touchstart",this.onPointerDown,!0),e.addEventListener("touchend",this.onPointerUp,!0),e.addEventListener("touchmove",this.onPointerMove,!0)),e.addEventListener("wheel",this.onWheel,{capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;const{globalObj:t,domElement:e}=this;this.supportsPointerEvents?(t.getDocument()?(t.getDocument().removeEventListener("pointermove",this.onPointerMove,!0),t.getDocument().removeEventListener("pointerup",this.onPointerUp,!0)):(e.removeEventListener("pointermove",this.onPointerMove,!0),e.removeEventListener("pointerup",this.onPointerUp,!0)),e.removeEventListener("pointerdown",this.onPointerDown,!0),e.removeEventListener("pointerleave",this.onPointerOverOut,!0),e.removeEventListener("pointerover",this.onPointerOverOut,!0)):(t.getDocument()?(t.getDocument().removeEventListener("mousemove",this.onPointerMove,!0),t.getDocument().removeEventListener("mouseup",this.onPointerUp,!0)):(e.removeEventListener("mousemove",this.onPointerMove,!0),e.removeEventListener("mouseup",this.onPointerUp,!0)),e.removeEventListener("mousedown",this.onPointerDown,!0),e.removeEventListener("mouseout",this.onPointerOverOut,!0),e.removeEventListener("mouseover",this.onPointerOverOut,!0)),this.supportsTouchEvents&&(e.removeEventListener("touchstart",this.onPointerDown,!0),e.removeEventListener("touchend",this.onPointerUp,!0),e.removeEventListener("touchmove",this.onPointerMove,!0)),e.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapToViewportPoint(t){return this.domElement.pointTransform?this.domElement.pointTransform(t.x,t.y):t}mapToCanvasPoint(t){var e,i;const r=null===(e=this.globalObj)||void 0===e?void 0:e.mapToCanvasPoint(t,this.domElement);if(r)return r;let o=0,n=0;if(t.changedTouches){const e=null!==(i=t.changedTouches[0])&&void 0!==i?i:{};o=e.clientX||0,n=e.clientY||0}else o=t.clientX||0,n=t.clientY||0;const s=this.domElement.getBoundingClientRect();return{x:o-s.left,y:n-s.top}}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t.changedTouches&&t.changedTouches.length)for(let i=0,r=t.changedTouches.length;i<r;i++){const r=t.changedTouches[i];Q(r.button)&&(r.button=0),Q(r.buttons)&&(r.buttons=1),Q(r.isPrimary)&&(r.isPrimary=1===t.touches.length&&"touchstart"===t.type),Q(r.width)&&(r.width=r.radiusX||1),Q(r.height)&&(r.height=r.radiusY||1),Q(r.tiltX)&&(r.tiltX=0),Q(r.tiltY)&&(r.tiltY=0),Q(r.pointerType)&&(r.pointerType="touch"),Q(r.pointerId)&&(r.pointerId=r.identifier||0),Q(r.pressure)&&(r.pressure=r.force||.5),Q(r.twist)&&(r.twist=0),Q(r.tangentialPressure)&&(r.tangentialPressure=0),Q(r.layerX)&&(r.layerX=r.offsetX=r.clientX),Q(r.layerY)&&(r.layerY=r.offsetY=r.clientY),r.isNormalized=!0,r.type=t.type,e.push(r)}else if(!this.globalObj.supportsMouseEvents||t instanceof MouseEvent&&!(this.supportsPointerEvents&&t instanceof PointerEvent)){const i=t;Q(i.isPrimary)&&(i.isPrimary=!0),Q(i.width)&&(i.width=1),Q(i.height)&&(i.height=1),Q(i.tiltX)&&(i.tiltX=0),Q(i.tiltY)&&(i.tiltY=0),Q(i.pointerType)&&(i.pointerType="mouse"),Q(i.pointerId)&&(i.pointerId=1),Q(i.pressure)&&(i.pressure=.5),Q(i.twist)&&(i.twist=0),Q(i.tangentialPressure)&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;this.transferMouseData(e,t),e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ;const{x:i,y:r}=this.mapToCanvasPoint(t);e.canvas.x=i,e.canvas.y=r,e.global.x=i,e.global.y=r,e.offset.x=i,e.offset.y=r;const{x:o,y:n}=this.mapToViewportPoint(e);return e.viewport.x=o,e.viewport.y=n,e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e);const{x:i,y:r}=this.mapToCanvasPoint(e);t.canvas.x=i,t.canvas.y=r,t.global.x=i,t.global.y=r,t.offset.x=i,t.offset.y=r;const{x:o,y:n}=this.mapToViewportPoint(t);return t.viewport.x=o,t.viewport.y=n,t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=To[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=Ro.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.shiftKey=e.shiftKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null}isEventOutsideOfTargetViewPort(t){if(this.isEventOutsideOfTargetElement(t))return!0;if(this.domElement.getViewBox){const e=this.mapToViewportPoint(this.mapToCanvasPoint(t)),i=this.domElement.getViewBox(),r=i.width(),o=i.height();return!(e.x<r&&e.y<o&&e.x>0&&e.y>0)}return!1}isEventOutsideOfTargetElement(t){let e=t.target;return t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]),e!==(this.domElement.getNativeHandler?this.domElement.getNativeHandler().nativeCanvas:this.domElement)}}class Ho{constructor(){this.time=0}static Avaliable(){return!0}avaliable(){return Ho.Avaliable()}tick(t,e){this.time=Math.max(0,t+this.time),e(this,{once:!0})}tickTo(t,e){this.time=Math.max(0,t),e(this,{once:!0})}release(){this.timerId>0&&(this.timerId=-1)}getTime(){return this.time}}class Eo{static Avaliable(){return!0}avaliable(){return Eo.Avaliable()}tick(t,e){this.timerId=setTimeout((()=>{e(this)}),t)}release(){this.timerId>0&&(clearTimeout(this.timerId),this.timerId=-1)}getTime(){return Date.now()}}class ko{static Avaliable(){return!!kr.global.getRequestAnimationFrame()}avaliable(){return ko.Avaliable()}tick(t,e){kr.global.getRequestAnimationFrame()((()=>{this.released||e(this)}))}release(){this.released=!0}getTime(){return Date.now()}}var Lo;!function(t){t[t.INITIAL=0]="INITIAL",t[t.RUNNING=1]="RUNNING",t[t.PAUSE=2]="PAUSE"}(Lo||(Lo={}));class Fo{constructor(){}static linear(t){return t}static none(){return this.linear}static get(t){return t<-1?t=-1:t>1&&(t=1),function(e){return 0===t?e:t<0?e*(e*-t+1+t):e*((2-e)*t+(1-t))}}static getPowIn(t){return function(e){return Math.pow(e,t)}}static getPowOut(t){return function(e){return 1-Math.pow(1-e,t)}}static getPowInOut(t){return function(e){return(e*=2)<1?.5*Math.pow(e,t):1-.5*Math.abs(Math.pow(2-e,t))}}static getBackIn(t){return function(e){return e*e*((t+1)*e-t)}}static getBackOut(t){return function(e){return--e*e*((t+1)*e+t)+1}}static getBackInOut(t){return t*=1.525,function(e){return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}}static sineIn(t){return 1-Math.cos(t*Math.PI/2)}static sineOut(t){return Math.sin(t*Math.PI/2)}static sineInOut(t){return-(Math.cos(Math.PI*t)-1)/2}static expoIn(t){return 0===t?0:Math.pow(2,10*t-10)}static expoOut(t){return 1===t?1:1-Math.pow(2,-10*t)}static expoInOut(t){return 0===t?0:1===t?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}static circIn(t){return-(Math.sqrt(1-t*t)-1)}static circOut(t){return Math.sqrt(1- --t*t)}static circInOut(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}static bounceOut(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}static bounceIn(t){return 1-Fo.bounceOut(1-t)}static bounceInOut(t){return t<.5?.5*Fo.bounceIn(2*t):.5*Fo.bounceOut(2*t-1)+.5}static getElasticIn(t,e){return function(i){if(0===i||1===i)return i;const r=e/qt*Math.asin(1/t);return-t*Math.pow(2,10*(i-=1))*Math.sin((i-r)*qt/e)}}static getElasticOut(t,e){return function(i){if(0===i||1===i)return i;const r=e/qt*Math.asin(1/t);return t*Math.pow(2,-10*i)*Math.sin((i-r)*qt/e)+1}}static getElasticInOut(t,e){return function(i){const r=e/qt*Math.asin(1/t);return(i*=2)<1?t*Math.pow(2,10*(i-=1))*Math.sin((i-r)*qt/e)*-.5:t*Math.pow(2,-10*(i-=1))*Math.sin((i-r)*qt/e)*.5+1}}}Fo.quadIn=Fo.getPowIn(2),Fo.quadOut=Fo.getPowOut(2),Fo.quadInOut=Fo.getPowInOut(2),Fo.cubicIn=Fo.getPowIn(3),Fo.cubicOut=Fo.getPowOut(3),Fo.cubicInOut=Fo.getPowInOut(3),Fo.quartIn=Fo.getPowIn(4),Fo.quartOut=Fo.getPowOut(4),Fo.quartInOut=Fo.getPowInOut(4),Fo.quintIn=Fo.getPowIn(5),Fo.quintOut=Fo.getPowOut(5),Fo.quintInOut=Fo.getPowInOut(5),Fo.backIn=Fo.getBackIn(1.7),Fo.backOut=Fo.getBackOut(1.7),Fo.backInOut=Fo.getBackInOut(1.7),Fo.elasticIn=Fo.getElasticIn(1,.3),Fo.elasticOut=Fo.getElasticOut(1,.3),Fo.elasticInOut=Fo.getElasticInOut(1,.3*1.5);class Io{constructor(){this.id=e.GenAutoIncrementId(),this.animateHead=null,this.animateTail=null,this.animateCount=0,this.paused=!1}addAnimate(t){this.animateTail?(this.animateTail.nextAnimate=t,t.prevAnimate=this.animateTail,this.animateTail=t,t.nextAnimate=null):(this.animateHead=t,this.animateTail=t),this.animateCount++}pause(){this.paused=!0}resume(){this.paused=!1}tick(t){if(this.paused)return;let e=this.animateHead;for(this.animateCount=0;e;)e.status===vi.END?this.removeAnimate(e):e.status===vi.RUNNING||e.status===vi.INITIAL?(this.animateCount++,e.advance(t)):e.status===vi.PAUSED&&this.animateCount++,e=e.nextAnimate}clear(){let t=this.animateHead;for(;t;)t.release(),t=t.nextAnimate;this.animateHead=null,this.animateTail=null,this.animateCount=0}removeAnimate(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t._onRemove&&t._onRemove.forEach((t=>t())),t===this.animateHead?(this.animateHead=t.nextAnimate,t===this.animateTail?this.animateTail=null:this.animateHead.prevAnimate=null):t===this.animateTail?(this.animateTail=t.prevAnimate,this.animateTail.nextAnimate=null):(t.prevAnimate.nextAnimate=t.nextAnimate,t.nextAnimate.prevAnimate=t.prevAnimate),e&&t.release()}}const zo=new Io;class Oo{constructor(t,e,i,r,o){this.from=t,this.to=e,this.duration=i,this.easing=r,this.params=o,this.updateCount=0}bind(t,e){this.target=t,this.subAnimate=e,this.onBind()}onBind(){}onFirstRun(){}onStart(){}onEnd(){}getEndProps(){}getFromProps(){return this.from}getMergedEndProps(){var t;const e=this.getEndProps();return e?this._endProps===e?this._mergedEndProps:(this._endProps=e,void(this._mergedEndProps=Object.assign({},null!==(t=this.step.prev.getLastProps())&&void 0!==t?t:{},e))):this.step.prev?this.step.prev.getLastProps():e}update(t,e,i){if(0===this.updateCount){this.onFirstRun();const t=this.step.getLastProps();Object.keys(t).forEach((e=>{this.subAnimate.animate.validAttr(e)&&(i[e]=t[e])}))}this.updateCount+=1,this.onUpdate(t,e,i),t&&this.onEnd()}}class Do extends Oo{constructor(t){super(null,null,0,"linear"),this.cb=t}onUpdate(t,e,i){}onStart(){this.cb()}}class Wo{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.GenAutoIncrementId(),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:zo;this.id=t,this.timeline=i,this.status=vi.INITIAL,this.tailAnimate=new No(this),this.subAnimates=[this.tailAnimate],this.timeScale=1,this.rawPosition=-1,this._startTime=0,this._duringTime=0,this.timeline.addAnimate(this)}setTimeline(t){t!==this.timeline&&(this.timeline.removeAnimate(this,!1),t.addAnimate(this))}getStartTime(){return this._startTime}getDuration(){return this.subAnimates.reduce(((t,e)=>t+e.totalDuration),0)}after(t){const e=t.getDuration();return this._startTime=e,this}afterAll(t){let e=-1/0;return t.forEach((t=>{e=te(t.getDuration(),e)})),this._startTime=e,this}parallel(t){return this._startTime=t.getStartTime(),this}static AddInterpolate(t,e){Wo.interpolateMap.set(t,e)}play(t){if(this.tailAnimate.play(t),this.target){const t=this.target.stage;t&&t.renderNextFrame()}return 1===this.subAnimates.length&&this.tailAnimate.duration===t.duration&&this.trySetAttribute(t.getFromProps(),t.mode),this}trySetAttribute(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Wo.mode;t&&e&xi.SET_ATTR_IMMEDIATELY&&this.target.setAttributes&&this.target.setAttributes(t,!1,{type:wi.ANIMATE_PLAY})}runCb(t){const e=new Do((()=>{t(this,e.step.prev)}));return this.tailAnimate.play(e),this}customInterpolate(t,e,i,r,o,n){const s=Wo.interpolateMap.get(t)||Wo.interpolateMap.get("");return!!s&&s(t,e,i,r,o,n)}pause(){this.status===vi.RUNNING&&(this.status=vi.PAUSED)}resume(){this.status===vi.PAUSED&&(this.status=vi.RUNNING)}to(t,e,i,r){if(this.tailAnimate.to(t,e,i,r),this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this}from(t,e,i,r){if(this.tailAnimate.from(t,e,i,r),this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this}wait(t){if(this.tailAnimate.wait(t),this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this}startAt(t){if(this.tailAnimate.startAt(t),this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this}loop(t){if(this.tailAnimate.loop=t,this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this}reversed(t){if(this.tailAnimate.reversed=t,this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this}bounce(t){if(this.tailAnimate.bounce=t,this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this}subAnimate(){const t=new No(this,this.tailAnimate);return this.tailAnimate=t,this.subAnimates.push(t),t.bind(this.target),this}getStartProps(){return this.subAnimates[0].getStartProps()}getEndProps(){return this.tailAnimate.getEndProps()}depreventAttr(t){this._preventAttrs&&this._preventAttrs.delete(t)}preventAttr(t){this._preventAttrs||(this._preventAttrs=new Set),this._preventAttrs.add(t)}preventAttrs(t){t.forEach((t=>this.preventAttr(t)))}validAttr(t){return!this._preventAttrs||!this._preventAttrs.has(t)}bind(t){return this.target=t,this.target.onAnimateBind&&this.target.onAnimateBind(this),this.subAnimates.forEach((e=>{e.bind(t)})),this}advance(t){if(this._duringTime<this._startTime){if(this._duringTime+t*this.timeScale<this._startTime)return void(this._duringTime+=t*this.timeScale);t=this._duringTime+t*this.timeScale-this._startTime,this._duringTime=this._startTime}this.status===vi.INITIAL&&(this.status=vi.RUNNING,this._onStart&&this._onStart.forEach((t=>t()))),this.setPosition(this.rawPosition+t*this.timeScale)&&this.status===vi.RUNNING&&(this.status=vi.END,this._onEnd&&this._onEnd.forEach((t=>t())))}setPosition(t){let e,i=0;const r=this.rawPosition,o=this.subAnimates.reduce(((t,e)=>t+e.totalDuration),0);t<0&&(t=0);const n=t>=o;if(n&&(t=o),t===r)return n;for(let r=0;r<this.subAnimates.length&&(e=this.subAnimates[r],!(i+e.totalDuration>=t));r++)i+=e.totalDuration,e=void 0;return this.rawPosition=t,e.setPosition(t-i),n}onStart(t){this._onStart||(this._onStart=[]),this._onStart.push(t)}onEnd(t){this._onEnd||(this._onEnd=[]),this._onEnd.push(t)}onRemove(t){this._onRemove||(this._onRemove=[]),this._onRemove.push(t)}onFrame(t){this._onFrame||(this._onFrame=[]),this._onFrame.push(t)}release(){this.status=vi.END}stop(t){t||this.target.onStop(),"start"===t?this.target.onStop(this.getStartProps()):"end"===t?this.target.onStop(this.getEndProps()):this.target.onStop(t),this.release()}}Wo.mode=xi.NORMAL,Wo.interpolateMap=new Map;class No{get totalDuration(){return this.calcAttr(),this._totalDuration+this._startAt}constructor(t,e){this.rawPosition=-1,this.position=0,this.loop=0,this.duration=0,this.animate=t,this.stepHead=new Go(0,0,e?Object.assign({},e.stepTail.props):{}),this.stepTail=this.stepHead,this.dirty=!0,this._startAt=0}calcAttr(){this.dirty&&(this._totalDuration=this.duration*(this.loop+1))}bind(t){return this.target=t,this}play(t){let e=t.duration;(null==e||e<0)&&(e=0);const i=t.easing,r="string"==typeof i?Fo[i]:i,o=this._addStep(e,null,r);return o.type=_i.customAnimate,this._appendProps(t.getEndProps(),o,!1),this._appendCustomAnimate(t,o),this}to(t,e,i,r){(null==e||e<0)&&(e=0);const o="string"==typeof i?Fo[i]:i,n=this._addStep(e,null,o);return n.type=_i.to,this._appendProps(t,n,!!r&&r.tempProps),n.propKeys||(n.propKeys=Object.keys(n.props)),r&&r.noPreventAttrs||this.target.animates.forEach((t=>{t.id!==this.animate.id&&t.preventAttrs(n.propKeys)})),this}from(t,e,i,r){this.to(t,0,i,r);const o={};this.stepTail.propKeys||(this.stepTail.propKeys=Object.keys(this.stepTail.props)),this.stepTail.propKeys.forEach((t=>{o[t]=this.getLastPropByName(t,this.stepTail)})),this.to(o,e,i,r),this.stepTail.type=_i.from}startAt(t){return t<0&&(t=0),this._startAt=t,this}getStartProps(){var t;return null===(t=this.stepHead)||void 0===t?void 0:t.props}getEndProps(){return this.stepTail.props}getLastStep(){return this._lastStep}wait(t){if(t>0){const e=this._addStep(+t,null);e.type=_i.wait,e.prev.customAnimate?e.props=e.prev.customAnimate.getEndProps():e.props=e.prev.props,this.target.onAddStep&&this.target.onAddStep(e)}return this}_addStep(t,e,i){const r=new Go(this.duration,t,e,i);return this.duration+=t,this.stepTail.append(r),this.stepTail=r,r}_appendProps(t,e,i){e.props=i?t:Object.assign({},t);let r=e.prev;const o=e.props;for(e.propKeys||(e.propKeys=Object.keys(e.props)),e.propKeys.forEach((t=>{void 0===e.props[t]&&(e.props[t]=this.target.getDefaultAttribute(t))}));r.prev;)r.props&&(r.propKeys||(r.propKeys=Object.keys(r.props)),r.propKeys.forEach((t=>{void 0===o[t]&&(o[t]=r.props[t])}))),e.propKeys=Object.keys(e.props),r=r.prev;const n=this.stepHead.props;e.propKeys||(e.propKeys=Object.keys(o)),e.propKeys.forEach((t=>{if(void 0===n[t]){const e=this.animate.getStartProps();n[t]=e[t]=this.target.getComputedAttribute(t)}})),this.target.onAddStep&&this.target.onAddStep(e)}_appendCustomAnimate(t,e){e.customAnimate=t,t.step=e,t.bind(this.target,this)}setPosition(t){var e;const i=this.duration,r=this.loop,o=this.rawPosition;let n,s,a=!1;const l=null!==(e=this._startAt)&&void 0!==e?e:0;if(t<0&&(t=0),t<l)return this.rawPosition=t,!1;if(t-=l,i<=0)return a=!0,a;if(n=Math.floor(t/i),s=t-n*i,a=t>=r*i+i,a&&(s=i,n=r,t=s*n+i),t===o)return a;const h=!this.reversed!=!(this.bounce&&n%2);return h&&(s=i-s),this._deltaPosition=s-this.position,this.position=s,this.rawPosition=t+l,this.updatePosition(a,h),a}updatePosition(t,e){if(!this.stepHead)return;let i=this.stepHead.next;const r=this.position,o=this.duration;if(this.target&&i){let n=i.next;for(;n&&n.position<=r;)i=n,n=i.next;let s=t?0===o?1:r/o:(r-i.position)/i.duration;i.easing&&(s=i.easing(s)),this.tryCallCustomAnimateLifeCycle(i,this._lastStep||(e?this.stepTail:this.stepHead),e),this.updateTarget(i,s,t),this._lastStep=i,this.animate._onFrame&&this.animate._onFrame.forEach((t=>t(i,s)))}}tryCallCustomAnimateLifeCycle(t,e,i){if(t!==e)if(i){let i=e.prev;for(;i&&i!==t;)i.customAnimate&&(i.customAnimate.onStart&&i.customAnimate.onStart(),i.customAnimate.onEnd&&i.customAnimate.onEnd()),i=t.prev;e&&e.customAnimate&&e.customAnimate.onEnd&&e.customAnimate.onEnd(),t&&t.customAnimate&&t.customAnimate.onStart&&t.customAnimate.onStart()}else{let i=e.next;for(;i&&i!==t;)i.customAnimate&&(i.customAnimate.onStart&&i.customAnimate.onStart(),i.customAnimate.onEnd&&i.customAnimate.onEnd()),i=i.next;e&&e.customAnimate&&e.customAnimate.onEnd&&e.customAnimate.onEnd(),t&&t.customAnimate&&t.customAnimate.onStart&&t.customAnimate.onStart()}}getLastPropByName(t,e){let i=e.prev;for(;i;){if(i.props&&void 0!==i.props[t])return i.props[t];if(i.customAnimate){const e=i.customAnimate.getEndProps()[t];if(void 0!==e)return e}i=i.prev}return qe.getInstance().warn("未知错误，step中找不到属性"),e.props[t]}updateTarget(t,e,i){null==t.props&&null==t.customAnimate||this.target.onStep(this,this.animate,t,e,i)}}class Go{constructor(t,e,i,r){this.duration=e,this.position=t,this.props=i,this.easing=r}append(t){t.prev=this,t.next=this.next,this.next=t}getLastProps(){let t=this.prev;for(;t;){if(t.props)return t.props;if(t.customAnimate)return t.customAnimate.getMergedEndProps();t=t.prev}return null}}const jo=200,Vo="cubicOut";var Uo;!function(t){t[t.Top=1]="Top",t[t.Right=2]="Right",t[t.Bottom=4]="Bottom",t[t.Left=8]="Left",t[t.ALL=15]="ALL"}(Uo||(Uo={}));const Ko=[!1,!1,!1,!1],$o=[0,0,0,0],Xo=t=>t?et(t)?0===t.length?0:1===t.length?t[0]:2===t.length?($o[0]=t[0],$o[2]=t[0],$o[1]=t[1],$o[3]=t[1],$o):t:t:0,Yo=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],qo=[1,2,3,0,1,2,3,0];function Zo(t,e,i,r){for(;t>=qt;)t-=qt;for(;t<0;)t+=qt;for(;t>e;)e+=qt;Yo[0].x=i,Yo[1].y=i,Yo[2].x=-i,Yo[3].y=-i;const o=Math.ceil(t/Xt)%4,n=Math.ceil(e/Xt)%4;if(r.add(Qt(t)*i,ie(t)*i),r.add(Qt(e)*i,ie(e)*i),o!==n||e-t>$t){let t=!1;for(let e=0;e<qo.length;e++)if(t||o!==qo[e]){if(t&&n===qo[e])break;if(t){const t=Yo[qo[e]];r.add(t.x,t.y)}}else{t=!0;const e=Yo[o];r.add(e.x,e.y)}}}function Jo(t,e,i){const{x:r,y:o}=ae(t.x,t.y,e.x,e.y,i),{x:n,y:s}=ae(t.x1,t.y1,e.x1,e.y1,i),a=new le(r,o,n,s);return a.defined=e.defined,a}function Qo(t,e,i){if(!t||!e)return[];Array.isArray(t)||(t=[t]),Array.isArray(e)||(e=[e]);let r=[];if(t.length>e.length){r=e.map((t=>{const e=new le(t.x,t.y,t.x1,t.y1);return e.defined=t.defined,e}));for(let o=0;o<e.length;o++)r[o]=Jo(t[o],e[o],i)}else{r=e.map((t=>{const e=new le(t.x,t.y,t.x1,t.y1);return e.defined=t.defined,e}));for(let o=0;o<t.length;o++)r[o]=Jo(t[o],e[o],i)}return r}function tn(t,e){if(et(t)){let i;for(let r=0;r<t.length&&void 0===i;r++)i=t[r][e];return i}return t[e]}class en{constructor(){this.durations=[],this.timeout=en.TimeOut,this.lastDate=0,this.durationsListThreshold=30}call(t){return this.lastDate=Date.now(),setTimeout((()=>{this.appendDuration(Date.now()-this.lastDate),t(0)}),this.timeout,!0)}clear(t){clearTimeout(t)}appendDuration(t){this.durations.push(t),this.durations.length>this.durationsListThreshold&&this.durations.shift(),this.timeout=Math.min(Math.max(this.durations.reduce(((t,e)=>t+e),0)/this.durations.length,1e3/60),1e3/30)}}en.TimeOut=1e3/60;const rn=new en,on=(t,e)=>tt(t)&&"%"===t[t.length-1]?e*(Number.parseFloat(t.substring(0,t.length-1))/100):t;var nn;!function(t){t[t.Color255=0]="Color255",t[t.Color1=1]="Color1"}(nn||(nn={}));class sn{static Get(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nn.Color1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0,1];if(e===nn.Color1){const e=sn.store1[t];if(e)return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i;const r=Re.parseColorString(t);if(r){const e=[r.r/255,r.g/255,r.b/255,r.opacity];sn.store1[t]=e,sn.store255[t]=[r.r,r.g,r.b,r.opacity],i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]}return i}const r=sn.store255[t];if(r)return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i;const o=Re.parseColorString(t);return o&&(sn.store1[t]=[o.r/255,o.g/255,o.b/255,o.opacity],sn.store255[t]=[o.r,o.g,o.b,o.opacity],i[0]=o.r,i[1]=o.g,i[2]=o.b,i[3]=o.opacity),i}static Set(t,e,i){if(e===nn.Color1){if(sn.store1[t])return;sn.store1[t]=i,sn.store255[t]=[Math.floor(255*i[0]),Math.floor(255*i[1]),Math.floor(255*i[2]),Math.floor(255*i[3])]}else{if(sn.store255[t])return;sn.store255[t]=i,sn.store1[t]=[i[0]/255,i[1]/255,i[2]/255,i[3]]}}}function an(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Array.isArray(t)?e?`rgb(${Math.round(t[0])},${Math.round(t[1])},${Math.round(t[2])},${t[3].toFixed(2)})`:`rgb(${Math.round(t[0])},${Math.round(t[1])},${Math.round(t[2])})`:t}function ln(t,e,i,r,o){if(!t||!e)return t&&an(t)||e&&an(e)||!1;let n,s,a=!1,l=!1;if(Array.isArray(t)?n=t:"string"==typeof t?n=sn.Get(t,nn.Color255):a=!0,Array.isArray(e)?s=e:"string"==typeof e?s=sn.Get(e,nn.Color255):l=!0,a!==l){const n=a?t:e,s=a?e:t,l=Object.assign(Object.assign({},n),{stops:n.stops.map((t=>Object.assign(Object.assign({},t),{color:an(s)})))});return a?ln(n,l,i,r,o):ln(l,n,i,r,o)}if(a){if(t.gradient===e.gradient){const r=t,o=e,n=r.stops,s=o.stops;if(n.length!==s.length)return!1;if("linear"===r.gradient)return function(t,e,i){const r=t.stops,o=e.stops;return{gradient:"linear",x0:t.x0+(e.x0-t.x0)*i,x1:t.x1+(e.x1-t.x1)*i,y0:t.y0+(e.y0-t.y0)*i,y1:t.y1+(e.y1-t.y1)*i,stops:new Array(r.length).fill(0).map(((t,e)=>({color:dn(r[e].color,o[e].color,i),offset:r[e].offset+(o[e].offset-r[e].offset)*i})))}}(r,o,i);if("radial"===r.gradient)return function(t,e,i){const r=t.stops,o=e.stops;return{gradient:"radial",x0:t.x0+(e.x0-t.x0)*i,x1:t.x1+(e.x1-t.x1)*i,y0:t.y0+(e.y0-t.y0)*i,y1:t.y1+(e.y1-t.y1)*i,r0:t.r0+(e.r0-t.r0)*i,r1:t.r1+(e.r1-t.r1)*i,stops:new Array(r.length).fill(0).map(((t,e)=>({color:dn(r[e].color,o[e].color,i),offset:r[e].offset+(o[e].offset-r[e].offset)*i})))}}(r,o,i);if("conical"===r.gradient)return function(t,e,i){const r=t.stops,o=e.stops;return{gradient:"conical",startAngle:t.startAngle+(e.startAngle-t.startAngle)*i,endAngle:t.endAngle+(e.endAngle-t.endAngle)*i,x:t.x+(e.x-t.x)*i,y:t.y+(e.y-t.y)*i,stops:new Array(r.length).fill(0).map(((t,e)=>({color:dn(r[e].color,o[e].color,i),offset:r[e].offset+(o[e].offset-r[e].offset)*i})))}}(r,o,i)}return!1}return o&&o(n,s),an(function(t,e,i){return[t[0]+(e[0]-t[0])*i,t[1]+(e[1]-t[1])*i,t[2]+(e[2]-t[2])*i,t[3]+(e[3]-t[3])*i]}(n,s,i),r)}sn.store255={},sn.store1={};const hn=[0,0,0,0],cn=[0,0,0,0];function dn(t,e,i){return sn.Get(t,nn.Color255,hn),sn.Get(e,nn.Color255,cn),`rgba(${Math.round(hn[0]+(cn[0]-hn[0])*i)},${Math.round(hn[1]+(cn[1]-hn[1])*i)},${Math.round(hn[2]+(cn[2]-hn[2])*i)},${hn[3]+(cn[3]-hn[3])*i})`}class un{static GetImage(t,e){var i;const r=un.cache.get(t);r?"fail"===r.loadState?kr.global.getRequestAnimationFrame()((()=>{e.imageLoadFail(t)})):"init"===r.loadState||"loading"===r.loadState?null===(i=r.waitingMark)||void 0===i||i.push(e):e&&e.imageLoadSuccess(t,r.data):un.loadImage(t,e)}static GetSvg(t,e){var i;let r=un.cache.get(t);r?"fail"===r.loadState?kr.global.getRequestAnimationFrame()((()=>{e.imageLoadFail(t)})):"init"===r.loadState||"loading"===r.loadState?null===(i=r.waitingMark)||void 0===i||i.push(e):e&&e.imageLoadSuccess(t,r.data):(r={type:"image",loadState:"init"},un.cache.set(t,r),r.dataPromise=kr.global.loadSvg(t),r.dataPromise?(r.waitingMark=[e],r.dataPromise.then((e=>{var i;r.loadState=(null==e?void 0:e.data)?"success":"fail",r.data=null==e?void 0:e.data,null===(i=r.waitingMark)||void 0===i||i.map(((i,o)=>{(null==e?void 0:e.data)?(r.loadState="success",r.data=e.data,i.imageLoadSuccess(t,e.data)):(r.loadState="fail",i.imageLoadFail(t))}))}))):(r.loadState="fail",e.imageLoadFail(t)))}static GetFile(t,e){let i=un.cache.get(t);return i?"init"===i.loadState||"fail"===i.loadState?Promise.reject():"loading"===i.loadState?i.dataPromise.then((t=>t.data)):Promise.resolve(i.data):(i={type:e,loadState:"init"},un.cache.set(t,i),"arrayBuffer"===e?i.dataPromise=kr.global.loadArrayBuffer(t):"blob"===e?i.dataPromise=kr.global.loadBlob(t):"json"===e&&(i.dataPromise=kr.global.loadJson(t)),i.dataPromise.then((t=>t.data)))}static loading(){setTimeout((()=>{if(!un.isLoading&&un.toLoadAueue.length){un.isLoading=!0;const t=un.toLoadAueue.splice(0,10),e=[];t.forEach((t=>{const{url:i,marks:r}=t,o={type:"image",loadState:"init"};if(un.cache.set(i,o),o.dataPromise=kr.global.loadImage(i),o.dataPromise){o.waitingMark=r;const t=o.dataPromise.then((t=>{var e;o.loadState=(null==t?void 0:t.data)?"success":"fail",o.data=null==t?void 0:t.data,null===(e=o.waitingMark)||void 0===e||e.map(((e,r)=>{(null==t?void 0:t.data)?(o.loadState="success",o.data=t.data,e.imageLoadSuccess(i,t.data)):(o.loadState="fail",e.imageLoadFail(i))}))}));e.push(t)}else o.loadState="fail",r.forEach((t=>t.imageLoadFail(i)))})),Promise.all(e).then((()=>{un.isLoading=!1,this.onLoadSuccessCb.forEach((t=>t())),un.loading()})).catch((t=>{un.isLoading=!1,this.onLoadSuccessCb.forEach((t=>t())),un.loading()}))}}),0)}static loadImage(t,e){const i=gn(t,un.toLoadAueue);if(-1!==i)return un.toLoadAueue[i].marks.push(e),void un.loading();un.toLoadAueue.push({url:t,marks:[e]}),un.loading()}static improveImageLoading(t){const e=gn(t,un.toLoadAueue);if(-1!==e){const t=un.toLoadAueue.splice(e,1);un.toLoadAueue.unshift(t[0])}}static onLoadSuccess(t){this.onLoadSuccessCb.push(t)}}function gn(t,e){for(let i=0;i<e.length;i++)if(e[i].url===t)return i;return-1}un.cache=new Map,un.isLoading=!1,un.toLoadAueue=[],un.onLoadSuccessCb=[];const pn=new fe,fn=new ue,mn=["lineWidth","scaleX","scaleY","angle","anchor","visible"],bn=["x","y"],yn=["scaleX","scaleY"],Cn=["angle"],wn=new le,vn={strokeSeg:1,boundsPadding:2,pickMode:1,boundsMode:1,customPickShape:1,pickable:1,childrenPickable:1,visible:1,zIndex:1,layout:1,keepDirIn3d:1,globalZIndex:1,outerBorder:1,innerBorder:1,lineDash:1,lineCap:1,lineJoin:1,miterLimit:2,strokeBoundsBuffer:2,scaleCenter:1,anchor:1,anchor3d:1,postMatrix:1,backgroundMode:2,background:1,texture:1,cursor:1,html:1};class xn extends wo{static mixin(t){const e=Object.keys(t);for(let i=0;i<e.length;++i){const r=e[i];Object.defineProperty(xn.prototype,r,Object.getOwnPropertyDescriptor(t,r))}}get AABBBounds(){return this.tryUpdateAABBBounds("imprecise"===this.attribute.boundsMode)}get OBBBounds(){return this.tryUpdateOBBBounds()}get globalAABBBounds(){return this.tryUpdateGlobalAABBBounds()}get transMatrix(){return this.tryUpdateLocalTransMatrix(!0)}get globalTransMatrix(){return this.tryUpdateGlobalTransMatrix(!0)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var e;super(),this._AABBBounds=new ue,this._updateTag=yi.INIT,this.attribute=t,this.valid=this.isValid(),t.background&&this.loadImage(null!==(e=t.background.background)&&void 0!==e?e:t.background,!0)}setMode(t){"3d"===t?this.set3dMode():this.set2dMode()}set3dMode(){this.in3dMode=!0}set2dMode(){this.in3dMode=!1}getOffsetXY(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var i,r;const{dx:o=t.dx,dy:n=t.dy}=this.attribute;if(e&&this.parent){const t=this.parent.attribute;wn.x=o+(null!==(i=t.scrollX)&&void 0!==i?i:0),wn.y=n+(null!==(r=t.scrollY)&&void 0!==r?r:0)}else wn.x=o,wn.y=n;return wn}onAnimateBind(t){this._emitCustomEvent("animate-bind",t)}tryUpdateAABBBounds(t){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;if(!this.valid)return this._AABBBounds.clear(),this._AABBBounds;kr.graphicService.beforeUpdateAABBBounds(this,this.stage,!0,this._AABBBounds);const e=this.doUpdateAABBBounds(t);return kr.graphicService.afterUpdateAABBBounds(this,this.stage,this._AABBBounds,this,!0),e}combindShadowAABBBounds(t){if(this.shadowRoot){const e=this.shadowRoot.AABBBounds.clone();t.union(e)}}tryUpdateGlobalAABBBounds(){const t=this.AABBBounds;return this._globalAABBBounds?this._globalAABBBounds.setValue(t.x1,t.y1,t.x2,t.y2):this._globalAABBBounds=t.clone(),this._globalAABBBounds.empty()||this.parent&&this._globalAABBBounds.transformWithMatrix(this.parent.globalTransMatrix),this._globalAABBBounds}tryUpdateGlobalTransMatrix(){if(this._globalTransMatrix){if(this.parent){const t=this.parent.globalTransMatrix;this._globalTransMatrix.setValue(t.a,t.b,t.c,t.d,t.e,t.f)}}else this._globalTransMatrix=this.parent?this.parent.globalTransMatrix.clone():this.transMatrix.clone();return this.shouldUpdateGlobalMatrix()&&this.doUpdateGlobalMatrix(),this._globalTransMatrix}shouldUpdateGlobalMatrix(){return!0}tryUpdateLocalTransMatrix(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._transMatrix||(this._transMatrix=new fe),this.shouldUpdateLocalMatrix()&&(this.doUpdateLocalMatrix(),t&&this.clearUpdateLocalPositionTag()),this._transMatrix}shouldUpdateAABBBounds(){return this.shadowRoot?!!(this._updateTag&yi.UPDATE_BOUNDS)||this.shadowRoot.shouldUpdateAABBBounds():!!(this._updateTag&yi.UPDATE_BOUNDS)}shouldSelfChangeUpdateAABBBounds(){return this.shadowRoot?!!(this._updateTag&yi.UPDATE_BOUNDS)||this.shadowRoot.shouldUpdateAABBBounds():!!(this._updateTag&yi.UPDATE_BOUNDS)}shouldUpdateLocalMatrix(){return!!(this._updateTag&yi.UPDATE_LOCAL_MATRIX)}isValid(){var t,e;const i=this.attribute;return Number.isFinite((null!==(t=i.x)&&void 0!==t?t:0)+(null!==(e=i.y)&&void 0!==e?e:0))}_validNumber(t){return null==t||Number.isFinite(t)}shouldUpdateShape(){return!!(this._updateTag&yi.UPDATE_SHAPE)}clearUpdateShapeTag(){this._updateTag&=yi.CLEAR_SHAPE}containsPoint(t,e,i,r){if(!r)return!1;if(i===Ci.GLOBAL){const i=new le(t,e);this.parent&&this.parent.globalTransMatrix.transformPoint(i,i),t=i.x,e=i.y}return r.containsPoint(this,{x:t,y:e})}setAttributes(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;(t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,i)||t).background&&this.loadImage(t.background,!0),this._setAttributes(t,e,i)}_setAttributes(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;const r=Object.keys(t);for(let e=0;e<r.length;e++){const i=r[e];this.attribute[i]=t[i]}this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!e&&!this.needUpdateTags(r)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(i)}setAttribute(t,e,i,r){var o;const n=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({[t]:e},this.attribute,t,r);n?this._setAttributes(n,i,r):X(null===(o=this.normalAttrs)||void 0===o?void 0:o[t])?(this.attribute[t]=e,this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!i&&!this.needUpdateTag(t)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r)):this.normalAttrs[t]=e,"background"===t&&this.loadImage(e,!0)}needUpdateTags(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mn;for(let i=0;i<e.length;i++){const r=e[i];if(-1!==t.indexOf(r))return!0}return!1}needUpdateTag(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mn;for(let i=0;i<e.length;i++)if(t===e[i])return!0;return!1}initAttributes(t){const e={type:wi.INIT};t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,e)||t,this.attribute=t,t.background&&this.loadImage(t.background,!0),this._updateTag=yi.INIT,this.valid=this.isValid(),this.onAttributeUpdate(e)}translate(t,e){var i,r;if(0===t&&0===e)return this;const o={type:wi.TRANSLATE},n=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({x:t,y:e},this.attribute,bn,o);n&&(t=n.x,e=n.y,delete n.x,delete n.y,this._setAttributes(n));const s=this.attribute,a=s.postMatrix;return a?kr.transformUtil.fromMatrix(a,a).translate(t,e):(s.x=(null!==(i=s.x)&&void 0!==i?i:cr.x)+t,s.y=(null!==(r=s.y)&&void 0!==r?r:cr.y)+e),this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(o),this}translateTo(t,e){const i=this.attribute;if(i.x===t&&i.y===e)return this;const r={type:wi.TRANSLATE_TO},o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({x:t,y:e},this.attribute,bn,r);return o?(this._setAttributes(o,!1,r),this):(i.x=t,i.y=e,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this)}scale(t,e,i){var r,o;if(1===t&&1===e)return this;const n={type:wi.SCALE},s=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({scaleX:t,scaleY:e,scaleCenter:i},this.attribute,yn,n);s&&(t=s.scaleX,e=s.scaleY,delete s.scaleX,delete s.scaleY,this._setAttributes(s));const a=this.attribute;if(i){let{postMatrix:r}=this.attribute;r||(r=new fe,a.postMatrix=r),kr.transformUtil.fromMatrix(r,r).scale(t,e,i)}else a.scaleX=(null!==(r=a.scaleX)&&void 0!==r?r:cr.scaleX)*t,a.scaleY=(null!==(o=a.scaleY)&&void 0!==o?o:cr.scaleY)*e;return this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(n),this}scaleTo(t,e){const i=this.attribute;if(i.scaleX===t&&i.scaleY===e)return this;const r={type:wi.SCALE_TO},o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({scaleX:t,scaleY:e},this.attribute,yn,r);return o?(this._setAttributes(o,!1,r),this):(i.scaleX=t,i.scaleY=e,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this)}rotate(t,e){var i;if(0===t)return this;const r={type:wi.ROTATE},o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({angle:t,rotateCenter:e},this.attribute,Cn,r);o&&(delete o.angle,this._setAttributes(o,!1,r));const n=this.attribute;if(e){let{postMatrix:i}=this.attribute;i||(i=new fe,n.postMatrix=i),kr.transformUtil.fromMatrix(i,i).rotate(t,e)}else n.angle=(null!==(i=n.angle)&&void 0!==i?i:cr.angle)+t;return this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this}rotateTo(t){const e=this.attribute;if(e.angle===t)return this;const i={type:wi.ROTATE_TO},r=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,Cn,i);return r?(this._setAttributes(r,!1,i),this):(e.angle=t,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(i),this)}skewTo(t,e){return this}animate(t){this.animates||(this.animates=new Map);const e=new Wo(null==t?void 0:t.id,this.stage&&this.stage.getTimeline()).bind(this);if(t){const{onStart:i,onFrame:r,onEnd:o,onRemove:n}=t;null!=i&&e.onStart(i),null!=r&&e.onFrame(r),null!=o&&e.onEnd(o),null!=n&&e.onRemove(n),e.interpolateFunc=t.interpolate}return this.animates.set(e.id,e),e.onRemove((()=>{this.animates.delete(e.id)})),e}onAttributeUpdate(t){t&&t.skipUpdateCallback||(kr.graphicService.onAttributeUpdate(this),this._emitCustomEvent("afterAttributeUpdate",t))}update(t){t?(t.bounds&&this.tryUpdateAABBBounds("imprecise"===this.attribute.boundsMode),t.trans&&this.tryUpdateLocalTransMatrix()):(this.tryUpdateAABBBounds("imprecise"===this.attribute.boundsMode),this.tryUpdateLocalTransMatrix())}hasState(t){return!(!this.currentStates||!this.currentStates.length)&&(!!X(t)||this.currentStates.includes(t))}getState(t){var e;return null===(e=this.states)||void 0===e?void 0:e[t]}applyStateAttrs(t,e,i,r){var o,n,s,a;if(i){const i=Object.keys(t),l=this.getNoWorkAnimateAttr(),h={};let c;i.forEach((e=>{l[e]?(c||(c={}),c[e]=t[e]):h[e]=r&&void 0===t[e]?this.getDefaultAttribute(e):t[e]}));const d=this.animate();d.stateNames=e,d.to(h,null!==(n=null===(o=this.stateAnimateConfig)||void 0===o?void 0:o.duration)&&void 0!==n?n:jo,null!==(a=null===(s=this.stateAnimateConfig)||void 0===s?void 0:s.easing)&&void 0!==a?a:Vo),c&&this.setAttributes(c,!1,{type:wi.STATE})}else this.stopStateAnimates(),this.setAttributes(t,!1,{type:wi.STATE})}updateNormalAttrs(t){const e={};this.normalAttrs?(Object.keys(t).forEach((t=>{t in this.normalAttrs?(e[t]=this.normalAttrs[t],delete this.normalAttrs[t]):e[t]=this.getNormalAttribute(t)})),Object.keys(this.normalAttrs).forEach((e=>{t[e]=this.normalAttrs[e]}))):Object.keys(t).forEach((t=>{e[t]=this.getNormalAttribute(t)})),this.normalAttrs=e}stopStateAnimates(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"end";this.animates&&this.animates.forEach((e=>{e.stateNames&&e.stop(t)}))}getNormalAttribute(t){let e=this.attribute[t];return this.animates&&this.animates.forEach((i=>{if(i.stateNames){const r=i.getEndProps();ft(r,t)&&(e=r[t])}})),e}clearStates(t){this.hasState()&&this.normalAttrs?(this.currentStates=[],this.applyStateAttrs(this.normalAttrs,this.currentStates,t,!0)):this.currentStates=[],this.normalAttrs=null}removeState(t,e){if((this.currentStates?this.currentStates.indexOf(t):-1)>=0){const i=this.currentStates.filter((e=>e!==t));this.useStates(i,e)}}toggleState(t,e){if(this.hasState(t))this.removeState(t,e);else if((this.currentStates?this.currentStates.indexOf(t):-1)<0){const i=this.currentStates?this.currentStates.slice():[];i.push(t),this.useStates(i,e)}}addState(t,e,i){var r;if(this.currentStates&&this.currentStates.includes(t)&&(e||1===this.currentStates.length))return;const o=e&&(null===(r=this.currentStates)||void 0===r?void 0:r.length)?this.currentStates.concat([t]):[t];this.useStates(o,i)}useStates(t,e){var i;if(!t.length)return void this.clearStates(e);if((null===(i=this.currentStates)||void 0===i?void 0:i.length)===t.length&&!t.some(((t,e)=>this.currentStates[e]!==t)))return;const r={};t.forEach((e=>{var i;const o=this.stateProxy?this.stateProxy(e,t):null===(i=this.states)||void 0===i?void 0:i[e];o&&Object.assign(r,o)})),this.updateNormalAttrs(r),this.currentStates=t,this.applyStateAttrs(r,t,e)}addUpdateBoundTag(){this._updateTag|=yi.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag(),this.glyphHost&&this.glyphHost.addUpdateBoundTag()}addUpdateShapeTag(){this._updateTag|=yi.UPDATE_SHAPE}addUpdateShapeAndBoundsTag(){this._updateTag|=yi.UPDATE_SHAPE_AND_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag(),this.glyphHost&&this.glyphHost.addUpdateBoundTag()}updateShapeAndBoundsTagSetted(){return(this._updateTag&yi.UPDATE_SHAPE_AND_BOUNDS)===yi.UPDATE_SHAPE_AND_BOUNDS}clearUpdateBoundTag(){this._updateTag&=yi.CLEAR_BOUNDS}addUpdatePositionTag(){this.shadowRoot&&this.shadowRoot.addUpdateGlobalPositionTag(),this._updateTag|=yi.UPDATE_GLOBAL_LOCAL_MATRIX}addUpdateGlobalPositionTag(){this.shadowRoot&&this.shadowRoot.addUpdateGlobalPositionTag(),this._updateTag|=yi.UPDATE_GLOBAL_MATRIX}clearUpdateLocalPositionTag(){this._updateTag&=yi.CLEAR_LOCAL_MATRIX}clearUpdateGlobalPositionTag(){this._updateTag&=yi.CLEAR_GLOBAL_MATRIX}addUpdateLayoutTag(){this._updateTag|=yi.UPDATE_LAYOUT}clearUpdateLayoutTag(){this._updateTag&=yi.CLEAR_LAYOUT}needUpdateLayout(){return!!(this._updateTag&yi.UPDATE_LAYOUT)}getAnchor(t,e){const i=[0,0],r=()=>{if(e.b)return e.b;const{scaleX:t,scaleY:i,angle:r}=this.attribute;return fn.copy(this._AABBBounds),this.setAttributes({scaleX:1,scaleY:1,angle:0}),e.b=this.AABBBounds.clone(),this._AABBBounds.copy(fn),this.setAttributes({scaleX:t,scaleY:i,angle:r}),e.b};if("string"==typeof t[0]){const e=parseFloat(t[0])/100,o=r();i[0]=o.x1+(o.x2-o.x1)*e}else i[0]=t[0];if("string"==typeof t[1]){const e=parseFloat(t[1])/100,o=r();i[1]=o.y1+(o.y2-o.y1)*e}else i[1]=t[1];return i}doUpdateLocalMatrix(){const{x:t=cr.x,y:e=cr.y,scaleX:i=cr.scaleX,scaleY:r=cr.scaleY,angle:o=cr.angle,scaleCenter:n,anchor:s,postMatrix:a}=this.attribute;let l=[0,0];const h={};if(s&&(l=this.getAnchor(s,h)),!n||1===i&&1===r)!function(t,e,i,r,o,n,s,a){const l=e.a,h=e.b,c=e.c,d=e.d,u=e.e,g=e.f,p=Qt(s),f=ie(s);let m,b;a?(m=a[0],b=a[1]):(m=i,b=r);const y=m-i,C=b-r,w=l*p+c*f,v=h*p+d*f,x=c*p-l*f,_=d*p-h*f;t.a=o*w,t.b=o*v,t.c=n*x,t.d=n*_,t.e=u+l*m+c*b-w*y-x*C,t.f=g+h*m+d*b-v*y-_*C}(this._transMatrix,this._transMatrix.reset(),t,e,i,r,o,s&&l);else{const s=this._transMatrix;s.reset(),s.translate(l[0],l[1]),s.rotate(o),s.translate(-l[0],-l[1]),s.translate(t,e),l=this.getAnchor(n,h),kr.transformUtil.fromMatrix(s,s).scale(i,r,{x:l[0],y:l[1]})}const c=this.getOffsetXY(cr);if(this._transMatrix.e+=c.x,this._transMatrix.f+=c.y,a){const t=pn.setValue(a.a,a.b,a.c,a.d,a.e,a.f),e=this._transMatrix;t.multiply(e.a,e.b,e.c,e.d,e.e,e.f),e.setValue(t.a,t.b,t.c,t.d,t.e,t.f)}}doUpdateGlobalMatrix(){if(this.parent){this._globalTransMatrix.multiply(this.transMatrix.a,this.transMatrix.b,this.transMatrix.c,this.transMatrix.d,this.transMatrix.e,this.transMatrix.f);const{scrollX:t=0,scrollY:e=0}=this.parent.attribute;this._globalTransMatrix.translate(t,e)}}setStage(t,e){if(this.stage!==t){if(this.stage=t,this.layer=e,this.setStageToShadowRoot(t,e),this.animates&&this.animates.size){const e=t.getTimeline();this.animates.forEach((t=>{t.setTimeline(e)}))}this._onSetStage&&this._onSetStage(this,t,e),kr.graphicService.onSetStage(this,t)}}setStageToShadowRoot(t,e){this.shadowRoot&&this.shadowRoot.setStage(t,e)}onAddStep(t){}onStop(t){t&&this.setAttributes(t,!1,{type:wi.ANIMATE_END})}onStep(t,e,i,r,o){const n={};if(i.customAnimate)i.customAnimate.update(o,r,n);else{const s=i.props,a=i.parsedProps,l=i.propKeys;this.stepInterpolate(t,e,n,i,r,o,s,void 0,a,l)}this.setAttributes(n,!1,{type:wi.ANIMATE_UPDATE,animationState:{ratio:r,end:o,step:i,isFirstFrameOfStep:t.getLastStep()!==i}}),this.stage&&this.stage.renderNextFrame()}stepInterpolate(t,e,i,r,o,n,s,a,l,h){h||(h=Object.keys(s),r.propKeys=h),n?r.propKeys.forEach((t=>{e.validAttr(t)&&(i[t]=s[t])})):h.forEach((n=>{var h;if(!e.validAttr(n))return;const c=s[n],d=null!==(h=a&&a[n])&&void 0!==h?h:t.getLastPropByName(n,r);if(null==c||null==d)return void(i[n]=c);let u;u=e.interpolateFunc&&e.interpolateFunc(n,o,d,c,i),u||(u=e.customInterpolate(n,o,d,c,this,i),u||this.defaultInterpolate(c,d,n,i,l,o)||this._interpolate(n,o,d,c,i))})),r.parsedProps=l}defaultInterpolate(t,e,i,r,o,n){if(Number.isFinite(t))return r[i]=e+(t-e)*n,!0;if("fill"===i){o||(o={});const s=o.fillColorArray,a=ln(e,null!=s?s:t,n,!1,((t,e)=>{o.fillColorArray=e}));return a&&(r[i]=a),!0}if("stroke"===i){o||(o={});const s=o.strokeColorArray,a=ln(e,null!=s?s:t,n,!1,((t,e)=>{o.strokeColorArray=e}));return a&&(r[i]=a),!0}if("shadowColor"===i){o||(o={});const s=o.shadowColorArray,a=ln(e,null!=s?s:t,n,!0,((t,e)=>{o.shadowColorArray=e}));return a&&(r[i]=a),!0}return!1}_interpolate(t,e,i,r,o){}getDefaultAttribute(t){return yo(this)[this.type][t]}getComputedAttribute(t){var e;return null!==(e=this.attribute[t])&&void 0!==e?e:this.getDefaultAttribute(t)}onSetStage(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._onSetStage=t,e&&this.stage&&t(this,this.stage)}attachShadow(t){return t&&(t.shadowHost=this),this.shadowRoot=null!=t?t:kr.graphicService.creator.shadowRoot(this),this.addUpdateBoundTag(),this.shadowRoot.setStage(this.stage,this.layer),this.shadowRoot}detachShadow(){this.shadowRoot&&(this.addUpdateBoundTag(),this.shadowRoot=null)}toJson(){return{attribute:this.attribute,_uid:this._uid,type:this.type,name:this.name,children:this.children.map((t=>t.toJson()))}}createPathProxy(t){return tt(t,!0)?this.pathProxy=(new ar).fromString(t):this.pathProxy=new ar,this.pathProxy}loadImage(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t||e&&function(t){return!(!t.fill&&!t.stroke)}(t))return;const i=t;this.resources||(this.resources=new Map);const r={data:"init",state:null};this.resources.set(i,r),"string"==typeof t?(r.state="loading",t.startsWith("<svg")?(un.GetSvg(t,this),this.backgroundImg=this.backgroundImg||e):(st(t)||t.includes("/")||at(t))&&(un.GetImage(t,this),this.backgroundImg=this.backgroundImg||e)):q(t)?(r.state="success",r.data=t,this.backgroundImg=this.backgroundImg||e):r.state="fail"}imageLoadSuccess(t,e,i){if(!this.resources)return;const r=this.resources.get(t);r&&(r.state="success",r.data=e,i&&i(),this.addUpdateBoundTag(),this.stage&&this.stage.renderNextFrame())}imageLoadFail(t,e){if(!this.resources)return;const i=this.resources.get(t);i&&(i.state="fail",e&&e())}_stopAnimates(t){t&&t.forEach((t=>{t.stop()}))}stopAnimates(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._stopAnimates(this.animates),this.shadowRoot&&this.shadowRoot.stopAnimates(!0),this.isContainer&&t&&this.forEachChildren((e=>{e.stopAnimates(t)}))}release(){this.releaseStatus="released",kr.graphicService.onRelease(this)}_emitCustomEvent(t,e){var i,r;if(this._events&&t in this._events){const o=new Ao(t,e);o.bubbles=!1,o.manager=null===(r=null===(i=this.stage)||void 0===i?void 0:i.eventSystem)||void 0===r?void 0:r.manager,this.dispatchEvent(o)}}}xn.mixin(Mo);class _n{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,e){"__proto__"===t&&(t="#__proto__"),this.child.push({[t]:e})}addChild(t){"__proto__"===t.tagname&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}}function Sn(t,e,i,r){const o=t.indexOf(e,i);if(-1===o)throw new Error(r);return o+e.length-1}function An(t,e,i){const r=function(t,e){let i,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:">",o="";for(let n=e;n<t.length;n++){let e=t[n];if(i)e===i&&(i="");else if('"'===e||"'"===e)i=e;else if(e===r[0]){if(!r[1])return{data:o,index:n};if(t[n+1]===r[1])return{data:o,index:n}}else"\t"===e&&(e=" ");o+=e}}(t,e+1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:">");if(!r)return;let o=r.data;const n=r.index,s=o.search(/\s/);let a=o,l=!0;-1!==s&&(a=o.substr(0,s).replace(/\s\s*$/,""),o=o.substr(s+1));const h=a;if(i){const t=a.indexOf(":");-1!==t&&(a=a.substr(t+1),l=a!==r.data.substr(t+1))}return{tagName:a,tagExp:o,closeIndex:n,attrExpPresent:l,rawTagName:h}}const Rn=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");class Bn{constructor(t){this.currentNode=null,this.options=t,this.tagsNodeStack=[],this.docTypeEntities={}}addChild(t,e,i){const r=e.tagname;"string"==typeof r?(e.tagname=r,t.addChild(e)):t.addChild(e)}buildAttributesMap(t,e,i){const r={};if(!t)return;const o=function(t,e){const i=[];let r=e.exec(t);for(;r;){const o=[];o.startIndex=e.lastIndex-r[0].length;const n=r.length;for(let t=0;t<n;t++)o.push(r[t]);i.push(o),r=e.exec(t)}return i}(t,Rn),n=o.length;for(let t=0;t<n;t++){const e=o[t][1],i=o[t][4];e&&(r[e]=void 0===i||(isNaN(i)?i:Number(i)))}return r}parseXml(t){t=t.replace(/\r\n?/g,"\n");const e=new _n("!xml");let i=e,r="",o="";for(let n=0;n<t.length;n++)if("<"===t[n])if("/"===t[n+1]){const e=Sn(t,">",n,"Closing Tag is not closed."),s=o.lastIndexOf(".");o=o.substring(0,s),i=this.tagsNodeStack.pop(),i&&i.child&&r&&i.child[i.child.length-1][":@"]&&(i.child[i.child.length-1][":@"].text=r),r="",n=e}else if("?"===t[n+1])n=An(t,n,!1,"?>").closeIndex+1;else if("!--"===t.substr(n+1,3))n=Sn(t,"--\x3e",n+4,"Comment is not closed.");else{const s=An(t,n,!1);let a=s.tagName,l=s.tagExp;const h=s.attrExpPresent,c=s.closeIndex;if(a!==e.tagname&&(o+=o?"."+a:a),l.length>0&&l.lastIndexOf("/")===l.length-1){"/"===a[a.length-1]?(a=a.substr(0,a.length-1),o=o.substr(0,o.length-1),l=a):l=l.substr(0,l.length-1);const t=new _n(a);a!==l&&h&&(t[":@"]=this.buildAttributesMap(l,o,a)),this.addChild(i,t,o),o=o.substr(0,o.lastIndexOf("."))}else{const t=new _n(a);this.tagsNodeStack.push(i),a!==l&&h&&(t[":@"]=this.buildAttributesMap(l,o,a)),this.addChild(i,t,o),i=t}r="",n=c}else r+=t[n];return e.child}}function Mn(t,e){return Tn(t)}function Tn(t,e){const i={};for(let e=0;e<t.length;e++){const r=t[e],o=Pn(r);if(void 0!==o&&r[o]){const t=Tn(r[o]);En(t),r[":@"]&&Hn(t,r[":@"]),void 0!==i[o]&&i.hasOwnProperty(o)?(Array.isArray(i[o])||(i[o]=[i[o]]),i[o].push(t)):i[o]=t}}return i}function Pn(t){const e=Object.keys(t);for(let t=0;t<e.length;t++){const i=e[t];if(":@"!==i)return i}}function Hn(t,e,i){if(e){const i=Object.keys(e),r=i.length;for(let o=0;o<r;o++){const r=i[o];t[r]=e[r]}}}function En(t){return 0===Object.keys(t).length}class kn{constructor(t){this.options=Object.assign({},kn.defaultOptions,t)}valid(t){return t.startsWith("<")}parse(t){if(!this.valid)return!1;return Mn(new Bn(this.options).parseXml(t),this.options)}}function Ln(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return t.expand(e+(r/2+(i?function(t,e){return t?e:0}(i,e):0))),t}kn.defaultOptions={};let Fn=0;function In(){return Fn++}var zn;function On(t){const e=[];let i=0,r="";for(let o=0;o<t.length;o++)Nn(t[o])?i?r+=t[o]:(i=1,r=t[o]):(i&&(e.push({text:r,direction:zn.VERTICAL}),r="",i=0),e.push({text:t[o],direction:zn.HORIZONTAL}));return r&&e.push({text:r,direction:zn.VERTICAL}),e}!function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(zn||(zn={}));const Dn=new Map;["…","（","）","—","【","】","「","」","《","》"].forEach((t=>Dn.set(t,!0)));const Wn=new Map;function Nn(t){if(Dn.has(t))return!0;if(Wn.has(t))return!1;let e=!1;return t.codePointAt(0)<256&&(e=!0),e}[""].forEach((t=>Wn.set(t,!0)));const Gn=In(),jn=In(),Vn=In(),Un=In(),Kn=In(),$n=In(),Xn=In(),Yn=In(),qn=In(),Zn=In(),Jn=In(),Qn=In(),ts=In(),es=In(),is=In(),rs=In(),os=Symbol.for("GraphicService"),ns=Symbol.for("GraphicCreator"),ss={"stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-width":"lineWidth","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity",stroke:"stroke",fill:"fill"},as=Object.keys(ss);var ls;!function(t){t[t.LESS_GROUP=0]="LESS_GROUP",t[t.MORE_GROUP=1]="MORE_GROUP"}(ls||(ls={}));let hs=class t extends xn{constructor(t){super(t),this.type="group",this.parent=null,this.isContainer=!0,this.numberType=$n,this._childUpdateTag=yi.UPDATE_BOUNDS}setMode(t){"3d"===t?this.set3dMode():this.set2dMode()}set3dMode(){this.in3dMode=!0}set2dMode(){this.in3dMode=!1}setTheme(t){return this.theme||(this.theme=new mo),this.theme.setTheme(t,this)}createTheme(){this.theme||(this.theme=new mo)}hideAll(){this.setAttribute("visible",!1),this.forEachChildren((t=>{t.isContainer&&t.hideAll?t.hideAll():t.setAttribute("visible",!1)}))}showAll(){this.setAttribute("visible",!0),this.forEachChildren((t=>{t.isContainer&&t.showAll?t.showAll():t.setAttribute("visible",!0)}))}containsPoint(t,e,i){if(i===Ci.GLOBAL){const i=new le(t,e);return this.parent&&this.parent.globalTransMatrix.transformPoint(i,i),this.AABBBounds.contains(i.x,i.y)}return this.AABBBounds.contains(t,e)}shouldUpdateAABBBounds(){return!!super.shouldUpdateAABBBounds()||!!(this._childUpdateTag&yi.UPDATE_BOUNDS)}tryUpdateAABBBounds(){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;kr.graphicService.beforeUpdateAABBBounds(this,this.stage,!0,this._AABBBounds);const t=this.shouldSelfChangeUpdateAABBBounds(),e=this.doUpdateAABBBounds();return this.addUpdateLayoutTag(),kr.graphicService.afterUpdateAABBBounds(this,this.stage,this._AABBBounds,this,t),e}doUpdateLocalMatrix(){const{x:t=cr.x,y:e=cr.y,dx:i=cr.dx,dy:r=cr.dy,scaleX:o=cr.scaleX,scaleY:n=cr.scaleY,angle:s=cr.angle,postMatrix:a}=this.attribute;if(0!==t||0!==e||0!==i||0!==r||1!==o||1!==n||0!==s||a)return super.doUpdateLocalMatrix();this._transMatrix.reset()}doUpdateAABBBounds(){const t=this.attribute,e=yo(this).group;this._AABBBounds.clear();const i=kr.graphicService.updateGroupAABBBounds(t,e,this._AABBBounds,this),{boundsPadding:r=e.boundsPadding}=t,o=Xo(r);return o&&i.expand(o),this.parent&&this.parent.addChildUpdateBoundTag(),this.clearUpdateBoundTag(),this._emitCustomEvent("AAABBBoundsChange"),i}clearUpdateBoundTag(){this._updateTag&=yi.CLEAR_BOUNDS,this._childUpdateTag&=yi.CLEAR_BOUNDS}tryUpdateOBBBounds(){throw new Error("暂不支持")}addUpdateBoundTag(){this._updateTag|=yi.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag()}addChildUpdateBoundTag(){this._childUpdateTag&yi.UPDATE_BOUNDS||(this._childUpdateTag|=yi.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag())}getTheme(){return this.theme.getTheme(this)}incrementalAppendChild(t){const e=super.appendChild(t);return this.stage&&e&&(e.stage=this.stage,e.layer=this.layer),this.addUpdateBoundTag(),kr.graphicService.onAddIncremental(t,this,this.stage),e}incrementalClearChild(){super.removeAllChild(),this.addUpdateBoundTag(),kr.graphicService.onClearIncremental(this,this.stage)}appendChild(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=super.appendChild(t);return e&&this.stage&&i&&i.setStage(this.stage,this.layer),this.addUpdateBoundTag(),i}insertBefore(t,e){const i=super.insertBefore(t,e);return this.stage&&i&&i.setStage(this.stage,this.layer),this.addUpdateBoundTag(),i}insertAfter(t,e){const i=super.insertAfter(t,e);return this.stage&&i&&i.setStage(this.stage,this.layer),this.addUpdateBoundTag(),i}insertInto(t,e){const i=super.insertInto(t,e);return this.stage&&i&&i.setStage(this.stage,this.layer),this.addUpdateBoundTag(),i}removeChild(t){const e=super.removeChild(t);return t.stage=null,kr.graphicService.onRemove(t),this.addUpdateBoundTag(),e}removeAllChild(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.forEachChildren((e=>{kr.graphicService.onRemove(e),t&&e.isContainer&&e.removeAllChild(t)})),super.removeAllChild(),this.addUpdateBoundTag()}setStage(t,e){this.stage!==t&&(this.stage=t,this.layer=e,this.setStageToShadowRoot(t,e),this._onSetStage&&this._onSetStage(this,t,e),kr.graphicService.onSetStage(this,t),this.forEachChildren((e=>{e.setStage(t,this.layer)})))}addUpdatePositionTag(){super.addUpdatePositionTag(),this.forEachChildren((t=>{t.isContainer&&t.addUpdateGlobalPositionTag()}))}addUpdateGlobalPositionTag(){super.addUpdateGlobalPositionTag(),this.forEachChildren((t=>{t.isContainer&&t.addUpdateGlobalPositionTag()}))}tryUpdateGlobalTransMatrix(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.shouldUpdateGlobalMatrix()){if(this._globalTransMatrix){if(this.parent){const t=this.parent.globalTransMatrix;this._globalTransMatrix.setValue(t.a,t.b,t.c,t.d,t.e,t.f)}}else this._globalTransMatrix=this.parent?this.parent.globalTransMatrix.clone():this.transMatrix.clone();this.doUpdateGlobalMatrix(),t&&this.clearUpdateGlobalPositionTag()}return this._globalTransMatrix}shouldUpdateGlobalMatrix(){return!!(this._updateTag&yi.UPDATE_GLOBAL_MATRIX)}_getChildByName(t,e){return this.find((e=>e.name===t),e)}createOrUpdateChild(t,e,i){let r=this._getChildByName(t);return r?r.setAttributes(e):(r=kr.graphicService.creator[i](e),r.name=t,this.add(r)),r}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function cs(t){return new hs(t)}hs.NOWORK_ANIMATE_ATTR=vn;class ds extends hs{get offscreen(){return this.layerHandler.offscreen}get layerMode(){return this.layerHandler.type}get width(){return this.stage?this.stage.width:0}get height(){return this.stage?this.stage.height:0}get viewWidth(){return this.stage?this.stage.viewWidth:0}get viewHeight(){return this.stage?this.stage.viewHeight:0}get dirtyBound(){throw new Error("暂不支持")}get dpr(){return this._dpr}constructor(t,e,i,r){var o;super({}),this.stage=t,this.global=e,this.window=i,this.main=r.main,this.layerHandler=r.layerHandler,this.layerHandler.init(this,i,{main:r.main,canvasId:r.canvasId,width:this.viewWidth,height:this.viewHeight,zIndex:null!==(o=r.zIndex)&&void 0!==o?o:0}),this.layer=this,this.subLayers=new Map,this.theme=new mo,this.background="rgba(0, 0, 0, 0)",this.afterDrawCbs=[]}combineSubLayer(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const e=Array.from(this.subLayers.values()).sort(((t,e)=>t.zIndex-e.zIndex));this.layerHandler.merge(e.map((e=>(e.layer.subLayers.size&&e.layer.combineSubLayer(t),e.layer.getNativeHandler())))),t&&e.forEach((t=>{t.group&&(t.group.incremental=0)})),e.forEach((t=>{kr.layerService.releaseLayer(this.stage,t.layer)})),this.subLayers.clear()}getNativeHandler(){return this.layerHandler}setStage(t,e){super.setStage(t,this)}pick(t,e){throw new Error("暂不支持")}tryRenderSecondaryLayer(t,e){this.layerHandler.secondaryHandlers&&this.layerHandler.secondaryHandlers.length&&this.layerHandler.secondaryHandlers.forEach((i=>{i.layer.renderCount=this.renderCount,i.layer.render(t,e)}))}render(t,e){var i;this.layerHandler.render([this],{renderService:t.renderService,stage:this.stage,layer:this,viewBox:t.viewBox,transMatrix:t.transMatrix,background:null!==(i=t.background)&&void 0!==i?i:this.background,updateBounds:t.updateBounds},e),this.afterDrawCbs.forEach((t=>t(this))),this.tryRenderSecondaryLayer(t,e)}resize(t,e){this.layerHandler.resize(t,e)}resizeView(t,e){this.layerHandler.resizeView(t,e)}setDpr(t){this.layerHandler.setDpr(t)}afterDraw(t){this.afterDrawCbs.push(t)}startAnimate(t){throw new Error("暂不支持")}setToFrame(t){throw new Error("暂不支持")}prepare(t,e){}release(){super.release(),this.layerHandler.release(),this.subLayers&&this.subLayers.forEach((t=>{kr.layerService.releaseLayer(this.stage,t.layer)}))}drawTo(t,e){var i;this.layerHandler.drawTo(t,[this],Object.assign({background:null!==(i=e.background)&&void 0!==i?i:this.background,renderService:e.renderService,viewBox:e.viewBox,transMatrix:e.transMatrix,stage:this.stage,layer:this},e)),this.afterDrawCbs.forEach((t=>t(this)))}}const us=Symbol.for("TransformUtil"),gs=Symbol.for("GraphicUtil"),ps=Symbol.for("LayerService"),fs=Symbol.for("StaticLayerHandlerContribution"),ms=Symbol.for("DynamicLayerHandlerContribution"),bs=Symbol.for("VirtualLayerHandlerContribution");var ys,Cs=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},ws=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let vs=ys=class{static GenerateLayerId(){return`${ys.idprefix}_${ys.prefix_count++}`}constructor(){this.layerMap=new Map,this.global=kr.global}tryInit(){this.inited||(this.staticLayerCountInEnv=this.global.getStaticCanvasCount(),this.dynamicLayerCountInEnv=this.global.getDynamicCanvasCount(),this.inited=!0)}getStageLayer(t){return this.layerMap.get(t)}getRecommendedLayerType(t){return t||(0!==this.staticLayerCountInEnv?"static":0!==this.dynamicLayerCountInEnv?"dynamic":"virtual")}getLayerHandler(t){let e;return e="static"===t?Xr.get(fs):"dynamic"===t?Xr.get(ms):Xr.get(bs),e}createLayer(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{main:!1};var i;this.tryInit();let r=this.getRecommendedLayerType(e.layerMode);r=e.main||e.canvasId?"static":r;const o=this.getLayerHandler(r),n=new ds(t,this.global,t.window,Object.assign(Object.assign({main:!1},e),{layerMode:r,canvasId:null!==(i=e.canvasId)&&void 0!==i?i:ys.GenerateLayerId(),layerHandler:o})),s=this.layerMap.get(t)||[];return s.push(n),this.layerMap.set(t,s),this.staticLayerCountInEnv--,n}prepareStageLayer(t){let e;t.forEachChildren((t=>{const i=t.getNativeHandler();"virtual"===i.type?(i.mainHandler=e,e.secondaryHandlers.push(i)):(e=i,e.secondaryHandlers=[])}))}releaseLayer(t,e){e.release();const i=this.layerMap.get(t)||[];this.layerMap.set(t,i.filter((t=>t!==e)))}layerCount(t){return(this.layerMap.get(t)||[]).length}restLayerCount(t){return"browser"===this.global.env?10:0}releaseStage(t){this.layerMap.delete(t)}};vs.idprefix="visactor_layer",vs.prefix_count=0,vs=ys=Cs([f(),ws("design:paramtypes",[])],vs);var xs=new i((t=>{t(z).to(N).inSingletonScope(),t(eo).to(ro),t(gs).to(ao).inSingletonScope(),t(us).to(co).inSingletonScope(),t(ps).to(vs).inSingletonScope()}));function _s(t,e){return!(!t&&!e)}function Ss(t,e){let i;return i=et(t)?t.some((t=>t||void 0===t)):!!t,i&&e>0}function As(t,e,i){return i&&t*e>0}function Rs(t,e,i,r,o){return o&&t*e>0&&0!==i&&0!==r}function Bs(t,e){return t*e>0}function Ms(t,e,i,r){return t*e>0&&0!==i&&0!==r}function Ts(t,e,i,r,o,n,s,a){const l=i-t,h=r-e,c=s-o,d=a-n;let u=d*l-c*h;return u*u<Kt?[]:(u=(c*(e-n)-d*(t-o))/u,[t+u*l,e+u*h])}function Ps(t,e,i,r,o,n,s){const a=t-i,l=e-r,h=(s?n:-n)/Math.sqrt(a*a+l*l),c=h*l,d=-h*a,u=t+c,g=e+d,p=i+c,f=r+d,m=(u+p)/2,b=(g+f)/2,y=p-u,C=f-g,w=y*y+C*C,v=o-n,x=u*f-p*g,_=(C<0?-1:1)*Math.sqrt(Math.max(0,v*v*w-x*x));let S=(x*C-y*_)/w,A=(-x*y-C*_)/w;const R=(x*C+y*_)/w,B=(-x*y+C*_)/w,M=S-m,T=A-b,P=R-m,H=B-b;return M*M+T*T>P*P+H*H&&(S=R,A=B),{cx:S,cy:A,x01:-c,y01:-d,x11:S*(o/v-1),y11:A*(o/v-1)}}function Hs(t,e,i,r,o,n,s){const{startAngle:a,endAngle:l}=t.getParsedAngle(),h=Zt(l-a),c=l>a;let d=!1;if(o<n){const t=o;o=n,n=t}if(o<=Kt)e.moveTo(i,r);else if(h>=qt-Kt)e.moveTo(i+o*Qt(a),r+o*ie(a)),e.arc(i,r,o,a,l,!c),n>Kt&&(e.moveTo(i+n*Qt(l),r+n*ie(l)),e.arc(i,r,n,l,a,c));else{const u=t.getParsedCornerRadius(),{outerDeltaAngle:g,innerDeltaAngle:p,outerStartAngle:f,outerEndAngle:m,innerEndAngle:b,innerStartAngle:y}=t.getParsePadAngle(a,l),C=u,w=u,v=u,x=u,_=Math.max(w,C),S=Math.max(v,x);let A=_,R=S;const B=o*Qt(f),M=o*ie(f),T=n*Qt(b),P=n*ie(b);let H,E,k,L;if((S>Kt||_>Kt)&&(H=o*Qt(m),E=o*ie(m),k=n*Qt(y),L=n*ie(y),h<$t)){const t=Ts(B,M,k,L,H,E,T,P);if(t){const e=B-t[0],i=M-t[1],r=H-t[0],s=E-t[1],a=1/ie(ne((e*r+i*s)/(re(e*e+i*i)*re(r*r+s*s)))/2),l=re(t[0]*t[0]+t[1]*t[1]);R=ee(S,(n-l)/(a-1)),A=ee(_,(o-l)/(a+1))}}if(g<.001)s&&(s[3]||s[1])&&e.moveTo(i+B,r+M),d=!0;else if(A>Kt){const t=ee(C,A),n=ee(w,A),a=Ps(k,L,B,M,o,t,Number(c)),l=Ps(H,E,T,P,o,n,Number(c));A<_&&t===n?!s||s[0]?(e.moveTo(i+a.cx+a.x01,r+a.cy+a.y01),e.arc(i+a.cx,r+a.cy,A,Jt(a.y01,a.x01),Jt(l.y01,l.x01),!c)):e.moveTo(i+a.cx+A*Qt(Jt(l.y01,l.x01)),r+a.cy+A*ie(Jt(l.y01,l.x01))):!s||s[0]?(e.moveTo(i+a.cx+a.x01,r+a.cy+a.y01),t>0&&e.arc(i+a.cx,r+a.cy,t,Jt(a.y01,a.x01),Jt(a.y11,a.x11),!c),e.arc(i,r,o,Jt(a.cy+a.y11,a.cx+a.x11),Jt(l.cy+l.y11,l.cx+l.x11),!c),n>0&&e.arc(i+l.cx,r+l.cy,n,Jt(l.y11,l.x11),Jt(l.y01,l.x01),!c)):n>0?e.moveTo(i+l.cx+n*Qt(Jt(l.y01,l.x01)),r+l.cy+n*ie(Jt(l.y01,l.x01))):e.moveTo(i+H,r+o*ie(m))}else!s||s[0]?(e.moveTo(i+B,r+M),e.arc(i,r,o,f,m,!c)):e.moveTo(i+o*Qt(m),r+o*ie(m));if(!(n>Kt)||p<.001)!s||s[1]?e.lineTo(i+T,r+P):e.moveTo(i+T,r+P),d=!0;else if(R>Kt){const t=ee(x,R),o=ee(v,R),a=Ps(T,P,H,E,n,-o,Number(c)),l=Ps(B,M,k,L,n,-t,Number(c));if(!s||s[1]?e.lineTo(i+a.cx+a.x01,r+a.cy+a.y01):e.moveTo(i+a.cx+a.x01,r+a.cy+a.y01),R<S&&t===o){const t=Jt(l.y01,l.x01);!s||s[2]?e.arc(i+a.cx,r+a.cy,R,Jt(a.y01,a.x01),t,!c):e.moveTo(i+a.cx+Qt(t),r+a.cy+ie(t))}else!s||s[2]?(o>0&&e.arc(i+a.cx,r+a.cy,o,Jt(a.y01,a.x01),Jt(a.y11,a.x11),!c),e.arc(i,r,n,Jt(a.cy+a.y11,a.cx+a.x11),Jt(l.cy+l.y11,l.cx+l.x11),c),t>0&&e.arc(i+l.cx,r+l.cy,t,Jt(l.y11,l.x11),Jt(l.y01,l.x01),!c)):t>0?e.moveTo(i+l.cx+t*Qt(Jt(l.y01,l.x01)),r+l.cy+t*ie(Jt(l.y01,l.x01))):e.moveTo(i+k,r+L)}else!s||s[1]?e.lineTo(i+T,r+P):e.moveTo(i+T,r+P),!s||s[2]?e.arc(i,r,n,b,y,c):e.moveTo(i+n*Qt(y),r+n*ie(y))}return s?s[3]&&e.lineTo(i+o*Qt(a),r+o*ie(a)):e.closePath(),d}class Es{static GetCanvas(){try{return Es.canvas||(Es.canvas=kr.global.createCanvas({})),Es.canvas}catch(t){return null}}static GetCtx(){if(!Es.ctx){const t=Es.GetCanvas();Es.ctx=t.getContext("2d")}return Es.ctx}}class ks extends me{static getInstance(){return ks._instance||(ks._instance=new ks),ks._instance}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;super(),this.cacheParams={CLEAN_THRESHOLD:100,L_TIME:1e3},this.dataMap=new Map;const i=Es.GetCanvas(),r=Es.GetCtx();if(i.width=e,i.height=1,!r)return;if(r.translate(0,0),!r)throw new Error("获取ctx发生错误");const o=r.createLinearGradient(0,0,e,0);t.forEach((t=>{o.addColorStop(t[0],t[1])})),r.fillStyle=o,r.fillRect(0,0,e,1),this.rgbaSet=r.getImageData(0,0,e,1).data}getColor(t){const e=this.rgbaSet.slice(4*t,4*t+4);return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]/255})`}GetOrCreate(t,e,i,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:100,s=`${t}${e}${i}${r}`;o.forEach((t=>s+=t.join())),s+=n;let a=this.dataMap.get(s);return a||(a={data:new ks(o,n),timestamp:[]},this.addLimitedTimestamp(a,Date.now(),{}),this.dataMap.set(s,a)),this.clearCache(this.dataMap,this.cacheParams),a.data}}class Ls{static GetSize(t){for(let e=0;e<Ls.ImageSize.length;e++)if(Ls.ImageSize[e]>=t)return Ls.ImageSize[e];return t}static Get(t,e,i,r,o,n,s){const a=Ls.GenKey(t,e,i,r,o),l=Ls.cache[a];if(!l||0===l.length)return null;for(let t=0;t<l.length;t++)if(l[t].width>=n&&l[t].height>=s)return l[t].pattern;return null}static Set(t,e,i,r,o,n,s,a){const l=Ls.GenKey(t,e,i,r,o);Ls.cache[l]?Ls.cache[l].push({width:s,height:a,pattern:n}):Ls.cache[l]=[{width:s,height:a,pattern:n}]}static GenKey(t,e,i,r,o){return`${e},${i},${r},${o},${t.join()}`}}Ls.cache={},Ls.ImageSize=[20,40,80,160,320,640,1280,2560];const Fs=Symbol.for("ArcRenderContribution"),Is=Symbol.for("AreaRenderContribution"),zs=Symbol.for("CircleRenderContribution"),Os=Symbol.for("GroupRenderContribution"),Ds=Symbol.for("ImageRenderContribution"),Ws=Symbol.for("PathRenderContribution"),Ns=Symbol.for("PolygonRenderContribution"),Gs=Symbol.for("RectRenderContribution"),js=Symbol.for("SymbolRenderContribution"),Vs=Symbol.for("TextRenderContribution"),Us=Symbol.for("InteractiveSubRenderContribution"),Ks=["radius","startAngle","endAngle",...mn];let $s=class t extends xn{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{radius:1}),this.type="circle",this.numberType=Un}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{startAngle:t,endAngle:e,radius:i}=this.attribute;return this._validNumber(t)&&this._validNumber(e)&&this._validNumber(i)}doUpdateAABBBounds(t){const e=yo(this).circle;this._AABBBounds.clear();const i=this.attribute,r=kr.graphicService.updateCircleAABBBounds(i,yo(this).circle,this._AABBBounds,t,this),{boundsPadding:o=e.boundsPadding}=i,n=Xo(o);return n&&r.expand(n),this.clearUpdateBoundTag(),r}tryUpdateOBBBounds(){throw new Error("暂不支持")}getDefaultAttribute(t){return yo(this).circle[t]}needUpdateTags(t){return super.needUpdateTags(t,Ks)}needUpdateTag(t){return super.needUpdateTag(t,Ks)}toCustomPath(){var t,e,i;const r=this.attribute,o=null!==(t=r.radius)&&void 0!==t?t:this.getDefaultAttribute("radius"),n=null!==(e=r.startAngle)&&void 0!==e?e:this.getDefaultAttribute("startAngle"),s=null!==(i=r.endAngle)&&void 0!==i?i:this.getDefaultAttribute("endAngle"),a=new ar;return a.arc(0,0,o,n,s),a}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function Xs(t){return new $s(t)}function Ys(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;i||(i=1);const{fontStyle:r=e.fontStyle,fontVariant:o=e.fontVariant,fontWeight:n=e.fontWeight,fontSize:s=e.fontSize,fontFamily:a=e.fontFamily}=t;return(r?r+" ":"")+(o?o+" ":"")+(n?n+" ":"")+s*i+"px "+(a||"sans-serif")}function qs(t,e){return"end"===t||"right"===t?-e:"center"===t?-e/2:0}function Zs(t,e,i){return"middle"===t?-e/2:"top"===t?0:"bottom"===t?(arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)-e:t&&"alphabetic"!==t?0:(i||(i=e),-(e-i)/2-.79*i)}$s.NOWORK_ANIMATE_ATTR=vn;class Js{constructor(t,e,i){this.fontFamily=t,this.textOptions=e,this.textMeasure=i}LayoutBBox(t,e,i){if("left"===e||"start"===e)t.xOffset=0;else if("center"===e)t.xOffset=t.width/-2;else{if("right"!==e&&"end"!==e)throw new Error("非法的textAlign");t.xOffset=-t.width}return t.yOffset="top"===i?0:"middle"===i?t.height/-2:"alphabetic"===i?-.79*t.height:-t.height,t}GetLayout(t,e,i,r,o,n,s,a,l){const h=[],c=[e,i],d=[0,0];for(;t.length>0;){const{str:i}=this.textMeasure.clipTextWithSuffix(t,this.textOptions,e,s,a,l);h.push({str:i,width:this.textMeasure.measureTextWidth(i,this.textOptions)}),t=t.substring(i.length)}"left"===r||"start"===r||("center"===r?d[0]=c[0]/-2:"right"!==r&&"end"!==r||(d[0]=-c[0])),"top"===o||("middle"===o?d[1]=c[1]/-2:"bottom"===o&&(d[1]=-c[1]));const u={xOffset:d[0],yOffset:d[1],width:c[0],height:c[1]};return this.layoutWithBBox(u,h,r,o,n)}GetLayoutByLines(t,e,i,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",n=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"end";t=t.map((t=>t.toString()));const l=[],h=[0,0];if("number"==typeof s&&s!==1/0){let e;for(let i=0,r=t.length;i<r;i++)e=Math.min(this.textMeasure.measureTextWidth(t[i],this.textOptions),s),l.push({str:this.textMeasure.clipTextWithSuffix(t[i],this.textOptions,e,o,n,a).str,width:e});h[0]=s}else{let e,i;s=0;for(let r=0,o=t.length;r<o;r++)i=t[r],e=this.textMeasure.measureTextWidth(i,this.textOptions),s=Math.max(s,e),l.push({str:i,width:e});h[0]=s}h[1]=l.length*r,h[0]=l.reduce(((t,e)=>Math.max(t,e.width)),0);const c={xOffset:0,yOffset:0,width:h[0],height:h[1]};return this.LayoutBBox(c,e,i),this.layoutWithBBox(c,l,e,i,r)}layoutWithBBox(t,e,i,r,o){const n=[0,0],s=e.length*o;"top"===r||("middle"===r?n[1]=(t.height-s)/2:"bottom"===r&&(n[1]=t.height-s));for(let s=0;s<e.length;s++)this.lineOffset(t,e[s],i,r,o,n);return{bbox:t,lines:e,fontFamily:this.fontFamily,fontSize:this.textOptions.fontSize,fontWeight:this.textOptions.fontWeight,lineHeight:o,textAlign:i,textBaseline:r}}lineOffset(t,e,i,r,o,n){return"left"===i||"start"===i?e.leftOffset=0:"center"===i?e.leftOffset=(t.width-e.width)/2:"right"!==i&&"end"!==i||(e.leftOffset=t.width-e.width),e.topOffset=(o-this.textOptions.fontSize)/2+.79*this.textOptions.fontSize+n[1],n[1]+=o,e}}const Qs=["text","maxLineWidth","textAlign","textBaseline","heightLimit","lineClamp","fontSize","fontFamily","fontWeight","ellipsis","lineHeight","direction","wordBreak","heightLimit","lineClamp",...mn];let ta=class t extends xn{get font(){const t=yo(this).text;return this._font||(this._font=Ys(this.attribute,t)),this._font}get clipedText(){var t;const e=this.attribute,i=yo(this).text;if(!this.isSimplify())return;const{maxLineWidth:r=i.maxLineWidth}=e;return Number.isFinite(r)?(this.tryUpdateAABBBounds(),this.cache.clipedText):(null!==(t=e.text)&&void 0!==t?t:i.text).toString()}get clipedWidth(){if(this.isSimplify())return this.tryUpdateAABBBounds(),this.cache.clipedWidth}get cliped(){const t=yo(this).text,e=this.attribute;if(this.isMultiLine)return;const{maxLineWidth:i=t.maxLineWidth}=e;return!!Number.isFinite(i)&&(this.tryUpdateAABBBounds(),"vertical"===e.direction&&this.cache.verticalList&&this.cache.verticalList[0]?this.cache.verticalList[0].map((t=>t.text)).join("")!==e.text.toString():null!=this.clipedText&&this.clipedText!==e.text.toString())}get multilineLayout(){if(this.isMultiLine)return this.tryUpdateAABBBounds(),this.cache.layoutData}isSimplify(){return!this.isMultiLine&&"vertical"!==this.attribute.direction}get isMultiLine(){return Array.isArray(this.attribute.text)||"normal"===this.attribute.whiteSpace}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{text:"",fontSize:16}),this.type="text",this.numberType=rs,this.cache={}}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{text:t}=this.attribute;return et(t)?!t.every((t=>null==t||""===t)):null!=t&&""!==t}doUpdateAABBBounds(){const t=yo(this).text;this._AABBBounds.clear();const e=this.attribute,i=kr.graphicService.updateTextAABBBounds(e,t,this._AABBBounds,this),{boundsPadding:r=t.boundsPadding}=this.attribute,o=Xo(r);return o&&i.expand(o),this.clearUpdateBoundTag(),i}updateWrapAABBBounds(t){var e,i,r,o;const n=yo(this).text,{fontFamily:s=n.fontFamily,textAlign:a=n.textAlign,textBaseline:l=n.textBaseline,fontSize:h=n.fontSize,ellipsis:c=n.ellipsis,maxLineWidth:d,stroke:u=n.stroke,lineWidth:g=n.lineWidth,wordBreak:p=n.wordBreak,fontWeight:f=n.fontWeight,ignoreBuf:m=n.ignoreBuf,suffixPosition:b=n.suffixPosition,heightLimit:y=0,lineClamp:C}=this.attribute,w=null!==(e=on(this.attribute.lineHeight,this.attribute.fontSize||n.fontSize))&&void 0!==e?e:this.attribute.fontSize||n.fontSize,v=m?0:2;if(!this.shouldUpdateShape()&&(null===(i=this.cache)||void 0===i?void 0:i.layoutData)){const t=this.cache.layoutData.bbox;return this._AABBBounds.set(t.xOffset,t.yOffset,t.xOffset+t.width,t.yOffset+t.height),u&&this._AABBBounds.expand(g/2),this._AABBBounds}const x=kr.graphicUtil.textMeasure,_=new Js(s,{fontSize:h,fontWeight:f,fontFamily:s},x),S=et(t)?t.map((t=>t.toString())):[t.toString()],A=[],R=[0,0];let B=1/0;if(y>0&&(B=Math.max(Math.floor(y/w),1)),C&&(B=Math.min(B,C)),"number"==typeof d&&d!==1/0){if(d>0)for(let t=0;t<S.length;t++){const e=S[t];let i=!0;if(t===B-1){const i=_.textMeasure.clipTextWithSuffix(e,_.textOptions,d,c,!1,b,t!==S.length-1);A.push({str:i.str,width:i.width});break}const n=_.textMeasure.clipText(e,_.textOptions,d,"break-word"===p);if(""!==e&&""===n.str){if(c){const t=_.textMeasure.clipTextWithSuffix(e,_.textOptions,d,c,!1,b);n.str=null!==(r=t.str)&&void 0!==r?r:"",n.width=null!==(o=t.width)&&void 0!==o?o:0}else n.str="",n.width=0;i=!1}if(A.push({str:n.str,width:n.width}),n.str.length===e.length);else if(i){const i=e.substring(n.str.length);S.splice(t+1,0,i)}}let t=0;A.forEach((e=>{t=Math.max(t,e.width)})),R[0]=t}else{let t,e,i=0;for(let r=0,o=S.length;r<o;r++){if(r===B-1){const t=_.textMeasure.clipTextWithSuffix(S[r],_.textOptions,d,c,!1,b);A.push({str:t.str,width:t.width}),i=Math.max(i,t.width);break}e=S[r],t=_.textMeasure.measureTextWidth(e,_.textOptions,"break-word"===p),i=Math.max(i,t),A.push({str:e,width:t})}R[0]=i}R[1]=A.length*(w+v);const M={xOffset:0,yOffset:0,width:R[0],height:R[1]};_.LayoutBBox(M,a,l);const T=_.layoutWithBBox(M,A,a,l,w);return this.cache.layoutData=T,this.clearUpdateShapeTag(),this._AABBBounds.set(M.xOffset,M.yOffset,M.xOffset+M.width,M.yOffset+M.height),u&&this._AABBBounds.expand(g/2),this._AABBBounds}updateSingallineAABBBounds(t){const e=yo(this).text,{direction:i=e.direction,underlineOffset:r=e.underlineOffset}=this.attribute,o="horizontal"===i?this.updateHorizontalSinglelineAABBBounds(t):this.updateVerticalSinglelineAABBBounds(t);return"horizontal"===i&&r&&this._AABBBounds.add(this._AABBBounds.x1,this._AABBBounds.y2+r),o}updateMultilineAABBBounds(t){const e=yo(this).text,{direction:i=e.direction,underlineOffset:r=e.underlineOffset}=this.attribute,o="horizontal"===i?this.updateHorizontalMultilineAABBBounds(t):this.updateVerticalMultilineAABBBounds(t);return"horizontal"===i&&r&&this._AABBBounds.add(this._AABBBounds.x1,this._AABBBounds.y2+r),o}updateHorizontalSinglelineAABBBounds(t){var e,i;const r=yo(this).text,{wrap:o=r.wrap}=this.attribute;if(o)return this.updateWrapAABBBounds([t]);const n=kr.graphicUtil.textMeasure;let s,a;const l=this.attribute,{maxLineWidth:h=r.maxLineWidth,ellipsis:c=r.ellipsis,textAlign:d=r.textAlign,textBaseline:u=r.textBaseline,fontFamily:g=r.fontFamily,fontSize:p=r.fontSize,fontWeight:f=r.fontWeight,stroke:m=r.stroke,lineWidth:b=r.lineWidth,ignoreBuf:y=r.ignoreBuf,whiteSpace:C=r.whiteSpace,suffixPosition:w=r.suffixPosition}=l;if("normal"===C)return this.updateWrapAABBBounds(t);const v=y?0:Math.max(2,.075*p),x=l.fontSize||r.fontSize,_=null!==(e=on(l.lineHeight,x))&&void 0!==e?e:x+v;if(!this.shouldUpdateShape()&&this.cache){s=null!==(i=this.cache.clipedWidth)&&void 0!==i?i:0;const t=qs(d,s),e=Zs(u,_,p);return this._AABBBounds.set(t,e,t+s,e+_),m&&this._AABBBounds.expand(b/2),this._AABBBounds}if(Number.isFinite(h)){if(c){const e=!0===c?r.ellipsis:c,i=n.clipTextWithSuffix(t.toString(),{fontSize:p,fontWeight:f,fontFamily:g},h,e,!1,w);a=i.str,s=i.width}else{const e=n.clipText(t.toString(),{fontSize:p,fontWeight:f,fontFamily:g},h,!1);a=e.str,s=e.width}this.cache.clipedText=a,this.cache.clipedWidth=s}else s=n.measureTextWidth(t.toString(),{fontSize:p,fontWeight:f,fontFamily:g}),this.cache.clipedText=t.toString(),this.cache.clipedWidth=s;this.clearUpdateShapeTag();const S=qs(d,s);let A=_;kr.global&&kr.global.isSafari()&&(A+=.2*p);const R=Zs(u,A,p,v);return this._AABBBounds.set(S,R,S+s,R+A),m&&this._AABBBounds.expand(b/2),this._AABBBounds}getBaselineMapAlign(){return t.baselineMapAlign}getAlignMapBaseline(){return t.alignMapBaseline}updateVerticalSinglelineAABBBounds(e){var i,r,o;const n=yo(this).text,s=kr.graphicUtil.textMeasure;let a;const l=this.attribute,{ignoreBuf:h=n.ignoreBuf}=l,c=h?0:2,{maxLineWidth:d=n.maxLineWidth,ellipsis:u=n.ellipsis,fontSize:g=n.fontSize,fontWeight:p=n.fontWeight,fontFamily:f=n.fontFamily,stroke:m=n.stroke,lineWidth:b=n.lineWidth,verticalMode:y=n.verticalMode,suffixPosition:C=n.suffixPosition}=l,w=null!==(i=on(l.lineHeight,l.fontSize||n.fontSize))&&void 0!==i?i:(l.fontSize||n.fontSize)+c;let{textAlign:v=n.textAlign,textBaseline:x=n.textBaseline}=l;if(!y){const e=v;v=null!==(r=t.baselineMapAlign[x])&&void 0!==r?r:"left",x=null!==(o=t.alignMapBaseline[e])&&void 0!==o?o:"top"}if(!this.shouldUpdateShape()&&this.cache){a=this.cache.clipedWidth;const t=qs(v,a),e=Zs(x,w,g);return this._AABBBounds.set(e,t,e+w,t+a),m&&this._AABBBounds.expand(b/2),this._AABBBounds}let _=[On(e.toString())];if(Number.isFinite(d)){if(u){const t=!0===u?n.ellipsis:u,e=s.clipTextWithSuffixVertical(_[0],{fontSize:g,fontWeight:p,fontFamily:f},d,t,!1,C);_=[e.verticalList],a=e.width}else{const t=s.clipTextVertical(_[0],{fontSize:g,fontWeight:p,fontFamily:f},d,!1);_=[t.verticalList],a=t.width}this.cache.verticalList=_,this.cache.clipedWidth=a}else a=0,_[0].forEach((t=>{const e=t.direction===zn.HORIZONTAL?g:s.measureTextWidth(t.text,{fontSize:g,fontWeight:p,fontFamily:f});a+=e,t.width=e})),this.cache.verticalList=_,this.cache.clipedWidth=a;this.clearUpdateShapeTag();const S=qs(v,a),A=Zs(x,w,g);return this._AABBBounds.set(A,S,A+w,S+a),m&&this._AABBBounds.expand(b/2),this._AABBBounds}updateHorizontalMultilineAABBBounds(t){var e,i;const r=yo(this).text,{wrap:o=r.wrap}=this.attribute;if(o)return this.updateWrapAABBBounds(t);const n=this.attribute,{fontFamily:s=r.fontFamily,textAlign:a=r.textAlign,textBaseline:l=r.textBaseline,fontSize:h=r.fontSize,fontWeight:c=r.fontWeight,ellipsis:d=r.ellipsis,maxLineWidth:u,stroke:g=r.stroke,lineWidth:p=r.lineWidth,whiteSpace:f=r.whiteSpace,suffixPosition:m=r.suffixPosition}=n,b=null!==(e=on(n.lineHeight,n.fontSize||r.fontSize))&&void 0!==e?e:n.fontSize||r.fontSize;if("normal"===f)return this.updateWrapAABBBounds(t);if(!this.shouldUpdateShape()&&(null===(i=this.cache)||void 0===i?void 0:i.layoutData)){const t=this.cache.layoutData.bbox;return this._AABBBounds.set(t.xOffset,t.yOffset,t.xOffset+t.width,t.yOffset+t.height),g&&this._AABBBounds.expand(p/2),this._AABBBounds}const y=kr.graphicUtil.textMeasure,C=new Js(s,{fontSize:h,fontWeight:c,fontFamily:s},y).GetLayoutByLines(t,a,l,b,!0===d?r.ellipsis:d||void 0,!1,u,m),{bbox:w}=C;return this.cache.layoutData=C,this.clearUpdateShapeTag(),this._AABBBounds.set(w.xOffset,w.yOffset,w.xOffset+w.width,w.yOffset+w.height),g&&this._AABBBounds.expand(p/2),this._AABBBounds}updateVerticalMultilineAABBBounds(e){var i,r,o;const n=yo(this).text,s=kr.graphicUtil.textMeasure;let a;const l=this.attribute,{ignoreBuf:h=n.ignoreBuf}=l,c=h?0:2,{maxLineWidth:d=n.maxLineWidth,ellipsis:u=n.ellipsis,fontFamily:g=n.fontFamily,fontSize:p=n.fontSize,fontWeight:f=n.fontWeight,stroke:m=n.stroke,lineWidth:b=n.lineWidth,verticalMode:y=n.verticalMode,suffixPosition:C=n.suffixPosition}=l,w=null!==(i=on(l.lineHeight,l.fontSize||n.fontSize))&&void 0!==i?i:(l.fontSize||n.fontSize)+c;let{textAlign:v=n.textAlign,textBaseline:x=n.textBaseline}=l;if(!y){const e=v;v=null!==(r=t.baselineMapAlign[x])&&void 0!==r?r:"left",x=null!==(o=t.alignMapBaseline[e])&&void 0!==o?o:"top"}if(a=0,!this.shouldUpdateShape()&&this.cache){this.cache.verticalList.forEach((t=>{const e=t.reduce(((t,e)=>t+e.width),0);a=te(e,a)}));const t=qs(v,a),e=this.cache.verticalList.length*w,i=Zs(x,e,p);return this._AABBBounds.set(i,t,i+e,t+a),m&&this._AABBBounds.expand(b/2),this._AABBBounds}const _=e.map((t=>On(t.toString())));_.forEach(((t,e)=>{if(Number.isFinite(d))if(u){const i=!0===u?n.ellipsis:u,r=s.clipTextWithSuffixVertical(t,{fontSize:p,fontWeight:f,fontFamily:g},d,i,!1,C);_[e]=r.verticalList,a=r.width}else{const i=s.clipTextVertical(t,{fontSize:p,fontWeight:f,fontFamily:g},d,!1);_[e]=i.verticalList,a=i.width}else a=0,t.forEach((t=>{const e=t.direction===zn.HORIZONTAL?p:s.measureTextWidth(t.text,{fontSize:p,fontWeight:f,fontFamily:g});a+=e,t.width=e}))})),this.cache.verticalList=_,this.clearUpdateShapeTag(),this.cache.verticalList.forEach((t=>{const e=t.reduce(((t,e)=>t+e.width),0);a=te(e,a)}));const S=qs(v,a),A=this.cache.verticalList.length*w,R=Zs(x,A,p);return this._AABBBounds.set(R,S,R+A,S+a),m&&this._AABBBounds.expand(b/2),this._AABBBounds}tryUpdateOBBBounds(){throw new Error("暂不支持")}getDefaultAttribute(t){return yo(this).text[t]}needUpdateTags(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Qs;return super.needUpdateTags(t,e)}needUpdateTag(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Qs;return super.needUpdateTag(t,e)}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function ea(t){return new ta(t)}ta.NOWORK_ANIMATE_ATTR=Object.assign({ellipsis:1,wordBreak:1,direction:1,textAlign:1,textBaseline:1,fontFamily:1,fontWeight:1},vn),ta.baselineMapAlign={top:"left",bottom:"right",middle:"center"},ta.alignMapBaseline={left:"top",right:"bottom",center:"middle"};const ia=["heightLimit","lineClamp"];class ra extends ta{constructor(t){super(Object.assign(Object.assign({},t),{wrap:!0}))}_isValid(){const{text:t}=this.attribute;return et(t)?!t.every((t=>null==t||""===t)):null!=t&&""!==t}updateMultilineAABBBounds(t){var e,i,r,o;const n=yo(this).text,{fontFamily:s=n.fontFamily,textAlign:a=n.textAlign,textBaseline:l=n.textBaseline,fontSize:h=n.fontSize,ellipsis:c=n.ellipsis,maxLineWidth:d,stroke:u=n.stroke,lineWidth:g=n.lineWidth,wordBreak:p=n.wordBreak,fontWeight:f=n.fontWeight,ignoreBuf:m=n.ignoreBuf,heightLimit:b=0,suffixPosition:y=n.suffixPosition,lineClamp:C}=this.attribute,w=null!==(e=on(this.attribute.lineHeight,this.attribute.fontSize||n.fontSize))&&void 0!==e?e:this.attribute.fontSize||n.fontSize,v=m?0:2;if(!this.shouldUpdateShape()&&(null===(i=this.cache)||void 0===i?void 0:i.layoutData)){const t=this.cache.layoutData.bbox;return this._AABBBounds.set(t.xOffset,t.yOffset,t.xOffset+t.width,t.yOffset+t.height),u&&this._AABBBounds.expand(g/2),this._AABBBounds}const x=kr.graphicUtil.textMeasure,_=new Js(s,{fontSize:h,fontWeight:f,fontFamily:s},x),S=t.map((t=>t.toString())),A=[],R=[0,0];let B=1/0;if(b>0&&(B=Math.max(Math.floor(b/w),1)),C&&(B=Math.min(B,C)),"number"==typeof d&&d!==1/0){if(d>0)for(let t=0;t<S.length;t++){const e=S[t];let i=!0;if(t===B-1){const t=_.textMeasure.clipTextWithSuffix(e,_.textOptions,d,c,!1,y);A.push({str:t.str,width:t.width});break}const n=_.textMeasure.clipText(e,_.textOptions,d,"break-word"===p);if(""!==e&&""===n.str){if(c){const t=_.textMeasure.clipTextWithSuffix(e,_.textOptions,d,c,!1,y);n.str=null!==(r=t.str)&&void 0!==r?r:"",n.width=null!==(o=t.width)&&void 0!==o?o:0}else n.str="",n.width=0;i=!1}if(A.push({str:n.str,width:n.width}),n.str.length===e.length);else if(i){const i=e.substring(n.str.length);S.splice(t+1,0,i)}}let t=0;A.forEach((e=>{t=Math.max(t,e.width)})),R[0]=t}else{let t,e,i=0;for(let r=0,o=S.length;r<o;r++){if(r===B-1){const t=_.textMeasure.clipTextWithSuffix(S[r],_.textOptions,d,c,!1,y);A.push({str:t.str,width:t.width}),i=Math.max(i,t.width);break}e=S[r],t=_.textMeasure.measureTextWidth(e,_.textOptions,"break-word"===p),i=Math.max(i,t),A.push({str:e,width:t})}R[0]=i}R[1]=A.length*(w+v);const M={xOffset:0,yOffset:0,width:R[0],height:R[1]};_.LayoutBBox(M,a,l);const T=_.layoutWithBBox(M,A,a,l,w);return this.cache.layoutData=T,this.clearUpdateShapeTag(),this._AABBBounds.set(M.xOffset,M.yOffset,M.xOffset+M.width,M.yOffset+M.height),u&&this._AABBBounds.expand(g/2),this._AABBBounds}needUpdateTags(t){for(let e=0;e<ia.length;e++){const i=ia[e];if(-1!==t.indexOf(i))return!0}return super.needUpdateTags(t)}needUpdateTag(t){for(let e=0;e<ia.length;e++)if(t===ia[e])return!0;return super.needUpdateTag(t)}getNoWorkAnimateAttr(){return ra.NOWORK_ANIMATE_ATTR}}function oa(t){return new ra(t)}class na{bounds(t,e){if(ot(t)){const i=t/2;e.x1=-i,e.x2=i,e.y1=-i,e.y2=i}else e.x1=-t[0]/2,e.x2=t[0]/2,e.y1=-t[1]/2,e.y2=t[1]/2}}function sa(t,e,i,r,o){return o?t.arc(i,r,e,0,Yt,!1,o):t.arc(i,r,e,0,Yt),!1}var aa=new class extends na{constructor(){super(...arguments),this.type="circle",this.pathStr="M0.5,0A0.5,0.5,0,1,1,-0.5,0A0.5,0.5,0,1,1,0.5,0"}draw(t,e,i,r,o){return sa(t,e/2,i,r,o)}drawOffset(t,e,i,r,o,n){return sa(t,e/2+o,i,r,n)}drawToSvgPath(t,e,i,r){const o=t/2;return`M ${e-o}, ${i} a ${o},${o} 0 1,0 ${2*o},0 a ${o},${o} 0 1,0 -${2*o},0`}};var la=new class extends na{constructor(){super(...arguments),this.type="cross",this.pathStr="M-0.5,-0.2L-0.5,0.2L-0.2,0.2L-0.2,0.5L0.2,0.5L0.2,0.2L0.5,0.2L0.5,-0.2L0.2,-0.2L0.2,-0.5L-0.2,-0.5L-0.2,-0.2Z"}draw(t,e,i,r,o){return function(t,e,i,r,o){return t.moveTo(-3*e+i,-e+r,o),t.lineTo(-e+i,-e+r,o),t.lineTo(-e+i,-3*e+r,o),t.lineTo(e+i,-3*e+r,o),t.lineTo(e+i,-e+r,o),t.lineTo(3*e+i,-e+r,o),t.lineTo(3*e+i,e+r,o),t.lineTo(e+i,e+r,o),t.lineTo(e+i,3*e+r,o),t.lineTo(-e+i,3*e+r,o),t.lineTo(-e+i,e+r,o),t.lineTo(-3*e+i,e+r,o),t.closePath(),!0}(t,e/6,i,r,o)}drawOffset(t,e,i,r,o,n){return function(t,e,i,r,o,n){return t.moveTo(-3*e+i-o,-e+r-o,n),t.lineTo(-e+i-o,-e+r-o,n),t.lineTo(-e+i-o,-3*e+r-o,n),t.lineTo(e+i+o,-3*e+r-o,n),t.lineTo(e+i+o,-e+r-o,n),t.lineTo(3*e+i+o,-e+r-o,n),t.lineTo(3*e+i+o,e+r+o,n),t.lineTo(e+i+o,e+r+o,n),t.lineTo(e+i+o,3*e+r+o,n),t.lineTo(-e+i-o,3*e+r+o,n),t.lineTo(-e+i-o,e+r+o,n),t.lineTo(-3*e+i-o,e+r+o,n),t.closePath(),!0}(t,e/6,i,r,o,n)}};function ha(t,e,i,r,o){return t.moveTo(i,r-e,o),t.lineTo(e+i,r,o),t.lineTo(i,r+e,o),t.lineTo(i-e,r,o),t.closePath(),!0}var ca=new class extends na{constructor(){super(...arguments),this.type="diamond",this.pathStr="M-0.5,0L0,-0.5L0.5,0L0,0.5Z"}draw(t,e,i,r,o){return ha(t,e/2,i,r,o)}drawFitDir(t,e,i,r,o){return ha(t,e/2,i,r,o)}drawOffset(t,e,i,r,o,n){return ha(t,e/2+o,i,r,n)}};function da(t,e,i,r){const o=2*e;return t.rect(i-e,r-e,o,o),!1}var ua=new class extends na{constructor(){super(...arguments),this.type="square",this.pathStr="M-0.5,-0.5h1v1h-1Z"}draw(t,e,i,r){return da(t,e/2,i,r)}drawOffset(t,e,i,r,o){return da(t,e/2+o,i,r)}};class ga extends na{constructor(){super(...arguments),this.type="triangleUp",this.pathStr="M0.5,0.5 L-0.5,0.5 L0,-0.5 Z"}draw(t,e,i,r){return function(t,e,i,r){return t.moveTo(i+e,e+r),t.lineTo(i-e,e+r),t.lineTo(i,r-e),t.closePath(),!0}(t,e/2,i,r)}drawOffset(t,e,i,r,o){return function(t,e,i,r,o){return t.moveTo(i+e+2*o,e+r+o),t.lineTo(i-e-2*o,e+r+o),t.lineTo(i,r-e-2*o),t.closePath(),!0}(t,e/2,i,r,o)}}var pa=new ga;var fa=new class extends ga{constructor(){super(...arguments),this.type="triangle"}};const ma=Math.sin(Math.PI/10)/Math.sin(7*Math.PI/10),ba=Math.sin(Yt/10)*ma,ya=-Math.cos(Yt/10)*ma;function Ca(t,e,i,r){const o=ba*e,n=ya*e;t.moveTo(i,-e+r),t.lineTo(o+i,n+r);for(let s=1;s<5;++s){const a=Yt*s/5,l=Math.cos(a),h=Math.sin(a);t.lineTo(h*e+i,-l*e+r),t.lineTo(l*o-h*n+i,h*o+l*n+r)}return t.closePath(),!0}var wa=new class extends na{constructor(){super(...arguments),this.type="star",this.pathStr="M0 -1L0.22451398828979266 -0.3090169943749474L0.9510565162951535 -0.30901699437494745L0.3632712640026804 0.1180339887498948L0.5877852522924732 0.8090169943749473L8.326672684688674e-17 0.3819660112501051L-0.587785252292473 0.8090169943749476L-0.3632712640026804 0.11803398874989487L-0.9510565162951536 -0.30901699437494723L-0.22451398828979274 -0.30901699437494734Z"}draw(t,e,i,r){return Ca(t,e/2,i,r)}drawOffset(t,e,i,r,o){return Ca(t,e/2+o,i,r)}};const va=re(3);function xa(t,e,i,r){const o=e,n=o/va,s=n/5,a=e;return t.moveTo(0+i,-o+r),t.lineTo(n/2+i,r),t.lineTo(s/2+i,r),t.lineTo(s/2+i,a+r),t.lineTo(-s/2+i,a+r),t.lineTo(-s/2+i,r),t.lineTo(-n/2+i,r),t.closePath(),!0}var _a=new class extends na{constructor(){super(...arguments),this.type="arrow",this.pathStr="M-0.07142857142857142,0.5L0.07142857142857142,0.5L0.07142857142857142,-0.0625L0.2,-0.0625L0,-0.5L-0.2,-0.0625L-0.07142857142857142,-0.0625Z"}draw(t,e,i,r){return xa(t,e/2,i,r)}drawOffset(t,e,i,r,o){return xa(t,e/2+o,i,r)}};function Sa(t,e,i,r){const o=2*e;return t.moveTo(i,-e+r),t.lineTo(o/3/2+i,e+r),t.lineTo(-o/3/2+i,e+r),t.closePath(),!0}var Aa=new class extends na{constructor(){super(...arguments),this.type="wedge",this.pathStr="M0,-0.5773502691896257L-0.125,0.28867513459481287L0.125,0.28867513459481287Z"}draw(t,e,i,r){return Sa(t,e/2,i,r)}drawOffset(t,e,i,r,o){return Sa(t,e/2+o,i,r)}};function Ra(t,e,i,r){return t.moveTo(-e+i,r),t.lineTo(i,e+r),!1}var Ba=new class extends na{constructor(){super(...arguments),this.type="stroke",this.pathStr=""}draw(t,e,i,r){return Ra(t,e/2,i,r)}drawOffset(t,e,i,r,o){return Ra(t,e/2+o,i,r)}};const Ma=-.5,Ta=re(3)/2,Pa=1/re(12);function Ha(t,e,i,r){const o=e/2,n=e*Pa,s=o,a=e*Pa+e,l=-s,h=a;return t.moveTo(o+i,n+r),t.lineTo(s+i,a+r),t.lineTo(l+i,h+r),t.lineTo(Ma*o-Ta*n+i,Ta*o+Ma*n+r),t.lineTo(Ma*s-Ta*a+i,Ta*s+Ma*a+r),t.lineTo(Ma*l-Ta*h+i,Ta*l+Ma*h+r),t.lineTo(Ma*o+Ta*n+i,Ma*n-Ta*o+r),t.lineTo(Ma*s+Ta*a+i,Ma*a-Ta*s+r),t.lineTo(Ma*l+Ta*h+i,Ma*h-Ta*l+r),t.closePath(),!1}var Ea=new class extends na{constructor(){super(...arguments),this.type="wye",this.pathStr="M0.25 0.14433756729740646L0.25 0.6443375672974064L-0.25 0.6443375672974064L-0.25 0.14433756729740643L-0.6830127018922193 -0.10566243270259357L-0.4330127018922193 -0.5386751345948129L0 -0.28867513459481287L0.4330127018922193 -0.5386751345948129L0.6830127018922193 -0.10566243270259357Z"}draw(t,e,i,r){return Ha(t,e/2,i,r)}drawOffset(t,e,i,r,o){return Ha(t,e/2+o,i,r)}};var ka=new class extends na{constructor(){super(...arguments),this.type="triangleLeft",this.pathStr="M-0.5,0 L0.5,0.5 L0.5,-0.5 Z"}draw(t,e,i,r){return function(t,e,i,r){return t.moveTo(-e+i,r),t.lineTo(e+i,e+r),t.lineTo(e+i,r-e),t.closePath(),!0}(t,e/2,i,r)}drawOffset(t,e,i,r,o){return function(t,e,i,r,o){return t.moveTo(-e+i-2*o,r),t.lineTo(e+i+o,e+r+2*o),t.lineTo(e+i+o,r-e-2*o),t.closePath(),!0}(t,e/2,i,r,o)}};var La=new class extends na{constructor(){super(...arguments),this.type="triangleRight",this.pathStr="M-0.5,0.5 L0.5,0 L-0.5,-0.5 Z"}draw(t,e,i,r){return function(t,e,i,r){return t.moveTo(i-e,e+r),t.lineTo(e+i,r),t.lineTo(i-e,r-e),t.closePath(),!0}(t,e/2,i,r)}drawOffset(t,e,i,r,o){return function(t,e,i,r,o){return t.moveTo(i-e-o,e+r+2*o),t.lineTo(e+i+2*o,r),t.lineTo(i-e-o,r-e-2*o),t.closePath(),!0}(t,e/2,i,r,o)}};var Fa=new class extends na{constructor(){super(...arguments),this.type="triangleDown",this.pathStr="M-0.5,-0.5 L0.5,-0.5 L0,0.5 Z"}draw(t,e,i,r){return function(t,e,i,r){return t.moveTo(i-e,r-e),t.lineTo(i+e,r-e),t.lineTo(i,r+e),t.closePath(),!0}(t,e/2,i,r)}drawOffset(t,e,i,r,o){return function(t,e,i,r,o){return t.moveTo(i-e-2*o,r-e-o),t.lineTo(i+e+2*o,r-e-o),t.lineTo(i,r+e+2*o),t.closePath(),!0}(t,e/2,i,r,o)}};const Ia=re(3);function za(t,e,i,r){const o=e*Ia;return t.moveTo(i,r+-o/3*2),t.lineTo(e+i,r+o),t.lineTo(i-e,r+o),t.closePath(),!0}var Oa=new class extends ga{constructor(){super(...arguments),this.type="thinTriangle",this.pathStr="M0,-0.5773502691896257L-0.5,0.28867513459481287L0.5,0.28867513459481287Z"}draw(t,e,i,r){return za(t,e/2/Ia,i,r)}drawOffset(t,e,i,r,o){return za(t,e/2/Ia+o,i,r)}};function Da(t,e,i,r){const o=2*e;return t.moveTo(e+i,r-o),t.lineTo(i-e,r),t.lineTo(e+i,o+r),!0}var Wa=new class extends na{constructor(){super(...arguments),this.type="arrow2Left",this.pathStr="M 0.25 -0.5 L -0.25 0 l 0.25 0.5"}draw(t,e,i,r){return Da(t,e/4,i,r)}drawOffset(t,e,i,r,o){return Da(t,e/4+o,i,r)}};function Na(t,e,i,r){const o=2*e;return t.moveTo(i-e,r-o),t.lineTo(i+e,r),t.lineTo(i-e,o+r),!0}var Ga=new class extends na{constructor(){super(...arguments),this.type="arrow2Right",this.pathStr="M -0.25 -0.5 l 0.25 0 l -0.25 0.5"}draw(t,e,i,r){return Na(t,e/4,i,r)}drawOffset(t,e,i,r,o){return Na(t,e/4+o,i,r)}};function ja(t,e,i,r){const o=2*e;return t.moveTo(i-o,r+e),t.lineTo(i,r-e),t.lineTo(i+o,r+e),!0}var Va=new class extends na{constructor(){super(...arguments),this.type="arrow2Up",this.pathStr="M -0.5 0.25 L 0 -0.25 l 0.5 0.25"}draw(t,e,i,r){return ja(t,e/4,i,r)}drawOffset(t,e,i,r,o){return ja(t,e/4+o,i,r)}};function Ua(t,e,i,r){const o=2*e;return t.moveTo(i-o,r-e),t.lineTo(i,r+e),t.lineTo(i+o,r-e),!0}var Ka=new class extends na{constructor(){super(...arguments),this.type="arrow2Down",this.pathStr="M -0.5 -0.25 L 0 0.25 l 0.5 -0.25"}draw(t,e,i,r){return Ua(t,e/4,i,r)}drawOffset(t,e,i,r,o){return Ua(t,e/4+o,i,r)}};function $a(t,e,i,r,o){return t.moveTo(i,r-e),t.lineTo(i,r+e),!0}var Xa=new class extends na{constructor(){super(...arguments),this.type="lineV",this.pathStr="M0,-0.5L0,0.5"}draw(t,e,i,r,o){return $a(t,e/2,i,r)}drawOffset(t,e,i,r,o,n){return $a(t,e/2+o,i,r)}drawToSvgPath(t,e,i,r){const o=t/2;return`M ${e}, ${i-o} L ${e},${i+o}`}};function Ya(t,e,i,r,o){return t.moveTo(i-e,r),t.lineTo(i+e,r),!0}var qa=new class extends na{constructor(){super(...arguments),this.type="lineH",this.pathStr="M-0.5,0L0.5,0"}draw(t,e,i,r,o){return Ya(t,e/2,i,r)}drawOffset(t,e,i,r,o,n){return Ya(t,e/2+o,i,r)}drawToSvgPath(t,e,i,r){const o=t/2;return`M ${e-o}, ${i} L ${e+o},${i}`}};function Za(t,e,i,r,o){return t.moveTo(i-e,r-e),t.lineTo(i+e,r+e),t.moveTo(i+e,r-e),t.lineTo(i-e,r+e),!0}var Ja=new class extends na{constructor(){super(...arguments),this.type="close",this.pathStr="M-0.5,-0.5L0.5,0.5,M0.5,-0.5L-0.5,0.5"}draw(t,e,i,r,o){return Za(t,e/2,i,r)}drawOffset(t,e,i,r,o,n){return Za(t,e/2+o,i,r)}drawToSvgPath(t,e,i,r){const o=t/2;return`M ${e-o}, ${i-o} L ${e+o},${i+o} M ${e+o}, ${i-o} L ${e-o},${i+o}`}};function Qa(t,e,i,r){return t.rect(i-e[0]/2,r-e[1]/2,e[0],e[1]),!1}function tl(t,e,i,r){const o=e,n=e/2;return t.rect(i-o/2,r-n/2,o,n),!1}var el=new class extends na{constructor(){super(...arguments),this.type="rect",this.pathStr="M -0.5,0.25 L 0.5,0.25 L 0.5,-0.25,L -0.5,-0.25 Z"}draw(t,e,i,r){return ot(e)?tl(t,e,i,r):Qa(t,e,i,r)}drawOffset(t,e,i,r,o){return ot(e)?tl(t,e+2*o,i,r):Qa(t,[e[0]+2*o,e[1]+2*o],i,r)}};const il=new ue;class rl{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.pathStr="",this.type=t,et(e)?this.svgCache=e:this.path=e,this.isSvg=i}drawOffset(t,e,i,r,o,n,s){return this.isSvg?!!this.svgCache&&(this.svgCache.forEach((o=>{t.beginPath(),Pi(o.path.commandList,t,i,r,e,e),s&&s(o.path,o.attribute)})),!1):(Pi(this.path.commandList,t,i,r,e+o,e+o),!1)}draw(t,e,i,r,o,n){return this.isSvg?!!this.svgCache&&(this.svgCache.forEach((o=>{t.beginPath(),Pi(o.path.commandList,t,i,r,e,e),n&&n(o.path,o.attribute)})),!1):(Pi(this.path.commandList,t,i,r,e,e),!1)}bounds(t,e){if(this.isSvg){if(!this.svgCache)return;return e.clear(),void this.svgCache.forEach((i=>{let{path:r}=i;il.x1=r.bounds.x1*t,il.y1=r.bounds.y1*t,il.x2=r.bounds.x2*t,il.y2=r.bounds.y2*t,e.union(il)}))}this.path.bounds&&(e.x1=this.path.bounds.x1*t,e.y1=this.path.bounds.y1*t,e.x2=this.path.bounds.x2*t,e.y2=this.path.bounds.y2*t)}}const ol={};[aa,la,ca,ua,Oa,fa,wa,_a,Aa,Ba,Ea,ka,La,pa,Fa,Wa,Ga,Va,Ka,el,Xa,qa,Ja].forEach((t=>{ol[t.type]=t}));const nl={arrowLeft:"M 0.25 -0.5 L -0.25 0 l 0.5 0.5",arrowRight:"M -0.25 -0.5 l 0.5 0.5 l -0.5 0.5",rectRound:"M 0.3 -0.5 C 0.41 -0.5 0.5 -0.41 0.5 -0.3 C 0.5 -0.3 0.5 0.3 0.5 0.3 C 0.5 0.41 0.41 0.5 0.3 0.5 C 0.3 0.5 -0.3 0.5 -0.3 0.5 C -0.41 0.5 -0.5 0.41 -0.5 0.3 C -0.5 0.3 -0.5 -0.3 -0.5 -0.3 C -0.5 -0.41 -0.41 -0.5 -0.3 -0.5 C -0.3 -0.5 0.3 -0.5 0.3 -0.5 Z",roundLine:"M 1.2392 -0.258 L -1.3432 -0.258 C -1.4784 -0.258 -1.588 -0.1436 -1.588 -0.002 c 0 0.1416 0.1096 0.256 0.2448 0.256 l 2.5824 0 c 0.1352 0 0.2448 -0.1144 0.2448 -0.256 C 1.484 -0.1436 1.3744 -0.258 1.2392 -0.258 z"},sl=new ue,al=["symbolType","size",...mn];let ll=class t extends xn{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{symbolType:"circle"}),this.type="symbol",this.numberType=is}getParsedPath(){return this.shouldUpdateShape()&&(this.doUpdateParsedPath(),this.clearUpdateShapeTag()),this._parsedPath}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{size:t}=this.attribute;return et(t)?2===t.length&&t.every(this._validNumber):this._validNumber(t)}doUpdateParsedPath(){const e=yo(this).symbol;let{symbolType:i=e.symbolType}=this.attribute,r=ol[i];if(r)return this._parsedPath=r,r;if(r=t.userSymbolMap[i],r)return this._parsedPath=r,r;if(i=nl[i]||i,!0===function(t){return t.startsWith("<svg")||t.startsWith("<?xml")}(i)){const e=new kn,{svg:r}=e.parse(i);if(!r)return null;const o=et(r.path)?r.path:[r.path];sl.clear();const n=[];o.forEach((t=>{const e=(new ar).fromString(t.d),i={};as.forEach((e=>{t[e]&&(i[ss[e]]=t[e])})),n.push({path:e,attribute:i}),sl.union(e.bounds)}));const s=sl.width(),a=sl.height(),l=1/te(s,a);return n.forEach((t=>t.path.transform(0,0,l,l))),this._parsedPath=new rl(i,n,!0),t.userSymbolMap[i]=this._parsedPath,this._parsedPath}const o=(new ar).fromString(i),n=o.bounds.width(),s=o.bounds.height(),a=1/te(n,s);return o.transform(0,0,a,a),this._parsedPath=new rl(i,o),t.userSymbolMap[i]=this._parsedPath,this._parsedPath}doUpdateAABBBounds(t){const e=yo(this).symbol;this._AABBBounds.clear();const i=this.attribute,r=kr.graphicService.updateSymbolAABBBounds(i,yo(this).symbol,this._AABBBounds,t,this),{boundsPadding:o=e.boundsPadding}=i,n=Xo(o);return n&&r.expand(n),this.clearUpdateBoundTag(),r}tryUpdateOBBBounds(){throw new Error("暂不支持")}getDefaultAttribute(t){return yo(this).symbol[t]}needUpdateTags(t){return super.needUpdateTags(t,al)}needUpdateTag(t){return super.needUpdateTag(t,al)}toCustomPath(){const t=this.getParsedPath(),e=this.attribute.size,i=et(e)?e:[e,e];return t.path?(new ar).fromCustomPath2D(t.path,0,0,i[0],i[1]):(new ar).fromString(t.pathStr,0,0,i[0],i[1])}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function hl(t){return new ll(t)}ll.userSymbolMap={},ll.NOWORK_ANIMATE_ATTR=Object.assign({symbolType:1},vn);const cl=["segments","points","curveType",...mn];let dl=class t extends xn{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this.type="line",this.numberType=Yn}isValid(){return super.isValid()&&this._isValid()}_isValid(){if(this.pathProxy)return!0;const{points:t,segments:e}=this.attribute;return e?0!==e.length:!(!t||t.length<=1)}_interpolate(t,e,i,r,o){"points"===t&&(o.points=Qo(i,r,e))}doUpdateAABBBounds(){const t=yo(this).line;this._AABBBounds.clear();const e=this.attribute,i=kr.graphicService.updateLineAABBBounds(e,yo(this).line,this._AABBBounds,this),{boundsPadding:r=t.boundsPadding}=e,o=Xo(r);return o&&i.expand(o),this.clearUpdateBoundTag(),i}tryUpdateOBBBounds(){throw new Error("暂不支持")}getDefaultAttribute(t){return yo(this).line[t]}needUpdateTags(t){return super.needUpdateTags(t,cl)}needUpdateTag(t){return super.needUpdateTag(t,cl)}toCustomPath(){const t=this.attribute,e=new ar,i=t.segments,r=t=>{if(t&&t.length){let i=!0;t.forEach((t=>{!1!==t.defined&&(i?e.moveTo(t.x,t.y):e.lineTo(t.x,t.y),i=!1)}))}};return i&&i.length?i.forEach((t=>{r(t.points)})):t.points&&r(t.points),e}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function ul(t){return new dl(t)}dl.NOWORK_ANIMATE_ATTR=Object.assign({segments:1,curveType:1},vn);const gl=["width","x1","y1","height","cornerRadius",...mn];let pl=class t extends xn{constructor(t){super(t),this.type="rect",this.numberType=Qn}isValid(){return super.isValid()&&this._isValid()}_isValid(){return!0}doUpdateAABBBounds(){const t=yo(this).rect;this._AABBBounds.clear();const e=this.attribute,i=kr.graphicService.updateRectAABBBounds(e,yo(this).rect,this._AABBBounds,this),{boundsPadding:r=t.boundsPadding}=e,o=Xo(r);return o&&i.expand(o),this.clearUpdateBoundTag(),i}tryUpdateOBBBounds(){throw new Error("暂不支持")}getDefaultAttribute(t){return yo(this).rect[t]}needUpdateTags(t){return super.needUpdateTags(t,gl)}needUpdateTag(t){return super.needUpdateTag(t,gl)}toCustomPath(){const t=this.attribute,{x:e,y:i,width:r,height:o}=(t=>{if(!t)return{x:0,y:0,width:0,height:0};let e=X(t.width)?t.x1-t.x:t.width,i=X(t.height)?t.y1-t.y:t.height,r=0,o=0;return e<0?(r=e,e=-e):Number.isNaN(e)&&(e=0),i<0?(o=i,i=-i):Number.isNaN(i)&&(i=0),{x:r,y:o,width:e,height:i}})(t),n=new ar;return n.moveTo(e,i),n.rect(e,i,r,o),n}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function fl(t){return new pl(t)}pl.NOWORK_ANIMATE_ATTR=vn;const ml=[[0,0,0],[1,0,0],[1,1,0],[0,1,0],[0,0,1],[1,0,1],[1,1,1],[0,1,1]];class bl extends pl{constructor(t){super(t),this.type="rect3d",this.numberType=ts}findFace(){const t={polygons:[],vertices:[],edges:[]},e=yo(this).rect3d,{x1:i,y1:r,x:o,y:n,length:s=ee(e.width,e.height)}=this.attribute;let{width:a,height:l}=this.attribute;a=null!=a?a:i-o,l=null!=l?l:r-n;for(let e=0;e<ml.length;e++){const i=ml[e];t.vertices.push([i[0]*a,i[1]*l,i[2]*s])}return t.polygons.push({polygon:[0,1,5,4],normal:[0,-1,0]}),t.polygons.push({polygon:[2,3,7,6],normal:[0,1,0]}),t.polygons.push({polygon:[4,7,3,0],normal:[-1,0,0]}),t.polygons.push({polygon:[1,2,6,5],normal:[1,0,0]}),t.polygons.push({polygon:[0,1,2,3],normal:[0,0,-1]}),t.polygons.push({polygon:[4,5,6,7],normal:[0,0,1]}),t.edges=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[3,7],[1,5],[2,6]],t}getNoWorkAnimateAttr(){return bl.NOWORK_ANIMATE_ATTR}}function yl(t){return new bl(t)}bl.NOWORK_ANIMATE_ATTR=vn;class Cl extends xn{constructor(t){super(t),this.type="glyph",this.numberType=Kn,this.subGraphic=[],this._onInit&&this._onInit(this),this.valid=this.isValid()}setSubGraphic(t){this.detachSubGraphic(),this.subGraphic=t,t.forEach((t=>{t.glyphHost=this,Object.setPrototypeOf(t.attribute,this.attribute)})),this.valid=this.isValid(),this.addUpdateBoundTag()}detachSubGraphic(){this.subGraphic.forEach((t=>{t.glyphHost=null,Object.setPrototypeOf(t.attribute,{})}))}getSubGraphic(){return this.subGraphic}onInit(t){this._onInit=t}onUpdate(t){this._onUpdate=t}isValid(){return!0}setAttribute(t,e,i,r){super.setAttribute(t,e,i,r),this.subGraphic.forEach((t=>{t.addUpdateShapeAndBoundsTag(),t.addUpdatePositionTag()}))}setAttributes(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;super.setAttributes(t,e,i),this.subGraphic.forEach((t=>{t.addUpdateShapeAndBoundsTag(),t.addUpdatePositionTag()}))}translate(t,e){return super.translate(t,e),this.subGraphic.forEach((t=>{t.addUpdatePositionTag(),t.addUpdateBoundTag()})),this}translateTo(t,e){return super.translateTo(t,e),this.subGraphic.forEach((t=>{t.addUpdatePositionTag(),t.addUpdateBoundTag()})),this}scale(t,e,i){return super.scale(t,e,i),this.subGraphic.forEach((t=>{t.addUpdatePositionTag(),t.addUpdateBoundTag()})),this}scaleTo(t,e){return super.scaleTo(t,e),this.subGraphic.forEach((t=>{t.addUpdatePositionTag(),t.addUpdateBoundTag()})),this}rotate(t){return super.rotate(t),this.subGraphic.forEach((t=>{t.addUpdatePositionTag(),t.addUpdateBoundTag()})),this}rotateTo(t){return super.rotate(t),this.subGraphic.forEach((t=>{t.addUpdatePositionTag(),t.addUpdateBoundTag()})),this}doUpdateAABBBounds(){this._AABBBounds.clear();const t=kr.graphicService.updateGlyphAABBBounds(this.attribute,yo(this).glyph,this._AABBBounds,this);return this.clearUpdateBoundTag(),t}tryUpdateOBBBounds(){throw new Error("暂不支持")}needUpdateTags(t){return!1}needUpdateTag(t){return!1}useStates(t,e){var i;if(!t.length)return void this.clearStates(e);if((null===(i=this.currentStates)||void 0===i?void 0:i.length)===t.length&&!t.some(((t,e)=>this.currentStates[e]!==t)))return;const r={},o=this.subGraphic.map((()=>({})));t.forEach((e=>{var i;const n=this.glyphStateProxy?this.glyphStateProxy(e,t):this.glyphStates[e];n&&(Object.assign(r,n.attributes),(null===(i=n.subAttributes)||void 0===i?void 0:i.length)&&o.forEach(((t,e)=>{Object.assign(t,n.subAttributes[e])})))})),this.subGraphic.forEach(((i,r)=>{i.updateNormalAttrs(o[r]),i.applyStateAttrs(o[r],t,e)})),this.updateNormalAttrs(r),this.currentStates=t,this.applyStateAttrs(r,t,e)}clearStates(t){this.hasState()&&this.normalAttrs&&(this.subGraphic.forEach((e=>{e.applyStateAttrs(e.normalAttrs,this.currentStates,t,!0),e.normalAttrs=null})),this.applyStateAttrs(this.normalAttrs,this.currentStates,t,!0),this.normalAttrs=null,this.currentStates=[])}clone(){const t=new Cl(Object.assign({},this.attribute));return t.setSubGraphic(this.subGraphic.map((t=>t.clone()))),t}getNoWorkAnimateAttr(){return Cl.NOWORK_ANIMATE_ATTR}}function wl(t){return new Cl(t)}Cl.NOWORK_ANIMATE_ATTR=vn;class vl{constructor(t,e,i,r,o,n,s,a,l,h,c,d,u,g){this.left=t,this.top=e,this.width=i,this.height=r,this.actualHeight=0,this.bottom=e+r,this.right=t+i,this.ellipsis=o,this.wordBreak=n,this.verticalDirection=s,this.lines=[],this.globalAlign=a,this.globalBaseline=l,this.layoutDirection=h,this.directionKey=Lr[this.layoutDirection],this.isWidthMax=c,this.isHeightMax=d,this.singleLine=u,g?(g.clear(),this.icons=g):this.icons=new Map}draw(t,e){const{width:i,height:r}=this.getActualSize(),o=this.isWidthMax?Math.min(this.width,i):this.width||i||0;let n=this.isHeightMax?Math.min(this.height,r):this.height||r||0;n=Math.min(n,r);let s=0;switch(this.globalBaseline){case"top":s=0;break;case"middle":s=-n/2;break;case"bottom":s=-n}let a=0;"right"===this.globalAlign||"end"===this.globalAlign?a=-o:"center"===this.globalAlign&&(a=-o/2);let l=this[this.directionKey.height];this.singleLine&&(l=this.lines[0].height+1);let h=!1;if("middle"===this.verticalDirection)if(this.actualHeight>=l&&0!==l)for(let i=0;i<this.lines.length;i++){const{top:r,height:o}=this.lines[i];if(r+o<this[this.directionKey.top]||r+o>this[this.directionKey.top]+l)return h;let n=!1;this.ellipsis&&this.lines[i+1]&&this.lines[i+1].top+this.lines[i+1].height>this[this.directionKey.top]+l&&(n=!0,h=!0),this.lines[i].draw(t,n,this.lines[i][this.directionKey.left]+a,this.lines[i][this.directionKey.top]+s,e)}else{const i=Math.floor((l-this.actualHeight)/2);"vertical"===this.layoutDirection?a+=i:s+=i;for(let i=0;i<this.lines.length;i++)this.lines[i].draw(t,!1,this.lines[i][this.directionKey.left]+a,this.lines[i][this.directionKey.top]+s,e)}else if("bottom"===this.verticalDirection&&"vertical"!==this.layoutDirection)for(let i=0;i<this.lines.length;i++){const{top:r,height:o}=this.lines[i],n=l-this.lines[i].top-this.lines[i].height;if(0===l)this.lines[i].draw(t,!1,a,n+s,e);else{if(n+o>this[this.directionKey.top]+l||n<this[this.directionKey.top])return h;{let r=!1;this.ellipsis&&this.lines[i+1]&&n-this.lines[i+1].height<this[this.directionKey.top]&&(r=!0,h=!0),this.lines[i].draw(t,r,a,n+s,e)}}}else{"bottom"===this.verticalDirection&&"vertical"===this.layoutDirection&&this.singleLine&&this.isWidthMax&&(a+=this.lines[0].height+1);for(let i=0;i<this.lines.length;i++){"bottom"===this.verticalDirection&&"vertical"===this.layoutDirection&&(a-=this.lines[i].height+this.lines[i].top);const{top:r,height:o}=this.lines[i];if(0===l)this.lines[i].draw(t,!1,this.lines[i][this.directionKey.left]+a,this.lines[i][this.directionKey.top]+s,e);else{if(r+o<this[this.directionKey.top]||r+o>this[this.directionKey.top]+l)return h;{let r=!1;this.ellipsis&&this.lines[i+1]&&this.lines[i+1].top+this.lines[i+1].height>this[this.directionKey.top]+l&&(r=!0,h=!0),this.lines[i].draw(t,r,this.lines[i][this.directionKey.left]+a,this.lines[i][this.directionKey.top]+s,e)}}}}return h}getActualSize(){return this.ellipsis?this.getActualSizeWidthEllipsis():this.getRawActualSize()}getRawActualSize(){let t=0,e=0;for(let i=0;i<this.lines.length;i++){const r=this.lines[i];r.actualWidth>t&&(t=r.actualWidth),e+=r.height}return{width:"vertical"===this.layoutDirection?e:t,height:"vertical"===this.layoutDirection?t:e}}getActualSizeWidthEllipsis(){let t=0,e=0;const{width:i,height:r}=this.getRawActualSize();this.width,this.height;let o=this[this.directionKey.height];if(this.singleLine&&(o=this.lines[0].height+1),"middle"===this.verticalDirection)if(this.actualHeight>=o&&0!==o)for(let i=0;i<this.lines.length;i++){const{top:r,height:n}=this.lines[i];if(r+n<this[this.directionKey.top]||r+n>this[this.directionKey.top]+o);else if(this.ellipsis&&this.lines[i+1]&&this.lines[i+1].top+this.lines[i+1].height>this[this.directionKey.top]+o){const r=this.lines[i].getWidthWithEllips();r>t&&(t=r),e+=this.lines[i].height}else this.lines[i].actualWidth>t&&(t=this.lines[i].actualWidth),e+=this.lines[i].height}else{Math.floor((o-this.actualHeight)/2);for(let i=0;i<this.lines.length;i++)this.lines[i].actualWidth>t&&(t=this.lines[i].actualWidth),e+=this.lines[i].height}else if("bottom"===this.verticalDirection)for(let i=0;i<this.lines.length;i++){const{top:r,height:n}=this.lines[i],s=o-this.lines[i].top-this.lines[i].height;if(0===o)this.lines[i].actualWidth>t&&(t=this.lines[i].actualWidth),e+=this.lines[i].height;else if(s+n>this[this.directionKey.top]+o||s<this[this.directionKey.top]);else if(this.ellipsis&&this.lines[i+1]&&s-this.lines[i+1].height<this[this.directionKey.top]){const r=this.lines[i].getWidthWithEllips();r>t&&(t=r),e+=this.lines[i].height}else this.lines[i].actualWidth>t&&(t=this.lines[i].actualWidth),e+=this.lines[i].height}else for(let i=0;i<this.lines.length;i++){const{top:r,height:n}=this.lines[i];if(0===o)this.lines[i].actualWidth>t&&(t=this.lines[i].actualWidth),e+=this.lines[i].height;else if(r+n<this[this.directionKey.top]||r+n>this[this.directionKey.top]+o);else if(this.ellipsis&&this.lines[i+1]&&this.lines[i+1].top+this.lines[i+1].height>this[this.directionKey.top]+o){const r=this.lines[i].getWidthWithEllips();r>t&&(t=r),e+=this.lines[i].height}else this.lines[i].actualWidth>t&&(t=this.lines[i].actualWidth),e+=this.lines[i].height}return{width:"vertical"===this.layoutDirection?e:t,height:"vertical"===this.layoutDirection?t:e}}}class xl{constructor(t,e,i){this.fontSize=i.fontSize||16,this.textBaseline=i.textBaseline||"alphabetic";const r=on(i.lineHeight,this.fontSize);this.lineHeight="number"==typeof r?r>this.fontSize?r:this.fontSize:Math.floor(1.2*this.fontSize),this.height=this.lineHeight;const{ascent:o,height:n,descent:s,width:a}=Gr(t,i);let l=0,h=0,c=0;this.height>n&&(l=(this.height-n)/2,h=Math.ceil(l),c=Math.floor(l)),"top"===this.textBaseline?(this.ascent=l,this.descent=n-l):"bottom"===this.textBaseline?(this.ascent=n-l,this.descent=l):"middle"===this.textBaseline?(this.ascent=this.height/2,this.descent=this.height/2):(this.ascent=o+h,this.descent=s+c),this.length=t.length,this.width=a||0,this.text=t||"",this.newLine=e||!1,this.character=i,this.left=0,this.top=0,this.ellipsis="normal",this.ellipsisWidth=0,this.ellipsisOtherParagraphWidth=0,"vertical"===i.direction&&(this.direction=i.direction,this.widthOrigin=this.width,this.heightOrigin=this.height,this.width=this.heightOrigin,this.height=this.widthOrigin,this.lineHeight=this.height)}updateWidth(){const{width:t}=Gr(this.text,this.character);this.width=t,"vertical"===this.direction&&(this.widthOrigin=this.width,this.width=this.heightOrigin,this.height=this.widthOrigin)}draw(t,e,i,r,o){let n=this.text,s=this.left+i;e+=this.top;let a=this.direction;if(this.verticalEllipsis)n="...",a="vertical",e-=this.ellipsisWidth/2;else{if("hide"===this.ellipsis)return;if("add"===this.ellipsis)n+="...","right"!==o&&"end"!==o||(s-=this.ellipsisWidth);else if("replace"===this.ellipsis){const t=Wr(n,("vertical"===a?this.height:this.width)-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,n.length-1);if(n=n.slice(0,t),n+="...","right"===o||"end"===o){const{width:e}=Gr(this.text.slice(t),this.character);"vertical"===a||(s-=this.ellipsisWidth-e)}}}switch(this.character.script){case"super":e-=this.ascent*(1/3);break;case"sub":e+=this.descent/2}"vertical"===a&&(t.save(),t.rotateAbout(Math.PI/2,s,e),t.translate(-this.heightOrigin||-this.lineHeight/2,-this.descent/2),t.translate(s,e),s=0,e=0),this.character.stroke&&(function(t,e){const i=e&&e.stroke||Ir;if(!i)return void(t.globalAlpha=0);t.globalAlpha=1,t.lineWidth=e&&"number"==typeof e.lineWidth?e.lineWidth:1,t.strokeStyle=i;let r=e.fontSize||16;switch(e.script){case"super":case"sub":r*=.8}t.setTextStyle({textAlign:"left",textBaseline:e.textBaseline||"alphabetic",fontStyle:e.fontStyle||"",fontWeight:e.fontWeight||"",fontSize:r,fontFamily:e.fontFamily||"sans-serif"})}(t,this.character),t.strokeText(n,s,e)),function(t,e){const i=e&&e.fill||Fr;if(!i)return void(t.globalAlpha=0);t.globalAlpha=1,t.fillStyle=i;let r=e.fontSize||16;switch(e.script){case"super":case"sub":r*=.8}t.setTextStyle({textAlign:"left",textBaseline:e.textBaseline||"alphabetic",fontStyle:e.fontStyle||"",fontWeight:e.fontWeight||"",fontSize:r,fontFamily:e.fontFamily||"sans-serif"})}(t,this.character),this.character.fill&&t.fillText(n,s,e),this.character.fill&&("boolean"==typeof this.character.lineThrough||"boolean"==typeof this.character.underline?(this.character.underline&&t.fillRect(s,1+e,this.widthOrigin||this.width,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1),this.character.lineThrough&&t.fillRect(s,1+e-this.ascent/2,this.widthOrigin||this.width,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)):"underline"===this.character.textDecoration?t.fillRect(s,1+e,this.widthOrigin||this.width,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1):"line-through"===this.character.textDecoration&&t.fillRect(s,1+e-this.ascent/2,this.widthOrigin||this.width,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)),"vertical"===a&&t.restore()}getWidthWithEllips(t){let e=this.text;const i="vertical"===t?this.height:this.width;if("hide"===this.ellipsis)return i;if("add"===this.ellipsis)return i+this.ellipsisWidth;if("replace"===this.ellipsis){const t=Wr(e,i-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,e.length-1);e=e.slice(0,t),e+="...";const{width:r}=Gr(this.text.slice(t),this.character);return i+this.ellipsisWidth-r}return i}}const _l=["width","height","image",...mn];let Sl=class t extends xn{constructor(t){super(t),this.type="image",this.numberType=Xn,this.loadImage(this.attribute.image)}get width(){var t;return null!==(t=this.attribute.width)&&void 0!==t?t:0}set width(t){this.attribute.width===t&&(this.attribute.width=t,this.addUpdateShapeAndBoundsTag())}get height(){var t;return null!==(t=this.attribute.height)&&void 0!==t?t:0}set height(t){this.attribute.height===t&&(this.attribute.height=t,this.addUpdateShapeAndBoundsTag())}get repeatX(){var t;return null!==(t=this.attribute.repeatX)&&void 0!==t?t:"no-repeat"}set repeatX(t){this.attribute.repeatX===t&&(this.attribute.repeatX=t)}get repeatY(){var t;return null!==(t=this.attribute.repeatY)&&void 0!==t?t:"no-repeat"}set repeatY(t){this.attribute.repeatY===t&&(this.attribute.repeatY=t)}get image(){return this.attribute.image}set image(t){t!==this.attribute.image&&(this.attribute.image=t,this.loadImage(this.attribute.image))}imageLoadSuccess(t,e,i){super.imageLoadSuccess(t,e,(()=>{this.successCallback&&this.successCallback()}))}imageLoadFail(t,e){super.imageLoadFail(t,(()=>{this.failCallback&&this.failCallback()}))}setAttributes(t,e,i){return t.image&&this.loadImage(t.image),super.setAttributes(t,e,i)}setAttribute(t,e,i,r){return"image"===t&&this.loadImage(e),super.setAttribute(t,e,i,r)}doUpdateAABBBounds(){const t=yo(this).image;this._AABBBounds.clear();const e=this.attribute,i=kr.graphicService.updateImageAABBBounds(e,yo(this).image,this._AABBBounds,this),{boundsPadding:r=t.boundsPadding}=e,o=Xo(r);return o&&i.expand(o),this.clearUpdateBoundTag(),i}tryUpdateOBBBounds(){throw new Error("暂不支持")}getDefaultAttribute(t){return Hr[t]}needUpdateTags(t){return super.needUpdateTags(t,_l)}needUpdateTag(t){return super.needUpdateTag(t,_l)}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function Al(t){return new Sl(t)}Sl.NOWORK_ANIMATE_ATTR=Object.assign({image:1,repeatX:1,repeatY:1},vn);class Rl extends Sl{constructor(t){if(super(t),this._x=0,this._y=0,this._hovered=!1,this._marginArray=[0,0,0,0],"always"===t.backgroundShowMode&&(this._hovered=!0),t.margin){const e=Xo(t.margin);this._marginArray="number"==typeof e?[e,e,e,e]:e}this.onBeforeAttributeUpdate=(t,e,i)=>{if(et(i)&&-1!==i.indexOf("margin")||"margin"===i)if(e.margin){const t=Xo(e.margin);this._marginArray="number"==typeof t?[t,t,t,t]:t}else this._marginArray=[0,0,0,0]}}get width(){var t;return(null!==(t=this.attribute.width)&&void 0!==t?t:0)+this._marginArray[1]+this._marginArray[3]}get height(){var t;return(null!==(t=this.attribute.height)&&void 0!==t?t:0)+this._marginArray[0]+this._marginArray[2]}tryUpdateAABBBounds(){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;this.doUpdateAABBBounds();const{width:t=Hr.width,height:e=Hr.height}=this.attribute,{backgroundWidth:i=t,backgroundHeight:r=e}=this.attribute,o=(i-t)/2,n=(r-e)/2;return this._AABBBounds.expand([0,2*o,2*n,0]),this._AABBBounds}setHoverState(t){"hover"===this.attribute.backgroundShowMode&&this._hovered!==t&&(this._hovered=t)}}class Bl{constructor(t,e,i,r,o,n,s,a){this.left=t,this.width=e,this.baseline=i,this.ascent=r,this.descent=o,this.top=i-r,this.paragraphs=n.map((t=>t)),this.textAlign=(this.paragraphs[0]instanceof Rl?this.paragraphs[0].attribute.textAlign:this.paragraphs[0].character.textAlign)||"left",this.direction=s,this.directionKey=Lr[this.direction],this.actualWidth=0;let l=0;this.paragraphs.forEach(((t,e)=>{if(0===e&&t instanceof xl){const e=Dr.exec(t.text);0!==(null==e?void 0:e.index)&&(t.text=t.text.slice(null==e?void 0:e.index),t.updateWidth())}this.actualWidth+=t[this.directionKey.width],l=Math.max(t[this.directionKey.height],l)})),this.height=l,this.blankWidth=a?0:this.width-this.actualWidth,this.calcOffset(e,a)}calcOffset(t,e){const i=this.directionKey,r=this.height;let o=this.left,n=0;this.actualWidth<t&&!e&&("right"===this.textAlign||"end"===this.textAlign?o=t-this.actualWidth:"center"===this.textAlign?o=(t-this.actualWidth)/2:"justify"===this.textAlign&&(this.paragraphs.length<2?o=(t-this.actualWidth)/2:n=(t-this.actualWidth)/(this.paragraphs.length-1))),this.paragraphs.map((function(t){t instanceof Rl?(t["_"+i.x]=o,o+=t[i.width]+n,t["_"+i.y]="top"===t.attribute.textBaseline?0:"bottom"===t.attribute.textBaseline?r-t.height:(r-t.height)/2):(t[i.left]=o,o+=t[i.width]+n)}))}draw(t,e,i,r,o){if(e){let t=0;for(let e=this.paragraphs.length-1;e>=0;e--){const i=this.paragraphs[e];if(i instanceof Rl)break;if("vertical"===this.direction&&"vertical"!==i.direction){i.verticalEllipsis=!0;break}const{width:r}=Gr("...",i.character),o=r||0;if(o<=this.blankWidth+t){i.ellipsis="add";break}if(o<=this.blankWidth+t+i.width){i.ellipsis="replace",i.ellipsisWidth=o,i.ellipsisOtherParagraphWidth=this.blankWidth+t;break}i.ellipsis="hide",t+=i.width}}this.paragraphs.map(((e,n)=>{if(e instanceof Rl)return e.setAttributes({x:i+e._x,y:r+e._y}),void o(e,t,i+e._x,r+e._y,this.ascent);e.draw(t,r+this.ascent,i,0===n,this.textAlign)}))}getWidthWithEllips(){let t=0;for(let e=this.paragraphs.length-1;e>=0;e--){const i=this.paragraphs[e];if(i instanceof Rl)break;const{width:r}=Gr("...",i.character),o=r||0;if(o<=this.blankWidth+t){i.ellipsis="add",i.ellipsisWidth=o;break}if(o<=this.blankWidth+t+i.width){i.ellipsis="replace",i.ellipsisWidth=o,i.ellipsisOtherParagraphWidth=this.blankWidth+t;break}i.ellipsis="hide",t+=i.width}let e=0;return this.paragraphs.map(((t,i)=>{e+=t instanceof Rl?t.width:t.getWidthWithEllips(this.direction)})),e}}class Ml{constructor(t){this.frame=t,this.width=this.frame.width,this.height=this.frame.height,this.lineWidth=0,this.y=this.frame.top,this.maxAscent=0,this.maxDescent=0,this.maxAscentForBlank=0,this.maxDescentForBlank=0,this.lineBuffer=[],this.direction=t.layoutDirection,this.directionKey=Lr[this.direction]}store(t){if(t instanceof Rl){this.frame.icons.set(t.richtextId,t),this.lineBuffer.push(t),this.lineWidth+=t[this.directionKey.width];let e=0,i=0;"top"===t.attribute.textBaseline?(e=0,i=t.height):"bottom"===t.attribute.textBaseline?(e=t.height,i=0):(e=t.height/2,i=t.height/2),this.maxAscent=Math.max(this.maxAscent,e),this.maxDescent=Math.max(this.maxDescent,i)}else this.lineBuffer.push(t),0!==t.text.length?(this.lineWidth+=t[this.directionKey.width],this.maxAscent=Math.max(this.maxAscent,t.ascent),this.maxDescent=Math.max(this.maxDescent,t.descent)):(this.maxAscentForBlank=Math.max(this.maxAscentForBlank,t.ascent),this.maxDescentForBlank=Math.max(this.maxDescentForBlank,t.descent))}send(){if(0===this.lineBuffer.length)return;const t=0===this.maxAscent?this.maxAscentForBlank:this.maxAscent,e=0===this.maxDescent?this.maxDescentForBlank:this.maxDescent,i=new Bl(this.frame.left,this[this.directionKey.width],this.y+t,t,e,this.lineBuffer,this.direction,"horizontal"===this.direction?this.frame.isWidthMax:this.frame.isHeightMax);this.frame.lines.push(i),this.frame.actualHeight+=i.height,this.y+=i.height,this.lineBuffer.length=0,this.lineWidth=this.maxAscent=this.maxDescent=this.maxAscentForBlank=this.maxDescentForBlank=0}deal(t){t instanceof Rl?"horizontal"===this.direction&&0===this.width||"vertical"===this.direction&&0===this.height||this.lineWidth+t[this.directionKey.width]<=this[this.directionKey.width]?this.store(t):0===this.lineBuffer.length?(this.store(t),this.send()):(this.send(),this.deal(t)):"number"!=typeof this.width||this.width<0||(t.newLine&&this.send(),0!==t.text.length&&("horizontal"===this.direction&&0===this.width||"vertical"===this.direction&&0===this.height||this.lineWidth+t[this.directionKey.width]<=this[this.directionKey.width]?this.store(t):this.lineWidth===this[this.directionKey.width]?(this.send(),this.deal(t)):this.cut(t)))}cut(t){const e=this[this.directionKey.width]-this.lineWidth||0,i=Math.ceil(e/t[this.directionKey.width]*t.length)||0,r=Wr(t.text,e,t.character,i,"break-word"===this.frame.wordBreak);if(0!==r){const[e,i]=function(t,e){const i=t.text.slice(0,e),r=t.text.slice(e);return[new xl(i,t.newLine,t.character),new xl(r,!0,t.character)]}(t,r);this.store(e),this.deal(i)}else 0!==this.lineBuffer.length&&(this.send(),this.deal(t))}}const Tl=["width","height","ellipsis","wordBreak","verticalDirection","maxHeight","maxWidth","textAlign","textBaseline","textConfig","layoutDirection",...mn];class Pl extends xn{constructor(t){super(t),this.type="richtext",this._currentHoverIcon=null,this.numberType=es}get width(){var t;return null!==(t=this.attribute.width)&&void 0!==t?t:Pr.width}set width(t){this.attribute.width!==t&&(this.attribute.width=t,this.addUpdateShapeAndBoundsTag())}get height(){var t;return null!==(t=this.attribute.height)&&void 0!==t?t:Pr.height}set height(t){this.attribute.height!==t&&(this.attribute.height=t,this.addUpdateShapeAndBoundsTag())}get maxWidth(){return this.attribute.maxWidth}set maxWidth(t){this.attribute.maxWidth!==t&&(this.attribute.maxWidth=t,this.addUpdateShapeAndBoundsTag())}get maxHeight(){return this.attribute.maxHeight}set maxHeight(t){this.attribute.maxHeight!==t&&(this.attribute.maxHeight=t,this.addUpdateShapeAndBoundsTag())}get ellipsis(){var t;return null!==(t=this.attribute.ellipsis)&&void 0!==t?t:Pr.ellipsis}set ellipsis(t){this.attribute.ellipsis!==t&&(this.attribute.ellipsis=t,this.addUpdateShapeAndBoundsTag())}get wordBreak(){var t;return null!==(t=this.attribute.wordBreak)&&void 0!==t?t:Pr.wordBreak}set wordBreak(t){this.attribute.wordBreak!==t&&(this.attribute.wordBreak=t,this.addUpdateShapeAndBoundsTag())}get verticalDirection(){var t;return null!==(t=this.attribute.verticalDirection)&&void 0!==t?t:Pr.verticalDirection}set verticalDirection(t){this.attribute.verticalDirection!==t&&(this.attribute.verticalDirection=t,this.addUpdateShapeAndBoundsTag())}get textAlign(){var t;return null!==(t=this.attribute.textAlign)&&void 0!==t?t:Pr.textAlign}set textAlign(t){this.attribute.textAlign!==t&&(this.attribute.textAlign=t,this.addUpdateShapeAndBoundsTag())}get textBaseline(){var t;return null!==(t=this.attribute.textBaseline)&&void 0!==t?t:Pr.textBaseline}set textBaseline(t){this.attribute.textBaseline!==t&&(this.attribute.textBaseline=t,this.addUpdateShapeAndBoundsTag())}get textConfig(){var t;return null!==(t=this.attribute.textConfig)&&void 0!==t?t:Pr.textConfig}set textConfig(t){this.attribute.textConfig=t,this.addUpdateShapeAndBoundsTag()}doUpdateAABBBounds(){const t=yo(this).richtext;this._AABBBounds.clear();const e=this.attribute,i=kr.graphicService.updateRichTextAABBBounds(e,yo(this).richtext,this._AABBBounds,this),{boundsPadding:r=t.boundsPadding}=e,o=Xo(r);return o&&i.expand(o),this.clearUpdateBoundTag(),i}tryUpdateOBBBounds(){throw new Error("暂不支持")}getDefaultAttribute(t){return Pr[t]}needUpdateTags(t){return super.needUpdateTags(t,Tl)}needUpdateTag(t){return super.needUpdateTag(t,Tl)}getFrameCache(){return this.shouldUpdateShape()&&(this.doUpdateFrameCache(),this.clearUpdateShapeTag()),this._frameCache}combinedStyleToCharacter(t){const{fill:e,stroke:i,fontSize:r,fontFamily:o,fontStyle:n,fontWeight:s,lineWidth:a}=this.attribute;return Object.assign({fill:e,stroke:i,fontSize:r,fontFamily:o,fontStyle:n,fontWeight:s,lineWidth:a},t)}doUpdateFrameCache(){var t;const{textConfig:e=[],maxWidth:i,maxHeight:r,width:o,height:n,ellipsis:s,wordBreak:a,verticalDirection:l,textAlign:h,textBaseline:c,layoutDirection:d,singleLine:u}=this.attribute,g=[];for(let t=0;t<e.length;t++)if("image"in e[t]){const i=this.combinedStyleToCharacter(e[t]),r=i.id&&this._frameCache&&this._frameCache.icons&&this._frameCache.icons.get(i.id);if(r)g.push(r);else{const t=new Rl(i);t.successCallback=()=>{var t;this.addUpdateBoundTag(),null===(t=this.stage)||void 0===t||t.renderNextFrame()},t.richtextId=i.id,g.push(t)}}else{const i=this.combinedStyleToCharacter(e[t]);if(ot(i.text)&&(i.text=`${i.text}`),i.text&&i.text.includes("\n")){const t=i.text.split("\n");for(let e=0;e<t.length;e++)g.push(new xl(t[e],0!==e,i))}else i.text&&g.push(new xl(i.text,!1,i))}const p="number"==typeof i&&Number.isFinite(i)&&i>0,f="number"==typeof r&&Number.isFinite(r)&&r>0,m="number"==typeof o&&Number.isFinite(o)&&o>0&&(!p||o<=i),b="number"==typeof n&&Number.isFinite(n)&&n>0&&(!f||n<=r),y=new vl(0,0,(m?o:p?i:0)||0,(b?n:f?r:0)||0,s,a,l,h,c,d||"horizontal",!m&&p,!b&&f,u||!1,null===(t=this._frameCache)||void 0===t?void 0:t.icons),C=new Ml(y);for(let t=0;t<g.length;t++)C.deal(g[t]);if(C.send(),!("horizontal"===y.layoutDirection?m:b)){const t=y.getActualSizeWidthEllipsis();let e="horizontal"===y.layoutDirection?t.width:t.height;("horizontal"===y.layoutDirection?p:f)&&(e=Math.min(e,"horizontal"===y.layoutDirection?i:r)),y.lines.forEach((function(t){t.calcOffset(e,!1)}))}this._frameCache=y}clone(){return new Pl(Object.assign({},this.attribute))}setStage(t,e){super.setStage(t,e),this.getFrameCache().icons.forEach((i=>{i.setStage(t,e)}))}bindIconEvent(){this.addEventListener("pointermove",(t=>{var e,i,r,o,n;const s=this.pickIcon(t.global);s&&s===this._currentHoverIcon||(s?(null===(e=this._currentHoverIcon)||void 0===e||e.setHoverState(!1),this._currentHoverIcon=s,this._currentHoverIcon.setHoverState(!0),null===(i=this.stage)||void 0===i||i.setCursor(s.attribute.cursor),null===(r=this.stage)||void 0===r||r.renderNextFrame()):!s&&this._currentHoverIcon&&(this._currentHoverIcon.setHoverState(!1),this._currentHoverIcon=null,null===(o=this.stage)||void 0===o||o.setCursor(),null===(n=this.stage)||void 0===n||n.renderNextFrame()))})),this.addEventListener("pointerleave",(t=>{var e,i;this._currentHoverIcon&&(this._currentHoverIcon.setHoverState(!1),this._currentHoverIcon=null,null===(e=this.stage)||void 0===e||e.setCursor(),null===(i=this.stage)||void 0===i||i.renderNextFrame())}))}pickIcon(t){const e=this.getFrameCache(),{e:i,f:r}=this.globalTransMatrix;let o;return e.icons.forEach((e=>{var n,s;e.AABBBounds.containsPoint({x:t.x-i,y:t.y-r})&&(o=e,o.globalX=(null!==(n=o.attribute.x)&&void 0!==n?n:0)+i,o.globalY=(null!==(s=o.attribute.y)&&void 0!==s?s:0)+r)})),o}getNoWorkAnimateAttr(){return Pl.NOWORK_ANIMATE_ATTR}}function Hl(t){return new Pl(t)}Pl.NOWORK_ANIMATE_ATTR=Object.assign({ellipsis:1,wordBreak:1,verticalDirection:1,textAlign:1,textBaseline:1,textConfig:1,layoutDirection:1},vn);const El=["path","customPath",...mn];class kl extends xn{constructor(t){super(t),this.type="path",this.numberType=qn}get pathShape(){return this.tryUpdateAABBBounds(),this.getParsedPathShape()}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{path:t}=this.attribute;return null!=t&&""!==t}getParsedPathShape(){const t=yo(this).path;if(!this.valid)return t.path;const e=this.attribute;return e.path instanceof ar?e.path:(X(this.cache)&&this.doUpdatePathShape(),this.cache instanceof ar?this.cache:t.path)}doUpdateAABBBounds(){const t=yo(this).path;this.doUpdatePathShape(),this._AABBBounds.clear();const e=this.attribute,i=kr.graphicService.updatePathAABBBounds(e,yo(this).path,this._AABBBounds,this),{boundsPadding:r=t.boundsPadding}=e,o=Xo(r);return o&&i.expand(o),this.clearUpdateBoundTag(),i}doUpdatePathShape(){const t=this.attribute;tt(t.path,!0)?this.cache=(new ar).fromString(t.path):t.customPath&&(this.cache=new ar,t.customPath(this.cache,this))}tryUpdateOBBBounds(){throw new Error("暂不支持")}getDefaultAttribute(t){return yo(this).path[t]}needUpdateTags(t){return super.needUpdateTags(t,El)}needUpdateTag(t){return super.needUpdateTag(t,El)}toCustomPath(){return(new ar).fromCustomPath2D(this.getParsedPathShape(),0,0)}clone(){return new kl(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return kl.NOWORK_ANIMATE_ATTR}}function Ll(t){return new kl(t)}kl.NOWORK_ANIMATE_ATTR=Object.assign({path:1,customPath:1},vn);const Fl=["segments","points","curveType",...mn];class Il extends xn{constructor(t){super(t),this.type="area",this.numberType=Vn}isValid(){return super.isValid()&&this._isValid()}_isValid(){if(this.pathProxy)return!0;const{points:t,segments:e}=this.attribute;return e?0!==e.length:!!t&&0!==t.length}doUpdateAABBBounds(){const t=yo(this).area;this._AABBBounds.clear();const e=this.attribute,i=kr.graphicService.updateAreaAABBBounds(e,yo(this).area,this._AABBBounds,this),{boundsPadding:r=t.boundsPadding}=e,o=Xo(r);return o&&i.expand(o),this.clearUpdateBoundTag(),i}tryUpdateOBBBounds(){throw new Error("暂不支持")}_interpolate(t,e,i,r,o){"points"===t&&(o.points=Qo(i,r,e))}getDefaultAttribute(t){return yo(this).area[t]}needUpdateTags(t){return super.needUpdateTags(t,Fl)}needUpdateTag(t){return super.needUpdateTag(t,Fl)}toCustomPath(){const t=new ar,e=this.attribute,i=e.segments,r=e=>{if(e&&e.length){let i=!0;const r=[];if(e.forEach((e=>{var o,n;!1!==e.defined&&(i?t.moveTo(e.x,e.y):t.lineTo(e.x,e.y),r.push({x:null!==(o=e.x1)&&void 0!==o?o:e.x,y:null!==(n=e.y1)&&void 0!==n?n:e.y}),i=!1)})),r.length){for(let e=r.length-1;e>=0;e--)t.lineTo(r[e].x,r[e].y);t.closePath()}}};return e.points?r(e.points):i&&i.length&&i.forEach((t=>{r(t.points)})),t}clone(){return new Il(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Il.NOWORK_ANIMATE_ATTR}}function zl(t){return new Il(t)}Il.NOWORK_ANIMATE_ATTR=Object.assign({segments:1,curveType:1},vn);const Ol=["innerRadius","outerRadius","startAngle","endAngle","cornerRadius","padAngle","padRadius","cap",...mn];let Dl=class t extends xn{constructor(t){super(t),this.type="arc",this.numberType=Gn}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{startAngle:t,endAngle:e,outerRadius:i,innerRadius:r}=this.attribute;return this._validNumber(t)&&this._validNumber(e)&&this._validNumber(i)&&this._validNumber(r)}getParsedCornerRadius(){const t=yo(this).arc,{cornerRadius:e=t.cornerRadius,innerPadding:i=t.innerPadding,outerPadding:r=t.outerPadding}=this.attribute;let{outerRadius:o=t.outerRadius,innerRadius:n=t.innerRadius}=this.attribute;if(o+=r,n-=i,0===e||"0%"===e)return 0;const s=Math.abs(o-n);return Math.min(ot(e,!0)?e:s*parseFloat(e)/100,s/2)}getParsedAngle(){const t=yo(this).arc;let{startAngle:e=t.startAngle,endAngle:i=t.endAngle}=this.attribute;const{cap:r=t.cap}=this.attribute,o=i-e>=0?1:-1,n=i-e;if(e=pe(e),i=e+n,r&&Zt(n)<qt-Kt){let n=1,s=1;r.length&&(n=Number(r[0]),s=Number(r[1]));let{outerRadius:a=t.outerRadius,innerRadius:l=t.innerRadius}=this.attribute;const{outerPadding:h=t.outerPadding,innerPadding:c=t.innerPadding}=this.attribute;a+=h,l-=c;const d=Math.abs(a-l)/2,u=d/a;if(d>Kt&&a>Kt)return{startAngle:e-o*u*n,endAngle:i+o*u*s,sc:o*u*n,ec:o*u*s}}return{startAngle:e,endAngle:i}}getParsePadAngle(t,e){const i=yo(this).arc,{innerPadding:r=i.innerPadding,outerPadding:o=i.outerPadding,padAngle:n=i.padAngle}=this.attribute;let{outerRadius:s=i.outerRadius,innerRadius:a=i.innerRadius}=this.attribute;s+=o,a-=r;const{padRadius:l=re(s*s+a*a)}=this.attribute,h=Zt(e-t);let c=t,d=e,u=t,g=e;const p=n/2;let f=h,m=h;if(p>Kt&&l>Kt){const i=e>t?1:-1;let r=se(Number(l)/a*ie(p)),o=se(Number(l)/s*ie(p));return(f-=2*r)>Kt?(r*=i,u+=r,g-=r):(f=0,u=g=(t+e)/2),(m-=2*o)>Kt?(o*=i,c+=o,d-=o):(m=0,c=d=(t+e)/2),{outerStartAngle:c,outerEndAngle:d,innerStartAngle:u,innerEndAngle:g,innerDeltaAngle:f,outerDeltaAngle:m}}return{outerStartAngle:c,outerEndAngle:d,innerStartAngle:u,innerEndAngle:g,innerDeltaAngle:f,outerDeltaAngle:m}}doUpdateAABBBounds(t){const e=yo(this).arc;this._AABBBounds.clear();const i=this.attribute,r=kr.graphicService.updateArcAABBBounds(i,yo(this).arc,this._AABBBounds,t,this),{boundsPadding:o=e.boundsPadding}=i,n=Xo(o);return n&&r.expand(n),this.clearUpdateBoundTag(),r}tryUpdateOBBBounds(){throw new Error("暂不支持")}needUpdateTags(t){return super.needUpdateTags(t,Ol)}needUpdateTag(t){return super.needUpdateTag(t,Ol)}getDefaultAttribute(t){return yo(this).arc[t]}toCustomPath(){const t=this.attribute,{startAngle:e,endAngle:i}=this.getParsedAngle();let r=t.innerRadius-(t.innerPadding||0),o=t.outerRadius-(t.outerPadding||0);const n=Zt(i-e),s=i>e;if(o<r){const t=o;o=r,r=t}const a=new ar;if(o<=Kt)a.moveTo(0,0);else if(n>=qt-Kt)a.moveTo(0+o*Qt(e),0+o*ie(e)),a.arc(0,0,o,e,i,!s),r>Kt&&(a.moveTo(0+r*Qt(i),0+r*ie(i)),a.arc(0,0,r,i,e,s));else{const t=o*Qt(e),n=o*ie(e),l=r*Qt(i),h=r*ie(i);a.moveTo(0+t,0+n),a.arc(0,0,o,e,i,!s),a.lineTo(0+l,0+h),a.arc(0,0,r,i,e,s),a.closePath()}return a}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function Wl(t){return new Dl(t)}Dl.NOWORK_ANIMATE_ATTR=Object.assign({cap:1},vn);class Nl extends Dl{constructor(t){super(t),this.type="arc3d",this.numberType=jn}doUpdateAABBBounds(){const t=yo(this).arc;this._AABBBounds.clear();const e=this.attribute,i=kr.graphicService.updateArc3dAABBBounds(e,yo(this).polygon,this._AABBBounds,this),{boundsPadding:r=t.boundsPadding}=e,o=Xo(r);return o&&i.expand(o),this.clearUpdateBoundTag(),this._AABBBounds}getNoWorkAnimateAttr(){return Nl.NOWORK_ANIMATE_ATTR}}function Gl(t){return new Nl(t)}Nl.NOWORK_ANIMATE_ATTR=Object.assign({cap:1},vn);const jl=["points","cornerRadius",...mn];class Vl extends xn{constructor(t){super(t),this.type="polygon",this.numberType=Zn}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{points:t}=this.attribute;return t&&t.length>=2}doUpdateAABBBounds(){const t=yo(this).polygon;this._AABBBounds.clear();const e=this.attribute,i=kr.graphicService.updatePolygonAABBBounds(e,yo(this).polygon,this._AABBBounds,this),{boundsPadding:r=t.boundsPadding}=e,o=Xo(r);return o&&i.expand(o),this.clearUpdateBoundTag(),this._AABBBounds}tryUpdateOBBBounds(){throw new Error("暂不支持")}_interpolate(t,e,i,r,o){"points"===t&&(o.points=Qo(i,r,e))}getDefaultAttribute(t){return yo(this).polygon[t]}needUpdateTags(t){return super.needUpdateTags(t,jl)}needUpdateTag(t){return super.needUpdateTag(t,jl)}toCustomPath(){const t=this.attribute.points,e=new ar;return t.forEach(((t,i)=>{0===i?e.moveTo(t.x,t.y):e.lineTo(t.x,t.y)})),e.closePath(),e}clone(){return new Vl(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Vl.NOWORK_ANIMATE_ATTR}}function Ul(t){return new Vl(t)}Vl.NOWORK_ANIMATE_ATTR=vn;class Kl extends Vl{constructor(t){super(t),this.type="pyramid3d",this.numberType=Jn}doUpdateAABBBounds(){const t=yo(this).polygon;this._AABBBounds.clear();const e=this.attribute,i=kr.graphicService.updatePyramid3dAABBBounds(e,yo(this).polygon,this._AABBBounds,this),{boundsPadding:r=t.boundsPadding}=e,o=Xo(r);return o&&i.expand(o),this.clearUpdateBoundTag(),this._AABBBounds}findFace(){const{points:t}=this.attribute,e=t.map(((e,i)=>{const r=3===i?t[0]:t[i+1],o=e.x-r.x;return 0===o?0:(e.y-r.y)/o})),i=t.map((t=>({p:t,d:0})));let r=!1,o=0;for(let t=0;t<e.length-1;t++){for(let n=t+1;n<e.length;n++){if(e[t]===e[n]){r=!0;const e=he.distancePP(i[t].p,i[t+1].p);i[t].d=e,i[t+1].d=e,o=te(o,e);const s=he.distancePP(i[n].p,i[n+1].p);i[n].d=s,i[n+1].d=s,o=te(o,s)}if(r)break}if(r)break}for(let e=t.length-1;e>=0;e--){const r=t[e];i.unshift({p:r,d:0})}for(let e=0;e<t.length;e++){const r=(o-i[e+t.length].d)/2;i[e].d+=r,i[e+t.length].d+=r}const n={polygons:[],vertices:[],edges:[]};return i.forEach((t=>{n.vertices.push([t.p.x,t.p.y,t.d])})),n.polygons.push({polygon:[0,4,5,1],normal:[0,-1,0]}),n.polygons.push({polygon:[7,6,2,3],normal:[0,1,0]}),n.polygons.push({polygon:[0,4,7,3],normal:[-1,0,0]}),n.polygons.push({polygon:[1,5,6,2],normal:[1,0,0]}),n.polygons.push({polygon:[0,1,2,3],normal:[0,0,-1]}),n.polygons.push({polygon:[4,5,6,7],normal:[0,0,1]}),n.edges=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[3,7],[1,5],[2,6]],n}_isValid(){return super._isValid()&&4===this.attribute.points.length}getNoWorkAnimateAttr(){return Kl.NOWORK_ANIMATE_ATTR}}function $l(t){return new Kl(t)}Kl.NOWORK_ANIMATE_ATTR=vn;class Xl extends hs{constructor(t){super({x:0,y:0}),this.type="shadowroot",this.shadowHost=t}addUpdateBoundTag(){super.addUpdateBoundTag(),this.shadowHost&&this.shadowHost.addUpdateBoundTag()}addUpdateShapeAndBoundsTag(){super.addUpdateShapeAndBoundsTag(),this.shadowHost&&this.shadowHost.addUpdateBoundTag()}tryUpdateGlobalTransMatrix(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.shouldUpdateGlobalMatrix()){const e=this.transMatrix;this._globalTransMatrix?this._globalTransMatrix.setValue(e.a,e.b,e.c,e.d,e.e,e.f):this._globalTransMatrix=e.clone(),this.doUpdateGlobalMatrix(),t&&this.clearUpdateGlobalPositionTag()}return this._globalTransMatrix}doUpdateGlobalMatrix(){if(this.shadowHost){const t=this.shadowHost.globalTransMatrix;this._globalTransMatrix.multiply(t.a,t.b,t.c,t.d,t.e,t.f)}}tryUpdateGlobalAABBBounds(){return this._globalAABBBounds?this._globalAABBBounds.setValue(this._AABBBounds.x1,this._AABBBounds.y1,this._AABBBounds.x2,this._AABBBounds.y2):this._globalAABBBounds=this._AABBBounds.clone(),this.shadowHost&&this._globalAABBBounds.transformWithMatrix(this.shadowHost.globalTransMatrix),this._globalAABBBounds}}function Yl(t){return new Xl(t)}class ql{updateBounds(t,e,i,r){const{outerBorder:o,shadowBlur:n=e.shadowBlur}=t;if(o){const t=e.outerBorder,{distance:r=t.distance,lineWidth:s=t.lineWidth}=o;i.expand(r+(n+s)/2)}return i}}class Zl extends ql{updateBounds(t,e,i,r){const{outerBorder:o,shadowBlur:n=e.shadowBlur,strokeBoundsBuffer:s=e.strokeBoundsBuffer}=t;if(o){const t=e.outerBorder,{distance:r=t.distance,lineWidth:a=t.lineWidth}=o;Ln(i,r+(n+a)/2,!0,s)}return i}}class Jl{constructor(){this.pools=[]}static identity(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}allocate(){if(!this.pools.length)return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];const t=this.pools.pop();return Jl.identity(t),t}allocateByObj(t){let e;e=this.pools.length?this.pools.pop():[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];for(let i=0;i<e.length;i++)e[i]=t[i];return e}free(t){t&&this.pools.push(t)}get length(){return this.pools.length}release(){this.pools=[]}}const Ql=new class{constructor(){this.pools=[]}allocate(t,e,i,r,o,n){if(!this.pools.length)return new fe(t,e,i,r,o,n);const s=this.pools.pop();return s.a=t,s.b=e,s.c=i,s.d=r,s.e=o,s.f=n,s}allocateByObj(t){if(!this.pools.length)return new fe(t.a,t.b,t.c,t.d,t.e,t.f);const e=this.pools.pop();return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(){this.pools=[]}},th=new Jl;var eh=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},ih=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},rh=function(t,e){return function(i,r){e(i,r,t)}};function oh(t,e,i){const r=i[0],o=i[1],n=i[2];let s,a,l,h,c,d,u,g,p,f,m,b;return e===t?(t[12]=e[0]*r+e[4]*o+e[8]*n+e[12],t[13]=e[1]*r+e[5]*o+e[9]*n+e[13],t[14]=e[2]*r+e[6]*o+e[10]*n+e[14],t[15]=e[3]*r+e[7]*o+e[11]*n+e[15]):(s=e[0],a=e[1],l=e[2],h=e[3],c=e[4],d=e[5],u=e[6],g=e[7],p=e[8],f=e[9],m=e[10],b=e[11],t[0]=s,t[1]=a,t[2]=l,t[3]=h,t[4]=c,t[5]=d,t[6]=u,t[7]=g,t[8]=p,t[9]=f,t[10]=m,t[11]=b,t[12]=s*r+c*o+p*n+e[12],t[13]=a*r+d*o+f*n+e[13],t[14]=l*r+u*o+m*n+e[14],t[15]=h*r+g*o+b*n+e[15]),t}function nh(t,e){t[0]=e.a,t[1]=e.b,t[2]=0,t[3]=0,t[4]=e.c,t[5]=e.d,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e.e,t[13]=e.f,t[14]=0,t[15]=1}function sh(t,e,i){const r=e[0],o=e[1],n=e[2],s=e[3],a=e[4],l=e[5],h=e[6],c=e[7],d=e[8],u=e[9],g=e[10],p=e[11],f=e[12],m=e[13],b=e[14],y=e[15];let C=i[0],w=i[1],v=i[2],x=i[3];return t[0]=C*r+w*a+v*d+x*f,t[1]=C*o+w*l+v*u+x*m,t[2]=C*n+w*h+v*g+x*b,t[3]=C*s+w*c+v*p+x*y,C=i[4],w=i[5],v=i[6],x=i[7],t[4]=C*r+w*a+v*d+x*f,t[5]=C*o+w*l+v*u+x*m,t[6]=C*n+w*h+v*g+x*b,t[7]=C*s+w*c+v*p+x*y,C=i[8],w=i[9],v=i[10],x=i[11],t[8]=C*r+w*a+v*d+x*f,t[9]=C*o+w*l+v*u+x*m,t[10]=C*n+w*h+v*g+x*b,t[11]=C*s+w*c+v*p+x*y,C=i[12],w=i[13],v=i[14],x=i[15],t[12]=C*r+w*a+v*d+x*f,t[13]=C*o+w*l+v*u+x*m,t[14]=C*n+w*h+v*g+x*b,t[15]=C*s+w*c+v*p+x*y,t}function ah(t,e,i){var r;const{x:o=i.x,y:n=i.y,z:s=i.z,dx:a=i.dx,dy:l=i.dy,dz:h=i.dz,scaleX:c=i.scaleX,scaleY:d=i.scaleY,scaleZ:u=i.scaleZ,alpha:g=i.alpha,beta:p=i.beta,angle:f=i.angle,anchor3d:m=e.attribute.anchor,anchor:b}=e.attribute,y=[0,0,0];if(m){if("string"==typeof m[0]){const t=parseFloat(m[0])/100,i=e.AABBBounds;y[0]=i.x1+(i.x2-i.x1)*t}else y[0]=m[0];if("string"==typeof m[1]){const t=parseFloat(m[1])/100,i=e.AABBBounds;y[1]=i.x1+(i.x2-i.x1)*t}else y[1]=m[1];y[2]=null!==(r=m[2])&&void 0!==r?r:0}if(function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(t),oh(t,t,[o+a,n+l,s+h]),oh(t,t,[y[0],y[1],y[2]]),function(t,e,i){const r=Math.sin(i),o=Math.cos(i),n=e[4],s=e[5],a=e[6],l=e[7],h=e[8],c=e[9],d=e[10],u=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*o+h*r,t[5]=s*o+c*r,t[6]=a*o+d*r,t[7]=l*o+u*r,t[8]=h*o-n*r,t[9]=c*o-s*r,t[10]=d*o-a*r,t[11]=u*o-l*r}(t,t,p),function(t,e,i){const r=Math.sin(i),o=Math.cos(i),n=e[0],s=e[1],a=e[2],l=e[3],h=e[8],c=e[9],d=e[10],u=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*o-h*r,t[1]=s*o-c*r,t[2]=a*o-d*r,t[3]=l*o-u*r,t[8]=n*r+h*o,t[9]=s*r+c*o,t[10]=a*r+d*o,t[11]=l*r+u*o}(t,t,g),oh(t,t,[-y[0],-y[1],y[2]]),function(t,e,i){const r=i[0],o=i[1],n=i[2];t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(t,t,[c,d,u]),f){const i=th.allocate(),r=[0,0];if(b){if("string"==typeof m[0]){const t=parseFloat(m[0])/100,i=e.AABBBounds;r[0]=i.x1+(i.x2-i.x1)*t}else r[0]=m[0];if("string"==typeof m[1]){const t=parseFloat(m[1])/100,i=e.AABBBounds;r[1]=i.x1+(i.x2-i.x1)*t}else r[1]=m[1]}oh(i,i,[r[0],r[1],0]),function(t,e,i){const r=Math.sin(i),o=Math.cos(i),n=e[0],s=e[1],a=e[2],l=e[3],h=e[4],c=e[5],d=e[6],u=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*o+h*r,t[1]=s*o+c*r,t[2]=a*o+d*r,t[3]=l*o+u*r,t[4]=h*o-n*r,t[5]=c*o-s*r,t[6]=d*o-a*r,t[7]=u*o-l*r}(i,i,f),oh(i,i,[-r[0],-r[1],0]),sh(t,t,i)}}let lh=class{constructor(t){this.creator=t,this.hooks={onAttributeUpdate:new F(["graphic"]),onSetStage:new F(["graphic","stage"]),onRemove:new F(["graphic"]),onRelease:new F(["graphic"]),onAddIncremental:new F(["graphic","group","stage"]),onClearIncremental:new F(["graphic","group","stage"]),beforeUpdateAABBBounds:new F(["graphic","stage","willUpdate","aabbBounds"]),afterUpdateAABBBounds:new F(["graphic","stage","aabbBounds","globalAABBBounds","selfChange"])},this.tempAABBBounds1=new ue,this.tempAABBBounds2=new ue,this._rectBoundsContribitions=[new ql],this._symbolBoundsContribitions=[new Zl],this._circleBoundsContribitions=[new ql],this._arcBoundsContribitions=[new ql],this._pathBoundsContribitions=[new ql]}onAttributeUpdate(t){this.hooks.onAttributeUpdate.taps.length&&this.hooks.onAttributeUpdate.call(t)}onSetStage(t,e){this.hooks.onSetStage.taps.length&&this.hooks.onSetStage.call(t,e)}onRemove(t){this.hooks.onRemove.taps.length&&this.hooks.onRemove.call(t)}onRelease(t){this.hooks.onRelease.taps.length&&this.hooks.onRelease.call(t)}onAddIncremental(t,e,i){this.hooks.onAddIncremental.taps.length&&this.hooks.onAddIncremental.call(t,e,i)}onClearIncremental(t,e){this.hooks.onClearIncremental.taps.length&&this.hooks.onClearIncremental.call(t,e)}beforeUpdateAABBBounds(t,e,i,r){this.hooks.beforeUpdateAABBBounds.taps.length&&this.hooks.beforeUpdateAABBBounds.call(t,e,i,r)}afterUpdateAABBBounds(t,e,i,r,o){this.hooks.afterUpdateAABBBounds.taps.length&&this.hooks.afterUpdateAABBBounds.call(t,e,i,r,o)}updatePathProxyAABBBounds(t,e){const i="function"==typeof e.pathProxy?e.pathProxy(e.attribute):e.pathProxy;if(!i)return!1;const r=new Qe(t);return Pi(i.commandList,r,0,0),!0}updateRectAABBBounds(t,e,i,r){if(!this._validCheck(t,e,i,r))return i;if(!this.updatePathProxyAABBBounds(i,r)){let{width:e,height:r}=t;const{x1:o,y1:n,x:s,y:a}=t;e=null!=e?e:o-s,r=null!=r?r:n-a,i.set(0,0,e||0,r||0)}const o=this.tempAABBBounds1,n=this.tempAABBBounds2;return o.setValue(i.x1,i.y1,i.x2,i.y2),n.setValue(i.x1,i.y1,i.x2,i.y2),this._rectBoundsContribitions.length&&this._rectBoundsContribitions.forEach((s=>{s.updateBounds(t,e,o,r),i.union(o),o.setValue(n.x1,n.y1,n.x2,n.y2)})),this.transformAABBBounds(t,i,e,!1,r),i}updateGroupAABBBounds(t,e,i,r){const o=i;i=i.clone();const{width:n,height:s,path:a,clip:l=e.clip}=t;a&&a.length?a.forEach((t=>{i.union(t.AABBBounds)})):null!=n&&null!=s&&i.set(0,0,Math.max(0,n),Math.max(0,s)),l||r.forEachChildren((t=>{i.union(t.AABBBounds)}));const h=this.tempAABBBounds1,c=this.tempAABBBounds2;return h.setValue(i.x1,i.y1,i.x2,i.y2),c.setValue(i.x1,i.y1,i.x2,i.y2),this.transformAABBBounds(t,i,e,!1,r),o.copy(i),o}updateGlyphAABBBounds(t,e,i,r){return this._validCheck(t,e,i,r)?(r.getSubGraphic().forEach((t=>{i.union(t.AABBBounds)})),i):i}updateRichTextAABBBounds(t,e,i,r){if(!this._validCheck(t,e,i,r))return i;if(!r)return i;const{width:o=e.width,height:n=e.height,maxWidth:s=e.maxWidth,maxHeight:a=e.maxHeight,textAlign:l=e.textAlign,textBaseline:h=e.textBaseline}=t;if(o>0&&n>0)i.set(0,0,o,n);else{const t=r.getFrameCache(),{width:e,height:l}=t.getActualSize();let h=o||e||0,c=n||l||0;c="number"==typeof a&&c>a?a:c||0,h="number"==typeof s&&h>s?s:h||0,i.set(0,0,h,c)}let c=0;switch(h){case"top":c=0;break;case"middle":c=-i.height()/2;break;case"bottom":c=-i.height()}let d=0;switch(l){case"left":d=0;break;case"center":d=-i.width()/2;break;case"right":d=-i.width()}i.translate(d,c);const u=this.tempAABBBounds1,g=this.tempAABBBounds2;return u.setValue(i.x1,i.y1,i.x2,i.y2),g.setValue(i.x1,i.y1,i.x2,i.y2),this.transformAABBBounds(t,i,e,!1,r),i}updateTextAABBBounds(t,e,i,r){if(!this._validCheck(t,e,i,r))return i;if(!r)return i;const{text:o=e.text}=r.attribute;Array.isArray(o)?r.updateMultilineAABBBounds(o):r.updateSingallineAABBBounds(o);const n=this.tempAABBBounds1,s=this.tempAABBBounds2;n.setValue(i.x1,i.y1,i.x2,i.y2),s.setValue(i.x1,i.y1,i.x2,i.y2);const{scaleX:a=e.scaleX,scaleY:l=e.scaleY,shadowBlur:h=e.shadowBlur,strokeBoundsBuffer:c=e.strokeBoundsBuffer}=t;if(h){Ln(n,h/Math.abs(a+l),!0,c),i.union(n)}return this.combindShadowAABBBounds(i,r),ce(i,i,r.transMatrix),i}updatePathAABBBounds(t,e,i,r){if(!this._validCheck(t,e,i,r))return i;this.updatePathProxyAABBBounds(i,r)||this.updatePathAABBBoundsImprecise(t,e,i,r);const o=this.tempAABBBounds1,n=this.tempAABBBounds2;o.setValue(i.x1,i.y1,i.x2,i.y2),n.setValue(i.x1,i.y1,i.x2,i.y2),this._pathBoundsContribitions.length&&this._pathBoundsContribitions.forEach((s=>{s.updateBounds(t,e,o,r),i.union(o),o.setValue(n.x1,n.y1,n.x2,n.y2)}));const{lineJoin:s=e.lineJoin}=t;return this.transformAABBBounds(t,i,e,"miter"===s,r),i}updatePathAABBBoundsImprecise(t,e,i,r){if(!r)return i;const o=r.getParsedPathShape();return i.union(o.getBounds()),i}updatePyramid3dAABBBounds(t,e,i,r){if(!r)return i;const o=r.stage;if(!o||!o.camera)return i;r.findFace().vertices.forEach((t=>{const e=t[0],r=t[1];i.add(e,r)}));const n=this.tempAABBBounds1,s=this.tempAABBBounds2;return n.setValue(i.x1,i.y1,i.x2,i.y2),s.setValue(i.x1,i.y1,i.x2,i.y2),this.transformAABBBounds(t,i,e,!1,r),i}updateArc3dAABBBounds(t,e,i,r){if(!r)return i;const o=r.stage;if(!o||!o.camera)return i;const{outerRadius:n=e.outerRadius,height:s=0}=t,a=n+s;i.setValue(-a,-a,a,a);const l=this.tempAABBBounds1,h=this.tempAABBBounds2;return l.setValue(i.x1,i.y1,i.x2,i.y2),h.setValue(i.x1,i.y1,i.x2,i.y2),this.transformAABBBounds(t,i,e,!1,r),i}updatePolygonAABBBounds(t,e,i,r){if(!this._validCheck(t,e,i,r))return i;this.updatePathProxyAABBBounds(i,r)||this.updatePolygonAABBBoundsImprecise(t,e,i,r);const o=this.tempAABBBounds1,n=this.tempAABBBounds2;o.setValue(i.x1,i.y1,i.x2,i.y2),n.setValue(i.x1,i.y1,i.x2,i.y2);const{lineJoin:s=e.lineJoin}=t;return this.transformAABBBounds(t,i,e,"miter"===s,r),i}updatePolygonAABBBoundsImprecise(t,e,i,r){const{points:o=e.points}=t;return o.forEach((t=>{i.add(t.x,t.y)})),i}updateLineAABBBounds(t,e,i,r){if(!this._validCheck(t,e,i,r))return i;this.updatePathProxyAABBBounds(i,r)||(t.segments?this.updateLineAABBBoundsBySegments(t,e,i,r):this.updateLineAABBBoundsByPoints(t,e,i,r));const o=this.tempAABBBounds1,n=this.tempAABBBounds2;o.setValue(i.x1,i.y1,i.x2,i.y2),n.setValue(i.x1,i.y1,i.x2,i.y2);const{lineJoin:s=e.lineJoin}=t;return this.transformAABBBounds(t,i,e,"miter"===s,r),i}updateLineAABBBoundsByPoints(t,e,i,r){const{points:o=e.points}=t,n=i;return o.forEach((t=>{n.add(t.x,t.y)})),n}updateLineAABBBoundsBySegments(t,e,i,r){const{segments:o=e.segments}=t,n=i;return o.forEach((t=>{t.points.forEach((t=>{n.add(t.x,t.y)}))})),n}updateAreaAABBBounds(t,e,i,r){if(!this._validCheck(t,e,i,r))return i;this.updatePathProxyAABBBounds(i,r)||(t.segments?this.updateAreaAABBBoundsBySegments(t,e,i,r):this.updateAreaAABBBoundsByPoints(t,e,i,r));const o=this.tempAABBBounds1,n=this.tempAABBBounds2;o.setValue(i.x1,i.y1,i.x2,i.y2),n.setValue(i.x1,i.y1,i.x2,i.y2);const{lineJoin:s=e.lineJoin}=t;return this.transformAABBBounds(t,i,e,"miter"===s,r),i}updateAreaAABBBoundsByPoints(t,e,i,r){const{points:o=e.points}=t,n=i;return o.forEach((t=>{var e,i;n.add(t.x,t.y),n.add(null!==(e=t.x1)&&void 0!==e?e:t.x,null!==(i=t.y1)&&void 0!==i?i:t.y)})),n}updateAreaAABBBoundsBySegments(t,e,i,r){const{segments:o=e.segments}=t,n=i;return o.forEach((t=>{t.points.forEach((t=>{var e,i;n.add(t.x,t.y),n.add(null!==(e=t.x1)&&void 0!==e?e:t.x,null!==(i=t.y1)&&void 0!==i?i:t.y)}))})),n}updateCircleAABBBounds(t,e,i,r,o){if(!this._validCheck(t,e,i,o))return i;this.updatePathProxyAABBBounds(i,o)||(r?this.updateCircleAABBBoundsImprecise(t,e,i,o):this.updateCircleAABBBoundsAccurate(t,e,i,o));const n=this.tempAABBBounds1,s=this.tempAABBBounds2;return n.setValue(i.x1,i.y1,i.x2,i.y2),s.setValue(i.x1,i.y1,i.x2,i.y2),this._circleBoundsContribitions.length&&this._circleBoundsContribitions.forEach((r=>{r.updateBounds(t,e,n,o),i.union(n),n.setValue(s.x1,s.y1,s.x2,s.y2)})),this.transformAABBBounds(t,i,e,!1,o),i}updateCircleAABBBoundsImprecise(t,e,i,r){const{radius:o=e.radius}=t;return i.set(-o,-o,o,o),i}updateCircleAABBBoundsAccurate(t,e,i,r){const{startAngle:o=e.startAngle,endAngle:n=e.endAngle,radius:s=e.radius}=t;return n-o>qt-Kt?i.set(-s,-s,s,s):Zo(o,n,s,i),i}updateArcAABBBounds(t,e,i,r,o){if(!this._validCheck(t,e,i,o))return i;this.updatePathProxyAABBBounds(i,o)||(r?this.updateArcAABBBoundsImprecise(t,e,i,o):this.updateArcAABBBoundsAccurate(t,e,i,o));const n=this.tempAABBBounds1,s=this.tempAABBBounds2;n.setValue(i.x1,i.y1,i.x2,i.y2),s.setValue(i.x1,i.y1,i.x2,i.y2),this._arcBoundsContribitions.length&&this._arcBoundsContribitions.forEach((r=>{r.updateBounds(t,e,n,o),i.union(n),n.setValue(s.x1,s.y1,s.x2,s.y2)}));const{lineJoin:a=e.lineJoin}=t;return this.transformAABBBounds(t,i,e,"miter"===a,o),i}updateArcAABBBoundsImprecise(t,e,i,r){let{outerRadius:o=e.outerRadius,innerRadius:n=e.innerRadius}=t;const{outerPadding:s=e.outerPadding,innerPadding:a=e.innerPadding}=t;return o+=s,n-=a,o<n&&(o=n),i.set(-o,-o,o,o),i}updateArcAABBBoundsAccurate(t,e,i,r){let{outerRadius:o=e.outerRadius,innerRadius:n=e.innerRadius}=t;const{outerPadding:s=e.outerPadding,innerPadding:a=e.innerPadding}=t;if(o+=s,n-=a,o<n){const t=o;o=n,n=t}let{endAngle:l=e.endAngle,startAngle:h=e.startAngle}=t;if(h>l){const t=h;h=l,l=t}return o<=Kt?i.set(0,0,0,0):Math.abs(l-h)>qt-Kt?i.set(-o,-o,o,o):(Zo(h,l,o,i),Zo(h,l,n,i)),i}updateSymbolAABBBounds(t,e,i,r,o){if(!this._validCheck(t,e,i,o))return i;this.updatePathProxyAABBBounds(i,o)||(r?this.updateSymbolAABBBoundsImprecise(t,e,i,o):this.updateSymbolAABBBoundsAccurate(t,e,i,o));const n=this.tempAABBBounds1,s=this.tempAABBBounds2;n.setValue(i.x1,i.y1,i.x2,i.y2),s.setValue(i.x1,i.y1,i.x2,i.y2),this._symbolBoundsContribitions.length&&this._symbolBoundsContribitions.forEach((r=>{r.updateBounds(t,e,n,o),i.union(n),n.setValue(s.x1,s.y1,s.x2,s.y2)}));const{lineJoin:a=e.lineJoin}=t;return this.transformAABBBounds(t,i,e,"miter"===a,o),i}updateSymbolAABBBoundsImprecise(t,e,i,r){const{size:o=e.size}=t;if(et(o))i.set(-o[0]/2,-o[1]/2,o[0]/2,o[1]/2);else{const t=o/2;i.set(-t,-t,t,t)}return i}updateSymbolAABBBoundsAccurate(t,e,i,r){if(!r)return i;const{size:o=e.size}=t;return r.getParsedPath().bounds(o,i),i}updateImageAABBBounds(t,e,i,r){if(!this._validCheck(t,e,i,r))return i;if(!this.updatePathProxyAABBBounds(i,r)){const{width:r=e.width,height:o=e.height}=t;i.set(0,0,r,o)}const o=this.tempAABBBounds1,n=this.tempAABBBounds2;return o.setValue(i.x1,i.y1,i.x2,i.y2),n.setValue(i.x1,i.y1,i.x2,i.y2),this.transformAABBBounds(t,i,e,!1,r),i}combindShadowAABBBounds(t,e){if(e&&e.shadowRoot){const i=e.shadowRoot.AABBBounds;t.union(i)}}transformAABBBounds(t,e,i,r,o){if(!e.empty()){const{scaleX:o=i.scaleX,scaleY:n=i.scaleY,stroke:s=i.stroke,shadowBlur:a=i.shadowBlur,lineWidth:l=i.lineWidth,pickStrokeBuffer:h=i.pickStrokeBuffer,strokeBoundsBuffer:c=i.strokeBoundsBuffer}=t,d=this.tempAABBBounds1,u=this.tempAABBBounds2;if(s&&l){Ln(d,(l+h)/Math.abs(o+n),r,c),e.union(d),d.setValue(u.x1,u.y1,u.x2,u.y2)}if(a){const{shadowOffsetX:r=i.shadowOffsetX,shadowOffsetY:s=i.shadowOffsetY}=t;Ln(d,a/Math.abs(o+n)*2,!1,c+1),d.translate(r,s),e.union(d)}}if(this.combindShadowAABBBounds(e,o),e.empty())return;let n=!0;const s=o.transMatrix;o&&o.isContainer&&(n=!(1===s.a&&0===s.b&&0===s.c&&1===s.d&&0===s.e&&0===s.f)),n&&ce(e,e,s)}_validCheck(t,e,i,r){if(!r)return!0;if(!r.valid)return i.clear(),!1;const{visible:o=e.visible}=t;return!!o||(i.clear(),!1)}};lh=eh([f(),rh(0,g(ns)),ih("design:paramtypes",[Object])],lh);const hh=new class{constructor(){this.store=new Map}RegisterGraphicCreator(t,e){this.store.set(t,e),this[t]=e}CreateGraphic(t,e){const i=this.store.get(t);return i?i(e):null}};let ch;function dh(t){return ch||(ch=hh.CreateGraphic("text",{})),ch.initAttributes(t),ch.AABBBounds}const uh={x:0,y:0,z:0,lastModelMatrix:null};class gh{init(t){t&&(this._renderContribitions=t.getContributions()),this._renderContribitions||(this._renderContribitions=[]),this.builtinContributions&&this.builtinContributions.forEach((t=>this._renderContribitions.push(t))),this._renderContribitions.length&&(this._renderContribitions.sort(((t,e)=>e.order-t.order)),this._beforeRenderContribitions=this._renderContribitions.filter((t=>t.time===Ri.beforeFillStroke)),this._afterRenderContribitions=this._renderContribitions.filter((t=>t.time===Ri.afterFillStroke)))}beforeRenderStep(t,e,i,r,o,n,s,a,l,h,c,d,u){this._beforeRenderContribitions&&this._beforeRenderContribitions.forEach((g=>{g.drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u)}))}afterRenderStep(t,e,i,r,o,n,s,a,l,h,c,d,u){this._afterRenderContribitions&&this._afterRenderContribitions.forEach((g=>{g.drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u)}))}valid(t,e,i,r){const{fill:o=e.fill,background:n,stroke:s=e.stroke,opacity:a=e.opacity,fillOpacity:l=e.fillOpacity,lineWidth:h=e.lineWidth,strokeOpacity:c=e.strokeOpacity,visible:d=e.visible}=t.attribute,u=As(a,l,o),g=Bs(a,c),p=_s(o,n),f=Ss(s,h);return!(!t.valid||!d)&&!(!p&&!f)&&!!(u||g||i||r||n)&&{fVisible:u,sVisible:g,doFill:p,doStroke:f}}transform(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const{x:o=e.x,y:n=e.y,z:s=e.z,scaleX:a=e.scaleX,scaleY:l=e.scaleY,angle:h=e.angle,postMatrix:c}=t.attribute,d=i.modelMatrix,u=i.camera;uh.x=o,uh.y=n,uh.z=s,uh.lastModelMatrix=d;const g=u&&(r||function(t){const{alpha:e,beta:i}=t.attribute;return e||i}(t)),p=g?t.transMatrix.onlyTranslate()&&!c:1===a&&1===l&&0===h&&!c;if(g){const r=th.allocate(),o=th.allocate();ah(o,t,e),sh(r,d||r,o),uh.x=0,uh.y=0,uh.z=0,i.modelMatrix=r,i.setTransform(1,0,0,1,0,0,!0),th.free(o)}if(p&&!d){const r=t.getOffsetXY(e);uh.x+=r.x,uh.y+=r.y,uh.z=s,i.setTransformForCurrent()}else if(g)uh.x=0,uh.y=0,uh.z=0,i.setTransform(1,0,0,1,0,0,!0);else if(u&&i.project){const r=t.getOffsetXY(e);uh.x+=r.x,uh.y+=r.y,this.transformWithoutTranslate(i,uh.x,uh.y,uh.z,a,l,h)}else i.transformFromMatrix(t.transMatrix,!0),uh.x=0,uh.y=0,uh.z=0;return uh}transformUseContext2d(t,e,i,r){const o=r.camera;if(this.camera=o,o){const e=t.AABBBounds,o=e.x2-e.x1,n=e.y2-e.y1,s=r.project(0,0,i),a=r.project(o,0,i),l=r.project(o,n,i),h={x:0,y:0},c={x:o,y:0},d={x:o,y:n};r.camera=null;const u=1/(h.x*(d.y-c.y)-c.x*d.y+d.x*c.y+(c.x-d.x)*h.y),g=-(h.y*(l.x-a.x)-c.y*l.x+d.y*a.x+(c.y-d.y)*s.x)*u,p=(c.y*l.y+h.y*(a.y-l.y)-d.y*a.y+(d.y-c.y)*s.y)*u,f=(h.x*(l.x-a.x)-c.x*l.x+d.x*a.x+(c.x-d.x)*s.x)*u,m=-(c.x*l.y+h.x*(a.y-l.y)-d.x*a.y+(d.x-c.x)*s.y)*u,b=(h.x*(d.y*a.x-c.y*l.x)+h.y*(c.x*l.x-d.x*a.x)+(d.x*c.y-c.x*d.y)*s.x)*u,y=(h.x*(d.y*a.y-c.y*l.y)+h.y*(c.x*l.y-d.x*a.y)+(d.x*c.y-c.x*d.y)*s.y)*u;r.setTransform(g,p,f,m,b,y,!0)}}restoreTransformUseContext2d(t,e,i,r){this.camera&&(r.camera=this.camera)}transformWithoutTranslate(t,e,i,r,o,n,s){const a=t.project(e,i,r);t.translate(a.x,a.y,!1),t.scale(o,n,!1),t.rotate(s,!1),t.translate(-a.x,-a.y,!1),t.setTransformForCurrent()}_draw(t,e,i,r,o){const{context:n}=r;if(!n)return;n.highPerformanceSave();const s=this.transform(t,e,n,i),{x:a,y:l,z:h,lastModelMatrix:c}=s;this.z=h,function(t,e,i,r,o,n,s,a){if(!t.pathProxy)return!1;const l=yo(t,null==n?void 0:n.theme)[t.type],{fill:h=l.fill,stroke:c=l.stroke,opacity:d=l.opacity,fillOpacity:u=l.fillOpacity,lineWidth:g=l.lineWidth,strokeOpacity:p=l.strokeOpacity,visible:f=l.visible,x:m=l.x,y:b=l.y}=t.attribute,y=As(d,u,h),C=Bs(d,p),w=_s(h),v=Ss(c,g);return!f||(!w&&!v||(!(y||C||s||a)||(e.beginPath(),Pi(("function"==typeof t.pathProxy?t.pathProxy(t.attribute):t.pathProxy).commandList,e,i,r),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),v&&(a?a(e,t.attribute,l):C&&(e.setStrokeStyle(t,t.attribute,i-m,r-b,l),e.stroke())),w&&(s?s(e,t.attribute,l):y&&(e.setCommonStyle(t,t.attribute,i-m,r-b,l),e.fill())),!0)))}(t,n,a,l,0,o)||(this.drawShape(t,n,a,l,r,o),this.z=0,n.modelMatrix!==c&&th.free(n.modelMatrix),n.modelMatrix=c),n.highPerformanceRestore()}}const ph=function(){const t={linearGradient:/^(linear\-gradient)/i,radialGradient:/^(radial\-gradient)/i,conicGradient:/^(conic\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,fromAngleValue:/^from\s*(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/(^\#[0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^(rgb\(\d{1,3},\s*\d{1,3},\s*\d{1,3}\))/i,rgbaColor:/^(rgba\(\d{1,3},\s*\d{1,3},\s*\d{1,3},\s*((\d\.\d+)|\d{1,3})\))/i,number:/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/};let e="";function i(t){const i=new Error(e+": "+t);throw i.source=e,i}function r(){return o("linear",t.linearGradient,n)||o("radial",t.radialGradient,a)||o("conic",t.conicGradient,s)}function o(e,r,o){return function(r,n){const s=b(r);if(s){b(t.startCall)||i("Missing (");const r=function(r){const n=o();return n&&(b(t.comma)||i("Missing comma before color stops")),{type:e,orientation:n,colorStops:u(g)}}();return b(t.endCall)||i("Missing )"),r}}(r)}function n(){return m("directional",t.sideOrCorner,1)||m("angular",t.angleValue,1)}function s(){return m("angular",t.fromAngleValue,1)}function a(){let i,r,o=l();return o&&(i=[],i.push(o),r=e,b(t.comma)&&(o=l(),o?i.push(o):e=r)),i}function l(){let t=function(){const t=m("shape",/^(circle)/i,0);return t&&(t.style=f()||h()),t}()||function(){const t=m("shape",/^(ellipse)/i,0);return t&&(t.style=p()||h()),t}();if(t)t.at=c();else{const e=h();if(e){t=e;const i=c();i&&(t.at=i)}else{const e=d();e&&(t={type:"default-radial",at:e})}}return t}function h(){return m("extent-keyword",t.extentKeywords,1)}function c(){if(m("position",/^at/,0)){const t=d();return t||i("Missing positioning value"),t}}function d(){const t={x:p(),y:p()};if(t.x||t.y)return{type:"position",value:t}}function u(e){let r=e();const o=[];if(r)for(o.push(r);b(t.comma);)r=e(),r?o.push(r):i("One extra comma");return o}function g(){const e=m("hex",t.hexColor,1)||m("rgba",t.rgbaColor,1)||m("rgb",t.rgbColor,1)||m("literal",t.literalColor,0);return e||i("Expected color definition"),e.length=p(),e}function p(){return m("%",t.percentageValue,1)||m("position-keyword",t.positionKeywords,1)||f()}function f(){return m("px",t.pixelValue,1)||m("em",t.emValue,1)}function m(t,e,i){const r=b(e);if(r)return{type:t,value:r[i]}}function b(t){const i=/^[\n\r\t\s]+/.exec(e);i&&y(i[0].length);const r=t.exec(e);return r&&y(r[0].length),r}function y(t){e=e.substr(t)}return function(t){return e=t.toString(),function(){const t=u(r);return e.length>0&&i("Invalid input not EOF"),t}()}}();class fh{static IsGradient(t){return!("string"==typeof t&&!t.includes("gradient"))}static IsGradientStr(t){return"string"==typeof t&&t.includes("gradient")}static Parse(t){if(fh.IsGradientStr(t))try{const e=ph(t)[0];if(e){if("linear"===e.type)return fh.ParseLinear(e);if("radial"===e.type)return fh.ParseRadial(e);if("conic"===e.type)return fh.ParseConic(e)}}catch(e){return t}return t}static ParseConic(t){const{orientation:e,colorStops:i=[]}=t,r=$t/2,o=parseFloat(e.value)/180*$t-r;return{gradient:"conical",x:.5,y:.5,startAngle:o,endAngle:o+qt,stops:i.map((t=>({color:t.value,offset:parseFloat(t.length.value)/100})))}}static ParseRadial(t){const{colorStops:e=[]}=t;return{gradient:"radial",x0:.5,y0:.5,x1:.5,y1:.5,r0:0,r1:1,stops:e.map((t=>({color:t.value,offset:parseFloat(t.length.value)/100})))}}static ParseLinear(t){const{orientation:e,colorStops:i=[]}=t,r=$t/2;let o="angular"===e.type?parseFloat(e.value)/180*$t:0;for(;o<0;)o+=qt;for(;o>qt;)o-=qt;let n=0,s=0,a=0,l=0;return o<r?(n=0,s=1,a=Math.sin(o),l=Math.cos(o)):o<$t?(n=0,s=0,a=Math.cos(o-r),l=Math.sin(o-r)):o<$t+r?(n=1,s=0,a=n-Math.sin(o-$t),l=Math.cos(o-$t)):(n=1,a=n-Math.cos(o-r-$t),l-=Math.sin(o-r-$t)),{gradient:"linear",x0:n,y0:s,x1:a,y1:l,stops:i.map((t=>({color:t.value,offset:parseFloat(t.length.value)/100})))}}}function mh(t,e,i){let r=e;const{a:o,b:n,c:s,d:a}=t.currentMatrix,l=Math.sign(o)*Math.sqrt(o*o+n*n),h=Math.sign(a)*Math.sqrt(s*s+a*a);return l+h===0?0:(r=r/Math.abs(l+h)*2*i,r)}function bh(t,e,i,r,o){if(!e||!0===e)return"black";let n,s;if(et(e))for(let t=0;t<e.length&&(s=e[t],!s);t++);else s=e;return s=fh.Parse(s),"string"==typeof s?s:("linear"===s.gradient?n=function(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;var n,s,a,l;const h=i.AABBBounds;if(!h)return;let c=h.x2-h.x1,d=h.y2-h.y1,u=h.x1-r,g=h.y1-o;if(i.attribute){const{scaleX:t=1,scaleY:e=1}=i.attribute;if(t*e==0)return;c/=t,d/=e,u/=t,g/=e}const p=t.createLinearGradient(u+(null!==(n=e.x0)&&void 0!==n?n:0)*c,g+(null!==(s=e.y0)&&void 0!==s?s:0)*d,u+(null!==(a=e.x1)&&void 0!==a?a:1)*c,g+(null!==(l=e.y1)&&void 0!==l?l:0)*d);return e.stops.forEach((t=>{p.addColorStop(t.offset,t.color)})),p}(t,s,i,r,o):"conical"===s.gradient?n=function(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;var n,s;const a=i.AABBBounds;if(!a)return;let l=a.x2-a.x1,h=a.y2-a.y1,c=a.x1-r,d=a.y1-o;if(i.attribute){const{scaleX:t=1,scaleY:e=1}=i.attribute;if(t*e==0)return;l/=t,h/=e,c/=t,d/=e}const u=t.createConicGradient(c+(null!==(n=e.x)&&void 0!==n?n:0)*l,d+(null!==(s=e.y)&&void 0!==s?s:0)*h,e.startAngle,e.endAngle);return e.stops.forEach((t=>{u.addColorStop(t.offset,t.color)})),u.GetPattern(l+c,h+d,void 0)}(t,s,i,r,o):"radial"===s.gradient&&(n=function(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;var n,s,a,l,h,c;const d=i.AABBBounds;if(!d)return;let u=d.x2-d.x1,g=d.y2-d.y1,p=d.x1-r,f=d.y1-o;if(i.attribute){const{scaleX:t=1,scaleY:e=1}=i.attribute;if(t*e==0)return;p/=t,f/=e,u/=t,g/=e}const m=t.createRadialGradient(p+(null!==(n=e.x0)&&void 0!==n?n:.5)*u,f+(null!==(s=e.y0)&&void 0!==s?s:.5)*g,Math.max(u,g)*(null!==(a=e.r0)&&void 0!==a?a:0),p+(null!==(l=e.x1)&&void 0!==l?l:.5)*u,f+(null!==(h=e.y1)&&void 0!==h?h:.5)*g,Math.max(u,g)*(null!==(c=e.r1)&&void 0!==c?c:.5));return e.stops.forEach((t=>{m.addColorStop(t.offset,t.color)})),m}(t,s,i,r,o)),n||"orange")}var yh=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Ch=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},wh=function(t,e){return function(i,r){e(i,r,t)}};class vh{constructor(){this.time=Ri.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){var g;const{background:p,backgroundOpacity:f=(null!==(g=t.attribute.fillOpacity)&&void 0!==g?g:l.backgroundOpacity),opacity:m=l.opacity,backgroundMode:b=l.backgroundMode,backgroundFit:y=l.backgroundFit}=t.attribute;if(p)if(t.backgroundImg&&t.resources){const o=t.resources.get(p);if("success"!==o.state||!o.data)return;if(e.save(),t.parent&&!t.transMatrix.onlyTranslate()){const i=yo(t.parent).group,{scrollX:r=i.scrollX,scrollY:o=i.scrollY}=t.parent.attribute;e.setTransformFromMatrix(t.parent.globalTransMatrix,!0),e.translate(r,o)}e.clip();const n=t.AABBBounds;e.setCommonStyle(t,t.attribute,i,r,l),e.globalAlpha=f*m,this.doDrawImage(e,o.data,n,b,y),e.restore(),t.transMatrix.onlyTranslate()||e.setTransformForCurrent()}else e.highPerformanceSave(),e.setCommonStyle(t,t.attribute,i,r,l),e.globalAlpha=f*m,e.fillStyle=p,e.fill(),e.highPerformanceRestore()}doDrawImage(t,e,i,r,o){if("no-repeat"===r)t.drawImage(e,i.x1,i.y1,i.width(),i.height());else{const n=i.width(),s=i.height();let a=n,l=s;if(o&&"repeat"!==r&&(e.width||e.height)){const i=e.width,o=e.height;"repeat-x"===r?(a=i*(s/o),l=s):"repeat-y"===r&&(l=o*(n/i),a=n);const h=t.dpr,c=Jr.allocate({width:a,height:l,dpr:h}),d=c.getContext("2d");d&&(d.inuse=!0,d.clearMatrix(),d.setTransformForCurrent(!0),d.clearRect(0,0,a,l),d.drawImage(e,0,0,a,l),e=c.nativeCanvas),Jr.free(c)}const h=t.dpr,c=t.createPattern(e,r);c.setTransform&&c.setTransform(new DOMMatrix([1/h,0,0,1/h,0,0])),t.fillStyle=c,t.translate(i.x1,i.y1),t.fillRect(0,0,n,s),t.translate(-i.x1,-i.y1)}}}const xh=new vh;let _h=class{constructor(t){this.subRenderContribitions=t,this.time=Ri.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){this._subRenderContribitions||(this._subRenderContribitions=this.subRenderContribitions.getContributions()),this._subRenderContribitions.forEach((g=>{g.render(t,e,i,r,o,n,s,a,l,h,c,d,u)}))}};_h=yh([f(),wh(0,g(H)),wh(0,m(Us)),Ch("design:paramtypes",[Object])],_h);class Sh{constructor(){this.time=Ri.afterFillStroke,this.useStyle=!0,this.order=10}createCommonPattern(t,e,i,r,o){const n=(t-2*e)/2,s=r.dpr,a=Jr.allocate({width:t,height:t,dpr:s}),l=a.getContext("2d");if(!l)return null;l.inuse=!0,l.clearMatrix(),l.setTransformForCurrent(!0),l.clearRect(0,0,t,t),o(n,l);const h=r.createPattern(a.nativeCanvas,"repeat");return h.setTransform&&h.setTransform(new DOMMatrix([1/s,0,0,1/s,0,0])),Jr.free(a),h}createCirclePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,((t,e)=>{e.fillStyle=i,e.arc(t,t,t,0,qt),e.fill()}))}createDiamondPattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,((e,r)=>{const o=t/2,n=o;r.fillStyle=i,r.moveTo(o,n-e),r.lineTo(e+o,n),r.lineTo(o,n+e),r.lineTo(o-e,n),r.closePath(),r.fill()}))}createRectPattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,((t,r)=>{const o=e,n=o;r.fillStyle=i,r.fillRect(o,n,2*t,2*t)}))}createVerticalLinePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,((r,o)=>{const n=e;o.fillStyle=i,o.fillRect(n,0,2*r,t)}))}createHorizontalLinePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,((r,o)=>{const n=e;o.fillStyle=i,o.fillRect(0,n,t,2*r)}))}createBiasLRLinePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,((e,r)=>{r.strokeStyle=i,r.lineWidth=e,r.moveTo(0,0),r.lineTo(t,t);const o=t/2,n=-o;r.moveTo(o,n),r.lineTo(o+t,n+t),r.moveTo(-o,-n),r.lineTo(-o+t,-n+t),r.stroke()}))}createBiasRLLinePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,((e,r)=>{r.strokeStyle=i,r.lineWidth=e,r.moveTo(t,0),r.lineTo(0,t);const o=t/2,n=o;r.moveTo(t+o,n),r.lineTo(o,n+t),r.moveTo(t-o,-n),r.lineTo(-o,-n+t),r.stroke()}))}createGridPattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,((t,r)=>{const o=e,n=o;r.fillStyle=i,r.fillRect(o,n,t,t),r.fillRect(o+t,n+t,t,t)}))}initTextureMap(t,e){this.textureMap=new Map}drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){this.textureMap||this.initTextureMap(e,t.stage);const{texture:g=l.texture,textureColor:p=l.textureColor,textureSize:f=l.textureSize,texturePadding:m=l.texturePadding}=t.attribute;g&&this.drawTexture(g,t,e,i,r,l,p,f,m)}drawTexture(t,e,i,r,o,n,s,a,l){let h=this.textureMap.get(t);if(!h)switch(t){case"circle":h=this.createCirclePattern(a,l,s,i);break;case"diamond":h=this.createDiamondPattern(a,l,s,i);break;case"rect":h=this.createRectPattern(a,l,s,i);break;case"vertical-line":h=this.createVerticalLinePattern(a,l,s,i);break;case"horizontal-line":h=this.createHorizontalLinePattern(a,l,s,i);break;case"bias-lr":h=this.createBiasLRLinePattern(a,l,s,i);break;case"bias-rl":h=this.createBiasRLLinePattern(a,l,s,i);break;case"grid":h=this.createGridPattern(a,l,s,i)}h&&(i.highPerformanceSave(),i.setCommonStyle(e,e.attribute,r,o,n),i.fillStyle=h,i.fill(),i.highPerformanceRestore())}}const Ah=new Sh;const Rh=new class{constructor(){this.time=Ri.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,n,s,a,l,h,c,d){const{outerBorder:u,innerBorder:g}=t.attribute,p=u&&!1!==u.visible,f=g&&!1!==g.visible;if(!p&&!f)return;const{innerPadding:m=l.innerPadding,outerPadding:b=l.outerPadding,startAngle:y=l.startAngle,endAngle:C=l.endAngle,opacity:w=l.opacity,x:v=l.x,y:x=l.y,scaleX:_=l.scaleX,scaleY:S=l.scaleY}=t.attribute;let{innerRadius:A=l.innerRadius,outerRadius:R=l.outerRadius}=t.attribute;R+=b,A-=m;const B=!(!u||!u.stroke),M=!(!g||!g.stroke);if(p){const{distance:o=l.outerBorder.distance}=u,n=mh(e,o,e.dpr),s=o/R;if(t.setAttributes({outerRadius:R+n,innerRadius:A-n,startAngle:y-s,endAngle:C+s}),e.beginPath(),Hs(t,e,i,r,R+n,A-n),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),d)d(e,u,l.outerBorder);else if(B){const o=l.outerBorder.opacity;l.outerBorder.opacity=w,e.setStrokeStyle(t,u,(v-i)/_,(x-r)/S,l.outerBorder),l.outerBorder.opacity=o,e.stroke()}}if(f){const{distance:o=l.innerBorder.distance}=g,n=mh(e,o,e.dpr),s=o/R;if(t.setAttributes({outerRadius:R-n,innerRadius:A+n,startAngle:y+s,endAngle:C-s}),e.beginPath(),Hs(t,e,i,r,R-n,A+n),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),d)d(e,g,l.innerBorder);else if(M){const o=l.innerBorder.opacity;l.innerBorder.opacity=w,e.setStrokeStyle(t,g,(v-i)/_,(x-r)/S,l.innerBorder),l.innerBorder.opacity=o,e.stroke()}}t.setAttributes({outerRadius:R,innerRadius:A,startAngle:y,endAngle:C})}},Bh=Ah,Mh=xh;const Th=new class{constructor(){this.time=Ri.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,n,s,a,l,h,c,d){const{outerBorder:u,innerBorder:g}=t.attribute,p=u&&!1!==u.visible,f=g&&!1!==g.visible;if(!p&&!f)return;const{radius:m=l.radius,startAngle:b=l.startAngle,endAngle:y=l.endAngle,opacity:C=l.opacity,x:w=l.x,y:v=l.y,scaleX:x=l.scaleX,scaleY:_=l.scaleY}=t.attribute,S=!(!u||!u.stroke),A=!(!g||!g.stroke);if(p){const{distance:o=l.outerBorder.distance}=u,n=mh(e,o,e.dpr);if(e.beginPath(),e.arc(i,r,m+n,b,y),e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),d)d(e,u,l.outerBorder);else if(S){const o=l.outerBorder.opacity;l.outerBorder.opacity=C,e.setStrokeStyle(t,u,(w-i)/x,(v-r)/_,l.outerBorder),l.outerBorder.opacity=o,e.stroke()}}if(f){const{distance:o=l.innerBorder.distance}=g,n=mh(e,o,e.dpr);if(e.beginPath(),e.arc(i,r,m-n,b,y),e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),d)d(e,g,l.innerBorder);else if(A){const o=l.innerBorder.opacity;l.innerBorder.opacity=C,e.setStrokeStyle(t,g,(w-i)/x,(v-r)/_,l.innerBorder),l.innerBorder.opacity=o,e.stroke()}}}},Ph=Ah,Hh=xh;const Eh=new class extends vh{constructor(){super(...arguments),this.time=Ri.beforeFillStroke}drawShape(t,e,i,r,o,n,s,a,l,h,c,d){const{background:u,backgroundMode:g=l.backgroundMode,backgroundFit:p=l.backgroundFit}=t.attribute;if(u)if(t.backgroundImg&&t.resources){const i=t.resources.get(u);if("success"!==i.state||!i.data)return;e.highPerformanceSave(),e.setTransformFromMatrix(t.parent.globalTransMatrix,!0);const r=t.AABBBounds;this.doDrawImage(e,i.data,r,g,p),e.highPerformanceRestore(),e.setTransformForCurrent()}else e.highPerformanceSave(),e.fillStyle=u,e.fill(),e.highPerformanceRestore()}},kh=$t/2;function Lh(t,e,i,r,o,n){let s;if(r<0&&(e+=r,r=-r),o<0&&(i+=o,o=-o),ot(n,!0))s=[n=Zt(n),n,n,n];else if(Array.isArray(n)){const t=n;let e,i;switch(t.length){case 0:s=[0,0,0,0];break;case 1:e=Zt(t[0]),s=[e,e,e,e];break;case 2:case 3:e=Zt(t[0]),i=Zt(t[1]),s=[e,i,e,i];break;default:s=t,s[0]=Zt(s[0]),s[1]=Zt(s[1]),s[2]=Zt(s[2]),s[3]=Zt(s[3])}}else s=[0,0,0,0];if(r<0||s[0]+s[1]+s[2]+s[3]<1e-12)return t.rect(e,i,r,o);const[a,l,h,c]=[[e,i],[e+r,i],[e+r,i+o],[e,i+o]],d=Math.min(r/2,o/2),u=[Math.min(d,s[0]),Math.min(d,s[1]),Math.min(d,s[2]),Math.min(d,s[3])],g=[a[0]+u[0],a[1]],p=[a[0],a[1]+u[0]],f=[l[0]-u[1],l[1]],m=[l[0],l[1]+u[1]],b=[h[0]-u[2],h[1]],y=[h[0],h[1]-u[2]],C=[c[0]+u[3],c[1]],w=[c[0],c[1]-u[3]];if(t.moveTo(g[0],g[1]),t.lineTo(f[0],f[1]),!Tt(f,m)){const e=f[0],i=f[1]+u[1];t.arc(e,i,u[1],-kh,0,!1)}if(t.lineTo(y[0],y[1]),!Tt(b,y)){const e=y[0]-u[2],i=y[1];t.arc(e,i,u[2],0,kh,!1)}if(t.lineTo(C[0],C[1]),!Tt(C,w)){const e=C[0],i=C[1]-u[3];t.arc(e,i,u[3],kh,$t,!1)}if(t.lineTo(p[0],p[1]),!Tt(g,p)){const e=g[0],i=g[1]+u[0];t.arc(e,i,u[0],$t,$t+kh,!1)}return t.closePath(),t}const Fh=new class extends vh{constructor(){super(...arguments),this.time=Ri.beforeFillStroke}drawShape(t,e,i,r,o,n,s,a,l,h,c,d){const{background:u,backgroundMode:g=l.backgroundMode,backgroundFit:p=l.backgroundFit}=t.attribute;if(u)if(t.backgroundImg){const i=t.resources.get(u);if("success"!==i.state||!i.data)return;if(e.save(),t.parent&&!t.transMatrix.onlyTranslate()){const i=yo(t.parent).group,{scrollX:r=i.scrollX,scrollY:o=i.scrollY}=t.parent.attribute;e.setTransformFromMatrix(t.parent.globalTransMatrix,!0),e.translate(r,o)}const r=t.AABBBounds;this.doDrawImage(e,i.data,r,g,p),e.restore(),t.transMatrix.onlyTranslate()||e.setTransformForCurrent()}else if(q(u)){const{stroke:i,fill:r,lineWidth:o=1,cornerRadius:n=0,expandX:s=0,expandY:a=0}=u;if(!i&&!r)return;e.beginPath();const{x:l,y:h,width:c,height:d}=function(t){const e=Xo(t.attribute.boundsPadding),i=t.AABBBounds;let r=i.x1,o=i.y1,n=i.width(),s=i.height();return ot(e)?(r+=e,o+=e,n-=2*e,s-=2*e):(r+=e[3],o+=e[0],n-=e[1]+e[3],s-=e[0]+e[2]),{x:r,y:o,width:n,height:s}}(t);n?Lh(e,l-s,h-a,c+2*s,d+2*a,n):e.rect(l-s,h-a,c+2*s,d+2*a),e.globalAlpha=1,r&&(e.fillStyle=r,e.fill()),i&&o>0&&(e.lineWidth=o,e.strokeStyle=i,e.stroke())}else{e.beginPath();const o=t.AABBBounds;e.rect(i,r,o.width(),o.height()),e.fillStyle=u,e.globalAlpha=1,e.fill()}}};var Ih=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let zh=class{constructor(){this.time=Ri.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){const{stroke:g=l.stroke}=t.attribute;Array.isArray(g)&&g.some((t=>!1===t))&&(u.doStroke=!1)}};zh=Ih([f()],zh);let Oh=class{constructor(){this.time=Ri.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,n,s,a,l,h,c,d){const{width:u=l.width,height:g=l.height,stroke:p=l.stroke}=t.attribute;if(Array.isArray(p)&&p.some((t=>!1===t))){if(e.setStrokeStyle(t,t.attribute,i,r,l),e.beginPath(),e.moveTo(i,r),p[0]?e.lineTo(i+u,r):e.moveTo(i+u,r),p[1]?e.lineTo(i+u,r+g):e.moveTo(i+u,r+g),p[2]?e.lineTo(i,r+g):e.moveTo(i,r+g),p[3]){const t=p[0]?r-e.lineWidth/2:r;e.lineTo(i,t)}else e.moveTo(i,r);e.stroke()}}};Oh=Ih([f()],Oh);const Dh=new class{constructor(){this.time=Ri.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,n,s,a,l,h,c,d){const{outerBorder:u,innerBorder:g}=t.attribute,p=u&&!1!==u.visible,f=g&&!1!==g.visible;if(!p&&!f)return;const{cornerRadius:m=l.cornerRadius,opacity:b=l.opacity,x:y=l.x,y:C=l.y,scaleX:w=l.scaleX,scaleY:v=l.scaleY,x1:x,y1:_}=t.attribute;let{width:S,height:A}=t.attribute;S=(null!=S?S:x-i)||0,A=(null!=A?A:_-r)||0;const R=!(!u||!u.stroke),B=!(!g||!g.stroke);if(p){const{distance:o=l.outerBorder.distance}=u,n=mh(e,o,e.dpr),s=i-n,a=r-n,h=2*n;if(0===m||et(m)&&m.every((t=>0===t))?(e.beginPath(),e.rect(s,a,S+h,A+h)):(e.beginPath(),Lh(e,s,a,S+h,A+h,m)),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),d)d(e,u,l.outerBorder);else if(R){const o=l.outerBorder.opacity;l.outerBorder.opacity=b,e.setStrokeStyle(t,u,(y-i)/w,(C-r)/v,l.outerBorder),l.outerBorder.opacity=o,e.stroke()}}if(f){const{distance:o=l.innerBorder.distance}=g,n=mh(e,o,e.dpr),s=i+n,a=r+n,h=2*n;if(0===m||et(m)&&m.every((t=>0===t))?(e.beginPath(),e.rect(s,a,S-h,A-h)):(e.beginPath(),Lh(e,s,a,S-h,A-h,m)),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),d)d(e,g,l.innerBorder);else if(B){const o=l.innerBorder.opacity;l.innerBorder.opacity=b,e.setStrokeStyle(t,g,(y-i)/w,(C-r)/v,l.innerBorder),l.innerBorder.opacity=o,e.stroke()}}}},Wh=Ah,Nh=xh;const Gh=new class{constructor(){this.time=Ri.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,n,s,a,l,h,c,d){const u=t.getParsedPath();if(!u)return;const{outerBorder:g,innerBorder:p}=t.attribute,f=g&&!1!==g.visible,m=p&&!1!==p.visible;if(!f&&!m)return;const{size:b=l.size,opacity:y=l.opacity,x:C=l.x,y:w=l.y,scaleX:v=l.scaleX,scaleY:x=l.scaleY}=t.attribute,_=!(!g||!g.stroke),S=!(!p||!p.stroke);if(f){const{distance:o=l.outerBorder.distance}=g,n=mh(e,o,e.dpr);if(e.beginPath(),!1===u.drawOffset(e,b,i,r,n)&&e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),d)d(e,g,l.outerBorder);else if(_){const o=l.outerBorder.opacity;l.outerBorder.opacity=y,e.setStrokeStyle(t,g,(C-i)/v,(w-r)/x,l.outerBorder),l.outerBorder.opacity=o,e.stroke()}}if(m){const{distance:o=l.innerBorder.distance}=p,n=mh(e,o,e.dpr);if(e.beginPath(),!1===u.drawOffset(e,b,i,r,-n)&&e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),d)d(e,p,l.innerBorder);else if(S){const o=l.innerBorder.opacity;l.innerBorder.opacity=y,e.setStrokeStyle(t,p,(C-i)/v,(w-r)/x,l.innerBorder),l.innerBorder.opacity=o,e.stroke()}}}},jh=Ah,Vh=xh;var Uh=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Kh=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},$h=function(t,e){return function(i,r){e(i,r,t)}};let Xh=class extends gh{constructor(t){super(),this.arcRenderContribitions=t,this.numberType=Gn,this.builtinContributions=[Rh,Mh,Bh],this.init(t)}drawArcTailCapPath(t,e,i,r,o,n,s,a){const l=a-s,h=t.getParsedAngle(),c=h.startAngle;let d=h.endAngle;d=a;const u=Zt(d-c),g=d>c;let p=!1;if(o<n){const t=o;o=n,n=t}const f=t.getParsedCornerRadius(),{outerDeltaAngle:m,innerDeltaAngle:b,outerStartAngle:y,outerEndAngle:C,innerEndAngle:w,innerStartAngle:v}=t.getParsePadAngle(c,d),x=f,_=f,S=f,A=f,R=Math.max(_,x),B=Math.max(S,A);let M=R,T=B;const P=o*Qt(y),H=o*ie(y),E=n*Qt(w),k=n*ie(w);let L,F,I,z;if((B>Kt||R>Kt)&&(L=o*Qt(C),F=o*ie(C),I=n*Qt(v),z=n*ie(v),u<$t)){const t=Ts(P,H,I,z,L,F,E,k);if(t){const e=P-t[0],i=H-t[1],r=L-t[0],s=F-t[1],a=1/ie(ne((e*r+i*s)/(re(e*e+i*i)*re(r*r+s*s)))/2),l=re(t[0]*t[0]+t[1]*t[1]);T=ee(B,(n-l)/(a-1)),M=ee(R,(o-l)/(a+1))}}if(M>Kt){const t=ee(x,M),n=ee(_,M),s=Ps(I,z,P,H,o,t,Number(g)),a=Ps(L,F,E,k,o,n,Number(g));if(M<R&&t===n)e.moveTo(i+s.cx+s.x01,r+s.cy+s.y01),e.arc(i+s.cx,r+s.cy,M,Jt(s.y01,s.x01),Jt(a.y01,a.x01),!g);else{const t=d-l-.03,s=Jt(a.y11,a.x11);e.arc(i,r,o,t,s,!g),n>0&&e.arc(i+a.cx,r+a.cy,n,Jt(a.y11,a.x11),Jt(a.y01,a.x01),!g)}}else e.moveTo(i+P,r+H);if(!(n>Kt)||b<.001)e.lineTo(i+E,r+k),p=!0;else if(T>Kt){const t=ee(A,T),o=ee(S,T),s=Ps(E,k,L,F,n,-o,Number(g)),a=Ps(P,H,I,z,n,-t,Number(g));if(e.lineTo(i+s.cx+s.x01,r+s.cy+s.y01),T<B&&t===o){const t=Jt(a.y01,a.x01);e.arc(i+s.cx,r+s.cy,T,Jt(s.y01,s.x01),t,!g)}else{o>0&&e.arc(i+s.cx,r+s.cy,o,Jt(s.y01,s.x01),Jt(s.y11,s.x11),!g);const t=Jt(s.cy+s.y11,s.cx+s.x11),a=d-l-.03;e.arc(i,r,n,t,a,g)}}else e.lineTo(i+n*Qt(v),r+n*ie(v));return p}drawShape(t,e,i,r,o,n,s,a){const l=yo(t,null==n?void 0:n.theme).arc,{fill:h=l.fill,stroke:c=l.stroke,x:d=l.x,y:u=l.y}=t.attribute,g=this.valid(t,l,s,a);if(!g)return;const{fVisible:p,sVisible:f,doFill:m,doStroke:b}=g,{outerPadding:y=l.outerPadding,innerPadding:C=l.innerPadding,cap:w=l.cap,forceShowCap:v=l.forceShowCap}=t.attribute;let{outerRadius:x=l.outerRadius,innerRadius:_=l.innerRadius}=t.attribute;x+=y,_-=C;let S=0;const A=(K(w)&&w||w[0])&&"conical"===h.gradient;if(A){const{sc:e,startAngle:i,endAngle:r}=t.getParsedAngle();Zt(r-i)<qt-Kt&&(S=e||0,h.startAngle-=S,h.endAngle-=S)}let R=!1;const{isFullStroke:B,stroke:M}=(t=>{var e;let i=!0;if(K(t,!0)){for(let r=0;r<4;r++)Ko[r]=t,i&&(i=!(null!==(e=Ko[r])&&void 0!==e&&!e));i=t}else if(Array.isArray(t))for(let e=0;e<4;e++)Ko[e]=!!t[e],i&&(i=!!Ko[e]);else Ko[0]=!1,Ko[1]=!1,Ko[2]=!1,Ko[3]=!1;return{isFullStroke:i,stroke:Ko}})(c);if((m||B)&&(e.beginPath(),Hs(t,e,i,r,x,_),R=!0,e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),this.beforeRenderStep(t,e,i,r,m,b,p,f,l,o,s,a),m&&(s?s(e,t.attribute,l):p&&(e.setCommonStyle(t,t.attribute,d-i,u-r,l),e.fill())),b&&B&&(a?a(e,t.attribute,l):f&&(e.setStrokeStyle(t,t.attribute,d-i,u-r,l),e.stroke()))),!B&&b&&(e.beginPath(),Hs(t,e,i,r,x,_,M),R||this.beforeRenderStep(t,e,i,r,m,b,p,f,l,o,s,a),a?a(e,t.attribute,l):f&&(e.setStrokeStyle(t,t.attribute,i,r,l),e.stroke())),(K(w)&&w||w[1])&&v){const{startAngle:n,endAngle:h}=t.getParsedAngle();if(Zt(h-n)>=qt-Kt){e.beginPath();const n=Math.abs(x-_)/2/x,{endAngle:h=l.endAngle,fill:c=l.fill}=t.attribute,d=h;if(this.drawArcTailCapPath(t,e,i,r,x,_,d,d+n),R||this.beforeRenderStep(t,e,i,r,m,b,p,f,l,o,s,a),m){const o=c;if("conical"===o.gradient){const n=function(t,e,i,r){const{stops:o,startAngle:n,endAngle:s}=r;for(;i<0;)i+=qt;for(;i>qt;)i-=qt;if(i<n)return o[0].color;if(i>s)return o[0].color;let a,l,h=(i-n)/(s-n);for(let t=0;t<o.length;t++)if(o[t].offset>=h){a=o[t-1],l=o[t];break}return h=(h-a.offset)/(l.offset-a.offset),ln(a.color,l.color,h,!1)}(0,0,h,o);s||As&&(e.setCommonStyle(t,t.attribute,i,r,l),e.fillStyle=n,e.fill())}}b&&(a||f&&(e.setStrokeStyle(t,t.attribute,i,r,l),e.stroke()))}}this.afterRenderStep(t,e,i,r,m,b,p,f,l,o,s,a),A&&(h.startAngle+=S,h.endAngle+=S)}draw(t,e,i,r){const o=yo(t,null==r?void 0:r.theme).arc;this._draw(t,o,!1,i,r)}};Xh=Uh([f(),$h(0,g(H)),$h(0,m(Fs)),Kh("design:paramtypes",[Object])],Xh);var Yh=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},qh=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Zh=function(t,e){return function(i,r){e(i,r,t)}};let Jh=class extends gh{constructor(t){super(),this.circleRenderContribitions=t,this.numberType=Un,this.builtinContributions=[Th,Hh,Ph],this.init(t)}drawShape(t,e,i,r,o,n,s,a){const l=yo(t,null==n?void 0:n.theme).circle,{radius:h=l.radius,startAngle:c=l.startAngle,endAngle:d=l.endAngle,x:u=l.x,y:g=l.y}=t.attribute,p=this.valid(t,l,s,a);if(!p)return;const{fVisible:f,sVisible:m,doFill:b,doStroke:y}=p;e.beginPath(),e.arc(i,r,h,c,d),e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),this.beforeRenderStep(t,e,i,r,b,y,f,m,l,o,s,a),b&&(s?s(e,t.attribute,l):f&&(e.setCommonStyle(t,t.attribute,u-i,g-r,l),e.fill())),y&&(a?a(e,t.attribute,l):m&&(e.setStrokeStyle(t,t.attribute,u-i,g-r,l),e.stroke())),this.afterRenderStep(t,e,i,r,b,y,f,m,l,o,s,a)}draw(t,e,i,r){const o=yo(t,null==r?void 0:r.theme).circle;this._draw(t,o,!1,i,r)}};function Qh(t,e,i,r){if(!e.p1)return;const{offsetX:o=0,offsetY:n=0,offsetZ:s=0}=r||{};if(1===i)e.p2&&e.p3?t.bezierCurveTo(o+e.p1.x,n+e.p1.y,o+e.p2.x,n+e.p2.y,o+e.p3.x,n+e.p3.y,s):t.lineTo(o+e.p1.x,n+e.p1.y,s);else if(e.p2&&e.p3){const[r]=Fi(e,i);t.bezierCurveTo(o+r.p1.x,n+r.p1.y,o+r.p2.x,n+r.p2.y,o+r.p3.x,n+r.p3.y,s)}else{const r=e.getPointAt(i);t.lineTo(o+r.x,n+r.y,s)}}function tc(t,e,i,r,o){var n;const{offsetX:s=0,offsetY:a=0,offsetZ:l=0,mode:h="none",drawConnect:c=!1,zeroX:d=0,zeroY:u=0}=o||{};if(c&&"none"===h)return;if(!e)return;let g=!0;const{curves:p}=e;if(i>=1){if(c){let e,i=!0;p.forEach(((r,o)=>{var n;let h=r.p0;if(r.originP1!==r.originP2){if(e&&e.originP1===e.originP2&&(h=e.p0),r.defined)i||(t.lineTo(h.x+s,h.y+a,l),i=!i);else{const{originP1:e,originP2:o}=r;let c;if(e&&!1!==e.defined?c=h:e&&!1!==o.defined&&(c=null!==(n=r.p3)&&void 0!==n?n:r.p1),i){i=!i;const e=c?c.x:r.p0.x,o=c?c.y:r.p0.y;t.moveTo(e+s,o+a,l)}else c&&(i=!i,t.lineTo(c.x+s,c.y+a,l))}e=r}else e=r}))}else p.forEach((e=>{e.defined?(g&&t.moveTo(e.p0.x+s,e.p0.y+a,l),Qh(t,e,1,o),g=!1):g=!0}));return}if(i<=0)return;let f;"x"===r?f=Si.ROW:"y"===r?f=Si.COLUMN:"auto"===r&&(f=e.direction);const m=i*e.tryUpdateLength(f);let b=0,y=!0,C=null;for(let e=0,i=p.length;e<i;e++){const i=p[e],r=i.getLength(f),h=(m-b)/r;if(b+=r,h<0)break;if(c){let e=i.p0;if(i.originP1===i.originP2){C=i;continue}if(C&&C.originP1===C.originP2&&(e=C.p0),i.defined)y||(t.lineTo(e.x+s,e.y+a,l),y=!y);else{const{originP1:r,originP2:o}=i;let h;if(r&&!1!==r.defined?h=e:r&&!1!==o.defined&&(h=null!==(n=i.p3)&&void 0!==n?n:i.p1),y){y=!y;const e=h?h.x:i.p0.x,r=h?h.y:i.p0.y;t.moveTo(e+s,r+a,l)}else h&&(y=!y,t.lineTo(h.x+s,h.y+a,l))}C=i}else{if(!i.defined){g=!0;continue}g&&t.moveTo(i.p0.x+s,i.p0.y+a,l),Qh(t,i,ee(h,1),o),g=!1}}}Jh=Yh([f(),Zh(0,g(H)),Zh(0,m(zs)),qh("design:paramtypes",[Object])],Jh);var ec=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let ic=class extends gh{constructor(){super(...arguments),this.numberType=Yn}draw(t,e,i,r){const o=yo(t,null==r?void 0:r.theme).line;this._draw(t,o,!1,i,r)}drawSegmentItem(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p){var f,m,b,y,C;if(!e)return;t.beginPath();const w=null!==(f=this.z)&&void 0!==f?f:0;tc(t.camera?t:t.nativeContext,e,l,h,{offsetX:c,offsetY:d,offsetZ:w}),u.cache&&!et(u.cache)&&u.cache.curves.every((t=>t.defined))&&u.attribute.curveType&&u.attribute.curveType.includes("Closed")&&t.closePath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(u,s,a);const{x:v=0,x:x=0}=s;!1!==i&&(g?g(t,s,a):o&&(t.setCommonStyle(u,s,v-c,x-d,a),t.fill())),!1!==r&&(p?p(t,s,a):n&&(t.setStrokeStyle(u,s,v-c,x-d,a),t.stroke()));let{connectedType:_,connectedX:S,connectedY:A,connectedStyle:R}=s;if(et(a)?(_=null!==(m=null!=_?_:a[0].connectedType)&&void 0!==m?m:a[1].connectedType,S=null!==(b=null!=S?S:a[0].connectedX)&&void 0!==b?b:a[1].connectedX,A=null!==(y=null!=A?A:a[0].connectedY)&&void 0!==y?y:a[1].connectedY,R=null!==(C=null!=R?R:a[0].connectedStyle)&&void 0!==C?C:a[1].connectedStyle):(_=null!=_?_:a.connectedType,S=null!=S?S:a.connectedX,A=null!=A?A:a.connectedY,R=null!=R?R:a.connectedStyle),"connect"!==_&&"zero"!==_&&(_="none"),"none"!==_){t.beginPath(),tc(t.camera?t:t.nativeContext,e,l,h,{offsetX:c,offsetY:d,offsetZ:w,drawConnect:!0,mode:_,zeroX:S,zeroY:A});const f=[];et(a)?a.forEach((t=>f.push(t))):f.push(a),f.push(s),!1!==i&&(g?g(t,s,a):o&&(t.setCommonStyle(u,R,v-c,x-d,f),t.fill())),!1!==r&&(p?p(t,s,a):n&&(t.setStrokeStyle(u,R,v-c,x-d,f),t.stroke()))}return!1}drawLinearLineHighPerformance(t,e,i,r,o,n,s,a,l,h,c,d,u){var g;e.beginPath();const p=null!==(g=this.z)&&void 0!==g?g:0,{points:f}=t.attribute,m=f[0];e.moveTo(m.x+s,m.y+a,p);for(let t=1;t<f.length;t++){const i=f[t];e.lineTo(i.x+s,i.y+a,p)}e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l);const{x:b=0,x:y=0}=t.attribute;!1!==i&&(d?d(e,t.attribute,l):o&&(e.setCommonStyle(t,t.attribute,b-s,y-a,l),e.fill())),!1!==r&&(u?u(e,t.attribute,l):n&&(e.setStrokeStyle(t,t.attribute,b-s,y-a,l),e.stroke()))}drawShape(t,e,i,r,o,n,s,a){const l=yo(t,null==n?void 0:n.theme).line,{fill:h=l.fill,stroke:c=l.stroke,fillOpacity:d=l.fillOpacity,strokeOpacity:u=l.strokeOpacity,segments:g,points:p,closePath:f}=t.attribute;if(!this.valid(t,l,s,a))return;let{curveType:m=l.curveType}=t.attribute;f&&"linear"===m&&(m="linearClosed");const{clipRange:b=l.clipRange,clipRangeByDimension:y=l.clipRangeByDimension}=t.attribute;if(1===b&&!g&&!p.some((t=>!1===t.defined))&&"linear"===m)return this.drawLinearLineHighPerformance(t,e,!!h,!!c,d,u,i,r,l,o,n,s,a);if(t.shouldUpdateShape()){const{points:e,segments:i}=t.attribute,r=e;if(i&&i.length){let e,r;if(t.cache=i.map(((t,i)=>{if(t.points.length<=1&&0===i)return t.points[0]&&(r={endX:t.points[0].x,endY:t.points[0].y,curves:[{defined:!1!==t.points[0].defined}]}),null;1===i?e={x:r.endX,y:r.endY,defined:r.curves[r.curves.length-1].defined}:i>1&&(e.x=r.endX,e.y=r.endY,e.defined=r.curves[r.curves.length-1].defined);const o=sr(t.points,m,{startPoint:e});return r=o,o})).filter((t=>!!t)),"linearClosed"===m){let e;for(let i=0;i<t.cache.length;i++){const r=t.cache[i];for(let t=0;t<r.curves.length;t++)if(r.curves[t].defined){e=r.curves[t].p0;break}if(e)break}t.cache[t.cache.length-1]&&t.cache[t.cache.length-1].lineTo(e.x,e.y,!0)}}else{if(!e||!e.length)return t.cache=null,void t.clearUpdateShapeTag();t.cache=sr(r,m)}t.clearUpdateShapeTag()}if(Array.isArray(t.cache)){const o=t.attribute.segments.filter((t=>t.points.length));if(1===o[0].points.length&&o.shift(),1===b){let n=!1;t.cache.forEach(((g,p)=>{n||(n=this.drawSegmentItem(e,g,!!h,!!c,d,u,o[p],[l,t.attribute],b,y,i,r,t,s,a))}))}else{const n=t.cache.reduce(((t,e)=>t+e.getLength()),0),g=b*n;let p=0,f=!1;t.cache.forEach(((n,m)=>{if(f)return;const b=n.getLength(),C=(g-p)/b;p+=b,C>0&&(f=this.drawSegmentItem(e,n,!!h,!!c,d,u,o[m],[l,t.attribute],ee(C,1),y,i,r,t,s,a))}))}}else this.drawSegmentItem(e,t.cache,!!h,!!c,d,u,t.attribute,l,b,y,i,r,t,s,a)}};function rc(t,e,i,r){if(e.length<2)return;const{offsetX:o=0,offsetY:n=0,offsetZ:s=0,mode:a}=r||{};let l=e[0];t.moveTo(l.p0.x+o,l.p0.y+n,s),l=e[e.length-1];let h=l.p3||l.p1;t.lineTo(h.x+o,h.y+n,s),l=i[i.length-1],t.lineTo(l.p0.x+o,l.p0.y+n,s),l=i[0],h=l.p3||l.p1,t.lineTo(h.x+o,h.y+n,s),t.closePath()}function oc(t,e,i,r){const{offsetX:o=0,offsetY:n=0,offsetZ:s=0}=r||{};let a=!0;e.forEach((e=>{e.defined?(a&&t.moveTo(e.p0.x+o,e.p0.y+n,s),Qh(t,e,1,r),a=!1):a=!0})),a=!0;for(let e=i.length-1;e>=0;e--){const l=i[e];l.defined?(a&&t.lineTo(l.p0.x+o,l.p0.y+n,s),Qh(t,l,1,r),a=!1):a=!0}t.closePath()}ic=ec([f()],ic);const nc=new class extends Sh{constructor(){super(...arguments),this.time=Ri.afterFillStroke}drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){var g,p,f,m;this.textureMap||this.initTextureMap(e,t.stage);const{attribute:b=t.attribute}=u||{},{texture:y=(null!==(g=t.attribute.texture)&&void 0!==g?g:tn(l,"texture")),textureColor:C=(null!==(p=t.attribute.textureColor)&&void 0!==p?p:tn(l,"textureColor")),textureSize:w=(null!==(f=t.attribute.textureSize)&&void 0!==f?f:tn(l,"textureSize")),texturePadding:v=(null!==(m=t.attribute.texturePadding)&&void 0!==m?m:tn(l,"texturePadding"))}=b;y&&this.drawTexture(y,t,e,i,r,l,C,w,v)}},sc=xh;var ac=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},lc=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},hc=function(t,e){return function(i,r){e(i,r,t)}};function cc(t,e,i){switch(e){case"linear":default:return Vi(t,i);case"basis":return $i(t,i);case"monotoneX":return tr(t,i);case"monotoneY":return er(t,i);case"step":return rr(t,.5,i);case"stepBefore":return rr(t,0,i);case"stepAfter":return rr(t,1,i);case"linearClosed":return nr(t,i)}}let dc=class extends gh{constructor(t){super(),this.areaRenderContribitions=t,this.numberType=Vn,this.builtinContributions=[nc,sc],this.init(t)}drawLinearAreaHighPerformance(t,e,i,r,o,n,s,a,l,h,c,d,u){var g,p,f,m,b;const{points:y}=t.attribute;if(y.length<2)return;e.beginPath();const C=null!==(g=this.z)&&void 0!==g?g:0,w=y[0];e.moveTo(w.x+s,w.y+a,C);for(let t=1;t<y.length;t++){const i=y[t];e.lineTo(i.x+s,i.y+a,C)}for(let t=y.length-1;t>=0;t--){const i=y[t];e.lineTo((null!==(p=i.x1)&&void 0!==p?p:i.x)+s,(null!==(f=i.y1)&&void 0!==f?f:i.y)+a,C)}e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),this.beforeRenderStep(t,e,s,a,!!o,!1,i,!1,l,h,d,null,{attribute:t.attribute});const{x:v=0,x:x=0}=t.attribute;if(!1!==i&&(d?d(e,t.attribute,l):o&&(e.setCommonStyle(t,t.attribute,v-s,x-a,l),e.fill())),this.afterRenderStep(t,e,s,a,!!o,!1,i,!1,l,h,d,null,{attribute:t.attribute}),r){const{stroke:i=l&&l.stroke}=t.attribute;if(et(i)&&(i[0]||i[2])&&!1===i[1])if(e.beginPath(),i[0]){e.moveTo(w.x+s,w.y+a,C);for(let t=1;t<y.length;t++){const i=y[t];e.lineTo(i.x+s,i.y+a,C)}}else if(i[2]){const t=y[y.length-1];e.moveTo(t.x+s,t.y+a,C);for(let t=y.length-2;t>=0;t--){const i=y[t];e.lineTo((null!==(m=i.x1)&&void 0!==m?m:i.x)+s,(null!==(b=i.y1)&&void 0!==b?b:i.y)+a,C)}}u?u(e,t.attribute,l):(e.setStrokeStyle(t,t.attribute,v-s,x-a,l),e.stroke())}}drawShape(t,e,i,r,o,n,s,a){var l,h,c,d,u,g;const p=yo(t,null==n?void 0:n.theme).area,{fill:f=p.fill,stroke:m=p.stroke,fillOpacity:b=p.fillOpacity,z:y=p.z,strokeOpacity:C=p.strokeOpacity}=t.attribute,w=this.valid(t,p,s,a);if(!w)return;const{doFill:v,doStroke:x}=w,{clipRange:_=p.clipRange,closePath:S,points:A,segments:R}=t.attribute;let{curveType:B=p.curveType}=t.attribute;if(S&&"linear"===B&&(B="linearClosed"),1===_&&!R&&!A.some((t=>!1===t.defined))&&"linear"===B)return this.drawLinearAreaHighPerformance(t,e,!!f,x,b,C,i,r,p,o,n,s,a);if(t.shouldUpdateShape()){if(R&&R.length){let e,i;const r=R.map(((t,r)=>{if(t.points.length<=1&&0===r)return t.points[0]&&(i={endX:t.points[0].x,endY:t.points[0].y}),null;1===r?e={x:i.endX,y:i.endY}:r>1&&(e.x=i.endX,e.y=i.endY);const o=cc(t.points,B,{startPoint:e});return i=o,o})).filter((t=>!!t));let o;const n=[];for(let t=R.length-1;t>=0;t--){const e=R[t].points,i=[];for(let t=e.length-1;t>=0;t--)i.push({x:null!==(l=e[t].x1)&&void 0!==l?l:e[t].x,y:null!==(h=e[t].y1)&&void 0!==h?h:e[t].y});if(0!==t){const e=R[t-1].points,r=e[e.length-1];r&&i.push({x:null!==(c=r.x1)&&void 0!==c?c:r.x,y:null!==(d=r.y1)&&void 0!==d?d:r.y})}i.length>1&&(o=cc(i,"stepBefore"===B?"stepAfter":"stepAfter"===B?"stepBefore":B),n.unshift(o))}t.cacheArea=n.map(((t,e)=>({top:r[e],bottom:t})))}else{if(!A||!A.length)return t.cacheArea=null,void t.clearUpdateShapeTag();{const e=A,i=[];for(let t=A.length-1;t>=0;t--)i.push({x:null!==(u=A[t].x1)&&void 0!==u?u:A[t].x,y:null!==(g=A[t].y1)&&void 0!==g?g:A[t].y});const r=cc(e,B),o=cc(i,"stepBefore"===B?"stepAfter":"stepAfter"===B?"stepBefore":B);t.cacheArea={top:r,bottom:o}}}t.clearUpdateShapeTag()}if(Array.isArray(t.cacheArea)){const n=t.attribute.segments.filter((t=>t.points.length));if(1===n[0].points.length&&n.shift(),1===_){let l=!1;t.cacheArea.forEach(((h,c)=>{l||(l=this.drawSegmentItem(e,h,v,b,x,C,n[c],[p,t.attribute],_,i,r,y,t,o,s,a))}))}else{const l=t.cacheArea.reduce(((t,e)=>t+e.top.getLength()),0),h=_*l;let c=0,d=!1;t.cacheArea.forEach(((l,u)=>{if(d)return;const g=l.top.getLength(),f=(h-c)/g;c+=g,f>0&&(d=this.drawSegmentItem(e,l,v,b,x,C,n[u],[p,t.attribute],ee(f,1),i,r,y,t,o,s,a))}))}}else this.drawSegmentItem(e,t.cacheArea,v,b,x,C,t.attribute,p,_,i,r,y,t,o,s,a)}draw(t,e,i,r){const o=yo(t,null==r?void 0:r.theme).area;this._draw(t,o,!1,i,r)}drawSegmentItem(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p,f){let m=!1;return m=m||this._drawSegmentItem(t,e,i,r,o,n,s,a,l,h,c,d,u,g,!1,p,f),m=m||this._drawSegmentItem(t,e,i,r,o,n,s,a,l,h,c,d,u,g,!0,p,f),m}_drawSegmentItem(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p,f,m){var b,y,C,w;if(!(e&&e.top&&e.bottom&&e.top.curves&&e.top.curves.length&&e.bottom.curves&&e.bottom.curves.length))return;let{connectedType:v,connectedX:x,connectedY:_,connectedStyle:S}=s;const A=[];if(p&&(et(a)?(v=null!==(b=null!=v?v:a[0].connectedType)&&void 0!==b?b:a[1].connectedType,x=null!==(y=null!=x?x:a[0].connectedX)&&void 0!==y?y:a[1].connectedX,_=null!==(C=null!=_?_:a[0].connectedY)&&void 0!==C?C:a[1].connectedY,S=null!==(w=null!=S?S:a[0].connectedStyle)&&void 0!==w?w:a[1].connectedStyle):(v=null!=v?v:a.connectedType,x=null!=x?x:a.connectedX,_=null!=_?_:a.connectedY,S=null!=S?S:a.connectedStyle),"connect"!==v&&"zero"!==v&&(v="none"),et(a)?a.forEach((t=>A.push(t))):A.push(a),A.push(s)),p&&"none"===v)return!1;t.beginPath();const{points:R,segments:B}=u.attribute;let M,T,P=Si.ROW;if(B){const t=B[B.length-1];T=B[0].points[0],M=t.points[t.points.length-1]}else T=R[0],M=R[R.length-1];const H=Zt(M.x-T.x),E=Zt(M.y-T.y);P=Number.isFinite(H+E)?H>E?Si.ROW:Si.COLUMN:Si.ROW,function(t,e,i,r){var o;const{drawConnect:n=!1,mode:s="none"}=r||{};if(n&&"none"===s)return;const{top:a,bottom:l}=e;if(a.curves.length!==l.curves.length)return;if(i>=1){const e=[],i=[];let o=!0;if(n){let o,n,s=!0;const h=a.curves.length;a.curves.forEach(((a,c)=>{const d=l.curves[h-c-1];let u=a,g=d;if(a.originP1===a.originP2)return o=a,void(n=d);if(o&&o.originP1===o.originP2&&(u=o,g=n),a.defined)s||(e.push(u),i.push(g),rc(t,e,i,r),e.length=0,i.length=0,s=!s);else{const{originP1:o,originP2:n}=a;let l,h;o&&!1!==o.defined?(l=u,h=g):o&&!1!==n.defined&&(l=a,h=d),s?(s=!s,e.push(l||a),i.push(h||d)):l&&(s=!s,e.push(l||a),i.push(h||d),rc(t,e,i,r),e.length=0,i.length=0)}o=a})),rc(t,e,i,r)}else{for(let n=0,s=a.curves.length;n<s;n++){const h=a.curves[n];o!==h.defined?(o?(oc(t,e,i,r),e.length=0,i.length=0):(e.push(h),i.push(l.curves[s-n-1])),o=!o):o&&(e.push(h),i.push(l.curves[s-n-1]))}oc(t,e,i,r)}return}if(i<=0)return;let{direction:h}=r||{};const{curves:c}=a,d=null!==(o=c[c.length-1].p3)&&void 0!==o?o:c[c.length-1].p1,u=Zt(d.x-c[0].p0.x),g=Zt(d.y-c[0].p0.y);h=null!=h?h:u>g?Si.ROW:Si.COLUMN,Number.isFinite(u)||(h=Si.COLUMN),Number.isFinite(g)||(h=Si.ROW);const p=i*(h===Si.ROW?u:g);let f=0,m=!0;const b=[],y=[];let C,w,v=!0;for(let e=0,i=a.curves.length;e<i;e++){const o=a.curves[e],s=o.getLength(h),c=(p-f)/s;if(c<0)break;if(f+=s,n){const n=l.curves[i-e-1];let s=o,a=n;if(o.originP1===o.originP2){C=o,w=n;continue}if(C&&C.originP1===C.originP2&&(s=C,a=w),o.defined)v||(b.push(s),y.push(a),rc(t,b,y,r),b.length=0,y.length=0,v=!v);else{const{originP1:e,originP2:i}=o;let l,h;e&&!1!==e.defined?(l=s,h=a):e&&!1!==i.defined&&(l=o,h=n),v?(v=!v,b.push(l||o),y.push(h||n)):l&&(v=!v,b.push(l||o),y.push(h||n),rc(t,b,y,r),b.length=0,y.length=0)}C=o}else{let n=null,s=null;m!==o.defined?(m?(oc(t,b,y,r),b.length=0,y.length=0):(n=o,s=l.curves[i-e-1]),m=!m):m&&(n=o,s=l.curves[i-e-1]),n&&s&&(c<1&&(n=n.p2&&n.p3?Fi(n,c)[0]:zi(n,c)[0],s=s.p2&&s.p3?Fi(s,1-c)[1]:zi(s,1-c)[1]),n.defined=m,s.defined=m,b.push(n),y.push(s)),n=null,s=null}}n?rc(t,b,y,r):oc(t,b,y,r)}(t.camera?t:t.nativeContext,e,l,{offsetX:h,offsetY:c,offsetZ:d,direction:P,drawConnect:p,mode:v,zeroX:x,zeroY:_}),this.beforeRenderStep(u,t,h,c,!!r,!1,i,!1,a,g,f,null,{attribute:s}),t.setShadowBlendStyle&&t.setShadowBlendStyle(u,s,a);const{x:k=0,x:L=0}=s;if(!1!==i&&(f?f(t,s,a):r&&(t.setCommonStyle(u,p?S:s,k-h,L-c,p?A:a),t.fill())),this.afterRenderStep(u,t,h,c,!!r,!1,i,!1,a,g,f,null,{attribute:s}),!1!==o)if(m)m(t,s,a);else{const{stroke:i=a&&a[1]&&a[1].stroke}=s;et(i)&&(i[0]||i[2])&&!1===i[1]&&(t.beginPath(),tc(t.camera?t:t.nativeContext,i[0]?e.top:e.bottom,l,P===Si.ROW?"x":"y",{offsetX:h,offsetY:c,offsetZ:d,drawConnect:p,mode:v,zeroX:x,zeroY:_})),t.setStrokeStyle(u,p?S:s,k-h,L-c,p?A:a),t.stroke()}return!1}};dc=ac([f(),hc(0,g(H)),hc(0,m(Is)),lc("design:paramtypes",[Object])],dc);const uc=Ah,gc=xh;var pc=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},fc=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},mc=function(t,e){return function(i,r){e(i,r,t)}};let bc=class extends gh{constructor(t){super(),this.pathRenderContribitions=t,this.numberType=qn,this.builtinContributions=[gc,uc],this.init(t)}drawShape(t,e,i,r,o,n,s,a){var l,h,c;const d=null!==(l=this.tempTheme)&&void 0!==l?l:yo(t,null==n?void 0:n.theme).path,{x:u=d.x,y:g=d.y}=t.attribute,p=null!==(h=this.z)&&void 0!==h?h:0,f=this.valid(t,d,s,a);if(!f)return;const{fVisible:m,sVisible:b,doFill:y,doStroke:C}=f;if(e.beginPath(),t.pathShape)Pi(t.pathShape.commandList,e,i,r,1,1,p);else{Pi((null!==(c=t.attribute.path)&&void 0!==c?c:d.path).commandList,e,i,r,1,1,p)}e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,d),this.beforeRenderStep(t,e,i,r,y,C,m,b,d,o,s,a),C&&(a?a(e,t.attribute,d):b&&(e.setStrokeStyle(t,t.attribute,u-i,g-r,d),e.stroke())),y&&(s?s(e,t.attribute,d):m&&(e.setCommonStyle(t,t.attribute,u-i,g-r,d),e.fill())),this.afterRenderStep(t,e,i,r,y,C,m,b,d,o,s,a)}draw(t,e,i,r){const o=yo(t,null==r?void 0:r.theme).path;this.tempTheme=o,this._draw(t,o,!1,i,r),this.tempTheme=null}};bc=pc([f(),mc(0,g(H)),mc(0,m(Ws)),fc("design:paramtypes",[Object])],bc);var yc=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Cc=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},wc=function(t,e){return function(i,r){e(i,r,t)}};let vc=class extends gh{constructor(t){super(),this.rectRenderContribitions=t,this.type="rect",this.numberType=Qn,this.builtinContributions=[Dh,Nh,Wh],this.init(t)}drawShape(t,e,i,r,o,n,s,a){var l;const h=null!==(l=this.tempTheme)&&void 0!==l?l:yo(t,null==n?void 0:n.theme).rect,{fill:c=h.fill,background:d,stroke:u=h.stroke,cornerRadius:g=h.cornerRadius,opacity:p=h.opacity,fillOpacity:f=h.fillOpacity,lineWidth:m=h.lineWidth,strokeOpacity:b=h.strokeOpacity,visible:y=h.visible,x1:C,y1:w,x:v=h.x,y:x=h.y}=t.attribute;let{width:_,height:S}=t.attribute;_=(null!=_?_:C-v)||0,S=(null!=S?S:w-x)||0;const A=Rs(p,f,_,S,c),R=Ms(p,b,_,S),B=_s(c,d),M=Ss(u,m);if(!t.valid||!y)return;if(!B&&!M)return;if(!(A||R||s||a||d))return;0===g||et(g)&&g.every((t=>0===t))?(e.beginPath(),e.rect(i,r,_,S)):(e.beginPath(),Lh(e,i,r,_,S,g));const T={doFill:B,doStroke:M};e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),this.beforeRenderStep(t,e,i,r,B,M,A,R,h,o,s,a,T),T.doFill&&(s?s(e,t.attribute,h):A&&(e.setCommonStyle(t,t.attribute,v-i,x-r,h),e.fill())),T.doStroke&&(a?a(e,t.attribute,h):R&&(e.setStrokeStyle(t,t.attribute,v-i,x-r,h),e.stroke())),this.afterRenderStep(t,e,i,r,B,M,A,R,h,o,s,a)}draw(t,e,i,r){const o=yo(t,null==r?void 0:r.theme).rect;this.tempTheme=o,this._draw(t,o,!1,i,r),this.tempTheme=null}};vc=yc([f(),wc(0,g(H)),wc(0,m(Gs)),Cc("design:paramtypes",[Object])],vc);var xc=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},_c=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Sc=function(t,e){return function(i,r){e(i,r,t)}};let Ac=class extends gh{constructor(t){super(),this.symbolRenderContribitions=t,this.numberType=is,this.builtinContributions=[Gh,Vh,jh],this.init(t)}drawShape(t,e,i,r,o,n,s,a){var l;const h=yo(t,null==n?void 0:n.theme).symbol,{size:c=h.size,x:d=h.x,y:u=h.y,scaleX:g=h.scaleX,scaleY:p=h.scaleY}=t.attribute,f=this.valid(t,h,s,a);if(!f)return;const{fVisible:m,sVisible:b,doFill:y,doStroke:C}=f,w=t.getParsedPath();if(!w)return;const{keepDirIn3d:v=h.keepDirIn3d}=t.attribute,x=null!==(l=this.z)&&void 0!==l?l:0;if(e.beginPath(),v&&e.camera&&e.project){const o=e.project(i,r,x),n=e.camera;e.camera=null,!1===w.draw(e,et(c)?[c[0]*g,c[1]*p]:c*g,o.x,o.y,void 0,((o,n)=>{var l,c,f;if(t._parsedPath.svgCache){const e=Object.assign({},n);e.fill=null!==(l=n.fill)&&void 0!==l?l:t.attribute.fill,e.opacity=null!==(c=n.fill)&&void 0!==c?c:t.attribute.opacity,e.fillOpacity=t.attribute.fillOpacity,e.stroke=null!==(f=n.stroke)&&void 0!==f?f:t.attribute.stroke,n=e}n.fill&&(s?s(e,t.attribute,h):(e.setCommonStyle(t,n,d-i,u-r,h),e.fill())),n.stroke&&(a?a(e,t.attribute,h):(e.setStrokeStyle(t,n,(d-i)/g,(u-r)/p,h),e.stroke()))}))&&e.closePath(),e.camera=n}else!1===w.draw(e,c,i,r,x,((o,n)=>{var l,c,f;if(t._parsedPath.svgCache){const e=Object.assign({},n);e.fill=null!==(l=n.fill)&&void 0!==l?l:t.attribute.fill,e.opacity=null!==(c=n.opacity)&&void 0!==c?c:t.attribute.opacity,e.fillOpacity=t.attribute.fillOpacity,e.stroke=null!==(f=n.stroke)&&void 0!==f?f:t.attribute.stroke,n=e}n.fill&&(s?s(e,t.attribute,h):(e.setCommonStyle(t,n,d-i,u-r,h),e.fill())),n.stroke&&(a?a(e,t.attribute,h):(e.setStrokeStyle(t,n,(d-i)/g,(u-r)/p,h),e.stroke()))}))&&e.closePath();e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),this.beforeRenderStep(t,e,i,r,y,C,m,b,h,o,s,a),y&&!w.isSvg&&(s?s(e,t.attribute,h):m&&(e.setCommonStyle(t,t.attribute,d-i,u-r,h),e.fill())),C&&!w.isSvg&&(a?a(e,t.attribute,h):b&&(e.setStrokeStyle(t,t.attribute,(d-i)/g,(u-r)/p,h),e.stroke())),this.afterRenderStep(t,e,i,r,y,C,m,b,h,o,s,a)}draw(t,e,i,r){const o=yo(t,null==r?void 0:r.theme).symbol;this._draw(t,o,!1,i,r)}};Ac=xc([f(),Sc(0,g(H)),Sc(0,m(js)),_c("design:paramtypes",[Object])],Ac);const Rc=new class{constructor(){this.pools=[];for(let t=0;t<10;t++)this.pools.push(new ue)}allocate(t,e,i,r){if(!this.pools.length)return(new ue).setValue(t,e,i,r);const o=this.pools.pop();return o.x1=t,o.y1=e,o.x2=i,o.y2=r,o}allocateByObj(t){if(!this.pools.length)return new ue(t);const e=this.pools.pop();return e.x1=t.x1,e.y1=t.y1,e.x2=t.x2,e.y2=t.y2,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(){this.pools=[]}};const Bc=new class extends vh{constructor(){super(...arguments),this.time=Ri.beforeFillStroke}drawShape(t,e,i,r,o,n,s,a,l,h,c,d){var u,g,p,f,m,b,y,C,w,v;const{backgroundMode:x=l.backgroundMode,backgroundFit:_=l.backgroundFit}=t.attribute;let S,{background:A}=t.attribute;if(!A)return;const R=()=>{"richtext"===t.type&&(e.restore(),e.save(),S&&e.setTransformFromMatrix(S,!0,1))};let B;"richtext"===t.type&&(S=e.currentMatrix.clone(),e.restore(),e.save(),e.setTransformForCurrent());const M=q(A)&&A.background,T=t.transMatrix.onlyTranslate();if(M){const e=t.AABBBounds,i=(null!==(u=A.x)&&void 0!==u?u:e.x1)+(null!==(g=A.dx)&&void 0!==g?g:0),r=(null!==(p=A.y)&&void 0!==p?p:e.y1)+(null!==(f=A.dy)&&void 0!==f?f:0),o=null!==(m=A.width)&&void 0!==m?m:e.width(),n=null!==(b=A.height)&&void 0!==b?b:e.height();if(B=Rc.allocate(i,r,i+o,r+n),A=A.background,!T){const t=B.width(),e=B.height();B.set((null!==(y=A.x)&&void 0!==y?y:0)+(null!==(C=A.dx)&&void 0!==C?C:0),(null!==(w=A.y)&&void 0!==w?w:0)+(null!==(v=A.dy)&&void 0!==v?v:0),t,e)}}else B=t.AABBBounds,T||(B=dh(Object.assign(Object.assign({},t.attribute),{angle:0,scaleX:1,scaleY:1,x:0,y:0,dx:0,dy:0})).clone());if(t.backgroundImg&&t.resources){const o=t.resources.get(A);if("success"!==o.state||!o.data)return void R();e.highPerformanceSave(),T&&e.setTransformFromMatrix(t.parent.globalTransMatrix,!0),e.setCommonStyle(t,t.attribute,i,r,l),this.doDrawImage(e,o.data,B,x,_),e.highPerformanceRestore(),e.setTransformForCurrent()}else{const{backgroundCornerRadius:o}=t.attribute;e.highPerformanceSave(),e.setCommonStyle(t,t.attribute,i,r,l),e.fillStyle=A,o?(Lh(e,B.x1,B.y1,B.width(),B.height(),o),e.fill()):e.fillRect(B.x1,B.y1,B.width(),B.height()),e.highPerformanceRestore()}M&&Rc.free(B),R()}};var Mc=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Tc=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Pc=function(t,e){return function(i,r){e(i,r,t)}};let Hc=class extends gh{constructor(t){super(),this.textRenderContribitions=t,this.numberType=rs,this.builtinContributions=[Bc],this.init(t)}drawShape(t,e,i,r,o,n,s,a){var l,h,c;const d=yo(t,null==n?void 0:n.theme).text,{text:u,underline:g=d.underline,lineThrough:p=d.lineThrough,keepDirIn3d:f=d.keepDirIn3d,direction:m=d.direction,whiteSpace:b=d.whiteSpace,fontSize:y=d.fontSize,verticalMode:C=d.verticalMode,x:w=d.x,y:v=d.y}=t.attribute;let{textAlign:x=d.textAlign,textBaseline:_=d.textBaseline}=t.attribute;if(!C&&"vertical"===m){const e=x;x=null!==(l=t.getBaselineMapAlign()[_])&&void 0!==l?l:"left",_=null!==(h=t.getAlignMapBaseline()[e])&&void 0!==h?h:"top"}const S=null!==(c=on(t.attribute.lineHeight,y))&&void 0!==c?c:y,A=this.valid(t,d,s,a);if(!A)return;const{fVisible:R,sVisible:B,doFill:M,doStroke:T}=A,P=!f,H=this.z||0;e.beginPath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,d),this.beforeRenderStep(t,e,i,r,M,T,R,B,d,o,s,a),P&&this.transformUseContext2d(t,d,H,e);const E=(o,n,l,h)=>{let c=i+n;const u=r+l;if(h){e.highPerformanceSave(),c+=y;const t=Ql.allocate(1,0,0,1,0,0);t.rotateByCenter(Math.PI/2,c,u),e.transformFromMatrix(t,!0),Ql.free(t)}T&&(a?a(e,t.attribute,d):B&&(e.setStrokeStyle(t,t.attribute,w-i,v-r,d),e.strokeText(o,c,u,H))),M&&(s?s(e,t.attribute,d):R&&(e.setCommonStyle(t,t.attribute,w-i,v-r,d),e.fillText(o,c,u,H),this.drawUnderLine(g,p,t,c,u,H,d,e))),h&&(e.highPerformanceRestore(),e.setTransformForCurrent())};if(t.isMultiLine)if(e.setTextStyleWithoutAlignBaseline(t.attribute,d,H),"horizontal"===m){const{multilineLayout:o}=t;if(!o)return void e.highPerformanceRestore();const{xOffset:n,yOffset:l}=o.bbox;T&&(a?a(e,t.attribute,d):B&&(e.setStrokeStyle(t,t.attribute,w-i,v-r,d),o.lines.forEach((t=>{e.strokeText(t.str,(t.leftOffset||0)+n+i,(t.topOffset||0)+l+r,H)})))),M&&(s?s(e,t.attribute,d):R&&(e.setCommonStyle(t,t.attribute,w-i,v-r,d),o.lines.forEach((o=>{var s,a;e.fillText(o.str,(o.leftOffset||0)+n+i,(o.topOffset||0)+l+r,H),this.drawMultiUnderLine(g,p,t,(o.leftOffset||0)+n+i,(o.topOffset||0)+l+r-(a=y,"top"===(s="bottom")?Math.ceil(.79*a):"middle"===s?Math.round(.3*a):"bottom"===s?Math.round(-.21*a):0)-.05*y,H,o.width,d,e)}))))}else{t.tryUpdateAABBBounds();const i=t.cache,{verticalList:r}=i;e.textAlign="left",e.textBaseline="top";const o=S*r.length;let n=0;r.forEach((t=>{const e=t.reduce(((t,e)=>t+(e.width||0)),0);n=te(e,n)}));let s=0,a=0;"bottom"===_?a=-o:"middle"===_&&(a=-o/2),"center"===x?s-=n/2:"right"===x&&(s-=n),r.forEach(((t,e)=>{const i=t.reduce(((t,e)=>t+(e.width||0)),0),r=n-i;let l=s;"center"===x?l+=r/2:"right"===x&&(l+=r),t.forEach((t=>{const{text:i,width:r,direction:n}=t;E(i,o-(e+1)*S+a,l,n),l+=r}))}))}else if("horizontal"===m){e.setTextStyle(t.attribute,d,H);const i=t.clipedText;let r=0;S!==y&&("top"===_?r=(S-y)/2:"middle"===_||"bottom"===_&&(r=-(S-y)/2)),E(i,0,r,0)}else{t.tryUpdateAABBBounds();const i=t.cache;if(i){e.setTextStyleWithoutAlignBaseline(t.attribute,d,H);const{verticalList:r}=i;let o=0;const n=r[0].reduce(((t,e)=>t+(e.width||0)),0);let s=0;"bottom"===_?s=-S:"middle"===_&&(s=-S/2),"center"===x?o-=n/2:"right"===x&&(o-=n),e.textAlign="left",e.textBaseline="top",r[0].forEach((t=>{const{text:e,width:i,direction:r}=t;E(e,s,o,r),o+=i}))}}P&&this.restoreTransformUseContext2d(t,d,H,e),this.afterRenderStep(t,e,i,r,M,T,R,B,d,o,s,a)}draw(t,e,i,r){const o=yo(t,null==r?void 0:r.theme).text,{keepDirIn3d:n=o.keepDirIn3d}=t.attribute,s=!n;this._draw(t,o,s,i,r)}drawUnderLine(t,e,i,r,o,n,s,a){if(e+t<=0)return;const{textAlign:l=s.textAlign,textBaseline:h=s.textBaseline,fontSize:c=s.fontSize,fill:d=s.fill,opacity:u=s.opacity,underlineOffset:g=s.underlineOffset,underlineDash:p=s.underlineDash,fillOpacity:f=s.fillOpacity}=i.attribute,m=i.clipedWidth,b=qs(l,m),y=Zs(h,c,c),C={lineWidth:0,stroke:d,opacity:u,strokeOpacity:f};if(t){C.lineWidth=t,a.setStrokeStyle(i,C,r,o,s),a.setLineDash(p),a.beginPath();const e=o+y+c+g;a.moveTo(r+b,e,n),a.lineTo(r+b+m,e,n),a.stroke()}if(e){C.lineWidth=e,a.setStrokeStyle(i,C,r,o,s),a.beginPath();const t=o+y+c/2;a.moveTo(r+b,t,n),a.lineTo(r+b+m,t,n),a.stroke()}}drawMultiUnderLine(t,e,i,r,o,n,s,a,l){if(e+t<=0)return;const{fontSize:h=a.fontSize,fill:c=a.fill,opacity:d=a.opacity,underlineOffset:u=a.underlineOffset,underlineDash:g=a.underlineDash,fillOpacity:p=a.fillOpacity}=i.attribute,f=Zs("alphabetic",h,h),m={lineWidth:0,stroke:c,opacity:d,strokeOpacity:p};let b=-3;if(t){m.lineWidth=t,l.setStrokeStyle(i,m,r,o,a),l.setLineDash(g),l.beginPath();const e=o+f+h+b+u;l.moveTo(r+0,e,n),l.lineTo(r+0+s,e,n),l.stroke()}if(b=-1,e){m.lineWidth=e,l.setStrokeStyle(i,m,r,o,a),l.beginPath();const t=o+f+h/2+b;l.moveTo(r+0,t,n),l.lineTo(r+0+s,t,n),l.stroke()}}};function Ec(t,e,i,r){t.moveTo(e[0].x+i,e[0].y+r);for(let o=1;o<e.length;o++)t.lineTo(e[o].x+i,e[o].y+r)}function kc(t,e){return Math.sqrt(t*t+e*e)}function Lc(t,e,i,r,o){const n=e/i;return{x:t.x-r*n,y:t.y-o*n}}Hc=Mc([f(),Pc(0,g(H)),Pc(0,m(Vs)),Tc("design:paramtypes",[Object])],Hc);const Fc=Ah,Ic=xh;var zc=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Oc=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Dc=function(t,e){return function(i,r){e(i,r,t)}};let Wc=class extends gh{constructor(t){super(),this.polygonRenderContribitions=t,this.numberType=Zn,this.builtinContributions=[Ic,Fc],this.init(t)}drawShape(t,e,i,r,o,n,s,a){const l=yo(t,null==n?void 0:n.theme).polygon,{points:h=l.points,cornerRadius:c=l.cornerRadius,x:d=l.x,y:u=l.y,closePath:g=l.closePath}=t.attribute,p=this.valid(t,l,s,a);if(!p)return;const{fVisible:f,sVisible:m,doFill:b,doStroke:y}=p;e.beginPath(),c<=0||et(c)&&c.every((t=>0===t))?Ec(e.camera?e:e.nativeContext,h,i,r):function(t,e,i,r,o){let n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];var s;if(e.length<3)return void Ec(t,e,i,r);let a=0,l=e.length-1;n||(a+=1,l-=1,t.moveTo(e[0].x+i,e[0].y+r));for(let n=a;n<=l;n++){const a=e[0===n?l:(n-1)%e.length],h=e[n%e.length],c=e[(n+1)%e.length],d=h.x-a.x,u=h.y-a.y,g=h.x-c.x,p=h.y-c.y,f=(Math.atan2(u,d)-Math.atan2(p,g))/2,m=Math.abs(Math.tan(f));let b=Array.isArray(o)?null!==(s=o[n%e.length])&&void 0!==s?s:0:o,y=b/m;const C=kc(d,u),w=kc(g,p),v=Math.min(C,w);y>v&&(y=v,b=v*m);const x=Lc(h,y,C,d,u),_=Lc(h,y,w,g,p),S=2*h.x-x.x-_.x,A=2*h.y-x.y-_.y,R=kc(S,A),B=Lc(h,kc(y,b),R,S,A);let M=Math.atan2(x.y-B.y,x.x-B.x);const T=Math.atan2(_.y-B.y,_.x-B.x);let P=T-M;P<0&&(M=T,P=-P),P>Math.PI&&(P-=Math.PI),0===n?t.moveTo(x.x+i,x.y+r):t.lineTo(x.x+i,x.y+r),P&&t.arcTo(h.x+i,h.y+r,_.x+i,_.y+r,b),t.lineTo(_.x+i,_.y+r)}n||t.lineTo(e[l+1].x+i,e[l+1].y+r)}(e.camera?e:e.nativeContext,h,i,r,c,g),g&&e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),this.beforeRenderStep(t,e,i,r,b,y,f,m,l,o,s,a),b&&(s?s(e,t.attribute,l):f&&(e.setCommonStyle(t,t.attribute,d-i,u-r,l),e.fill())),y&&(a?a(e,t.attribute,l):m&&(e.setStrokeStyle(t,t.attribute,d-i,u-r,l),e.stroke())),this.afterRenderStep(t,e,i,r,b,y,f,m,l,o,s,a)}draw(t,e,i,r){const o=yo(t,null==r?void 0:r.theme).polygon;this._draw(t,o,!1,i,r)}};Wc=zc([f(),Dc(0,g(H)),Dc(0,m(Ns)),Oc("design:paramtypes",[Object])],Wc);var Nc=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Gc=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},jc=function(t,e){return function(i,r){e(i,r,t)}};const Vc=["","repeat-x","repeat-y","repeat"];let Uc=class extends gh{constructor(t){super(),this.imageRenderContribitions=t,this.numberType=Xn,this.builtinContributions=[Fh],this.init(t)}drawShape(t,e,i,r,o,n,s){const a=yo(t).image,{width:l=a.width,height:h=a.height,repeatX:c=a.repeatX,repeatY:d=a.repeatY,cornerRadius:u=a.cornerRadius,image:g}=t.attribute,p=this.valid(t,a,s);if(!p)return;const{fVisible:f,sVisible:m,doFill:b,doStroke:y}=p;if(e.setShadowBlendStyle&&e.setShadowBlendStyle(t,a),this.beforeRenderStep(t,e,i,r,b,!1,f,!1,a,o,s),b)if(s)s(e,t.attribute,a);else if(f){if(!g||!t.resources)return;const o=t.resources.get(g);if("success"!==o.state)return;let n=!1;0===u||et(u)&&u.every((t=>0===t))||(e.beginPath(),Lh(e,i,r,l,h,u),e.save(),e.clip(),n=!0),e.setCommonStyle(t,t.attribute,i,r,a);let s=0;if("repeat"===c&&(s|=1),"repeat"===d&&(s|=2),s){const t=e.createPattern(o.data,Vc[s]);e.fillStyle=t,e.translate(i,r,!0),e.fillRect(0,0,l,h),e.translate(-i,-r,!0)}else e.drawImage(o.data,i,r,l,h);n&&e.restore()}this.afterRenderStep(t,e,i,r,b,!1,f,!1,a,o,s)}draw(t,e,i){const{image:r}=t.attribute;if(!r||!t.resources)return;const o=t.resources.get(r);if("loading"===o.state&&tt(r))return void un.improveImageLoading(r);if("success"!==o.state)return;const{context:n}=e.drawParams;if(!n)return;const s=yo(t).image;this._draw(t,s,!1,i)}};Uc=Nc([f(),jc(0,g(H)),jc(0,m(Ds)),Gc("design:paramtypes",[Object])],Uc);const Kc=Symbol.for("IncrementalDrawContribution"),$c=Symbol.for("ArcRender"),Xc=Symbol.for("Arc3dRender"),Yc=Symbol.for("AreaRender"),qc=Symbol.for("CircleRender"),Zc=Symbol.for("GraphicRender"),Jc=Symbol.for("GroupRender"),Qc=Symbol.for("LineRender"),td=Symbol.for("PathRender"),ed=Symbol.for("PolygonRender"),id=Symbol.for("RectRender"),rd=Symbol.for("Rect3DRender"),od=Symbol.for("SymbolRender"),nd=Symbol.for("TextRender"),sd=Symbol.for("RichTextRender"),ad=Symbol.for("Pyramid3dRender"),ld=Symbol.for("GlyphRender"),hd=Symbol.for("ImageRender"),cd=Symbol.for("DrawContribution");var dd=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},ud=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};const gd=Symbol.for("DrawItemInterceptor"),pd=new ue;class fd{constructor(){this.order=1}afterDrawItem(t,e,i,r,o){return(t.attribute.shadowRootIdx>0||!t.attribute.shadowRootIdx)&&this.drawItem(t,e,i,r,o),!1}beforeDrawItem(t,e,i,r,o){return t.attribute.shadowRootIdx<0&&this.drawItem(t,e,i,r,o),!1}drawItem(t,e,i,r,o){if(!t.shadowRoot)return!1;const{context:n}=i;if(n.highPerformanceSave(),n.transformFromMatrix(t.transMatrix,!0),r.dirtyBounds&&r.backupDirtyBounds){pd.copy(r.dirtyBounds);const e=t.globalTransMatrix.getInverse();r.dirtyBounds.copy(r.backupDirtyBounds).transformWithMatrix(e)}return r.renderGroup(t.shadowRoot,i,t.parent.globalTransMatrix),n.highPerformanceRestore(),r.dirtyBounds&&r.backupDirtyBounds&&r.dirtyBounds.copy(pd),!0}}class md{constructor(){this.order=1}afterDrawItem(t,e,i,r,o){return t.attribute._debug_bounds&&this.drawItem(t,e,i,r,o),!1}drawItem(t,e,i,r,o){if(!t.attribute._debug_bounds)return!1;const{context:n}=i;n.highPerformanceSave(),t.parent&&n.setTransformFromMatrix(t.parent.globalTransMatrix,!0),t.glyphHost&&t.glyphHost.parent&&n.setTransformFromMatrix(t.glyphHost.parent.globalTransMatrix,!0);const s=t.AABBBounds;return!0!==t.attribute._debug_bounds&&t.attribute._debug_bounds(n,t),n.strokeRect(s.x1,s.y1,s.width(),s.height()),n.highPerformanceRestore(),!0}}let bd=class{constructor(){this.order=1,this.interceptors=[new fd,new Cd,new yd,new md]}afterDrawItem(t,e,i,r,o){for(let n=0;n<this.interceptors.length;n++)if(this.interceptors[n].afterDrawItem&&this.interceptors[n].afterDrawItem(t,e,i,r,o))return!0;return!1}beforeDrawItem(t,e,i,r,o){if((!t.in3dMode||i.in3dInterceptor)&&!t.shadowRoot&&!(t.baseGraphic||t.attribute.globalZIndex||t.interactiveGraphic))return!1;for(let n=0;n<this.interceptors.length;n++)if(this.interceptors[n].beforeDrawItem&&this.interceptors[n].beforeDrawItem(t,e,i,r,o))return!0;return!1}};bd=dd([f(),ud("design:paramtypes",[])],bd);class yd{constructor(){this.order=1}beforeDrawItem(t,e,i,r,o){return!this.processing&&(t.baseGraphic?this.beforeDrawInteractive(t,e,i,r,o):this.beforeSetInteractive(t,e,i,r,o))}beforeSetInteractive(t,e,i,r,o){let n=t.interactiveGraphic;if(t.attribute.globalZIndex){n||(n=t.clone(),t.interactiveGraphic=n,n.baseGraphic=t),n.setAttributes({globalZIndex:0,zIndex:t.attribute.globalZIndex},!1,{skipUpdateCallback:!0}),i.stage.tryInitInteractiveLayer();const e=i.stage.getLayer("_builtin_interactive");return e&&this.getShadowRoot(e).add(n),!0}if(n){i.stage.tryInitInteractiveLayer();const e=i.stage.getLayer("_builtin_interactive");e&&this.getShadowRoot(e).removeChild(n),t.interactiveGraphic=null,n.baseGraphic=null}return!1}beforeDrawInteractive(t,e,i,r,o){const n=t.baseGraphic;if(n){this.processing=!0;const{context:t}=i;return t.highPerformanceSave(),t.setTransformFromMatrix(n.parent.globalTransMatrix,!0),n.isContainer?r.renderGroup(n,i,n.parent.globalTransMatrix):r.renderItem(n,i),t.highPerformanceRestore(),this.processing=!1,!0}return!1}getShadowRoot(t){var e;let i=t.getElementById("_interactive_group");return i||(i=hh.CreateGraphic("group",{}),i.id="_interactive_group",t.add(i)),null!==(e=i.shadowRoot)&&void 0!==e?e:i.attachShadow()}}class Cd{constructor(){this.order=1}beforeDrawItem(t,e,i,r,o){if(!t.in3dMode||i.in3dInterceptor)return!1;i.in3dInterceptor=!0;const{context:n,stage:s}=e.drawParams;n.canvas,n.save(),this.initCanvasCtx(n),n.camera=s.camera;const a=n.currentMatrix;a.a/=n.dpr,a.b/=n.dpr,a.c/=n.dpr,a.d/=n.dpr,a.e/=n.dpr,a.f/=n.dpr;const l=th.allocate();nh(l,a);const h=n.modelMatrix;if(h){if(l){const t=th.allocate();n.modelMatrix=sh(t,h,l)}}else n.modelMatrix=l;if(n.setTransform(1,0,0,1,0,0,!0),t.isContainer){let e=!1,o=!1;if(t.forEachChildren((t=>(e=t.numberType===jn,!e))),t.forEachChildren((t=>(o=!!t.findFace,!o))),e){const e=t.getChildren(),o=[...e];o.sort(((t,e)=>{var i,r,o,n;let s=((null!==(i=t.attribute.startAngle)&&void 0!==i?i:0)+(null!==(r=t.attribute.endAngle)&&void 0!==r?r:0))/2,a=((null!==(o=e.attribute.startAngle)&&void 0!==o?o:0)+(null!==(n=e.attribute.endAngle)&&void 0!==n?n:0))/2;for(;s<0;)s+=qt;for(;a<0;)a+=qt;return a-s})),o.forEach((t=>{t._next=null,t._prev=null})),t.removeAllChild(),t.update(),o.forEach((e=>{t.appendChild(e)}));const n=t.parent.globalTransMatrix;i.hack_pieFace="outside",r.renderGroup(t,i,n),i.hack_pieFace="inside",r.renderGroup(t,i,n),i.hack_pieFace="top",r.renderGroup(t,i,n),t.removeAllChild(),e.forEach((t=>{t._next=null,t._prev=null})),e.forEach((e=>{t.appendChild(e)}))}else if(o){const e=t.getChildren(),o=e.map((t=>({ave_z:t.findFace().vertices.map((e=>{var i;return n.view(e[0],e[1],null!==(i=e[2]+t.attribute.z)&&void 0!==i?i:0)[2]})).reduce(((t,e)=>t+e),0),g:t})));o.sort(((t,e)=>e.ave_z-t.ave_z)),t.removeAllChild(),o.forEach((t=>{t.g._next=null,t.g._prev=null})),t.update(),o.forEach((e=>{t.add(e.g)})),r.renderGroup(t,i,t.parent.globalTransMatrix,!0),t.removeAllChild(),e.forEach((t=>{t._next=null,t._prev=null})),t.update(),e.forEach((e=>{t.add(e)}))}else r.renderGroup(t,i,t.parent.globalTransMatrix)}else r.renderItem(t,i);return n.camera=null,n.restore(),n.modelMatrix!==h&&th.free(n.modelMatrix),n.modelMatrix=h,i.in3dInterceptor=!1,!0}initCanvasCtx(t){t.setTransformForCurrent()}}var wd=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},vd=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},xd=function(t,e){return function(i,r){e(i,r,t)}};const _d=Symbol.for("RenderService");let Sd=class{constructor(t){this.drawContribution=t}prepare(t){t&&this.renderTreeRoots.forEach((e=>{this._prepare(e,t)}))}_prepare(t,e){t.forEachChildren((t=>{this._prepare(t,e)})),t.update({bounds:e,trans:!0})}prepareRenderList(){}beforeDraw(t){}draw(t){this.drawContribution.draw(this,Object.assign({},this.drawParams))}afterDraw(t){this.drawContribution.afterDraw&&this.drawContribution.afterDraw(this,Object.assign({},this.drawParams))}render(t,e){this.renderTreeRoots=t,this.drawParams=e;const i=e.updateBounds;this.prepare(i),this.prepareRenderList(),this.beforeDraw(e),this.draw(e),this.afterDraw(e),this.drawParams=null}};Sd=wd([f(),xd(0,g(cd)),vd("design:paramtypes",[Object])],Sd);var Ad=new i((t=>{t(_d).to(Sd).inSingletonScope()}));const Rd=Symbol.for("PickerService"),Bd=Symbol.for("GlobalPickerService");var Md=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};const Td=Symbol.for("PickItemInterceptor");let Pd=class{constructor(){this.order=1}afterPickItem(t,e,i,r,o){return t.attribute.shadowRootIdx>0||!t.attribute.shadowRootIdx?this._pickItem(t,e,i,r,o):null}beforePickItem(t,e,i,r,o){return t.attribute.shadowRootIdx<0?this._pickItem(t,e,i,r,o):null}_pickItem(t,e,i,r,o){if(!t.shadowRoot)return null;const{parentMatrix:n}=o||{};if(!n)return null;const s=e.pickContext;s.highPerformanceSave();const a=t.shadowRoot,l=Ql.allocateByObj(n),h=new le(l.a*i.x+l.c*i.y+l.e,l.b*i.x+l.d*i.y+l.f),c=e.pickGroup(a,h,l,r);return s.highPerformanceRestore(),c}};Pd=Md([f()],Pd);let Hd=class{constructor(){this.order=1}beforePickItem(t,e,i,r,o){const n=t.baseGraphic;if(n&&n.parent){const t=new le(i.x,i.y),o=e.pickContext;o.highPerformanceSave();const s=n.parent.globalTransMatrix;s.transformPoint(t,t);const a=n.isContainer?e.pickGroup(n,t.clone(),s,r):e.pickItem(n,t.clone(),s,r);return o.highPerformanceRestore(),a}return null}};Hd=Md([f()],Hd);let Ed=class{constructor(){this.order=1}beforePickItem(t,e,i,r,o){if(!t.in3dMode||r.in3dInterceptor)return null;const n=e.pickContext,s=t.stage;if(!n||!s)return null;if(r.in3dInterceptor=!0,n.save(),this.initCanvasCtx(n),n.camera=s.camera,t.isContainer){let s,a=!1,l=!1;if(t.forEachChildren((t=>(a=t.numberType===jn,!a))),t.forEachChildren((t=>(l=!!t.findFace,!l))),a){const n=t.getChildren(),a=[...n];a.sort(((t,e)=>{var i,r,o,n;let s=(null!==(r=null!==(i=t.attribute.startAngle)&&void 0!==i?i:0+t.attribute.endAngle)&&void 0!==r?r:0)/2,a=(null!==(n=null!==(o=e.attribute.startAngle)&&void 0!==o?o:0+e.attribute.endAngle)&&void 0!==n?n:0)/2;for(;s<0;)s+=qt;for(;a<0;)a+=qt;return a-s})),a.forEach((t=>{t._next=null,t._prev=null})),t.removeAllChild(),t.update(),a.forEach((e=>{t.appendChild(e)})),r.hack_pieFace="outside",s=e.pickGroup(t,i,o.parentMatrix,r),s.graphic||(r.hack_pieFace="inside",s=e.pickGroup(t,i,o.parentMatrix,r)),s.graphic||(r.hack_pieFace="top",s=e.pickGroup(t,i,o.parentMatrix,r)),t.removeAllChild(),n.forEach((t=>{t._next=null,t._prev=null})),n.forEach((e=>{t.appendChild(e)}))}else if(l){const a=t.getChildren(),l=a.map((t=>({ave_z:t.findFace().vertices.map((e=>{var i;return n.view(e[0],e[1],null!==(i=e[2]+t.attribute.z)&&void 0!==i?i:0)[2]})).reduce(((t,e)=>t+e),0),g:t})));l.sort(((t,e)=>e.ave_z-t.ave_z)),t.removeAllChild(),l.forEach((t=>{t.g._next=null,t.g._prev=null})),t.update(),l.forEach((e=>{t.add(e.g)})),s=e.pickGroup(t,i,o.parentMatrix,r),t.removeAllChild(),a.forEach((t=>{t._next=null,t._prev=null})),t.update(),a.forEach((e=>{t.add(e)}))}else s=e.pickGroup(t,i,o.parentMatrix,r);return n.camera=null,r.in3dInterceptor=!1,n.restore(),s}return n.restore(),null}initCanvasCtx(t){t.setTransformForCurrent()}};Ed=Md([f()],Ed);var kd=new i(((t,e,i)=>{i(Rd)||(t(Bd).toSelf(),t(Rd).toService(Bd)),t(Ed).toSelf().inSingletonScope(),t(Td).toService(Ed),t(Pd).toSelf().inSingletonScope(),t(Td).toService(Pd),t(Hd).toSelf().inSingletonScope(),t(Td).toService(Hd),k(t,Td)})),Ld=new i((t=>{t(os).to(lh).inSingletonScope(),t(ns).toConstantValue(hh)}));const Fd=Symbol.for("AutoEnablePlugins"),Id=Symbol.for("PluginService");var zd=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Od=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Dd=function(t,e){return function(i,r){e(i,r,t)}};let Wd=class{constructor(t){this.autoEnablePlugins=t,this.onStartupFinishedPlugin=[],this.onRegisterPlugin=[],this.actived=!1}active(t,e){this.stage=t,this.actived=!0;const{pluginList:i}=e;i&&Xr.isBound(Fd)&&this.autoEnablePlugins.getContributions().forEach((t=>{i.includes(t.name)&&this.register(t)}))}findPluginsByName(t){const e=[];return this.onStartupFinishedPlugin.forEach((i=>{i.name===t&&e.push(i)})),this.onRegisterPlugin.forEach((i=>{i.name===t&&e.push(i)})),e}register(t){"onStartupFinished"===t.activeEvent?this.onStartupFinishedPlugin.push(t):"onRegister"===t.activeEvent&&(this.onRegisterPlugin.push(t),t.activate(this))}unRegister(t){"onStartupFinished"===t.activeEvent?this.onStartupFinishedPlugin.splice(this.onStartupFinishedPlugin.indexOf(t),1):"onRegister"===t.activeEvent&&this.onRegisterPlugin.splice(this.onStartupFinishedPlugin.indexOf(t),1),t.deactivate(this)}release(){this.onStartupFinishedPlugin.forEach((t=>{t.deactivate(this)})),this.onStartupFinishedPlugin=[],this.onRegisterPlugin.forEach((t=>{t.deactivate(this)})),this.onRegisterPlugin=[]}};Wd=zd([f(),Dd(0,g(H)),Dd(0,m(Fd)),Od("design:paramtypes",[Object])],Wd);var Nd=new i((t=>{t(Id).to(Wd),function(t,e){t(H).toDynamicValue((t=>{let{container:i}=t;return new E(e,i)})).whenTargetNamed(e)}(t,Fd)})),Gd=new i((t=>{k(t,I)})),jd=new i((t=>{t(Kr).to($r).inSingletonScope(),k(t,Kr)})),Vd=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Ud=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let Kd=class{constructor(){this.type="static",this.offscreen=!1,this.global=kr.global}setDpr(t){this.canvas.dpr=t}init(t,e,i){if(this.layer=t,this.window=e,i.main)this.main=!0,this.context=e.getContext(),this.canvas=this.context.getCanvas();else{let t;this.main=!1,i.canvasId&&(t=this.global.getElementById(i.canvasId)),t||(t=this.global.createCanvas({width:e.width,height:e.height})),t.style&&(t.style["pointer-events"]="none");const r=e.getContext().getCanvas().nativeCanvas,o=Zr({nativeCanvas:t,width:e.width,height:e.height,dpr:e.dpr,id:i.canvasId,canvasControled:!0,container:e.getContainer(),x:r.offsetLeft,y:r.offsetTop});o.applyPosition(),this.canvas=o,this.context=o.getContext()}}resize(t,e){this.canvas.resize(t,e)}resizeView(t,e){}render(t,e,i){var r;if(!this.main){const t=this.window.getContext().getCanvas().nativeCanvas;!t||this.canvas.x===t.offsetLeft&&this.canvas.y===t.offsetTop||(this.canvas.x=t.offsetLeft,this.canvas.y=t.offsetTop,this.canvas.applyPosition())}e.renderService.render(t,Object.assign(Object.assign({context:this.context,clear:null!==(r=e.background)&&void 0!==r?r:"#ffffff"},e),i))}merge(t){t.forEach((t=>{const e=t.getContext().canvas.nativeCanvas;this.context.drawImage(e,0,0)}))}prepare(t,e){}drawTo(t,e,i){var r;const o=t.getContext();i.renderService.render(e,Object.assign(Object.assign({context:o},i),{clear:i.clear?null!==(r=i.background)&&void 0!==r?r:"#fff":void 0}))}getContext(){return this.context}release(){this.canvas.release()}};Kd=Vd([f(),Ud("design:paramtypes",[])],Kd);var $d=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Xd=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let Yd=class{constructor(){this.offscreen=!1,this.type="virtual",this.global=kr.global}setDpr(t){}init(t,e,i){if(this.layer=t,this.window=e,i.main)throw new Error("virtual layer不能作为main layer");this.main=!1,this.canvas=null,this.context=null}resize(t,e){}resizeView(t,e){}render(t,e,i){this.mainHandler.render(t,e,Object.assign(Object.assign({},i),{clear:!1}))}merge(t){}prepare(t,e){}drawTo(t,e,i){var r;const o=t.getContext();i.renderService.render(e,Object.assign(Object.assign({context:o},i),{clear:i.clear?null!==(r=i.background)&&void 0!==r?r:"#fff":void 0}))}getContext(){return null}release(){}};Yd=$d([f(),Xd("design:paramtypes",[])],Yd);var qd=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Zd=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let Jd=class{constructor(){this.offscreen=!0,this.type="dynamic",this.global=kr.global}setDpr(t){this.canvas.dpr=t}init(t,e,i){this.layer=t;const r=Zr({nativeCanvas:this.global.createOffscreenCanvas({width:i.width,height:i.height,dpr:e.dpr}),width:i.width,height:i.height,dpr:e.dpr,canvasControled:!0});this.canvas=r,this.context=r.getContext()}resize(t,e){this.canvas.resize(t,e)}resizeView(t,e){this.canvas.resize(t,e)}render(t,e){var i;e.renderService.render(t,Object.assign(Object.assign({context:this.context,viewBox:e.stage.window.getViewBox(),transMatrix:e.stage.window.getViewBoxTransform()},e),{clear:null!==(i=e.background)&&void 0!==i?i:"#ffffff"}))}prepare(t,e){}release(){this.canvas.release()}getContext(){return this.context}drawTo(t,e,i){const r=t.getContext(),o=t.dpr,{viewBox:n}=i,s=n.x1,a=n.y1,l=n.width(),h=n.height();r.nativeContext.save(),r.nativeContext.setTransform(o,0,0,o,0,0),i.clear&&r.clearRect(s,a,l,h),r.drawImage(this.canvas.nativeCanvas,0,0,this.canvas.width,this.canvas.height,s,a,l,h),r.nativeContext.restore()}merge(t){}};Jd=qd([f(),Zd("design:paramtypes",[])],Jd);var Qd=new i((t=>{t(Kd).toSelf(),t(Jd).toSelf(),t(Yd).toSelf(),t(fs).toService(Kd),t(ms).toService(Jd),t(bs).toService(Yd)}));var tu=function(t,e,i,r){return new(i||(i=Promise))((function(o,n){function s(t){try{l(r.next(t))}catch(t){n(t)}}function a(t){try{l(r.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((r=r.apply(t,e||[])).next())}))};function eu(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const n={},s=[];let a=!1;if(o)a=!0;else{let i;t.forEachChildren(((t,r)=>{const{zIndex:o=e}=t.attribute;if(0===r)i=o;else if(i!==o)return a=!0,!0;return!1}),r)}if(a){t.forEachChildren((t=>{const{zIndex:i=e}=t.attribute;n[i]?n[i].push(t):(n[i]=[t],s.push(i))}),r),s.sort(((t,e)=>r?e-t:t-e));let a=!1;for(let t=0;t<s.length&&!a;t++){const e=s[t],l=n[e];o&&l.sort(((t,e)=>{var i,o;return(r?-1:1)*((null!==(i=e.attribute.z)&&void 0!==i?i:0)-(null!==(o=t.attribute.z)&&void 0!==o?o:0))}));for(let t=0;t<l.length;t++)if(i(l[t],t)){a=!0;break}}}else t.forEachChildren(i,r)}function iu(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return tu(this,void 0,void 0,(function*(){yield t.forEachChildrenAsync(i,r)}))}function ru(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o={},n=[];let s=!1;t.forEachChildren(((t,e)=>{const{zIndex:r=i}=t.attribute;if(0===e);else if(void 0!==r)return s=!0,!0;return!1}),r);let a=null,l=!1;if(s){t.forEachChildren((t=>{const{zIndex:e=i}=t.attribute;o[e]?o[e].push(t):(o[e]=[t],n.push(e))}),r),n.sort(((t,e)=>r?e-t:t-e));let s=!1;for(let t=0;t<n.length&&!s;t++){const i=n[t],r=o[i];for(let t=0;t<r.length;t++){if(l){s=!0,a=r[t];break}r[t]._uid!==e||(l=!0)}}}else t.forEachChildren((t=>l?(a=t,!0):(t._uid===e&&(l=!0),!1)),r);return a}var ou=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},nu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},su=function(t,e){return function(i,r){e(i,r,t)}};let au=class{constructor(t,e){this.contributions=t,this.drawItemInterceptorContributions=e,this.currentRenderMap=new Map,this.defaultRenderMap=new Map,this.styleRenderMap=new Map,this.dirtyBounds=new de,this.backupDirtyBounds=new de,this.global=kr.global,this.layerService=kr.layerService,this.init()}init(){this.contributions.forEach((t=>{if(t.style){const e=this.styleRenderMap.get(t.style)||new Map;e.set(t.numberType,t),this.styleRenderMap.set(t.style,e)}else this.defaultRenderMap.set(t.numberType,t)})),this.InterceptorContributions=this.drawItemInterceptorContributions.getContributions().sort(((t,e)=>t.order-e.order))}prepareForDraw(t,e){e.updateBounds?this.useDirtyBounds=!0:this.useDirtyBounds=!e.stage.params.optimize.disableCheckGraphicWidthOutRange}draw(t,e){this.prepareForDraw(t,e),e.drawContribution=this,this.currentRenderMap=this.styleRenderMap.get(e.renderStyle)||this.defaultRenderMap,this.currentRenderService=t;const{context:i,stage:r,viewBox:o,transMatrix:n}=e;if(!i)return;const s=this.dirtyBounds.setValue(0,0,o.width(),o.height());if(r.dirtyBounds&&!r.dirtyBounds.empty()){const t=ze(s,r.dirtyBounds,!1);s.x1=Math.floor(t.x1),s.y1=Math.floor(t.y1),s.x2=Math.ceil(t.x2),s.y2=Math.ceil(t.y2)}const a=i.dpr%1;(a||.5!==a)&&(s.x1=Math.floor(s.x1*i.dpr)/i.dpr,s.y1=Math.floor(s.y1*i.dpr)/i.dpr,s.x2=Math.ceil(s.x2*i.dpr)/i.dpr,s.y2=Math.ceil(s.y2*i.dpr)/i.dpr),this.backupDirtyBounds.copy(s),i.inuse=!0,i.setClearMatrix(n.a,n.b,n.c,n.d,n.e,n.f),i.clearMatrix(),i.setTransformForCurrent(!0),i.translate(o.x1,o.y1,!0),i.beginPath(),i.rect(s.x1,s.y1,s.width(),s.height()),i.clip(),r.camera&&(this.dirtyBounds.setValue(-1/0,-1/0,1/0,1/0),this.backupDirtyBounds.setValue(-1/0,-1/0,1/0,1/0)),this.clearScreen(t,i,e),i.save(),t.renderTreeRoots.sort(((t,e)=>{var i,r;return(null!==(i=t.attribute.zIndex)&&void 0!==i?i:br.zIndex)-(null!==(r=e.attribute.zIndex)&&void 0!==r?r:br.zIndex)})).forEach((t=>{t.isContainer?this.renderGroup(t,e,Ql.allocate(1,0,0,1,0,0)):this.renderItem(t,e)})),i.restore(),i.draw(),i.setClearMatrix(1,0,0,1,0,0),i.inuse=!1}doRegister(){throw new Error("暂不支持")}_findNextGraphic(t){let e=t.parent,i=t._uid;for(;e;){const t=ru(e,i,br.zIndex);if(t)return t;i=e._uid,e=e.parent}return null}renderGroup(t,e,i,r){if(e.break||!1===t.attribute.visibleAll)return;if(t.incremental&&(null==e.startAtId||e.startAtId===t._uid))return e.break=!0,void this._increaseRender(t,e);if(this.useDirtyBounds&&!De(t.AABBBounds,this.dirtyBounds,!1))return;let o,n=i;if(this.useDirtyBounds){o=Rc.allocateByObj(this.dirtyBounds);const e=t.transMatrix;n=Ql.allocateByObj(i).multiply(e.a,e.b,e.c,e.d,e.e,e.f),this.dirtyBounds.copy(this.backupDirtyBounds).transformWithMatrix(n.getInverse())}this.renderItem(t,e,{drawingCb:()=>{var i;r?t.forEachChildren((t=>{e.break||(t.isContainer?this.renderGroup(t,e,n):this.renderItem(t,e))})):eu(t,br.zIndex,(t=>{e.break||(t.isContainer?this.renderGroup(t,e,n):this.renderItem(t,e))}),!1,!!(null===(i=e.context)||void 0===i?void 0:i.camera))}}),this.useDirtyBounds&&(this.dirtyBounds.copy(o),Rc.free(o),Ql.free(n))}_increaseRender(t,e){const{layer:i,stage:r}=e,{subLayers:o}=i;let n=o.get(t._uid);n||(n={layer:this.layerService.createLayer(r),zIndex:o.size,group:t},o.set(t._uid,n));const s=n.layer.getNativeHandler().getContext(),a=n.drawContribution||Xr.get(Kc);a.dirtyBounds.setValue(-1/0,-1/0,1/0,1/0),a.backupDirtyBounds.setValue(-1/0,-1/0,1/0,1/0),a.draw(this.currentRenderService,Object.assign(Object.assign({},e),{drawContribution:a,clear:"transparent",layer:n.layer,context:s,startAtId:t._uid,break:!1})),n.drawContribution=a;const l=this._findNextGraphic(t);if(l)if(l.isContainer&&l.incremental)this._increaseRender(l,e);else{let t=o.get(l._uid);t||(t={layer:this.layerService.createLayer(r),zIndex:o.size},o.set(l._uid,t));const i=t.layer.getNativeHandler().getContext();this.draw(this.currentRenderService,Object.assign(Object.assign({},e),{drawContribution:a,clear:"transparent",layer:t.layer,context:i,startAtId:l._uid,break:!1}))}}getRenderContribution(t){let e;return e||(e=this.selectRenderByNumberType(t.numberType,t)),e||(e=this.selectRenderByType(t.type)),e}renderItem(t,e,i){if(this.InterceptorContributions.length)for(let r=0;r<this.InterceptorContributions.length;r++){const o=this.InterceptorContributions[r];if(o.beforeDrawItem&&o.beforeDrawItem(t,this.currentRenderService,e,this,i))return}const r=this.getRenderContribution(t);if(!r)return;let o,n=!1;if(t.parent){const{scrollX:e=0,scrollY:i=0}=t.parent.attribute;if(n=!(!e&&!i),n){o=this.dirtyBounds.clone();const r=t.globalTransMatrix.getInverse();this.dirtyBounds.copy(this.backupDirtyBounds).transformWithMatrix(r),this.dirtyBounds.translate(-e,-i)}}if(this.useDirtyBounds&&!t.isContainer&&!De(t.AABBBounds,this.dirtyBounds,!1))return void(n&&this.dirtyBounds.copy(o));const s=null!=e.startAtId&&t._uid!==e.startAtId;if(t._uid===e.startAtId&&(e.startAtId=null),i&&(i.skipDraw=s),s?t.isContainer&&r.draw(t,this.currentRenderService,e,i):r.draw(t,this.currentRenderService,e,i),n&&this.dirtyBounds.copy(o),this.InterceptorContributions.length)for(let i=0;i<this.InterceptorContributions.length;i++){const r=this.InterceptorContributions[i];if(r.afterDrawItem&&r.afterDrawItem(t,this.currentRenderService,e,this))return}}selectRenderByType(t){return qe.getInstance().warn("未知错误，不应该走到这里"),null}selectRenderByNumberType(t,e){let i;if(e.attribute.renderStyle){const r=this.styleRenderMap.get(e.attribute.renderStyle);i=r&&r.get(t)}return i||this.currentRenderMap.get(t)||this.defaultRenderMap.get(t)}clearScreen(t,e,i){var r,o;const{clear:n,viewBox:s}=i,a=s.width(),l=s.height();if(n){e.clearRect(0,0,a,l);const i=null===(r=t.drawParams)||void 0===r?void 0:r.stage;if(i&&(e.globalAlpha=null!==(o=i.attribute.opacity)&&void 0!==o?o:1),i&&i.backgroundImg&&i.resources){const t=i.resources.get(n);t&&"success"===t.state&&t.data&&e.drawImage(t.data,0,0,a,l)}else e.fillStyle=bh(e,n,{AABBBounds:{x1:0,y1:0,x2:0+a,y2:0+l}},0,0),e.fillRect(0,0,a,l)}}afterDraw(t,e){}};au=ou([f(),su(0,p(Zc)),su(1,g(H)),su(1,m(gd)),nu("design:paramtypes",[Array,Object])],au);var lu=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},hu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},cu=function(t,e){return function(i,r){e(i,r,t)}};let du=class{constructor(t){this.groupRenderContribitions=t,this.numberType=$n}drawShape(t,e,i,r,o,n,s,a){const l=yo(t,null==n?void 0:n.theme).group,{fill:h=l.fill,background:c,stroke:d=l.stroke,opacity:u=l.opacity,width:g=l.width,height:p=l.height,clip:f=l.clip,fillOpacity:m=l.fillOpacity,strokeOpacity:b=l.strokeOpacity,cornerRadius:y=l.cornerRadius,path:C=l.path,lineWidth:w=l.lineWidth,visible:v=l.visible}=t.attribute,x=Rs(u,m,g,p,h),_=Ms(u,b,g,p),S=_s(h,c),A=Ss(d,w);if(!t.valid||!v)return;if(!f){if(!S&&!A)return;if(!(x||_||s||a||c))return}if(C&&C.length&&o.drawContribution){const t=e.disableFill,i=e.disableStroke,r=e.disableBeginPath;e.disableFill=!0,e.disableStroke=!0,e.disableBeginPath=!0,C.forEach((t=>{o.drawContribution.getRenderContribution(t).draw(t,o.renderService,o,n)})),e.disableFill=t,e.disableStroke=i,e.disableBeginPath=r}else 0===y||et(y)&&y.every((t=>0===t))?(e.beginPath(),e.rect(i,r,g,p)):(e.beginPath(),Lh(e,i,r,g,p,y));this._groupRenderContribitions||(this._groupRenderContribitions=this.groupRenderContribitions.getContributions()||[],this._groupRenderContribitions.push(Eh));const R={doFill:S,doStroke:A};this._groupRenderContribitions.forEach((n=>{n.time===Ri.beforeFillStroke&&n.drawShape(t,e,i,r,S,A,x,_,l,o,s,a,R)})),f&&e.clip(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),R.doFill&&(s?s(e,t.attribute,l):x&&(e.setCommonStyle(t,t.attribute,i,r,l),e.fill())),R.doStroke&&(a?a(e,t.attribute,l):_&&(e.setStrokeStyle(t,t.attribute,i,r,l),e.stroke())),this._groupRenderContribitions.forEach((n=>{n.time===Ri.afterFillStroke&&n.drawShape(t,e,i,r,S,A,x,_,l,o,s,a)}))}draw(t,e,i,r){const{context:o}=i;if(!o)return;const{clip:n}=t.attribute;n?o.save():o.highPerformanceSave();const s=yo(t,null==r?void 0:r.theme).group,a=o.modelMatrix;if(o.camera){const e=th.allocate(),i=th.allocate();ah(i,t,s),sh(e,a||e,i),o.modelMatrix=e,th.free(i),o.setTransform(1,0,0,1,0,0,!0)}else o.transformFromMatrix(t.transMatrix,!0);o.beginPath(),r.skipDraw?this.drawShape(t,o,0,0,i,r,(()=>!1),(()=>!1)):this.drawShape(t,o,0,0,i);const{scrollX:l=s.scrollX,scrollY:h=s.scrollY}=t.attribute;let c;(l||h)&&o.translate(l,h),r&&r.drawingCb&&(c=r.drawingCb()),o.modelMatrix!==a&&th.free(o.modelMatrix),o.modelMatrix=a,c&&c.then?c.then((()=>{n?o.restore():o.highPerformanceRestore()})):n?o.restore():o.highPerformanceRestore()}};du=lu([f(),cu(0,g(H)),cu(0,m(Os)),hu("design:paramtypes",[Object])],du);var uu=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let gu=class extends ic{constructor(){super(...arguments),this.numberType=Yn}drawShape(t,e,i,r,o,n,s,a){if(t.incremental&&o.multiGraphicOptions){const{startAtIdx:e,length:n}=o.multiGraphicOptions,{segments:l=[]}=t.attribute;if(e>l.length)return;const h=yo(t).line,{fill:c=h.fill,stroke:d=h.stroke,opacity:u=h.opacity,fillOpacity:g=h.fillOpacity,strokeOpacity:p=h.strokeOpacity,lineWidth:f=h.lineWidth,visible:m=h.visible}=t.attribute,b=As(u,g,c),y=Bs(u,p),C=_s(c),w=Ss(d,f);if(!t.valid||!m)return;if(!C&&!w)return;if(!(b||y||s||a))return;const{context:v}=o;for(let o=e;o<e+n;o++)this.drawIncreaseSegment(t,v,l[o-1],l[o],t.attribute.segments[o],[h,t.attribute],i,r)}else super.drawShape(t,e,i,r,o,n,s,a)}drawIncreaseSegment(t,e,i,r,o,n,s,a){r&&(e.beginPath(),function(t,e,i,r){const{offsetX:o=0,offsetY:n=0}=r||{},s=e?e.points[e.points.length-1]:i.points[0];t.moveTo(s.x+o,s.y+n),i.points.forEach((e=>{!1!==e.defined?t.lineTo(e.x+o,e.y+n):t.moveTo(e.x+o,e.y+n)}))}(e.nativeContext,i,r,{offsetX:s,offsetY:a}),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,o,n),e.setStrokeStyle(t,o,s,a,n),e.stroke())}};gu=uu([f()],gu);var pu=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let fu=class extends dc{constructor(){super(...arguments),this.numberType=Vn}drawShape(t,e,i,r,o,n,s){if(t.incremental&&o.multiGraphicOptions){const{startAtIdx:n,length:a}=o.multiGraphicOptions,{segments:l=[]}=t.attribute;if(n>l.length)return;const h=yo(t).area,{fill:c=h.fill,fillOpacity:d=h.fillOpacity,opacity:u=h.opacity,visible:g=h.visible}=t.attribute,p=As(u,d,c),f=_s(c);if(!t.valid||!g)return;if(!f)return;if(!p&&!s)return;for(let o=n;o<n+a;o++)this.drawIncreaseSegment(t,e,l[o-1],l[o],t.attribute.segments[o],[h,t.attribute],i,r)}else super.drawShape(t,e,i,r,o,n,s)}drawIncreaseSegment(t,e,i,r,o,n,s,a){r&&(e.beginPath(),function(t,e,i,r){const{offsetX:o=0,offsetY:n=0}=r||{},{points:s}=i,a=[];for(let t=0;t<s.length;t++)s[t].defined;a.push(s),a.forEach(((i,r)=>{var s,a,l,h;const c=e&&0===r?e.points[e.points.length-1]:i[0];t.moveTo(c.x+o,c.y+n),i.forEach((e=>{!1!==e.defined?t.lineTo(e.x+o,e.y+n):t.moveTo(e.x+o,e.y+n)}));for(let e=i.length-1;e>=0;e--){const r=i[e];t.lineTo(null!==(s=r.x1)&&void 0!==s?s:r.x,null!==(a=r.y1)&&void 0!==a?a:r.y)}t.lineTo(null!==(l=c.x1)&&void 0!==l?l:c.x,null!==(h=c.y1)&&void 0!==h?h:c.y),t.closePath()}))}(e.camera?e:e.nativeContext,i,r,{offsetX:s,offsetY:a}),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,o,n),e.setCommonStyle(t,o,s,a,n),e.fill())}};fu=pu([f()],fu);var mu,bu=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},yu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Cu=function(t,e){return function(i,r){e(i,r,t)}},wu=function(t,e,i,r){return new(i||(i=Promise))((function(o,n){function s(t){try{l(r.next(t))}catch(t){n(t)}}function a(t){try{l(r.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((r=r.apply(t,e||[])).next())}))};!function(t){t[t.NORMAL=0]="NORMAL",t[t.STOP=1]="STOP"}(mu||(mu={}));let vu=class extends au{constructor(t,e,i,r){super(t,r),this.contributions=t,this.lineRender=e,this.areaRender=i,this.drawItemInterceptorContributions=r,this.rendering=!1,this.currFrameStartAt=0,this.currentIdx=0,this.status=mu.NORMAL,this.checkingForDrawPromise=null,this.hooks={completeDraw:new F([])},this.defaultRenderMap.set(this.lineRender.numberType,this.lineRender),this.defaultRenderMap.set(this.areaRender.numberType,this.areaRender)}draw(t,e){return wu(this,void 0,void 0,(function*(){if(this.checkingForDrawPromise)return;this.lastRenderService=t,this.lastDrawContext=e,this.checkingForDrawPromise=this.checkForDraw(e);const i=yield this.checkingForDrawPromise;if(this.checkingForDrawPromise=null,i)return;this.currentRenderService=t;const{context:r,viewBox:o}=e;r&&(r.inuse=!0,r.clearMatrix(),r.setTransformForCurrent(!0),r.save(),e.restartIncremental&&this.clearScreen(this.currentRenderService,r,e),r.translate(o.x1,o.y1,!0),r.save(),t.renderTreeRoots.sort(((t,e)=>{var i,r;return(null!==(i=t.attribute.zIndex)&&void 0!==i?i:br.zIndex)-(null!==(r=e.attribute.zIndex)&&void 0!==r?r:br.zIndex)})).forEach((t=>{this.renderGroup(t,e)})),this.hooks.completeDraw.tap("top-draw",(()=>{r.restore(),r.restore(),r.draw(),r.inuse=!1,this.rendering=!1})))}))}_increaseRender(t,e){return wu(this,void 0,void 0,(function*(){this.rendering=!0,yield this._renderIncrementalGroup(t,e)}))}_renderIncrementalGroup(t,e){return wu(this,void 0,void 0,(function*(){this.count=t.count,yield new Promise((i=>{this.renderItem(t,e,{drawingCb:()=>wu(this,void 0,void 0,(function*(){if(2!==t.count)yield iu(t,br.zIndex,((i,r)=>{if(this.status===mu.STOP)return!0;if(i.isContainer)return!1;if(r<this.currentIdx)return!1;const o=this.currFrameStartAt+t.incremental;return r<o&&(this.currentIdx=r+1,this.renderItem(i,e)),r===o-1&&(this.currFrameStartAt=this.currentIdx,this.waitToNextFrame())})),i(!1);else{const r=t.getChildAt(0);if(r.incremental&&r.attribute.segments)for(r.incrementalAt||(r.incrementalAt=0);r.incrementalAt<r.attribute.segments.length;)e.multiGraphicOptions={startAtIdx:r.incrementalAt,length:r.incremental},this.renderItem(r,e),r.incrementalAt+=r.incremental,yield this.waitToNextFrame();else this.renderItem(r,e);i(!1)}}))})})),this.hooks.completeDraw.call()}))}waitToNextFrame(){return wu(this,void 0,void 0,(function*(){return new Promise((t=>{this.global.getRequestAnimationFrame()((()=>{t(!1)}))}))}))}checkForDraw(t){return wu(this,void 0,void 0,(function*(){let e=this.rendering;return t.restartIncremental&&(e=!1,yield this.forceStop(),this.resetToInit()),e}))}forceStop(){return wu(this,void 0,void 0,(function*(){this.rendering&&(this.status=mu.STOP,yield new Promise((t=>{this.hooks.completeDraw.tap("stopCb",(()=>{this.status=mu.NORMAL,this.hooks.completeDraw.taps=this.hooks.completeDraw.taps.filter((t=>"stopCb"!==t.name)),t(!1)}))})))}))}resetToInit(){this.currFrameStartAt=0,this.currentIdx=0}renderGroup(t,e){return wu(this,void 0,void 0,(function*(){if(!e.break&&!1!==t.attribute.visibleAll)return t.incremental&&e.startAtId===t._uid?(yield this._increaseRender(t,e),void(e.break=!0)):void(yield new Promise((i=>{this.renderItem(t,e,{drawingCb:()=>wu(this,void 0,void 0,(function*(){yield iu(t,br.zIndex,(t=>wu(this,void 0,void 0,(function*(){e.break||t.isContainer&&(yield this.renderGroup(t,e))})))),i(!1)}))})})))}))}};vu=bu([f(),Cu(0,p(Zc)),Cu(1,g(gu)),Cu(2,g(fu)),Cu(3,g(H)),Cu(3,m(gd)),yu("design:paramtypes",[Array,Object,Object,Object])],vu);var xu=new i((t=>{t(vh).toSelf().inSingletonScope(),t(Sh).toSelf().inSingletonScope(),t(cd).to(au),t(Kc).to(vu),t(Jc).to(du).inSingletonScope(),t(Zc).toService(Jc),k(t,Os),t(_h).toSelf().inSingletonScope(),k(t,Us),k(t,Zc),t(bd).toSelf().inSingletonScope(),t(gd).toService(bd),k(t,gd)}));function _u(){_u.__loaded||(_u.__loaded=!0,Xr.load(xs),Xr.load(Ld),Xr.load(Ad),Xr.load(kd),Xr.load(Nd),function(t){t.load(Gd),t.load(jd),t.load(Qd)}(Xr),function(t){t.load(xu)}(Xr))}_u.__loaded=!1,_u();const Su=Xr.get(z);kr.global=Su;const Au=Xr.get(gs);kr.graphicUtil=Au;const Ru=Xr.get(us);kr.transformUtil=Ru;const Bu=Xr.get(os);kr.graphicService=Bu;const Mu=Xr.get(ps);kr.layerService=Mu;class Tu{constructor(){this.name="AutoRenderPlugin",this.activeEvent="onRegister",this._uid=e.GenAutoIncrementId(),this.key=this.name+this._uid}activate(t){this.pluginService=t,kr.graphicService.hooks.onAttributeUpdate.tap(this.key,(e=>{e.glyphHost&&(e=e.glyphHost),e.stage===t.stage&&null!=e.stage&&e.stage.renderNextFrame()})),kr.graphicService.hooks.onSetStage.tap(this.key,(e=>{e.glyphHost&&(e=e.glyphHost),e.stage===t.stage&&null!=e.stage&&e.stage.renderNextFrame()}))}deactivate(t){kr.graphicService.hooks.onAttributeUpdate.taps=kr.graphicService.hooks.onAttributeUpdate.taps.filter((t=>t.name!==this.key)),kr.graphicService.hooks.onSetStage.taps=kr.graphicService.hooks.onSetStage.taps.filter((t=>t.name!==this.key))}}class Pu{constructor(){this.name="ViewTransform3dPlugin",this.activeEvent="onRegister",this._uid=e.GenAutoIncrementId(),this.key=this.name+this._uid,this.onMouseDown=t=>{this.option3d||(this.option3d=this.pluginService.stage.option3d),this.option3d&&(this.mousedown=!0,this.pageX=t.page.x,this.pageY=t.page.y)},this.onMouseUp=t=>{this.option3d||(this.option3d=this.pluginService.stage.option3d),this.option3d&&(this.mousedown=!1)},this.onMouseMove=t=>{var e,i;const r=this.pluginService.stage;if(this.option3d||(this.option3d=r.option3d),this.option3d&&this.mousedown)if(this.pageX&&this.pageY){const o=t.page.x-this.pageX,n=t.page.y-this.pageY;this.pageX=t.page.x,this.pageY=t.page.y;const s=o/100,a=n/100;this.option3d.alpha=(null!==(e=this.option3d.alpha)&&void 0!==e?e:0)+s,this.option3d.beta=(null!==(i=this.option3d.beta)&&void 0!==i?i:0)+a,r.set3dOptions(this.option3d),r.renderNextFrame()}else this.pageX=t.page.x,this.pageY=t.page.y}}activate(t){this.pluginService=t;const e=t.stage;this.option3d=e.option3d,e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("mouseup",this.onMouseUp),e.addEventListener("mousemove",this.onMouseMove)}deactivate(t){const e=t.stage;e.removeEventListener("mousedown",this.onMouseDown),e.removeEventListener("mouseup",this.onMouseUp),e.removeEventListener("mousemove",this.onMouseMove)}}class Hu{constructor(){this.name="IncrementalAutoRenderPlugin",this.activeEvent="onRegister",this.nextFrameRenderGroupSet=new Set,this.willNextFrameRender=!1,this.nextUserParams={},this._uid=e.GenAutoIncrementId(),this.key=this.name+this._uid}activate(t){this.pluginService=t,kr.graphicService.hooks.onAddIncremental.tap(this.key,((e,i,r)=>{e.glyphHost&&(e=e.glyphHost),e.stage===t.stage&&null!=e.stage&&(this.nextUserParams.startAtId=i._uid,this.renderNextFrame(i))})),kr.graphicService.hooks.onClearIncremental.tap(this.key,((e,i)=>{e.stage===t.stage&&null!=e.stage&&(this.nextUserParams.startAtId=e._uid,this.nextUserParams.restartIncremental=!0,this.renderNextFrame(e))}))}deactivate(t){kr.graphicService.hooks.onAddIncremental.taps=kr.graphicService.hooks.onAddIncremental.taps.filter((t=>t.name!==this.key)),kr.graphicService.hooks.onClearIncremental.taps=kr.graphicService.hooks.onClearIncremental.taps.filter((t=>t.name!==this.key))}renderNextFrame(t){this.nextFrameRenderGroupSet.add(t),this.willNextFrameRender||(this.willNextFrameRender=!0,kr.global.getRequestAnimationFrame()((()=>{this._doRenderInThisFrame(),this.willNextFrameRender=!1})))}_doRenderInThisFrame(){const t=this.pluginService.stage;this.nextFrameRenderGroupSet.size&&(this.nextFrameRenderGroupSet.forEach((e=>{const i=e.layer;if(!i||!e.layer.subLayers)return;const r=e.layer.subLayers.get(e._uid);r&&r.drawContribution&&r.drawContribution.draw(t.renderService,Object.assign({stage:t,layer:i,viewBox:t.window.getViewBox(),transMatrix:t.window.getViewBoxTransform(),clear:"transparent",renderService:t.renderService,updateBounds:!1,startAtId:e._uid,context:r.layer.getNativeHandler().getContext()},this.nextUserParams))})),this.nextUserParams={},this.nextFrameRenderGroupSet.clear())}}class Eu{constructor(){this.name="HtmlAttributePlugin",this.activeEvent="onRegister",this._uid=e.GenAutoIncrementId(),this.key=this.name+this._uid,this.lastDomContainerSet=new Set,this.currentDomContainerSet=new Set}activate(t){this.pluginService=t,t.stage.hooks.afterRender.tap(this.key,(e=>{e&&e===this.pluginService.stage&&this.drawHTML(t.stage.renderService)})),kr.graphicService.hooks.onRemove.tap(this.key,(t=>{this.removeDom(t)})),kr.graphicService.hooks.onRelease.tap(this.key,(t=>{this.removeDom(t)}))}deactivate(t){t.stage.hooks.afterRender.taps=t.stage.hooks.afterRender.taps.filter((t=>t.name!==this.key)),kr.graphicService.hooks.onRemove.unTap(this.key),kr.graphicService.hooks.onRelease.unTap(this.key),this.release()}drawHTML(t){"browser"===kr.global.env&&(t.renderTreeRoots.sort(((t,e)=>{var i,r;return(null!==(i=t.attribute.zIndex)&&void 0!==i?i:br.zIndex)-(null!==(r=e.attribute.zIndex)&&void 0!==r?r:br.zIndex)})).forEach((t=>{this.renderGroupHTML(t)})),this.lastDomContainerSet.forEach((t=>{this.currentDomContainerSet.has(t)||t.parentElement&&t.parentElement.removeChild(t)})),this.lastDomContainerSet=new Set(this.currentDomContainerSet),this.currentDomContainerSet.clear())}renderGroupHTML(t){this.renderGraphicHTML(t),t.forEachChildren((t=>{t.isContainer?this.renderGroupHTML(t):this.renderGraphicHTML(t)}))}removeDom(t){t.bindDom&&t.bindDom.size&&(t.bindDom.forEach((t=>{t.dom&&t.dom.parentElement.removeChild(t.dom)})),t.bindDom.clear())}renderGraphicHTML(t){const{html:e}=t.attribute;if(!e)return void(t.bindDom&&t.bindDom.size&&(t.bindDom.forEach((t=>{t.dom&&t.dom.parentElement.removeChild(t.dom)})),t.bindDom.clear()));const i=t.stage;if(!i)return;const{dom:r,container:o,width:n,height:s,style:a,anchorType:l="boundsLeftTop",pointerEvents:h}=e;t.bindDom||(t.bindDom=new Map);const c=t.bindDom.get(r);let d,u;if(!c||o&&o!==c.container){let e;t.bindDom.forEach((t=>{let{wrapGroup:e}=t;kr.global.removeDom(e)})),"string"==typeof r?(e=(new DOMParser).parseFromString(r,"text/html").firstChild,e.lastChild&&(e=e.lastChild.firstChild)):e=r;const l=o||(!0===i.params.enableHtmlAttribute?null:i.params.enableHtmlAttribute);u=l?"string"==typeof l?kr.global.getElementById(l):l:t.stage.window.getContainer(),d=kr.global.createDom({tagName:"div",width:n,height:s,style:a,parent:u}),d&&(d.appendChild(e),t.bindDom.set(r,{dom:e,container:o,wrapGroup:d}))}else d=c.wrapGroup,u=d.parentNode;d.style.pointerEvents=h||"none",d.style.position||(d.style.position="absolute",u.style.position="relative");let g=0,p=0;const f=t.globalAABBBounds;if("position"===l||f.empty()){const e=t.globalTransMatrix;g=e.e,p=e.f}else g=f.x1,p=f.y1;const m=kr.global.getElementTopLeft(u,!1),b=i.window.getTopLeft(!1),y=g+b.left-m.left,C=p+b.top-m.top;d.style.left=`${y}px`,d.style.top=`${C}px`,this.currentDomContainerSet.add(d)}release(){"browser"===kr.global.env&&(this.removeAllDom(this.pluginService.stage.defaultLayer),this.lastDomContainerSet.clear(),this.currentDomContainerSet.clear())}removeAllDom(t){this.removeDom(t),t.forEachChildren((e=>{e.isContainer&&this.removeAllDom(t)}))}}const ku=new ue;class Lu{constructor(){this.name="DirtyBoundsPlugin",this.activeEvent="onRegister",this._uid=e.GenAutoIncrementId(),this.key=this.name+this._uid}activate(t){this.pluginService=t,t.stage.hooks.afterRender.tap(this.key,(t=>{t&&t===this.pluginService.stage&&t.dirtyBounds.clear()})),kr.graphicService.hooks.beforeUpdateAABBBounds.tap(this.key,((t,e,i,r)=>{t.glyphHost&&(t=t.glyphHost),e&&e===this.pluginService.stage&&e.renderCount&&(t.isContainer&&!t.shouldSelfChangeUpdateAABBBounds()||i&&(ku.setValue(r.x1,r.y1,r.x2,r.y2),e.dirty(ku,t.parent&&t.parent.globalTransMatrix)))})),kr.graphicService.hooks.afterUpdateAABBBounds.tap(this.key,((t,e,i,r,o)=>{e&&e===this.pluginService.stage&&e.renderCount&&(t.isContainer&&!o||e.dirty(r.globalAABBBounds))})),kr.graphicService.hooks.onRemove.tap(this.key,(t=>{const e=t.stage;e&&e===this.pluginService.stage&&e.renderCount&&e&&e.dirty(t.globalAABBBounds)}))}deactivate(t){kr.graphicService.hooks.beforeUpdateAABBBounds.taps=kr.graphicService.hooks.beforeUpdateAABBBounds.taps.filter((t=>t.name!==this.key)),kr.graphicService.hooks.afterUpdateAABBBounds.taps=kr.graphicService.hooks.afterUpdateAABBBounds.taps.filter((t=>t.name!==this.key)),t.stage.hooks.afterRender.taps=t.stage.hooks.afterRender.taps.filter((t=>t.name!==this.key)),kr.graphicService.hooks.onRemove.taps=kr.graphicService.hooks.onRemove.taps.filter((t=>t.name!==this.key))}}const Fu=new ue;class Iu{constructor(){this.name="FlexLayoutPlugin",this.activeEvent="onRegister",this.id=e.GenAutoIncrementId(),this.key=this.name+this.id,this.tempBounds=new ue}pauseLayout(t){this.pause=t}tryLayoutChildren(t){t.firstChild&&this.tryLayout(t.firstChild)}tryLayout(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.pause)return;const i=t.parent;if(!(e||i&&t.needUpdateLayout()))return;const r=yo(i).group,{display:o=r.display}=i.attribute;if("flex"!==o)return;const{flexDirection:n=r.flexDirection,flexWrap:s=r.flexWrap,alignItems:a=r.alignItems,clip:l=r.clip}=i.attribute,{alignContent:h=(null!=a?a:r.alignContent)}=i.attribute;let{width:c,height:d,justifyContent:u=r.justifyContent}=i.attribute;const g=i.getChildren();if(null==c||null==d){let t=0,e=0,i=0;if(g.forEach((r=>{const o=this.getAABBBounds(r);o.empty()||("column"===n||"column-reverse"===n?(e+=o.height(),t=Math.max(t,o.width())):(t+=o.width(),e=Math.max(e,o.height())),i+=o.x1,i+=o.y1,i+=o.x2,i+=o.y2)})),!isFinite(i))return;c=t,d=e}null==i.attribute.width?i.attribute.width=c:c=i.attribute.width,null==i.attribute.height?i.attribute.height=d:d=i.attribute.height,this.tempBounds.copy(i._AABBBounds);const p={main:{len:c,field:"x"},cross:{len:d,field:"y"}},f=p.main,m=p.cross;"column"!==n&&"column-reverse"!==n||(f.len=d,m.len=c,f.field="y",m.field="x"),"row-reverse"!==n&&"column-reverse"!==n||("flex-start"===u?u="flex-end":"flex-end"===u?u="flex-start":g.reverse());let b=0,y=0;const C=[];g.forEach((t=>{const e=this.getAABBBounds(t);if(e.empty())return;const i="x"===f.field?e.width():e.height(),r="x"===m.field?e.width():e.height();C.push({mainLen:i,crossLen:r}),b+=i,y=Math.max(y,r)}));const w=[];if(b>f.len&&"wrap"===s){let t=0,e=0;C.forEach(((i,r)=>{let{mainLen:o,crossLen:n}=i;t+o>f.len?0===t?(w.push({idx:r,mainLen:t+o,crossLen:n}),t=0,e=0):(w.push({idx:r-1,mainLen:t,crossLen:e}),t=o,e=n):(t+=o,e=Math.max(e,n))})),w.push({idx:C.length-1,mainLen:t,crossLen:e})}else w.push({idx:C.length-1,mainLen:b,crossLen:y});let v=0;if(w.forEach((t=>{this.layoutMain(i,g,u,f,C,v,t),v=t.idx+1})),y=w.reduce(((t,e)=>t+e.crossLen),0),1===w.length){const t={"flex-start":0,"flex-end":m.len,center:m.len/2};this.layoutCross(g,a,m,t,C,w[0],0)}else if("flex-start"===h){v=0;let t=0;w.forEach(((e,i)=>{const r={"flex-start":t,"flex-end":t+e.crossLen,center:t+e.crossLen/2};this.layoutCross(g,"flex-start",m,r,C,w[i],v),v=e.idx+1,t+=e.crossLen}))}else if("center"===h){v=0;let t=Math.max(0,(m.len-y)/2);w.forEach(((e,i)=>{const r={"flex-start":t,"flex-end":t+e.crossLen,center:t+e.crossLen/2};this.layoutCross(g,"center",m,r,C,w[i],v),v=e.idx+1,t+=e.crossLen}))}else if("space-around"===h){v=0;const t=Math.max(0,(m.len-y)/w.length/2);let e=t;w.forEach(((i,r)=>{const o={"flex-start":e,"flex-end":e+i.crossLen,center:e+i.crossLen/2};this.layoutCross(g,"flex-start",m,o,C,w[r],v),v=i.idx+1,e+=i.crossLen+2*t}))}else if("space-between"===h){v=0;const t=Math.max(0,(m.len-y)/(2*w.length-2));let e=0;w.forEach(((i,r)=>{const o={"flex-start":e,"flex-end":e+i.crossLen,center:e+i.crossLen/2};this.layoutCross(g,"flex-start",m,o,C,w[r],v),v=i.idx+1,e+=i.crossLen+2*t}))}g.forEach(((t,e)=>{t.addUpdateBoundTag(),t.addUpdatePositionTag(),t.clearUpdateLayoutTag()})),i.addUpdateLayoutTag();const x=this.getAABBBounds(i);l||this.tempBounds.equals(x)||this.tryLayout(i,!1)}getAABBBounds(t){this.skipBoundsTrigger=!0;const e=t.AABBBounds;return this.skipBoundsTrigger=!1,e}updateChildPos(t,e,i){return t+(null!=e?e:0)-i}layoutMain(t,e,i,r,o,n,s){if("flex-start"===i){let t=0;for(let i=n;i<=s.idx;i++){const n=t+(e[i],r.field,0),s=this.getAABBBounds(e[i]);!s.empty()&&(e[i].attribute[r.field]=this.updateChildPos(n,e[i].attribute[r.field],s[`${r.field}1`])),t+=o[i].mainLen}}else if("flex-end"===i){let t=r.len;for(let i=n;i<=s.idx;i++){t-=o[i].mainLen;const n=t+(e[i],r.field,0),s=this.getAABBBounds(e[i]);!s.empty()&&(e[i].attribute[r.field]=this.updateChildPos(n,e[i].attribute[r.field],s[`${r.field}1`]))}}else if("space-around"===i)if(s.mainLen>=r.len){let t=0;for(let i=n;i<=s.idx;i++){const n=t+(e[i],r.field,0),s=this.getAABBBounds(e[i]);!s.empty()&&(e[i].attribute[r.field]=this.updateChildPos(n,e[i].attribute[r.field],s[`${r.field}1`])),t+=o[i].mainLen}}else{const t=s.idx-n+1,i=(r.len-s.mainLen)/t/2;let a=i;for(let t=n;t<=s.idx;t++){const n=a+(e[t],r.field,0),s=this.getAABBBounds(e[t]);!s.empty()&&(e[t].attribute[r.field]=this.updateChildPos(n,e[t].attribute[r.field],s[`${r.field}1`])),a+=o[t].mainLen+2*i}}else if("space-between"===i)if(s.mainLen>=r.len){let t=0;for(let i=n;i<=s.idx;i++){const n=t+(e[i],r.field,0),s=this.getAABBBounds(e[i]);!s.empty()&&(e[i].attribute[r.field]=this.updateChildPos(n,e[i].attribute[r.field],s[`${r.field}1`])),t+=o[i].mainLen}}else{const t=s.idx-n+1,i=(r.len-s.mainLen)/(2*t-2);let a=0;for(let t=n;t<=s.idx;t++){const n=a+(e[t],r.field,0),s=this.getAABBBounds(e[t]);!s.empty()&&(e[t].attribute[r.field]=this.updateChildPos(n,e[t].attribute[r.field],s[`${r.field}1`])),a+=o[t].mainLen+2*i}}else if("center"===i){let t=(r.len-s.mainLen)/2;for(let i=n;i<=s.idx;i++){const n=t+(e[i],r.field,0),s=this.getAABBBounds(e[i]);!s.empty()&&(e[i].attribute[r.field]=this.updateChildPos(n,e[i].attribute[r.field],s[`${r.field}1`])),t+=o[i].mainLen}}}layoutCross(t,e,i,r,o,n,s){var a;for(let l=s;l<=n.idx;l++){const n=t[l];let{alignSelf:s}=n.attribute;s&&"auto"!==s||(s=e);const h=this.getAABBBounds(n),c=null!==(a=r[s])&&void 0!==a?a:r["flex-start"];"flex-end"===s?!h.empty()&&(n.attribute[i.field]=this.updateChildPos(c-o[l].crossLen+(i.field,0),n.attribute[i.field],h[`${i.field}1`])):"center"===s?!h.empty()&&(n.attribute[i.field]=this.updateChildPos(c-o[l].crossLen/2+(i.field,0),n.attribute[i.field],h[`${i.field}1`])):!h.empty()&&(n.attribute[i.field]=this.updateChildPos(c+(i.field,0),n.attribute[i.field],h[`${i.field}1`]))}}activate(t){this.pluginService=t,kr.graphicService.hooks.onAttributeUpdate.tap(this.key,(t=>{t.glyphHost&&(t=t.glyphHost),t.stage&&t.stage===this.pluginService.stage&&this.tryLayout(t,!1)})),kr.graphicService.hooks.beforeUpdateAABBBounds.tap(this.key,((t,e,i,r)=>{t.glyphHost&&(t=t.glyphHost),e&&e===this.pluginService.stage&&t.isContainer&&!this.skipBoundsTrigger&&Fu.copy(r)})),kr.graphicService.hooks.afterUpdateAABBBounds.tap(this.key,((t,e,i,r,o)=>{e&&e===this.pluginService.stage&&t.isContainer&&!this.skipBoundsTrigger&&(Fu.equals(i)||this.tryLayout(t,!1))})),kr.graphicService.hooks.onSetStage.tap(this.key,(t=>{t.glyphHost&&(t=t.glyphHost),this.tryLayout(t,!1)}))}deactivate(t){kr.graphicService.hooks.onAttributeUpdate.taps=kr.graphicService.hooks.onAttributeUpdate.taps.filter((t=>t.name!==this.key)),kr.graphicService.hooks.beforeUpdateAABBBounds.taps=kr.graphicService.hooks.beforeUpdateAABBBounds.taps.filter((t=>t.name!==this.key)),kr.graphicService.hooks.afterUpdateAABBBounds.taps=kr.graphicService.hooks.afterUpdateAABBBounds.taps.filter((t=>t.name!==this.key)),kr.graphicService.hooks.onSetStage.taps=kr.graphicService.hooks.onSetStage.taps.filter((t=>t.name!==this.key))}}const zu=new class{set mode(t){this._mode!==t&&(this._mode=t,this.setupTickHandler())}get mode(){return this._mode}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.handleTick=(t,e)=>{const{once:i=!1}=null!=e?e:{};this.ifCanStop()?this.stop():(this._handlerTick(t),i||t.tick(this.interval,this.handleTick))},this._handlerTick=t=>{const e=this.tickerHandler.getTime();let i=0;this.lastFrameTime>=0&&(i=e-this.lastFrameTime),this.lastFrameTime=e,this.status===Lo.RUNNING&&(this.tickCounts++,this.timelines.forEach((t=>{t.tick(i)})))},this.init(),this.lastFrameTime=-1,this.tickCounts=0,this.timelines=t,this.autoStop=!0}init(){this.interval=NaN,this.status=Lo.INITIAL,kr.global.hooks.onSetEnv.tap("default-ticker",(()=>{this.initHandler()})),kr.global.env&&this.initHandler()}addTimeline(t){this.timelines.push(t)}remTimeline(t){this.timelines=this.timelines.filter((e=>e!==t))}initHandler(){if(this._mode)return null;const t=[{mode:"raf",cons:ko},{mode:"timeout",cons:Eo},{mode:"manual",cons:Ho}];for(let e=0;e<t.length;e++)if(t[e].cons.Avaliable()){this.mode=t[e].mode;break}return null}setupTickHandler(){let t;switch(this._mode){case"raf":t=new ko;break;case"timeout":t=new Eo;break;case"manual":t=new Ho;break;default:qe.getInstance().warn("非法的计时器模式"),t=new ko}return!!t.avaliable()&&(this.tickerHandler&&this.tickerHandler.release(),this.tickerHandler=t,!0)}setInterval(t){this.interval=t}getInterval(){return this.interval}setFPS(t){this.setInterval(1e3/t)}getFPS(){return 1e3/this.interval}tick(t){this.tickerHandler.tick(t,(t=>{this.handleTick(t,{once:!0})}))}tickTo(t){this.tickerHandler.tickTo&&this.tickerHandler.tickTo(t,(t=>{this.handleTick(t,{once:!0})}))}pause(){return this.status!==Lo.INITIAL&&(this.status=Lo.PAUSE,!0)}resume(){return this.status!==Lo.INITIAL&&(this.status=Lo.RUNNING,!0)}ifCanStop(){if(this.autoStop){if(!this.timelines.length)return!0;if(0===this.timelines.reduce(((t,e)=>t+e.animateCount),0))return!0}return!1}start(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.status===Lo.RUNNING)return!1;if(!this.tickerHandler)return!1;if(!t){if(this.status===Lo.PAUSE)return!1;if(!this.timelines.length)return!1;if(0===this.timelines.reduce(((t,e)=>t+e.animateCount),0))return!1}return this.status=Lo.RUNNING,this.tickerHandler.tick(0,this.handleTick),!0}stop(){this.status=Lo.INITIAL,this.setupTickHandler(),this.lastFrameTime=-1}};zu.addTimeline(zo),zu.setFPS(60);class Ou{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8;this.dir=t,this.color=e,this.colorRgb=sn.Get(e,nn.Color1),this.ambient=i;const r=re(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this.formatedDir=[t[0]/r,t[1]/r,t[2]/r]}computeColor(t,e){const i=this.formatedDir,r=ee(te((t[0]*i[0]+t[1]*i[1]+t[2]*i[2])*(1-this.ambient/2),0)+this.ambient,1);let o;o=tt(e)?sn.Get(e,nn.Color1):e;const n=this.colorRgb;return`rgb(${n[0]*o[0]*r}, ${n[1]*o[1]*r}, ${n[2]*o[2]*r})`}}function Du(t,e,i){const r=e[0],o=e[1],n=e[2],s=e[3],a=e[4],l=e[5],h=e[6],c=e[7],d=e[8],u=e[9],g=e[10],p=e[11],f=e[12],m=e[13],b=e[14],y=e[15];let C=i[0],w=i[1],v=i[2],x=i[3];return t[0]=C*r+w*a+v*d+x*f,t[1]=C*o+w*l+v*u+x*m,t[2]=C*n+w*h+v*g+x*b,t[3]=C*s+w*c+v*p+x*y,C=i[4],w=i[5],v=i[6],x=i[7],t[4]=C*r+w*a+v*d+x*f,t[5]=C*o+w*l+v*u+x*m,t[6]=C*n+w*h+v*g+x*b,t[7]=C*s+w*c+v*p+x*y,C=i[8],w=i[9],v=i[10],x=i[11],t[8]=C*r+w*a+v*d+x*f,t[9]=C*o+w*l+v*u+x*m,t[10]=C*n+w*h+v*g+x*b,t[11]=C*s+w*c+v*p+x*y,C=i[12],w=i[13],v=i[14],x=i[15],t[12]=C*r+w*a+v*d+x*f,t[13]=C*o+w*l+v*u+x*m,t[14]=C*n+w*h+v*g+x*b,t[15]=C*s+w*c+v*p+x*y,t}function Wu(t,e,i){const r=e[0],o=e[1],n=e[2];let s=i[3]*r+i[7]*o+i[11]*n+i[15];return s=s||1,t[0]=(i[0]*r+i[4]*o+i[8]*n+i[12])/s,t[1]=(i[1]*r+i[5]*o+i[9]*n+i[13])/s,t[2]=(i[2]*r+i[6]*o+i[10]*n+i[14])/s,t}class Nu{set params(t){this._params=Object.assign({},t),this._projectionMatrixCached=this.forceGetProjectionMatrix(),this._viewMatrixCached=this.forceGetViewMatrix()}get params(){return Object.assign({},this._params)}constructor(t){this.params=t}getViewMatrix(){return this._viewMatrixCached||(this._viewMatrixCached=th.allocate()),this._viewMatrixCached}forceGetViewMatrix(){this._viewMatrixCached||(this._viewMatrixCached=th.allocate());const{pos:t,center:e,up:i}=this.params.viewParams;return function(t,e,i,r){let o,n,s,a,l,h,c,d,u,g;const p=e[0],f=e[1],m=e[2],b=r[0],y=r[1],C=r[2],w=i[0],v=i[1],x=i[2];Math.abs(p-w)<Kt&&Math.abs(f-v)<Kt&&Math.abs(m-x)<Kt?Jl.identity(t):(c=p-w,d=f-v,u=m-x,g=1/Math.hypot(c,d,u),c*=g,d*=g,u*=g,o=y*u-C*d,n=C*c-b*u,s=b*d-y*c,g=Math.hypot(o,n,s),g?(g=1/g,o*=g,n*=g,s*=g):(o=0,n=0,s=0),a=d*s-u*n,l=u*o-c*s,h=c*n-d*o,g=Math.hypot(a,l,h),g?(g=1/g,a*=g,l*=g,h*=g):(a=0,l=0,h=0),t[0]=o,t[1]=a,t[2]=c,t[3]=0,t[4]=n,t[5]=l,t[6]=d,t[7]=0,t[8]=s,t[9]=h,t[10]=u,t[11]=0,t[12]=-(o*p+n*f+s*m),t[13]=-(a*p+l*f+h*m),t[14]=-(c*p+d*f+u*m),t[15]=1)}(this._viewMatrixCached,t,e,i),this._vp||(this._vp=th.allocate()),this._vp=Du(this._vp,this.getProjectionMatrix(),this.getViewMatrix()),this._viewMatrixCached}getProjectionMatrix(){return this._projectionMatrixCached||(this._projectionMatrixCached=th.allocate()),this._projectionMatrixCached}forceGetProjectionMatrix(){this._projectionMatrixCached||(this._projectionMatrixCached=th.allocate());const{left:t,top:e,right:i,bottom:r}=this._params;return function(t,e,i,r,o,n,s){const a=1/(e-i),l=1/(r-o),h=1/(n-s);t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+i)*a,t[13]=(o+r)*l,t[14]=(s+n)*h,t[15]=1}(this._projectionMatrixCached,t,i,r,e,0,-2e6),this._vp||(this._vp=th.allocate()),this._vp=Du(this._vp,this.getProjectionMatrix(),this.getViewMatrix()),this._projectionMatrixCached}getField(){const{fieldRatio:t=.8,fieldDepth:e,left:i,right:r}=this._params;return(null!=e?e:r-i)*t}getProjectionScale(t){const e=this.getField();return e/(e+t)}view(t,e,i){const r=[0,0,0];return Wu(r,[t,e,i],this._viewMatrixCached),r}vp(t,e,i){const r=[0,0,0],{pos:o}=this._params.viewParams;Wu(r,[t,e,i],this._viewMatrixCached),t=r[0],e=r[1],i=r[2];const n=this.getProjectionScale(i);return{x:t*n+o[0],y:e*n+o[1]}}}let Gu;function ju(){if(null==Gu)try{Gu=globalThis===window,Gu&&(Gu=!!document.createElement)}catch(t){Gu=!1}}function Vu(){ju();const t=kr.global&&kr.global.env;return t?"browser"===t:Gu}class Uu extends Eu{constructor(){super(...arguments),this.name="ReactAttributePlugin",this.activeEvent="onRegister",this._uid=e.GenAutoIncrementId(),this.key=this.name+this._uid}removeDom(t){t.bindDom&&t.bindDom.size&&(t.bindDom.forEach((t=>{t.root&&t.root.unmount()})),t.bindDom.clear())}renderGraphicHTML(t){const{react:e}=t.attribute;if(!e)return void(t.bindDom&&t.bindDom.size&&(t.bindDom.forEach((t=>{t.root&&t.root.unmount()})),t.bindDom.clear()));const i=t.stage;if(!i)return;const r=i.params.ReactDOM,{element:o,container:n,width:s,height:a,style:l,anchorType:h="boundsLeftTop",pointerEvents:c}=e;if(!(o&&r&&r.createRoot))return;t.bindDom||(t.bindDom=new Map);const d=t.bindDom.get(o);let u,g;if(!d||n&&n!==d.container){t.bindDom.forEach((t=>{let{wrapGroup:e}=t;kr.global.removeDom(e)}));const e=n;if(g=e?"string"==typeof e?kr.global.getElementById(e):e:t.stage.window.getContainer(),u=kr.global.createDom({tagName:"div",width:s,height:a,style:l,parent:g}),u){const e=r.createRoot(u);e.render(o),t.bindDom.set(o,{dom:o,container:n,wrapGroup:u,root:e})}}else u=d.wrapGroup,g=u.parentNode;u.style.pointerEvents=c||"none",u.style.position||(u.style.position="absolute",g.style.position="relative");let p=0,f=0;const m=t.globalAABBBounds;if("position"===h||m.empty()){const e=t.globalTransMatrix;p=e.e,f=e.f}else p=m.x1,f=m.y1;const b=kr.global.getElementTopLeft(g,!1),y=i.window.getTopLeft(!1),C=p+y.left-b.left,w=f+y.top-b.top;u.style.left=`${C}px`,u.style.top=`${w}px`}}const Ku="white";class $u extends hs{set viewBox(t){this.window.setViewBox(t)}get viewBox(){return this.window.getViewBox()}get x(){return this.window.getViewBox().x1}set x(t){const e=this.window.getViewBox();e.translate(t-e.x1,0),this.window.setViewBox(e)}get y(){return this.window.getViewBox().y1}set y(t){const e=this.window.getViewBox();e.translate(0,t-e.y1),this.window.setViewBox(e)}get width(){return this.window.width}set width(t){this.resize(t,this.height)}get viewWidth(){return this.window.getViewBox().width()}set viewWidth(t){this.resizeView(t,this.viewHeight)}get viewHeight(){return this.window.getViewBox().height()}set viewHeight(t){this.resizeView(this.viewWidth,t)}get height(){return this.window.height}set height(t){this.resize(this.width,t)}get dpr(){return this.window.dpr}set dpr(t){this.setDpr(t)}get background(){var t;return null!==(t=this._background)&&void 0!==t?t:Ku}set background(t){this._background=t}get defaultLayer(){return this.at(0)}get eventSystem(){return this._eventSystem}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var e;super({}),this._onVisibleChange=t=>{if(!(this._skipRender<0))if(t){if(this.dirtyBounds){const t=this.window.getViewBox();this.dirtyBounds.setValue(t.x1,t.y1,t.width(),t.height())}this._skipRender>1&&this.renderNextFrame(),this._skipRender=0}else this._skipRender=1},this.beforeRender=t=>{this._beforeRender&&this._beforeRender(t)},this.afterRender=t=>{this.renderCount++,this._afterRender&&this._afterRender(t),this._afterNextRenderCbs&&this._afterNextRenderCbs.forEach((e=>e(t))),this._afterNextRenderCbs=null},this.params=t,this.theme=new mo,this.hooks={beforeRender:new F(["stage"]),afterRender:new F(["stage"])},this.global=kr.global,!this.global.env&&Vu()&&this.global.setEnv("browser"),this.window=Xr.get(eo),this.renderService=Xr.get(_d),this.pluginService=Xr.get(Id),this.layerService=Xr.get(ps),this.pluginService.active(this,t),this.window.create({width:t.width,height:t.height,viewBox:t.viewBox,container:t.container,dpr:t.dpr||this.global.devicePixelRatio,canvasControled:!1!==t.canvasControled,title:t.title||"",canvas:t.canvas}),this.state="normal",this.renderCount=0,this.tryInitEventSystem(),this._background=null!==(e=t.background)&&void 0!==e?e:Ku,this.appendChild(this.layerService.createLayer(this,{main:!0})),this.nextFrameRenderLayerSet=new Set,this.willNextFrameRender=!1,this.stage=this,this.renderStyle=t.renderStyle,t.autoRender&&this.enableAutoRender(),!1===t.disableDirtyBounds&&this.enableDirtyBounds(),t.enableHtmlAttribute&&this.enableHtmlAttribute(t.enableHtmlAttribute),t.ReactDOM&&this.enableReactAttribute(t.ReactDOM),t.enableLayout&&this.enableLayout(),this.hooks.beforeRender.tap("constructor",this.beforeRender),this.hooks.afterRender.tap("constructor",this.afterRender),this._beforeRender=t.beforeRender,this._afterRender=t.afterRender,this.ticker=t.ticker||zu,this.supportInteractiveLayer=!1!==t.interactiveLayer,this.timeline=new Io,this.ticker.addTimeline(this.timeline),this.timeline.pause(),t.optimize||(t.optimize={}),this.optmize(t.optimize),t.background&&tt(this._background)&&this._background.includes("/")&&this.setAttributes({background:this._background})}pauseRender(){this._skipRender=-1}resumeRender(){this._skipRender=0}tryInitEventSystem(){this.global.supportEvent&&!this._eventSystem&&(this._eventSystem=new Po(Object.assign({targetElement:this.window,resolution:this.window.dpr||this.global.devicePixelRatio,rootNode:this,global:this.global,supportsPointerEvents:this.params.supportsPointerEvents,supportsTouchEvents:this.params.supportsTouchEvents},this.params.event)))}preventRender(t){t?this._skipRender=-1/0:!1!==this.params.optimize.skipRenderWithOutRange?this._skipRender=this.window.isVisible()?0:1:this._skipRender=0}optmize(t){this.optmizeRender(t.skipRenderWithOutRange),this.params.optimize=t}optmizeRender(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&(this._skipRender=this._skipRender<0?this._skipRender:this.window.isVisible()?0:1,this.window.onVisibleChange(this._onVisibleChange))}getTimeline(){return this.timeline}get3dOptions(t){const{center:e={x:this.width/2,y:this.height/2,z:0,dx:0,dy:0,dz:0},light:i={},alpha:r=0,beta:o=0,camera:n,fieldRatio:s=1,fieldDepth:a}=t;return Object.assign(Object.assign({},t),{center:e,light:i,alpha:r,beta:o,camera:n,fieldRatio:s,fieldDepth:a})}set3dOptions(t){var e,i,r,o,n,s;this.option3d=t;const a=this.get3dOptions(t),{light:l,center:h,camera:c,alpha:d,beta:u,fieldRatio:g,fieldDepth:p}=a,{dir:f=[1,1,-1],color:m="white",ambient:b}=l,y=(null!==(e=h.x)&&void 0!==e?e:this.width/2)+(null!==(i=h.dx)&&void 0!==i?i:0),C=(null!==(r=h.y)&&void 0!==r?r:this.height/2)+(null!==(o=h.dy)&&void 0!==o?o:0),w=[y,C,(null!==(n=h.z)&&void 0!==n?n:0)+(null!==(s=h.dz)&&void 0!==s?s:0)];let v=0,x=0,_=0;c||(v=Math.sin(d)+y,x=Math.sin(u)+C,_=Math.cos(d)*Math.cos(u)*1),this.light=new Ou(f,m,b);const S={left:0,right:this.width,top:0,bottom:this.height,fieldRatio:g,fieldDepth:p,viewParams:{pos:[v,x,_],center:w,up:[0,1,0]}};this.camera?this.camera.params=S:this.camera=new Nu(S),t.enableView3dTransform&&this.enableView3dTransform()}setBeforeRender(t){this._beforeRender=t}setAfterRender(t){this._afterRender=t}afterNextRender(t){this._afterNextRenderCbs||(this._afterNextRenderCbs=[]),this._afterNextRenderCbs.push(t)}enableView3dTransform(){this.view3dTranform||(this.view3dTranform=!0,this.pluginService.register(new Pu))}disableView3dTranform(){this.view3dTranform&&(this.view3dTranform=!1,this.pluginService.findPluginsByName("ViewTransform3dPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableAutoRender(){this.autoRender||(this.autoRender=!0,this.pluginService.register(new Tu))}disableAutoRender(){this.autoRender&&(this.autoRender=!1,this.pluginService.findPluginsByName("AutoRenderPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableIncrementalAutoRender(){this.increaseAutoRender||(this.increaseAutoRender=!0,this.pluginService.register(new Hu))}disableIncrementalAutoRender(){this.increaseAutoRender&&(this.increaseAutoRender=!1,this.pluginService.findPluginsByName("IncrementalAutoRenderPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableDirtyBounds(){if(this.dirtyBounds)return;this.dirtyBounds=new de;let t=this.pluginService.findPluginsByName("DirtyBoundsPlugin")[0];t?t.activate(this.pluginService):(t=new Lu,this.pluginService.register(t))}disableDirtyBounds(){this.dirtyBounds&&(this.dirtyBounds=null,this.pluginService.findPluginsByName("DirtyBoundsPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableLayout(){this._enableLayout||(this._enableLayout=!0,this.pluginService.register(new Iu))}disableLayout(){this._enableLayout&&(this._enableLayout=!1,this.pluginService.findPluginsByName("FlexLayoutPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableHtmlAttribute(t){this.htmlAttribute||(this.htmlAttribute=t,this.pluginService.register(new Eu))}disableHtmlAttribute(){this.htmlAttribute&&(this.htmlAttribute=!1,this.pluginService.findPluginsByName("HtmlAttributePlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableReactAttribute(t){this.reactAttribute||(this.reactAttribute=t,this.pluginService.register(new Uu))}disableReactAttribute(){this.reactAttribute&&(this.reactAttribute=!1,this.pluginService.findPluginsByName("ReactAttributePlugin").forEach((t=>{this.pluginService.unRegister(t)})))}getPluginsByName(t){return this.pluginService.findPluginsByName(t)}tryUpdateAABBBounds(){const t=this.window.getViewBox();return this._AABBBounds.setValue(t.x1,t.y1,t.x2,t.y2),this._AABBBounds}combineLayer(t,e){throw new Error("暂不支持")}createLayer(t,e){const i=this.layerService.createLayer(this,{main:!1,layerMode:e,canvasId:t});return this.appendChild(i),i}sortLayer(t){const e=this.children;e.sort(t),this.removeAllChild(),e.forEach((t=>{this.appendChild(t)}))}removeLayer(t){return this.removeChild(this.findChildByUid(t))}tryInitInteractiveLayer(){this.supportInteractiveLayer&&!this.interactiveLayer&&(this.interactiveLayer=this.createLayer(),this.interactiveLayer.name="_builtin_interactive",this.interactiveLayer.attribute.pickable=!1,this.nextFrameRenderLayerSet.add(this.interactiveLayer))}clearViewBox(t){this.window.clearViewBox(t)}render(t,e){this.ticker.start(),this.timeline.resume();const i=this.state;this.state="rendering",this.layerService.prepareStageLayer(this),this._skipRender||(this.lastRenderparams=e,this.hooks.beforeRender.call(this),this._skipRender||(this.renderLayerList(this.children),this.combineLayersToWindow(),this.nextFrameRenderLayerSet.clear()),this.hooks.afterRender.call(this)),this.state=i,this._skipRender&&this._skipRender++}combineLayersToWindow(){}renderNextFrame(t,e){this.nextFrameRenderLayerSet.size!==this.childrenCount&&(t||this).forEach((t=>{this.nextFrameRenderLayerSet.add(t)})),this.willNextFrameRender||(this.willNextFrameRender=!0,this.global.getRequestAnimationFrame()((()=>{this._doRenderInThisFrame(),this.willNextFrameRender=!1})))}_doRenderInThisFrame(){this.timeline.resume(),this.ticker.start();const t=this.state;this.state="rendering",this.layerService.prepareStageLayer(this),this.nextFrameRenderLayerSet.size&&!this._skipRender&&(this.hooks.beforeRender.call(this),this._skipRender||(this.renderLayerList(Array.from(this.nextFrameRenderLayerSet.values()),this.lastRenderparams||{}),this.combineLayersToWindow(),this.nextFrameRenderLayerSet.clear()),this.hooks.afterRender.call(this)),this.state=t,this._skipRender&&this._skipRender++}renderLayerList(t,e){const i=[];for(let e=0;e<t.length;e++){let r=t[e];"virtual"===r.layerMode&&(r=r.getNativeHandler().mainHandler.layer),i.includes(r)||i.push(r)}i.forEach((t=>{t.renderCount>this.renderCount||(t.renderCount=this.renderCount+1,t.render({renderService:this.renderService,background:t===this.defaultLayer?this.background:void 0,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty()),viewBox:this.window.getViewBox(),transMatrix:this.window.getViewBoxTransform()},Object.assign({renderStyle:this.renderStyle},e)))})),this.interactiveLayer&&!t.includes(this.interactiveLayer)&&this.interactiveLayer.render({renderService:this.renderService,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty()),viewBox:this.window.getViewBox(),transMatrix:this.window.getViewBoxTransform()},Object.assign({renderStyle:this.renderStyle},e))}resizeWindow(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.window.resize(t,e),i&&this.render()}resize(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.window.hasSubView()||this.viewBox.setValue(this.viewBox.x1,this.viewBox.y1,this.viewBox.x1+t,this.viewBox.y1+e),this.window.resize(t,e),this.forEachChildren((i=>{i.resize(t,e)})),this.camera&&this.option3d&&this.set3dOptions(this.option3d),i&&this.render()}resizeView(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.viewBox.setValue(this.viewBox.x1,this.viewBox.y1,this.viewBox.x1+t,this.viewBox.y1+e),this.forEachChildren((i=>{i.resizeView(t,e)})),this.camera&&(this.camera.params=Object.assign(Object.assign({},this.camera.params),{right:this.width,bottom:this.height})),i&&this.render()}setViewBox(t,e,i,r,o){let n=!0;"object"==typeof t?(this.viewBox.setValue(t.x1,t.y1,t.x2,t.y2),!1===e&&(n=!1)):(this.viewBox.setValue(t,e,t+i,e+r),!1===o&&(n=!1)),this.forEachChildren((t=>{t.resizeView(this.viewBox.width(),this.viewBox.height())})),n&&this.render()}setDpr(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.forEachChildren((e=>{e.setDpr(t)})),e&&this.render()}setOrigin(t,e){throw new Error("暂不支持")}export(t){throw new Error("暂不支持")}pick(t,e){this.pickerService||(this.pickerService=Xr.get(Rd));const i=this.pickerService.pick(this.children,new le(t,e),{bounds:this.AABBBounds});return!(!(null==i?void 0:i.graphic)&&!(null==i?void 0:i.group))&&i}startAnimate(t){throw new Error("暂不支持")}setToFrame(t){throw new Error("暂不支持")}release(){super.release(),this.hooks.beforeRender.unTap("constructor",this.beforeRender),this.hooks.afterRender.unTap("constructor",this.afterRender),this.eventSystem&&this.eventSystem.release(),this.layerService.releaseStage(this),this.pluginService.release(),this.forEach((t=>{t.release()})),this.interactiveLayer&&this.interactiveLayer.release(),this.window.release(),this.ticker.remTimeline(this.timeline),this.renderService.renderTreeRoots=[]}setStage(t){}dirty(t,e){e&&t.transformWithMatrix(e),this.dirtyBounds.empty()&&this.dirtyBounds.setValue(t.x1,t.y1,t.x2,t.y2),this.dirtyBounds.union(t)}getLayer(t){return this.children.filter((e=>e.name===t))[0]}renderTo(t){this.forEachChildren(((e,i)=>{e.drawTo(t,{renderService:this.renderService,viewBox:t.getViewBox(),transMatrix:t.getViewBoxTransform(),background:e===this.defaultLayer?this.background:void 0,clear:0===i,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty())})}))}renderToNewWindow(){let t=arguments.length>1?arguments[1]:void 0;const e=Xr.get(eo),i=t?-t.x1:0,r=t?-t.y1:0,o=t?t.x2:this.viewWidth,n=t?t.y2:this.viewHeight,s=t?t.width():this.viewWidth,a=t?t.height():this.viewHeight;return e.create({viewBox:{x1:i,y1:r,x2:o,y2:n},width:s,height:a,dpr:this.window.dpr,canvasControled:!0,offscreen:!0,title:""}),this.renderTo(e),e}toCanvas(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1?arguments[1]:void 0;const i=this.renderToNewWindow(t,e).getNativeHandler();return i.nativeCanvas?i.nativeCanvas:null}setCursor(t){this._cursor=t,this.eventSystem.setCursor(t,"ignore")}getCursor(){return this._cursor}}var Xu=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Yu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};const qu={WIDTH:500,HEIGHT:500,DPR:1};let Zu=class{get displayWidth(){return this._pixelWidth/this._dpr}get displayHeight(){return this._pixelHeight/this._dpr}get id(){return this._id}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}get nativeCanvas(){return this._nativeCanvas}get width(){return this._pixelWidth}set width(t){this._pixelWidth=t,this._displayWidth=t/(this._dpr||1)}get height(){return this._pixelHeight}set height(t){this._pixelHeight=t,this._displayHeight=t/(this._dpr||1)}getContext(t){return this._context}get visiable(){return this._visiable}set visiable(t){this._visiable=t,t?this.show():this.hide()}get dpr(){return this._dpr}set dpr(t){this._dpr=t,this.resize(this._displayWidth,this._displayHeight)}constructor(t){var e;const{nativeCanvas:i,width:r=qu.WIDTH,height:o=qu.HEIGHT,dpr:n=qu.DPR,x:s,y:a,id:l,canvasControled:h=!0}=t;this._x=null!=s?s:0,this._y=null!=a?a:0,this._pixelWidth=r*n,this._pixelHeight=o*n,this._visiable=!1!==t.visiable,this.controled=h,this._displayWidth=r,this._displayHeight=o,this._dpr=n,this._nativeCanvas=i,this._id=null!==(e=i.id)&&void 0!==e?e:l,l&&(i.id=l),this.init(t)}getNativeCanvas(){return this._nativeCanvas}hide(){}show(){}applyPosition(){}resetStyle(t){}resize(t,e){}toDataURL(t,e){return""}readPixels(t,e,i,r){return this._context.getImageData(t,e,i,r)}convertToBlob(t){throw new Error("暂未实现")}transferToImageBitmap(){throw new Error("暂未实现")}release(){this.controled&&this._nativeCanvas.parentElement&&this._nativeCanvas.parentElement.removeChild(this._nativeCanvas)}};Zu.env="browser",Zu=Xu([f(),Yu("design:paramtypes",[Object])],Zu);var Ju=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let Qu=class{configure(t){t.env===this.type&&t.setActiveEnvContribution(this)}getNativeAABBBounds(t){return new ue}removeDom(t){return!1}createDom(t){return null}getDynamicCanvasCount(){return 999}getStaticCanvasCount(){return 999}getElementById(t){return document.getElementById(t)}getRootElement(){return document.body}loadJson(t){const e=fetch(t).then((t=>t.json()));return e.then((t=>({data:t,state:"success"}))).catch((()=>({data:null,state:"fail"}))),e}loadArrayBuffer(t){return fetch(t).then((t=>t.arrayBuffer())).then((t=>({data:t,loadState:"success"}))).catch((()=>({data:null,loadState:"fail"})))}loadBlob(t){return fetch(t).then((t=>t.blob())).then((t=>({data:t,loadState:"success"}))).catch((()=>({data:null,loadState:"fail"})))}getElementTop(t,e){return 0}getElementLeft(t,e){return 0}getElementTopLeft(t,e){return{top:0,left:0}}};Qu=Ju([f()],Qu);var tg=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},eg=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let ig=class{constructor(){this._uid=e.GenAutoIncrementId(),this.viewBox=new ue,this.modelMatrix=new fe(1,0,0,1,0,0)}onChange(t){this._onChangeCb=t}configure(t,e){e.env===this.type&&t.setWindowHandler(this)}release(){this.releaseWindow()}isVisible(t){return!0}onVisibleChange(t){}getTopLeft(t){return{top:0,left:0}}setViewBox(t){this.viewBox.setValue(t.x1,t.y1,t.x2,t.y2)}getViewBox(){return this.viewBox}setViewBoxTransform(t,e,i,r,o,n){this.modelMatrix.setValue(t,e,i,r,o,n)}getViewBoxTransform(){return this.modelMatrix}};ig=tg([f(),eg("design:paramtypes",[])],ig);var rg=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},og=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ng=function(t,e){return function(i,r){e(i,r,t)}};let sg=class{constructor(t){this.pickItemInterceptorContributions=t,this.type="default",this.global=kr.global}_init(){this.InterceptorContributions=this.pickItemInterceptorContributions.getContributions().sort(((t,e)=>t.order-e.order))}pick(t,e,i){let r={graphic:null,group:null};i.pickerService=this;const o=i.bounds.width(),n=i.bounds.height();if(!(new ue).setValue(0,0,o,n).containsPoint(e))return r;this.pickContext&&(this.pickContext.inuse=!0),i.pickContext=this.pickContext,this.pickContext&&this.pickContext.clearMatrix(!0,1);const s=new fe(1,0,0,1,0,0);let a;for(let o=t.length-1;o>=0&&(r=t[o].isContainer?this.pickGroup(t[o],e,s,i):this.pickItem(t[o],e,s,i),!r.graphic);o--)a||(a=r.group);if(r.graphic||(r.group=a),this.pickContext&&(this.pickContext.inuse=!1),r.graphic){let t=r.graphic;for(;t.parent;)t=t.parent;t.shadowHost&&(r.params={shadowTarget:r.graphic},r.graphic=t.shadowHost)}return r}containsPoint(t,e,i){var r;return!!(null===(r=this.pickItem(t,e,null,null!=i?i:{pickContext:this.pickContext,pickerService:this}))||void 0===r?void 0:r.graphic)}pickGroup(t,e,i,r){let o={group:null,graphic:null};if(!1===t.attribute.visibleAll)return o;const n=r.pickContext,s=n.modelMatrix;if(n.camera){const e=t.transMatrix,i=th.allocate();if(nh(i,e),s){if(i){const t=th.allocate();n.modelMatrix=sh(t,s,i),th.free(i)}}else nh(i,t.globalTransMatrix),n.modelMatrix=i}if(this.InterceptorContributions.length)for(let o=0;o<this.InterceptorContributions.length;o++){const a=this.InterceptorContributions[o];if(a.beforePickItem){const o=a.beforePickItem(t,this,e,r,{parentMatrix:i});if(o)return n.modelMatrix!==s&&th.free(n.modelMatrix),n.modelMatrix=s,o}}const a=t.transMatrix,l=Ql.allocateByObj(i),h=new le(e.x,e.y);l.transformPoint(h,h);const c=t.AABBBounds.containsPoint(h);if(!c&&!t.stage.camera)return o;const d=this.pickItem(t,h.clone(),i,r);d&&d.graphic&&(o.graphic=d.graphic,o.params=d.params);const u=!1!==t.attribute.pickable&&c;return l.multiply(a.a,a.b,a.c,a.d,a.e,a.f),!1===t.attribute.childrenPickable||d&&d.graphic||eu(t,br.zIndex,(n=>{if(n.isContainer){const i=new le(e.x,e.y),s=yo(t).group,{scrollX:a=s.scrollX,scrollY:h=s.scrollY}=t.attribute;i.x-=a,i.y-=h,o=this.pickGroup(n,i,l,r)}else{const s=new le(e.x,e.y);l.transformPoint(s,s);const a=yo(t).group,{scrollX:h=a.scrollX,scrollY:c=a.scrollY}=t.attribute;s.x-=h,s.y-=c;const d=this.pickItem(n,s,i,r);d&&d.graphic&&(o.graphic=d.graphic,o.params=d.params)}return!!o.graphic||!!o.group}),!0,!!n.camera),n.modelMatrix!==s&&th.free(n.modelMatrix),n.modelMatrix=s,o.graphic||o.group||!u||t.stage.camera||(o.group=t),Ql.free(l),o}selectPicker(t){return this.pickerMap.get(t.numberType)||null}};sg=rg([f(),ng(0,g(H)),ng(0,m(Td)),og("design:paramtypes",[Object])],sg);let ag=!1;const lg=new i((t=>{ag||(ag=!0,t(Xh).toSelf().inSingletonScope(),t($c).to(Xh).inSingletonScope(),t(Zc).toService($c),t(Fs).toService(_h),k(t,Fs))}));let hg=!1;const cg=new i((t=>{hg||(hg=!0,t(vc).toSelf().inSingletonScope(),t(id).to(vc).inSingletonScope(),t(Zc).toService(id),t(Oh).toSelf(),t(zh).toSelf(),t(Gs).toService(Oh),t(Gs).toService(zh),t(Gs).toService(_h),k(t,Gs))}));let dg=!1;const ug=new i((t=>{dg||(dg=!0,t(ic).toSelf().inSingletonScope(),t(gu).toSelf().inSingletonScope(),t(Qc).to(ic).inSingletonScope(),t(Zc).toService(Qc))}));let gg=!1;const pg=new i((t=>{gg||(gg=!0,t(dc).toSelf().inSingletonScope(),t(Yc).to(dc).inSingletonScope(),t(Zc).toService(Yc),t(Is).toService(_h),k(t,Is),t(fu).toSelf().inSingletonScope())}));let fg=!1;const mg=new i((t=>{fg||(fg=!0,t(Ac).toSelf().inSingletonScope(),t(od).to(Ac).inSingletonScope(),t(Zc).toService(od),t(js).toService(_h),k(t,js))}));let bg=!1;const yg=new i((t=>{bg||(bg=!0,t(Jh).toSelf().inSingletonScope(),t(qc).to(Jh).inSingletonScope(),t(Zc).toService(qc),t(zs).toService(_h),k(t,zs))}));let Cg=!1;const wg=new i((t=>{Cg||(Cg=!0,t(nd).to(Hc).inSingletonScope(),t(Zc).toService(nd),t(Vs).toService(_h),k(t,Vs))}));let vg=!1;const xg=new i((t=>{vg||(vg=!0,t(bc).toSelf().inSingletonScope(),t(td).to(bc).inSingletonScope(),t(Zc).toService(td),t(Ws).toService(_h),k(t,Ws))}));let _g=!1;const Sg=new i((t=>{_g||(_g=!0,t(ed).to(Wc).inSingletonScope(),t(Zc).toService(ed),t(Ns).toService(_h),k(t,Ns))}));var Ag=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let Rg=class{constructor(){this.numberType=Kn}drawShape(t,e,i,r,o,n,s,a){o.drawContribution&&t.getSubGraphic().forEach((t=>{const l=o.drawContribution.getRenderContribution(t);l&&l.drawShape&&l.drawShape(t,e,i,r,o,n,s,a)}))}draw(t,e,i,r){const{context:o}=i;if(!o)return;if(o.highPerformanceSave(),!i.drawContribution)return;const n=yo(t),s=t.getSubGraphic();s.length&&s.forEach((t=>{i.drawContribution.renderItem(t,i,{theme:n})})),o.highPerformanceRestore()}};Rg=Ag([f()],Rg);let Bg=!1;const Mg=new i((t=>{Bg||(Bg=!0,t(ld).to(Rg).inSingletonScope(),t(Zc).toService(ld))}));var Tg=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Pg=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let Hg=class extends gh{constructor(){super(),this.numberType=es,this.builtinContributions=[Bc],this.init()}drawShape(t,e,i,r,o){const n=yo(t).richtext,{strokeOpacity:s=n.strokeOpacity,opacity:a=n.opacity,fillOpacity:l=n.fillOpacity,visible:h=n.visible}=t.attribute;if(!t.valid||!h)return;const c=As(a,l,!0),d=As(a,s,!0);c&&(e.translate(i,r),this.beforeRenderStep(t,e,i,r,c,d,c,d,n,o),t.getFrameCache().draw(e,this.drawIcon),this.afterRenderStep(t,e,i,r,c,d,c,d,n,o))}drawIcon(t,e,i,r,o){var n;const s=yo(t).richtextIcon,{width:a=s.width,height:l=s.height,opacity:h=s.opacity,image:c,backgroundFill:d=s.backgroundFill,backgroundFillOpacity:u=s.backgroundFillOpacity,backgroundStroke:g=s.backgroundStroke,backgroundStrokeOpacity:p=s.backgroundStrokeOpacity,backgroundRadius:f=s.backgroundRadius,margin:m}=t.attribute,{backgroundWidth:b=a,backgroundHeight:y=l}=t.attribute;if(m&&(i+=t._marginArray[3],r+=t._marginArray[0]),t._hovered){const t=(b-a)/2,o=(y-l)/2;0===f?(e.beginPath(),e.rect(i-t,r-o,b,y)):(e.beginPath(),Lh(e,i-t,r-o,b,y,f)),d&&(e.globalAlpha=u,e.fillStyle=d,e.fill()),g&&(e.globalAlpha=p,e.strokeStyle=g,e.stroke())}const C=c&&(null===(n=null==t?void 0:t.resources)||void 0===n?void 0:n.get(c));C&&"success"===C.state&&(e.globalAlpha=h,e.drawImage(C.data,i,r,a,l))}draw(t,e,i){const r=yo(t).richtext;this._draw(t,r,!1,i)}};Hg=Tg([f(),Pg("design:paramtypes",[])],Hg);let Eg=!1;const kg=new i((t=>{Eg||(Eg=!0,t(sd).to(Hg).inSingletonScope(),t(Zc).toService(sd))}));let Lg=!1;const Fg=new i((t=>{Lg||(Lg=!0,t(hd).to(Uc).inSingletonScope(),t(Zc).toService(hd),t(Ds).toService(_h),k(t,Ds))}));var Ig=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let zg=class extends gh{constructor(){super(...arguments),this.type="rect3d",this.numberType=ts}drawShape(t,e,i,r,o,n,s,a){var l;const h=yo(t,null==n?void 0:n.theme).rect3d,{fill:c=h.fill,stroke:d=h.stroke,x1:u,y1:g,x:p,y:f,opacity:m=h.opacity,fillOpacity:b=h.fillOpacity,lineWidth:y=h.lineWidth,strokeOpacity:C=h.strokeOpacity,visible:w=h.visible}=t.attribute;let{width:v,height:x}=t.attribute;v=(null!=v?v:u-p)||0,x=(null!=x?x:g-f)||0;const _=null!==(l=this.z)&&void 0!==l?l:0,S=Rs(m,b,v,x,c),A=Ms(m,C,v,x),R=_s(c),B=Ss(d,y);if(!t.valid||!w)return;if(!R&&!B)return;if(!(S||A||s||a))return;const{light:M,camera:T}=o.stage||{},P=t.findFace();if(!1!==c){e.setCommonStyle(t,t.attribute,i,r,h);let o=c;"string"!=typeof o&&(o="black"),this.fill(i,r,_,P,o,e,M,s)}!1!==d&&(e.setStrokeStyle(t,t.attribute,i,r,h),this.stroke(i,r,_,P,e))}stroke(t,e,i,r,o){const n=r.vertices;r.edges.forEach((r=>{const s=n[r[0]],a={x:t+s[0],y:e+s[1],z:i+s[2]},l=n[r[1]],h={x:t+l[0],y:e+l[1],z:i+l[2]};o.beginPath(),o.moveTo(a.x,a.y,a.z),o.lineTo(h.x,h.y,h.z),o.stroke()}))}fill(t,e,i,r,o,n,s,a){const l=sn.Get(o,nn.Color255),h=r.vertices,c=h.map((t=>n.view(t[0],t[1],t[2])[2])),d=[];r.polygons.forEach(((t,e)=>{d.push({faceIdx:e,polygon:t});const{polygon:i,normal:r}=t,o=c[i[0]],n=c[i[1]],s=c[i[2]],a=c[i[3]];t.ave_z=o+n+s+a})),d.sort(((t,e)=>e.polygon.ave_z-t.polygon.ave_z)),d.forEach((r=>{const{polygon:c,normal:d}=r.polygon,u=h[c[0]],g=h[c[1]],p=h[c[2]],f=h[c[3]],m={x:t+u[0],y:e+u[1],z:i+u[2]},b={x:t+g[0],y:e+g[1],z:i+g[2]},y={x:t+p[0],y:e+p[1],z:i+p[2]},C={x:t+f[0],y:e+f[1],z:i+f[2]};n.beginPath(),n.moveTo(m.x,m.y,m.z),n.lineTo(b.x,b.y,b.z),n.lineTo(y.x,y.y,y.z),n.lineTo(C.x,C.y,C.z),n.closePath(),a?a(n,null,null):(n.fillStyle=s?s.computeColor(d,l):o,n.fill())}))}draw(t,e,i){const r=yo(t).rect;this._draw(t,r,!1,i)}};zg=Ig([f()],zg);let Og=!1;const Dg=new i((t=>{Og||(Og=!0,t(rd).to(zg).inSingletonScope(),t(Zc).toService(rd))}));var Wg=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let Ng=class extends gh{constructor(){super(...arguments),this.numberType=jn}drawShape(t,e,i,r,o,n,s,a){var l;const h=yo(t,null==n?void 0:n.theme).arc,{fill:c=h.fill}=t.attribute,d=this.valid(t,h,s,a);if(!d)return;const{fVisible:u,sVisible:g,doFill:p,doStroke:f}=d,m=null!==(l=this.z)&&void 0!==l?l:0,{outerPadding:b=h.outerPadding,innerPadding:y=h.innerPadding,height:C=10}=t.attribute;let{outerRadius:w=h.outerRadius,innerRadius:v=h.innerRadius}=t.attribute;w+=b,v-=y;const x=sn.Get(c,nn.Color255),{light:_}=o.stage||{},S=o.hack_pieFace,A={top:m,bottom:m+C},R={top:[0,1,0],bottom:[0,-1,0],outside:[1,0,-1],inside:[1,0,-1]};"bottom"===S||"top"===S?(e.beginPath(),function(t,e,i,r,o,n,s){const{startAngle:a,endAngle:l}=t.getParsedAngle(),h=Zt(l-a),c=l>a;let d=!1;if(n<s){const t=n;n=s,s=t}if(n<=Kt)e.moveTo(i,r,o);else if(h>=qt-Kt)e.moveTo(i+n*Qt(a),r+n*ie(a),o),e.arc(i,r,n,a,l,!c,o),s>Kt&&(e.moveTo(i+s*Qt(l),r+s*ie(l),o),e.arc(i,r,s,l,a,c,o));else{const{outerDeltaAngle:h,innerDeltaAngle:u,outerStartAngle:g,outerEndAngle:p,innerEndAngle:f,innerStartAngle:m}=t.getParsePadAngle(a,l),b=n*Qt(g),y=n*ie(g),C=s*Qt(f),w=s*ie(f);h<.001?d=!0:(e.moveTo(i+b,r+y,o),e.arc(i,r,n,g,p,!c,o)),!(s>Kt)||u<.001?(e.lineTo(i+C,r+w,o),d=!0):(e.lineTo(i+C,r+w,o),e.arc(i,r,s,f,m,c,o))}e.closePath()}(t,e,i,r,A[S],w,v),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),p&&(s?s(e,t.attribute,h):u&&(e.setCommonStyle(t,t.attribute,i,r,h),e.fillStyle=_?_.computeColor(R[S],x):c,e.fill())),f&&(a?a(e,t.attribute,h):g&&(e.setStrokeStyle(t,t.attribute,i,r,h),e.stroke()))):"outside"!==S&&"inside"!==S||("inside"===S&&(e.save(),e.beginPath(),e.arc(i,r,v,0,qt,!0,A.top),e.clip()),e.beginPath(),function(t,e,i,r,o,n,s,a){const{startAngle:l,endAngle:h}=t.getParsedAngle(),c=Zt(h-l),d=h>l;let u=!1;if(s<=Kt)e.moveTo(i,r,o);else if(c>=qt-Kt)e.moveTo(i+s*Qt(l),r+s*ie(l),o),e.arc(i,r,s,l,h,!d,o),e.lineTo(i+s*Qt(h),r+s*ie(h),n),e.arc(i,r,s,h,l,d,n);else{const{innerouterDeltaAngle:t,innerouterStartAngle:c,innerouterEndAngle:g}=a(l,h),p=s*Qt(c),f=s*ie(c),m=s*Qt(g),b=s*ie(g);t<.001?u=!0:(e.moveTo(i+p,r+f,o),e.arc(i,r,s,c,g,!d,o),e.lineTo(i+m,r+b,n),e.arc(i,r,s,g,c,d,n))}e.closePath()}(t,e,i,r,A.top,A.bottom,"outside"===S?w:v,((e,i)=>{const{outerDeltaAngle:r,innerDeltaAngle:o,outerStartAngle:n,outerEndAngle:s,innerEndAngle:a,innerStartAngle:l}=t.getParsePadAngle(e,i);return"outside"===S?{innerouterDeltaAngle:r,innerouterEndAngle:s,innerouterStartAngle:n}:{innerouterDeltaAngle:o,innerouterEndAngle:a,innerouterStartAngle:l}})),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),p&&(s?s(e,t.attribute,h):u&&(e.setCommonStyle(t,t.attribute,i,r,h),e.fillStyle=_?_.computeColor(R[S],x):c,e.fill())),f&&(a?a(e,t.attribute,h):g&&(e.setStrokeStyle(t,t.attribute,i,r,h),e.stroke())),"inside"===S&&e.restore())}draw(t,e,i,r){const o=yo(t,null==r?void 0:r.theme).arc;this._draw(t,o,!1,i,r)}};Ng=Wg([f()],Ng);let Gg=!1;const jg=new i((t=>{Gg||(Gg=!0,t(Xc).to(Ng).inSingletonScope(),t(Zc).toService(Xc))}));var Vg=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let Ug=class extends gh{constructor(){super(...arguments),this.type="pyramid3d",this.numberType=Jn}drawShape(t,e,i,r,o,n,s,a){var l;const h=yo(t,null==n?void 0:n.theme).polygon,{fill:c=h.fill,stroke:d=h.stroke,face:u=[!0,!0,!0,!0,!0,!0]}=t.attribute,g=null!==(l=this.z)&&void 0!==l?l:0;if(!this.valid(t,h,s,a))return;const{light:p,camera:f}=o.stage||{},m=t.findFace();if(!1!==c){e.setCommonStyle(t,t.attribute,i,r,h);let o=c;"string"!=typeof o&&(o="black"),this.fill(i,r,g,m,u,o,e,p,f,t,h,s)}!1!==d&&(e.setStrokeStyle(t,t.attribute,i,r,h),this.stroke(i,r,g,m,e))}stroke(t,e,i,r,o){const n=r.vertices;r.edges.forEach((r=>{const s=n[r[0]],a=n[r[1]],l={x:t+s[0],y:e+s[1],z:i+s[2]},h={x:t+a[0],y:e+a[1],z:i+a[2]};o.beginPath(),o.moveTo(l.x,l.y,l.z),o.lineTo(h.x,h.y,h.z),o.stroke()}))}fill(t,e,i,r,o,n,s,a,l,h,c,d){const u=sn.Get(n,nn.Color255),g=r.vertices,p=g.map((t=>s.view(t[0],t[1],t[2])[2])),f=[];r.polygons.forEach(((t,e)=>{if(!o[e])return;f.push({faceIdx:e,polygon:t});const{polygon:i,normal:r}=t,n=p[i[0]],s=p[i[1]],a=p[i[2]],l=p[i[3]];t.ave_z=n+s+a+l})),f.sort(((t,e)=>e.polygon.ave_z-t.polygon.ave_z)),f.forEach((r=>{const{polygon:o,normal:l}=r.polygon,p=g[o[0]],f=g[o[1]],m=g[o[2]],b=g[o[3]],y={x:t+p[0],y:e+p[1],z:i+p[2]},C={x:t+f[0],y:e+f[1],z:i+f[2]},w={x:t+m[0],y:e+m[1],z:i+m[2]},v={x:t+b[0],y:e+b[1],z:i+b[2]};s.beginPath(),s.moveTo(y.x,y.y,y.z),s.lineTo(C.x,C.y,C.z),s.lineTo(w.x,w.y,w.z),s.lineTo(v.x,v.y,v.z),s.closePath(),d?d(s,h.attribute,c):(s.fillStyle=a?a.computeColor(l,u):n,s.fill())}))}draw(t,e,i){const r=yo(t).polygon;this._draw(t,r,!1,i)}};Ug=Vg([f()],Ug);let Kg=!1;const $g=new i((t=>{Kg||(Kg=!0,t(ad).to(Ug).inSingletonScope(),t(Zc).toService(ad))}));const Xg={onPointerDown:"pointerdown",onPointerUp:"pointerup",onPointerUpOutside:"pointerupoutside",onPointerTap:"pointertap",onPointerOver:"pointerover",onPointerMove:"pointermove",onPointerEnter:"pointerenter",onPointerLeave:"pointerleave",onPointerOut:"pointerout",onMouseDown:"mousedown",onMouseUp:"mouseup",onMouseUpOutside:"mouseupoutside",onMouseMove:"mousemove",onMouseOver:"mouseover",onMouseOut:"mouseout",onMouseEnter:"mouseenter",onMouseLeave:"mouseleave",onPinch:"pinch",onPinchStart:"pinchstart",onPinchEnd:"pinchend",onPan:"pan",onPanStart:"panstart",onPanEnd:"panend",onDrag:"drag",onDragStart:"dragstart",onDragEnter:"dragenter",onDragLeave:"dragleave",onDragOver:"dragover",onDragEnd:"dragend",onRightDown:"rightdown",onRightUp:"rightup",onRightUpOutside:"rightupoutside",onTouchStart:"touchstart",onTouchEnd:"touchend",onTouchEndOutside:"touchendoutside",onTouchMove:"touchmove",onTouchCancel:"touchcancel",onPress:"press",onPressUp:"pressup",onPressEnd:"pressend",onSwipe:"swipe",onDrop:"drop",onWeel:"wheel",onClick:"click",onDblClick:"dblclick"};var Yg=function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(i[r[o]]=t[r[o]])}return i};function qg(t,e){if(et(t))return t.forEach((t=>qg(t,e)));e.push(t)}const Zg=(t,e)=>{const i=e.x-t.x,r=e.y-t.y;return Math.abs(i)>Math.abs(r)?i>0?"right":"left":r>0?"down":"up"},Jg=(t,e)=>{const i=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y);return Math.sqrt(i*i+r*r)};class Qg extends V{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i,r,o,n,s,a,l,h,c,d;super(),this.cachedEvents=[],this.startPoints=[],this.processEvent={},this.throttleTimer=0,this.emitThrottles=[],this.lastTapTarget=null,this.onStart=t=>{this.reset(),this.startTime=Ro.now();const{cachedEvents:e,startPoints:i}=this;t&&e.push(t.clone()),i.length=e.length;for(let t=0;t<e.length;t++){const{x:r,y:o}=e[t],n={x:r,y:o};i[t]=n}if(1!==i.length)this.startDistance=Jg(i[0],i[1]),this.center=(t=>{const e=t.length;if(1===e)return{x:Math.round(t[0].x),y:Math.round(t[0].y)};let i=0,r=0,o=0;for(;o<e;)i+=t[o].x,r+=t[o].y,o++;return{x:Math.round(i/e),y:Math.round(r/e)}})([i[0],i[1]]);else{const t=e[0];this.pressTimeout=setTimeout((()=>{t.direction="none",t.deltaX=0,t.deltaY=0,t.points=i,this.triggerStartEvent("press",t),this.triggerEvent("press",t),this.eventType="press",this.direction="none"}),this.config.press.time)}},this.onMove=t=>{this.clearPressTimeout();const{startPoints:e,cachedEvents:i}=this;if(!e.length)return;const r=t.clone(),{x:o,y:n,pointerId:s}=r;for(let t=0,e=i.length;t<e;t++)if(s===i[t].pointerId){i[t]=r;break}const a={x:o,y:n},l=i.map((t=>({x:t.x,y:t.y}))),h=Ro.now();if(this.prevMoveTime=this.lastMoveTime,this.prevMovePoint=this.lastMovePoint,this.lastMoveTime=h,this.lastMovePoint=a,1===e.length){const t=e[0],i=o-t.x,s=n-t.y,h=this.direction||Zg(t,a);this.direction=h;const c=this.getEventType(a);return r.direction=h,r.deltaX=i,r.deltaY=s,r.points=l,this.triggerStartEvent(c,r),void this.triggerEvent(c,r)}const{startDistance:c}=this,d=Jg(l[0],l[1]);r.scale=d/c,r.center=this.center,r.points=l,this.triggerStartEvent("pinch",r),this.triggerEvent("pinch",r)},this.onEnd=t=>{const e=t.clone(),{cachedEvents:i,startPoints:r}=this,o=i.map((t=>({x:t.x,y:t.y})));if(e.points=o,this.triggerEndEvent(e),1===i.length){const i=Ro.now(),o=this.lastMoveTime;if(i-o<100){const t=o-(this.prevMoveTime||this.startTime);if(t>0){const i=this.prevMovePoint||r[0],o=this.lastMovePoint||r[0],n=Jg(i,o),s=n/t;s>this.config.swipe.velocity&&n>this.config.swipe.threshold&&(e.velocity=s,e.direction=Zg(i,o),this.triggerEvent("swipe",e))}}i-this.lastTapTime<this.config.tap.interval&&t.target===this.lastTapTarget?this.tapCount++:this.tapCount=1,this.lastTapTime=i,this.lastTapTarget=t.target,1===this.tapCount?this.triggerEvent("tap",e):2===this.tapCount&&(this.triggerEvent("doubletap",e),this.tapCount=0)}for(let t=0,o=i.length;t<o;t++)if(i[t].pointerId===e.pointerId){i.splice(t,1),r.splice(t,1);break}this.reset(),i.length>0&&this.onStart()},this.element=t,this.tapCount=0,this.lastTapTime=0,this.config={press:{time:null!==(r=null===(i=null==e?void 0:e.press)||void 0===i?void 0:i.time)&&void 0!==r?r:251,threshold:null!==(n=null===(o=null==e?void 0:e.press)||void 0===o?void 0:o.threshold)&&void 0!==n?n:9},swipe:{threshold:null!==(a=null===(s=null==e?void 0:e.swipe)||void 0===s?void 0:s.threshold)&&void 0!==a?a:10,velocity:null!==(h=null===(l=null==e?void 0:e.swipe)||void 0===l?void 0:l.velocity)&&void 0!==h?h:.3},tap:{interval:null!==(d=null===(c=null==e?void 0:e.tap)||void 0===c?void 0:c.interval)&&void 0!==d?d:300}},this.initEvents()}initEvents(){const{element:t}=this;t&&(t.addEventListener("pointerdown",this.onStart),t.addEventListener("pointermove",this.onMove),t.addEventListener("pointerup",this.onEnd),t.addEventListener("pointerupoutside",this.onEnd))}removeEvents(){const{element:t}=this;t&&(t.removeEventListener("pointerdown",this.onStart),t.removeEventListener("pointermove",this.onMove),t.removeEventListener("pointerup",this.onEnd),t.removeEventListener("pointerupoutside",this.onEnd))}release(){this.removeEvents(),this.element=null}getEventType(t){const{eventType:e,startTime:i,startPoints:r}=this;if(e)return e;let o;return o=Ro.now()-i>this.config.press.time&&Jg(r[0],t)<this.config.press.threshold?"press":"pan",this.eventType=o,o}enable(t){this.processEvent[t]=!0}isProcess(t){return this.processEvent[t]}pushEvent(t,e){const{emitThrottles:i}=this,r={type:t,ev:e};for(let e=0,o=i.length;e<o;e++)if(i[e].type===t)return void i.splice(e,1,r);i.push(r)}clearPressTimeout(){this.pressTimeout&&(clearTimeout(this.pressTimeout),this.pressTimeout=null)}reset(){this.clearPressTimeout(),this.startTime=0,this.startDistance=0,this.direction=null,this.eventType=null,this.prevMoveTime=0,this.prevMovePoint=null,this.lastMoveTime=0,this.lastMovePoint=null}triggerEvent(t,e){this.pushEvent(t,e);const{throttleTimer:i,emitThrottles:r}=this;i||(this.throttleTimer=kr.global.getRequestAnimationFrame()((()=>{for(let t=0,e=r.length;t<e;t++){const{type:e,ev:i}=r[t];this.emitEvent(e,i)}this.throttleTimer=0,this.emitThrottles.length=0})))}triggerStartEvent(t,e){this.isProcess(t)||(this.enable(t),this.triggerEvent(`${t}start`,e))}triggerEndEvent(t){const e=this.processEvent;Object.keys(e).forEach((i=>{this.triggerEvent(`${i}end`,t),"press"===i&&this.triggerEvent(`${i}up`,t),delete e[i]}))}emitEvent(t,e){const i=this.element._events["*"];if(i)if("fn"in i)i.fn.call(i.context,e,t);else for(let r=0,o=i.length;r<o&&!e.propagationImmediatelyStopped;r++)i[r].fn.call(i[r].context,e,t);this.emit(t,e)}}var tp=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},ep=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};const ip=[0,0,0];let rp=class{set fillStyle(t){this.nativeContext.fillStyle=t}get fillStyle(){return this.nativeContext.fillStyle}set font(t){this.nativeContext.font=t}get font(){return this.nativeContext.font}set globalAlpha(t){this.nativeContext.globalAlpha=t}get globalAlpha(){return this.nativeContext.globalAlpha}set lineCap(t){this.nativeContext.lineCap=t}get lineCap(){return this.nativeContext.lineCap}set lineDashOffset(t){this.nativeContext.lineDashOffset=t}get lineDashOffset(){return this.nativeContext.lineDashOffset}set lineJoin(t){this.nativeContext.lineJoin=t}get lineJoin(){return this.nativeContext.lineJoin}set lineWidth(t){this.nativeContext.lineWidth=t}get lineWidth(){return this.nativeContext.lineWidth}set miterLimit(t){this.nativeContext.miterLimit=t}get miterLimit(){return this.nativeContext.miterLimit}set shadowBlur(t){this.nativeContext.shadowBlur=t}get shadowBlur(){return this.nativeContext.shadowBlur}set shadowColor(t){this.nativeContext.shadowColor=t}get shadowColor(){return this.nativeContext.shadowColor}set shadowOffsetX(t){this.nativeContext.shadowOffsetX=t}get shadowOffsetX(){return this.nativeContext.shadowOffsetX}set shadowOffsetY(t){this.nativeContext.shadowOffsetY=t}get shadowOffsetY(){return this.nativeContext.shadowOffsetY}set strokeStyle(t){this.nativeContext.strokeStyle=t}get strokeStyle(){return this.nativeContext.strokeStyle}set textAlign(t){this.nativeContext.textAlign=t}get textAlign(){return this.nativeContext.textAlign}set textBaseline(t){this.nativeContext.textBaseline=t}get textBaseline(){return this.nativeContext.textBaseline}get inuse(){return!!this._inuse}set inuse(t){t!==!!this._inuse&&(this._inuse=t,t?(this.nativeContext.save(),this.reset()):this.nativeContext.restore())}constructor(t,e){this.fillAttributes=Object.assign(Object.assign({},dr),{opacity:1}),this.strokeAttributes=Object.assign(Object.assign({},gr),{opacity:1}),this.textAttributes=Object.assign(Object.assign({},pr),{opacity:1}),this._clearShadowStyle=!1,this._clearFilterStyle=!1,this._clearGlobalCompositeOperationStyle=!1;const i=t.nativeCanvas.getContext("2d");if(!i)throw new Error("发生错误，获取2d上下文失败");this.nativeContext=i,this.canvas=t,this.matrix=new fe(1,0,0,1,0,0),this.stack=[],this.dpr=e,this.applyedMatrix=new fe(1,0,0,1,0,0),this._clearMatrix=new fe(1,0,0,1,0,0)}reset(){this.stack.length&&qe.getInstance().warn("可能存在bug，matrix没有清空"),this.matrix.setValue(1,0,0,1,0,0),this.applyedMatrix=new fe(1,0,0,1,0,0),this.stack.length=0,this.nativeContext.setTransform(1,0,0,1,0,0)}getCanvas(){return this.canvas}getContext(){return this.nativeContext}setTransformForCurrent(){!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this.applyedMatrix.equalToMatrix(this.matrix)||(this.applyedMatrix.setValue(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f),this.nativeContext.setTransform(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f))}get currentMatrix(){return this.matrix}cloneMatrix(t){return Ql.allocateByObj(t)}clear(){this.save(),this.resetTransform(),this.nativeContext.clearRect(0,0,this.canvas.width,this.canvas.height),this.restore()}restore(){this.nativeContext.restore(),this.stack.length>0&&(Ql.free(this.matrix),this.matrix=this.stack.pop(),this.setTransformForCurrent(!0))}highPerformanceRestore(){this.stack.length>0&&(Ql.free(this.matrix),this.matrix=this.stack.pop())}rotate(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.matrix.rotate(t),e&&this.setTransformForCurrent()}save(){const t=this.cloneMatrix(this.matrix);this.stack.push(t),this.nativeContext.save()}highPerformanceSave(){const t=this.cloneMatrix(this.matrix);this.stack.push(t)}scale(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.matrix.scale(t,e),i&&this.setTransformForCurrent()}setScale(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.matrix.setScale(t,e),i&&this.setTransformForCurrent()}scalePoint(t,e,i,r){let o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];this.translate(i,r,!1),this.scale(t,e,!1),this.translate(-i,-r,!1),o&&this.setTransformForCurrent()}setTransform(t,e,i,r,o,n){let s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:this.dpr;this.matrix.setValue(a*t,a*e,a*i,a*r,a*o,a*n),s&&this.setTransformForCurrent()}setTransformFromMatrix(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.dpr;this.matrix.setValue(t.a*i,t.b*i,t.c*i,t.d*i,t.e*i,t.f*i),e&&this.setTransformForCurrent()}resetTransform(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.dpr;this.setTransform(e,0,0,e,0,0),t&&this.setTransformForCurrent()}transform(t,e,i,r,o,n){let s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];this.matrix.multiply(t,e,i,r,o,n),s&&this.setTransformForCurrent()}transformFromMatrix(t,e){this.matrix.multiply(t.a,t.b,t.c,t.d,t.e,t.f),e&&this.setTransformForCurrent()}translate(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.matrix.translate(t,e),i&&this.setTransformForCurrent()}rotateDegrees(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=t*Math.PI/180;this.rotate(i,e)}rotateAbout(t,e,i){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.translate(e,i,!1),this.rotate(t,!1),this.translate(-e,-i,!1),r&&this.setTransformForCurrent()}rotateDegreesAbout(t,e,i){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.translate(e,i,!1),this.rotateDegrees(t,!1),this.translate(-e,-i,!1),r&&this.setTransformForCurrent()}beginPath(){this.disableBeginPath||this.nativeContext.beginPath()}clip(t,e){t?"string"==typeof t?this.nativeContext.clip(t):this.nativeContext.clip(t,e):this.nativeContext.clip()}arc(t,e,i,r,o,n,s){if(s=s||0,this.camera){const a=[];((t,e,i,r,o,n,s,a)=>{if(a)for(;i>e;)i-=qt;else for(;i<e;)i+=qt;const l=$t/3*(i>e?1:-1);let h=e,c=h;for(;c!==i;){c=l>0?Math.min(c+l,i):Math.max(c+l,i);const e=Math.abs(c-h),a=4*Math.tan(e/4)/3,d=c<h?-1:1,u=Math.cos(h),g=Math.sin(h),p=Math.cos(c),f=Math.sin(c),m=u*n+r,b=g*s+o,y=p*n+r,C=f*s+o,w=n*a*d,v=s*a*d;t.push([m-w*g,b+v*u,y+w*f,C-v*p,y,C]),h=c}})(a,r,o,t,e,i,i,n);for(let t=0;t<a.length;++t){const e=a[t];this.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5],s)}}else this.nativeContext.arc(t,e,i,r,o,n)}arcTo(t,e,i,r,o){this.nativeContext.arcTo(t,e,i,r,o)}bezierCurveTo(t,e,i,r,o,n,s){if(s=s||0,this.camera){let a=s,l=s;this.modelMatrix&&(Wu(ip,[t,e,s],this.modelMatrix),t=ip[0],e=ip[1],a=ip[2],Wu(ip,[i,r,s],this.modelMatrix),i=ip[0],r=ip[1],l=ip[2],Wu(ip,[o,n,s],this.modelMatrix),o=ip[0],n=ip[1],s=ip[2]);let h=this.camera.vp(o,n,s);o=h.x,n=h.y,h=this.camera.vp(t,e,a),t=h.x,e=h.y,h=this.camera.vp(i,r,l),i=h.x,r=h.y}this.nativeContext.bezierCurveTo(t,e,i,r,o,n)}closePath(){this.nativeContext.closePath()}ellipse(t,e,i,r,o,n,s,a){null==a?this.nativeContext.ellipse(t,e,i,r,o,n,s):this.nativeContext.ellipse(t,e,i,r,o,n,s,a)}lineTo(t,e,i){if(i=i||0,this.camera){this.modelMatrix&&(Wu(ip,[t,e,i],this.modelMatrix),t=ip[0],e=ip[1],i=ip[2]);const r=this.camera.vp(t,e,i);t=r.x,e=r.y}this.nativeContext.lineTo(t,e)}moveTo(t,e,i){if(i=i||0,this.camera){this.modelMatrix&&(Wu(ip,[t,e,i],this.modelMatrix),t=ip[0],e=ip[1],i=ip[2]);const r=this.camera.vp(t,e,i);t=r.x,e=r.y}this.nativeContext.moveTo(t,e)}quadraticCurveTo(t,e,i,r,o){if(o=o||0,this.camera){let n=o;this.modelMatrix&&(Wu(ip,[t,e,o],this.modelMatrix),t=ip[0],e=ip[1],n=ip[2],Wu(ip,[i,r,o],this.modelMatrix),i=ip[0],r=ip[1],o=ip[2]);let s=this.camera.vp(i,r,o);i=s.x,r=s.y,s=this.camera.vp(t,e,n),t=s.x,e=s.y}this.nativeContext.quadraticCurveTo(t,e,i,r)}rect(t,e,i,r,o){o=o||0,this.camera?(this.moveTo(t,e,o),this.lineTo(t+i,e,o),this.lineTo(t+i,e+r,o),this.lineTo(t,e+r,o),this.closePath()):this.nativeContext.rect(t,e,i,r)}createImageData(){const t=arguments;return 2===t.length?this.nativeContext.createImageData(t[0],t[1]):1===t.length?this.nativeContext.createImageData(t[0]):null}createLinearGradient(t,e,i,r){return this.nativeContext.createLinearGradient(t,e,i,r)}createPattern(t,e){return 0===t.width||0===t.height?null:this.nativeContext.createPattern(t,e)}createRadialGradient(t,e,i,r,o,n){return this.nativeContext.createRadialGradient(t,e,i,r,o,n)}createConicGradient(t,e,i,r){let o,n=!1;const s=this;return{stops:[],addColorStop(t,e){this.stops.push([t,e]),n=!0},GetPattern(a,l,h){return n&&(h||(h=r-i),o=function(t,e,i,r,o,n,s,a,l){const h=Math.floor(180*o/Math.PI),c=Es.GetCanvas(),d=Es.GetCtx();if(!d)return null;const u=Ls.GetSize(a),g=Ls.GetSize(l);let p=Ls.Get(e,i,r,n,s,u,g);if(p)return p;const f=Math.sqrt(Math.max(Math.max(Math.pow(i,2)+Math.pow(r,2),Math.pow(u-i,2)+Math.pow(r,2)),Math.max(Math.pow(u-i,2)+Math.pow(g-r,2),Math.pow(i,2)+Math.pow(g-r,2)))),m=h+1,b=o/Math.max(1,m-1),y=ks.getInstance().GetOrCreate(i,r,u,g,e,m),C=2*Math.PI*f/360;c.width=u,c.height=g,d.setTransform(1,0,0,1,0,0),d.clearRect(0,0,u,g),d.translate(i,r),d.rotate(n);for(let t=0,e=m-1;t<e&&!(n+t*b>s);t++){const e=y.getColor(t);d.beginPath(),d.rotate(b),d.moveTo(0,0),d.lineTo(f,-2*C),d.lineTo(f,0),d.fillStyle=e,d.closePath(),d.fill()}const w=d.getImageData(0,0,u,g);return c.width=w.width,c.height=w.height,d.putImageData(w,0,0),p=t.createPattern(c,"no-repeat"),p&&Ls.Set(e,i,r,n,s,p,u,g),p}(s,this.stops,t,e,h,i,r,a,l),n=!1),o}}}fill(t,e){this.disableFill||(t?this.nativeContext.fill(t):this.nativeContext.fill())}fillRect(t,e,i,r){this.nativeContext.fillRect(t,e,i,r)}clearRect(t,e,i,r){this.nativeContext.clearRect(t,e,i,r)}project(t,e,i){if(i=i||0,this.camera){this.modelMatrix&&(Wu(ip,[t,e,i],this.modelMatrix),t=ip[0],e=ip[1],i=ip[2]);const r=this.camera.vp(t,e,i);t=r.x,e=r.y}return{x:t,y:e}}view(t,e,i){return i=i||0,this.camera?(this.modelMatrix&&(Wu(ip,[t,e,i],this.modelMatrix),t=ip[0],e=ip[1],i=ip[2]),this.camera.view(t,e,i)):[t,e,i]}fillText(t,e,i,r){if(r=r||0,this.camera){this.modelMatrix&&(Wu(ip,[e,i,r],this.modelMatrix),e=ip[0],i=ip[1],r=ip[2]);const t=this.camera.vp(e,i,r);e=t.x,i=t.y}this.nativeContext.fillText(t,e,i)}getImageData(t,e,i,r){return this.nativeContext.getImageData(t,e,i,r)}getLineDash(){return this.nativeContext.getLineDash()}isPointInPath(t,e){return this.nativeContext.isPointInPath(t,e)}isPointInStroke(t,e){return this.nativeContext.isPointInStroke(t,e)}measureText(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kr.global.measureTextMethod;var i,r;if(!e||"native"===e)return this.nativeContext.measureText(t);this.mathTextMeasure||(this.mathTextMeasure=kr.graphicUtil.createTextMeasureInstance({},{},(()=>this.canvas.nativeCanvas)));const o=null!==(i=this.fontFamily)&&void 0!==i?i:pr.fontFamily,n=null!==(r=this.fontSize)&&void 0!==r?r:pr.fontSize;return this.mathTextMeasure.textSpec.fontFamily===o&&this.mathTextMeasure.textSpec.fontSize===n||(this.mathTextMeasure.textSpec.fontFamily=o,this.mathTextMeasure.textSpec.fontSize=n,this.mathTextMeasure._numberCharSize=null,this.mathTextMeasure._fullCharSize=null,this.mathTextMeasure._letterCharSize=null,this.mathTextMeasure._specialCharSizeMap={}),this.mathTextMeasure.measure(t,e)}putImageData(t,e,i){this.nativeContext.putImageData(t,e,i)}setLineDash(t){const e=arguments,i=this.nativeContext;this.nativeContext.setLineDash?i.setLineDash(e[0]):"mozDash"in i?i.mozDash=e[0]:"webkitLineDash"in i&&(i.webkitLineDash=e[0])}stroke(t){this.disableStroke||(t?this.nativeContext.stroke(t):this.nativeContext.stroke())}strokeRect(t,e,i,r){this.nativeContext.strokeRect(t,e,i,r)}strokeText(t,e,i,r){if(r=r||0,this.camera){this.modelMatrix&&(Wu(ip,[e,i,r],this.modelMatrix),e=ip[0],i=ip[1],r=ip[2]);const t=this.camera.vp(e,i,r);e=t.x,i=t.y}this.nativeContext.strokeText(t,e,i)}drawImage(){const t=this.nativeContext,e=arguments;3===e.length?t.drawImage(e[0],e[1],e[2]):5===e.length?t.drawImage(e[0],e[1],e[2],e[3],e[4]):9===e.length&&t.drawImage(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}setCommonStyle(t,e,i,r,o){if(Array.isArray(o)){if(o.length<=1)return this._setCommonStyle(t,e,i,r,o[0]);const n=Object.create(o[0]);return o.forEach(((t,e)=>{0!==e&&Object.assign(n,t)})),this._setCommonStyle(t,e,i,r,n)}return this._setCommonStyle(t,e,i,r,o)}_setCommonStyle(t,e,i,r,o){const n=this.nativeContext;o||(o=this.fillAttributes);const{fillOpacity:s=o.fillOpacity,opacity:a=o.opacity,fill:l=o.fill}=e;s>1e-12&&a>1e-12?(n.globalAlpha=s*a,n.fillStyle=bh(this,l,t,i,r)):n.globalAlpha=s*a}setShadowBlendStyle(t,e,i){if(Array.isArray(i)){if(i.length<=1)return this._setShadowBlendStyle(t,i[0]);const r=Object.create(i[0]);return i.forEach(((t,e)=>{0!==e&&Object.assign(r,t)})),this._setShadowBlendStyle(t,e,r)}return this._setShadowBlendStyle(t,e,i)}_setShadowBlendStyle(t,e,i){const r=this.nativeContext;i||(i=this.fillAttributes);const{opacity:o=i.opacity,shadowBlur:n=i.shadowBlur,shadowColor:s=i.shadowColor,shadowOffsetX:a=i.shadowOffsetX,shadowOffsetY:l=i.shadowOffsetY,blur:h=i.blur,globalCompositeOperation:c=i.globalCompositeOperation}=e;o<=1e-12||(n||a||l?(r.shadowBlur=n*this.dpr,r.shadowColor=s,r.shadowOffsetX=a*this.dpr,r.shadowOffsetY=l*this.dpr,this._clearShadowStyle=!0):this._clearShadowStyle&&(r.shadowBlur=0,r.shadowOffsetX=0,r.shadowOffsetY=0),h?(r.filter=`blur(${h}px)`,this._clearFilterStyle=!0):this._clearFilterStyle&&(r.filter="blur(0px)",this._clearFilterStyle=!1),c?(r.globalCompositeOperation=c,this._clearGlobalCompositeOperationStyle=!0):this._clearGlobalCompositeOperationStyle&&(r.globalCompositeOperation="source-over",this._clearGlobalCompositeOperationStyle=!1))}setStrokeStyle(t,e,i,r,o){if(Array.isArray(o)){if(o.length<=1)return this._setStrokeStyle(t,e,i,r,o[0]);const n=Object.create(o[0]);return o.forEach(((t,e)=>{0!==e&&Object.assign(n,t)})),this._setStrokeStyle(t,e,i,r,n)}return this._setStrokeStyle(t,e,i,r,o)}_setStrokeStyle(t,e,i,r,o){const n=this.nativeContext;o||(o=this.strokeAttributes);const{strokeOpacity:s=o.strokeOpacity,opacity:a=o.opacity}=e;if(s>1e-12&&a>1e-12){const{lineWidth:l=o.lineWidth,stroke:h=o.stroke,lineJoin:c=o.lineJoin,lineDash:d=o.lineDash,lineCap:u=o.lineCap,miterLimit:g=o.miterLimit}=e;n.globalAlpha=s*a,n.lineWidth=mh(this,l,this.dpr),n.strokeStyle=bh(this,h,t,i,r),n.lineJoin=c,n.setLineDash(d),n.lineCap=u,n.miterLimit=g}}setTextStyleWithoutAlignBaseline(t,e,i){const r=this.nativeContext;e||(e=this.textAttributes);const{scaleIn3d:o=e.scaleIn3d}=t;t.font?r.font=t.font:r.font=Ys(t,e,o&&this.camera&&this.camera.getProjectionScale(i));const{fontFamily:n=e.fontFamily,fontSize:s=e.fontSize}=t;this.fontFamily=n,this.fontSize=s,r.textAlign="left",r.textBaseline="alphabetic"}setTextStyle(t,e,i){var r,o;const n=this.nativeContext;e||(e=this.textAttributes),t.font?n.font=t.font:n.font=Ys(t,e,this.camera&&this.camera.getProjectionScale(i));const{fontFamily:s=e.fontFamily,fontSize:a=e.fontSize}=t;this.fontFamily=s,this.fontSize=a,n.textAlign=null!==(r=t.textAlign)&&void 0!==r?r:e.textAlign,n.textBaseline=null!==(o=t.textBaseline)&&void 0!==o?o:e.textBaseline}draw(){}clearMatrix(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.dpr;this.setTransformFromMatrix(this._clearMatrix,t,e)}setClearMatrix(t,e,i,r,o,n){this._clearMatrix.setValue(t,e,i,r,o,n)}onlyTranslate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.dpr;return this.matrix.a===t&&0===this.matrix.b&&0===this.matrix.c&&this.matrix.d===t}release(){this.stack.forEach((t=>Ql.free(t))),this.stack.length=0}};rp.env="browser",rp=tp([f(),ep("design:paramtypes",[Object,Number])],rp);var op=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},np=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let sp=class extends Zu{constructor(t){super(t)}init(t){const{container:e}=t;if("string"==typeof e){const t=kr.global.getElementById(e);t&&(this._container=t)}else this._container=e;this._context=new rp(this,this._dpr),this.initStyle()}initStyle(){if(!this.controled)return;const{nativeCanvas:t}=this;t.width=this._pixelWidth,t.height=this._pixelHeight,!t.style||this.setCanvasStyle(t,this._x,this._y,this._displayWidth,this._displayHeight),this._container&&this._container.appendChild(t),this.visiable||this.hide()}hide(){this._nativeCanvas&&(this._nativeCanvas.style.display="none")}show(){this._nativeCanvas&&(this._nativeCanvas.style.display="block")}applyPosition(){const t=this._nativeCanvas;t.style.position="absolute",t.style.top=`${this._y}px`,t.style.left=`${this._x}px`}resetStyle(t){if(!this.controled)return;const{width:e=this._displayWidth,height:i=this._displayHeight,dpr:r=this._dpr,x:o=this._x,y:n=this._y}=t,{nativeCanvas:s}=this;s.width=e*r,s.height=i*r,!s.style||this.setCanvasStyle(s,o,n,e,i),t.id&&(s.id=t.id),this.visiable||this.hide()}setCanvasStyle(t,e,i,r,o){this.controled&&(t.style.width=`${r}px`,t.style.height=`${o}px`)}toDataURL(t,e){return"image/jpeg"===t?this._nativeCanvas.toDataURL(t,e):"image/png"===t?this._nativeCanvas.toDataURL(t):this._nativeCanvas.toDataURL(t,e)}resize(t,e){this.controled&&(this._pixelWidth=t*this._dpr,this._pixelHeight=e*this._dpr,this._displayWidth=t,this._displayHeight=e,this._nativeCanvas.style&&(this._nativeCanvas.style.width=`${t}px`,this._nativeCanvas.style.height=`${e}px`),this._nativeCanvas.width=this._pixelWidth,this._nativeCanvas.height=this._pixelHeight,this._context.dpr=this._dpr)}};function ap(t,e){return new i((i=>{i(Yr).toDynamicValue((()=>e=>new t(e))).whenTargetNamed(t.env),i(qr).toDynamicValue((()=>(t,i)=>new e(t,i))).whenTargetNamed(e.env)}))}sp.env="browser",sp=op([f(),np("design:paramtypes",[Object])],sp);const lp=ap(sp,rp),hp=Symbol.for("MathPickerContribution"),cp=Symbol.for("MathArcPicker"),dp=Symbol.for("MathAreaPicker"),up=Symbol.for("MathCirclePicker"),gp=Symbol.for("MathImagePicker"),pp=Symbol.for("MathLinePicker"),fp=Symbol.for("MathPathPicker"),mp=Symbol.for("MathRectPicker"),bp=Symbol.for("MathSymbolPicker"),yp=Symbol.for("MathTextPicker"),Cp=Symbol.for("MathPolygonPicker"),wp=Symbol.for("MathGlyphPicker"),vp=Symbol.for("CanvasArcPicker"),xp=Symbol.for("CanvasArc3dPicker"),_p=Symbol.for("CanvasAreaPicker"),Sp=Symbol.for("CanvasCirclePicker"),Ap=Symbol.for("CanvasImagePicker"),Rp=Symbol.for("CanvasLinePicker"),Bp=Symbol.for("CanvasPathPicker"),Mp=Symbol.for("CanvasRectPicker"),Tp=Symbol.for("CanvasRect3dPicker"),Pp=Symbol.for("CanvasSymbolPicker"),Hp=Symbol.for("CanvasTextPicker"),Ep=Symbol.for("CanvasPolygonPicker"),kp=Symbol.for("CanvasPyramid3dPicker"),Lp=Symbol.for("CanvasRichTextPicker"),Fp=Symbol.for("CanvasGlyphPicker"),Ip=Symbol.for("CanvasGroupPicker"),zp=Symbol.for("CanvasPickerContribution");var Op=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Dp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Wp=function(t,e){return function(i,r){e(i,r,t)}};let Np=class extends sg{constructor(t,e,i){super(i),this.contributions=t,this.drawContribution=e,this.pickItemInterceptorContributions=i,this.global.hooks.onSetEnv.tap("canvas-picker-service",((t,e,i)=>{this.configure(i,e)})),this.configure(this.global,this.global.env),this.pickerMap=new Map,this.init()}init(){this.contributions.getContributions().forEach((t=>{this.pickerMap.set(t.numberType,t)})),super._init()}configure(t,e){this.pickCanvas=Jr.shareCanvas(),this.pickContext=this.pickCanvas.getContext("2d")}pickItem(t,e,i,r){if(!1===t.attribute.pickable)return null;if(this.InterceptorContributions.length)for(let o=0;o<this.InterceptorContributions.length;o++){const n=this.InterceptorContributions[o];if(n.beforePickItem){const o=n.beforePickItem(t,this,e,r,{parentMatrix:i});if(o)return o}}const o=this.pickerMap.get(t.numberType);if(!o)return null;const n=o.contains(t,e,r)?t:null,s={graphic:n};if(n)return s;if(this.InterceptorContributions.length)for(let o=0;o<this.InterceptorContributions.length;o++){const n=this.InterceptorContributions[o];if(n.afterPickItem){const o=n.afterPickItem(t,this,e,r,{parentMatrix:i});if(o)return o}}return s}};Np=Op([f(),Wp(0,g(H)),Wp(0,m(zp)),Wp(1,g(cd)),Wp(2,g(H)),Wp(2,m(Td)),Dp("design:paramtypes",[Object,Object,Object])],Np);var Gp=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let jp=class{constructor(){this.type="group",this.numberType=$n}contains(t,e,i){return!1}};jp=Gp([f()],jp);const Vp=new i(((t,e,i,r)=>{Vp.__vloaded||(Vp.__vloaded=!0,t(Ip).to(jp).inSingletonScope(),t(zp).toService(Ip),k(t,zp))}));Vp.__vloaded=!1;var Up=Vp;const Kp=new i(((t,e,i,r)=>{i(Np)||t(Np).toSelf().inSingletonScope(),i(Rd)?r(Rd).toService(Np):t(Rd).toService(Np)}));var $p,Xp=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Yp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let qp=$p=class extends ig{get container(){return this.canvas.nativeCanvas.parentElement}static GenerateCanvasId(){return`${$p.idprefix}_${$p.prefix_count++}`}constructor(){super(),this.type="browser",this._canvasIsIntersecting=!0,this.global=kr.global,this.viewBox=new ue,this.modelMatrix=new fe(1,0,0,1,0,0)}getTitle(){return this.canvas.id&&this.canvas.id.toString()}getWH(){return{width:this.canvas.width/(this.canvas.dpr||1),height:this.canvas.height/(this.canvas.dpr||1)}}getXY(){return this.canvas.nativeCanvas.getBoundingClientRect()}createWindow(t){t.canvas?this.createWindowByCanvas(t):this.createWindowByConfig(t),this.postInit()}postInit(){if(this.global.optimizeVisible)try{this.observerCanvas()}catch(t){}}isElementVisible(t){const e=t.getBoundingClientRect(),i=window.innerWidth||document.documentElement.clientWidth,r=window.innerHeight||document.documentElement.clientHeight;return!(e.right<0||e.bottom<0||e.left>i||e.top>r)}observerCanvas(){this._canvasIsIntersecting=this.isElementVisible(this.canvas.nativeCanvas);const t=new IntersectionObserver(((t,e)=>{t.forEach((t=>{this._canvasIsIntersecting!==t.isIntersecting?(this._canvasIsIntersecting=t.isIntersecting,this._onVisibleChangeCb&&this._onVisibleChangeCb(t.isIntersecting)):this._canvasIsIntersecting=t.isIntersecting}))}));t&&t.observe(this.canvas.nativeCanvas)}createWindowByConfig(t){const e=this.global.createCanvas({width:t.width,height:t.height});let i;if(i="string"==typeof t.container?this.global.getElementById(t.container):t.container?t.container:this.global.getRootElement(),!i)throw new Error("发生错误，containerId可能传入有误");t.offscreen?i=null:i.appendChild(e);const r={width:t.width,height:t.height,dpr:t.dpr,nativeCanvas:e,container:i,id:$p.GenerateCanvasId(),canvasControled:!0};this.canvas=new sp(r)}createWindowByCanvas(t){var e;let i;if("string"==typeof t.canvas){if(i=this.global.getElementById(t.canvas),!i)throw new Error("canvasId 参数不正确，请确认canvas存在并插入dom")}else i=t.canvas;if(!i)throw new Error("发生错误，传入的canvas不正确");let r=t.width,o=t.height;if(null==r||null==o||!t.canvasControled){const t=i.getBoundingClientRect();r=t.width,o=t.height}let n=t.dpr;null==n&&(n=null!==(e=i.getContext("2d").pixelRatio)&&void 0!==e?e:i.width/r),this.canvas=new sp({width:r,height:o,dpr:n,nativeCanvas:i,canvasControled:t.canvasControled})}releaseWindow(){this.canvas.release()}resizeWindow(t,e){this.canvas.resize(t,e)}setDpr(t){this.canvas.dpr=t}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}addEventListener(t,e,i){return this.canvas.nativeCanvas.addEventListener(t,e,i)}removeEventListener(t,e,i){return this.canvas.nativeCanvas.removeEventListener(t,e,i)}dispatchEvent(t){return this.canvas.nativeCanvas.dispatchEvent(t)}getStyle(){var t;return null!==(t=this.canvas.nativeCanvas.style)&&void 0!==t?t:{}}setStyle(t){this.canvas.nativeCanvas.style=t}getBoundingClientRect(){const t=this.canvas.nativeCanvas,e=this.getWH();return t.parentElement?this.canvas.nativeCanvas.getBoundingClientRect():{x:0,y:0,width:e.width,height:e.height,left:0,top:0,right:0,bottom:0}}clearViewBox(t){const e=this.viewBox,i=this.getContext(),r=this.getDpr();i.nativeContext.save(),i.nativeContext.setTransform(r,0,0,r,0,0),i.clearRect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1),t&&(i.fillStyle=t,i.fillRect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1)),i.nativeContext.restore()}isVisible(t){return this._canvasIsIntersecting}onVisibleChange(t){this._onVisibleChangeCb=t}getTopLeft(t){return this.global.getElementTopLeft(this.canvas.nativeCanvas,t)}};qp.env="browser",qp.idprefix="visactor_window",qp.prefix_count=0,qp=$p=Xp([f(),Yp("design:paramtypes",[])],qp);const Zp=new i((t=>{t(qp).toSelf(),t(io).toDynamicValue((t=>t.container.get(qp))).whenTargetNamed(qp.env)}));var Jp=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Qp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};class tf{get x1(){return this.dom.getBoundingClientRect().left}get x2(){return this.dom.getBoundingClientRect().right}get y1(){return this.dom.getBoundingClientRect().top}get y2(){return this.dom.getBoundingClientRect().bottom}get width(){return this.dom.getBoundingClientRect().width}get height(){return this.dom.getBoundingClientRect().height}constructor(t){this.dom=t}}function ef(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=document.createElement("img");if(i.crossOrigin="anonymous",e){const e=new Blob([t],{type:"image/svg+xml"});t=window.URL.createObjectURL(e)}return i.src=t,i.complete?Promise.resolve(i):new Promise(((t,e)=>{i.onload=()=>{t(i)},i.onerror=()=>{e(new Error("加载失败"))}}))}let rf=class extends Qu{constructor(){super(),this.type="browser",this.supportEvent=!0;try{this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.supportsMouseEvents=!!globalThis.MouseEvent}catch(t){this.supportsTouchEvents=!1,this.supportsPointerEvents=!1,this.supportsPointerEvents=!1}this.applyStyles=!0}mapToCanvasPoint(t,e){var i,r;let o=0,n=0,s=0,a=0;if(t.changedTouches){const e=null!==(i=t.changedTouches[0])&&void 0!==i?i:{};o=e.clientX||0,n=e.clientY||0,s=o,a=n}else o=t.clientX||0,n=t.clientY||0,s=t.offsetX||0,a=t.offsetY||0;if(e){const t=o,i=n,s=e.getBoundingClientRect(),a=null===(r=e.getNativeHandler)||void 0===r?void 0:r.call(e).nativeCanvas;let l,h;return a&&(l=s.width/a.offsetWidth,h=s.height/a.offsetHeight),{x:(t-s.left)/(nt(l)?l:1),y:(i-s.top)/(nt(h)?h:1)}}return{x:s,y:a}}getNativeAABBBounds(t){let e=t;if("string"==typeof t&&(e=(new DOMParser).parseFromString(t,"text/html").firstChild,e.lastChild&&(e=e.lastChild.firstChild)),e.getBoundingClientRect){const t=e.getBoundingClientRect();return new tf(t)}return new ue}removeDom(t){return t.parentElement.removeChild(t),!0}createDom(t){const{tagName:e="div",width:i,height:r,style:o,parent:n}=t,s=document.createElement(e);if(o&&(tt(o)?s.setAttribute("style",o):Object.keys(o).forEach((t=>{s.setAttribute(t,o[t])}))),null!=i&&(s.style.width=`${i}px`),null!=r&&(s.style.height=`${r}px`),n){const t=tt(n)?this.getElementById(n):n;t&&t.appendChild&&t.appendChild(s)}return s}loadImage(t){return ef(t,!1).then((t=>({data:t,loadState:"success"}))).catch((()=>({data:null,loadState:"fail"})))}loadSvg(t){return ef(t,!0).then((t=>({data:t,loadState:"success"}))).catch((()=>({data:null,loadState:"fail"})))}createCanvas(t){var i,r;const o=document.createElement("canvas");t.id&&(o.id=null!==(i=t.id)&&void 0!==i?i:e.GenAutoIncrementId().toString());const n=null!==(r=t.dpr)&&void 0!==r?r:window.devicePixelRatio;return t.width&&t.height&&(o.style.width=`${t.width}px`,o.style.height=`${t.height}px`,o.width=t.width*n,o.height=t.height*n),o}createOffscreenCanvas(t){var e;const i=null!==(e=t.dpr)&&void 0!==e?e:window.devicePixelRatio;return new OffscreenCanvas(t.width*i,t.height*i)}releaseCanvas(t){let e;e="string"==typeof t?document.getElementById(t):t,e&&e.parentElement&&e.parentElement.removeChild(e)}getDevicePixelRatio(){return window.devicePixelRatio}getRequestAnimationFrame(){return window.requestAnimationFrame}getCancelAnimationFrame(){return window.cancelAnimationFrame}addEventListener(t,e,i){return document.addEventListener(t,e,i)}removeEventListener(t,e,i){return document.removeEventListener(t,e,i)}dispatchEvent(t){return document.dispatchEvent(t)}getElementById(t){return document.getElementById(t)}getRootElement(){return document.body}getDocument(){return document}release(){}getElementTop(t,e){let i=t.offsetTop,r=t.offsetParent;for(;null!==r;)i+=r.offsetTop,r=r.offsetParent;return i}getElementLeft(t,e){let i=t.offsetLeft,r=t.offsetParent;for(;null!==r;)i+=r.offsetLeft,r=r.offsetParent;return i}getElementTopLeft(t,e){let i=t.offsetTop,r=t.offsetLeft,o=t.offsetParent;for(;null!==o;)i+=o.offsetTop,r+=o.offsetLeft,o=o.offsetParent;return{top:i,left:r}}};rf=Jp([f(),Qp("design:paramtypes",[])],rf);const of=new i((t=>{of.isBrowserBound||(of.isBrowserBound=!0,t(rf).toSelf().inSingletonScope(),t(I).toService(rf))}));function nf(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];nf.__loaded||(nf.__loaded=!0,t.load(of),t.load(lp),t.load(Zp),e&&function(t){t.load(Up),t.load(Kp)}(t))}of.isBrowserBound=!1,nf.__loaded=!1;var sf=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},af=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let lf=class extends rp{constructor(t,e){super(t,e);const i=t.nativeCanvas.getContext("2d");if(!i)throw new Error("发生错误，获取2d上下文失败");this.nativeContext=i,this.canvas=t,this.matrix=new fe(1,0,0,1,0,0),this.stack=[],this.dpr=null!=e?e:1}release(){}};lf.env="node",lf=sf([f(),af("design:paramtypes",[Object,Number])],lf);var hf=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},cf=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let df=class extends Zu{constructor(t){super(t)}init(){this._context=new lf(this,this._dpr),this.nativeCanvas.width=this._pixelWidth,this.nativeCanvas.height=this._pixelHeight}release(){this._nativeCanvas.release&&$(this._nativeCanvas.release)&&this._nativeCanvas.release()}};df.env="node",df=hf([f(),cf("design:paramtypes",[Object])],df);const uf=ap(df,lf);var gf=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},pf=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ff=function(t,e){return function(i,r){e(i,r,t)}};let mf=class extends ig{get container(){return null}constructor(t){super(),this.global=t,this.type="node"}getTitle(){return""}getWH(){return{width:this.canvas.displayWidth,height:this.canvas.displayHeight}}getXY(){return{x:0,y:0}}createWindow(t){t.canvas?this.createWindowByCanvas(t):this.createWindowByConfig(t)}createWindowByConfig(t){const i=this.global.createCanvas({width:t.width,height:t.height}),r={width:t.width,height:t.height,dpr:t.dpr,nativeCanvas:i,id:e.GenAutoIncrementId().toString(),canvasControled:!0};this.canvas=new df(r)}createWindowByCanvas(t){const e=t.canvas;let i=t.width,r=t.height;null!=i&&null!=r&&t.canvasControled||(i=e.width,r=e.height),this.canvas=new df({width:i,height:r,dpr:1,nativeCanvas:e,canvasControled:t.canvasControled})}releaseWindow(){this.canvas.release()}resizeWindow(t,e){this.canvas.resize(t,e)}setDpr(t){this.canvas.dpr=t}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}getImageBuffer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/png";return this.canvas.nativeCanvas.toBuffer(t)}addEventListener(t,e,i){}dispatchEvent(t){return!0}removeEventListener(t,e,i){}getStyle(){}setStyle(t){}getBoundingClientRect(){return null}clearViewBox(t){}};mf.env="node",mf=gf([f(),ff(0,g(z)),pf("design:paramtypes",[Object])],mf);const bf=new i((t=>{t(mf).toSelf(),t(io).toDynamicValue((t=>t.container.get(mf))).whenTargetNamed(mf.env)}));var yf=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let Cf=class extends Qu{constructor(){super(...arguments),this.type="node",this._lastTime=0,this.supportEvent=!1}configure(t,e){t.env===this.type&&(t.setActiveEnvContribution(this),this.pkg=e)}getDynamicCanvasCount(){return 0}getStaticCanvasCount(){return 999}loadJson(t){const e=fetch(t).then((t=>t.json()));return e.then((t=>({data:t,state:"success"}))).catch((()=>({data:null,state:"fail"}))),e}loadArrayBuffer(t){return fetch(t).then((t=>t.arrayBuffer())).then((t=>({data:t,loadState:"success"}))).catch((()=>({data:null,loadState:"fail"})))}loadImage(t){const{loadImage:e}=this.pkg;return e?e(t).then((t=>({loadState:t?"success":"fail",data:t}))).catch((()=>({loadState:"fail",data:null}))):Promise.reject(new Error("node-canvas loadImage could not be found!"))}loadSvg(t){const e=this.pkg.Resvg;if(!e)return Promise.reject(new Error("@resvg/resvg-js svgParser could not be found!"));const i=new e(t).render().asPng();return this.loadImage(i)}createCanvas(t){return this.pkg.createCanvas(t.width,t.height)}releaseCanvas(t){}getDevicePixelRatio(){return 1}getRequestAnimationFrame(){return function(t){return rn.call(t)}}getCancelAnimationFrame(){return t=>{rn.clear(t)}}addEventListener(t,e,i){}removeEventListener(t,e,i){}getElementById(t){return null}getRootElement(){return null}dispatchEvent(t){}release(){}createOffscreenCanvas(t){}};Cf=yf([f()],Cf);const wf=new i((t=>{wf.isNodeBound||(wf.isNodeBound=!0,t(Cf).toSelf().inSingletonScope(),t(I).toService(Cf))}));function vf(t){vf.__loaded||(vf.__loaded=!0,t.load(wf),t.load(uf),t.load(bf))}wf.isNodeBound=!1,vf.__loaded=!1;var xf=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},_f=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Sf=function(t,e){return function(i,r){e(i,r,t)}};let Af=class{constructor(t){this.canvasRenderer=t,this.type="arc",this.numberType=Gn}contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if("imprecise"===t.attribute.pickMode)return!0;const{pickContext:r}=null!=i?i:{};if(!r)return!1;const o=yo(t).arc;r.highPerformanceSave();let{x:n=o.x,y:s=o.y}=t.attribute;if(t.transMatrix.onlyTranslate()){const e=t.getOffsetXY(o);n+=e.x,s+=e.y,r.setTransformForCurrent()}else n=0,s=0,r.transformFromMatrix(t.transMatrix,!0);let a=!1;return this.canvasRenderer.drawShape(t,r,n,s,{},null,((t,i,r)=>!!a||(a=t.isPointInPath(e.x,e.y),a)),((t,i,o)=>{if(a)return!0;const n=i.lineWidth||o.lineWidth,s=i.pickStrokeBuffer||o.pickStrokeBuffer;return r.lineWidth=mh(r,n+s,r.dpr),a=t.isPointInStroke(e.x,e.y),a})),r.highPerformanceRestore(),a}};Af=xf([f(),Sf(0,g($c)),_f("design:paramtypes",[Object])],Af);let Rf=!1;const Bf=new i(((t,e,i,r)=>{Rf||(Rf=!0,t(vp).to(Af).inSingletonScope(),t(zp).toService(vp))}));var Mf=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Tf=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Pf=function(t,e){return function(i,r){e(i,r,t)}};let Hf=class{constructor(t){this.canvasRenderer=t,this.type="arc",this.numberType=Gn}contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if("imprecise"===t.attribute.pickMode)return!0;const{pickContext:r}=null!=i?i:{};if(!r)return!1;const o=yo(t).arc;r.highPerformanceSave();let{x:n=o.x,y:s=o.y}=t.attribute;if(t.transMatrix.onlyTranslate()){const e=t.getOffsetXY(o);n+=e.x,s+=e.y,r.setTransformForCurrent()}else n=0,s=0,r.transformFromMatrix(t.transMatrix,!0);let a=!1;return this.canvasRenderer.drawShape(t,r,n,s,{},null,((t,i,r)=>!!a||(a=t.isPointInPath(e.x,e.y),a)),((t,i,o)=>{if(a)return!0;const n=i.lineWidth||o.lineWidth,s=i.pickStrokeBuffer||o.pickStrokeBuffer;return r.lineWidth=n+s,a=t.isPointInStroke(e.x,e.y),a})),r.highPerformanceRestore(),a}};Hf=Mf([f(),Pf(0,g($c)),Tf("design:paramtypes",[Object])],Hf);let Ef=!1;const kf=new i(((t,e,i,r)=>{Ef||(Ef=!0,t(cp).to(Hf).inSingletonScope(),t(hp).toService(cp))}));var Lf=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Ff=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},If=function(t,e){return function(i,r){e(i,r,t)}};const zf=new ue;let Of=class{constructor(t){this.canvasRenderer=t,this.type="rect",this.numberType=Qn}contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if("imprecise"===t.attribute.pickMode)return!0;const{pickContext:r}=null!=i?i:{};if(!r)return!1;const o=yo(t).rect,{cornerRadius:n=o.cornerRadius}=t.attribute;let{x:s=o.x,y:a=o.y}=t.attribute;r.highPerformanceSave();let l=!0;if(t.transMatrix.onlyTranslate()){const e=t.getOffsetXY(o);s+=e.x,a+=e.y,r.setTransformForCurrent()}else s=0,a=0,l=!1,r.transformFromMatrix(t.transMatrix,!0);let h=!0;if(!l||t.shadowRoot||ot(n,!0)&&0!==n||et(n)&&n.some((t=>0!==t)))h=!1,this.canvasRenderer.drawShape(t,r,s,a,{},null,((t,i,r)=>!!h||(h=t.isPointInPath(e.x,e.y),h)),((t,i,o)=>{if(h)return!0;const n=i.lineWidth||o.lineWidth,s=i.pickStrokeBuffer||o.pickStrokeBuffer;return r.lineWidth=mh(r,n+s,r.dpr),h=t.isPointInStroke(e.x,e.y),h}));else{const{fill:i=o.fill,stroke:r=o.stroke,lineWidth:n=o.lineWidth}=t.attribute;if(i)h=!0;else if(r){const i=t.AABBBounds;zf.setValue(i.x1,i.y1,i.x2,i.y2),zf.expand(-n/2),h=!zf.containsPoint(e)}}return r.highPerformanceRestore(),h}};Of=Lf([f(),If(0,g(id)),Ff("design:paramtypes",[Object])],Of);let Df=!1;const Wf=new i(((t,e,i,r)=>{Df||(Df=!0,t(Mp).to(Of).inSingletonScope(),t(zp).toService(Mp))}));var Nf=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Gf=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},jf=function(t,e){return function(i,r){e(i,r,t)}};const Vf=new ue;let Uf=class{constructor(t){this.canvasRenderer=t,this.type="rect",this.numberType=Qn}contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if("imprecise"===t.attribute.pickMode)return!0;const{pickContext:r}=null!=i?i:{};if(!r)return!1;const o=yo(t).rect,{cornerRadius:n=o.cornerRadius}=t.attribute;let{x:s=o.x,y:a=o.y}=t.attribute;r.highPerformanceSave();let l=!0;if(t.transMatrix.onlyTranslate()){const e=t.getOffsetXY(o);s+=e.x,a+=e.y,r.setTransformForCurrent()}else s=0,a=0,l=!1,r.transformFromMatrix(t.transMatrix,!0);let h=!0;if(!l||ot(n,!0)&&0!==n||et(n)&&n.some((t=>0!==t)))h=!1,this.canvasRenderer.drawShape(t,r,s,a,{},null,((t,i,r)=>!!h||(h=t.isPointInPath(e.x,e.y),h)),((t,i,o)=>{if(h)return!0;const n=i.lineWidth||o.lineWidth,s=i.pickStrokeBuffer||o.pickStrokeBuffer;return r.lineWidth=n+s,h=t.isPointInStroke(e.x,e.y),h}));else if(h){const{fill:i=o.fill,stroke:r=o.stroke,lineWidth:n=o.lineWidth}=t.attribute;if(i)h=!0;else if(r){const i=t.AABBBounds;Vf.setValue(i.x1,i.y1,i.x2,i.y2),Vf.expand(-n/2),h=!Vf.containsPoint(e)}}return r.highPerformanceRestore(),h}};Uf=Nf([f(),jf(0,g(id)),Gf("design:paramtypes",[Object])],Uf);let Kf=!1;const $f=new i(((t,e,i,r)=>{Kf||(Kf=!0,t(mp).to(Uf).inSingletonScope(),t(hp).toService(mp))}));var Xf=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let Yf=class extends gh{};Yf=Xf([f()],Yf);var qf=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Zf=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Jf=function(t,e){return function(i,r){e(i,r,t)}};let Qf=class extends Yf{constructor(t){super(),this.canvasRenderer=t,this.type="line",this.numberType=Yn}contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if("imprecise"===t.attribute.pickMode)return!0;const{pickContext:r}=null!=i?i:{};if(!r)return!1;r.highPerformanceSave();const o=yo(t).line,n=this.transform(t,o,r),{x:s,y:a,z:l,lastModelMatrix:h}=n;let c=e;if(r.camera){c=e.clone();const i=t.parent.globalTransMatrix;c.x=i.a*e.x+i.c*e.y+i.e,c.y=i.b*e.x+i.d*e.y+i.f}this.canvasRenderer.z=l;let d=!1;return this.canvasRenderer.drawShape(t,r,s,a,{},null,(t=>!!d||(d=t.isPointInPath(c.x,c.y),d)),((t,e,i)=>{if(d)return!0;const o=e.lineWidth||i.lineWidth,n=e.pickStrokeBuffer||i.pickStrokeBuffer;return r.lineWidth=mh(r,o+n,r.dpr),d=t.isPointInStroke(c.x,c.y),d})),this.canvasRenderer.z=0,r.modelMatrix!==h&&th.free(r.modelMatrix),r.modelMatrix=h,r.highPerformanceRestore(),d}};Qf=qf([f(),Jf(0,g(Qc)),Zf("design:paramtypes",[Object])],Qf);let tm=!1;const em=new i(((t,e,i,r)=>{tm||(tm=!0,t(Rp).to(Qf).inSingletonScope(),t(zp).toService(Rp))}));var im=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},rm=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},om=function(t,e){return function(i,r){e(i,r,t)}};let nm=class{constructor(t){this.canvasRenderer=t,this.type="line",this.numberType=Yn}contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if("imprecise"===t.attribute.pickMode)return!0;const{pickContext:r}=null!=i?i:{};if(!r)return!1;const o=yo(t).line;let{x:n=o.x,y:s=o.y}=t.attribute;if(r.highPerformanceSave(),t.transMatrix.onlyTranslate()){const e=t.getOffsetXY(o);n+=e.x,s+=e.y,r.setTransformForCurrent()}else n=0,s=0,r.transformFromMatrix(t.transMatrix,!0);let a=!1;return this.canvasRenderer.drawShape(t,r,n,s,{},null,(t=>!!a||(a=t.isPointInPath(e.x,e.y),a)),((t,i,o)=>{if(a)return!0;const n=i.lineWidth||o.lineWidth,s=i.pickStrokeBuffer||o.pickStrokeBuffer;return r.lineWidth=n+s,a=t.isPointInStroke(e.x,e.y),a})),r.highPerformanceRestore(),a}};nm=im([f(),om(0,g(Qc)),rm("design:paramtypes",[Object])],nm);let sm=!1;const am=new i(((t,e,i,r)=>{sm||(sm=!0,t(pp).to(nm).inSingletonScope(),t(hp).toService(pp))}));var lm=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},hm=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},cm=function(t,e){return function(i,r){e(i,r,t)}};let dm=class{constructor(t){this.canvasRenderer=t,this.type="area",this.numberType=Vn}contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if("imprecise"===t.attribute.pickMode)return!0;const{pickContext:r}=null!=i?i:{};if(!r)return!1;const o=yo(t).area;let{x:n=o.x,y:s=o.y}=t.attribute;const{fillPickable:a=o.fillPickable,strokePickable:l=o.strokePickable}=t.attribute;if(r.highPerformanceSave(),t.transMatrix.onlyTranslate()){const e=t.getOffsetXY(o);n+=e.x,s+=e.y,r.setTransformForCurrent()}else n=0,s=0,r.transformFromMatrix(t.transMatrix,!0);let h=!1;return this.canvasRenderer.drawShape(t,r,n,s,{},null,(t=>!!h||!!a&&(h=t.isPointInPath(e.x,e.y),h)),((t,i,o)=>{if(h)return!0;if(!l)return!1;const n=i.lineWidth||o.lineWidth,s=i.pickStrokeBuffer||o.pickStrokeBuffer;return r.lineWidth=mh(r,n+s,r.dpr),h=t.isPointInStroke(e.x,e.y),h})),r.highPerformanceRestore(),h}};dm=lm([f(),cm(0,g(Yc)),hm("design:paramtypes",[Object])],dm);let um=!1;const gm=new i(((t,e,i,r)=>{um||(um=!0,t(_p).to(dm).inSingletonScope(),t(zp).toService(_p))}));var pm=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},fm=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},mm=function(t,e){return function(i,r){e(i,r,t)}};let bm=class{constructor(t){this.canvasRenderer=t,this.type="area",this.numberType=Vn}contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if("imprecise"===t.attribute.pickMode)return!0;const{pickContext:r}=null!=i?i:{};if(!r)return!1;const o=yo(t).area;let{x:n=o.x,y:s=o.y}=t.attribute;if(r.highPerformanceSave(),t.transMatrix.onlyTranslate()){const e=t.getOffsetXY(o);n+=e.x,s+=e.y,r.setTransformForCurrent()}else n=0,s=0,r.transformFromMatrix(t.transMatrix,!0);let a=!1;return this.canvasRenderer.drawShape(t,r,n,s,{},null,(t=>!!a||(a=t.isPointInPath(e.x,e.y),a))),r.highPerformanceRestore(),a}};bm=pm([f(),mm(0,g(Yc)),fm("design:paramtypes",[Object])],bm);let ym=!1;const Cm=new i(((t,e,i,r)=>{ym||(ym=!0,t(dp).to(bm).inSingletonScope(),t(hp).toService(dp))}));var wm=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},vm=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},xm=function(t,e){return function(i,r){e(i,r,t)}};let _m=class extends Yf{constructor(t){super(),this.canvasRenderer=t,this.type="symbol",this.numberType=is}contains(t,e,i){const{pickContext:r}=null!=i?i:{};if(!r)return!1;const o=t.getParsedPath();if(!r.camera){if(!t.AABBBounds.containsPoint(e))return!1;if(o.isSvg||"imprecise"===t.attribute.pickMode)return!0}r.highPerformanceSave();const n=yo(t).symbol,s=this.transform(t,n,r),{x:a,y:l,z:h,lastModelMatrix:c}=s;let d=e;if(r.camera){d=e.clone();const i=t.parent.globalTransMatrix;d.x=i.a*e.x+i.c*e.y+i.e,d.y=i.b*e.x+i.d*e.y+i.f}this.canvasRenderer.z=h;let u=!1;return this.canvasRenderer.drawShape(t,r,a,l,{},null,((t,e,i)=>!!u||(u=t.isPointInPath(d.x,d.y),u)),((t,e,i)=>{if(u)return!0;const o=e.lineWidth||i.lineWidth,n=e.pickStrokeBuffer||i.pickStrokeBuffer;return r.lineWidth=mh(r,o+n,r.dpr),u=t.isPointInStroke(d.x,d.y),u})),this.canvasRenderer.z=0,r.modelMatrix!==c&&th.free(r.modelMatrix),r.modelMatrix=c,r.highPerformanceRestore(),u}};_m=wm([f(),xm(0,g(od)),vm("design:paramtypes",[Object])],_m);let Sm=!1;const Am=new i(((t,e,i,r)=>{Sm||(Sm=!0,t(Pp).to(_m).inSingletonScope(),t(zp).toService(Pp))}));var Rm=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Bm=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Mm=function(t,e){return function(i,r){e(i,r,t)}};let Tm=class{constructor(t){this.canvasRenderer=t,this.type="symbol",this.numberType=is}contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if("imprecise"===t.attribute.pickMode)return!0;const{pickContext:r}=null!=i?i:{};if(!r)return!1;const o=yo(t).symbol;let{x:n=o.x,y:s=o.y}=t.attribute;if(r.highPerformanceSave(),t.transMatrix.onlyTranslate()){const e=t.getOffsetXY(o);n+=e.x,s+=e.y,r.setTransformForCurrent()}else n=0,s=0,r.transformFromMatrix(t.transMatrix,!0);let a=!1;return this.canvasRenderer.drawShape(t,r,n,s,{},null,((t,i,r)=>!!a||(a=t.isPointInPath(e.x,e.y),a)),((t,i,o)=>{if(a)return!0;const n=i.lineWidth||o.lineWidth,s=i.pickStrokeBuffer||o.pickStrokeBuffer;return r.lineWidth=n+s,a=t.isPointInStroke(e.x,e.y),a})),r.highPerformanceRestore(),a}};Tm=Rm([f(),Mm(0,g(od)),Bm("design:paramtypes",[Object])],Tm);let Pm=!1;const Hm=new i(((t,e,i,r)=>{Pm||(Pm=!0,t(bp).to(Tm).inSingletonScope(),t(hp).toService(bp))}));var Em=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},km=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Lm=function(t,e){return function(i,r){e(i,r,t)}};let Fm=class{constructor(t){this.canvasRenderer=t,this.type="circle",this.numberType=Un}contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if("imprecise"===t.attribute.pickMode)return!0;const{pickContext:r}=null!=i?i:{};if(!r)return!1;const o=yo(t).circle;let{x:n=o.x,y:s=o.y}=t.attribute;if(r.highPerformanceSave(),t.transMatrix.onlyTranslate()){const e=t.getOffsetXY(o);n+=e.x,s+=e.y,r.setTransformForCurrent()}else n=0,s=0,r.transformFromMatrix(t.transMatrix,!0);let a=!1;return this.canvasRenderer.drawShape(t,r,n,s,{},null,((t,i,r)=>!!a||(a=t.isPointInPath(e.x,e.y),a)),((t,i,o)=>{if(a)return!0;const n=i.lineWidth||o.lineWidth,s=i.pickStrokeBuffer||o.pickStrokeBuffer;return r.lineWidth=mh(r,n+s,r.dpr),a=t.isPointInStroke(e.x,e.y),a})),r.highPerformanceRestore(),a}};Fm=Em([f(),Lm(0,g(qc)),km("design:paramtypes",[Object])],Fm);let Im=!1;const zm=new i(((t,e,i,r)=>{Im||(Im=!0,t(Sp).to(Fm).inSingletonScope(),t(zp).toService(Sp))}));var Om=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Dm=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Wm=function(t,e){return function(i,r){e(i,r,t)}};let Nm=class{constructor(t){this.canvasRenderer=t,this.type="circle",this.numberType=Un}contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if("imprecise"===t.attribute.pickMode)return!0;const{pickContext:r}=null!=i?i:{};if(!r)return!1;const o=yo(t).circle;let{x:n=o.x,y:s=o.y}=t.attribute;if(r.highPerformanceSave(),t.transMatrix.onlyTranslate()){const e=t.getOffsetXY(o);n+=e.x,s+=e.y,r.setTransformForCurrent()}else n=0,s=0,r.transformFromMatrix(t.transMatrix,!0);let a=!1;return this.canvasRenderer.drawShape(t,r,n,s,{},null,((t,i,r)=>!!a||(a=t.isPointInPath(e.x,e.y),a)),((t,i,o)=>{if(a)return!0;const n=i.lineWidth||o.lineWidth,s=i.pickStrokeBuffer||o.pickStrokeBuffer;return r.lineWidth=n+s,a=t.isPointInStroke(e.x,e.y),a})),r.highPerformanceRestore(),a}};Nm=Om([f(),Wm(0,g(qc)),Dm("design:paramtypes",[Object])],Nm);let Gm=!1;const jm=new i(((t,e,i,r)=>{Gm||(Gm=!0,t(up).to(Nm).inSingletonScope(),t(hp).toService(up))}));var Vm=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Um=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Km=function(t,e){return function(i,r){e(i,r,t)}};let $m=class extends Yf{constructor(t){super(),this.canvasRenderer=t,this.type="text",this.numberType=rs}contains(t,e,i){const{pickContext:r}=null!=i?i:{};if(!r)return!1;const o=t.AABBBounds;if(!r.camera)return!!o.containsPoint(e);r.highPerformanceSave();const n=yo(t).text,{keepDirIn3d:s=n.keepDirIn3d}=t.attribute,a=!s,l=this.transform(t,n,r,a),{x:h,y:c,z:d,lastModelMatrix:u}=l;this.canvasRenderer.z=d;let g=e;if(r.camera){g=e.clone();const i=t.parent.globalTransMatrix;g.x=i.a*e.x+i.c*e.y+i.e,g.y=i.b*e.x+i.d*e.y+i.f}let p=!1;return this.canvasRenderer.drawShape(t,r,h,c,{},null,((e,i,r)=>{if(p)return!0;const{fontSize:o=n.fontSize,textBaseline:s=n.textBaseline,textAlign:a=n.textAlign}=t.attribute,l=t.AABBBounds,u=l.height(),f=l.width(),m=Zs(s,u,o),b=qs(a,f);return e.rect(b+h,m+c,f,u,d),p=e.isPointInPath(g.x,g.y),p}),((t,e,i)=>p)),this.canvasRenderer.z=0,r.modelMatrix!==u&&th.free(r.modelMatrix),r.modelMatrix=u,r.highPerformanceRestore(),p}};$m=Vm([f(),Km(0,g(nd)),Um("design:paramtypes",[Object])],$m);let Xm=!1;const Ym=new i(((t,e,i,r)=>{Xm||(Xm=!0,t(Hp).to($m).inSingletonScope(),t(zp).toService(Hp))}));var qm=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let Zm=class{constructor(){this.type="text",this.numberType=rs}contains(t,e,i){return!!t.AABBBounds.containsPoint(e)}};Zm=qm([f()],Zm);let Jm=!1;const Qm=new i(((t,e,i,r)=>{Jm||(Jm=!0,t(yp).to(Zm).inSingletonScope(),t(hp).toService(yp))}));var tb=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},eb=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ib=function(t,e){return function(i,r){e(i,r,t)}};let rb=class extends Yf{constructor(t){super(),this.canvasRenderer=t,this.type="path",this.numberType=qn}contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if("imprecise"===t.attribute.pickMode)return!0;const{pickContext:r}=null!=i?i:{};if(!r)return!1;const o=yo(t).path;r.highPerformanceSave();const n=this.transform(t,o,r),{x:s,y:a,z:l,lastModelMatrix:h}=n;let c=e;if(r.camera){c=e.clone();const i=t.parent.globalTransMatrix;c.x=i.a*e.x+i.c*e.y+i.e,c.y=i.b*e.x+i.d*e.y+i.f}this.canvasRenderer.z=l;let d=!1;return this.canvasRenderer.drawShape(t,r,s,a,{},null,((t,e,i)=>!!d||(d=t.isPointInPath(c.x,c.y),d)),((t,e,i)=>{if(d)return!0;const o=e.lineWidth||i.lineWidth,n=e.pickStrokeBuffer||i.pickStrokeBuffer;return r.lineWidth=mh(r,o+n,r.dpr),d=t.isPointInStroke(c.x,c.y),d})),this.canvasRenderer.z=0,r.modelMatrix!==h&&th.free(r.modelMatrix),r.modelMatrix=h,r.highPerformanceRestore(),d}};rb=tb([f(),ib(0,g(td)),eb("design:paramtypes",[Object])],rb);let ob=!1;const nb=new i(((t,e,i,r)=>{ob||(ob=!0,t(Bp).to(rb).inSingletonScope(),t(zp).toService(Bp))}));var sb=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},ab=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},lb=function(t,e){return function(i,r){e(i,r,t)}};let hb=class{constructor(t){this.canvasRenderer=t,this.type="path",this.numberType=qn}contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if("imprecise"===t.attribute.pickMode)return!0;const{pickContext:r}=null!=i?i:{};if(!r)return!1;const o=yo(t).path;let{x:n=o.x,y:s=o.y}=t.attribute;if(r.highPerformanceSave(),t.transMatrix.onlyTranslate()){const e=t.getOffsetXY(o);n+=e.x,s+=e.y,r.setTransformForCurrent()}else n=0,s=0,r.transformFromMatrix(t.transMatrix,!0);let a=!1;return this.canvasRenderer.drawShape(t,r,n,s,{},null,((t,i,r)=>!!a||(a=t.isPointInPath(e.x,e.y),a)),((t,i,o)=>{if(a)return!0;const n=i.lineWidth||o.lineWidth,s=i.pickStrokeBuffer||o.pickStrokeBuffer;return r.lineWidth=n+s,a=t.isPointInStroke(e.x,e.y),a})),r.highPerformanceRestore(),a}};hb=sb([f(),lb(0,g(td)),ab("design:paramtypes",[Object])],hb);let cb=!1;const db=new i(((t,e,i,r)=>{cb||(cb=!0,t(fp).to(hb).inSingletonScope(),t(hp).toService(fp))}));var ub=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},gb=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},pb=function(t,e){return function(i,r){e(i,r,t)}};let fb=class{constructor(t){this.canvasRenderer=t,this.type="polygon",this.numberType=Zn}contains(t,e,i){if(!t.AABBBounds.contains(e.x,e.y))return!1;if("imprecise"===t.attribute.pickMode)return!0;const{pickContext:r}=null!=i?i:{};if(!r)return!1;const o=yo(t).polygon;let{x:n=o.x,y:s=o.y}=t.attribute;if(r.highPerformanceSave(),t.transMatrix.onlyTranslate()){const e=t.getOffsetXY(o);n+=e.x,s+=e.y,r.setTransformForCurrent()}else n=0,s=0,r.transformFromMatrix(t.transMatrix,!0);let a=!1;return this.canvasRenderer.drawShape(t,r,n,s,{},null,((t,i,r)=>!!a||(a=t.isPointInPath(e.x,e.y),a)),((t,i,o)=>{if(a)return!0;const n=i.lineWidth||o.lineWidth,s=i.pickStrokeBuffer||o.pickStrokeBuffer;return r.lineWidth=mh(r,n+s,r.dpr),a=t.isPointInStroke(e.x,e.y),a})),r.highPerformanceRestore(),a}};fb=ub([f(),pb(0,g(ed)),gb("design:paramtypes",[Object])],fb);let mb=!1;const bb=new i(((t,e,i,r)=>{mb||(mb=!0,t(Ep).to(fb).inSingletonScope(),t(zp).toService(Ep))}));var yb=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Cb=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},wb=function(t,e){return function(i,r){e(i,r,t)}};let vb=class{constructor(t){this.canvasRenderer=t,this.type="polygon",this.numberType=Zn}contains(t,e,i){if(!t.AABBBounds.contains(e.x,e.y))return!1;const{pickContext:r}=null!=i?i:{};if(!r)return!1;const o=yo(t).polygon;let{x:n=o.x,y:s=o.y}=t.attribute;if(r.highPerformanceSave(),t.transMatrix.onlyTranslate()){const e=t.getOffsetXY(o);n+=e.x,s+=e.y,r.setTransformForCurrent()}else n=0,s=0,r.transformFromMatrix(t.transMatrix,!0);let a=!1;return this.canvasRenderer.drawShape(t,r,n,s,{},null,((t,i,r)=>!!a||(a=t.isPointInPath(e.x,e.y),a)),((t,i,o)=>{if(a)return!0;const n=i.lineWidth||o.lineWidth,s=i.pickStrokeBuffer||o.pickStrokeBuffer;return r.lineWidth=n+s,a=t.isPointInStroke(e.x,e.y),a})),r.highPerformanceRestore(),a}};vb=yb([f(),wb(0,g(ed)),Cb("design:paramtypes",[Object])],vb);let xb=!1;const _b=new i(((t,e,i,r)=>{xb||(xb=!0,t(Cp).to(vb).inSingletonScope(),t(hp).toService(Cp))}));var Sb=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Ab=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Rb=function(t,e){return function(i,r){e(i,r,t)}};let Bb=class{constructor(t){this.canvasRenderer=t,this.type="glyph",this.numberType=Kn}contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if("imprecise"===t.attribute.pickMode)return!0;const{pickContext:r}=null!=i?i:{};if(!r)return!1;const o=null==i?void 0:i.pickerService;if(o){let r=!1;return t.getSubGraphic().forEach((t=>{if(r)return;const n=o.pickItem(t,e,null,i);r=!(!n||!n.graphic)})),r}return!1}};Bb=Sb([f(),Rb(0,g(ld)),Ab("design:paramtypes",[Object])],Bb);let Mb=!1;const Tb=new i(((t,e,i,r)=>{Mb||(Mb=!0,t(Fp).to(Bb).inSingletonScope(),t(zp).toService(Fp))}));var Pb=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Hb=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Eb=function(t,e){return function(i,r){e(i,r,t)}};let kb=class{constructor(t){this.canvasRenderer=t,this.type="glyph",this.numberType=Kn}contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if("imprecise"===t.attribute.pickMode)return!0;const{pickContext:r}=null!=i?i:{};if(!r)return!1;const o=null==i?void 0:i.pickerService;if(o){let r=!1;return t.getSubGraphic().forEach((t=>{r||(r=!!o.pickItem(t,e,null,i))})),r}return!1}};kb=Pb([f(),Eb(0,g(ld)),Hb("design:paramtypes",[Object])],kb);let Lb=!1;const Fb=new i(((t,e,i,r)=>{Lb||(Lb=!0,t(wp).to(kb).inSingletonScope(),t(kb).toService(wp))}));var Ib=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},zb=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ob=function(t,e){return function(i,r){e(i,r,t)}};let Db=class{constructor(t){this.canvasRenderer=t,this.type="richtext",this.numberType=es}contains(t,e,i){return!!t.AABBBounds.containsPoint(e)}};Db=Ib([f(),Ob(0,g(sd)),zb("design:paramtypes",[Object])],Db);let Wb=!1;const Nb=new i(((t,e,i,r)=>{Wb||(Wb=!0,t(Lp).to(Db).inSingletonScope(),t(zp).toService(Lp))}));var Gb=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let jb=class{constructor(){this.type="image",this.numberType=Xn}contains(t,e,i){const{pickContext:r}=null!=i?i:{};return!!r&&!!t.AABBBounds.containsPoint(e)}};jb=Gb([f()],jb);let Vb=!1;const Ub=new i(((t,e,i,r)=>{Vb||(Vb=!0,t(gp).to(jb).inSingletonScope(),t(jb).toService(gp))}));var Kb=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let $b=class{constructor(){this.type="image",this.numberType=Xn}contains(t,e,i){const{pickContext:r}=null!=i?i:{};return!!r&&!!t.AABBBounds.containsPoint(e)}};$b=Kb([f()],$b);let Xb=!1;const Yb=new i(((t,e,i,r)=>{Xb||(Xb=!0,t(Ap).to($b).inSingletonScope(),t(zp).toService(Ap))}));let qb=!1;const Zb=new i(((t,e,i,r)=>{qb||(qb=!0,t(gp).to(jb).inSingletonScope(),t(jb).toService(gp))}));var Jb=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Qb=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ty=function(t,e){return function(i,r){e(i,r,t)}};new ue;let ey=class extends Yf{constructor(t){super(),this.canvasRenderer=t,this.type="rect3d",this.numberType=ts}contains(t,e,i){const{pickContext:r}=null!=i?i:{};if(!r)return!1;const o=yo(t).rect;r.highPerformanceSave();const n=this.transform(t,o,r),{x:s,y:a,z:l,lastModelMatrix:h}=n;let c=e;if(r.camera){c=e.clone();const i=t.parent.globalTransMatrix;c.x=i.a*e.x+i.c*e.y+i.e,c.y=i.b*e.x+i.d*e.y+i.f}this.canvasRenderer.z=l;let d=!1;return this.canvasRenderer.drawShape(t,r,s,a,i,null,((t,e,i)=>!!d||(d=t.isPointInPath(c.x,c.y),d))),this.canvasRenderer.z=0,r.modelMatrix!==h&&th.free(r.modelMatrix),r.modelMatrix=h,r.highPerformanceRestore(),d}};ey=Jb([f(),ty(0,g(rd)),Qb("design:paramtypes",[Object])],ey);let iy=!1;const ry=new i(((t,e,i,r)=>{iy||(iy=!0,t(Tp).to(ey).inSingletonScope(),t(zp).toService(Tp))}));var oy=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},ny=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},sy=function(t,e){return function(i,r){e(i,r,t)}};let ay=class extends Yf{constructor(t){super(),this.canvasRenderer=t,this.type="arc3d",this.numberType=jn}contains(t,e,i){const{pickContext:r}=null!=i?i:{};if(!r)return!1;const o=yo(t).arc;r.highPerformanceSave();const n=this.transform(t,o,r),{x:s,y:a,z:l,lastModelMatrix:h}=n;let c=e;if(r.camera){c=e.clone();const i=t.parent.globalTransMatrix;c.x=i.a*e.x+i.c*e.y+i.e,c.y=i.b*e.x+i.d*e.y+i.f}this.canvasRenderer.z=l;let d=!1;return this.canvasRenderer.drawShape(t,r,s,a,i,null,((t,e,i)=>!!d||(d=t.isPointInPath(c.x,c.y),d))),this.canvasRenderer.z=0,r.modelMatrix!==h&&th.free(r.modelMatrix),r.modelMatrix=h,r.highPerformanceRestore(),d}};ay=oy([f(),sy(0,g(Xc)),ny("design:paramtypes",[Object])],ay);let ly=!1;const hy=new i(((t,e,i,r)=>{ly||(ly=!0,t(xp).to(ay).inSingletonScope(),t(zp).toService(xp))}));var cy=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},dy=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},uy=function(t,e){return function(i,r){e(i,r,t)}};let gy=class extends Yf{constructor(t){super(),this.canvasRenderer=t,this.type="pyramid3d",this.numberType=Jn}contains(t,e,i){const{pickContext:r}=null!=i?i:{};if(!r)return!1;const o=yo(t).polygon;r.highPerformanceSave();const n=this.transform(t,o,r),{x:s,y:a,z:l,lastModelMatrix:h}=n;let c=e;if(r.camera){c=e.clone();const i=t.parent.globalTransMatrix;c.x=i.a*e.x+i.c*e.y+i.e,c.y=i.b*e.x+i.d*e.y+i.f}this.canvasRenderer.z=l;let d=!1;return this.canvasRenderer.drawShape(t,r,s,a,{},null,((t,e,i)=>!!d||(d=t.isPointInPath(c.x,c.y),d)),((t,e,i)=>!1)),this.canvasRenderer.z=0,r.modelMatrix!==h&&th.free(r.modelMatrix),r.modelMatrix=h,r.highPerformanceRestore(),d}};gy=cy([f(),uy(0,g(ad)),dy("design:paramtypes",[Object])],gy);let py=!1;const fy=new i(((t,e,i,r)=>{py||(py=!0,t(kp).to(gy).inSingletonScope(),t(zp).toService(kp))})),my=Vu();function by(){by.__loaded||(by.__loaded=!0,hh.RegisterGraphicCreator("arc",Wl),Xr.load(lg),Xr.load(my?Bf:kf))}by.__loaded=!1;const yy=by;function Cy(){Cy.__loaded||(Cy.__loaded=!0,hh.RegisterGraphicCreator("arc3d",Gl),Xr.load(jg),Xr.load(hy))}Cy.__loaded=!1;const wy=Cy;function vy(){vy.__loaded||(vy.__loaded=!0,hh.RegisterGraphicCreator("area",zl),Xr.load(pg),Xr.load(my?gm:Cm))}vy.__loaded=!1;const xy=vy;function _y(){_y.__loaded||(_y.__loaded=!0,hh.RegisterGraphicCreator("circle",Xs),Xr.load(yg),Xr.load(my?zm:jm))}_y.__loaded=!1;const Sy=_y;function Ay(){Ay.__loaded||(Ay.__loaded=!0,hh.RegisterGraphicCreator("glyph",wl),Xr.load(Mg),Xr.load(my?Tb:Fb))}Ay.__loaded=!1;const Ry=Ay;function By(){By.__loaded||(By.__loaded=!0,hh.RegisterGraphicCreator("group",cs))}By.__loaded=!1;const My=By;function Ty(){Ty.__loaded||(Ty.__loaded=!0,hh.RegisterGraphicCreator("image",Al),Xr.load(Fg),Xr.load(my?Yb:Zb))}Ty.__loaded=!1;const Py=Ty;function Hy(){Hy.__loaded||(Hy.__loaded=!0,hh.RegisterGraphicCreator("line",ul),Xr.load(ug),Xr.load(my?em:am))}Hy.__loaded=!1;const Ey=Hy;function ky(){ky.__loaded||(ky.__loaded=!0,hh.RegisterGraphicCreator("path",Ll),Xr.load(xg),Xr.load(my?nb:db))}ky.__loaded=!1;const Ly=ky;function Fy(){Fy.__loaded||(Fy.__loaded=!0,hh.RegisterGraphicCreator("polygon",Ul),Xr.load(Sg),Xr.load(my?bb:_b))}Fy.__loaded=!1;const Iy=Fy;function zy(){zy.__loaded||(zy.__loaded=!0,hh.RegisterGraphicCreator("pyramid3d",$l),Xr.load($g),Xr.load(fy))}zy.__loaded=!1;const Oy=zy;function Dy(){Dy.__loaded||(Dy.__loaded=!0,hh.RegisterGraphicCreator("rect",fl),Xr.load(cg),Xr.load(my?Wf:$f))}Dy.__loaded=!1;const Wy=Dy;function Ny(){Ny.__loaded||(Ny.__loaded=!0,hh.RegisterGraphicCreator("rect3d",yl),Xr.load(Dg),Xr.load(ry))}Ny.__loaded=!1;const Gy=Ny;function jy(){jy.__loaded||(jy.__loaded=!0,hh.RegisterGraphicCreator("richtext",Hl),Xr.load(kg),Xr.load(my?Nb:Ub))}jy.__loaded=!1;const Vy=jy;function Uy(){Uy.__loaded||(Uy.__loaded=!0,hh.RegisterGraphicCreator("shadowRoot",Yl))}Uy.__loaded=!1;const Ky=Uy;function $y(){$y.__loaded||($y.__loaded=!0,hh.RegisterGraphicCreator("symbol",hl),Xr.load(mg),Xr.load(my?Am:Hm))}$y.__loaded=!1;const Xy=$y;function Yy(){Yy.__loaded||(Yy.__loaded=!0,hh.RegisterGraphicCreator("text",ea),Xr.load(wg),Xr.load(my?Ym:Qm))}Yy.__loaded=!1;const qy=Yy;function Zy(){Zy.__loaded||(Zy.__loaded=!0,hh.RegisterGraphicCreator("wrapText",oa))}Zy.__loaded=!1;const Jy=Zy;let Qy=!1;function tC(){Qy||(Qy=!0,_u(),Vu()?nf(Xr):function(){ju();const t=kr.global&&kr.global.env;return t?"node"===t:!Gu}()&&vf(Xr),yy(),wy(),xy(),Sy(),Ry(),My(),Py(),Ey(),Ly(),Iy(),Oy(),Wy(),Gy(),Vy(),Ky(),Xy(),qy(),Jy())}var eC,iC,rC,oC,nC,sC,aC,lC,hC;!function(t){t.default="default",t.grabing="grabing",t.scrolling="scrolling"}(eC||(eC={})),function(t){t.single="single",t.column="column",t.row="row",t.cross="cross",t.none="none"}(iC||(iC={})),function(t){t.top="top",t.bottom="bottom",t.left="left",t.right="right"}(rC||(rC={})),function(t){t.expand="expand",t.collapse="collapse",t.none="none"}(oC||(oC={})),function(t){t.RECORD="RECORD",t.NONE="NONE",t.SUM="SUM",t.MIN="MIN",t.MAX="MAX",t.AVG="AVG",t.COUNT="COUNT",t.CUSTOM="CUSTOM"}(nC||(nC={})),function(t){t.ASC="ASC",t.DESC="DESC"}(sC||(sC={})),function(t){t.inlineFront="inlineFront",t.inlineEnd="inlineEnd",t.left="left",t.right="right",t.absoluteRight="absoluteRight",t.contentLeft="contentLeft",t.contentRight="contentRight",t.absolute="absolute"}(aC||(aC={})),function(t){t.frozen="frozen",t.sort="sort",t.dropDown="dropDown",t.dropDownState="dropDownState",t.play="play",t.damagePic="damagePic",t.expand="expand",t.collapse="collapse",t.drillDown="drillDown",t.drillUp="drillUp",t.dragReorder="dragReorder"}(lC||(lC={})),function(t){t.upwardIconName="sort_upward",t.downwardIconName="sort_downward",t.normalIconName="sort_normal",t.freezeIconName="freeze",t.frozenIconName="frozen",t.frozenCurrentIconName="frozenCurrent",t.dropdownIconName="dropdownIcon",t.expandIconName="expand",t.collapseIconName="collapse",t.dragReorderIconName="dragReorder"}(hC||(hC={}));var cC=Object.freeze({__proto__:null,get AggregationType(){return nC},get HierarchyState(){return oC},get HighlightScope(){return iC},get IconFuncTypeEnum(){return lC},get IconPosition(){return aC},get InteractionState(){return eC},get InternalIconName(){return hC},get Placement(){return rC},get SortType(){return sC}});let dC,uC=1,gC=class{listenersData={listeners:{},listenerData:{}};on(t,e){const i=this.listenersData.listeners[t]||(this.listenersData.listeners[t]=[]);i.push(e);const r=uC++;return this.listenersData.listenerData[r]={type:t,listener:e,remove:()=>{delete this.listenersData.listenerData[r];const o=i.indexOf(e);i.splice(o,1),this.listenersData.listeners[t].length||delete this.listenersData.listeners[t]}},r}off(t,e){if(e){const i=t;this.removeEventListener(i,e)}else{const e=t;if(!this.listenersData)return;this.listenersData.listenerData[e]?.remove()}}addEventListener(t,e,i){this.on(t,e)}removeEventListener(t,e){if(this.listenersData)for(const i in this.listenersData.listenerData){const r=this.listenersData.listenerData[i];r.type===t&&r.listener===e&&this.off(i)}}hasListeners(t){return!!this.listenersData&&!!this.listenersData.listeners[t]}fireListeners(t,e){if(!this.listenersData)return[];const i=this.listenersData.listeners[t];return i?i.map((t=>t.call(this,e))).filter((t=>Y(t))):[]}release(){delete this.listenersData}};const pC={CHANGE_STYLE:"change_style"};let fC,mC,bC,yC=class t extends gC{_color;_fontSize;_fontFamily;_fontWeight;_fontVariant;_fontStyle;_padding;_defaultPadding=[10,16,10,16];_textStick;_textStickBaseOnAlign;_textOverflow;_textAlign;_textBaseline;_bgColor;_borderColor;_lineHeight;_underline;_underlineColor;_underlineDash;_underlineOffset;_lineThrough;_lineThroughColor;_lineThroughDash;_linkColor;_cursor;_borderLineWidth;_borderLineDash;_marked;static get EVENT_TYPE(){return pC}static get DEFAULT(){return dC||(dC=new t)}constructor(t={},e={}){super(),this._textAlign=t?.textAlign??e?.textAlign,this._textBaseline=t?.textBaseline??e?.textBaseline,this._color=t?.color??e?.color,this._fontSize=t.fontSize??e?.fontSize,this._fontFamily=t.fontFamily??e?.fontFamily,this._fontWeight=t.fontWeight??e?.fontWeight,this._fontVariant=t.fontVariant??e?.fontVariant,this._fontStyle=t.fontStyle??e?.fontStyle,this._padding=t?.padding??e?.padding??this._defaultPadding,this._borderColor=t?.borderColor??e?.borderColor,this._textOverflow=t?.textOverflow??e?.textOverflow,this._textStick=t.textStick??e?.textStick??!1,this._textStickBaseOnAlign=t.textStickBaseOnAlign??e?.textStickBaseOnAlign??!1,this._bgColor=t?.bgColor??e?.bgColor,this._lineHeight=t?.lineHeight??e?.lineHeight,this._underline=t?.underline??e?.underline,this._underlineColor=t?.underlineColor??e?.underlineColor,this._underlineDash=t?.underlineDash??e?.underlineDash,this._underlineOffset=t?.underlineOffset??e?.underlineOffset,this._lineThrough=t?.lineThrough??e?.lineThrough,this._lineThroughColor=t?.lineThroughColor??e?.lineThroughColor,this._lineThroughDash=t?.lineThroughDash??e?.lineThroughDash,this._linkColor=t?.linkColor??e?.linkColor,this._cursor=t.cursor??e?.cursor,this._borderLineWidth=t.borderLineWidth??e?.borderLineWidth,this._borderLineDash=t.borderLineDash??e?.borderLineDash,this._marked=t.marked??e?.marked}get color(){return this._color}set color(t){this._color=t}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t}get padding(){return this._padding}set padding(t){this._padding=t}get textOverflow(){return this._textOverflow}set textOverflow(t){this._textOverflow=t}get bgColor(){return this._bgColor}set bgColor(t){this._bgColor=t}get borderColor(){return this._borderColor}set borderColor(t){this._borderColor=t}get textStick(){return this._textStick}set textStick(t){this._textStick=t}get textStickBaseOnAlign(){return this._textStickBaseOnAlign}set textStickBaseOnAlign(t){this._textStickBaseOnAlign=t}get textAlign(){return this._textAlign}set textAlign(t){this._textAlign=t}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t}get underline(){return this._underline}set underline(t){this._underline=t}get underlineColor(){return this._underlineColor}set underlineColor(t){this._underlineColor=t}get underlineDash(){return this._underlineDash}set underlineDash(t){this._underlineDash=t}get underlineOffset(){return this._underlineOffset}set underlineOffset(t){this._underlineOffset=t}get lineThrough(){return this._lineThrough}set lineThrough(t){this._lineThrough=t}get lineThroughColor(){return this._lineThroughColor}set lineThroughColor(t){this._lineThroughColor=t}get lineThroughDash(){return this._lineThroughDash}set lineThroughDash(t){this._lineThroughDash=t}get linkColor(){return this._linkColor}set linkColor(t){this._linkColor=t}get cursor(){return this._cursor}set cursor(t){this._cursor=t}get borderLineWidth(){return this._borderLineWidth}set borderLineWidth(t){this._borderLineWidth=t}get borderLineDash(){return this._borderLineDash}set borderLineDash(t){this._borderLineDash=t}get marked(){return this._marked}set marked(t){this._marked=t}clone(){return new t(this,null)}},CC=class t extends yC{static get DEFAULT(){return fC||(fC=new t)}constructor(t={},e={}){super(t,e)}clone(){return new t(this,null)}};class wC extends yC{_autoWrapText;_lineClamp;static get DEFAULT(){return mC||(mC=new wC)}constructor(t={},e={}){super(t,e),this._autoWrapText=t?.autoWrapText??e?.autoWrapText,this._lineClamp=t?.lineClamp??e?.lineClamp}clone(){return new wC(this,null)}get lineClamp(){return this._lineClamp}set lineClamp(t){this._lineClamp=t}get autoWrapText(){return this._autoWrapText}set autoWrapText(t){this._autoWrapText=t}}let vC,xC,_C=class t extends yC{_size;_spaceBetweenTextAndIcon;_defaultFill;_defaultStroke;_disableFill;_checkedFill;_checkedStroke;_disableCheckedFill;_disableCheckedStroke;_checkIconImage;_indeterminateIconImage;static get DEFAULT(){return bC||(bC=new t)}constructor(t={},e={},i={}){super(t,e),this._size=(t?.size??e?.size??i?.size)||14,this._spaceBetweenTextAndIcon=(t?.spaceBetweenTextAndIcon??e?.spaceBetweenTextAndIcon??i?.spaceBetweenTextAndIcon)||8,this._defaultFill=t?.checkboxStyle?.defaultFill??i?.defaultFill,this._defaultStroke=t?.checkboxStyle?.defaultStroke??i?.defaultStroke,this._disableFill=t?.checkboxStyle?.disableFill??i?.disableFill,this._checkedFill=t?.checkboxStyle?.checkedFill??i?.checkedFill,this._checkedStroke=t?.checkboxStyle?.checkedStroke??i?.checkedStroke,this._disableCheckedFill=t?.checkboxStyle?.disableCheckedFill??i?.disableCheckedFill,this._disableCheckedStroke=t?.checkboxStyle?.disableCheckedStroke??i?.disableCheckedStroke,this._checkIconImage=t?.checkboxStyle?.checkIconImage??i?.checkIconImage,this._indeterminateIconImage=t?.checkboxStyle?.indeterminateIconImage??i?.indeterminateIconImage}get size(){return this._size}set size(t){this._size=t}get spaceBetweenTextAndIcon(){return this._spaceBetweenTextAndIcon}set spaceBetweenTextAndIcon(t){this._spaceBetweenTextAndIcon=t}get defaultFill(){return this._defaultFill}set defaultFill(t){this._defaultFill=t}get defaultStroke(){return this._defaultStroke}set defaultStroke(t){this._defaultStroke=t}get disableFill(){return this._disableFill}set disableFill(t){this._disableFill=t}get checkedFill(){return this._checkedFill}set checkedFill(t){this._checkedFill=t}get checkedStroke(){return this._checkedStroke}set checkedStroke(t){this._checkedStroke=t}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(t){this._disableCheckedFill=t}get disableCheckedStroke(){return this._disableCheckedStroke}set disableCheckedStroke(t){this._disableCheckedStroke=t}get checkIconImage(){return this._checkIconImage}set checkIconImage(t){this._checkIconImage=t}get indeterminateIconImage(){return this._indeterminateIconImage}set indeterminateIconImage(t){this._indeterminateIconImage=t}getStyle(e){return new t(e,this)}clone(){return new t(this)}};class SC extends yC{_size;_spaceBetweenTextAndIcon;_spaceBetweenRadio;_outerRadius;_innerRadius;_defaultFill;_defaultStroke;_disableFill;_checkedFill;_checkedStroke;_disableCheckedFill;_disableCheckedStroke;static get DEFAULT(){return vC||(vC=new SC)}constructor(t={},e={},i={}){super(t,e),this._size=(t?.size??e?.size??i?.size)||14,this._spaceBetweenTextAndIcon=(t?.spaceBetweenTextAndIcon??e?.spaceBetweenTextAndIcon??i?.spaceBetweenTextAndIcon)||8,this._spaceBetweenRadio=(t?.spaceBetweenRadio??e?.spaceBetweenRadio??i?.spaceBetweenRadio)||2,this._innerRadius=t?.radioStyle?.innerRadius??i?.innerRadius,this._outerRadius=t?.radioStyle?.outerRadius??i?.outerRadius,this._defaultFill=t?.radioStyle?.defaultFill??i?.defaultFill,this._defaultStroke=t?.radioStyle?.defaultStroke??i?.defaultStroke,this._disableFill=t?.radioStyle?.disableFill??i?.disableFill,this._checkedFill=t?.radioStyle?.checkedFill??i?.checkedFill,this._checkedStroke=t?.radioStyle?.checkedStroke??i?.checkedStroke,this._disableCheckedFill=t?.radioStyle?.disableCheckedFill??i?.disableCheckedFill,this._disableCheckedStroke=t?.radioStyle?.disableCheckedStroke??i?.disableCheckedStroke}get size(){return this._size}set size(t){this._size=t}get spaceBetweenTextAndIcon(){return this._spaceBetweenTextAndIcon}set spaceBetweenTextAndIcon(t){this._spaceBetweenTextAndIcon=t}get spaceBetweenRadio(){return this._spaceBetweenRadio}set spaceBetweenRadio(t){this._spaceBetweenRadio=t}get innerRadius(){return this._innerRadius}set innerRadius(t){this._innerRadius=t}get outerRadius(){return this._outerRadius}set outerRadius(t){this._outerRadius=t}get defaultFill(){return this._defaultFill}set defaultFill(t){this._defaultFill=t}get defaultStroke(){return this._defaultStroke}set defaultStroke(t){this._defaultStroke=t}get disableFill(){return this._disableFill}set disableFill(t){this._disableFill=t}get checkedFill(){return this._checkedFill}set checkedFill(t){this._checkedFill=t}get checkedStroke(){return this._checkedStroke}set checkedStroke(t){this._checkedStroke=t}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(t){this._disableCheckedFill=t}get disableCheckedStroke(){return this._disableCheckedStroke}set disableCheckedStroke(t){this._disableCheckedStroke=t}getStyle(t){return new SC(t,this)}clone(){return new SC(this)}}function AC(t,e,i,r=yC,o,n){return t||e?t instanceof yC?t:"function"==typeof t?AC(t(i),e,i,r,o,n):(t||(t={}),o&&!Y(t.autoWrapText)&&(t.autoWrapText=!0),r===_C?new _C(t??{},e??{},n.checkboxStyle??{}):r===SC?new SC(t??{},e??{},n.radioStyle??{}):new r(t??{},e??{})):r.DEFAULT}const RC={CHANGE_STYLE:"change_style"};class BC extends gC{_color;_fontSize;_fontFamily;_fontWeight;_fontVariant;_fontStyle;_textOverflow;_padding;_defaultPadding=[10,16,10,16];_textStick;_textStickBaseOnAlign;_marked;_textAlign;_textBaseline;_bgColor;_borderColor;_lineHeight;_underline;_underlineColor;_underlineDash;_underlineOffset;_lineThrough;_lineThroughColor;_lineThroughDash;_linkColor;_cursor;_borderLineWidth;_borderLineDash;static get EVENT_TYPE(){return RC}static get DEFAULT(){return xC||(xC=new BC)}constructor(t={},e={}){super(),this._color=t.color??e?.color,this._fontSize=t.fontSize??e?.fontSize,this._fontFamily=t.fontFamily??e?.fontFamily,this._fontWeight=t.fontWeight??e?.fontWeight,this._fontVariant=t.fontVariant??e?.fontVariant,this._fontStyle=t.fontStyle??e?.fontStyle,this._textOverflow=(t.textOverflow??e?.textOverflow)||"ellipsis",this._textStick=t.textStick??e?.textStick??!1,this._textStickBaseOnAlign=t.textStickBaseOnAlign??e?.textStickBaseOnAlign??!1,this._marked=t.marked??e?.marked??!1,this._textAlign=(t.textAlign??e?.textAlign)||"left",this._textBaseline=(t.textBaseline??e?.textBaseline)||"middle",this._bgColor=t.bgColor??e?.bgColor,this._padding=t.padding??e?.padding??this._defaultPadding,this._borderColor=t.borderColor??e?.borderColor,this._lineHeight=t.lineHeight??e?.lineHeight,this._underline=t.underline??e?.underline,this._underlineColor=t.underlineColor??e?.underlineColor,this._underlineDash=t.underlineDash??e?.underlineDash,this._underlineOffset=t.underlineOffset??e?.underlineOffset,this._lineThrough=t.lineThrough??e?.lineThrough,this._lineThroughColor=t.lineThroughColor??e?.lineThroughColor,this._lineThroughDash=t.lineThroughDash??e?.lineThroughDash,this._linkColor=t.linkColor??e?.linkColor,this._cursor=t.cursor??e?.cursor,this._borderLineWidth=t.borderLineWidth??e?.borderLineWidth,this._borderLineDash=t.borderLineDash??e?.borderLineDash}get bgColor(){return this._bgColor}set bgColor(t){this._bgColor=t}get color(){return this._color}set color(t){this._color=t}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t}get textOverflow(){return this._textOverflow}set textOverflow(t){this._textOverflow=t}get padding(){return this._padding??this._defaultPadding}set padding(t){this._padding=t}get borderColor(){return this._borderColor}set borderColor(t){this._borderColor=t}get textStick(){return this._textStick}set textStick(t){this._textStick=t}get textStickBaseOnAlign(){return this._textStickBaseOnAlign}set textStickBaseOnAlign(t){this._textStickBaseOnAlign=t}get marked(){return this._marked}set marked(t){this._marked=t}get textAlign(){return this._textAlign}set textAlign(t){this._textAlign=t}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t}get underline(){return this._underline}set underline(t){this._underline=t}get underlineColor(){return this._underlineColor}set underlineColor(t){this._underlineColor=t}get underlineDash(){return this._underlineDash}set underlineDash(t){this._underlineDash=t}get underlineOffset(){return this._underlineOffset}set underlineOffset(t){this._underlineOffset=t}get lineThrough(){return this._lineThrough}set lineThrough(t){this._lineThrough=t}get lineThroughColor(){return this._lineThroughColor}set lineThroughColor(t){this._lineThroughColor=t}get lineThroughDash(){return this._lineThroughDash}set lineThroughDash(t){this._lineThroughDash=t}get linkColor(){return this._linkColor}set linkColor(t){this._linkColor=t}get cursor(){return this._cursor}set cursor(t){this._cursor=t}get borderLineWidth(){return this._borderLineWidth}set borderLineWidth(t){this._borderLineWidth=t}get borderLineDash(){return this._borderLineDash}set borderLineDash(t){this._borderLineDash=t}clone(){return new BC(this)}}let MC,TC;class PC extends BC{_autoWrapText;_lineClamp;static get DEFAULT(){return MC||(MC=new PC)}constructor(t={},e=null){super(t,e),this._autoWrapText=t?.autoWrapText??e?.autoWrapText,this._lineClamp=t?.lineClamp??e?.lineClamp}clone(){return new PC(this,null)}get lineClamp(){return this._lineClamp}set lineClamp(t){this._lineClamp=t}get autoWrapText(){return this._autoWrapText}set autoWrapText(t){this._autoWrapText=t}}class HC extends BC{_size;_spaceBetweenTextAndIcon;_defaultFill;_defaultStroke;_disableFill;_checkedFill;_checkedStroke;_disableCheckedFill;_disableCheckedStroke;_checkIconImage;_indeterminateIconImage;static get DEFAULT(){return TC||(TC=new HC)}constructor(t={},e={},i={}){super(t,e),this._size=(t?.size??e?.size??i?.size)||14,this._spaceBetweenTextAndIcon=(t?.spaceBetweenTextAndIcon??e?.spaceBetweenTextAndIcon??i?.spaceBetweenTextAndIcon)||8,this._defaultFill=t?.checkboxStyle?.defaultFill??i?.defaultFill,this._defaultStroke=t?.checkboxStyle?.defaultStroke??i?.defaultStroke,this._disableFill=t?.checkboxStyle?.disableFill??i?.disableFill,this._checkedFill=t?.checkboxStyle?.checkedFill??i?.checkedFill,this._checkedStroke=t?.checkboxStyle?.checkedStroke??i?.checkedStroke,this._disableCheckedFill=t?.checkboxStyle?.disableCheckedFill??i?.disableCheckedFill,this._disableCheckedStroke=t?.checkboxStyle?.disableCheckedStroke??i?.disableCheckedStroke,this._checkIconImage=t?.checkboxStyle?.checkIconImage??i?.checkIconImage,this._indeterminateIconImage=t?.checkboxStyle?.indeterminateIconImage??i?.indeterminateIconImage}get size(){return this._size}set size(t){this._size=t}get spaceBetweenTextAndIcon(){return this._spaceBetweenTextAndIcon}set spaceBetweenTextAndIcon(t){this._spaceBetweenTextAndIcon=t}get defaultFill(){return this._defaultFill}set defaultFill(t){this._defaultFill=t}get defaultStroke(){return this._defaultStroke}set defaultStroke(t){this._defaultStroke=t}get disableFill(){return this._disableFill}set disableFill(t){this._disableFill=t}get checkedFill(){return this._checkedFill}set checkedFill(t){this._checkedFill=t}get checkedStroke(){return this._checkedStroke}set checkedStroke(t){this._checkedStroke=t}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(t){this._disableCheckedFill=t}get disableCheckedStroke(){return this._disableCheckedStroke}set disableCheckedStroke(t){this._disableCheckedStroke=t}get checkIconImage(){return this._checkIconImage}set checkIconImage(t){this._checkIconImage=t}get indeterminateIconImage(){return this._indeterminateIconImage}set indeterminateIconImage(t){this._indeterminateIconImage=t}getStyle(t){return new HC(t,this)}clone(){return new HC(this)}}function EC(t,e,i,r,o,n){return t||e?t instanceof BC?t:"function"==typeof t?EC(t(i),e,i,r,o,n):(t||(t={}),o&&!Y(t.autoWrapText)&&(t.autoWrapText=!0),r===HC?new HC(t??{},e??{},n.checkboxStyle??{}):new r(t??{},e??{})):r.DEFAULT}class kC{static _mode;static get mode(){return kC._mode||(kC._mode=function(){let t="browser";try{"node"===window.type?t="node":"undefined"==typeof window||window.performance?"undefined"==typeof window&&(t="node"):t="miniApp"}catch(e){t="node"}return t}()),kC._mode}static set mode(t){kC._mode=t}static dpr=0;static CreateCanvas;static LoadImage;static RequestAnimationFrame;static CancelAnimationFrame;static RegisterCreateCanvas(t){kC.CreateCanvas=t}static RegisterLoadImage(t){kC.LoadImage=t}static GetCreateCanvasFunc(){return kC.CreateCanvas?kC.CreateCanvas:"worker"===kC.mode?(t=200,e=200)=>new OffscreenCanvas(t,e):void 0}static RegisterRequestAnimationFrame(t){kC.RequestAnimationFrame=t()}static GetRequestAnimationFrame(){if(kC.RequestAnimationFrame)return kC.RequestAnimationFrame}static RegisterCancelAnimationFrame(t){kC.CancelAnimationFrame=t()}static GetCancelAnimationFrame(){if(kC.CancelAnimationFrame)return kC.CancelAnimationFrame}}function LC(t){return t?.hoverOn||"none"===t?.visible?0:t?.width??7}const FC=(t,e)=>(t=>{switch(Object.prototype.toString.call(t)){case"[object Object]":return"object";case"[object Function]":return"function";case"[object Array]":return"array";case"[object String]":return"string";case"[object Number]":return"number";case"[object RegExp]":return"regExp";case"[object Boolean]":return"boolean";case"[object Symbol]":return"symbol";case"[object Date]":return"date";case"[object Undefined]":return"undefined";case"[object Null]":return"null";case"[object Error]":return"error";case"[object HTMLDocument]":return"document";case"[object global]":return"global";default:return null}})(t)===e,IC=t=>FC(t,"object"),zC=t=>FC(t,"string"),OC=t=>FC(t,"number"),DC=t=>FC(t,"boolean");function WC(t,...e){if(!e.length)return t||{};const i=e.shift();if(IC(t)&&IC(i))for(const e in i)IC(i[e])?(t[e]||Object.assign(t,{[e]:{}}),IC(t[e])||Object.assign(t,{[e]:i[e]}),WC(t[e],i[e])):null!==i[e]&&void 0!==i[e]&&Object.assign(t,{[e]:i[e]});return WC(t,...e)}function NC(t){return"function"==typeof t&&(t=t()),Y(t)?`${t}`:""}function GC(t){if(t?.length<=0)return t;const e=t.length,i=t[0].length,r=new Array(i);for(let o=0;o<e;o++)for(let n=0;n<i;n++)r[n]||(r[n]=new Array(e)),r[n][o]=t[o][n];return r}function jC(t,e){let i=null;return function(...r){i||(t.apply(this,r),i=setTimeout((()=>{i=null}),e))}}function VC(t,e){for(t=`${t}`;t.length<e;)t="0"+t;return t}function UC(t,e,i){t=(t=t.replace(/^\s*|\s*$/,"")).replace(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i,"#$1$1$2$2$3$3");const r=Math.round(256*e)*(i?-1:1),o=t.match(new RegExp("^rgba?\\(\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])\\s*,\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])\\s*,\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])(?:\\s*,\\s*(0|1|0?\\.\\d+))?\\s*\\)$","i")),n=o&&Y(o[4])?o[4]:null,s=o?[o[1],o[2],o[3]]:t.replace(/^#?([a-f0-9][a-f0-9])([a-f0-9][a-f0-9])([a-f0-9][a-f0-9])/i,(function(){return`${parseInt(arguments[1],16)},${parseInt(arguments[2],16)},${parseInt(arguments[3],16)}`})).split(/,/);return o?`rgb${null!==n?"a":""}(${Math[i?"max":"min"](parseInt(s[0],10)+r,i?0:255)}, ${Math[i?"max":"min"](parseInt(s[1],10)+r,i?0:255)}, ${Math[i?"max":"min"](parseInt(s[2],10)+r,i?0:255)}${null!==n?`, ${n}`:""})`:["#",VC(Math[i?"max":"min"](parseInt(s[0],10)+r,i?0:255).toString(16),2),VC(Math[i?"max":"min"](parseInt(s[1],10)+r,i?0:255).toString(16),2),VC(Math[i?"max":"min"](parseInt(s[2],10)+r,i?0:255).toString(16),2)].join("")}function KC(t){return zC(t)||OC(t)||DC(t)?t.toString():""}function $C(){return navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)}function XC(t,e,i){return"desc"!==i?t===e?0:t>e?1:-1:t===e?0:t<e?1:-1}function YC(t){return/^-?\d+(\.\d+)?$/.test(t)}function qC(t){const e=[];for(let i=0;i<t.length;i++)-1===e.indexOf(t[i])&&e.push(t[i]);return e}const ZC="undefined"==typeof window||void 0===window.window;let JC,QC;const tw={get find(){return JC||(JC=Array.prototype.find?(t,e)=>Array.prototype.find.call(t,e):(t,e)=>{const i=tw.findIndex(t,e);return i>=0?t[i]:void 0},JC)},get findIndex(){return QC||(QC=Array.prototype.findIndex?(t,e)=>Array.prototype.findIndex.call(t,e):(t,e)=>{const{length:i}=t;for(let r=0;r<i;r++){if(e(t[r],r,t))return r}return-1},QC)}};const{IE:ew,Chrome:iw,Firefox:rw,Edge:ow,Safari:nw}=function(){if(ZC)return{IE:!1,Edge:!1,Chrome:!1,Firefox:!1,Safari:!1};const t=window.navigator.userAgent.toLowerCase();return{IE:!!/(msie|trident)/.exec(t),Edge:t.indexOf("edge")>-1,Chrome:t.indexOf("chrome")>-1&&-1===t.indexOf("edge"),Firefox:t.indexOf("firefox")>-1,Safari:t.indexOf("safari")>-1&&-1===t.indexOf("edge")}}();function sw(...t){const e={};return t.forEach((t=>{for(const i in t)Object.defineProperty(e,i,{get:()=>t[i],set(e){t[i]=e},configurable:!0,enumerable:!0})})),e}function aw(t,e,...i){let r=t;for(let t=0;t<i.length&&null!=r;t++)r=e(r,i[t]);return r}function lw(t,...e){return aw(t,((t,e)=>t[e]),...e)}function hw(t,...e){return"function"==typeof t?t(...e):t}function cw(t){return Boolean(t&&"function"==typeof t.then)}function dw(t,e,i){return t.start.col<=e&&e<=t.end.col&&t.start.row<=i&&i<=t.end.row||t.end.col<=e&&e<=t.start.col&&t.end.row<=i&&i<=t.start.row}function uw(t){return{start:{col:Math.min(t.start.col,t.end.col),row:Math.min(t.start.row,t.end.row)},end:{col:Math.max(t.start.col,t.end.col),row:Math.max(t.start.row,t.end.row)}}}function gw(t,e){const i=uw(t),r=uw(e);if(Math.max(i.start.col,r.start.col)<=Math.min(i.end.col,r.end.col)){if(Math.max(i.start.row,r.start.row)<=Math.min(i.end.row,r.end.row))return!0}return!1}const pw=ew,fw={isObject:function(t){return t===Object(t)}},mw={endsWith:function(t,e,i){const r=KC(t);("number"!=typeof i||!isFinite(i)||Math.floor(i)!==i||i>r.length)&&(i=r.length),i-=e.length;const o=r.lastIndexOf(e,i);return-1!==o&&o===i}},bw={isTouchEvent:function(t){return!!t.changedTouches}},yw={toBoxArray:function(t){return Array.isArray(t)?3===t.length?[t[0],t[1],t[2],t[1]]:2===t.length?[t[0],t[1],t[0],t[1]]:1===t.length?[t[0],t[0],t[0],t[0]]:[t[0],t[1],t[2],t[3]]:[t,t,t,t]}},Cw=Function.prototype,ww={CLICK_CELL:"click_cell",DBLCLICK_CELL:"dblclick_cell",MOUSEDOWN_CELL:"mousedown_cell",MOUSEUP_CELL:"mouseup_cell",SELECTED_CELL:"selected_cell",KEYDOWN:"keydown",MOUSEENTER_TABLE:"mouseenter_table",MOUSELEAVE_TABLE:"mouseleave_table",MOUSEDOWN_TABLE:"mousedown_table",MOUSEMOVE_CELL:"mousemove_cell",MOUSEENTER_CELL:"mouseenter_cell",MOUSELEAVE_CELL:"mouseleave_cell",CONTEXTMENU_CELL:"contextmenu_cell",RESIZE_COLUMN:"resize_column",RESIZE_COLUMN_END:"resize_column_end",RESIZE_ROW:"resize_row",RESIZE_ROW_END:"resize_row_end",CHANGE_HEADER_POSITION:"change_header_position",SORT_CLICK:"sort_click",FREEZE_CLICK:"freeze_click",SCROLL:"scroll",SCROLL_HORIZONTAL_END:"scroll_horizontal_end",SCROLL_VERTICAL_END:"scroll_vertical_end",DROPDOWN_MENU_CLICK:"dropdown_menu_click",MOUSEOVER_CHART_SYMBOL:"mouseover_chart_symbol",DRAG_SELECT_END:"drag_select_end",COPY_DATA:"copy_data",DROPDOWN_ICON_CLICK:"dropdown_icon_click",DROPDOWN_MENU_CLEAR:"dropdown_menu_clear",TREE_HIERARCHY_STATE_CHANGE:"tree_hierarchy_state_change",SHOW_MENU:"show_menu",HIDE_MENU:"hide_menu",ICON_CLICK:"icon_click",LEGEND_ITEM_CLICK:"legend_item_click",LEGEND_ITEM_HOVER:"legend_item_hover",LEGEND_ITEM_UNHOVER:"legend_item_unHover",LEGEND_CHANGE:"legend_change",MOUSEENTER_AXIS:"mouseenter_axis",MOUSELEAVE_AXIS:"mouseleave_axis",CHECKBOX_STATE_CHANGE:"checkbox_state_change",RADIO_STATE_CHANGE:"radio_state_change",AFTER_RENDER:"after_render",INITIALIZED:"initialized",CHANGE_CELL_VALUE:"change_cell_value",DRAG_FILL_HANDLE_END:"drag_fill_handle_end",MOUSEDOWN_FILL_HANDLE:"mousedown_fill_handle",DBLCLICK_FILL_HANDLE:"dblclick_fill_handle"},vw=(t,e)=>(t=>{switch(Object.prototype.toString.call(t)){case"[object Object]":return"object";case"[object Function]":return"function";case"[object Array]":return"array";case"[object String]":return"string";case"[object Number]":return"number";case"[object RegExp]":return"regExp";case"[object Boolean]":return"boolean";case"[object Symbol]":return"symbol";case"[object Date]":return"date";case"[object Undefined]":return"undefined";case"[object Null]":return"null";case"[object Error]":return"error";case"[object HTMLDocument]":return"document";case"[object global]":return"global";default:return null}})(t)===e;function xw(t,e,i){let r,o,n,s,a,l,h=0,c=!1,d=!1,u=!0;const g=!e&&0!==e&&"function"==typeof requestAnimationFrame;if("function"!=typeof t)throw new TypeError("Expected a function");function p(e){const i=r,n=o;return o=void 0,r=void 0,h=e,s=t.apply(n,i),s}function f(t,e){return g?requestAnimationFrame(t):setTimeout(t,e)}function m(t){const i=t-l;return void 0===l||i>=e||i<0||c&&t-h>=n}function b(){const t=Date.now();if(m(t))return function(t){return a=void 0,u&&r?p(t):(o=void 0,r=void 0,s)}(t);a=f(b,function(t){const i=t-h,r=e&&-(t-l);return c?Math.min(r,n-i):r}(t))}return e=+e||0,vw(i,"object")&&(d=!!i.leading,c="maxWait"in i,c&&(n=Math.max(+i.maxWait||0,e)),u="trailing"in i?!!i.trailing:u),function(...t){const i=Date.now(),n=m(i);if(r=t,o=this,l=i,n){if(void 0===a)return function(t){return h=t,a=f(b,e),d?p(t):s}(l);if(c)return a=f(b,e),p(l)}return void 0===a&&(a=f(b,e)),s}}let _w=1;class Sw{resizeTime=100;element;cb;observer;lastSize={width:0,height:0};callBackDebounce;constructor(t,e,i){if(this.element=t,this.cb=e,this.lastSize=this.getSize(),i&&(this.resizeTime=Math.max(i,16)),this.callBackDebounce=xw(this.callBack,this.resizeTime),window?.addEventListener("resize",this.onResize),"ResizeObserver"in window){const t=window.ResizeObserver;this.observer=new t(this.mutationResize),this.observer?.observe(this.element)}else"MutationObserver"in window&&(this.observer=new MutationObserver(this.mutationResize),this.observer.observe(this.element,{attributes:!0,attributeFilter:["style"]}))}mutationResize=()=>{this.onResize()};disConnect(){window.removeEventListener("resize",this.onResize),this.observer&&(this.observer.disconnect(),this.observer=void 0)}callBack=()=>{const t=this.getSize();t.width===this.lastSize.width&&t.height===this.lastSize.height||(this.lastSize=t,this.cb&&this.cb({...this.lastSize}))};setSize(t){this.lastSize=t}onResize=()=>{this.checkSize()&&this.callBackDebounce()};checkSize(){const t=this.getSize();return t.width!==this.lastSize.width||t.height!==this.lastSize.height}getSize(){return this.element?{width:Math.floor(this.element.clientWidth),height:Math.floor(this.element.clientHeight)}:{...this.lastSize}}}class Aw{resizeTime;listeners={};reseizeListeners={};on(t,e,i,...r){if("node"===kC.mode)return-1;const o=_w++;if(t?.addEventListener)if("resize"!==e||t===window)t?.addEventListener(e,i,...r);else{const e=new Sw(t,i,this.resizeTime);this.reseizeListeners[o]=e}const n={target:t,type:e,listener:i,options:r};return this.listeners[o]=n,o}once(t,e,i,...r){if("node"===kC.mode)return-1;const o=this.on(t,e,((...t)=>{this.off(o),i(...t)}),...r);return o}off(t){if("node"===kC.mode)return;if(null==t)return;const e=this.listeners?.[t];e&&(delete this.listeners[t],e.target.removeEventListener&&e.target.removeEventListener(e.type,e.listener,...e.options))}fire(t,e,...i){if("node"!==kC.mode)for(const r in this.listeners){const o=this.listeners[r];o.target===t&&o.type===e&&o.listener.call(o.target,...i)}}hasListener(t,e){if("node"===kC.mode)return!1;let i=!1;for(const r in this.listeners){const o=this.listeners[r];o.target===t&&o.type===e&&(i=!0)}return i}clear(){if("node"!==kC.mode){for(const t in this.listeners){const e=this.listeners[t];e.target.removeEventListener&&e.target.removeEventListener(e.type,e.listener,...e.options)}for(const t in this.reseizeListeners){const e=this.reseizeListeners[t];e?.disConnect()}this.listeners={}}}release(){"node"!==kC.mode&&(this.clear(),this.listeners={})}}const Rw=(t,e)=>{let i=0,r=t.length-1;for(;i<=r;){const o=Math.floor((i+r)/2);if(t[o]===e)return o;t[o]>e?r=o-1:i=o+1}return r<0?0:r};class Bw{_keys=[];_vals={};_sorted=!1;count(){return this._keys.length}values(){return this._vals}valueArr(){return Object.values(this._vals)}adjustOrder(t,e,i){const{_keys:r}=this;if(this._sorted||(r.sort(((t,e)=>t<e?-1:t>e?1:0)),this._sorted=!0),t>e){const o=[];for(let n=Rw(r,t+i-1);n>=0;n--){const s=r[n];if(s>=t)o.push(this.get(s));else if(e<=s&&s<t)this.put(s+i,this.get(s));else if(s<e)break}for(let t=0;t<i;t++)this.put(e+t,o[i-1-t])}const{length:o}=r;if(t<e){const n=[];for(let s=Rw(r,t);s<o;s++){const o=r[s];if(o>=t&&o<t+i)n.push(this.get(o));else if(t+i<=o&&o<=e)this.put(o-i,this.get(o));else if(o>e)break}for(let t=0;t<i;t++)this.put(e+t,n[t])}}exchangeOrder(t,e,i,r,o){const{_keys:n}=this;if(this._sorted||(n.sort(((t,e)=>t<e?-1:t>e?1:0)),this._sorted=!0),t>i){const r=[],s=[];for(let o=Rw(n,i);o<t+e;o++){const i=n[o];i>=t&&i<t+e?s.push(this.get(i)):r.push(this.get(i))}for(let t=0;t<e;t++)this.put(o+t,s[t]);for(let t=0;t<r.length;t++)this.put(o+e+t,r[t])}else{const s=[],a=[];for(let o=Rw(n,t);o<i+r;o++){const i=n[o];i>=t&&i<t+e?a.push(this.get(i)):s.push(this.get(i))}for(let t=0;t<e;t++)this.put(o+t,a[t]);for(let e=0;e<s.length;e++)this.put(t+e,s[e])}}del(t){delete this._vals[t];const e=this._keys.indexOf(t);-1!==e&&this._keys.splice(e,1)}put(t,e){t in this._vals||(this._keys.push(t),this._sorted=!1),this._vals[t]=e}get(t){return this._vals[t]}has(t){return Y(this._vals[t])}contain(t){return Object.values(this._vals).indexOf(t)>=0}each(t,e,i){const{_keys:r}=this,{length:o}=r;this._sorted||(r.sort(((t,e)=>t<e?-1:t>e?1:0)),this._sorted=!0);for(let n=Rw(r,t);n<o;n++){const o=r[n];if(t<=o&&o<=e){if(!1===i(this.get(o),o))break}else if(e<o)return}}clear(){this._keys.length=0,this._vals={},this._sorted=!1}getLastIndex(){return this._keys[this._keys.length-1]}delLast(){const t=this.getLastIndex();this.del(t)}delAndReorder(t){if(!this.has(t))return;const e=this.getLastIndex();this.adjustOrder(t+1,t,e-t),this.delLast()}addAndReorder(t,e){const i=this.getLastIndex();this.adjustOrder(t,t+1,i-t),Y(e)&&this.put(t,e)}}let Mw=class t{bounds;constructor(t,e,i,r){this.bounds=new de,this.bounds.set(t,e,t+i,e+r)}static bounds(e,i,r,o){return new t(e,i,Math.round(r-e),Math.round(o-i))}get left(){return this.bounds.x1}set left(t){this.bounds.x1=t}get top(){return this.bounds.y1}set top(t){this.bounds.y1=t}get right(){return this.bounds.x2}set right(t){this.bounds.x2=t}get bottom(){return this.bounds.y2}set bottom(t){this.bounds.y2=t}get width(){return this.bounds.width()}set width(t){this.bounds.x2=this.bounds.x1+t}get height(){return this.bounds.height()}set height(t){this.bounds.y2=this.bounds.y1+t}offsetLeft(t){this.bounds.translate(t,0)}offsetTop(t){this.bounds.translate(0,t)}copy(){return new t(this.left,this.top,this.width,this.height)}contains(t){return this.bounds.encloses(t.bounds)}inPoint(t,e){return this.bounds.contains(t,e)}};var Tw={underlayBackgroundColor:"transparent",defaultStyle:{color:"#D3D5DA",bgColor:"#373b45",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#444A54",padding:[8,12,8,12],hover:{cellBgColor:"#2F4774"}},headerStyle:{color:"#D3D5DA",bgColor:"#373b45",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#444A54",padding:[8,12,8,12],hover:{cellBgColor:"#2F4774"}},rowHeaderStyle:{},cornerHeaderStyle:{},bodyStyle:{color:"#e5e7ea",bgColor:function(t){const{row:e,table:i}=t;return 1&e-i.frozenRowCount?"#282a2e":"#2d3137"},fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#444A54",padding:[8,12,8,12],hover:{cellBgColor:"#29364D"}},frameStyle:{borderColor:"#d1d5da",borderLineWidth:1,borderLineDash:[],cornerRadius:10,shadowBlur:6,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(00, 24, 47, 0.06)"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:4,startColor:"rgba(00, 24, 47, 0.05)",endColor:"rgba(00, 24, 47, 0)"}},selectionStyle:{cellBgColor:"rgba(255, 255, 255, 0.1)",cellBorderColor:"#4284FF",cellBorderLineWidth:2},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};var Pw={underlayBackgroundColor:"#FFF",defaultStyle:{color:"#FFF",bgColor:"#5389FF",borderColor:"#5286FA",hover:{cellBgColor:"#2E67E3"}},headerStyle:{color:"#FFF",bgColor:"#5389FF",borderColor:"#A1C1FF",hover:{cellBgColor:"#2E67E3"}},bodyStyle:{color:"#000",bgColor:function(t){const{row:e,table:i}=t;return 1&e-i.frozenRowCount?"#FFF":"#F4F8FF"},borderColor:"#E0EAFE",hover:{cellBgColor:"#E9EFFD"}},frameStyle:{borderColor:"#E1E4E8",borderLineWidth:1,borderLineDash:[],cornerRadius:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"black"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:3,startColor:"#CBDCFE",endColor:"#CBDCFE"}},selectionStyle:{cellBgColor:"rgba(0, 0, 255,0.1)"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};var Hw={underlayBackgroundColor:"#FFF",defaultStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:14,fontFamily:"Arial,sans-serif",fontWeight:600,lineHeight:14,borderColor:"#e1e4e8",padding:[8,12,8,12]},headerStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:14,fontFamily:"Arial,sans-serif",fontWeight:600,lineHeight:14,borderColor:"#e1e4e8",padding:[8,12,8,12],hover:{cellBgColor:"#c8daf6"}},rowHeaderStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#e1e4e8",padding:[8,12,8,12],hover:{cellBgColor:"#c8daf6"}},cornerHeaderStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#e1e4e8",padding:[8,12,8,12],hover:{cellBgColor:"#c8daf6"}},bodyStyle:{padding:[8,12,8,12],color:"#141414",fontSize:14,fontFamily:"Arial,sans-serif",fontWeight:400,textAlign:"left",bgColor:function(t){const{row:e,table:i}=t;return 1&e-i.frozenRowCount?"#fbfbfc":"#FFF"},borderColor:"#e1e4e8",lineHeight:14,hover:{cellBgColor:"#F7F8FA",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},frameStyle:{borderColor:"#d1d5da",borderLineWidth:1,borderLineDash:[],cornerRadius:4,shadowBlur:6,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(00, 24, 47, 0.06)"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:4,startColor:"rgba(00, 24, 47, 0.05)",endColor:"rgba(00, 24, 47, 0)"}},selectionStyle:{cellBgColor:"rgba(0, 0, 255,0.1)",cellBorderLineWidth:2,cellBorderColor:"#3073f2"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};var Ew={underlayBackgroundColor:"#FFF",defaultStyle:{borderColor:"#E1E4E8",color:"#000",bgColor:"#ECF1F5"},headerStyle:{fontSize:16,fontWeight:"bold",bgColor:"#ECF1F5",hover:{cellBgColor:"#CCE0FF",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},rowHeaderStyle:{fontSize:16,fontWeight:"bold",bgColor:"#ECF1F5",hover:{cellBgColor:"#CCE0FF",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},cornerHeaderStyle:{fontSize:16,fontWeight:"bold"},bodyStyle:{fontSize:14,bgColor:function(t){const{row:e,table:i}=t;return 1&e-i.frozenRowCount?"#FDFDFD":"#FAF9FB"},hover:{cellBgColor:"#CCE0FF",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},frameStyle:{borderColor:"#E1E4E8",borderLineWidth:1,borderLineDash:[],cornerRadius:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"black"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:3,startColor:"rgba(225, 228, 232, 0.6)",endColor:"rgba(225, 228, 232, 0.6)"}},selectionStyle:{cellBgColor:"rgba(0, 0, 255,0.1)",cellBorderLineWidth:2,inlineColumnBgColor:"#CCE0FF",inlineRowBgColor:"#CCE0FF",cellBorderColor:"#0000ff"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};var kw={underlayBackgroundColor:"#FFF",defaultStyle:{borderColor:function(t){const{col:e,table:i}=t,{colCount:r,frozenColCount:o}=i,n="#ccc7c7",s="#ccc7c7";return o-1===e||r-1===e?[n,"#f2f2f2",s,null]:[n,null,s,null]},hover:{cellBorderColor:"#0000FF",cellBgColor:"#D0E0E3"},bgColor:"#FFF"},headerStyle:{color:"rgba(0, 0, 0, 0.87)",borderColor:function(t){const{row:e,table:{frozenRowCount:i}}=t;return i-1===e?["#f2f2f2","#f2f2f2","#ccc7c7","#f2f2f2"]:["#f2f2f2"]}},bodyStyle:{color:"rgba(0, 0, 0, 0.87)"},frameStyle:{borderColor:"#f2f2f2",borderLineWidth:1},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF"},selectionStyle:{cellBorderColor:"#FD5",cellBgColor:"rgba(111, 168, 220, 0.1)"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};const Lw={},Fw="Arial,sans-serif",Iw=[],zw=/^(https?|ftp|file):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/,Ow="$$indicator$$",Dw={type:"line"};function Ww(t){return t||{}}const Nw={visible:!0,position:"auto",padding:8,titleStyle:{fontSize:12,fontWeight:"bold",fill:"#4E5969"},contentStyle:{fontSize:12,fill:"#4E5969"},panel:{visible:!0,fill:"#fff",stroke:"#ffffff",lineWidth:0,cornerRadius:3,shadowBlur:12,shadowOffsetX:0,shadowOffsetY:4,shadowColor:"rgba(0, 0, 0, 0.1)",size:0,space:12}};function Gw(t,e,i,r){return lw(t,...i)??lw(e,...i)??(r&&lw(t,...r))??(r&&lw(e,...r))}class jw{internalTheme;_defaultStyle=null;_header=null;_cornerHeader=null;_cornerRightTopCell=null;_cornerLeftBottomCell=null;_cornerRightBottomCell=null;_rightFrozen=null;_bottomFrozen=null;_rowHeader=null;_body=null;_scroll=null;_tooltip=null;_frameStyle=null;_columnResize=null;_dragHeaderSplitLine=null;_frozenColumnLine=null;_selectionStyle=null;_axisStyle=null;_checkboxStyle=null;_radioStyle=null;_textPopTipStyle=null;isPivot=!1;constructor(t,e){this.internalTheme={obj:t,superTheme:e}}get font(){const{obj:t,superTheme:e}=this.internalTheme;return Gw(t,e,["font"],["bodyStyle","font"])}get underlayBackgroundColor(){const{obj:t,superTheme:e}=this.internalTheme;return Gw(t,e,["underlayBackgroundColor"])}get cellInnerBorder(){const{obj:t,superTheme:e}=this.internalTheme;return Gw(t,e,["cellInnerBorder"])??!0}get cellBorderClipDirection(){const{obj:t,superTheme:e}=this.internalTheme;return Gw(t,e,["cellBorderClipDirection"])??"top-left"}get _contentOffset(){const{obj:t,superTheme:e}=this.internalTheme;return Gw(t,e,["_contentOffset"])??0}get defaultStyle(){if(!this._defaultStyle){const{obj:t,superTheme:e}=this.internalTheme,i=WC({},e.defaultStyle,t.defaultStyle);this._defaultStyle={get fontSize(){return i.fontSize??16},get fontFamily(){return i.fontFamily??Fw},get fontWeight(){return i.fontWeight},get fontVariant(){return i.fontVariant},get fontStyle(){return i.fontStyle},get bgColor(){return i.bgColor??"#FFF"},get color(){return i.color??"#000"},get borderColor(){return i.borderColor??"#000"},get borderLineWidth(){return i.borderLineWidth??1},get borderLineDash(){return i.borderLineDash??Iw},get hover(){if(i.hover)return{get cellBgColor(){return i.hover?.cellBgColor??void 0},get inlineColumnBgColor(){return i.hover?.inlineColumnBgColor??(i.hover?.cellBgColor&&"string"==typeof i.hover?.cellBgColor?UC(i.hover?.cellBgColor,.1,!1):void 0)??void 0},get inlineRowBgColor(){return i.hover?.inlineRowBgColor??(i.hover?.cellBgColor&&"string"==typeof i.hover?.cellBgColor?UC(i.hover?.cellBgColor,.1,!1):void 0)??void 0}}},get padding(){return i.padding??[10,16,10,16]},get textAlign(){return i.textAlign??"left"},get textBaseline(){return i.textBaseline??"middle"},get textOverflow(){return i.textOverflow??"ellipsis"},get lineHeight(){return i.lineHeight},get autoWrapText(){return i.autoWrapText??!1},get lineClamp(){return i.lineClamp??"auto"},get linkColor(){return i.linkColor??"#3772ff"},get cursor(){return i.cursor??"auto"},get marked(){return i.marked??!1},get underline(){return i.underline??!1},get underlineColor(){return i.underlineColor},get underlineDash(){return i.underlineDash},get underlineOffset(){return i.underlineOffset},get lineThrough(){return i.lineThrough??!1},get lineThroughColor(){return i.lineThroughColor},get lineThroughDash(){return i.lineThroughDash}}}return this._defaultStyle}get headerStyle(){if(!this._header){const{obj:t,superTheme:e}=this.internalTheme,i=WC({},this.defaultStyle,e.headerStyle,t.headerStyle);this._header=this.getStyle(i)}return this._header}get cornerHeaderStyle(){if(!this._cornerHeader){const{obj:t,superTheme:e}=this.internalTheme,i=WC({},this.defaultStyle,e.cornerHeaderStyle,t.cornerHeaderStyle);this._cornerHeader=this.getStyle(i)}return this._cornerHeader}get cornerRightTopCellStyle(){if(!this._cornerRightTopCell){const{obj:t,superTheme:e}=this.internalTheme;if(!e.cornerRightTopCellStyle&&!t.cornerRightTopCellStyle)return this._cornerRightTopCell;const i=WC({},this.defaultStyle,e.cornerRightTopCellStyle,t.cornerRightTopCellStyle);this._cornerRightTopCell=this.getStyle(i)}return this._cornerRightTopCell}get cornerLeftBottomCellStyle(){if(!this._cornerLeftBottomCell){const{obj:t,superTheme:e}=this.internalTheme;if(!e.cornerLeftBottomCellStyle&&!t.cornerLeftBottomCellStyle)return this._cornerLeftBottomCell;const i=WC({},this.defaultStyle,e.cornerLeftBottomCellStyle,t.cornerLeftBottomCellStyle);this._cornerLeftBottomCell=this.getStyle(i)}return this._cornerLeftBottomCell}get cornerRightBottomCellStyle(){if(!this._cornerRightBottomCell){const{obj:t,superTheme:e}=this.internalTheme;if(!e.cornerRightBottomCellStyle&&!t.cornerRightBottomCellStyle)return this._cornerRightBottomCell;const i=WC({},this.defaultStyle,e.cornerRightBottomCellStyle,t.cornerRightBottomCellStyle);this._cornerRightBottomCell=this.getStyle(i)}return this._cornerRightBottomCell}get rightFrozenStyle(){if(!this._rightFrozen){const{obj:t,superTheme:e}=this.internalTheme;if(!e.rightFrozenStyle&&!t.rightFrozenStyle)return this._rightFrozen;const i=WC({},this.defaultStyle,this.rowHeaderStyle,e.rightFrozenStyle,t.rightFrozenStyle);this._rightFrozen=this.getStyle(i)}return this._rightFrozen}get bottomFrozenStyle(){if(!this._bottomFrozen){const{obj:t,superTheme:e}=this.internalTheme;if(!e.bottomFrozenStyle&&!t.bottomFrozenStyle)return this._bottomFrozen;const i=WC({},this.defaultStyle,this.headerStyle,e.bottomFrozenStyle,t.bottomFrozenStyle);this._bottomFrozen=this.getStyle(i)}return this._bottomFrozen}get rowHeaderStyle(){if(!this._rowHeader){const{obj:t,superTheme:e}=this.internalTheme,i=WC({},this.defaultStyle,e.rowHeaderStyle,t.rowHeaderStyle??(this.isPivot?null:t.headerStyle));this._rowHeader=this.getStyle(i)}return this._rowHeader}get bodyStyle(){if(!this._body){const{obj:t,superTheme:e}=this.internalTheme,i=WC({},this.defaultStyle,e.bodyStyle,t.bodyStyle);this._body=this.getStyle(i)}return this._body}get frameStyle(){if(!this._frameStyle){const{obj:t,superTheme:e}=this.internalTheme,i=WC({},e.frameStyle,t.frameStyle);this._frameStyle={get borderColor(){return i.borderColor},get borderLineWidth(){return i.borderLineWidth},get borderLineDash(){return i.borderLineDash},get innerBorder(){return i.innerBorder},get shadowBlur(){return i.shadowBlur},get shadowColor(){return i.shadowColor},get shadowOffsetX(){return i.shadowOffsetX},get shadowOffsetY(){return i.shadowOffsetY},get cornerRadius(){return i.cornerRadius}}}return this._frameStyle}get scrollStyle(){if(!this._scroll){const{obj:t,superTheme:e}=this.internalTheme,i=WC({},e.scrollStyle,t.scrollStyle);this._scroll={get scrollSliderColor(){return i.scrollSliderColor??"#C0C0C0"},get scrollRailColor(){return i.scrollRailColor},get visible(){return i.visible??"scrolling"},get width(){return i.width??7},get hoverOn(){return i.hoverOn??!0},get barToSide(){return i.barToSide??!1}}}return this._scroll}get tooltipStyle(){if(!this._tooltip){const{obj:t,superTheme:e}=this.internalTheme,i=WC({},e.tooltipStyle,t.tooltipStyle);this._tooltip={get fontFamily(){return i.fontFamily??Fw},get fontSize(){return i.fontSize??16},get bgColor(){return i.bgColor??"#000"},get padding(){return i.padding??[6,8]},get color(){return i.color??"#FFF"}}}return this._tooltip}get columnResize(){if(!this._columnResize){const{obj:t,superTheme:e}=this.internalTheme,i=WC({},e.columnResize,t.columnResize);this._columnResize={get lineColor(){return i.lineColor??"#416EFF"},get bgColor(){return i.bgColor??"#D9E2FF"},get lineWidth(){return i.lineWidth??1},get width(){return i.width??i.lineWidth+2},get labelColor(){return i.labelColor??"#FFF"},get labelFontSize(){return i.labelFontSize??10},get labelFontFamily(){return i.labelFontFamily??"sans-serif"},get labelBackgroundFill(){return i.labelBackgroundFill??"#3073F2"},get labelBackgroundCornerRadius(){return i.labelBackgroundCornerRadius??5}}}return this._columnResize}get dragHeaderSplitLine(){if(!this._dragHeaderSplitLine){const{obj:t,superTheme:e}=this.internalTheme,i=WC({},e.dragHeaderSplitLine,t.dragHeaderSplitLine);this._dragHeaderSplitLine={get lineColor(){return i.lineColor??"blue"},get lineWidth(){return i.lineWidth??2},get shadowBlockColor(){return i.shadowBlockColor??"rgba(204,204,204,0.3)"}}}return this._dragHeaderSplitLine}get frozenColumnLine(){if(!this._frozenColumnLine){const{obj:t,superTheme:e}=this.internalTheme,i=WC({},e.frozenColumnLine,t.frozenColumnLine);this._frozenColumnLine={get shadow(){if(i.shadow)return{get width(){return i.shadow?.width??24},get startColor(){return i.shadow?.startColor??"rgba(00, 24, 47, 0.06)"},get endColor(){return i.shadow?.endColor??"rgba(00, 24, 47, 0)"}}},get border(){if(i.border)return{get lineColor(){return i.border?.lineColor??"rgba(00, 24, 47, 0.06)"},get bgColor(){return i.border?.bgColor??i.border?.lineColor??"rgba(00, 24, 47, 0.06)"},get lineWidth(){return i.border?.lineWidth??4},get width(){return i.border?.width??i.border?.lineWidth??4}}}}}return this._frozenColumnLine}get selectionStyle(){if(!this._selectionStyle){const{obj:t,superTheme:e}=this.internalTheme,i=WC({},e.selectionStyle,t.selectionStyle);this._selectionStyle={get cellBgColor(){return i?.cellBgColor??"rgba(0, 0, 255,0.1)"},get cellBorderColor(){return i?.cellBorderColor??"#3073f2"},get cellBorderLineWidth(){return i?.cellBorderLineWidth??2}}}return this._selectionStyle}get axisStyle(){if(!this._axisStyle){const{obj:t,superTheme:e}=this.internalTheme,i=WC({},e.axisStyle,t.axisStyle);this._axisStyle=function(t){return{defaultAxisStyle:Ww(t.defaultAxisStyle),leftAxisStyle:Ww(t.leftAxisStyle),rightAxisStyle:Ww(t.rightAxisStyle),topAxisStyle:Ww(t.topAxisStyle),bottomAxisStyle:Ww(t.bottomAxisStyle)}}(i)}return this._axisStyle}get checkboxStyle(){if(!this._checkboxStyle){const{obj:t,superTheme:e}=this.internalTheme,i=WC({},e.checkboxStyle,t.checkboxStyle);this._checkboxStyle=i}return this._checkboxStyle}get radioStyle(){if(!this._radioStyle){const{obj:t,superTheme:e}=this.internalTheme,i=WC({},e.radioStyle,t.radioStyle);this._radioStyle=i}return this._radioStyle}get textPopTipStyle(){if(!this._textPopTipStyle){const{obj:t,superTheme:e}=this.internalTheme,i=WC({},Nw,e.textPopTipStyle,t.textPopTipStyle);this._textPopTipStyle=i}return this._textPopTipStyle}hasProperty(t){const{obj:e,superTheme:i}=this.internalTheme;return Vw(e,t)||Vw(i,t)}extends(t){return new jw(t,this)}getStyle(t){return{get fontSize(){return t.fontSize},get fontFamily(){return t.fontFamily},get fontWeight(){return t.fontWeight},get fontVariant(){return t.fontVariant},get fontStyle(){return t.fontStyle},get bgColor(){return t.bgColor},get color(){return t.color},get borderColor(){return t.borderColor},get borderLineWidth(){return t.borderLineWidth},get borderLineDash(){return t.borderLineDash},get hover(){if(t.hover)return{get cellBgColor(){return t.hover?.cellBgColor??void 0},get inlineColumnBgColor(){return t.hover?.inlineColumnBgColor??(t.hover?.cellBgColor&&"string"==typeof t.hover?.cellBgColor?UC(t.hover?.cellBgColor,.1,!1):void 0)??void 0},get inlineRowBgColor(){return t.hover?.inlineRowBgColor??(t.hover?.cellBgColor&&"string"==typeof t.hover?.cellBgColor?UC(t.hover?.cellBgColor,.1,!1):void 0)??void 0}}},get frameStyle(){if(t.frameStyle)return{get borderColor(){return t.frameStyle?.borderColor??void 0},get borderLineWidth(){return t.frameStyle?.borderLineWidth??void 0},get borderLineDash(){return t.frameStyle?.borderLineDash??void 0}}},get padding(){return t.padding},get textAlign(){return t.textAlign},get textBaseline(){return t.textBaseline},get textOverflow(){return t.textOverflow},get lineHeight(){return t.lineHeight},get autoWrapText(){return t.autoWrapText},get lineClamp(){return t.lineClamp},get linkColor(){return t.linkColor},get cursor(){return t.cursor},get textStick(){return t.textStick},get marked(){return t.marked},get underline(){return t.underline??!1},get underlineColor(){return t.underlineColor},get underlineDash(){return t.underlineDash},get underlineOffset(){return t.underlineOffset},get lineThrough(){return t.lineThrough??!1},get lineThroughColor(){return t.lineThroughColor},get lineThroughDash(){return t.lineThroughDash}}}}function Vw(t,e){if(t instanceof jw)return t.hasProperty(e);let i=t;if(!i)return!1;for(let t=0;t<e.length;t++){if(i=i[e[t]],!i)return!1}return!!i}const Uw=new jw(Tw,Tw),Kw=new jw(Pw,Pw),$w=new jw(Hw,Hw),Xw=new jw(Ew,Ew),Yw=new jw(kw,kw),qw={DEFAULT:Xw,SIMPLIFY:Yw,ARCO:$w,DARK:Uw,BRIGHT:Kw},Zw={TableTheme:jw};function Jw(t){if(!t)return null;if("string"==typeof t){const e=function(t,e){if(t[e])return t[e];const i=e.toLowerCase();if(t[i])return t[i];const r=e.toLowerCase();if(t[r])return t[r];for(const e in t)if(e.toLowerCase()===i)return t[e]}(Qw(),t);return e?e instanceof jw?e:new jw(e,e):null}return t instanceof jw?t:new jw(t,t)}function Qw(){return sw(qw,Lw)}var tv={DARK:Uw,BRIGHT:Kw,ARCO:$w,DEFAULT:Xw,SIMPLIFY:Yw,theme:Zw,of:Jw,get:Qw},ev=Object.freeze({__proto__:null,ARCO:$w,BRIGHT:Kw,DARK:Uw,DEFAULT:Xw,SIMPLIFY:Yw,default:tv,get:Qw,of:Jw,theme:Zw});function iv(t,e,i){if(t.internalProps.customMergeCell){const r=t.getCustomMerge(e,i);if(r)return r.range}if(!t.isHeader(e,i)&&!t.getBodyColumnDefine(e,i)?.mergeCell)return!1;const r=t.getCellRange(e,i);return!(r.start.col===r.end.col&&r.start.row===r.end.row)&&r}const rv=["x","y","dx","dy","scaleX","scaleY","angle","anchor","postMatrix","visible","clip","pickable","childrenPickable","zIndex","cursor"];class ov extends hs{constructor(t,e){super(t),(null==e?void 0:e.mode)&&(this.mode=e.mode,this.setMode(e.mode)),(null==e?void 0:e.skipDefault)&&(this.skipDefault=!0),this.setTheme({common:{strokeBoundsBuffer:0}}),this.attribute=t,this.onSetStage((()=>{this.render(),this.bindEvents()}))}setAttribute(t,e,i){J(this.attribute[t])&&J(e)&&!$(this.attribute[t])&&!$(e)?wt(this.attribute[t],e):this.attribute[t]=e,rv.includes(t)||this.render(),this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!i&&!this.needUpdateTag(t)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.onAttributeUpdate()}setAttributes(t,e){const i=Object.keys(t);this._mergeAttributes(t,i),i.every((t=>rv.includes(t)))||this.render(),this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!e&&!this.needUpdateTags(i)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.onAttributeUpdate()}_mergeAttributes(t,e){X(e)&&(e=Object.keys(t));for(let i=0;i<e.length;i++){const r=e[i];!J(this.attribute[r])||$(this.attribute[r])||$(t[r])?this.attribute[r]=t[r]:wt(this.attribute[r],t[r])}}bindEvents(){}_getNodeId(t){return`${this.id}-${this.name}-${t}`}_dispatchEvent(t,e){var i;const r=new Ao(t,e);r.manager=null===(i=this.stage)||void 0===i?void 0:i.eventSystem.manager,this.dispatchEvent(r)}}function nv(){My(),Wy()}var sv;!function(t){t.selected="selected",t.selectedReverse="selected_reverse",t.hover="hover",t.hoverReverse="hover_reverse"}(sv||(sv={}));const av={[sv.selectedReverse]:{},[sv.selected]:{},[sv.hover]:{},[sv.hoverReverse]:{}},lv={container:"",width:30,height:30,style:{}},hv={debounce:jt,throttle:function(t,e,i){let r=!0,o=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return q(i)&&(r="leading"in i?!!i.leading:r,o="trailing"in i?!!i.trailing:o),jt(t,e,{leading:r,trailing:o,maxWait:e})}};nv();class cv extends ov{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:wt({},cv.defaultAttributes,t)),this.name="scrollbar",this._onRailPointerDown=t=>{const{viewX:e,viewY:i}=t,{direction:r,width:o,height:n,range:s}=this.attribute,a=this._sliderSize,[l,h]=this._getScrollRange();let c;if("vertical"===r){const t=i-this._viewPosition.y,e=Dt(t-a/2,l,h);c=t/n,this._slider.setAttribute("y",e,!0)}else{const t=e-this._viewPosition.x,i=Dt(t-a/2,l,h);c=t/o,this._slider.setAttribute("x",i,!0)}this.setScrollRange([c-(s[1]-s[0])/2,c+(s[1]-s[0])/2],!1),this.stage&&!this.stage.autoRender&&this.stage.renderNextFrame()},this._onSliderPointerDown=t=>{t.stopPropagation();const{direction:e}=this.attribute;this._prePos="horizontal"===e?t.clientX:t.clientY,this._dispatchEvent("scrollDown",{pos:this._prePos,event:t}),"browser"===Su.env?(Su.addEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),Su.addEventListener("pointerup",this._onSliderPointerUp)):(this.stage.addEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),this.stage.addEventListener("pointerup",this._onSliderPointerUp),this.stage.addEventListener("pointerupoutside",this._onSliderPointerUp))},this._computeScrollValue=t=>{const{direction:e}=this.attribute;let i,r,o=0;const{width:n,height:s}=this._getSliderRenderBounds();return"vertical"===e?(r=t.clientY,o=r-this._prePos,i=o/s):(r=t.clientX,o=r-this._prePos,i=o/n),[r,i]},this._onSliderPointerMove=t=>{t.stopPropagation();const e=this.getScrollRange(),[i,r]=this._computeScrollValue(t);this.setScrollRange([e[0]+r,e[1]+r],!0),this._prePos=i},this._onSliderPointerMoveWithDelay=0===this.attribute.delayTime?this._onSliderPointerMove:hv[this.attribute.delayType](this._onSliderPointerMove,this.attribute.delayTime),this._onSliderPointerUp=t=>{t.preventDefault();const{realTime:e=!0,range:i,limitRange:r=[0,1]}=this.attribute,o=this.getScrollRange(),[n,s]=this._computeScrollValue(t),a=[o[0]+s,o[1]+s];this._dispatchEvent("scrollUp",{pre:i,value:Wt(a,r[0],r[1])}),"browser"===Su.env?(Su.removeEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),Su.removeEventListener("pointerup",this._onSliderPointerUp)):(this.stage.removeEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),this.stage.removeEventListener("pointerup",this._onSliderPointerUp),this.stage.removeEventListener("pointerupoutside",this._onSliderPointerUp))}}setScrollRange(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{direction:i="horizontal",limitRange:r=[0,1],range:o,realTime:n=!0}=this.attribute,s=Wt(t,r[0],r[1]);if(e){const t=this._getSliderPos(s);if(this._slider){const e=t[1]-t[0];this._sliderSize=e,"horizontal"===i?this._slider.setAttributes({x:t[0],width:e},!0):this._slider.setAttributes({y:t[0],height:e},!0),this.stage&&!this.stage.autoRender&&this.stage.renderNextFrame()}}this.attribute.range=s,n&&this._dispatchEvent("scrollDrag",{pre:o,value:s})}getScrollRange(){return this.attribute.range}bindEvents(){if(this.attribute.disableTriggerEvent)return;const{delayType:t="throttle",delayTime:e=0}=this.attribute;this._rail&&this._rail.addEventListener("pointerdown",hv[t](this._onRailPointerDown,e)),this._slider&&this._slider.addEventListener("pointerdown",this._onSliderPointerDown)}render(){this._reset();const{direction:t="horizontal",width:e,height:i,range:r,limitRange:o=[0,1],railStyle:n,sliderStyle:s,padding:a=2}=this.attribute,l=this.createOrUpdateChild("scrollbar-container",{},"group"),h=l.createOrUpdateChild("scrollbar-rail",Object.assign({x:0,y:0,width:e,height:i},n),"rect");this._rail=h;const c=this._getSliderRenderBounds(),d=this._getSliderPos(Wt(r,o[0],o[1])),u=d[1]-d[0];let g;this._sliderSize=u,g="horizontal"===t?{x:d[0],y:c.y1,width:u,height:c.height}:{x:c.x1,y:d[0],width:c.width,height:u};const p=l.createOrUpdateChild("slider",Object.assign(Object.assign(Object.assign(Object.assign({},g),{cornerRadius:this._getDefaultSliderCornerRadius()}),s),{boundsPadding:Ze(a),pickMode:"imprecise"}),"rect");this._slider=p,this._container=l;const f=this._container.AABBBounds;this._viewPosition={x:f.x1,y:f.y1}}_getSliderRenderBounds(){if(this._sliderRenderBounds)return this._sliderRenderBounds;const{width:t,height:e,padding:i=2}=this.attribute,[r,o,n,s]=Ze(i),a={x1:s,y1:r,x2:t-o,y2:e-n,width:Math.max(0,t-(s+o)),height:Math.max(0,e-(r+n))};return this._sliderRenderBounds=a,a}_getDefaultSliderCornerRadius(){const{direction:t,round:e}=this.attribute;if(e){const{width:e,height:i}=this._getSliderRenderBounds();return"horizontal"===t?i:e}return 0}_getSliderPos(t){const{direction:e}=this.attribute,{width:i,height:r,x1:o,y1:n}=this._getSliderRenderBounds();return"horizontal"===e?[i*t[0]+o,i*t[1]+o]:[r*t[0]+n,r*t[1]+n]}_getScrollRange(){if(this._sliderLimitRange)return this._sliderLimitRange;const{limitRange:t=[0,1],direction:e}=this.attribute,[i,r]=Wt(t,0,1),{width:o,height:n,x1:s,y1:a}=this._getSliderRenderBounds(),l=this._sliderSize;return"horizontal"===e?Wt([s+i*o,s+r*o],s,o-l):Wt([a+i*n,a+r*n],a,n-l)}_reset(){this._sliderRenderBounds=null,this._sliderLimitRange=null}}function dv(t,e){t.forEachChildren((t=>{const i=e(t);t.isContainer&&!i&&dv(t,e)}))}function uv(t,e,i){const r=function(t,e){const[i,r]=t,[o,n]=e,s=Math.sqrt((i*i+r*r)*(o*o+n*n)),a=s&&(i*o+r*n)/s;return Math.acos(Math.min(Math.max(a,-1),1))}(t,e),o=function(t,e){return t[0]*e[1]-e[0]*t[1]}(t,e)>=0;return i?o?2*Math.PI-r:r:o?r:2*Math.PI-r}function gv(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t)return{width:0,height:0};const r=dh({text:t,fontFamily:e.fontFamily||i.fontFamily||"PingFang SC,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif, apple color emoji,segoe ui emoji,segoe ui symbol",fontSize:e.fontSize||i.fontSize||12,fontWeight:e.fontWeight||i.fontWeight,textAlign:e.textAlign||"center",textBaseline:e.textBaseline,ellipsis:!!e.ellipsis,maxLineWidth:e.maxLineWidth||1/0,lineHeight:e.fontSize||i.fontSize||12});return{width:r.width(),height:r.height()}}function pv(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"type";return e in t&&"rich"===t[e]||q(t.text)&&"rich"===t.text.type}function fv(t){var e,i;return t.width=null!==(e=t.width)&&void 0!==e?e:0,t.height=null!==(i=t.height)&&void 0!==i?i:0,t.maxWidth=t.maxLineWidth,t.textConfig=t.text.text||t.text,t}function mv(){My(),Wy(),Xy(),Vy(),qy()}cv.defaultAttributes={direction:"horizontal",round:!0,sliderSize:20,sliderStyle:{fill:"rgba(0, 0, 0, .5)"},railStyle:{fill:"rgba(0, 0, 0, .0)"},padding:2,scrollRange:[0,1],delayType:"throttle",delayTime:0,realTime:!0};var bv=function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(i[r[o]]=t[r[o]])}return i};mv();let yv=class t extends ov{constructor(e,i){super((null==i?void 0:i.skipDefault)?e:wt({},t.defaultAttributes,e)),this.name="tag"}render(){var t,e,i;const{text:r="",textStyle:o={},shape:n={},panel:s={},space:a=4,minWidth:l,maxWidth:h,padding:c=4,visible:d,state:u,type:g,textAlwaysCenter:p}=this.attribute,f=Ze(c),m=this.createOrUpdateChild("tag-content",{x:0,y:0,zIndex:1},"group");let b,y=f[1]+f[3],C=f[0]+f[2],w=0,v=0;const{visible:x}=n,_=bv(n,["visible"]);if(K(x)){const t=(null==_?void 0:_.size)||10,e=ot(t)?t:Math.max(t[0],t[1]);b=m.createOrUpdateChild("tag-shape",Object.assign(Object.assign({symbolType:"circle",size:t,strokeBoundsBuffer:0},_),{visible:x,x:e/2,y:e/2}),"symbol"),ut(null==u?void 0:u.shape)||(b.states=u.shape),x&&(v=e+a)}let S;if(y+=v,w+=v,pv({text:r})||"rich"===g){const t=Object.assign(Object.assign(Object.assign({},fv(Object.assign({type:g,text:r},o))),o),{visible:Y(r)&&!1!==d,x:w,y:0});S=m.createOrUpdateChild("tag-text",t,"richtext");const{visible:e}=s,i=bv(s,["visible"]);if(d&&K(e)){const t=this.createOrUpdateChild("tag-panel",Object.assign(Object.assign({},i),{visible:e&&!!r,x:S.AABBBounds.x1,y:S.AABBBounds.y1,width:S.AABBBounds.width(),height:S.AABBBounds.height()}),"rect");ut(null==u?void 0:u.panel)||(t.states=u.panel)}}else{const a=Object.assign(Object.assign({text:q(r)&&"type"in r&&"text"===r.type?r.text:r,visible:Y(r)&&!1!==d,lineHeight:null==o?void 0:o.fontSize},o),{x:w,y:0});X(a.lineHeight)&&(a.lineHeight=o.fontSize),S=m.createOrUpdateChild("tag-text",a,"text"),ut(null==u?void 0:u.text)||(S.states=u.text);const c=gv(a.text,o,null===(e=null===(t=this.stage)||void 0===t?void 0:t.getTheme())||void 0===e?void 0:e.text),g=c.width,x=c.height;y+=g;const _=null!==(i=n.size)&&void 0!==i?i:10,A=ot(_)?_:Math.max(_[0],_[1]);C+=Math.max(x,n.visible?A:0);const{textAlign:R,textBaseline:B}=o;(Y(l)||Y(h))&&(Y(l)&&y<l&&(y=l),Y(h)&&y>h&&(y=h,S.setAttribute("maxLineWidth",h-f[1]-f[2])));let M=0,T=0,P=0;if("left"===R||"start"===R?P=1:"right"===R||"end"===R?P=-1:"center"===R&&(P=0),P?P<0?(M-=y,b&&b.setAttribute("x",(b.attribute.x||0)-g),m.setAttribute("x",-f[1]-v)):P>0&&m.setAttribute("x",f[3]):(M-=y/2,b&&b.setAttribute("x",(b.attribute.x||0)-g/2),m.setAttribute("x",-v/2)),p&&P){const t=y-f[1]-f[3],e=g+v,i=(t-e)/2+v+g/2,r=(t-e)/2+A/2;S.setAttributes({x:i*P,textAlign:"center"}),null==b||b.setAttributes({x:r*P}),m.setAttribute("x",f[2+P]*P)}"middle"===B?(T-=C/2,b&&b.setAttribute("y",0)):"bottom"===B?(T-=C,b&&b.setAttribute("y",-x/2),m.setAttribute("y",-f[2])):"top"===B&&(m.setAttribute("y",f[0]),b&&b.setAttribute("y",x/2));const{visible:H}=s,E=bv(s,["visible"]);if(d&&K(H)){const t=this.createOrUpdateChild("tag-panel",Object.assign(Object.assign({},E),{visible:H&&!!r,x:M,y:T,width:y,height:C}),"rect");ut(null==u?void 0:u.panel)||(t.states=u.panel)}}}};yv.defaultAttributes={visible:!0,textStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},space:4,padding:4,shape:{fill:"#000"}};const Cv={visible:!0,position:"auto",titleStyle:{fontSize:16,fill:"#08979c"},contentStyle:{fontSize:12,fill:"green"},panel:{visible:!0,fill:"#e6fffb",size:12,space:0,stroke:"#87e8de",lineWidth:1,cornerRadius:4}},wv={poptip:wt({},Cv)};var vv=function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(i[r[o]]=t[r[o]])}return i};const xv=new ue;My(),qy(),Xy(),Wy();class _v extends ov{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:wt({},_v.defaultAttributes,t)),this.name="poptip",this.positionList=["top","tl","tr","bottom","bl","br","left","lt","lb","right","rt","rb"]}render(){var t,e,i,r,o,n,s,a;const{titleStyle:l={},position:h,contentStyle:c={},panel:d={},space:u=4,minWidth:g=0,maxWidth:p=1/0,padding:f=4,maxWidthPercent:m,visible:b,state:y,dx:C=0,dy:w=0}=this.attribute;let{title:v="",content:x=""}=this.attribute;v=this.attribute.titleFormatMethod?this.attribute.titleFormatMethod(v):v,x=this.attribute.contentFormatMethod?this.attribute.contentFormatMethod(x):x;const _=Ze(f),S=this.createOrUpdateChild("poptip-content",{x:0,y:0,zIndex:1},"group"),A=p-_[1]-_[3],R=Y(v)&&!1!==b,B=Object.assign(Object.assign({text:et(v)?v:[v],visible:R,wrap:!0},l),{x:_[3],y:_[0],maxLineWidth:A,textAlign:"left",textBaseline:"top"}),M=S.createOrUpdateChild("poptip-title",B,"text");ut(null==y?void 0:y.title)||(M.states=y.title);const T=M.AABBBounds,P=T.height(),H=T.width();let E=P+u;R||(E=0);const k=Y(x)&&!1!==b,L=Object.assign(Object.assign({text:et(x)?x:[x],visible:k,wrap:!0},c),{x:_[3],y:_[0]+E,maxLineWidth:A,textAlign:"left",textBaseline:"top"}),F=S.createOrUpdateChild("poptip-content",L,"text");ut(null==y?void 0:y.content)||(F.states=y.content);const I=F.AABBBounds,z=I.height(),O=I.width();k&&(E+=z);let D=te(H+_[1]+_[3],O+_[1]+_[3]);D>p?D=p:D<g&&(D=g);let W=_[0]+_[2]+E;const{visible:N}=d,G=vv(d,["visible"]),j=null!==(t=G.size)&&void 0!==t?t:12,V=et(j)?[j[0]+(null!==(e=G.space)&&void 0!==e?e:0),j[1]+(null!==(i=G.space)&&void 0!==i?i:0)]:j+(null!==(r=G.space)&&void 0!==r?r:0),U=null!==(o=G.lineWidth)&&void 0!==o?o:1,$=this.stage?[null!==(n=this.stage.viewWidth)&&void 0!==n?n:this.stage.width,null!==(s=this.stage.viewHeight)&&void 0!==s?s:this.stage.height]:void 0;if($){const t=this.AABBBounds,e=null!==(a=this.attribute.x)&&void 0!==a?a:t.x1,i=$[0]-t.x1;let r=Math.max(e,i);const o=(et(j)?j[0]:12)+3;if(r=Math.min(r-o,r*m),r<D){D=r;const t=_[1]+_[3];M.setAttribute("maxLineWidth",r-t),F.setAttribute("maxLineWidth",r-t),W=_[0]+_[2],R&&(W+=M.AABBBounds.height()+u),W+=F.AABBBounds.height()}}const X="auto"===h;let q,Z=-1/0;for(let t=0;t<this.positionList.length+1;t++){const e=X?this.positionList[t===this.positionList.length?q:t]:h,{angle:i,offset:r,rectOffset:o}=this.getAngleAndOffset(e,D,W,et(V)?V:[V,V-U]);if(K(N)){const t=(et(j)?j[0]:j)/4,e=S.createOrUpdateChild("poptip-symbol-panel",Object.assign(Object.assign({},G),{visible:N&&(k||R),x:t,y:0,strokeBoundsBuffer:-1,boundsPadding:-2,anchor:[0,0],symbolType:"arrow2Left",angle:i,dx:r[0],dy:r[1],size:j,zIndex:-9}),"symbol");ut(null==y?void 0:y.panel)||(e.states=y.panel);const o=S.createOrUpdateChild("poptip-rect-panel",Object.assign(Object.assign({},G),{visible:N&&(k||R),x:0,y:0,width:D,height:W,zIndex:-8}),"rect");ut(null==y?void 0:y.panel)||(o.states=y.panel)}if(S.setAttributes({x:-r[0]+C,y:-r[1]+w}),!X||!$)break;{xv.setValue(0,0,D,W).transformWithMatrix(S.globalTransMatrix);const e=xv,i=(new de).setValue(0,0,$[0],$[1]);if(Q=i,tt=!1,(J=e)&&Q?(Te=J.x1,Pe=J.x2,He=J.y1,Ee=J.y2,ke=Q.x1,Le=Q.x2,Fe=Q.y1,Ie=Q.y2,tt&&(Te>Pe&&([Te,Pe]=[Pe,Te]),He>Ee&&([He,Ee]=[Ee,He]),ke>Le&&([ke,Le]=[Le,ke]),Fe>Ie&&([Fe,Ie]=[Ie,Fe])),Te>ke&&Pe<Le&&He>Fe&&Ee<Ie?Oe.BBOX1:ke>Te&&Le<Pe&&Fe>He&&Ie<Ee?Oe.BBOX2:Oe.NONE):Oe.NONE)break;{const r=ze(e,i,!1),o=(r.x2-r.x1)*(r.y2-r.y1);o>Z&&(Z=o,q=t)}}}var J,Q,tt}getAngleAndOffset(t,e,i,r){const o=r[1]/2;switch(t){case"tl":return{angle:$t/2*3,offset:[e/4,i+o],rectOffset:[-e/4,-i-r[1]]};case"top":return{angle:$t/2*3,offset:[e/2,i+o],rectOffset:[0,-i-r[1]]};case"tr":return{angle:$t/2*3,offset:[e/4*3,i+o],rectOffset:[e/4*3,-i-r[1]]};case"rt":return{angle:0,offset:[-o,i/5],rectOffset:[e/4*3,-i-r[1]]};case"right":return{angle:0,offset:[-o,i/2],rectOffset:[e/4*3,-i-r[1]]};case"rb":return{angle:0,offset:[-o,i/5*4],rectOffset:[e/4*3,-i-r[1]]};case"bl":return{angle:$t/2,offset:[e/4,-o],rectOffset:[-e/4,-i-r[1]]};case"bottom":return{angle:$t/2,offset:[e/2,-o],rectOffset:[0,-i-r[1]]};case"br":return{angle:$t/2,offset:[e/4*3,-o],rectOffset:[e/4*3,-i-r[1]]};case"lt":return{angle:$t,offset:[e+o,i/5],rectOffset:[-e/4,-i-r[1]]};case"left":return{angle:$t,offset:[e+o,i/2],rectOffset:[0,-i-r[1]]};case"lb":return{angle:$t,offset:[e+o,i/5*4],rectOffset:[e/4*3,-i-r[1]]}}}}_v.defaultAttributes={position:"rt",visible:!0,title:null,content:null,titleStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},contentStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},maxWidthPercent:.8,space:8,padding:10};var Sv=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let Av=class{render(t,e,i,r,o,n,s,a,l,h,c,d,u){var g;if(1===t._showPoptip){const{visible:e,visibleCb:i}=t.attribute.poptip||{};if(!1===e||i&&!1===i(t))return;const r={};wt(r,_v.defaultAttributes,t.attribute.poptip?t.attribute.poptip:{}),this.poptipComponent?this.poptipComponent.initAttributes(r):this.poptipComponent=new _v(r);let o=t.attribute.poptip||{};if("text"===t.type&&null==o.title&&null==o.content){const e={};wt(e,wv.poptip,o),o=e,o.content=null!==(g=o.content)&&void 0!==g?g:t.attribute.text}const n=t.globalTransMatrix;this.poptipComponent.setAttributes(Object.assign(Object.assign({visibleAll:!0,pickable:!1,childrenPickable:!1},o),{x:n.e,y:n.f})),h.stage.tryInitInteractiveLayer();const s=h.stage.getLayer("_builtin_interactive");s&&s.add(this.poptipComponent)}else 2===t._showPoptip&&(t._showPoptip=0,this.poptipComponent&&this.poptipComponent.setAttributes({visibleAll:!1}))}};Av=Sv([f()],Av);var Rv=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let Bv=class{constructor(){this.name="poptip",this.activeEvent="onRegister",this._uid=e.GenAutoIncrementId(),this.key=this.name+this._uid,this.poptip=t=>{const e=t.target;if(e.isContainer||!e.attribute)return void this.unpoptip(t);if(e===this.activeGraphic)return;const{poptip:i}=e.attribute;i&&(e.setAttributes({}),e._showPoptip=1),this.activeGraphic&&(this.activeGraphic.setAttributes({}),this.activeGraphic._showPoptip=2),this.setActiveGraphic(e,!0)},this.unpoptip=t=>{this.activeGraphic&&(this.activeGraphic.setAttributes({}),this.activeGraphic._showPoptip=2,this.setActiveGraphic(null,!0))}}activate(t){this.pluginService=t;const{stage:e}=this.pluginService;e.addEventListener("pointerover",this.poptip)}setActiveGraphic(t,e){this.activeGraphic=t,this.pluginService.stage.renderNextFrame()}deactivate(t){const{stage:e}=this.pluginService;e.removeEventListener("pointerover",this.poptip)}};Bv=Rv([f()],Bv);let Mv=class{constructor(){this.name="poptipForText",this.activeEvent="onRegister",this._uid=e.GenAutoIncrementId(),this.key=this.name+this._uid,this.pointerlave=t=>{const{stage:e}=this.pluginService;t.target===e&&this.unpoptip(t)},this.poptip=t=>{const e=t.target;if("text"!==e.type||!e.cliped||e.isContainer||!e.attribute||e.attribute.disableAutoClipedPoptip)return void this.unpoptip(t);if(e===this.activeGraphic)return;const{poptip:i={}}=e.attribute;i&&(e.setAttributes({}),e._showPoptip=1),this.activeGraphic&&(this.activeGraphic.setAttributes({}),this.activeGraphic._showPoptip=2),this.setActiveGraphic(e,!0)},this.unpoptip=t=>{this.activeGraphic&&(this.activeGraphic.setAttributes({}),this.activeGraphic._showPoptip=2,this.setActiveGraphic(null,!0))}}activate(t){this.pluginService=t;const{stage:e}=this.pluginService;e.addEventListener("pointerover",this.poptip),e.addEventListener("pointerleave",this.pointerlave)}setActiveGraphic(t,e){this.activeGraphic=t,this.pluginService.stage.renderNextFrame()}deactivate(t){const{stage:e}=this.pluginService;e.removeEventListener("pointerover",this.poptip),e.removeEventListener("pointerleave",this.pointerlave)}};Mv=Rv([f()],Mv);const Tv=new i(((t,e,i,r)=>{i(Av)||(t(Av).toSelf().inSingletonScope(),t(Us).toService(Av)),i(Bv)||(t(Bv).toSelf(),t(Fd).toService(Bv)),i(Mv)||(t(Mv).toSelf(),t(Fd).toService(Mv))}));My(),Ey(),Iy(),Xy();class Pv extends ov{getStartAngle(){return this._startAngle}getEndAngle(){return this._endAngle}getMainSegmentPoints(){return this._mainSegmentPoints}constructor(t,e){super((null==e?void 0:e.skipDefault)?t:wt({},Pv.defaultAttributes,t)),this.name="segment"}render(){this.removeAllChild(!0),this._reset();const{startSymbol:t,endSymbol:e,lineStyle:i,state:r,visible:o=!0,multiSegment:n,mainSegmentIndex:s}=this.attribute;if(!o)return;this._computeLineAngle();const a=this._renderSymbol(t,"start"),l=this._renderSymbol(e,"end");if(this.startSymbol=a,this.endSymbol=l,n){const t=[...this.attribute.points];if(nt(s))t[s]=this._clipPoints(t[s]);else{const e=this._clipPoints(Pt(t));t[0][0]=e[0],t[t.length-1][t[t.length-1].length-1]=e[e.length-1]}t.forEach(((t,e)=>{var o,n;const s=hh.line(Object.assign(Object.assign({points:t},et(i)?null!==(o=i[e])&&void 0!==o?o:i[i.length-1]:i),{fill:!1}));s.name=`${this.name}-line`,s.id=this._getNodeId("line"+e),ut(null==r?void 0:r.line)||(s.states=et(r.line)?null!==(n=r.line[e])&&void 0!==n?n:r.line[r.line.length-1]:r.line),this.add(s)}))}else{let t=hh.line;At(i)[0].cornerRadius&&(t=hh.polygon);const e=t(Object.assign(Object.assign({points:this._clipPoints(this.attribute.points)},At(i)[0]),{fill:!1,closePath:!1}));e.name=`${this.name}-line`,e.id=this._getNodeId("line"),ut(null==r?void 0:r.line)||(e.states=[].concat(r.line)[0]),this.add(e)}}_renderSymbol(t,e){const i=this._getMainSegmentPoints();if(!i.length)return;const{autoRotate:r=!0}=t;let o;if(t&&t.visible){const n=this._startAngle,s=this._endAngle,{state:a}=this.attribute,l=i[0],h=i[i.length-1],{refX:c=0,refY:d=0,refAngle:u=0,style:g,symbolType:p,size:f=12}=t;let m,b;"start"===e?(m={x:l.x+(nt(n)?c*Math.cos(n)+d*Math.cos(n-Math.PI/2):0),y:l.y+(nt(n)?c*Math.sin(n)+d*Math.sin(n-Math.PI/2):0)},b=n+Math.PI/2):(m={x:h.x+(nt(s)?c*Math.cos(s)+d*Math.cos(s-Math.PI/2):0),y:h.y+(nt(s)?c*Math.sin(s)+d*Math.sin(s-Math.PI/2):0)},b=s+Math.PI/2),o=hh.symbol(Object.assign(Object.assign(Object.assign({},m),{symbolType:p,size:f,angle:r?b+u:0,strokeBoundsBuffer:0}),g)),o.name=`${this.name}-${e}-symbol`,o.id=this._getNodeId(`${e}-symbol`),ut(null==a?void 0:a.symbol)||(o.states=a.symbol),this.add(o)}return o}_getMainSegmentPoints(){if(this._mainSegmentPoints)return this._mainSegmentPoints;const{points:t,multiSegment:e,mainSegmentIndex:i}=this.attribute;let r;return r=e?nt(i)?t[i]:Pt(t):t,this._mainSegmentPoints=r,r}_clipPoints(t){const{startSymbol:e={},endSymbol:i={}}=this.attribute;let r=t;if(e.visible){const i=e.clip?e.size||10:0;r=[{x:t[0].x-i/2*(Math.cos(this._startAngle)||0),y:t[0].y-i/2*(Math.sin(this._startAngle)||0)},...r.slice(1)]}if(i.visible){const e=i.clip?i.size||10:0,o={x:t[t.length-1].x-e/2*(Math.cos(this._endAngle)||0),y:t[t.length-1].y-e/2*(Math.sin(this._endAngle)||0)};r=[...r.slice(0,r.length-1),o]}return r}_computeLineAngle(){const t=this._getMainSegmentPoints();if(t.length<=1)return;const e=t[0],i=t[1],r=t[t.length-2],o=t[t.length-1],n=[e.x-i.x,e.y-i.y],s=Math.atan2(n[1],n[0]),a=[o.x-r.x,o.y-r.y],l=Math.atan2(a[1],a[0]);this._startAngle=s,this._endAngle=l}_reset(){this.startSymbol=null,this.endSymbol=null,this._startAngle=null,this._endAngle=null,this._mainSegmentPoints=null}}var Hv,Ev;Pv.defaultAttributes={visible:!0,lineStyle:{lineWidth:1,stroke:"#000"},startSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}},endSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}}},function(t){t.innerView="inner-view",t.axisContainer="axis-container",t.labelContainer="axis-label-container",t.tickContainer="axis-tick-container",t.tick="axis-tick",t.subTick="axis-sub-tick",t.label="axis-label",t.title="axis-title",t.gridContainer="axis-grid-container",t.grid="axis-grid",t.gridRegion="axis-grid-region",t.line="axis-line",t.background="axis-background",t.axisLabelBackground="axis-label-background"}(Hv||(Hv={})),function(t){t.selected="selected",t.selectedReverse="selected_reverse",t.hover="hover",t.hoverReverse="hover_reverse"}(Ev||(Ev={}));const kv={[Ev.selectedReverse]:{},[Ev.selected]:{},[Ev.hover]:{},[Ev.hoverReverse]:{}},Lv={title:{space:4,padding:0,textStyle:{fontSize:12,fill:"#333333",fontWeight:"normal",fillOpacity:1}},label:{visible:!0,inside:!1,space:4,padding:0,style:{fontSize:12,fill:"#333",fontWeight:"normal",fillOpacity:1}},tick:{visible:!0,inside:!1,alignWithLabel:!0,length:4,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}},subTick:{visible:!1,inside:!1,count:4,length:2,style:{lineWidth:1,stroke:"#999",strokeOpacity:1}},line:{visible:!0,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}}};class Fv extends ov{constructor(){super(...arguments),this.name="axis",this.data=[],this.tickLineItems=[],this.subTickLineItems=[],this.axisLabelLayerSize={},this.axisLabelsContainer=null,this._onHover=t=>{const e=t.target;e!==this._lastHover&&e.name&&!ut(e.states)&&(e.addState(sv.hover,!0),dv(this.axisContainer,(t=>{t!==e&&t.name&&!ut(t.states)&&t.addState(sv.hoverReverse,!0)})),this._lastHover=e)},this._onUnHover=t=>{this._lastHover&&(dv(this.axisContainer,(t=>{t.name&&!ut(t.states)&&(t.removeState(sv.hoverReverse),t.removeState(sv.hover))})),this._lastHover=null)},this._onClick=t=>{const e=t.target;if(this._lastSelect===e&&e.hasState(sv.selected))return this._lastSelect=null,void dv(this.axisContainer,(t=>{t.name&&!ut(t.states)&&(t.removeState(sv.selectedReverse),t.removeState(sv.selected))}));e.name&&!ut(e.states)&&(e.addState(sv.selected,!0),dv(this.axisContainer,(t=>{t!==e&&t.name&&!ut(t.states)&&t.addState(sv.selectedReverse,!0)})),this._lastSelect=e)}}getInnerView(){return this._innerView}getPrevInnerView(){return this._prevInnerView}getBoundsWithoutRender(t){const e=mt(this.attribute);wt(this.attribute,t);const i=hh.group({x:this.attribute.x,y:this.attribute.y});return this.add(i),this._renderInner(i),this.removeChild(i),this.attribute=e,i.AABBBounds}render(){this._prevInnerView=this._innerView&&function(t){const e={};return dv(t,(t=>{"group"!==t.type&&t.id&&(e[t.id]=t)})),e}(this._innerView),this.removeAllChild(!0),this._innerView=hh.group({x:0,y:0,pickable:!1}),this.add(this._innerView),this._renderInner(this._innerView),this._bindEvent()}_bindEvent(){if(this.attribute.disableTriggerEvent)return;const{hover:t,select:e}=this.attribute;t&&(this._innerView.addEventListener("pointermove",this._onHover),this._innerView.addEventListener("pointerout",this._onUnHover)),e&&this._innerView.addEventListener("pointerdown",this._onClick)}_renderInner(t){const{title:e,label:i,tick:r,line:o,items:n}=this.attribute,s=hh.group({x:0,y:0,zIndex:1});if(s.name=Hv.axisContainer,s.id=this._getNodeId("container"),s.setMode(this.mode),this.axisContainer=s,t.add(s),o&&o.visible&&this.renderLine(s),n&&n.length&&(this.data=this._transformItems(n[0]),r&&r.visible&&this.renderTicks(s),i&&i.visible)){const t=hh.group({x:0,y:0,pickable:!1});t.name=Hv.labelContainer,t.id=this._getNodeId("label-container"),this.axisLabelsContainer=t,s.add(t),n.forEach(((e,i)=>{const r=this.renderLabels(t,e,i),o=r.getChildren();this.beforeLabelsOverlap(o,e,r,i,n.length),this.handleLabelsOverlap(o,e,r,i,n.length),this.afterLabelsOverlap(o,e,r,i,n.length);let s=0,a=0,l="center",h="middle";o.forEach((t=>{var e;const i=t.attribute,r=null!==(e=i.angle)&&void 0!==e?e:0,o=t.AABBBounds;let n=o.width(),c=o.height();r&&(n=Math.abs(n*Math.cos(r)),c=Math.abs(c*Math.sin(r))),s=Math.max(s,n),a=Math.max(a,c),l=i.textAlign,h=i.textBaseline})),this.axisLabelLayerSize[i]={width:s,height:a,textAlign:l,textBaseline:h}}))}e&&e.visible&&this.renderTitle(s)}renderTicks(t){const e=this.getTickLineItems(),i=hh.group({x:0,y:0,pickable:!1});i.name=Hv.tickContainer,i.id=this._getNodeId("tick-container"),t.add(i),e.forEach(((t,r)=>{var o;const n=hh.line(Object.assign({},this._getTickLineAttribute("tick",t,r,e)));if(n.name=Hv.tick,n.id=this._getNodeId(t.id),ut(null===(o=this.attribute.tick)||void 0===o?void 0:o.state))n.states=av;else{const t=this.data[r],e=wt({},av,this.attribute.tick.state);Object.keys(e).forEach((i=>{$(e[i])&&(e[i]=e[i](t.rawValue,r,t,this.data))})),n.states=e}i.add(n)})),this.tickLineItems=e;const{subTick:r}=this.attribute;if(r&&r.visible){const t=this.getSubTickLineItems();t.length&&t.forEach(((t,o)=>{const n=hh.line(Object.assign({},this._getTickLineAttribute("subTick",t,o,e)));if(n.name=Hv.subTick,n.id=this._getNodeId(`${o}`),ut(r.state))n.states=av;else{const i=wt({},av,r.state);Object.keys(i).forEach((r=>{$(i[r])&&(i[r]=i[r](t.value,o,t,e))})),n.states=i}i.add(n)})),this.subTickLineItems=t}}renderLabels(t,e,i){const{dataFilter:r}=this.attribute.label;r&&$(r)&&(e=r(e,i));const o=this._transformItems(e),n=hh.group({x:0,y:0,pickable:!1});return n.name=`${Hv.labelContainer}-layer-${i}`,n.id=this._getNodeId(`label-container-layer-${i}`),t.add(n),o.forEach(((t,e)=>{var r;const s=this._getLabelAttribute(t,e,o,i);let a;if(a=pv(s)?hh.richtext(fv(s)):hh.text(s),a.name=Hv.label,a.id=this._getNodeId(`layer${i}-label-${t.id}`),ut(null===(r=this.attribute.label)||void 0===r?void 0:r.state))a.states=av;else{const r=wt({},av,this.attribute.label.state);Object.keys(r).forEach((n=>{$(r[n])&&(r[n]=r[n](t,e,o,i))})),a.states=r}n.add(a)})),n}renderTitle(t){const e=this.getTitleAttribute(),i=new yv(Object.assign({},e));i.name=Hv.title,i.id=this._getNodeId("title"),t.add(i)}getVerticalCoord(t,e,i){return function(t,e){return{x:t.x+e[0],y:t.y+e[1]}}(t,this.getVerticalVector(e,i,t))}getTextAlign(t){let e="center";return Ft(t[0],0)?Ft(t[1],0)?Object.is(t[1],-0)?e="start":Object.is(t[0],-0)&&(e="end"):e="center":t[0]>0?e="start":t[0]<0&&(e="end"),e}getTickLineItems(){const{tick:t}=this.attribute,e=this.data,i=[],{alignWithLabel:r,inside:o=!1,length:n,dataFilter:s}=t;let a=1;return e.length>=2&&(a=e[1].value-e[0].value),(s&&$(s)?s(e):e).forEach((t=>{let e=t.point,s=t.value;if(!r){const i=t.value-a/2;if(this.isInValidValue(i))return;e=this.getTickCoord(i),s=i}const l=this.getVerticalCoord(e,n,o);if("3d"===this.mode){const r=this.getVerticalVector(n,o,e);let a=0,h=0;Zt(r[0])>Zt(r[1])?a=$t/2*(l.x>e.x?1:-1):h=$t/2*(l.y>e.y?-1:1),i.push({start:e,end:l,value:s,id:`tick-${t.id}`,anchor:[e.x,e.y],alpha:a,beta:h})}else i.push({start:e,end:l,value:s,id:`tick-${t.id}`})})),i}getSubTickLineItems(){const{subTick:t}=this.attribute,e=[],{count:i=4,inside:r=!1,length:o=2}=t,n=this.tickLineItems,s=n.length;if(s>=2)for(let t=0;t<s-1;t++){const s=n[t],a=n[t+1];for(let t=0;t<i;t++){const n=(t+1)/(i+1),l=(1-n)*s.value+n*a.value,h=this.getTickCoord(l),c=this.getVerticalCoord(h,o,r);e.push({start:h,end:c,value:l,id:`sub-tick-${l}`})}}return e}_getTickLineAttribute(t,e,i,r){let o=gt(this.attribute,`${t}.style`);const n=this.data[i];o=$(o)?wt({},gt(Lv,`${t}.style`),"tick"===t?o(n.rawValue,i,n,this.data):o(e.value,i,e,r)):o;const{start:s,end:a,anchor:l,alpha:h,beta:c}=e;return Object.assign({points:[s,a],anchor:l,alpha:h,beta:c},o)}_getLabelAttribute(t,e,i,r){var o,n;const{space:s=4,inside:a=!1,formatMethod:l,type:h="text",text:c}=this.attribute.label;let d=s,u=0;(null===(o=this.attribute.tick)||void 0===o?void 0:o.visible)&&this.attribute.tick.inside===a&&(u=this.attribute.tick.length||4),(null===(n=this.attribute.subTick)||void 0===n?void 0:n.visible)&&this.attribute.subTick.inside===a&&(u=Math.max(u,this.attribute.subTick.length||2)),d+=u;const g=this.getRelativeVector(t.point);r>0&&(0===g[1]?d+=(this.axisLabelLayerSize[r-1].height+gt(this.attribute,"label.space",4))*r:d+=(this.axisLabelLayerSize[r-1].width+gt(this.attribute,"label.space",4))*r);const p=this.getVerticalCoord(t.point,d,a),f=this.getVerticalVector(d||1,a,p),m=l?l(`${t.label}`,t,e,i,r):t.label;let{style:b}=this.attribute.label;b=$(b)?wt({},Lv.label.style,b(t,e,i,r)):b;return b=wt(this.getLabelAlign(f,a,b.angle),b),$(b.text)&&(b.text=b.text({label:t.label,value:t.rawValue,index:t.index,layer:r})),Object.assign(Object.assign(Object.assign({},this.getLabelPosition(p,f,m,b)),{text:null!=c?c:m,lineHeight:null==b?void 0:b.fontSize,type:h}),b)}getLabelPosition(t,e,i,r){return t}_transformItems(t){const e=[];return t.forEach((t=>{var i;e.push(Object.assign(Object.assign({},t),{point:this.getTickCoord(t.value),id:null!==(i=t.id)&&void 0!==i?i:t.label}))})),e}release(){super.release(),this._prevInnerView=null,this._innerView=null}}function Iv(t){t.forEach((t=>{if(t.rotatedBounds||!t.attribute.angle)return;const e=function(t){const e=t.AABBBounds;return{x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2,centerX:t.attribute.x,centerY:t.attribute.y,angle:t.attribute.angle}}(t),i=(n=e.centerX,s=e.centerY,a=e.angle,l=t.attribute.x,h=t.attribute.y,{x:(n-l)*Math.cos(a)+(s-h)*Math.sin(a)+l,y:(n-l)*Math.sin(a)+(h-s)*Math.cos(a)+h}),r=i.x-e.centerX,o=i.y-e.centerY;var n,s,a,l,h;e.x1+=r,e.x2+=r,e.y1+=o,e.y2+=o,e.centerX+=r,e.centerY+=o,t.rotatedBounds=e}))}function zv(t,e){return De(t.AABBBounds,e.AABBBounds,!1)&&(!t.rotatedBounds||!e.rotatedBounds||function(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;const o=Ve(t,i),n=Ve(e,i),s=(t,e)=>[e.x-t.x,e.y-t.y];r&&(r.save(),r.fillStyle="red",r.globalAlpha=.6,o.forEach(((t,e)=>{0===e?r.moveTo(t.x,t.y):r.lineTo(t.x,t.y)})),r.fill(),r.restore(),r.save(),r.fillStyle="green",r.globalAlpha=.6,n.forEach(((t,e)=>{0===e?r.moveTo(t.x,t.y):r.lineTo(t.x,t.y)})),r.fill(),r.restore());const a=je(t),l=je(e);r&&r.fillRect(a.x,a.y,2,2),r&&r.fillRect(l.x,l.y,2,2);const h=s(a,l),c=s(o[0],o[1]),d=s(o[1],o[2]),u=s(n[0],n[1]),g=s(n[1],n[2]),p=i?t.angle:Ge(t.angle);let f=i?t.angle+Xt:Ge(90-t.angle);const m=i?e.angle:Ge(e.angle);let b=i?e.angle+Xt:Ge(90-e.angle);f>qt&&(f-=qt),b>qt&&(b-=qt);const y=(t,e,i,r)=>{const o=[Math.cos(e),Math.sin(e)];return t+(We(o,i)+We(o,r))/2>We(o,h)};return y((t.x2-t.x1)/2,p,u,g)&&y((t.y2-t.y1)/2,f,u,g)&&y((e.x2-e.x1)/2,m,c,d)&&y((e.y2-e.y1)/2,b,c,d)}(t.rotatedBounds,e.rotatedBounds,!0))}const Ov={parity:function(t){return t.filter(((t,e)=>e%2?t.setAttribute("opacity",0):1))},greedy:function(t,e){let i;return t.filter(((t,r)=>r&&Dv(i,t,e)?t.setAttribute("opacity",0):(i=t,1)))}};function Dv(t,e,i){const r=t.AABBBounds,o=e.AABBBounds;return i>Math.max(o.x1-r.x2,r.x1-o.x2,o.y1-r.y2,r.y1-o.y2)&&(!t.rotatedBounds||!e.rotatedBounds||i>Math.max(e.rotatedBounds.x1-t.rotatedBounds.x2,t.rotatedBounds.x1-e.rotatedBounds.x2,e.rotatedBounds.y1-t.rotatedBounds.y2,t.rotatedBounds.y1-e.rotatedBounds.y2))}function Wv(t,e){for(let i,r=1,o=t.length,n=t[0];r<o;n=i,++r)if(Dv(n,i=t[r],e))return!0}function Nv(t){const e=t.AABBBounds;return e.width()>1&&e.height()>1}function Gv(t){for(let e=1;e<t.length;e++)if(zv(t[e-1],t[e]))return!0;return!1}function jv(t,e){"bottom"!==t&&"top"!==t||function(t,e){e.forEach((e=>{e.attribute.angle&&e.setAttributes(Object.assign(Object.assign({},Uv(t,e.attribute.angle)),{angle:Vv(e.attribute.angle)}))}))}(t,e),"left"!==t&&"right"!==t||function(t,e){e.forEach(((e,i)=>{e.attribute.angle&&e.setAttributes(Object.assign(Object.assign({},Kv(t,e.attribute.angle)),{angle:Vv(e.attribute.angle)}))}))}(t,e),Iv(e)}function Vv(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(t<0)for(;t<0;)t+=2*Math.PI;if(t>0)for(;t>=2*Math.PI;)t-=2*Math.PI;return t}function Uv(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=["center","left","left","left","center","right","right","right","left"],r=["top","top","middle","bottom","bottom","bottom","middle","top","top"];"top"===t&&(i=["center","right","right","right","center","left","left","left","right"],r=["bottom","bottom","middle","top","top","top","middle","bottom","bottom"]);const o=(e=Vv(e))/(.5*Math.PI);let n;return n=o===Math.floor(o)?2*Math.floor(o):2*Math.floor(o)+1,{textAlign:i[n],textBaseline:r[n]}}function Kv(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=["right","right","center","left","center","left","center","right","right"],r=["middle","middle","top","top","middle","middle","bottom","bottom","middle"];"right"===t&&(i=["left","right","right","right","left","left","left","left","right"],r=["middle","bottom","middle","top","top","top","middle","bottom","bottom"]);const o=(e=Vv(e))/(.5*Math.PI);let n;return n=o===Math.floor(o)?2*Math.floor(o):2*Math.floor(o)+1,{textAlign:i[n],textBaseline:r[n]}}var $v=function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(i[r[o]]=t[r[o]])}return i};My(),Ey(),Vy(),qy(),Wy();class Xv extends Fv{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:wt({},Xv.defaultAttributes,t),e)}_renderInner(t){var e;super._renderInner(t);const{panel:i}=this.attribute;if(i&&i.visible){const t=this.axisContainer,r=t.AABBBounds,o=hh.rect(Object.assign({x:r.x1,y:r.y1,width:r.width(),height:r.height()},i.style));o.name=Hv.background,o.id=this._getNodeId("background"),o.states=wt({},kv,null!==(e=i.state)&&void 0!==e?e:{}),t.insertBefore(o,t.firstChild)}}renderLine(t){const{start:e,end:i,line:r}=this.attribute,o=r,{startSymbol:n,endSymbol:s,style:a,breakRange:l,breakShape:h,breakShapeStyle:c,state:d}=o,u=$v(o,["startSymbol","endSymbol","style","breakRange","breakShape","breakShapeStyle","state"]),g=Object.assign({points:[e,i],startSymbol:n,endSymbol:s,lineStyle:a},u);ut(d)||(g.state={line:wt({},kv,d),symbol:wt({},kv,d)});const p=new Pv(g);p.name=Hv.line,p.id=this._getNodeId("line"),t.add(p)}getTitleAttribute(){var t,e,i;const r=this.attribute.title,{position:o="middle",space:n=4,textStyle:s={},autoRotate:a=!0,shape:l,background:h,state:c={},maxWidth:d}=r,u=$v(r,["position","space","textStyle","autoRotate","shape","background","state","maxWidth"]);let g=.5;"start"===o?g=0:"end"===o&&(g=1);const{verticalFactor:p=1}=this.attribute,f=-1*p,m=this.getTickCoord(g),b=this.getRelativeVector();let y=0;if((null===(t=this.attribute.label)||void 0===t?void 0:t.visible)&&!1===this.attribute.label.inside){const t=+gt(this.attribute,"label.space",4);y+=t;const e=Object.keys(this.axisLabelLayerSize).length;if(0===b[1]){const i=this.axisLabelsContainer?this.axisLabelsContainer.AABBBounds.height():0;isFinite(i)?y+=i+(e-1)*t:y=0}else{if(0===b[0]){const i=this.axisLabelsContainer?this.axisLabelsContainer.AABBBounds.width():0;isFinite(i)?y+=i+(e-1)*t:y=0}else Object.keys(this.axisLabelLayerSize).forEach(((e,i)=>{y+=this.axisLabelLayerSize[e].width+(i>0?t:0)}));const i=this.axisLabelLayerSize[0].textAlign,r="start"===i||"left"===i,o="center"===i,n=b[1]>0;y=1===f?n?r?y:o?y/2:t:r?t:o?y/2:y:n?r?t:o?y/2:y:r?y:o?y/2:t}}let C=0;(null===(e=this.attribute.tick)||void 0===e?void 0:e.visible)&&!1===this.attribute.tick.inside&&(C=this.attribute.tick.length||4),(null===(i=this.attribute.subTick)||void 0===i?void 0:i.visible)&&!1===this.attribute.subTick.inside&&(C=Math.max(C,this.attribute.subTick.length||2));const w=C+y+n,v=this.getVerticalCoord(m,w,!1),x=this.getVerticalVector(w,!1,{x:0,y:0});let _,S,{angle:A}=u;if(_="start"===o?"start":"end"===o?"end":"center",X(A)&&a){A=uv(b,[1,0],!0);const{verticalFactor:t=1}=this.attribute;S=1==-1*t?"bottom":"top"}else _=this.getTextAlign(x),S=this.getTextBaseline(x,!1);let R=d;if(X(R)){const{verticalLimitSize:t,verticalMinSize:e,orient:i}=this.attribute,r=Math.min(t||1/0,e||1/0);if(nt(r))if("bottom"===i||"top"===i)if(A!==Math.PI/2){const t=Math.abs(Math.cos(null!=A?A:0));R=t<1e-6?1/0:this.attribute.end.x/t}else R=r-w;else if(A&&0!==A){const t=Math.abs(Math.sin(A));R=t<1e-6?1/0:this.attribute.end.y/t}else R=r-w}const B=Object.assign(Object.assign(Object.assign({},v),u),{maxWidth:R,textStyle:Object.assign({textAlign:_,textBaseline:S},s),state:{text:wt({},kv,c.text),shape:wt({},kv,c.shape),panel:wt({},kv,c.background)}});return B.angle=A,l&&l.visible&&(B.shape=Object.assign({visible:!0},l.style),l.space&&(B.space=l.space)),h&&h.visible&&(B.panel=Object.assign({visible:!0},h.style)),B}getTextBaseline(t,e){let i="middle";const{verticalFactor:r=1}=this.attribute,o=(e?1:-1)*r;return Ft(t[1],0)?i=!Ft(t[0],0)||Object.is(t[0],-0)||Object.is(t[1],-0)?"middle":1===o?"bottom":"top":t[1]>0?i="top":t[1]<0&&(i="bottom"),i}getLabelAlign(t,e,i){const r=this.attribute.orient;if(["top","bottom","right","left"].includes(r)||0===t[0]&&0===t[1]){if("top"===r||"bottom"===r)return Uv(e?"bottom"===r?"top":"bottom":r,i);if("left"===r||"right"===r)return Kv(e?"left"===r?"right":"left":r,i)}return{textAlign:this.getTextAlign(t),textBaseline:this.getTextBaseline(t,e)}}beforeLabelsOverlap(t,e,i,r,o){var n,s,a,l;const{flush:h=!1}=this.attribute.label||{};if(h&&t.length){const{orient:e,start:i,end:r}=this.attribute,o="bottom"===e||"top"===e,h=t[0],c=Rt(t),d=o?h.attribute.x>c.attribute.x:h.attribute.y<c.attribute.y;if(o){const t=d?c:h,e=d?h:c,o=i.x,a=r.x,l=t.AABBBounds.x1,u=e.AABBBounds.x2;l<o&&(t.attribute.angle?t.setAttributes({dx:(null!==(n=t.attribute.dx)&&void 0!==n?n:0)+o-l}):t.setAttributes({x:o,textAlign:"left"})),u>a&&(e.attribute.angle?e.setAttributes({dx:(null!==(s=e.attribute.dx)&&void 0!==s?s:0)+a-u}):e.setAttributes({x:a,textAlign:"right"}))}else{const t=d?c:h,e=d?h:c,o=t.AABBBounds.y2,n=e.AABBBounds.y1,s=i.y,u=r.y;n<s&&(e.attribute.angle?e.setAttributes({dy:(null!==(a=e.attribute.dy)&&void 0!==a?a:0)+s-n}):e.setAttributes({y:s,textBaseline:"top"})),o>u&&(t.attribute.angle?t.setAttributes({dy:(null!==(l=t.attribute.dy)&&void 0!==l?l:0)+u-o}):t.setAttributes({y:u,textBaseline:"bottom"}))}}}handleLabelsOverlap(t,e,i,r,o){if(ut(t))return;const{verticalLimitSize:n,label:s,orient:a}=this.attribute,l=this._getAxisLabelLimitLength(n,o),{layoutFunc:h,autoRotate:c,autoRotateAngle:d,autoLimit:u,limitEllipsis:g,autoHide:p,autoHideMethod:f,autoHideSeparation:m,lastVisible:b}=s;if($(h))h(t,e,r,this);else{if(c&&function(t,e){if(ut(t))return;const{orient:i,labelRotateAngle:r=[0,45,90]}=e;if(0===r.length||t.some((t=>!!t.attribute.angle)))return;let o=0,n=0;for(r&&r.length>0&&(n=r.length);o<n;){const e=r[o++];if(t.forEach((t=>{t.attribute.angle=ge(e)})),jv(i,t),!Gv(t))break}}(t,{labelRotateAngle:d,orient:a}),u&&nt(l)&&l>0){const e="left"===a||"right"===a,i=e?Math.abs(this.attribute.start.y-this.attribute.end.y):Math.abs(this.attribute.start.x-this.attribute.end.x);!function(t,e){const{limitLength:i,verticalLimitLength:r,ellipsis:o="...",orient:n,axisLength:s}=e;if(ut(t)||!nt(i))return;const a=Math.sin(Math.PI/10);t.forEach((t=>{var e;const l=t.attribute.angle,h=!X(l),c=h?Math.cos(l):1,d=h?Math.sin(l):0,u=!h||Math.abs(d)<=a,g=h&&Math.abs(c)<=a,p="top"===n||"bottom"===n;if(p){if(g&&Math.floor(t.AABBBounds.height())<=i)return;if(u&&Math.floor(t.AABBBounds.width())<=r)return}const f=t.attribute.direction;if(!p){if("vertical"===f&&Math.floor(t.AABBBounds.height())<=r)return;if("vertical"!==f){if(u&&Math.floor(t.AABBBounds.width())<=i)return;if(g&&Math.floor(t.AABBBounds.height())<=r)return}}let m=null;if(u||g)m=p?u?r:i:"vertical"===f||g?r:i;else if(p){const{x1:e,x2:r}=t.AABBBounds,o=d/c;m=o>0&&e<=s&&i/o+e>s?(s-e)/Math.abs(c):o<0&&r>=0&&i/o+r<0?r/Math.abs(c):Math.abs(i/d)}else m=Math.abs(i/c);nt(t.attribute.maxLineWidth)&&(m=nt(m)?Math.min(t.attribute.maxLineWidth,m):t.attribute.maxLineWidth),t.setAttributes({maxLineWidth:m,ellipsis:null!==(e=t.attribute.ellipsis)&&void 0!==e?e:o})}))}(t,{limitLength:l,verticalLimitLength:e?i/t.length:p||c?1/0:i/t.length,ellipsis:g,orient:a,axisLength:i})}p&&function(t,e){if(ut(t))return;const i=t.filter(Nv);if(ut(i))return;let r;r=function(t){return t.forEach((t=>t.setAttribute("opacity",1))),t}(i),Iv(r);const{method:o="parity",separation:n=0}=e,s=$(o)?o:Ov[o]||Ov.parity;if(r.length>=3&&Wv(r,n)){do{r=s(r,n)}while(r.length>=3&&Wv(r,n));if(r.length<3||e.lastVisible){const t=Rt(i);if(!t.attribute.opacity){const e=r.length;if(e>1){t.setAttribute("opacity",1);for(let i=e-1;i>=0&&Dv(r[i],t,n);i--)r[i].setAttribute("opacity",0)}}}}i.forEach((t=>{t.setAttribute("visible",!!t.attribute.opacity)}))}(t,{orient:a,method:f,separation:m,lastVisible:b})}}afterLabelsOverlap(t,e,i,r,o){const{verticalLimitSize:n,orient:s}=this.attribute,a="bottom"===s||"top"===s,l=i.AABBBounds;let h=a?l.height():l.width();const{verticalMinSize:c}=this.attribute;if(nt(c)&&(!nt(n)||c<=n)){const t=this._getAxisLabelLimitLength(c,o);let e,r;h=Math.max(h,t),"left"===s?(e=l.x2-h,r=l.y1):"right"===s?(e=l.x1,r=l.y1):"top"===s?(e=l.x1,r=l.y2-h):"bottom"===s&&(e=l.x1,r=l.y1);const n=hh.rect({x:e,y:r,width:a?l.width():h,height:a?h:l.height(),pickable:!1});n.name=Hv.axisLabelBackground,n.id=this._getNodeId("axis-label-background"),i.insertBefore(n,i.firstChild)}if(Y(this.attribute.label.containerAlign)){let e;"left"===s?e=l.x2:"right"===s?e=l.x1:"top"===s?e=l.y2:"bottom"===s&&(e=l.y1),function(t,e,i,r,o){if("right"===r||"left"===r){if("left"===o){const o="right"===r?0:-1;t.forEach((t=>{t.setAttributes({x:e+i*o,textAlign:"left"})}))}else if("right"===o){const o="right"===r?1:0;t.forEach((t=>{t.setAttributes({x:e+i*o,textAlign:"right"})}))}else if("center"===o){const o="right"===r?1:-1;t.forEach((t=>{t.setAttributes({x:e+.5*i*o,textAlign:"center"})}))}}else if("bottom"===r||"top"===r)if("top"===o){const o="bottom"===r?0:-1;t.forEach((t=>{t.setAttributes({y:e+i*o,textBaseline:"top"})}))}else if("bottom"===o){const o="bottom"===r?1:0;t.forEach((t=>{t.setAttributes({y:e+i*o,textBaseline:"bottom"})}))}else if("middle"===o){const o="bottom"===r?1:-1;t.forEach((t=>{t.setAttributes({y:e+.5*i*o,textBaseline:"middle"})}))}}(t,e,h,s,this.attribute.label.containerAlign)}}_getAxisLabelLimitLength(t,e){var i,r,o,n,s;const{label:a,title:l,line:h,tick:c}=this.attribute,d=null!==(i=a.space)&&void 0!==i?i:4;let u=t,g=0,p=0;const f=h&&h.visible?null!==(r=h.style.lineWidth)&&void 0!==r?r:1:0,m=c&&c.visible?null!==(o=c.length)&&void 0!==o?o:4:0;if(l&&l.visible&&"string"==typeof l.text){g=gv(l.text,l.textStyle,null===(s=null===(n=this.stage)||void 0===n?void 0:n.getTheme())||void 0===s?void 0:s.text).height;const t=Ze(l.padding);p=l.space+t[0]+t[2]}return u&&(u=(u-d-p-g-f-m)/e),u}}function Yv(){My(),Xy(),qy()}Xv.defaultAttributes=Lv,function(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t="prototype"in t?t.prototype:t,e="prototype"in e?e.prototype:e,Object.getOwnPropertyNames){const r=Object.getOwnPropertyNames(e);for(let o=0;o<r.length;o++){const n=r[o];"constructor"!==n&&(i?null!=e[n]:null==t[n])&&(t[n]=e[n])}}else St(t,e,i)}(Xv,class{isInValidValue(t){return t<0||t>1}getTickCoord(t){const{start:e}=this.attribute,i=this.getRelativeVector();return{x:e.x+i[0]*t,y:e.y+i[1]*t}}getRelativeVector(t){const{start:e,end:i}=this.attribute;return[i.x-e.x,i.y-e.y]}getVerticalVector(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{verticalFactor:i=1}=this.attribute,r=function(t){const[e,i]=t;let r=e*e+i*i;return r>0&&(r=1/Math.sqrt(r)),[t[0]*r,t[1]*r]}(this.getRelativeVector());return function(t,e){return[t[0]*e,t[1]*e]}([r[1],-1*r[0]],t*(e?1:-1)*i)}});const qv={space:8,style:{fill:"rgb(47, 69, 84)",cursor:"pointer",size:15},state:{disable:{fill:"rgb(170, 170, 170)",cursor:"not-allowed"},hover:{}}};Yv();class Zv extends ov{getCurrent(){return this._current}constructor(t,e){super((null==e?void 0:e.skipDefault)?t:wt({},Zv.defaultAttributes,t)),this.name="pager",this._current=1,this._onHover=t=>{const e=t.target;e.hasState("disable")||e.addState("hover")},this._onUnHover=t=>{t.target.removeState("hover")},this._onClick=t=>{const e=t.target;if("preHandler"===e.name){if(1===this._current)return;this._current-=1,1===this._current?e.addState("disable"):e.removeState("disable"),this._dispatchEvent("toPrev",{current:this._current,total:this._total,direction:"pre",event:t})}if("nextHandler"===e.name){if(this._current===this._total)return;this._current+=1,this._current===this._total?e.addState("disable"):e.removeState("disable"),this._dispatchEvent("toNext",{current:this._current,total:this._total,direction:"next",event:t})}this._current>1&&this.preHandler.removeState("disable"),this._current<this._total&&this.nextHandler.removeState("disable"),this.text.setAttribute("text",this._getPageText(this._current))}}render(){var t,e,i;this._reset();const{layout:r="horizontal",handler:o=qv,total:n,defaultCurrent:s=1,textStyle:a,padding:l=0}=this.attribute;this._current=s;const h=Ze(l),c="horizontal"===r,d=hh.group({x:0,y:0}),u=o.style||{},g=u.size||15,p=null!==(t=o.space)&&void 0!==t?t:8,f=o.state||{};let{preShape:m,nextShape:b}=o;m||(m=c?"triangleLeft":"triangleUp"),b||(b=c?"triangleRight":"triangleDown");const y=hh.symbol(Object.assign(Object.assign({strokeBoundsBuffer:0,pickMode:"imprecise"},u),{x:0,y:0,symbolType:m,size:g}));y.states=f,y.name="preHandler",this.preHandler=y,d.add(y);const{width:C,height:w}=gv(this._getPageText(n),Object.assign({textAlign:"center",textBaseline:"middle"},a),null===(i=null===(e=this.stage)||void 0===e?void 0:e.getTheme())||void 0===i?void 0:i.text),v=ot(g)?g:g[0],x=ot(g)?g:g[1],_=hh.text(Object.assign({x:c?v/2+p+C/2:0,y:c?0:x/2+p+w/2,text:this._getPageText(s),textAlign:"center",textBaseline:"middle",lineHeight:null==a?void 0:a.fontSize},a));this.text=_,d.add(_);const S=hh.symbol(Object.assign(Object.assign({strokeBoundsBuffer:0,pickMode:"imprecise"},u),{x:c?v+2*p+C:0,y:c?0:x+2*p+w,symbolType:b,size:g}));S.name="nextHandler",S.states=f,this.nextHandler=S,d.add(S),1===this._total?(y.addState("disable"),S.addState("disable")):1===this._current?y.addState("disable"):this._current===n&&S.addState("disable");const A=d.AABBBounds,R=A.width(),B=A.height();d.translateTo(0-A.x1+h[3],0-A.y1+h[0]),this.add(d),this.attribute.width=R+h[1]+h[3],this.attribute.height=B+h[0]+h[2],this._bindEvents()}_bindEvents(){this.attribute.disableTriggerEvent||(this.preHandler&&(this.preHandler.addEventListener("pointerenter",this._onHover),this.preHandler.addEventListener("pointerleave",this._onUnHover),this.preHandler.addEventListener("pointerdown",this._onClick)),this.nextHandler&&(this.nextHandler.addEventListener("pointerenter",this._onHover),this.nextHandler.addEventListener("pointerleave",this._onUnHover),this.nextHandler.addEventListener("pointerdown",this._onClick)))}_reset(){this.removeAllChild(!0),this._current=1,this._total=this.attribute.total,this.preHandler=this.nextHandler=this.text=null}_getPageText(t){const{pageFormatter:e}=this.attribute;return e?$(e)?e(t,this._total):`${e}`.replace("{current}",`${t}`).replace("{total}",`${this._total}`):`${t}/${this._total}`}setTotal(t){t!==this.attribute.total&&(this._total=t,1!==this._current&&this._current<=t?this.setAttributes({total:t,defaultCurrent:this._current}):this.setAttribute("total",t))}}Zv.defaultAttributes={handler:qv,textStyle:{fill:"rgb(51, 51, 51)",fontSize:12}};const Jv=16,Qv=8,tx=12;var ex,ix,rx;!function(t){t.selected="selected",t.unSelected="unSelected",t.selectedHover="selectedHover",t.unSelectedHover="unSelectedHover",t.focus="focus"}(ex||(ex={})),function(t){t.legendItemHover="legendItemHover",t.legendItemUnHover="legendItemUnHover",t.legendItemClick="legendItemClick",t.legendItemAttributeUpdate="legendItemAttributeUpdate"}(ix||(ix={})),function(t){t.innerView="innerView",t.title="legendTitle",t.item="legendItem",t.itemShape="legendItemShape",t.itemLabel="legendItemLabel",t.itemValue="legendItemValue",t.focus="legendItemFocus"}(rx||(rx={}));class ox extends ov{constructor(){super(...arguments),this.name="legend",this._title=null}render(){this.removeAllChild(!0);const{interactive:t=!0,title:e,padding:i=0}=this.attribute,r=Ze(i),o=hh.group({x:r[3],y:r[0],pickable:t,childrenPickable:t});o.name=rx.innerView,this.add(o),this._innerView=o,(null==e?void 0:e.visible)&&this._renderTitle(e),this._renderContent(),this._adjustLayout(),t&&this._bindEvents();const n=this._innerView.AABBBounds;this.attribute.width=n.width()+r[1]+r[3],this.attribute.height=n.height()+r[0]+r[2]}_renderTitle(t){const{text:e="",textStyle:i,padding:r=0,background:o,minWidth:n,maxWidth:s,shape:a}=t,l={x:0,y:0,text:e,textStyle:i,padding:Ze(r),minWidth:n,maxWidth:s};a&&a.visible&&(l.shape=Object.assign({visible:!0},a.style),Y(a.space)&&(l.space=a.space)),o&&o.visible&&(l.panel=Object.assign({visible:!0},o.style));const h=new yv(l);h.name=rx.title,this._title=h,this._innerView.add(h)}_adjustLayout(){var t;if(this._title){const e=this._innerView.AABBBounds.width(),i=this._title.AABBBounds.width(),r=null===(t=this.attribute.title)||void 0===t?void 0:t.align;"center"===r?this._title.setAttribute("x",(e-i)/2):"end"===r&&this._title.setAttribute("x",e-i)}}}function nx(){My(),qy(),Wy(),Xy()}function sx(){My(),mv()}var ax=function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(i[r[o]]=t[r[o]])}return i};const lx={[ex.focus]:{},[ex.selected]:{},[ex.selectedHover]:{},[ex.unSelected]:{},[ex.unSelectedHover]:{}};sx(),Yv(),nv();class hx extends ox{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:wt({},hx.defaultAttributes,t)),this.name="discreteLegend",this._itemsContainer=null,this._itemHeightByUser=void 0,this._itemHeight=0,this._itemMaxWidth=0,this._onHover=t=>{const e=t.target;if(e&&e.name&&e.name.startsWith(rx.item)){const i=e.delegate;if(this._lastActiveItem){if(this._lastActiveItem.id===i.id)return;this._unHover(this._lastActiveItem,t)}this._hover(i,t)}else this._lastActiveItem&&(this._unHover(this._lastActiveItem,t),this._lastActiveItem=null)},this._onUnHover=t=>{this._lastActiveItem&&(this._unHover(this._lastActiveItem,t),this._lastActiveItem=null)},this._onClick=t=>{var e,i,r,o;const n=t.target;if(n&&n.name&&n.name.startsWith(rx.item)){const s=n.delegate;if(n.name===rx.focus){const r=s.hasState(ex.focus);s.toggleState(ex.focus),r?null===(e=this._itemsContainer)||void 0===e||e.getChildren().forEach((e=>{this._removeLegendItemState(e,[ex.unSelected,ex.unSelectedHover,ex.focus],t),this._setLegendItemState(e,ex.selected,t)})):(this._setLegendItemState(s,ex.selected,t),this._removeLegendItemState(s,[ex.unSelected,ex.unSelectedHover],t),null===(i=this._itemsContainer)||void 0===i||i.getChildren().forEach((e=>{s!==e&&(this._removeLegendItemState(e,[ex.selected,ex.selectedHover,ex.focus],t),this._setLegendItemState(e,ex.unSelected,t))})))}else{null===(r=this._itemsContainer)||void 0===r||r.getChildren().forEach((t=>{t.removeState(ex.focus)}));const{selectMode:e="multiple",allowAllCanceled:i=!0}=this.attribute,n=s.hasState(ex.selected),a=this._getSelectedLegends();if("multiple"===e){if(!1===i&&n&&1===a.length)return void this._dispatchLegendEvent(ix.legendItemClick,s,t);n?(this._removeLegendItemState(s,[ex.selected,ex.selectedHover],t),this._setLegendItemState(s,ex.unSelected,t)):(this._setLegendItemState(s,ex.selected,t),this._removeLegendItemState(s,[ex.unSelected,ex.unSelectedHover],t))}else this._setLegendItemState(s,ex.selected,t),this._removeLegendItemState(s,[ex.unSelected,ex.unSelectedHover],t),null===(o=this._itemsContainer)||void 0===o||o.getChildren().forEach((e=>{s!==e&&(this._removeLegendItemState(e,[ex.selected,ex.selectedHover],t),this._setLegendItemState(e,ex.unSelected,t))}))}this._dispatchLegendEvent(ix.legendItemClick,s,t)}}}setSelected(t){var e;(null===(e=this._itemsContainer)||void 0===e?void 0:e.getChildren()).forEach((e=>{const i=e.data;t.includes(i.label)?(this._setLegendItemState(e,ex.selected),this._removeLegendItemState(e,[ex.unSelected,ex.unSelectedHover])):(this._removeLegendItemState(e,[ex.selected,ex.selectedHover]),this._setLegendItemState(e,ex.unSelected))}))}_renderItems(){const{item:t={},maxCol:e=1,maxRow:i=2,maxWidth:r,maxHeight:o,defaultSelected:n,lazyload:s,autoPage:a}=this.attribute,{spaceCol:l=Jv,spaceRow:h=Qv}=t,c=this._itemsContainer,{items:d,isHorizontal:u,startIndex:g,isScrollbar:p}=this._itemContext,f=p?1:u?i:e;let m,{doWrap:b,maxWidthInCol:y,startX:C,startY:w,pages:v}=this._itemContext;for(let t=g,e=d.length;t<e&&!(s&&v>this._itemContext.currentPage*f);t++){s&&(this._itemContext.startIndex=t+1),m=d[t],m.id||(m.id=m.label),m.index=t;let e=!0;et(n)&&(e=n.includes(m.label));const i=this._renderEachItem(m,e,t,d),g=i.attribute.width,f=i.attribute.height;this._itemHeight=Math.max(this._itemHeight,f),y=Math.max(g,y),this._itemMaxWidth=Math.max(g,this._itemMaxWidth),u?(Y(r)&&(p&&a?(v=Math.ceil((C+g)/r),b=v>1):C+g>r&&(b=!0,C>0&&(v+=1,C=0,w+=f+h))),0===C&&0===w||i.setAttributes({x:C,y:w}),C+=l+g):(Y(o)&&(p&&a?(v=Math.ceil((w+f)/o),b=v>1):o<w+f&&(v+=1,b=!0,w=0,C+=y+l,y=0)),0===C&&0===w||i.setAttributes({x:C,y:w}),w+=h+f),c.add(i)}return this._itemContext.doWrap=b,this._itemContext.startX=C,this._itemContext.startY=w,this._itemContext.maxWidthInCol=y,this._itemContext.pages=v,this._itemContext.maxPages=f,p&&(this._itemContext.totalPage=v),s||(this._itemContext.startIndex=d.length),this._itemContext}_renderContent(){const{item:t={},items:e,reversed:i,maxWidth:r}=this.attribute;if(!1===t.visible||ut(e))return;let o=e;i&&(o=null==e?void 0:e.reverse());const n=hh.group({x:0,y:0});this._itemsContainer=n;const{layout:s,autoPage:a}=this.attribute,l="horizontal"===s,{maxWidth:h,width:c,height:d}=t,u=[];Y(h)&&u.push(h),Y(c)&&u.push(c),u.length&&(Y(r)&&u.push(r),this._itemWidthByUser=Mt(u)),Y(d)&&(this._itemHeightByUser=d);const g=this.attribute.pager;this._itemContext={currentPage:g&&g.defaultCurrent||1,doWrap:!1,maxWidthInCol:0,maxPages:1,pages:1,startX:0,startY:0,startIndex:0,items:o,isHorizontal:l,totalPage:1/0,isScrollbar:g&&"scrollbar"===g.type},this._itemContext=this._renderItems();let p=!1;this._itemContext.doWrap&&a&&this._itemContext.pages>this._itemContext.maxPages&&(p=this._renderPagerComponent()),p||(n.setAttribute("y",this._title?this._title.AABBBounds.height()+gt(this.attribute,"title.space",8):0),this._innerView.add(n))}_bindEvents(){if(this.attribute.disableTriggerEvent)return;if(!this._itemsContainer)return;const{hover:t=!0,select:e=!0}=this.attribute;t&&(this._itemsContainer.addEventListener("pointermove",this._onHover),this._itemsContainer.addEventListener("pointerleave",this._onUnHover)),e&&this._itemsContainer.addEventListener("pointerdown",this._onClick)}_autoEllipsis(t,e,i,r){var o,n;const{label:s,value:a}=this.attribute.item,l=r.AABBBounds,h=i.AABBBounds,c=l.width(),d=h.width();let u=!1;"labelFirst"===t?d>e?u=!0:r.setAttribute("maxLineWidth",e-d):"valueFirst"===t?c>e?u=!0:i.setAttribute("maxLineWidth",e-c):c+d>e&&(u=!0),u&&(r.setAttribute("maxLineWidth",Math.max(e*(null!==(o=s.widthRatio)&&void 0!==o?o:.5),e-d)),i.setAttribute("maxLineWidth",Math.max(e*(null!==(n=a.widthRatio)&&void 0!==n?n:.5),e-c)))}_renderEachItem(t,e,i,r){var o,n;const{id:s,label:a,value:l,shape:h}=t,{padding:c=0,focus:d,focusIconStyle:u,align:g,autoEllipsisStrategy:p}=this.attribute.item,{shape:f,label:m,value:b,background:y}=this.attribute.item,C=this._handleStyle(f,t,e,i,r),w=this._handleStyle(m,t,e,i,r),v=this._handleStyle(b,t,e,i,r),x=this._handleStyle(y,t,e,i,r),_=Ze(c);let S;!1===y.visible?(S=hh.group({x:0,y:0,cursor:null===(o=x.style)||void 0===o?void 0:o.cursor}),this._appendDataToShape(S,rx.item,t,S)):(S=hh.group(Object.assign({x:0,y:0},x.style)),this._appendDataToShape(S,rx.item,t,S,x.state)),S.id=`${null!=s?s:a}-${i}`,S.addState(e?ex.selected:ex.unSelected);const A=hh.group({x:0,y:0,pickable:!1});S.add(A);let R,B=0,M=0,T=0;if(f&&!1!==f.visible){const i=gt(C,"style.size",10);M=et(i)?i[0]||0:i,T=gt(f,"space",8);const r=hh.symbol(Object.assign(Object.assign({x:0,y:0,symbolType:"circle",strokeBoundsBuffer:0},h),C.style));Object.keys(C.state||{}).forEach((t=>{const e=C.state[t].fill||C.state[t].stroke;h.fill&&X(C.state[t].fill)&&e&&(C.state[t].fill=e),h.stroke&&X(C.state[t].stroke)&&e&&(C.state[t].stroke=e)})),this._appendDataToShape(r,rx.itemShape,t,S,C.state),r.addState(e?ex.selected:ex.unSelected),A.add(r)}let P,H=0;if(d){const e=gt(u,"size",10);R=hh.symbol(Object.assign(Object.assign({x:0,y:-e/2-1,strokeBoundsBuffer:0},u),{visible:!0,pickMode:"imprecise",boundsPadding:_})),this._appendDataToShape(R,rx.focus,t,S),H=e}const E=m.formatMethod?m.formatMethod(a,t,i):a,k=Object.assign(Object.assign({x:M/2+T,y:0,textAlign:"start",textBaseline:"middle",lineHeight:null===(n=w.style)||void 0===n?void 0:n.fontSize},w.style),{text:E});P=pv(k)?hh.richtext(fv(k)):hh.text(k),this._appendDataToShape(P,rx.itemLabel,t,S,w.state),P.addState(e?ex.selected:ex.unSelected),A.add(P);const L=gt(m,"space",8);if(Y(l)){const r=gt(b,"space",d?8:0),o=b.formatMethod?b.formatMethod(l,t,i):l,n=Object.assign(Object.assign({x:0,y:0,textAlign:"start",textBaseline:"middle",lineHeight:v.style.fontSize},v.style),{text:o});let s;if(s=pv(n)?hh.richtext(fv(n)):hh.text(n),this._appendDataToShape(s,rx.itemValue,t,S,v.state),s.addState(e?ex.selected:ex.unSelected),this._itemWidthByUser){const t=this._itemWidthByUser-_[1]-_[3]-M-T-L-H-r;this._autoEllipsis(p,t,P,s),b.alignRight?s.setAttributes({textAlign:"right",x:this._itemWidthByUser-M/2-_[1]-_[3]-H-r}):s.setAttribute("x",r+(P.AABBBounds.empty()?0:P.AABBBounds.x2))}else s.setAttribute("x",r+(P.AABBBounds.empty()?0:P.AABBBounds.x2));B=r+(s.AABBBounds.empty()?0:s.AABBBounds.x2),A.add(s)}else this._itemWidthByUser?(P.setAttribute("maxLineWidth",this._itemWidthByUser-_[1]-_[3]-M-T-H),B=L+(P.AABBBounds.empty()?0:P.AABBBounds.x2)):B=L+(P.AABBBounds.empty()?0:P.AABBBounds.x2);R&&(R.setAttribute("x",B),A.add(R));const F=A.AABBBounds,I=F.width();if("right"===g){const t=F.x2,e=F.x1;A.forEachChildren(((i,r)=>{"symbol"!==i.type&&"right"!==i.attribute.textAlign||i===R?i.setAttribute("x",e+t-i.attribute.x-i.AABBBounds.width()):"symbol"!==i.type?i.setAttributes({x:e+t-i.attribute.x,textAlign:"left"}):i.setAttribute("x",e+t-i.attribute.x)}))}const z=F.height(),O=Y(this.attribute.item.width)?this.attribute.item.width:I+_[1]+_[3],D=this._itemHeightByUser||z+_[0]+_[2];return S.attribute.width=O,S.attribute.height=D,R&&R.setAttribute("visible",!1),A.translateTo(-F.x1+_[3],-F.y1+_[0]),S}_createPager(t){var e,i;const{disableTriggerEvent:r,maxRow:o}=this.attribute;return this._itemContext.isHorizontal?new Zv(Object.assign(Object.assign({layout:1===o?"horizontal":"vertical",total:99},wt({handler:{preShape:"triangleUp",nextShape:"triangleDown"}},t)),{defaultCurrent:null===(e=this.attribute.pager)||void 0===e?void 0:e.defaultCurrent,disableTriggerEvent:r})):new Zv(Object.assign({layout:"horizontal",total:99,disableTriggerEvent:r,defaultCurrent:null===(i=this.attribute.pager)||void 0===i?void 0:i.defaultCurrent},t))}_createScrollbar(t,e){const{disableTriggerEvent:i}=this.attribute;return this._itemContext.isHorizontal?new cv(Object.assign(Object.assign({direction:"horizontal",disableTriggerEvent:i,range:[0,.5],height:12},t),{width:e})):new cv(Object.assign(Object.assign({direction:"vertical",width:12,range:[0,.5]},t),{height:e,disableTriggerEvent:i}))}_updatePositionOfPager(t,e,i,r,o){const{maxHeight:n,pager:s}=this.attribute,{totalPage:a,isHorizontal:l}=this._itemContext,h=s&&s.position||"middle";if(this._pagerComponent.setTotal(a),l){let e;e="start"===h?i:"end"===h?i+o-this._pagerComponent.AABBBounds.height()/2:i+o/2-this._pagerComponent.AABBBounds.height()/2,this._pagerComponent.setAttributes({x:t,y:e})}else{let t;t="start"===h?0:"end"===h?r-this._pagerComponent.AABBBounds.width():(r-this._pagerComponent.AABBBounds.width())/2,this._pagerComponent.setAttributes({x:t,y:n-this._pagerComponent.AABBBounds.height()})}}_updatePositionOfScrollbar(t,e,i){const{currentPage:r,totalPage:o,isHorizontal:n}=this._itemContext;this._pagerComponent.setScrollRange([(r-1)/o,r/o]),n?this._pagerComponent.setAttributes({x:0,y:i+e}):this._pagerComponent.setAttributes({x:t,y:i})}_bindEventsOfPager(t,e){const i=this.attribute.pager||{},{animation:r=!0,animationDuration:o=450,animationEasing:n="quadIn"}=i,s=this._itemContext.isScrollbar?t=>{const{value:e}=t.detail;let r=e[0]*this._itemContext.totalPage;return i.scrollByPosition?r+=1:r=Math.floor(r)+1,r}:t=>t.detail.current,a=i=>{const a=s(i);if(a!==this._itemContext.currentPage){if(this._itemContext.currentPage=a,this._itemContext&&this._itemContext.startIndex<this._itemContext.items.length){this._renderItems();const t=Math.ceil(this._itemContext.pages/this._itemContext.maxPages);this._itemContext.totalPage=t,this._pagerComponent.setScrollRange([(a-1)/t,a/t])}r?this._itemsContainer.animate().to({[e]:-(a-1)*t},o,n):this._itemsContainer.setAttribute(e,-(a-1)*t)}};this._itemContext.isScrollbar?(this._pagerComponent.addEventListener("scrollDrag",a),this._pagerComponent.addEventListener("scrollUp",a)):(this._pagerComponent.addEventListener("toPrev",a),this._pagerComponent.addEventListener("toNext",a))}_renderPager(){const t=this._title?this._title.AABBBounds.height()+gt(this.attribute,"title.space",8):0,{maxWidth:e,maxHeight:i,maxCol:r=1,maxRow:o=2,item:n={},pager:s={}}=this.attribute,{spaceCol:a=Jv,spaceRow:l=Qv}=n,h=this._itemsContainer,{space:c=tx,defaultCurrent:d=1}=s,u=ax(s,["space","defaultCurrent"]),{isHorizontal:g}=this._itemContext;let p,f=0,m=0,b=0,y=0,C=0,w=0,v=1;if(g){if(m=(o-1)*l+this._itemHeight*o,f=e,p=this._createPager(u),this._pagerComponent=p,this._innerView.add(p),b=e-p.AABBBounds.width()-c,b<=0)return this._innerView.removeChild(p),!1;h.getChildren().forEach(((t,e)=>{const{width:i,height:r}=t.attribute;b<C+i&&(C=0,w+=r+l,v+=1),e>0&&t.setAttributes({x:C,y:w}),C+=a+i})),this._itemContext.startX=C,this._itemContext.startY=w,this._itemContext.pages=v;const i=Math.ceil(v/o);this._itemContext.totalPage=i,this._updatePositionOfPager(b,y,t,f,m)}else{if(f=this._itemMaxWidth*r+(r-1)*a,m=i,b=f,p=this._createPager(u),this._pagerComponent=p,this._innerView.add(p),y=i-p.AABBBounds.height()-c-t,y<=0)return this._innerView.removeChild(p),!1;h.getChildren().forEach(((t,e)=>{const{height:i}=t.attribute;y<w+i&&(w=0,C+=this._itemMaxWidth+a,v+=1),e>0&&t.setAttributes({x:C,y:w}),w+=l+i}));const e=Math.ceil(v/r);this._itemContext.totalPage=e,this._updatePositionOfPager(b,y,t,f,m)}d>1&&(g?h.setAttribute("y",-(d-1)*(m+l)):h.setAttribute("x",-(d-1)*(f+a)));const x=hh.group({x:0,y:t,width:g?b:f,height:g?m:y,clip:!0,pickable:!1});return x.add(h),this._innerView.add(x),this._bindEventsOfPager(g?m+l:f+a,g?"y":"x"),!0}_renderScrollbar(){const t=this._title?this._title.AABBBounds.height()+gt(this.attribute,"title.space",8):0,{maxWidth:e,maxHeight:i,item:r={},pager:o={}}=this.attribute,{spaceCol:n=Jv,spaceRow:s=Qv}=r,a=this._itemsContainer,{space:l=tx,defaultCurrent:h=1}=o,c=ax(o,["space","defaultCurrent"]),{isHorizontal:d}=this._itemContext;let u,g=0,p=0,f=0,m=0,b=1;if(d)g=e,p=e,f=this._itemHeight,u=this._createScrollbar(c,g),this._pagerComponent=u,this._innerView.add(u),this._updatePositionOfScrollbar(p,f,t);else{if(g=i,u=this._createScrollbar(c,g),this._pagerComponent=u,this._innerView.add(u),f=i-t,p=this._itemMaxWidth,f<=0)return this._innerView.removeChild(u),!1;a.getChildren().forEach(((t,e)=>{const{height:i}=t.attribute;b=Math.floor((m+i)/f)+1,m+=s+i})),this._itemContext.totalPage=b,this._itemContext.pages=b,this._updatePositionOfScrollbar(p,f,t)}h>1&&(d?a.setAttribute("x",-(h-1)*(p+n)):a.setAttribute("y",-(h-1)*(f+s)));const y=hh.group({x:0,y:t,width:p,height:f,clip:!0,pickable:!1});return y.add(a),this._innerView.add(y),this._bindEventsOfPager(d?p:f,d?"x":"y"),!0}_renderPagerComponent(){return this._itemContext.isScrollbar?this._renderScrollbar():this._renderPager(),!0}_hover(t,e){this._lastActiveItem=t,t.hasState(ex.selected)?this._setLegendItemState(t,ex.selectedHover,e):this._setLegendItemState(t,ex.unSelectedHover,e);const i=t.getChildren()[0].find((t=>t.name===rx.focus),!1);i&&i.setAttribute("visible",!0),this._dispatchLegendEvent(ix.legendItemHover,t,e)}_unHover(t,e){let i=!1;(t.hasState(ex.unSelectedHover)||t.hasState(ex.selectedHover))&&(i=!0),t.removeState(ex.unSelectedHover),t.removeState(ex.selectedHover),t.getChildren()[0].getChildren().forEach((t=>{i||!t.hasState(ex.unSelectedHover)&&!t.hasState(ex.selectedHover)||(i=!0),t.removeState(ex.unSelectedHover),t.removeState(ex.selectedHover)}));const r=t.getChildren()[0].find((t=>t.name===rx.focus),!1);r&&r.setAttribute("visible",!1),i&&this._dispatchLegendEvent(ix.legendItemAttributeUpdate,t,e),this._dispatchLegendEvent(ix.legendItemUnHover,t,e)}_setLegendItemState(t,e,i){let r=!1;t.hasState(e)||(r=!0),t.addState(e,!0),t.getChildren()[0].getChildren().forEach((t=>{t.name!==rx.focus&&(r||t.hasState(e)||(r=!0),t.addState(e,!0))})),r&&this._dispatchLegendEvent(ix.legendItemAttributeUpdate,t,i)}_removeLegendItemState(t,e,i){let r=!1;e.forEach((e=>{!r&&t.hasState(e)&&(r=!0),t.removeState(e)})),t.getChildren()[0].getChildren().forEach((t=>{t.name!==rx.focus&&e.forEach((e=>{!r&&t.hasState(e)&&(r=!0),t.removeState(e)}))})),r&&this._dispatchLegendEvent(ix.legendItemAttributeUpdate,t,i)}_getSelectedLegends(){var t;const e=[];return null===(t=this._itemsContainer)||void 0===t||t.getChildren().forEach((t=>{t.hasState(ex.selected)&&e.push(t.data)})),e}_appendDataToShape(t,e,i,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};t.name=e,t.data=i,t.delegate=r,t.states=wt({},lx,o)}_dispatchLegendEvent(t,e,i){const r=this._getSelectedLegends();r.sort(((t,e)=>t.index-e.index));const o=r.map((t=>t.label));this._dispatchEvent(t,{item:e,data:e.data,selected:e.hasState(ex.selected),currentSelectedItems:r,currentSelected:o,event:i})}_handleStyle(t,e,i,r,o){const n={};return t.style&&($(t.style)?n.style=t.style(e,i,r,o):n.style=t.style),t.state&&(n.state={},Object.keys(t.state).forEach((s=>{t.state[s]&&($(t.state[s])?n.state[s]=t.state[s](e,i,r,o):n.state[s]=t.state[s])}))),n}}hx.defaultAttributes={layout:"horizontal",title:{align:"start",space:12,textStyle:{fontSize:12,fontWeight:"bold",fill:"#2C3542"}},item:{spaceCol:Jv,spaceRow:Qv,shape:{space:8,style:{size:10,cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{opacity:.5}}},label:{space:8,style:{fontSize:12,fill:"#2C3542",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},value:{alignRight:!1,style:{fontSize:12,fill:"#ccc",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},background:{style:{cursor:"pointer"}},focus:!1,focusIconStyle:{size:10,symbolType:"M8 1C11.866 1 15 4.13401 15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1ZM8.75044 2.55077L8.75 3.75H7.25L7.25006 2.5507C4.81247 2.88304 2.88304 4.81247 2.5507 7.25006L3.75 7.25V8.75L2.55077 8.75044C2.8833 11.1878 4.81264 13.117 7.25006 13.4493L7.25 12.25H8.75L8.75044 13.4492C11.1876 13.1167 13.1167 11.1876 13.4492 8.75044L12.25 8.75V7.25L13.4493 7.25006C13.117 4.81264 11.1878 2.8833 8.75044 2.55077ZM8 5.5C9.38071 5.5 10.5 6.61929 10.5 8C10.5 9.38071 9.38071 10.5 8 10.5C6.61929 10.5 5.5 9.38071 5.5 8C5.5 6.61929 6.61929 5.5 8 5.5ZM8 7C7.44772 7 7 7.44772 7 8C7 8.55228 7.44772 9 8 9C8.55228 9 9 8.55228 9 8C9 7.44772 8.55228 7 8 7Z",fill:"#333",cursor:"pointer"}},autoPage:!0,pager:{space:tx,handler:{style:{size:10},space:4}},hover:!0,select:!0,selectMode:"multiple",allowAllCanceled:!0};var cx=(t,e)=>Object.prototype.toString.call(t)===`[object ${e}]`;var dx=t=>null==t;var ux=t=>null!=t;var gx=t=>Array.isArray?Array.isArray(t):cx(t,"Array");var px=function(t){const e=typeof t;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"number"===e:"number"===e||cx(t,"Number")};function fx(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function mx(t){return Number(t)}const bx=t=>{let e=null,i=null;return function(){for(var r=arguments.length,o=new Array(r),n=0;n<r;n++)o[n]=arguments[n];return e&&o.every(((t,i)=>t===e[i]))||(e=o,i=t(...o)),i}};var yx=function(t,e,i){return t<e?e:t>i?i:t};function Cx(t,e){return i=>t*(1-i)+e*i}function wx(t,e){return function(i){return Math.round(t*(1-i)+e*i)}}function vx(t,e,i){e/=100,i/=100;const r=(1-Math.abs(2*i-1))*e,o=r*(1-Math.abs(t/60%2-1)),n=i-r/2;let s=0,a=0,l=0;return 0<=t&&t<60?(s=r,a=o,l=0):60<=t&&t<120?(s=o,a=r,l=0):120<=t&&t<180?(s=0,a=r,l=o):180<=t&&t<240?(s=0,a=o,l=r):240<=t&&t<300?(s=o,a=0,l=r):300<=t&&t<360&&(s=r,a=0,l=o),s=Math.round(255*(s+n)),a=Math.round(255*(a+n)),l=Math.round(255*(l+n)),{r:s,g:a,b:l}}function xx(t,e,i){t/=255,e/=255,i/=255;const r=Math.min(t,e,i),o=Math.max(t,e,i),n=o-r;let s=0,a=0,l=0;return s=0===n?0:o===t?(e-i)/n%6:o===e?(i-t)/n+2:(t-e)/n+4,s=Math.round(60*s),s<0&&(s+=360),l=(o+r)/2,a=0===n?0:n/(1-Math.abs(2*l-1)),a=+(100*a).toFixed(1),l=+(100*l).toFixed(1),{h:s,s:a,l:l}}const _x=/^#([0-9a-f]{3,8})$/,Sx={transparent:4294967040},Ax={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Rx(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function Bx(t){return px(t)?new Hx(t>>16,t>>8&255,255&t,1):gx(t)?new Hx(t[0],t[1],t[2]):new Hx(255,255,255)}function Mx(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Tx(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class Px{static Brighter(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return 1===e?t:new Px(t).brighter(e).toRGBA()}static SetOpacity(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return 1===e?t:new Px(t).setOpacity(e).toRGBA()}static getColorBrightness(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"hsl";const i=t instanceof Px?t:new Px(t);switch(e){case"hsv":default:return i.getHSVBrightness();case"hsl":return i.getHSLBrightness();case"lum":return i.getLuminance();case"lum2":return i.getLuminance2();case"lum3":return i.getLuminance3()}}static parseColorString(t){if(ux(Sx[t]))return function(t){return px(t)?new Hx(t>>>24,t>>>16&255,t>>>8&255,255&t):gx(t)?new Hx(t[0],t[1],t[2],t[3]):new Hx(255,255,255,1)}(Sx[t]);if(ux(Ax[t]))return Bx(Ax[t]);const e=`${t}`.trim().toLowerCase(),i=_x.exec(e);if(i){const t=parseInt(i[1],16),e=i[1].length;return 3===e?new Hx((t>>8&15)+((t>>8&15)<<4),(t>>4&15)+((t>>4&15)<<4),(15&t)+((15&t)<<4),1):6===e?Bx(t):8===e?new Hx(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):void 0}if(/^(rgb|RGB|rgba|RGBA)/.test(e)){const t=e.replace(/(?:\(|\)|rgba|RGBA|rgb|RGB)*/g,"").split(",");return new Hx(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10),parseFloat(t[3]))}if(/^(hsl|HSL|hsla|HSLA)/.test(e)){const t=e.replace(/(?:\(|\)|hsla|HSLA|hsl|HSL)*/g,"").split(","),i=vx(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10));return new Hx(i.r,i.g,i.b,parseFloat(t[3]))}}constructor(t){const e=Px.parseColorString(t);this.color=e||new Hx(255,255,255)}toRGBA(){return this.color.formatRgb()}toString(){return this.color.formatRgb()}toHex(){return this.color.formatHex()}toHsl(){return this.color.formatHsl()}brighter(t){const{r:e,g:i,b:r}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t))),this.color.b=Math.max(0,Math.min(255,Math.floor(r*t))),this}add(t){const{r:e,g:i,b:r}=this.color;return this.color.r+=Math.min(255,e+t.color.r),this.color.g+=Math.min(255,i+t.color.g),this.color.b+=Math.min(255,r+t.color.b),this}sub(t){return this.color.r=Math.max(0,this.color.r-t.color.r),this.color.g=Math.max(0,this.color.g-t.color.g),this.color.b=Math.max(0,this.color.b-t.color.b),this}multiply(t){const{r:e,g:i,b:r}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t.color.r))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t.color.g))),this.color.b=Math.max(0,Math.min(255,Math.floor(r*t.color.b))),this}getHSVBrightness(){return Math.max(this.color.r,this.color.g,this.color.b)/255}getHSLBrightness(){return.5*(Math.max(this.color.r,this.color.g,this.color.b)/255+Math.min(this.color.r,this.color.g,this.color.b)/255)}setHsl(t,e,i){const r=this.color.opacity,o=xx(this.color.r,this.color.g,this.color.b),n=vx(dx(t)?o.h:yx(t,0,360),dx(e)?o.s:e>=0&&e<=1?100*e:e,dx(i)?o.l:i<=1&&i>=0?100*i:i);return this.color=new Hx(n.r,n.g,n.b,r),this}setRGB(t,e,i){return!dx(t)&&(this.color.r=t),!dx(e)&&(this.color.g=e),!dx(i)&&(this.color.b=i),this}setHex(t){const e=`${t}`.trim().toLowerCase(),i=_x.exec(e),r=parseInt(i[1],16),o=i[1].length;return 3===o?new Hx((r>>8&15)+((r>>8&15)<<4),(r>>4&15)+((r>>4&15)<<4),(15&r)+((15&r)<<4),1):6===o?Bx(r):8===o?new Hx(r>>24&255,r>>16&255,r>>8&255,(255&r)/255):this}setColorName(t){const e=Ax[t.toLowerCase()];return void 0!==e&&this.setHex(e),this}setScalar(t){return this.color.r=t,this.color.g=t,this.color.b=t,this}setOpacity(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.color.opacity=t,this}getLuminance(){return(.2126*this.color.r+.7152*this.color.g+.0722*this.color.b)/255}getLuminance2(){return(.2627*this.color.r+.678*this.color.g+.0593*this.color.b)/255}getLuminance3(){return(.299*this.color.r+.587*this.color.g+.114*this.color.b)/255}clone(){return new Px(this.color.toString())}copyGammaToLinear(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return this.color.r=Math.pow(t.color.r,e),this.color.g=Math.pow(t.color.g,e),this.color.b=Math.pow(t.color.b,e),this}copyLinearToGamma(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const i=e>0?1/e:1;return this.color.r=Math.pow(t.color.r,i),this.color.g=Math.pow(t.color.g,i),this.color.b=Math.pow(t.color.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.color.r=Mx(t.color.r),this.color.g=Mx(t.color.g),this.color.b=Mx(t.color.b),this}copyLinearToSRGB(t){return this.color.r=Tx(t.color.r),this.color.g=Tx(t.color.g),this.color.b=Tx(t.color.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}}class Hx{constructor(t,e,i,r){this.r=isNaN(+t)?255:Math.max(0,Math.min(255,+t)),this.g=isNaN(+e)?255:Math.max(0,Math.min(255,+e)),this.b=isNaN(+i)?255:Math.max(0,Math.min(255,+i)),ux(r)?this.opacity=isNaN(+r)?1:Math.max(0,Math.min(1,+r)):this.opacity=1}formatHex(){return`#${Rx(this.r)+Rx(this.g)+Rx(this.b)+(1===this.opacity?"":Rx(255*this.opacity))}`}formatRgb(){const t=this.opacity;return`${1===t?"rgb(":"rgba("}${this.r},${this.g},${this.b}${1===t?")":`,${t})`}`}formatHsl(){const t=this.opacity,{h:e,s:i,l:r}=xx(this.r,this.g,this.b);return`${1===t?"hsl(":"hsla("}${e},${i}%,${r}%${1===t?")":`,${t})`}`}toString(){return this.formatHex()}}var Ex,kx=Object.freeze({__proto__:null,Color:Px,DEFAULT_COLORS:Ax,RGB:Hx,hexToRgb:function(t){let e="",i="",r="";const o="#"===t[0]?1:0;for(let n=o;n<t.length;n++)"#"!==t[n]&&(n<o+2?e+=t[n]:n<o+4?i+=t[n]:n<o+6&&(r+=t[n]));return[parseInt(e,16),parseInt(i,16),parseInt(r,16)]},hslToRgb:vx,interpolateRgb:function(t,e){const i=t.r,r=e.r,o=t.g,n=e.g,s=t.b,a=e.b,l=t.opacity,h=e.opacity;return t=>{const e=Math.round(i*(1-t)+r*t),c=Math.round(o*(1-t)+n*t),d=Math.round(s*(1-t)+a*t);return new Hx(e,c,d,l*(1-t)+h*t)}},rgbToHex:function(t,e,i){return Number((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)},rgbToHsl:xx});function Lx(t){return t}function Fx(t,e){if(t=Number(t),e=Number(e),e-=t)return i=>(i-t)/e;const i=Number.isNaN(e)?NaN:.5;return()=>i}function Ix(t,e,i){const r=t[0],o=t[1],n=e[0],s=e[1];let a,l;return o<r?(a=Fx(o,r),l=i(s,n)):(a=Fx(r,o),l=i(n,s)),t=>l(a(t))}function zx(t,e,i){const r=Math.min(t.length,e.length)-1,o=new Array(r),n=new Array(r);let s=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++s<r;)o[s]=Fx(t[s],t[s+1]),n[s]=i(e[s],e[s+1]);return function(e){const i=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;for(dx(r)&&(r=t.length);i<r;){const o=i+r>>>1;fx(t[o],e)>0?r=o:i=o+1}return i}(t,e,1,r)-1;return n[i](o[i](e))}}!function(t){t.Identity="identity",t.Linear="linear",t.Log="log",t.Pow="pow",t.Sqrt="sqrt",t.Symlog="symlog",t.Time="time",t.Quantile="quantile",t.Quantize="quantize",t.Threshold="threshold",t.Ordinal="ordinal",t.Point="point",t.Band="band"}(Ex||(Ex={})),Object.values(Ex).forEach((t=>{}));let Ox=class{constructor(){this._rangeFactorStart=null,this._rangeFactorEnd=null}_calculateWholeRange(t){return this._wholeRange?this._wholeRange:ux(this._rangeFactorStart)&&ux(this._rangeFactorEnd)&&2===t.length?(this._wholeRange=function(t,e){const i=(t[1]-t[0])/(e[1]-e[0]),r=t[0]-i*e[0];return[r,i+r]}(t,[this._rangeFactorStart,this._rangeFactorEnd]),this._wholeRange):t}rangeFactor(t,e,i){return t?(2===t.length&&t.every((t=>t>=0&&t<=1))&&(this._wholeRange=null,0===t[0]&&1===t[1]?(this._rangeFactorStart=null,this._rangeFactorEnd=null):(this._rangeFactorStart=t[0],this._rangeFactorEnd=t[1])),this):i?(this._wholeRange=null,this._rangeFactorStart=null,this._rangeFactorEnd=null,this):ux(this._rangeFactorStart)&&ux(this._rangeFactorEnd)?[this._rangeFactorStart,this._rangeFactorEnd]:null}rangeFactorStart(t,e){var i;return dx(t)?this._rangeFactorStart:(t>=0&&t<=1&&(this._wholeRange=null,0!==t||!dx(this._rangeFactorEnd)&&1!==this._rangeFactorEnd?(this._rangeFactorStart=t,this._rangeFactorEnd=null!==(i=this._rangeFactorEnd)&&void 0!==i?i:1):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}rangeFactorEnd(t,e){var i;return dx(t)?this._rangeFactorEnd:(t>=0&&t<=1&&(this._wholeRange=null,0!==t||!dx(this._rangeFactorStart)&&0!==this._rangeFactorStart?(this._rangeFactorEnd=t,this._rangeFactorStart=null!==(i=this._rangeFactorStart)&&void 0!==i?i:0):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}generateFishEyeTransform(){var t;if(!this._fishEyeOptions)return void(this._fishEyeTransform=null);const{distortion:e=2,radiusRatio:i=.1,radius:r}=this._fishEyeOptions,o=this.range(),n=o[0],s=o[o.length-1],a=Math.min(n,s),l=Math.max(n,s),h=yx(null!==(t=this._fishEyeOptions.focus)&&void 0!==t?t:0,a,l),c=dx(r)?(l-a)*i:r;let d=Math.exp(e);d=d/(d-1)*c;const u=e/c;this._fishEyeTransform=t=>{const e=Math.abs(t-h);if(e>=c)return t;if(e<=1e-6)return h;const i=d*(1-Math.exp(-e*u))/e*.75+.25;return h+(t-h)*i}}unknown(t){return arguments.length?(this._unknown=t,this):this._unknown}};const{interpolateRgb:Dx}=kx;function Wx(t,e){const i=typeof e;let r;if(dx(e)||"boolean"===i)return()=>e;if("number"===i)return Cx(t,e);if("string"===i){if(r=Px.parseColorString(e)){const e=Dx(Px.parseColorString(t),r);return t=>e(t).formatRgb()}return Cx(Number(t),Number(e))}return e instanceof Hx?Dx(t,e):e instanceof Px?Dx(t.color,e.color):e instanceof Date?function(t,e){const i=t.valueOf(),r=e.valueOf(),o=new Date;return t=>(o.setTime(i*(1-t)+r*t),o)}(t,e):Cx(Number(t),Number(e))}let Nx=class extends Ox{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Lx,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Lx;super(),this._unknown=void 0,this.transformer=t,this.untransformer=e,this._forceAlign=!0,this._domain=[0,1],this._range=[0,1],this._clamp=Lx,this._piecewise=Ix,this._interpolate=Wx}calculateVisibleDomain(t){var e;return ux(this._rangeFactorStart)&&ux(this._rangeFactorEnd)&&2===t.length?[this.invert(t[0]),this.invert(t[1])]:null!==(e=this._niceDomain)&&void 0!==e?e:this._domain}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise((null!==(e=this._niceDomain)&&void 0!==e?e:this._domain).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._clamp(t)));return this._fishEyeTransform?this._fishEyeTransform(i):i}invert(t){var e;return this._input||(this._input=this._piecewise(this._calculateWholeRange(this._range),(null!==(e=this._niceDomain)&&void 0!==e?e:this._domain).map(this.transformer),Cx)),this._clamp(this.untransformer(this._input(t)))}domain(t,e){var i;if(!t)return(null!==(i=this._niceDomain)&&void 0!==i?i:this._domain).slice();this._domainValidator=null,this._niceType=null,this._niceDomain=null;const r=Array.from(t,mx);return this._domain=r,this.rescale(e)}range(t,e){if(!t)return this._range.slice();const i=Array.from(t);return this._range=i,this.rescale(e)}rangeRound(t,e){const i=Array.from(t);return this._range=i,this._interpolate=wx,this.rescale(e)}rescale(t){var e;if(t)return this;const i=null!==(e=this._niceDomain)&&void 0!==e?e:this._domain,r=i.length,o=this._range.length;let n=Math.min(r,o);if(r&&r<o&&this._forceAlign){const t=o-r+1,e=i[r-1],s=r>=2?(e-i[r-2])/t:0;for(let o=1;o<=t;o++)i[r-2+o]=e-s*(t-o);n=o}return this._autoClamp&&(this._clamp=function(t,e){let i;return t>e&&(i=t,t=e,e=i),i=>Math.max(t,Math.min(e,i))}(i[0],i[n-1])),this._piecewise=n>2?zx:Ix,this._output=this._input=null,this._wholeRange=null,this.generateFishEyeTransform(),this}clamp(t,e,i){return arguments.length?(e?(this._autoClamp=!1,this._clamp=e):(this._autoClamp=!!t,this._clamp=t?void 0:Lx),this.rescale(i)):this._clamp!==Lx}interpolate(t,e){return arguments.length?(this._interpolate=t,this.rescale(e)):this._interpolate}ticks(){return[]}tickData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.ticks(t);return(null!=e?e:[]).map(((t,e)=>({index:e,tick:t,value:(this.scale(t)-this._range[0])/(this._range[1]-this._range[0])})))}rangeFactor(t,e){return t?(super.rangeFactor(t),this._output=this._input=null,this):super.rangeFactor()}rangeFactorStart(t,e){return dx(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this._output=this._input=null,this)}rangeFactorEnd(t,e){return dx(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this._output=this._input=null,this)}forceAlignDomainRange(t){return arguments.length?(this._forceAlign=t,this):this._forceAlign}};const Gx=Math.sqrt(50),jx=Math.sqrt(10),Vx=Math.sqrt(2),Ux=[1,2,5,10],Kx=(t,e,i)=>{let r=1,o=t;const n=Math.floor((e-1)/2),s=Math.abs(t);return t>=0&&t<=Number.MIN_VALUE?o=0:t<0&&t>=-Number.MIN_VALUE?o=-(e-1):!i&&s<1?r=qx(s).step:(i||s>1)&&(o=Math.floor(t)-n*r),r>0?(t>0?o=Math.max(o,0):t<0&&(o=Math.min(o,-(e-1)*r)),function(t,e,i){ux(e)||(e=t,t=0),ux(i)||(i=1);let r=-1;const o=0|Math.max(0,Math.ceil((e-t)/i)),n=new Array(o);for(;++r<o;)n[r]=t+r*i;return n}(0,e).map((t=>o+t*r))):t>0?Xx(0,-(e-1)/r,r):Xx((e-1)/r,0,r)},$x=bx(((t,e,i,r)=>{let o,n,s,a,l=-1;if(i=+i,(t=+t)==(e=+e))return[t];if(Math.abs(t-e)<=Number.MIN_VALUE&&i>0)return[t];if((o=e<t)&&(n=t,t=e,e=n),a=Zx(t,e,i).step,!isFinite(a))return[];if(a>0){let i=Math.round(t/a),r=Math.round(e/a);for(i*a<t&&++i,r*a>e&&--r,s=new Array(n=r-i+1);++l<n;)s[l]=(i+l)*a}else if(a<0&&(null==r?void 0:r.noDecimals)){a=1;const i=Math.ceil(t),r=Math.floor(e);if(!(i<=r))return[];for(s=new Array(n=r-i+1);++l<n;)s[l]=i+l}else{a=-a;let i=Math.round(t*a),r=Math.round(e*a);for(i/a<t&&++i,r/a>e&&--r,s=new Array(n=r-i+1);++l<n;)s[l]=(i+l)/a}return o&&s.reverse(),s})),Xx=(t,e,i)=>{let r,o,n=-1;if(i>0){let s=Math.floor(t/i),a=Math.ceil(e/i);for((s+1)*i<t&&++s,(a-1)*i>e&&--a,o=new Array(r=a-s+1);++n<r;)o[n]=(s+n)*i}else{i=-i;let s=Math.floor(t*i),a=Math.ceil(e*i);for((s+1)/i<t&&++s,(a-1)/i>e&&--a,o=new Array(r=a-s+1);++n<r;)o[n]=(s+n)/i}return o},Yx=bx(((t,e,i,r)=>{let o,n,s;if(i=+i,(t=+t)==(e=+e))return Kx(t,i,null==r?void 0:r.noDecimals);if(Math.abs(t-e)<=Number.MIN_VALUE&&i>0)return Kx(t,i,null==r?void 0:r.noDecimals);(o=e<t)&&(s=t,t=e,e=s);const a=Zx(t,e,i);let l=a.step;if(!isFinite(l))return[];if(l>0){let r=1;const{power:o,gap:s}=a,h=10===s?2*10**o:1*10**o;for(;r<=5&&(n=Xx(t,e,l),n.length>i+1)&&i>2;)l+=h,r+=1;i>2&&n.length<i-1&&(n=((t,e,i)=>{let r;const o=t[0],n=t[t.length-1],s=e-t.length;if(n<=0){const e=[];for(r=s;r>=1;r--)e.push(o-r*i);return e.concat(t)}if(o>=0){for(r=1;r<=s;r++)t.push(n+r*i);return t}let a=[];const l=[];for(r=1;r<=s;r++)r%2==0?a=[o-Math.floor(r/2)*i].concat(a):l.push(n+Math.ceil(r/2)*i);return a.concat(t).concat(l)})(n,i,l))}else(null==r?void 0:r.noDecimals)&&l<0&&(l=1),n=Xx(t,e,l);return o&&n.reverse(),n})),qx=t=>{const e=Math.floor(Math.log(t)/Math.LN10),i=t/10**e;let r=Ux[0];return i>=Gx?r=Ux[3]:i>=jx?r=Ux[2]:i>=Vx&&(r=Ux[1]),e>=0?{step:r*10**e,gap:r,power:e}:{step:-(10**-e)/r,gap:r,power:e}};function Zx(t,e,i){const r=(e-t)/Math.max(0,i);return qx(r)}function Jx(t,e,i){let r;if(i=+i,(t=+t)==(e=+e)&&i>0)return[t];if(i<=0||0===(r=function(t,e,i){return(e-t)/Math.max(1,i-1)}(t,e,i))||!isFinite(r))return[];const o=new Array(i);for(let e=0;e<i;e++)o[e]=t+e*r;return o}function Qx(t){let e,i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,o=0,n=t.length-1,s=t[o],a=t[n],l=10;for(a<s&&(i=s,s=a,a=i,i=o,o=n,n=i);l-- >0;){if(i=Zx(s,a,r).step,i===e)return t[o]=s,t[n]=a,t;if(i>0)s=Math.floor(s/i)*i,a=Math.ceil(a/i)*i;else{if(!(i<0))break;s=Math.ceil(s*i)/i,a=Math.floor(a*i)/i}e=i}}let t_=class t extends Nx{constructor(){super(...arguments),this.type=Ex.Linear}clone(){return(new t).domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate)}tickFormat(){return()=>{}}d3Ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;const i=this.calculateVisibleDomain(this._range);return $x(i[0],i[i.length-1],t,e)}ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;var i;if(ux(this._rangeFactorStart)&&ux(this._rangeFactorEnd)&&(this._rangeFactorStart>0||this._rangeFactorEnd<1)&&2===this._range.length||!this._niceType)return this.d3Ticks(t,e);const r=null!==(i=this._niceDomain)&&void 0!==i?i:this._domain,o=this._domain,n=r[0],s=r[r.length-1];let a=Yx(o[0],o[o.length-1],t,e);if(!a.length)return a;if(this._domainValidator)a=a.filter(this._domainValidator);else if((a[0]!==n||a[a.length-1]!==s)&&this._niceType){const t=r.slice();if("all"===this._niceType?(t[0]=a[0],t[t.length-1]=a[a.length-1],this._niceDomain=t,this.rescale()):"min"===this._niceType&&a[0]!==n?(t[0]=a[0],this._niceDomain=t,this.rescale()):"max"===this._niceType&&a[a.length-1]!==s&&(t[t.length-1]=a[a.length-1],this._niceDomain=t,this.rescale()),"all"!==this._niceType){const e=Math.min(t[0],t[t.length-1]),i=Math.max(t[0],t[t.length-1]);a=a.filter((t=>t>=e&&t<=i))}}return a}forceTicks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return Jx(e[0],e[e.length-1],t)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return function(t,e,i){let r,o,n=-1;if(i=+i,(o=(e=+e)<(t=+t))&&(r=t,t=e,e=r),!isFinite(i)||e-t<=i)return[t];const s=Math.floor((e-t)/i+1),a=new Array(s);for(;++n<s;)a[n]=t+n*i;return o&&a.reverse(),a}(e[0],e[e.length-1],t)}nice(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;var i,r;const o=this._domain;let n=[];if(e){const t=function(t,e){const i=px(e.forceMin),r=px(e.forceMax);let o=null;const n=[];let s=null;const a=i&&r?t=>t>=e.forceMin&&t<=e.forceMax:i?t=>t>=e.forceMin:r?t=>t<=e.forceMax:null;return i?n[0]=e.forceMin:px(e.min)&&e.min<=Math.min(t[0],t[t.length-1])&&(n[0]=e.min),r?n[1]=e.forceMax:px(e.max)&&e.max>=Math.max(t[0],t[t.length-1])&&(n[1]=e.max),px(n[0])&&px(n[1])?(s=t.slice(),s[0]=n[0],s[s.length-1]=n[1]):o=px(n[0])||px(n[1])?px(n[0])?"max":"min":"all",{niceType:o,niceDomain:s,niceMinMax:n,domainValidator:a}}(o,e);if(n=t.niceMinMax,this._domainValidator=t.domainValidator,this._niceType=t.niceType,t.niceDomain)return this._niceDomain=t.niceDomain,this.rescale(),this}else this._niceType="all";if(this._niceType){const e=Qx(o.slice(),t);"min"===this._niceType?e[e.length-1]=null!==(i=n[1])&&void 0!==i?i:e[e.length-1]:"max"===this._niceType&&(e[0]=null!==(r=n[0])&&void 0!==r?r:e[0]),this._niceDomain=e,this.rescale()}return this}niceMin(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;this._niceType="min";const e=this._domain[this._domain.length-1],i=Qx(this.domain(),t);return i&&(i[i.length-1]=e,this._niceDomain=i,this.rescale()),this}niceMax(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;this._niceType="max";const e=this._domain[0],i=Qx(this._domain.slice(),t);return i&&(i[0]=e,this._niceDomain=i,this.rescale()),this}};var e_;function i_(t){return et(t)?t:[t,t]}function r_(t){return t?"ew-resize":"ns-resize"}!function(t){t.innerView="innerView",t.railContainer="sliderRailContainer",t.rail="sliderRail",t.startText="sliderStartText",t.endText="sliderEndText",t.startHandler="sliderStartHandler",t.startHandlerText="startHandlerText",t.endHandler="sliderEndHandler",t.endHandlerText="sliderEndHandlerText",t.track="sliderTrack",t.trackContainer="sliderTrackContainer"}(e_||(e_={})),nx();class o_ extends ov{get track(){return this._track}get currentValue(){return this._currentValue}get startHandler(){return this._startHandler}get endHandler(){return this._endHandler}get tooltipShape(){return this._tooltipShape}constructor(t,e){super((null==e?void 0:e.skipDefault)?t:wt({},o_.defaultAttributes,t)),this.name="slider",this._isHorizontal=!0,this._startHandler=null,this._endHandler=null,this._startHandlerText=null,this._endHandlerText=null,this._currentHandler=null,this._currentValue={},this._onTooltipShow=t=>{this._isChanging||this._tooltipState&&this._tooltipState.isActive||(this._tooltipState?this._tooltipState.isActive=!0:this._tooltipState={isActive:!0},this._onTooltipUpdate(t),this._dispatchTooltipEvent("sliderTooltipShow"))},this._onTooltipUpdate=t=>{if(this._isChanging||!this._tooltipState||!this._tooltipState.isActive)return;const e=this._isHorizontal?this._rail.globalAABBBounds.width():this._rail.globalAABBBounds.height(),i=Dt(this._isHorizontal?(t.viewX-this._rail.globalAABBBounds.x1)/e:(t.viewY-this._rail.globalAABBBounds.y1)/e,0,1);i!==this._tooltipState.pos&&(this._tooltipState.pos=i,this._tooltipState.value=this.calculateValueByPos(i*e),this._updateTooltip(),this._dispatchTooltipEvent("sliderTooltipUpdate"))},this._onTooltipHide=()=>{const{tooltip:t}=this.attribute;t&&t.alwaysShow||(this._tooltipState=null,this._tooltipShape&&this._tooltipShape.setAttribute("visible",!1),this._tooltipText&&this._tooltipText.setAttribute("visible",!1),this._dispatchTooltipEvent("sliderTooltipHide"))},this._onHandlerPointerdown=t=>{t.stopPropagation(),this._isChanging=!0,this._currentHandler=t.target,this._prePos=this._isHorizontal?t.clientX:t.clientY,"browser"===Su.env?(Su.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),Su.addEventListener("pointerup",this._onHandlerPointerUp)):(this.stage.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),this.stage.addEventListener("pointerup",this._onHandlerPointerUp),this.stage.addEventListener("pointerupoutside",this._onHandlerPointerUp))},this._onHandlerPointerMove=t=>{var e,i;t.stopPropagation(),this._isChanging=!0;const{railWidth:r,railHeight:o,min:n,max:s}=this.attribute;if(s===n)return;let a,l,h,c=0;this._isHorizontal?(a=t.clientX,c=a-this._prePos,l=null===(i=this._currentHandler)||void 0===i?void 0:i.attribute.x,h=r):(a=t.clientY,c=a-this._prePos,l=null===(e=this._currentHandler)||void 0===e?void 0:e.attribute.y,h=o);const d=Dt(l+c,0,h),u=this.calculateValueByPos(d);"text"===this._currentHandler.type?this._updateHandlerText(this._currentHandler,d,u):this._updateHandler(this._currentHandler,d,u),this._updateTrack(),this._prePos=a,this._dispatchChangeEvent()},this._onHandlerPointerUp=t=>{t.preventDefault(),this._isChanging=!1,this._currentHandler=null,"browser"===Su.env?(Su.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),Su.removeEventListener("pointerup",this._onHandlerPointerUp)):(this.stage.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),this.stage.removeEventListener("pointerup",this._onHandlerPointerUp),this.stage.removeEventListener("pointerupoutside",this._onHandlerPointerUp))},this._onTrackPointerdown=t=>{t.stopPropagation(),this._isChanging=!0,this._prePos=this._isHorizontal?t.clientX:t.clientY,"browser"===Su.env?(Su.addEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),Su.addEventListener("pointerup",this._onTrackPointerUp)):(this.stage.addEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),this.stage.addEventListener("pointerup",this._onTrackPointerUp),this.stage.addEventListener("pointerupoutside",this._onTrackPointerUp))},this._onTrackPointerMove=t=>{t.stopPropagation(),this._isChanging=!0;const{railWidth:e,railHeight:i,min:r,max:o,inverse:n}=this.attribute;if(o===r)return;const{startHandler:s,endHandler:a}=this._getHandlers();let l,h,c;this._isHorizontal?(l=t.clientX,h=this._track.attribute.width,c=e):(l=t.clientY,h=this._track.attribute.height,c=i);const d=l-this._prePos;if(s){const t=this._isHorizontal?s.attribute.x:s.attribute.y,e=n?Dt(t+d,h,c):Dt(t+d,0,c-h),i=this.calculateValueByPos(e);this._updateHandler(s,e,i)}if(a){const t=this._isHorizontal?a.attribute.x:a.attribute.y,e=n?Dt(t+d,0,c-h):Dt(t+d,h,c),i=this.calculateValueByPos(e),r=null==s?void 0:s.attribute;this._updateHandler(a,e,i),this._track.setAttributes(this._isHorizontal?{x:Math.min(r.x,a.attribute.x),width:Math.abs(r.x-a.attribute.x)}:{y:Math.min(r.y,a.attribute.y),height:Math.abs(r.y-a.attribute.y)})}this._prePos=l,this._dispatchChangeEvent()},this._onTrackPointerUp=t=>{t.preventDefault(),this._isChanging=!1,"browser"===Su.env?(Su.removeEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),Su.removeEventListener("pointerup",this._onTrackPointerUp)):(this.stage.removeEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),this.stage.removeEventListener("pointerup",this._onTrackPointerUp),this.stage.removeEventListener("pointerupoutside",this._onTrackPointerUp))},this._onRailPointerDown=t=>{t.stopPropagation(),this._isChanging=!0;const{railWidth:e,railHeight:i,min:r,max:o}=this.attribute;if(o===r)return;const n=this._startHandler,s=this._endHandler;let a,l,h;this._isHorizontal?(a=t.viewX-this._rail.globalAABBBounds.x1,l=null==n?void 0:n.attribute.x,h=null==s?void 0:s.attribute.x):(a=t.viewY-this._rail.globalAABBBounds.y1,l=null==n?void 0:n.attribute.y,h=null==s?void 0:s.attribute.y);const c=this.calculateValueByPos(a);if(Y(h)){const t=Math.abs(a-l)>Math.abs(a-h)?s:n;this._updateHandler(t,a,c)}else this._updateHandler(n,a,c);this._updateTrack(),this._dispatchChangeEvent()}}calculatePosByValue(t,e){const{layout:i,railWidth:r,railHeight:o,min:n,max:s,inverse:a}=this.attribute;let l=0;return l=n===s?"start"===e?0:"end"===e?1:0:(t-n)/(s-n),(a?1-l:l)*("vertical"===i?o:r)}calculateValueByPos(t){const{layout:e,railWidth:i,railHeight:r,min:o,max:n,inverse:s}=this.attribute,a="vertical"===e?r:i;return o+(n-o)*(s?1-t/a:t/a)}setValue(t){const{min:e,max:i}=this.attribute;if(i===e)return;const[r,o]=At(t),{startHandler:n,endHandler:s}=this._getHandlers();n&&this._updateHandler(n,this.calculatePosByValue(r),r),s&&this._updateHandler(s,this.calculatePosByValue(o),o),this._updateTrack()}render(){var t,e;this.removeAllChild(!0);const{layout:i="horizontal",railWidth:r,railHeight:o,startText:n,endText:s,min:a,max:l,showHandler:h=!0,showTooltip:c}=this.attribute;let{value:d}=this.attribute;X(d)&&(d=[a,l]),this._currentValue={startValue:i_(d)[0],endValue:i_(d)[1]};const u="horizontal"===i;this._isHorizontal=u;const g=hh.group({x:0,y:0});g.name=e_.innerView,this.add(g),this._innerView=g;let p,f=0;if(n&&n.visible){p=hh.text(Object.assign({x:u?0:r/2,y:u?o/2:0,textAlign:u?"start":"center",textBaseline:u?"middle":"top",text:n.text,lineHeight:null===(t=n.style)||void 0===t?void 0:t.fontSize},n.style)),p.name=e_.startText,g.add(p);const e=Y(n.space)?n.space:0;f+=(u?p.AABBBounds.width():p.AABBBounds.height())+e}const m=hh.group({x:u?f:0,y:u?0:f});g.add(m);const b=hh.group({x:0,y:0});let y;if(b.name=e_.railContainer,this._railContainer=b,m.add(b),this._mainContainer=m,this._renderRail(b),f+=u?r:o,s&&s.visible){const t=Y(s.space)?s.space:0;y=hh.text(Object.assign({x:u?f+t:r/2,y:u?o/2:f+t,textAlign:u?"start":"center",textBaseline:u?"middle":"top",text:s.text,lineHeight:null===(e=s.style)||void 0===e?void 0:e.fontSize},s.style)),y.name=e_.endText,g.add(y)}this._renderTrack(b),h&&(this._renderHandlers(m),this._bindEvents()),c&&(this._renderTooltip(),this._bindTooltipEvents())}_renderRail(t){const{railWidth:e,railHeight:i,railStyle:r,slidable:o}=this.attribute;let n="default";!1!==o&&(n="pointer");const s=hh.rect(Object.assign({x:0,y:0,width:e,height:i,cursor:n},r));return s.name=e_.rail,t.add(s),this._rail=s,s}_renderHandlers(t){const{range:e,min:i,max:r,handlerSize:o=14,handlerStyle:n,handlerText:s,railHeight:a,railWidth:l,slidable:h}=this.attribute;let{value:c}=this.attribute;X(c)&&(c=[i,r]);const d=s&&s.visible,u=this._isHorizontal,[g,p]=i_(c),f=this.calculatePosByValue(g,e?"start":"end"),m=this._renderHandler(Object.assign({x:u?f:l/2,y:u?a/2:f,size:o,strokeBoundsBuffer:0,cursor:!1===h?"default":r_(u)},n));if(m.name=e_.startHandler,this._startHandler=m,t.add(m),this._currentValue.startPos=f,d){const i=this._renderHandlerText(g,e?"start":"end");i.name=e_.startHandlerText,t.add(i),this._startHandlerText=i}if(e){const e=this.calculatePosByValue(p,"end"),i=this._renderHandler(Object.assign({x:u?e:l/2,y:u?a/2:e,size:o,strokeBoundsBuffer:0,cursor:!1===h?"default":r_(u)},n));if(i.name=e_.endHandler,this._endHandler=i,t.add(i),this._currentValue.endPos=e,d){const e=this._renderHandlerText(p,"end");e.name=e_.endHandlerText,t.add(e),this._endHandlerText=e}}}_renderTrack(t){const{range:e,min:i,max:r,railHeight:o,railWidth:n,trackStyle:s,railStyle:a,slidable:l,value:h}=this.attribute;let c,d;if(X(h))e?(c=i,d=r):c=d=i;else if(e){const t=Wt(h,i,r);c=t[0],d=t[1]}else c=i,d=Dt(h,i,r);const u=this._isHorizontal;e||(c=i);const g=hh.group({x:0,y:0,width:n,height:o,cornerRadius:null==a?void 0:a.cornerRadius,clip:!0,pickable:!1});g.name=e_.trackContainer;const p=q(e)&&!0===e.draggableTrack;let f;f=!1===l?"default":!1===e||!1===p?"pointer":r_(u);const m=this.calculatePosByValue(c,"start"),b=this.calculatePosByValue(d,e?"end":"start"),y=hh.rect(Object.assign({x:u?Math.min(m,b):0,y:u?0:Math.min(m,b),width:u?Math.abs(b-m):n,height:u?o:Math.abs(b-m),cursor:f},s));y.name=e_.track,this._track=y,g.add(y),t.add(g)}_renderHandler(t){return hh.symbol(t)}_renderHandlerText(t,e){var i,r,o;const{align:n,handlerSize:s=14,handlerText:a={},railHeight:l,railWidth:h,slidable:c}=this.attribute,d=this._isHorizontal,u=this.calculatePosByValue(t,e),g=null!==(i=a.space)&&void 0!==i?i:4,p={text:a.formatter?a.formatter(t):t.toFixed(null!==(r=a.precision)&&void 0!==r?r:0),lineHeight:null===(o=a.style)||void 0===o?void 0:o.lineHeight,cursor:!1===c?"default":r_(d)};return d?"top"===n?(p.textBaseline="bottom",p.textAlign="center",p.x=u,p.y=(l-s)/2-g):(p.textBaseline="top",p.textAlign="center",p.x=u,p.y=(l+s)/2+g):"left"===n?(p.textBaseline="middle",p.textAlign="end",p.x=(h-s)/2-g,p.y=u):(p.textBaseline="middle",p.textAlign="start",p.x=(h+s)/2+g,p.y=u),hh.text(Object.assign(Object.assign({},p),a.style))}_renderTooltip(){var t;const{tooltip:e,railHeight:i,railWidth:r,align:o}=this.attribute;e&&e.alwaysShow?this._tooltipState={value:this._currentValue.startValue,pos:this._currentValue.startPos}:this._tooltipState=null;const n=this._isHorizontal?0:r/2,s=this._isHorizontal?i/2:0;if(e&&e.shape){const t=hh.symbol(Object.assign({pickable:!1,visible:!!this._tooltipState,x:n,y:s,symbolType:"circle"},e.shapeStyle));this._tooltipShape=t,this._mainContainer.add(t)}const a=e&&e.text||{},l=null!==(t=a.space)&&void 0!==t?t:6,h={pickable:!1,visible:!!this._tooltipState,text:""};this._isHorizontal?(h.x=n,h.y="top"===o?s-i/2-l:s+i/2+l,h.textAlign="center",h.textBaseline="top"===o?"bottom":"top"):(h.y=s,h.x="left"===o?n-r/2-l:s+r/2+l,h.textAlign="left"===o?"end":"start",h.textBaseline="middle");const c=hh.text(Object.assign(Object.assign({},h),a.style));this._mainContainer.add(c),this._tooltipText=c,this._tooltipState&&this._updateTooltip()}_updateTooltip(){var t,e;if(!this._tooltipShape&&!this._tooltipText||!this._tooltipState)return;const{railWidth:i,railHeight:r}=this.attribute,o=this._isHorizontal?i:r,n=this._tooltipState.pos*o,s=this._isHorizontal?"x":"y";this._tooltipShape&&this._tooltipShape.setAttributes({visible:!0,[s]:n});const{align:a}=this.attribute;if(this._tooltipText){const i=this.attribute.tooltip&&this.attribute.tooltip.text||{};this._tooltipText.setAttributes({visible:!0,[s]:n,text:i.formatter?i.formatter(this._tooltipState.value):this._isHorizontal||"left"!==a?`≈ ${this._tooltipState.value.toFixed(null!==(e=i.precision)&&void 0!==e?e:0)}`:`${this._tooltipState.value.toFixed(null!==(t=i.precision)&&void 0!==t?t:0)} ≈`})}}_bindEvents(){if(this.attribute.disableTriggerEvent)return;const{slidable:t,range:e}=this.attribute;t&&(this._startHandler&&this._startHandler.addEventListener("pointerdown",this._onHandlerPointerdown),this._startHandlerText&&this._startHandlerText.addEventListener("pointerdown",this._onHandlerPointerdown),this._endHandler&&this._endHandler.addEventListener("pointerdown",this._onHandlerPointerdown),this._endHandlerText&&this._endHandlerText.addEventListener("pointerdown",this._onHandlerPointerdown),q(e)&&e.draggableTrack&&this._track.addEventListener("pointerdown",this._onTrackPointerdown),this._railContainer.addEventListener("pointerdown",this._onRailPointerDown))}_bindTooltipEvents(){this.attribute.disableTriggerEvent||(this._mainContainer.addEventListener("pointerenter",this._onTooltipShow),this._mainContainer.addEventListener("pointermove",this._onTooltipUpdate),this._mainContainer.addEventListener("pointerleave",this._onTooltipHide))}_updateTrack(){const{inverse:t,railWidth:e,railHeight:i}=this.attribute,r=this._startHandler,o=this._endHandler;if(this._isHorizontal){const i=null==r?void 0:r.attribute.x;if(o){const t=null==o?void 0:o.attribute.x;this._track.setAttributes({x:Math.min(i,t),width:Math.abs(i-t)})}else t?this._track.setAttributes({x:i,width:e-i}):this._track.setAttributes({width:i})}else{const e=null==r?void 0:r.attribute.y;if(o){const t=null==o?void 0:o.attribute.y;this._track.setAttributes({y:Math.min(e,t),height:Math.abs(e-t)})}else t?this._track.setAttributes({y:e,height:i-e}):this._track.setAttributes({height:e})}}_updateHandler(t,e,i){var r;const o=this._isHorizontal;t.setAttribute(o?"x":"y",e);const n=t.name===e_.startHandler?this._startHandlerText:this._endHandlerText;if(n){const{handlerText:t={}}=this.attribute;n.setAttributes({text:t.formatter?t.formatter(i):i.toFixed(null!==(r=t.precision)&&void 0!==r?r:0),[o?"x":"y"]:e})}t.name===e_.startHandler?(this._currentValue.startValue=i,this._currentValue.startPos=e):(this._currentValue.endValue=i,this._currentValue.endPos=e)}_updateHandlerText(t,e,i){var r;const o=this._isHorizontal,{handlerText:n={}}=this.attribute;t.setAttributes({[o?"x":"y"]:e,text:n.formatter?n.formatter(i):i.toFixed(null!==(r=n.precision)&&void 0!==r?r:0)});const s=t.name===e_.startHandlerText?this._startHandler:this._endHandler;s&&s.setAttributes({[o?"x":"y"]:e}),t.name===e_.startHandlerText?(this._currentValue.startValue=i,this._currentValue.startPos=e):(this._currentValue.endValue=i,this._currentValue.endPos=e)}_dispatchChangeEvent(){const t=!!this.attribute.range,e=this._currentValue;this._dispatchEvent("change",{value:t?[Math.min(e.endValue,e.startValue),Math.max(e.endValue,e.startValue)]:e.startValue,position:t?[Math.min(e.endPos,e.startPos),Math.max(e.endPos,e.startPos)]:e.startPos})}_dispatchTooltipEvent(t){this._dispatchEvent("sliderTooltip",{type:t,position:this._tooltipState&&this._tooltipState.pos,value:this._tooltipState&&this._tooltipState.value})}_getHandlers(){const{inverse:t}=this.attribute;let e=this._startHandler,i=this._endHandler;return i?(this._isHorizontal?(!t&&i.attribute.x<(null==e?void 0:e.attribute.x)||t&&i.attribute.x>(null==e?void 0:e.attribute.x))&&([e,i]=[i,e]):(!t&&i.attribute.y<(null==e?void 0:e.attribute.y)||t&&i.attribute.y>(null==e?void 0:e.attribute.y))&&([e,i]=[i,e]),{startHandler:e,endHandler:i}):{startHandler:e,endHandler:i}}}o_.defaultAttributes={slidable:!0,layout:"horizontal",align:"bottom",height:8,showHandler:!0,handlerSize:14,handlerStyle:{symbolType:"circle",fill:"#fff",stroke:"#91caff",lineWidth:2},tooltip:{shapeStyle:{symbolType:"circle",fill:"#fff",stroke:"#91caff",lineWidth:2},text:{style:{fill:"#2C3542",fontSize:12}}},railStyle:{fill:"rgba(0,0,0,.04)"},trackStyle:{fill:"#91caff"},showValue:!0,valueStyle:{fill:"#2C3542",fontSize:12},startText:{style:{fill:"#2C3542",fontSize:12}},endText:{style:{fill:"#2C3542",fontSize:12}},handlerText:{visible:!0,space:4,precision:0,style:{fill:"#2C3542",fontSize:12}}},sx(),nx();class n_ extends ox{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:wt({},n_.defaultAttributes,t)),this.name="colorLegend",this._onSliderToolipChange=t=>{const e=this._slider.tooltipShape;if(e&&t.detail&&!X(t.detail.value)){const i=this._colorScale.scale(t.detail.value);e.setAttribute("fill",i)}this.dispatchEvent(t)},this._onSliderChange=t=>{this._updateColor(),this.dispatchEvent(t)}}setSelected(t){this._slider&&(this._slider.setValue(t),this._updateColor())}_renderContent(){const{colors:t,slidable:e,layout:i,align:r,min:o,max:n,value:s,railWidth:a,railHeight:l,showHandler:h=!0,handlerSize:c,handlerStyle:d,railStyle:u,trackStyle:g,startText:p,endText:f,handlerText:m,showTooltip:b,tooltip:y,inverse:C,disableTriggerEvent:w}=this.attribute,v=[],x=(n-o)/(t.length-1);for(let e=0;e<t.length;e++)v.push(o+x*e);this._colorScale=(new t_).domain(v,!0).range(t),this._color=this._getTrackColor();const _=new o_({x:0,y:0,range:{draggableTrack:!0},slidable:e,layout:i,align:r,min:o,max:n,value:s,railWidth:a,railHeight:l,showHandler:h,handlerSize:c,handlerStyle:d,railStyle:u,trackStyle:Object.assign({fill:this._color},g),startText:p,endText:f,handlerText:m,showTooltip:b,tooltip:y,disableTriggerEvent:w,inverse:C});this._innerView.add(_),this._slider=_,_.translateTo(0-_.AABBBounds.x1,(this._title?this._title.AABBBounds.height()+gt(this.attribute,"title.space",12):0)-_.AABBBounds.y1),this._updateColor()}_bindEvents(){this.attribute.disableTriggerEvent||this._slider&&(this._slider.addEventListener("change",this._onSliderChange),this._slider.addEventListener("sliderTooltip",this._onSliderToolipChange))}_getTrackColor(){const{colors:t,layout:e,inverse:i}=this.attribute;if(ut(t))return;const r=t.length;if(1===r)return t[0];const o=[];for(let e=0;e<r;e++){const i=e/(r-1);o.push({offset:i,color:t[e]})}const n="horizontal"===e,s={gradient:"linear",stops:o,x0:0,y0:0,x1:n?1:0,y1:n?0:1};return i&&(n?(s.x0=1,s.x1=0):(s.y0=1,s.y1=0)),s}_updateColor(){const{layout:t="horizontal",colors:e,railWidth:i,railHeight:r}=this.attribute,{startHandler:o,endHandler:n,track:s}=this._slider,{startValue:a,endValue:l,startPos:h,endPos:c}=this._slider.currentValue,d=this._colorScale.scale(a),u=this._colorScale.scale(l);null==o||o.setAttribute("fill",d),null==n||n.setAttribute("fill",u);const g="horizontal"===t?i:r;if(Math.abs(h-c)!==g&&e&&e.length>1){const t=this._color.stops,e=Math.min(h,c),i=Math.max(h,c),r=e/g,o=i/g,n=o-r,d=t.filter((t=>t.offset>r&&t.offset<o)),u=Math.min(a,l),p=Math.max(a,l),f=this._colorScale.scale(u),m=this._colorScale.scale(p),b=[{offset:0,color:f}];d.forEach((t=>{b.push({offset:(t.offset-r)/n,color:t.color})})),b.push({offset:1,color:m}),s.setAttribute("fill",Object.assign(Object.assign({},this._color),{stops:b}))}}}function s_(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"bottom",e=0;return"top"===t?`\n    M${e},-6L${e-3.5},-2.5\n    v5\n    h7\n    v-5\n    Z\n`:"left"===t?(e=1,`\n    M${e-6},0L${e-6+2.5},-3.5\n    h5\n    v7\n    h-5\n    Z\n`):"right"===t?(e=-1,`\n    M${e+6},0L${e+6-2.5},-3.5\n    h-5\n    v7\n    h5\n    Z\n  `):`\n    M${e},6L${e-3.5},2.5\n    v-5\n    h7\n    v5\n    Z\n`}n_.defaultAttributes={layout:"horizontal",title:{align:"start",space:12,textStyle:{fontSize:12,fontWeight:"bold",fill:"rgba(46, 47, 50, 1)"}},handlerSize:10,handlerStyle:{lineWidth:4,stroke:"#fff",outerBorder:{distance:2,lineWidth:1,stroke:"#ccc"}},tooltip:{shapeStyle:{lineWidth:4,stroke:"#fff"}}},sx(),nx(),Ly();class a_ extends ox{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:wt({},a_.defaultAttributes,t)),this.name="sizeLegend",this._onSliderChange=t=>{this.dispatchEvent(t)},this._onSliderToolipChange=t=>{this.dispatchEvent(t)}}setSelected(t){this._slider&&this._slider.setValue(t)}_renderContent(){const{slidable:t,layout:e,align:i,min:r,max:o,value:n,railWidth:s,railHeight:a,showHandler:l=!0,handlerSize:h,handlerStyle:c,railStyle:d,trackStyle:u,startText:g,endText:p,handlerText:f,showTooltip:m,tooltip:b,sizeBackground:y,disableTriggerEvent:C,inverse:w}=this.attribute,v=hh.group({x:0,y:0});this._innerView.add(v);const x=new o_({x:0,y:0,zIndex:1,range:{draggableTrack:!0},slidable:t,layout:e,align:i,min:r,max:o,value:n,railWidth:s,railHeight:a,showHandler:l,handlerSize:h,handlerStyle:Object.assign({symbolType:s_(i)},c),railStyle:d,trackStyle:u,startText:g,endText:p,handlerText:f,showTooltip:m,tooltip:b,disableTriggerEvent:C,inverse:w});v.add(x);let _,S=0;"horizontal"===e?"top"===i?(_=`M0,0L${s},0L${w?0:s},12Z`,S=a):(_=`M0,12L${s},12L${w?0:s},0Z`,x.setAttribute("y",12)):"left"===i?_=`M${s},0L${s+12},${w?0:a}L${s},${a}Z`:(_=`M0,${w?0:a}L12,${a}L12,0Z`,x.setAttribute("x",12));const A=hh.path(Object.assign(Object.assign({x:0,y:S,path:_},y),{zIndex:0}));v.add(A);const R=this._title?this._title.AABBBounds.height()+gt(this.attribute,"title.space",12):0;v.translate(0-v.AABBBounds.x1,R-v.AABBBounds.y1),this._slider=x}_bindEvents(){this.attribute.disableTriggerEvent||this._slider&&(this._slider.addEventListener("change",this._onSliderChange),this._slider.addEventListener("sliderTooltip",this._onSliderToolipChange))}}a_.defaultAttributes={layout:"horizontal",title:{align:"start",space:12,textStyle:{fontSize:12,fontWeight:"bold",fill:"rgba(46, 47, 50, 1)"}},handlerSize:10,handlerStyle:{lineWidth:1,stroke:"#ccc",fill:"#fff"},sizeBackground:{fill:"rgba(20,20,20,0.1)"}},My(),qy(),Vy();let l_=class t extends ov{constructor(e,i){super((null==i?void 0:i.skipDefault)?e:wt({},t.defaultAttributes,e)),this.name="title"}render(){var t,e,i,r,o,n,s,a,l,h,c,d,u,g,p,f,m,b,y,C,w,v,x,_,S,A,R,B,M,T,P,H,E,k,L,F,I,z,O,D,W,N;const{textType:G,text:j,subtextType:V,textStyle:U={},subtext:K,subtextStyle:$={},width:X,height:q,minWidth:Z,maxWidth:J,minHeight:Q,maxHeight:tt,align:it,verticalAlign:rt,padding:ot=0}=this.attribute,nt=Ze(ot),st=this.createOrUpdateChild("title-container",{x:nt[3],y:nt[0],zIndex:1},"group");if(!1!==this.attribute.visible&&!1!==U.visible)if("rich"===G||Y(U.character)){const h=Object.assign({x:null!==(t=U.x)&&void 0!==t?t:0,y:null!==(e=U.y)&&void 0!==e?e:0,width:null!==(r=null!==(i=U.width)&&void 0!==i?i:X)&&void 0!==r?r:0,height:null!==(n=null!==(o=U.height)&&void 0!==o?o:q)&&void 0!==n?n:0,ellipsis:null===(s=U.ellipsis)||void 0===s||s,wordBreak:null!==(a=U.wordBreak)&&void 0!==a?a:"break-word",maxHeight:U.maxHeight,maxWidth:U.maxWidth,textConfig:null!==(l=U.character)&&void 0!==l?l:j},U);this._mainTitle=st.createOrUpdateChild("mainTitle",h,"richtext")}else if("html"===G){const t=Object.assign({html:Object.assign(Object.assign({dom:j},lv),U),x:null!==(h=U.x)&&void 0!==h?h:0,y:null!==(c=U.y)&&void 0!==c?c:0,width:null!==(u=null!==(d=U.width)&&void 0!==d?d:X)&&void 0!==u?u:0,height:null!==(p=null!==(g=U.height)&&void 0!==g?g:q)&&void 0!==p?p:0,ellipsis:null===(f=U.ellipsis)||void 0===f||f,wordBreak:null!==(m=U.wordBreak)&&void 0!==m?m:"break-word",maxHeight:U.maxHeight,maxWidth:U.maxWidth,textConfig:[]},U);this._mainTitle=st.createOrUpdateChild("mainTitle",t,"richtext")}else Y(j)&&(this._mainTitle=st.createOrUpdateChild("mainTitle",Object.assign(Object.assign({text:et(j)?j:[j],wrap:!0},U),{maxLineWidth:null!==(b=U.maxLineWidth)&&void 0!==b?b:X,heightLimit:U.heightLimit,lineClamp:U.lineClamp,ellipsis:null===(y=U.ellipsis)||void 0===y||y,x:0,y:0}),"text"));const at=this._mainTitle?this._mainTitle.AABBBounds.height():0,lt=this._mainTitle?this._mainTitle.AABBBounds.width():0;if(!1!==this.attribute.visible&&!1!==$.visible)if("rich"===V||Y($.character)){const t=Object.assign({x:null!==(C=$.x)&&void 0!==C?C:0,y:null!==(w=$.y)&&void 0!==w?w:0,width:null!==(x=null!==(v=$.width)&&void 0!==v?v:X)&&void 0!==x?x:0,height:null!==(S=null!==(_=$.height)&&void 0!==_?_:q)&&void 0!==S?S:0,ellipsis:null===(A=$.ellipsis)||void 0===A||A,wordBreak:null!==(R=$.wordBreak)&&void 0!==R?R:"break-word",maxHeight:$.maxHeight,maxWidth:$.maxWidth,textConfig:null!==(B=$.character)&&void 0!==B?B:K},$);this._subTitle=st.createOrUpdateChild("subTitle",t,"richtext")}else if("html"===V){const t=Object.assign({html:Object.assign(Object.assign({dom:K},lv),$),x:null!==(M=$.x)&&void 0!==M?M:0,y:null!==(T=$.y)&&void 0!==T?T:0,width:null!==(H=null!==(P=$.width)&&void 0!==P?P:X)&&void 0!==H?H:0,height:null!==(k=null!==(E=$.height)&&void 0!==E?E:q)&&void 0!==k?k:0,ellipsis:null===(L=$.ellipsis)||void 0===L||L,wordBreak:null!==(F=$.wordBreak)&&void 0!==F?F:"break-word",maxHeight:$.maxHeight,maxWidth:$.maxWidth,textConfig:[]},$);this._subTitle=st.createOrUpdateChild("subTitle",t,"richtext")}else Y(K)&&(this._subTitle=st.createOrUpdateChild("subTitle",Object.assign(Object.assign({text:et(K)?K:[K],wrap:!0},$),{maxLineWidth:null!==(I=$.maxLineWidth)&&void 0!==I?I:X,heightLimit:$.heightLimit,lineClamp:$.lineClamp,ellipsis:null===(z=$.ellipsis)||void 0===z||z,x:0,y:at}),"text"));const ht=this._subTitle?this._subTitle.AABBBounds.height():0,ct=this._subTitle?this._subTitle.AABBBounds.width():0;let dt=Math.max(lt,ct),ut=at+(null!==(O=$.height)&&void 0!==O?O:ht);if(Y(X)&&(dt=X,this._mainTitle&&this._mainTitle.setAttribute("maxLineWidth",X),this._subTitle&&this._subTitle.setAttribute("maxLineWidth",X)),Y(q)&&(ut=q),Y(Z)&&dt<Z&&(dt=Z),Y(J)&&(this._mainTitle&&this._mainTitle.setAttribute("maxLineWidth",J),this._subTitle&&this._subTitle.setAttribute("maxLineWidth",J),this._mainTitle&&this._mainTitle.setAttribute("maxWidth",J),this._subTitle&&this._subTitle.setAttribute("maxWidth",J),dt>J&&(dt=J)),Y(Q)&&ut<Q&&(ut=Q),Y(tt)&&(this._mainTitle&&this._mainTitle.setAttribute("maxHeight",tt),this._subTitle&&this._subTitle.setAttribute("maxHeight",tt-at),ut>tt&&(ut=tt)),st.attribute.width=dt,st.attribute.height=ut,st.attribute.boundsPadding=nt,this._mainTitle){if(Y(it)||Y(U.align)){const t=U.align?U.align:it,e=null!==(D=U.width)&&void 0!==D?D:lt;"left"===t?(this._mainTitle.setAttribute("x",0),this._mainTitle.setAttribute("textAlign","left")):"center"===t?(this._mainTitle.setAttribute("x",e/2),this._mainTitle.setAttribute("textAlign","center")):"right"===t&&(this._mainTitle.setAttribute("x",e),this._mainTitle.setAttribute("textAlign","right"))}if(Y(rt)||Y(U.verticalAlign)){const t=U.verticalAlign?U.verticalAlign:rt,e=U.height?U.height:ut;"top"===t?(this._mainTitle.setAttribute("y",0),this._mainTitle.setAttribute("textBaseline","top")):"middle"===t?(this._mainTitle.setAttribute("y",e/2),this._mainTitle.setAttribute("textBaseline","middle")):"bottom"===t&&(this._mainTitle.setAttribute("y",e),this._mainTitle.setAttribute("textBaseline","bottom"))}}if(this._subTitle){if(Y(it)||Y($.align)){const t=$.align?$.align:it,e=null!==(W=$.width)&&void 0!==W?W:ct;"left"===t?(this._subTitle.setAttribute("x",0),this._subTitle.setAttribute("textAlign","left")):"center"===t?(this._subTitle.setAttribute("x",e/2),this._subTitle.setAttribute("textAlign","center")):"right"===t&&(this._subTitle.setAttribute("x",e),this._subTitle.setAttribute("textAlign","right"))}if(Y(rt)||Y(U.verticalAlign)){const t=$.verticalAlign?$.verticalAlign:rt,e=at,i=null!==(N=$.height)&&void 0!==N?N:0;"top"===t?(this._subTitle.setAttribute("y",e),this._subTitle.setAttribute("textBaseline","top")):"middle"===t?(this._subTitle.setAttribute("y",e+i/2),this._subTitle.setAttribute("textBaseline","middle")):"bottom"===t&&(this._subTitle.setAttribute("y",e+i),this._subTitle.setAttribute("textBaseline","bottom"))}}}};l_.defaultAttributes={textStyle:{ellipsis:"...",fill:"#333",fontSize:20,fontWeight:"bold",textAlign:"left",textBaseline:"top"},subtextStyle:{ellipsis:"...",fill:"#6F6F6F",fontSize:16,fontWeight:"normal",textAlign:"left",textBaseline:"top"}};My(),Wy(),qy(),Py();class h_ extends ov{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:wt({},h_.defaultAttributes,t)),this._handlePointerUp=()=>{this.attribute.disabled||(this.attribute.checked?(this.setAttribute("checked",!1),this.setAttribute("indeterminate",!1)):(this.setAttribute("checked",!0),this.setAttribute("indeterminate",!1)),this._dispatchEvent("checkbox_state_change",{eventType:"checkbox_state_change",checked:this.attribute.checked}),this.stage.renderNextFrame())},this.renderGroup(),this.onBeforeAttributeUpdate=(t,e,i)=>{"interactive"in t&&this.setAttribute("pickable",t.interactive),"disabled"in t&&this.setAttribute("cursor",t.disable?this.attribute.disableCursor:this.attribute.cursor)},this.addEventListener("pointerup",this._handlePointerUp)}render(){this.removeAllChild(!0),this.renderBox(),this.renderIcon(),this.renderText(),this.layout()}renderBox(){this._box=new pl(wt({},this.attribute.box));const t=this.attribute.checked||this.attribute.indeterminate;t&&this.attribute.disabled?this._box.setAttributes({fill:this.attribute.box.disableCheckedFill,stroke:this.attribute.box.disableCheckedStroke}):t&&this._box.setAttributes({fill:this.attribute.box.checkedFill,stroke:this.attribute.box.checkedStroke}),this.appendChild(this._box)}renderIcon(){this._checkIcon=new Sl(wt({image:this.attribute.icon.checkIconImage},this.attribute.icon)),this.appendChild(this._checkIcon),this._indeterminateIcon=new Sl(wt({image:this.attribute.icon.indeterminateIconImage},this.attribute.icon)),this.appendChild(this._indeterminateIcon),this.attribute.checked?(this._checkIcon.setAttribute("visible",!0),this._indeterminateIcon.setAttribute("visible",!1)):this.attribute.indeterminate?(this._checkIcon.setAttribute("visible",!1),this._indeterminateIcon.setAttribute("visible",!0)):(this._checkIcon.setAttribute("visible",!1),this._indeterminateIcon.setAttribute("visible",!1))}renderText(){this._text=new ta(wt({wrap:!0},this.attribute.text)),this.attribute.disabled&&this._text.setAttribute("fill",this.attribute.text.disableFill),this.appendChild(this._text)}renderGroup(){this.attribute.interactive||this.setAttribute("pickable",!1),this.attribute.disabled&&this.setAttribute("cursor",this.attribute.disableCursor)}layout(){const t=this.attribute.box.height,e=this.attribute.icon.height,i=this._text.AABBBounds.height(),r=Math.max(t,e,i),o=r/2-t/2,n=r/2-e/2,s=r/2-i/2,a=this.attribute.box.width,l=this.attribute.icon.width,h=Math.max(a,l),c=h/2-a/2,d=h/2-l/2,u=h+this.attribute.spaceBetweenTextAndIcon;this._box.setAttributes({x:c,y:o}),this._checkIcon.setAttributes({x:d,y:n}),this._indeterminateIcon.setAttributes({x:d,y:n}),this._text.setAttributes({x:u,y:s})}}h_.defaultAttributes={interactive:!0,disabled:!1,checked:!1,indeterminate:!1,cursor:"pointer",disableCursor:"not-allowed",spaceBetweenTextAndIcon:8,text:{text:"text",fontSize:14,fill:"#000",disableFill:"rgb(201,205,212)",textBaseline:"top",pickable:!1},icon:{checkIconImage:'<svg width="200" height="200" viewBox="0 0 1024 1024" fill="#fff" xmlns="http://www.w3.org/2000/svg"><path d="M877.44815445 206.10060629a64.72691371 64.72691371 0 0 0-95.14856334 4.01306852L380.73381888 685.46812814 235.22771741 533.48933518a64.72691371 64.72691371 0 0 0-92.43003222-1.03563036l-45.82665557 45.82665443a64.72691371 64.72691371 0 0 0-0.90617629 90.61767965l239.61903446 250.10479331a64.72691371 64.72691371 0 0 0 71.19960405 15.14609778 64.33855261 64.33855261 0 0 0 35.08198741-21.23042702l36.24707186-42.71976334 40.5190474-40.77795556-3.36579926-3.49525333 411.40426297-486.74638962a64.72691371 64.72691371 0 0 0-3.88361443-87.64024149l-45.3088404-45.43829334z"></path></svg>',indeterminateIconImage:'<svg width="200" height="200" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none"><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="5" d="M5 12h14"/></svg>',width:10,height:10,pickable:!1},box:{width:14,height:14,cornerRadius:2,fill:"#fff",stroke:"rgb(229,230,235)",disableFill:"rgb(242,243,245)",checkedFill:"rgb(22, 93, 255)",checkedStroke:"rgb(22, 93, 255)",disableCheckedFill:"rgb(148, 191, 255)",disableCheckedStroke:"rgb(148, 191, 255)",pickable:!1}},My(),Wy(),Jy(),Py();class c_ extends ov{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:wt({},c_.defaultAttributes,t)),this._handlePointerUp=()=>{this.attribute.disabled||this.attribute.checked||(this.setAttribute("checked",!0),this._dispatchEvent("radio_checked",{eventType:"radio_checked",target:this}),this.stage.renderNextFrame())},this.renderGroup(),this.onBeforeAttributeUpdate=(t,e,i)=>{"interactive"in t&&this.setAttribute("pickable",t.interactive),"disabled"in t&&this.setAttribute("cursor",t.disable?this.attribute.disableCursor:this.attribute.cursor)},this.addEventListener("pointerup",this._handlePointerUp)}render(){this.removeAllChild(!0),this.renderCircle(),this.renderText(),this.layout()}renderCircle(){this._circle=new Dl(wt({},this.attribute.circle));const t=this.attribute.checked;t&&this.attribute.disabled?this._circle.setAttributes({fill:this.attribute.circle.disableCheckedFill,stroke:this.attribute.circle.disableCheckedStroke}):t&&this._circle.setAttributes({fill:this.attribute.circle.checkedFill,stroke:this.attribute.circle.checkedStroke}),this.appendChild(this._circle)}renderText(){this._text=new ra(wt({},this.attribute.text)),this.attribute.disabled&&this._text.setAttribute("fill",this.attribute.text.disableFill),this.appendChild(this._text)}renderGroup(){this.attribute.interactive||this.setAttribute("pickable",!1),this.attribute.disabled&&this.setAttribute("cursor",this.attribute.disableCursor)}layout(){const t=2*(this.attribute.circle.outerRadius+this.attribute.circle.lineWidth),e=this._text.AABBBounds.height(),i=Math.max(t,e),r=i/2-t/2+this.attribute.circle.outerRadius+this.attribute.circle.lineWidth,o=i/2-e/2,n=2*(this.attribute.circle.outerRadius+this.attribute.circle.lineWidth),s=this.attribute.circle.outerRadius+this.attribute.circle.lineWidth,a=n+this.attribute.spaceBetweenTextAndIcon;this._circle.setAttributes({x:s,y:r}),this._text.setAttributes({x:a,y:o})}}function d_(t){const e={...t};return ut(t.style)||(e.textStyle=u_(t.style)),ut(t.textStyle)||wt(e.textStyle,u_(t.textStyle)),t.shape?.style&&u_(e.shape.style),t.background?.style&&u_(e.background.style),e}function u_(t){return ut(t)||t.angle&&(t.angle=ge(t.angle)),t}function g_(t={}){return ut(t.style)||(t.style=u_(t.style)),ut(t.state)||Object.keys(t.state).forEach((e=>{ut(t.state[e])||(t.state[e]=u_(t.state[e]))})),t}function p_(t){return ut(t)?null:(Object.keys(t).forEach((e=>{ut(t[e])||(t[e]=u_(t[e]))})),t)}c_.defaultAttributes={interactive:!0,disabled:!1,checked:!1,cursor:"pointer",disableCursor:"not-allowed",spaceBetweenTextAndIcon:8,text:{text:"text",fontSize:14,fill:"#000",disableFill:"rgb(201,205,212)",textBaseline:"top",pickable:!1},circle:{outerRadius:7,innerRadius:3,startAngle:0,endAngle:2*Math.PI,lineWidth:1,fill:"#fff",stroke:"rgb(229,230,235)",disableFill:"rgb(242,243,245)",checkedFill:"rgb(22, 93, 255)",checkedStroke:"rgb(22, 93, 255)",disableCheckedFill:"rgb(148, 191, 255)",disableCheckedStroke:"rgb(148, 191, 255)",pickable:!1}};const f_={left:{textAlign:"center",textBaseline:"bottom"},right:{textAlign:"center",textBaseline:"bottom"},radius:{},angle:{}},m_="PingFang SC,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif, apple color emoji,segoe ui emoji,segoe ui symbol",b_=14,y_={FONT_FAMILY:m_,LABEL_FONT_SIZE:b_,MAP_LABEL_FONT_SIZE:10,TITLE_FONT_SIZE:18,AXIS_TICK_SIZE:4},C_={domainLine:{visible:!0,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},grid:{visible:!0,style:{lineWidth:1,stroke:"#EBEDF2",strokeOpacity:1,lineDash:[]}},subGrid:{visible:!1,style:{lineWidth:1,stroke:"#EBEDF2",strokeOpacity:1,lineDash:[4,4]}},tick:{visible:!0,tickSize:y_.AXIS_TICK_SIZE,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},subTick:{visible:!1,tickSize:y_.AXIS_TICK_SIZE/2,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},label:{visible:!0,space:1,style:{fontSize:y_.LABEL_FONT_SIZE,fill:"#89909D",fontWeight:"normal",fillOpacity:1},autoLimit:!0},title:{space:10,style:{fontSize:y_.LABEL_FONT_SIZE,fill:"#333333",fontWeight:"normal",fillOpacity:1}}};function w_(t){const e=wt({},t);let i,r=e.title?.angle??0;"left"!==e.orient&&"right"!==e.orient||e.title?.autoRotate&&X(e.title.angle)&&(r="left"===e.orient?-90:90,i=f_[e.orient]);const o=function(t,e){if(!t||!J(t))return t;const i={};return Object.keys(t).forEach((r=>{const o=t[r];let n=!1;e.forEach((t=>{(tt(t)&&t===r||t instanceof RegExp&&r.match(t))&&(n=!0)})),n||(i[r]=o)})),i}(e.label,["style","formatMethod","state"]);return{orient:e.orient,select:e.select,hover:e.hover,line:(n=e.domainLine,g_(n),g_(n.startSymbol),g_(n.endSymbol),n),label:{style:u_(e.label.style),formatMethod:e.label.formatMethod?(t,i,r)=>e.label.formatMethod(i.rawValue,i):null,state:p_(e.label.state),...o},tick:{visible:e.tick.visible,length:e.tick.tickSize,inside:e.tick.inside,alignWithLabel:e.tick.alignWithLabel,style:u_(e.tick.style),state:p_(e.tick.state),dataFilter:e.tick.dataFilter},subTick:{visible:e.subTick.visible,length:e.subTick.tickSize,inside:e.subTick.inside,count:e.subTick.tickCount,style:u_(e.subTick.style),state:p_(e.subTick.state)},grid:{type:"line",visible:e.grid.visible,alternateColor:e.grid.alternateColor,alignWithLabel:e.grid.alignWithLabel,style:u_(e.grid.style)},subGrid:{type:"line",visible:e.subGrid.visible,alternateColor:e.subGrid.alternateColor,style:u_(e.subGrid.style)},title:{visible:e.title.visible,position:e.title.position,space:e.title.space,autoRotate:!1,angle:r?ge(r):null,textStyle:wt({},i,u_(e.title.style)),padding:e.title.padding,shape:{visible:e.title.shape?.visible,space:e.title.shape?.space,style:u_(e.title.shape?.style)},background:{visible:e.title.background?.visible,style:u_(e.title.background?.style)},state:{text:p_(e.title.state),shape:p_(e.title.shape?.state),background:p_(e.title.background?.state)}},panel:{visible:e.background?.visible,style:u_(e.background?.style),state:p_(e.background?.state)}};var n}function v_(t){return"bottom"===t||"top"===t}var x_;function __(t){switch(t){case x_.Linear:case x_.Log:case x_.Pow:case x_.Sqrt:case x_.Symlog:case x_.Time:return!0;default:return!1}}function S_(t){return t}!function(t){t.Identity="identity",t.Linear="linear",t.Log="log",t.Pow="pow",t.Sqrt="sqrt",t.Symlog="symlog",t.Time="time",t.Quantile="quantile",t.Quantize="quantize",t.Threshold="threshold",t.Ordinal="ordinal",t.Point="point",t.Band="band"}(x_||(x_={})),Object.values(x_).forEach((t=>{}));const A_=t=>-Math.log(-t),R_=t=>-Math.exp(-t),B_=t=>isFinite(t)?Math.pow(10,t):t<0?0:t,M_=t=>10===t?B_:t===Math.E?Math.exp:e=>Math.pow(t,e),T_=t=>t===Math.E?Math.log:10===t?Math.log10:2===t?Math.log2:(t=Math.log(t),e=>Math.log(e)/t),P_=t=>e=>Math.sign(e)*Math.log1p(Math.abs(e/t)),H_=t=>e=>Math.sign(e)*Math.expm1(Math.abs(e))*t;function E_(t,e){if(t=Number(t),e=Number(e),e-=t)return i=>(i-t)/e;const i=Number.isNaN(e)?NaN:.5;return()=>i}function k_(t,e,i){const r=t[0],o=t[1],n=e[0],s=e[1];let a,l;return o<r?(a=E_(o,r),l=i(s,n)):(a=E_(r,o),l=i(n,s)),t=>l(a(t))}function L_(t,e,i){let r;return r=1===t?t+2*i:t-e+2*i,t?r>0?r:1:0}function F_(t,e){const i=(t[1]-t[0])/(e[1]-e[0]),r=t[0]-i*e[0];return[r,i+r]}function I_(t,e,i){const r=Math.min(t.length,e.length)-1,o=new Array(r),n=new Array(r);let s=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++s<r;)o[s]=E_(t[s],t[s+1]),n[s]=i(e[s],e[s+1]);return function(e){const i=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;for(X(r)&&(r=t.length);i<r;){const o=i+r>>>1;Ht(t[o],e)>0?r=o:i=o+1}return i}(t,e,1,r)-1;return n[i](o[i](e))}}const z_=(t,e)=>{const i=t.slice();let r=0,o=i.length-1,n=i[r],s=i[o];return s<n&&([r,o]=[o,r],[n,s]=[s,n]),i[r]=e.floor(n),i[o]=e.ceil(s),i},O_=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=Math.floor(Math.log10(t)),r=t/Math.pow(10,i);let o;return o=e?r<1.5?1:r<3?2:r<7?5:10:r<=1?1:r<=2?2:r<=5?5:10,o*Math.pow(10,i)};class D_{constructor(){this._rangeFactorStart=null,this._rangeFactorEnd=null}_calculateWholeRange(t){return this._wholeRange?this._wholeRange:Y(this._rangeFactorStart)&&Y(this._rangeFactorEnd)&&2===t.length?(this._wholeRange=F_(t,[this._rangeFactorStart,this._rangeFactorEnd]),this._wholeRange):t}rangeFactor(t,e,i){return t?(2===t.length&&t.every((t=>t>=0&&t<=1))&&(this._wholeRange=null,0===t[0]&&1===t[1]?(this._rangeFactorStart=null,this._rangeFactorEnd=null):(this._rangeFactorStart=t[0],this._rangeFactorEnd=t[1])),this):i?(this._wholeRange=null,this._rangeFactorStart=null,this._rangeFactorEnd=null,this):Y(this._rangeFactorStart)&&Y(this._rangeFactorEnd)?[this._rangeFactorStart,this._rangeFactorEnd]:null}rangeFactorStart(t,e){var i;return X(t)?this._rangeFactorStart:(t>=0&&t<=1&&(this._wholeRange=null,0!==t||!X(this._rangeFactorEnd)&&1!==this._rangeFactorEnd?(this._rangeFactorStart=t,this._rangeFactorEnd=null!==(i=this._rangeFactorEnd)&&void 0!==i?i:1):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}rangeFactorEnd(t,e){var i;return X(t)?this._rangeFactorEnd:(t>=0&&t<=1&&(this._wholeRange=null,0!==t||!X(this._rangeFactorStart)&&0!==this._rangeFactorStart?(this._rangeFactorEnd=t,this._rangeFactorStart=null!==(i=this._rangeFactorStart)&&void 0!==i?i:0):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}generateFishEyeTransform(){var t;if(!this._fishEyeOptions)return void(this._fishEyeTransform=null);const{distortion:e=2,radiusRatio:i=.1,radius:r}=this._fishEyeOptions,o=this.range(),n=o[0],s=o[o.length-1],a=Math.min(n,s),l=Math.max(n,s),h=Dt(null!==(t=this._fishEyeOptions.focus)&&void 0!==t?t:0,a,l),c=X(r)?(l-a)*i:r;let d=Math.exp(e);d=d/(d-1)*c;const u=e/c;this._fishEyeTransform=t=>{const e=Math.abs(t-h);if(e>=c)return t;if(e<=1e-6)return h;const i=d*(1-Math.exp(-e*u))/e*.75+.25;return h+(t-h)*i}}unknown(t){return arguments.length?(this._unknown=t,this):this._unknown}}const W_=Symbol("implicit");class N_ extends D_{specified(t){var e;return t?(this._specified=Object.assign(null!==(e=this._specified)&&void 0!==e?e:{},t),this):Object.assign({},this._specified)}_getSpecifiedValue(t){if(this._specified)return this._specified[t]}constructor(){super(),this.type=x_.Ordinal,this._index=new Map,this._domain=[],this._ordinalRange=[],this._unknown=W_}clone(){const t=(new N_).domain(this._domain).range(this._ordinalRange).unknown(this._unknown);return this._specified&&t.specified(this._specified),t}calculateVisibleDomain(t){return Y(this._rangeFactorStart)&&Y(this._rangeFactorEnd)&&2===t.length?[this.invert(t[0]),this.invert(t[1])]:this._domain}scale(t){const e=`${t}`,i=this._getSpecifiedValue(e);if(void 0!==i)return i;let r=this._index.get(e);if(!r){if(this._unknown!==W_)return this._unknown;r=this._domain.push(t),this._index.set(e,r)}const o=this._ordinalRange[(r-1)%this._ordinalRange.length];return this._fishEyeTransform?this._fishEyeTransform(o):o}invert(t){let e=0;for(;e<this._ordinalRange.length&&this._ordinalRange[e]!==t;)e++;return this._domain[(e-1)%this._domain.length]}domain(t){if(!t)return this._domain.slice();this._domain=[],this._index=new Map;for(const e of t){const t=`${e}`;this._index.has(t)||this._index.set(t,this._domain.push(e))}return this}range(t){if(!t)return this._ordinalRange.slice();const e=Array.from(t);return this._ordinalRange=e,this}index(t){var e;return this._index&&null!==(e=this._index.get(`${t}`))&&void 0!==e?e:-1}}function G_(t,e,i,r){let o;const n=[];let s;if(e=Math.floor(+e),t=Math.floor(+t),!(i=Math.floor(+i)))return[];if(t===e)return[t];if(o=e<t){const i=t;t=e,e=i}let a=Nt(1,e-t+1)(i);if(s=Math.floor((e-t+1)/a),!r)for(;Math.ceil((e-t+1)/s)>i&&a>1;)a-=1,s=Math.floor((e-t)/a);let l=t;for(;l<=e;)n.push(l),l+=s;return o&&n.reverse(),n}class j_ extends N_{constructor(t){super(),this.type=x_.Band,this._range=[0,1],this._step=void 0,this._bandwidth=void 0,this._isFixed=!1,this._round=!1,this._paddingInner=0,this._paddingOuter=0,this._align=.5,this._unknown=void 0,delete this.unknown,this.rescale(t)}rescale(t,e){if(t)return this;this._wholeRange=null;const i=this._calculateWholeRange(this._range,e),r=super.domain().length,o=i[1]<i[0];let n=i[Number(o)-0];const s=i[1-Number(o)],a=L_(r,this._paddingInner,this._paddingOuter);return this._step=(s-n)/Math.max(1,a||1),this._round&&(this._step=Math.floor(this._step)),n+=(s-n-this._step*(r-this._paddingInner))*this._align,this.isBandwidthFixed()||(this._bandwidth=this._step*(1-this._paddingInner)),this._round&&(n=Math.round(n),this.isBandwidthFixed()||(this._bandwidth=Math.round(this._bandwidth))),this._bandRangeState={reverse:o,start:o?n+this._step*(r-1):n,count:r},this.generateFishEyeTransform(),this}scale(t){if(!this._bandRangeState)return;const e=`${t}`,i=this._getSpecifiedValue(e);if(void 0!==i)return i;let r=this._index.get(e);if(!r){if(this._unknown!==W_)return this._unknown;r=this._domain.push(t),this._index.set(e,r)}const{count:o,start:n,reverse:s}=this._bandRangeState,a=n+(r-1)%o*(s?-1:1)*this._step;return this._fishEyeTransform?this._fishEyeTransform(a):a}_calculateWholeRange(t,e){if(this._wholeRange)return this._wholeRange;if((this._minBandwidth||this._maxBandwidth)&&!this._isBandwidthFixedByUser()){let e;if(Y(this._rangeFactorStart)&&Y(this._rangeFactorEnd)&&2===t.length){const i=F_(t,[this._rangeFactorStart,this._rangeFactorEnd]);e=Math.abs(i[1]-i[0])}else e=Math.abs(t[1]-t[0]);const i=function(t,e,i,r,o){const n=L_(t,i,r);let s=e/Math.max(1,n||1);o&&(s=Math.floor(s));let a=s*(1-i);return o&&(a=Math.round(a)),a}(super.domain().length,e,this._paddingInner,this._paddingOuter,this._round);i<this._minBandwidth?(this._bandwidth=this._minBandwidth,this._isFixed=!0):i>this._maxBandwidth?(this._bandwidth=this._maxBandwidth,this._isFixed=!0):(this._bandwidth=i,this._isFixed=!1)}if(this.isBandwidthFixed()){const s=(i=super.domain().length,r=this._bandwidth,o=this._paddingInner,n=this._paddingOuter,1===o&&(o=0),L_(i,o,n)*(r/(1-o))*Math.sign(t[1]-t[0])),a=Math.min((t[1]-t[0])/s,1);if(Y(this._rangeFactorStart)&&Y(this._rangeFactorEnd)){if(s>0){const e=t[0]-s*this._rangeFactorStart,i=e+s;this._wholeRange=[e,i]}else{const e=t[1]+s*(1-this._rangeFactorEnd),i=e-s;this._wholeRange=[i,e]}const i=this._rangeFactorStart+a<=1,r=this._rangeFactorEnd-a>=0;"rangeFactorStart"===e&&i?this._rangeFactorEnd=this._rangeFactorStart+a:"rangeFactorEnd"===e&&r?this._rangeFactorStart=this._rangeFactorEnd-a:t[0]<=t[1]?i?this._rangeFactorEnd=this._rangeFactorStart+a:r?this._rangeFactorStart=this._rangeFactorEnd-a:(this._rangeFactorStart=0,this._rangeFactorEnd=a):r?this._rangeFactorStart=this._rangeFactorEnd-a:i?this._rangeFactorEnd=this._rangeFactorStart+a:(this._rangeFactorStart=1-a,this._rangeFactorEnd=1)}else this._rangeFactorStart=0,this._rangeFactorEnd=a,this._wholeRange=[t[0],t[0]+s];return this._wholeRange}var i,r,o,n;return super._calculateWholeRange(t)}calculateWholeRangeSize(){const t=this._calculateWholeRange(this._range);return Math.abs(t[1]-t[0])}calculateVisibleDomain(t){const e=this._domain;if(Y(this._rangeFactorStart)&&Y(this._rangeFactorEnd)&&e.length){const i=this._getInvertIndex(t[0]),r=this._getInvertIndex(t[1]);return e.slice(Math.min(i,r),Math.max(i,r)+1)}return e}domain(t,e){return t?(super.domain(t),this.rescale(e)):super.domain()}range(t,e){return t?(this._range=[Et(t[0]),Et(t[1])],this.rescale(e)):this._range}rangeRound(t,e){return this._range=[Et(t[0]),Et(t[1])],this._round=!0,this.rescale(e)}ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return-1===t?e:G_(0,e.length-1,t,!1).map((t=>e[t]))}tickData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this.ticks(t).map(((t,e)=>({index:e,tick:t,value:(this.scale(t)-this._range[0]+this._bandwidth/2)/(this._range[1]-this._range[0])})))}forceTicks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return G_(0,e.length-1,t,!0).filter((t=>t<e.length)).map((t=>e[t]))}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return function(t,e,i){const r=[];let o;if(i=Nt(1,(e=Math.floor(+e))-(t=Math.floor(+t))+1)(Math.floor(+i)),o=e<t){const i=t;t=e,e=i}let n=t;for(;n<=e;)r.push(n),n+=i;return o&&r.reverse(),r}(0,e.length-1,t).map((t=>e[t]))}_getInvertIndex(t){let e=0;const i=this.step()/2,r=this.bandwidth()/2,o=this._domain.length,n=this.range(),s=n[0]>n[n.length-1];for(e=0;e<o;e++){const n=this.scale(this._domain[e])+r;if(0===e&&(!s&&!It(t,n+i)||s&&!zt(t,n-i)))break;if(e===o-1)break;if(!zt(t,n-i)&&!It(t,n+i))break}return e>=0&&e<=o-1?e:o-1}invert(t){return this._domain[this._getInvertIndex(t)]}padding(t,e){return void 0!==t?(this._paddingOuter=Math.max(0,Math.min(Array.isArray(t)?Math.min.apply(null,t):t)),this._paddingInner=this._paddingOuter,this.rescale(e)):this._paddingInner}paddingInner(t,e){return void 0!==t?(this._paddingInner=Math.max(0,Math.min(1,t)),this.rescale(e)):this._paddingInner}paddingOuter(t,e){return void 0!==t?(this._paddingOuter=Math.max(0,Math.min(1,t)),this.rescale(e)):this._paddingOuter}step(){return this._step}round(t,e){return void 0!==t?(this._round=t,this.rescale(e)):this._round}align(t,e){return void 0!==t?(this._align=Math.max(0,Math.min(1,t)),this.rescale(e)):this._align}rangeFactor(t,e){return t?(super.rangeFactor(t),this.rescale(e)):super.rangeFactor()}rangeFactorStart(t,e){return X(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this.rescale(e,"rangeFactorStart"))}rangeFactorEnd(t,e){return X(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this.rescale(e,"rangeFactorEnd"))}bandwidth(t,e){return t?("auto"===t?(this._bandwidth=void 0,this._isFixed=!1):(this._bandwidth=t,this._isFixed=!0),this._userBandwidth=t,this.rescale(e)):this._bandwidth}maxBandwidth(t,e){return t?(this._maxBandwidth="auto"===t?void 0:t,this.rescale(e)):this._maxBandwidth}minBandwidth(t,e){return t?(this._minBandwidth="auto"===t?void 0:t,this.rescale(e)):this._minBandwidth}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}isBandwidthFixed(){return this._isFixed&&!!this._bandwidth}_isBandwidthFixedByUser(){return this._isFixed&&this._userBandwidth&&ot(this._userBandwidth)}clone(){var t,e,i;return new j_(!0).domain(this._domain,!0).range(this._range,!0).round(this._round,!0).paddingInner(this._paddingInner,!0).paddingOuter(this._paddingOuter,!0).align(this._align,!0).bandwidth(null!==(t=this._userBandwidth)&&void 0!==t?t:"auto",!0).maxBandwidth(null!==(e=this._maxBandwidth)&&void 0!==e?e:"auto",!0).minBandwidth(null!==(i=this._maxBandwidth)&&void 0!==i?i:"auto")}}const{interpolateRgb:V_}=Me;function U_(t,e){const i=typeof e;let r;if(X(e)||"boolean"===i)return()=>e;if("number"===i)return Vt(t,e);if("string"===i){if(r=Re.parseColorString(e)){const e=V_(Re.parseColorString(t),r);return t=>e(t).formatRgb()}return Vt(Number(t),Number(e))}return e instanceof Be?V_(t,e):e instanceof Re?V_(t.color,e.color):e instanceof Date?function(t,e){const i=t.valueOf(),r=e.valueOf(),o=new Date;return t=>(o.setTime(i*(1-t)+r*t),o)}(t,e):Vt(Number(t),Number(e))}class K_ extends D_{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S_,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S_;super(),this._unknown=void 0,this.transformer=t,this.untransformer=e,this._forceAlign=!0,this._domain=[0,1],this._range=[0,1],this._clamp=S_,this._piecewise=k_,this._interpolate=U_}calculateVisibleDomain(t){var e;return Y(this._rangeFactorStart)&&Y(this._rangeFactorEnd)&&2===t.length?[this.invert(t[0]),this.invert(t[1])]:null!==(e=this._niceDomain)&&void 0!==e?e:this._domain}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise((null!==(e=this._niceDomain)&&void 0!==e?e:this._domain).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._clamp(t)));return this._fishEyeTransform?this._fishEyeTransform(i):i}invert(t){var e;return this._input||(this._input=this._piecewise(this._calculateWholeRange(this._range),(null!==(e=this._niceDomain)&&void 0!==e?e:this._domain).map(this.transformer),Vt)),this._clamp(this.untransformer(this._input(t)))}domain(t,e){var i;if(!t)return(null!==(i=this._niceDomain)&&void 0!==i?i:this._domain).slice();this._domainValidator=null,this._niceType=null,this._niceDomain=null;const r=Array.from(t,Et);return this._domain=r,this.rescale(e)}range(t,e){if(!t)return this._range.slice();const i=Array.from(t);return this._range=i,this.rescale(e)}rangeRound(t,e){const i=Array.from(t);return this._range=i,this._interpolate=Ut,this.rescale(e)}rescale(t){var e;if(t)return this;const i=null!==(e=this._niceDomain)&&void 0!==e?e:this._domain,r=i.length,o=this._range.length;let n=Math.min(r,o);if(r&&r<o&&this._forceAlign){const t=o-r+1,e=i[r-1],s=r>=2?(e-i[r-2])/t:0;for(let o=1;o<=t;o++)i[r-2+o]=e-s*(t-o);n=o}return this._autoClamp&&(this._clamp=Nt(i[0],i[n-1])),this._piecewise=n>2?I_:k_,this._output=this._input=null,this._wholeRange=null,this.generateFishEyeTransform(),this}clamp(t,e,i){return arguments.length?(e?(this._autoClamp=!1,this._clamp=e):(this._autoClamp=!!t,this._clamp=t?void 0:S_),this.rescale(i)):this._clamp!==S_}interpolate(t,e){return arguments.length?(this._interpolate=t,this.rescale(e)):this._interpolate}ticks(){return[]}tickData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.ticks(t);return(null!=e?e:[]).map(((t,e)=>({index:e,tick:t,value:(this.scale(t)-this._range[0])/(this._range[1]-this._range[0])})))}rangeFactor(t,e){return t?(super.rangeFactor(t),this._output=this._input=null,this):super.rangeFactor()}rangeFactorStart(t,e){return X(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this._output=this._input=null,this)}rangeFactorEnd(t,e){return X(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this._output=this._input=null,this)}forceAlignDomainRange(t){return arguments.length?(this._forceAlign=t,this):this._forceAlign}}const $_=Math.sqrt(50),X_=Math.sqrt(10),Y_=Math.sqrt(2),q_=[1,2,5,10],Z_=(t,e,i)=>{let r=1,o=t;const n=Math.floor((e-1)/2),s=Math.abs(t);return t>=0&&t<=Number.MIN_VALUE?o=0:t<0&&t>=-Number.MIN_VALUE?o=-(e-1):!i&&s<1?r=eS(s).step:(i||s>1)&&(o=Math.floor(t)-n*r),r>0?(t>0?o=Math.max(o,0):t<0&&(o=Math.min(o,-(e-1)*r)),function(t,e,i){Y(e)||(e=t,t=0),Y(i)||(i=1);let r=-1;const o=0|Math.max(0,Math.ceil((e-t)/i)),n=new Array(o);for(;++r<o;)n[r]=t+r*i;return n}(0,e).map((t=>o+t*r))):t>0?Q_(0,-(e-1)/r,r):Q_((e-1)/r,0,r)},J_=Ot(((t,e,i,r)=>{let o,n,s,a,l=-1;if(i=+i,(t=+t)==(e=+e))return[t];if(Math.abs(t-e)<=Number.MIN_VALUE&&i>0)return[t];if((o=e<t)&&(n=t,t=e,e=n),a=iS(t,e,i).step,!isFinite(a))return[];if(a>0){let i=Math.round(t/a),r=Math.round(e/a);for(i*a<t&&++i,r*a>e&&--r,s=new Array(n=r-i+1);++l<n;)s[l]=(i+l)*a}else if(a<0&&(null==r?void 0:r.noDecimals)){a=1;const i=Math.ceil(t),r=Math.floor(e);if(!(i<=r))return[];for(s=new Array(n=r-i+1);++l<n;)s[l]=i+l}else{a=-a;let i=Math.round(t*a),r=Math.round(e*a);for(i/a<t&&++i,r/a>e&&--r,s=new Array(n=r-i+1);++l<n;)s[l]=(i+l)/a}return o&&s.reverse(),s})),Q_=(t,e,i)=>{let r,o,n=-1;if(i>0){let s=Math.floor(t/i),a=Math.ceil(e/i);for((s+1)*i<t&&++s,(a-1)*i>e&&--a,o=new Array(r=a-s+1);++n<r;)o[n]=(s+n)*i}else{i=-i;let s=Math.floor(t*i),a=Math.ceil(e*i);for((s+1)/i<t&&++s,(a-1)/i>e&&--a,o=new Array(r=a-s+1);++n<r;)o[n]=(s+n)/i}return o},tS=Ot(((t,e,i,r)=>{let o,n,s;if(i=+i,(t=+t)==(e=+e))return Z_(t,i,null==r?void 0:r.noDecimals);if(Math.abs(t-e)<=Number.MIN_VALUE&&i>0)return Z_(t,i,null==r?void 0:r.noDecimals);(o=e<t)&&(s=t,t=e,e=s);const a=iS(t,e,i);let l=a.step;if(!isFinite(l))return[];if(l>0){let r=1;const{power:o,gap:s}=a,h=10===s?2*10**o:1*10**o;for(;r<=5&&(n=Q_(t,e,l),n.length>i+1)&&i>2;)l+=h,r+=1;i>2&&n.length<i-1&&(n=((t,e,i)=>{let r;const o=t[0],n=t[t.length-1],s=e-t.length;if(n<=0){const e=[];for(r=s;r>=1;r--)e.push(o-r*i);return e.concat(t)}if(o>=0){for(r=1;r<=s;r++)t.push(n+r*i);return t}let a=[];const l=[];for(r=1;r<=s;r++)r%2==0?a=[o-Math.floor(r/2)*i].concat(a):l.push(n+Math.ceil(r/2)*i);return a.concat(t).concat(l)})(n,i,l))}else(null==r?void 0:r.noDecimals)&&l<0&&(l=1),n=Q_(t,e,l);return o&&n.reverse(),n})),eS=t=>{const e=Math.floor(Math.log(t)/Math.LN10),i=t/10**e;let r=q_[0];return i>=$_?r=q_[3]:i>=X_?r=q_[2]:i>=Y_&&(r=q_[1]),e>=0?{step:r*10**e,gap:r,power:e}:{step:-(10**-e)/r,gap:r,power:e}};function iS(t,e,i){const r=(e-t)/Math.max(0,i);return eS(r)}function rS(t,e,i){let r;if(i=+i,(t=+t)==(e=+e)&&i>0)return[t];if(i<=0||0===(r=function(t,e,i){return(e-t)/Math.max(1,i-1)}(t,e,i))||!isFinite(r))return[];const o=new Array(i);for(let e=0;e<i;e++)o[e]=t+e*r;return o}function oS(t){let e,i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,o=0,n=t.length-1,s=t[o],a=t[n],l=10;for(a<s&&(i=s,s=a,a=i,i=o,o=n,n=i);l-- >0;){if(i=iS(s,a,r).step,i===e)return t[o]=s,t[n]=a,t;if(i>0)s=Math.floor(s/i)*i,a=Math.ceil(a/i)*i;else{if(!(i<0))break;s=Math.ceil(s*i)/i,a=Math.floor(a*i)/i}e=i}}function nS(t,e){const i=ot(e.forceMin),r=ot(e.forceMax);let o=null;const n=[];let s=null;const a=i&&r?t=>t>=e.forceMin&&t<=e.forceMax:i?t=>t>=e.forceMin:r?t=>t<=e.forceMax:null;return i?n[0]=e.forceMin:ot(e.min)&&e.min<=Math.min(t[0],t[t.length-1])&&(n[0]=e.min),r?n[1]=e.forceMax:ot(e.max)&&e.max>=Math.max(t[0],t[t.length-1])&&(n[1]=e.max),ot(n[0])&&ot(n[1])?(s=t.slice(),s[0]=n[0],s[s.length-1]=n[1]):o=ot(n[0])||ot(n[1])?ot(n[0])?"max":"min":"all",{niceType:o,niceDomain:s,niceMinMax:n,domainValidator:a}}const sS=(t,e,i)=>Math.abs(e-t)<1?+i.toFixed(1):Math.round(+i),aS=Ot(((t,e,i,r,o,n,s)=>{let a=t,l=e;const h=l<a;h&&([a,l]=[l,a]);let c,d,u=o(a),g=o(l),p=[];if(!(r%1)&&g-u<i){if(u=Math.floor(u),g=Math.ceil(g),a>0){for(;u<=g;++u)for(c=1;c<r;++c)if(d=u<0?c/n(-u):c*n(u),!(d<a)){if(d>l)break;p.push(d)}}else for(;u<=g;++u)for(c=r-1;c>=1;--c)if(d=u>0?c/n(-u):c*n(u),!(d<a)){if(d>l)break;p.push(d)}2*p.length<i&&(p=tS(a,l,i))}else p=tS(u,g,Math.min(g-u,i)).map(n);return p=p.filter((t=>0!==t)),(null==s?void 0:s.noDecimals)&&(p=Array.from(new Set(p.map((t=>Math.floor(t)))))),h?p.reverse():p})),lS=Ot(((t,e,i,r,o,n)=>{const s=[],a={},l=o(t),h=o(e);let c=[];if(Number.isInteger(r))c=tS(l,h,i);else{const t=(h-l)/(i-1);for(let e=0;e<i;e++)c.push(l+e*t)}return c.forEach((i=>{const o=n(i),l=Number.isInteger(r)?sS(t,e,o):sS(t,e,O_(o)),h=sS(t,e,((t,e)=>{let i,r;return e[0]<e[1]?(i=e[0],r=e[1]):(i=e[1],r=e[0]),Math.min(Math.max(t,i),r)})(l,[t,e]));!a[h]&&!isNaN(h)&&c.length>1&&(a[h]=1,s.push(h))})),s})),hS=Ot(((t,e,i,r,o)=>rS(r(t),r(e),i).map((t=>O_(o(t))))));class cS extends K_{constructor(){super(...arguments),this.type=x_.Linear}clone(){return(new cS).domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate)}tickFormat(){return()=>{}}d3Ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;const i=this.calculateVisibleDomain(this._range);return J_(i[0],i[i.length-1],t,e)}ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;var i;if(Y(this._rangeFactorStart)&&Y(this._rangeFactorEnd)&&(this._rangeFactorStart>0||this._rangeFactorEnd<1)&&2===this._range.length||!this._niceType)return this.d3Ticks(t,e);const r=null!==(i=this._niceDomain)&&void 0!==i?i:this._domain,o=this._domain,n=r[0],s=r[r.length-1];let a=tS(o[0],o[o.length-1],t,e);if(!a.length)return a;if(this._domainValidator)a=a.filter(this._domainValidator);else if((a[0]!==n||a[a.length-1]!==s)&&this._niceType){const t=r.slice();if("all"===this._niceType?(t[0]=a[0],t[t.length-1]=a[a.length-1],this._niceDomain=t,this.rescale()):"min"===this._niceType&&a[0]!==n?(t[0]=a[0],this._niceDomain=t,this.rescale()):"max"===this._niceType&&a[a.length-1]!==s&&(t[t.length-1]=a[a.length-1],this._niceDomain=t,this.rescale()),"all"!==this._niceType){const e=Math.min(t[0],t[t.length-1]),i=Math.max(t[0],t[t.length-1]);a=a.filter((t=>t>=e&&t<=i))}}return a}forceTicks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return rS(e[0],e[e.length-1],t)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return function(t,e,i){let r,o,n=-1;if(i=+i,(o=(e=+e)<(t=+t))&&(r=t,t=e,e=r),!isFinite(i)||e-t<=i)return[t];const s=Math.floor((e-t)/i+1),a=new Array(s);for(;++n<s;)a[n]=t+n*i;return o&&a.reverse(),a}(e[0],e[e.length-1],t)}nice(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;var i,r;const o=this._domain;let n=[];if(e){const t=nS(o,e);if(n=t.niceMinMax,this._domainValidator=t.domainValidator,this._niceType=t.niceType,t.niceDomain)return this._niceDomain=t.niceDomain,this.rescale(),this}else this._niceType="all";if(this._niceType){const e=oS(o.slice(),t);"min"===this._niceType?e[e.length-1]=null!==(i=n[1])&&void 0!==i?i:e[e.length-1]:"max"===this._niceType&&(e[0]=null!==(r=n[0])&&void 0!==r?r:e[0]),this._niceDomain=e,this.rescale()}return this}niceMin(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;this._niceType="min";const e=this._domain[this._domain.length-1],i=oS(this.domain(),t);return i&&(i[i.length-1]=e,this._niceDomain=i,this.rescale()),this}niceMax(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;this._niceType="max";const e=this._domain[0],i=oS(this._domain.slice(),t);return i&&(i[0]=e,this._niceDomain=i,this.rescale()),this}}function dS(t){return e=>-t(-e)}function uS(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.EPSILON;return e=>Math.max(e,t)}class gS extends K_{constructor(){super(T_(10),M_(10)),this.type=x_.Log,this._limit=uS(),this._logs=this.transformer,this._pows=this.untransformer,this._domain=[1,10],this._base=10}clone(){return(new gS).domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).base(this._base)}rescale(t){var e;if(t)return this;super.rescale();const i=T_(this._base),r=M_(this._base);return(null!==(e=this._niceDomain)&&void 0!==e?e:this._domain)[0]<0?(this._logs=dS(i),this._pows=dS(r),this._limit=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.EPSILON;return e=>Math.min(e,-t)}(),this.transformer=A_,this.untransformer=R_):(this._logs=i,this._pows=r,this._limit=uS(),this.transformer=this._logs,this.untransformer=r),this}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise((null!==(e=this._niceDomain)&&void 0!==e?e:this._domain).map(this._limit).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._limit(this._clamp(t))));return this._fishEyeTransform?this._fishEyeTransform(i):i}base(t,e){return arguments.length?(this._base=t,this.rescale(e)):this._base}tickFormat(){return S_}d3Ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;const i=this.domain(),r=this._limit(i[0]),o=this._limit(i[i.length-1]);return aS(r,o,t,this._base,this.transformer,this.untransformer,e)}ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return lS(this._limit(e[0]),this._limit(e[e.length-1]),t,this._base,this.transformer,this.untransformer)}forceTicks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return hS(e[0],e[e.length-1],t,this.transformer,this.untransformer)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return hS(this._limit(e[0]),this._limit(e[e.length-1]),t,this.transformer,this.untransformer)}nice(){let t=arguments.length>1?arguments[1]:void 0;var e,i;const r=this._domain;let o=[],n=null;if(t){const e=nS(r,t);if(o=e.niceMinMax,this._domainValidator=e.domainValidator,n=e.niceType,e.niceDomain)return this._niceDomain=e.niceDomain,this.rescale(),this}else n="all";if(n){const t=z_(r.slice(),{floor:t=>this._pows(Math.floor(this._logs(this._limit(t)))),ceil:t=>Math.abs(t)>=1?Math.ceil(t):this._pows(Math.ceil(this._logs(this._limit(t))))});return"min"===n?t[t.length-1]=null!==(e=o[1])&&void 0!==e?e:t[t.length-1]:"max"===n&&(t[0]=null!==(i=o[0])&&void 0!==i?i:t[0]),this._niceDomain=t,this.rescale(),this}return this}niceMin(){const t=this._domain[this._domain.length-1];this.nice();const e=this._domain.slice();return this._domain&&(e[e.length-1]=t,this._niceDomain=e,this.rescale()),this}niceMax(){const t=this._domain[0];this.nice();const e=this._domain.slice();return this._domain&&(e[0]=t,this._niceDomain=e,this.rescale()),this}}class pS extends cS{constructor(){super(P_(1),H_(1)),this.type=x_.Symlog,this._const=1}clone(){return(new pS).domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).constant(this._const)}constant(t,e){return arguments.length?(this._const=t,this.transformer=P_(t),this.untransformer=H_(t),this.rescale(e)):this._const}d3Ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;const i=this.domain(),r=i[0],o=i[i.length-1];return aS(r,o,t,this._const,this.transformer,this.untransformer,e)}ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return lS(e[0],e[e.length-1],t,this._const,this.transformer,this.untransformer)}forceTicks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return hS(e[0],e[e.length-1],t,this.transformer,this.untransformer)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return hS(e[0],e[e.length-1],t,this.transformer,this.untransformer)}nice(){let t=arguments.length>1?arguments[1]:void 0;var e,i;const r=this._domain;let o=[],n=null;if(t){const e=nS(r,t);if(o=e.niceMinMax,this._domainValidator=e.domainValidator,n=e.niceType,e.niceDomain)return this._niceDomain=e.niceDomain,this.rescale(),this}else n="all";if(n){const t=z_(r.slice(),{floor:t=>Math.floor(t),ceil:t=>Math.ceil(t)});return"min"===n?t[t.length-1]=null!==(e=o[1])&&void 0!==e?e:t[t.length-1]:"max"===n&&(t[0]=null!==(i=o[0])&&void 0!==i?i:t[0]),this._niceDomain=t,this.rescale(),this}return this}niceMin(){const t=this._domain[this._domain.length-1];this.nice();const e=this._domain.slice();return this._domain&&(e[e.length-1]=t,this._niceDomain=e,this.rescale()),this}niceMax(){const t=this._domain[0];this.nice();const e=this._domain.slice();return this._domain&&(e[0]=t,this._niceDomain=e,this.rescale()),this}}class fS{_scale;_scales;bandPadding;paddingInner;paddingOuter;constructor(){this._scale=new j_,this._scales=[this._scale]}valueToPosition(t){return this._scale.scale(t)}getPosition(t){let e=0,i=this._scale;if(1===this._scales.length||1===t.length)e=this.valueToPosition(t[0]);else{const r=Math.min(t.length,this._scales.length);for(let i=0;i<r;i++)e+=this._scales[i].scale(t[i]);i=this._scales[r-1]}return{position:e,bandScale:i}}calcScales(t,e){const{bandPadding:i,paddingInner:r,paddingOuter:o}=this,n=et(i),s=et(r),a=et(o);for(let l=0;l<this._scales.length;l++){const h=n?i[l]:i,c=s?r[l]:r,d=a?o[l]:o;this._scales[l].paddingInner(c??h??t,!0).paddingOuter(d??h??e)}}dataToPosition(t,e={}){if(0===t.length||0===this._scales.length)return 0;const{position:i,bandScale:r}=this.getPosition(t);return i+r.bandwidth()*(e.bandPosition??.5)}updateScaleDomain(t){for(let e=0;e<this._scales.length;e++)this._scales[e].domain(t)}updateRange(t){const[e,i]=this._scale.range();t[0]===e&&t[1]===i||this._scale.range(t)}}const mS=(t,e)=>{var i,r;if(!(null==e?void 0:e.fields))return t;if(0===t.length)return t;const o=e.fields,n=t[0],s={},a=[];for(const e in o)if(Object.prototype.hasOwnProperty.call(o,e)){const l=o[e];if(!l.type){let r=n;e in n||(r=null!==(i=t.find((t=>e in t)))&&void 0!==i?i:n),l.type="number"==typeof r[e]?"linear":"ordinal"}let h;if("number"==typeof l.sortIndex&&(h={key:e,type:l.type,index:l.sortIndex,sortIndex:{},sortIndexCount:0,sortReverse:!0===l.sortReverse},a.push(h)),(null===(r=l.domain)||void 0===r?void 0:r.length)>0)if("ordinal"===l.type){l._domainCache={},s[e]=l;const t={};l.domain.forEach(((e,i)=>{t[e]=i,l._domainCache[e]=i})),h&&(h.sortIndex=t,h.sortIndexCount=l.domain.length)}else l.domain.length>=2&&(s[e]=l)}return Object.keys(s).length>0&&(t=t.filter((t=>{for(const e in s){const i=s[e];if("ordinal"===i.type){if(!(t[e]in i._domainCache))return!1}else if(i.domain[0]>t[e]||i.domain[1]<t[e])return!1}return!0}))),a.sort(((t,e)=>t.index-e.index)),t.sort(((t,e)=>function(t,e,i){for(let r=0;r<i.length;r++){const o=i[r];let n=0;if("ordinal"===o.type?(void 0===o.sortIndex[e[o.key]]&&(o.sortIndex[e[o.key]]=o.sortIndexCount++),void 0===o.sortIndex[t[o.key]]&&(o.sortIndex[t[o.key]]=o.sortIndexCount++),n=o.sortIndex[t[o.key]]-o.sortIndex[e[o.key]]):"linear"===o.type&&(n=t[o.key]-e[o.key]),o.sortReverse&&(n=-n),0!==n)return n}return 0}(t,e,a))),t};let bS=0;function yS(){return bS>1e8&&(bS=0),(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"dataset")+"_"+bS++}class CS{constructor(t){var e;let i;this.options=t,this.isDataSet=!0,this.transformMap={},this.parserMap={},this.dataViewMap={},this.target=new V,i=(null==t?void 0:t.name)?t.name:yS("dataset"),this.name=i,this._logger=null!==(e=null==t?void 0:t.logger)&&void 0!==e?e:qe.getInstance()}setLogger(t){this._logger=t}getDataView(t){return this.dataViewMap[t]}setDataView(t,e){var i;this.dataViewMap[t]&&(null===(i=this._logger)||void 0===i||i.error(`Error: dataView ${t} 之前已存在，请重新命名`)),this.dataViewMap[t]=e}removeDataView(t){this.dataViewMap[t]=null,delete this.dataViewMap[t]}registerParser(t,e){var i;this.parserMap[t]&&(null===(i=this._logger)||void 0===i||i.warn(`Warn: transform ${t} 之前已注册，执行覆盖逻辑`)),this.parserMap[t]=e}removeParser(t){this.parserMap[t]=null,delete this.parserMap[t]}getParser(t){return this.parserMap[t]||this.parserMap.default}registerTransform(t,e){var i;this.transformMap[t]&&(null===(i=this._logger)||void 0===i||i.warn(`Warn: transform ${t} 之前已注册，执行覆盖逻辑`)),this.transformMap[t]=e}removeTransform(t){this.transformMap[t]=null,delete this.transformMap[t]}getTransform(t){return this.transformMap[t]}multipleDataViewAddListener(t,e,i){this._callMap||(this._callMap=new Map);let r=this._callMap.get(i);r||(r=()=>{t.some((t=>t.isRunning))||i()}),t.forEach((t=>{t.target.addListener(e,r)})),this._callMap.set(i,r)}allDataViewAddListener(t,e){this.multipleDataViewAddListener(Object.values(this.dataViewMap),t,e)}multipleDataViewRemoveListener(t,e,i){if(this._callMap){const r=this._callMap.get(i);r&&t.forEach((t=>{t.target.removeListener(e,r)})),this._callMap.delete(i)}}multipleDataViewUpdateInParse(t){t.forEach((t=>{var e;return null===(e=this.getDataView(t.name))||void 0===e?void 0:e.markRunning()})),t.forEach((t=>{var e;return null===(e=this.getDataView(t.name))||void 0===e?void 0:e.parseNewData(t.data,t.options)}))}multipleDataViewUpdateInRawData(t){t.forEach((t=>{var e;return null===(e=this.getDataView(t.name))||void 0===e?void 0:e.markRunning()})),t.forEach((t=>{var e;return null===(e=this.getDataView(t.name))||void 0===e?void 0:e.updateRawData(t.data,t.options)}))}destroy(){this.transformMap=null,this.parserMap=null,this.dataViewMap=null,this._callMap=null,this.target.removeAllListeners()}}const wS="_data-view-diff-rank";class vS{constructor(t,e){var i=this;let r;this.dataSet=t,this.options=e,this.isDataView=!0,this.target=new V,this.parseOption=null,this.transformsArr=[],this.isRunning=!1,this.rawData={},this.history=!1,this.parserData={},this.latestData={},this._fields=null,this.reRunAllTransform=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{pushHistory:!0,emitMessage:!0};return i.isRunning=!0,i.resetTransformData(),i.transformsArr.forEach((e=>{i.executeTransform(e,{pushHistory:t.pushHistory,emitMessage:!1}),i.isLastTransform(e)&&i.diffLastData()})),i.isRunning=!1,!1!==t.emitMessage&&i.target.emit("change",[]),i},this.markRunning=()=>{this.isRunning=!0,this.target.emit("markRunning",[])},r=(null==e?void 0:e.name)?e.name:yS("dataview"),this.name=r,(null==e?void 0:e.history)&&(this.history=e.history,this.historyData=[]),this.dataSet.setDataView(r,this),this.setFields(null==e?void 0:e.fields)}parse(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var r;this.isRunning=!0,i&&this.target.emit("beforeParse",[]),e&&(this.parseOption=e);const o=this.cloneParseData(t,e);if(null==e?void 0:e.type){const t=(null!==(r=this.dataSet.getParser(e.type))&&void 0!==r?r:this.dataSet.getParser("bytejson"))(o,e.options,this);this.rawData=o,this.parserData=t,this.history&&this.historyData.push(o,t),this.latestData=t}else this.parserData=o,this.rawData=o,this.history&&this.historyData.push(o),this.latestData=o;return this.isRunning=!1,i&&this.target.emit("afterParse",[]),this}transform(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.isRunning=!0,t&&t.type){let i=!0;if("fields"===t.type){this._fields=t.options.fields;const e=this.transformsArr.findIndex((e=>e.type===t.type));e>=0&&(i=!1,this.transformsArr[e].options.fields=this._fields)}if(i&&this.transformsArr.push(t),e){const e=this.isLastTransform(t);this.executeTransform(t),e&&this.diffLastData()}}return this.sortTransform(),this.isRunning=!1,this}isLastTransform(t){return this.transformsArr[this.transformsArr.length-1]===t}sortTransform(){this.transformsArr.length>=2&&this.transformsArr.sort(((t,e)=>{var i,r;return(null!==(i=t.level)&&void 0!==i?i:0)-(null!==(r=e.level)&&void 0!==r?r:0)}))}executeTransform(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{pushHistory:!0,emitMessage:!0};const{pushHistory:i,emitMessage:r}=e,o=this.dataSet.getTransform(t.type)(this.latestData,t.options);this.history&&!1!==i&&this.historyData.push(o),this.latestData=o,!1!==r&&this.target.emit("change",[])}resetTransformData(){this.latestData=this.parserData,this.history&&(this.historyData.length=0,this.historyData.push(this.rawData,this.parserData))}enableDiff(t){this._diffData=!0,this._diffKeys=t,this._diffMap=new Map,this._diffRank=0}disableDiff(){this._diffData=!1,this._diffMap=null,this._diffRank=null}resetDiff(){this._diffMap=new Map,this._diffRank=0}diffLastData(){var t;if(!this._diffData)return;if(!this.latestData.forEach)return;if(!(null===(t=this._diffKeys)||void 0===t?void 0:t.length))return;const e=this._diffRank+1;if(0===this._diffRank)this.latestData.forEach((t=>{t[wS]=e,this._diffMap.set(this._diffKeys.reduce(((e,i)=>e+t[i]),""),t)})),this.latestDataAUD={add:Array.from(this.latestData),del:[],update:[]};else{let t;this.latestDataAUD={add:[],del:[],update:[]},this.latestData.forEach((i=>{i[wS]=e,t=this._diffKeys.reduce(((t,e)=>t+i[e]),""),this._diffMap.get(t)?this.latestDataAUD.update.push(i):this.latestDataAUD.add.push(i),this._diffMap.set(t,i)})),this._diffMap.forEach(((t,i)=>{t[wS]<e&&(this.latestDataAUD.del.push(t),this._diffMap.delete(i))}))}this._diffRank=e}cloneParseData(t,e){let i=!1;return t instanceof vS||!0!==(null==e?void 0:e.clone)||(i=!0),i?mt(t):t}parseNewData(t,e){this.parse(t,e||this.parseOption),this.reRunAllTransform()}updateRawData(t,e){const i=this.cloneParseData(t,e);this.rawData=i,this.parserData=i,this.latestData=i,this.reRunAllTransform()}getFields(){var t;return this._fields?this._fields:"dataview"===(null===(t=this.parseOption)||void 0===t?void 0:t.type)&&1===this.rawData.length&&this.rawData[0].getFields?this.rawData[0].getFields():null}setFields(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._fields=t&&e?wt({},this._fields,t):t;const i=this.transformsArr.find((t=>"fields"===t.type));!X(this._fields)&&X(i)?(this.dataSet.registerTransform("fields",mS),this.transform({type:"fields",options:{fields:this._fields}},!1)):i&&(i.options.fields=this._fields)}destroy(){this.dataSet.removeDataView(this.name),this._diffMap=null,this._diffRank=null,this.latestData=null,this.rawData=null,this.parserData=null,this.transformsArr=null,this.target=null}}const xS=new class{constructor(){this.store=new Map}RegisterGraphicCreator(t,e){this.store.set(t,e),this[t]=e}CreateGraphic(t,e){const i=this.store.get(t);return i?i(e):null}};let _S;function SS(t){return _S||(_S=xS.CreateGraphic("text",{})),_S.initAttributes(t),_S.AABBBounds}const AS=(t,e,i,r)=>new Ke(Object.assign({defaultFontParams:Object.assign({fontFamily:"PingFang SC,Helvetica Neue,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol",fontSize:14},r),getTextBounds:i?void 0:SS,specialCharSet:"-/: .,@%'\"~"+Ke.ALPHABET_CHAR_SET+Ke.ALPHABET_CHAR_SET.toUpperCase()},null!=e?e:{}),t);const RS=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(t<0)for(;t<0;)t+=Yt;else if(t>0)for(;t>Yt;)t-=Yt;return t};function BS(t,e,i){return!zt(t,e,0,1e-6)&&!It(t,i,0,1e-6)}function MS(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const n=[e.x-i.x,e.y-i.y];return function(t,e){return[t[0]*e,t[1]*e]}(n,(r?-1:1)*(o?-1:1)*t/function(t){const[e,i]=t;return Math.sqrt(e*e+i*i)}(n))}function TS(t,e,i,r,o,n,s){const a=function(t,e,i){return{x:t.x+e*Math.cos(i),y:t.y+e*Math.sin(i)}}({x:0,y:0},i,t),l=function(t,e){return{x:t.x+e[0],y:t.y+e[1]}}(a,MS(r,a,e,o));return function(t,e,i,r){const o=SS(Object.assign({text:i},r)),n=o.width(),s=o.height(),a=RS(Math.atan2(e[1],e[0]))-Math.PI,l=3*Math.PI/4,h=Math.PI/4,c=Math.PI/2,d=t.x;let u=0;u=BS(a,-l,-h)?((a+l)/c-.5)*n:BS(a,h,l)?(.5-(a-h)/c)*n:Math.cos(a)>=0?.5*n:.5*-n;const g=d-u,p=t.y;let f=0;return f=BS(a,-l,-h)?.5*-s:BS(a,h,l)?.5*s:Math.cos(a)>=0?(.5-(h-a)/c)*s:(.5-RS(a-l)/c)*s,{x:g,y:p-f}}(l,MS(r||1,l,e,o),n,s)}const PS=t=>t.map(((t,e)=>({index:e,value:t}))),HS=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=new ue(t).expand(i/2),o=new ue(e).expand(i/2);return r.intersects(o)};function ES(t,e,i){return i>Math.max(e.x1-t.x2,t.x1-e.x2,e.y1-t.y2,t.y1-e.y2)}function kS(t,e){for(let i,r=1,o=t.length,n=t[0];r<o;n=i,++r)if(i=t[r],ES(n.AABBBounds,i.AABBBounds,e))return!0;return!1}const LS=(t,e,i)=>{var r;const{labelStyle:o,axisOrientType:n,labelFlush:s,labelFormatter:a,startAngle:l=0}=i;let h=null!==(r=o.angle)&&void 0!==r?r:0;"vertical"===o.direction&&(h+=ge(90));const c=["bottom","top"].includes(n),d=["left","right"].includes(n);let u=1,g=0;c||(d?(u=0,g=1):l&&(u=Math.cos(l),g=-Math.sin(l)));const p=AS(o),f=e.map(((i,r)=>{var n,l;const f=a?a(i):`${i}`,{width:m,height:b}=p.quickMeasure(f),y=Math.max(m,12),C=Math.max(b,12),w=t.scale(i),v=u*w,x=g*w;let _,S,A=v,R=x;_=s&&c&&0===r?"left":s&&c&&r===e.length-1?"right":null!==(n=o.textAlign)&&void 0!==n?n:"center","right"===_?A-=y:"center"===_&&(A-=y/2),S=s&&d&&0===r?"top":s&&d&&r===e.length-1?"bottom":null!==(l=o.textBaseline)&&void 0!==l?l:"middle","bottom"===S?R-=C:"middle"===S&&(R-=C/2);const B=(new ue).set(A,R,A+y,R+C);return h&&B.rotate(h,v,x),B}));return f},FS={parity:function(t){return t.filter(((t,e)=>e%2==0))},greedy:function(t,e){let i;return t.filter(((t,r)=>!(r&&ES(i.AABBBounds,t.AABBBounds,e)||(i=t,0))))}},IS=(t,e,i,r)=>LS(t,e,i).map((t=>r?[t.x1,t.x2,t.width()]:[t.y1,t.y2,t.height()])),zS=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Math.max(t[0],e[0])-i/2<=Math.min(t[1],e[1])+i/2},OS=(t,e)=>t[1]<e[0]?e[0]-t[1]:e[1]<t[0]?t[0]-e[1]:0,DS=(t,e,i,r,o,n)=>{let s=0,a=0,l=-1,h=Number.MAX_VALUE;const c=r=>{let o=!0,n=0;do{n+r<t.length&&zS(e[n],e[n+r],i)&&(o=!1),n+=r}while(o&&n<t.length);return o},d=((t,e,i)=>{let r=t,o=e;for(;r<o;){const t=Math.floor((r+o)/2);i(t)>=0?o=t:r=t+1}return r})(o,t.length,(t=>c(t)?1:-1));let u=d;do{if(u>d&&!n&&!c(u))u++;else{if(!r){a=u;break}{const r=t.length-1;let o,n=0;o=t.length%u>0?t.length-t.length%u+u:t.length;do{if(o-=u,o!==r&&!zS(e[o],e[r],i))break;n++}while(o>0);if(o===r){a=u,s=n;break}{const i=Math.floor(t.length/u)-n+1;if(i<l)break;{l=i;const t=OS(e[o],e[r]),c=o-u>=0?OS(e[o-u],e[o]):t,d=Math.abs(t-c);if(d<h&&(h=d,a=u,s=n),t<=c)break}}}u++}}while(u<=t.length);return{step:a,delCount:s}},WS=(t,e)=>{const{tickCount:i,forceTickCount:r,tickStep:o,getRadius:n,labelOffset:s,labelGap:a=0,labelStyle:l}=e,h=null==n?void 0:n();if(!h)return PS(t.domain());let c;if(Y(o))c=t.stepTicks(o);else if(Y(r))c=t.forceTicks(r);else if(Y(i)){const e=t.range(),r=Math.abs(e[e.length-1]-e[0]),o=$(i)?i({axisLength:r,labelStyle:l}):i;c=t.ticks(o)}else if(e.sampling){const i=t.domain(),r=t.range(),o=((t,e,i)=>{var r;const{labelStyle:o,getRadius:n,labelOffset:s,labelFormatter:a,inside:l}=i,h=null==n?void 0:n(),c=null!==(r=o.angle)&&void 0!==r?r:0,d=AS(o),u=e.map((e=>{var i,r;const n=a?a(e):`${e}`,{width:u,height:g}=d.quickMeasure(n),p=Math.max(u,12),f=Math.max(g,12),m=t.scale(e);let b=0,y=0;const C=null!==(i=o.textAlign)&&void 0!==i?i:"center",w=null!==(r=o.textBaseline)&&void 0!==r?r:"middle",{x:v,y:x}=TS(m,{x:0,y:0},h,s,l,n,o);return b=v+("right"===C?-p:"center"===C?-p/2:0),y=x+("bottom"===w?-f:"middle"===w?-f/2:0),(new ue).set(b,y,b+p,y+f).rotate(c,b+p/2,y+f/2)}));return u})(t,i,e),n=Mt(r),l=Bt(r),d=Math.abs(l-n)*(h+s)/i.length,{step:u,delCount:g}=NS(i,o,a,Math.floor(o.reduce(((t,e)=>Math.min(t,e.width(),e.height())),Number.MAX_VALUE)/d));c=t.stepTicks(u),c=c.slice(0,c.length-g)}else c=t.domain();return PS(c)},NS=(t,e,i,r)=>{let o=r;do{let r=!0;o++;let n=0;do{n+o<t.length&&HS(e[n],e[n+o],i)&&(r=!1),n+=o}while(r&&n<t.length);if(r)break}while(o<=t.length);let n=0;if(t.length>2){let i=t.length-t.length%o;for(i>=t.length&&(i-=o);i>0&&HS(e[0],e[i]);)n++,i-=o}return{step:o,delCount:n}},GS=(t,e)=>{if(__(t.type))return((t,e)=>{if(!__(t.type))return PS(t.domain());const i=t.range(),r=Math.abs(i[i.length-1]-i[0]);if(r<2)return PS([t.domain()[0]]);const{tickCount:o,forceTickCount:n,tickStep:s,noDecimals:a=!1,labelStyle:l}=e;let h;if(Y(s))h=t.stepTicks(s);else if(Y(n))h=t.forceTicks(n);else if("d3"===e.tickMode){const e=$(o)?o({axisLength:r,labelStyle:l}):o;h=t.d3Ticks(null!=e?e:5,{noDecimals:a})}else{const e=$(o)?o({axisLength:r,labelStyle:l}):o;h=t.ticks(null!=e?e:5,{noDecimals:a})}if(e.sampling&&("cartesian"===e.coordinateType||"polar"===e.coordinateType&&"radius"===e.axisOrientType)){const{labelGap:i=4,labelFlush:r}=e;let o=LS(t,h,e).map(((t,e)=>({AABBBounds:t,value:h[e]})));for(;o.length>=3&&kS(o,i);)o=FS.parity(o);const n=o.map((t=>t.value));n.length<3&&r&&(n.length>1&&n.pop(),Rt(n)!==Rt(h)&&n.push(Rt(h))),h=n}return PS(h)})(t,e);if(function(t){switch(t){case x_.Ordinal:case x_.Point:case x_.Band:return!0;default:return!1}}(t.type)){if("cartesian"===e.coordinateType)return((t,e)=>{var i;const r=t.domain();if(!r.length)return[];const{tickCount:o,forceTickCount:n,tickStep:s,labelGap:a=4,axisOrientType:l,labelStyle:h}=e,c=(t=>["bottom","top","z"].includes(t))(l),d=t.range(),u=t.calculateWholeRangeSize();if(u<2)return e.labelLastVisible?PS([r[r.length-1]]):PS([r[0]]);let g;if(Y(s))g=t.stepTicks(s);else if(Y(n))g=t.forceTicks(n);else if(Y(o)){const e=$(o)?o({axisLength:u,labelStyle:h}):o;g=t.ticks(e)}else if(e.sampling){const o=(null!==(i=e.labelStyle.fontSize)&&void 0!==i?i:12)+2,n=Mt(d),s=Bt(d);if(r.length<=u/o){const i=(s-n)/r.length,o=IS(t,r,e,c),l=Math.min(...o.map((t=>t[2]))),h=DS(r,o,a,e.labelLastVisible,Math.floor(l/i),!1);g=t.stepTicks(h.step),e.labelLastVisible&&(h.delCount&&(g=g.slice(0,g.length-h.delCount)),g.push(r[r.length-1]))}else{const i=[r[0],r[Math.floor(r.length/2)],r[r.length-1]],o=IS(t,i,e,c);let l=null;o.forEach((t=>{l?l[2]<t[2]&&(l=t):l=t}));const h=s-n-a>0?Math.ceil(r.length*(a+l[2])/(s-n-a)):r.length-1;g=t.stepTicks(h),!e.labelLastVisible||g.length&&g[g.length-1]===r[r.length-1]||(g.length&&Math.abs(t.scale(g[g.length-1])-t.scale(r[r.length-1]))<l[2]&&(g=g.slice(0,-1)),g.push(r[r.length-1]))}}else g=t.domain();return PS(g)})(t,e);if("polar"===e.coordinateType&&"angle"===e.axisOrientType)return WS(t,e)}return PS(t.domain())};function jS(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["data"];const i=t;let r;if(!Y(i)||"object"!=typeof i)return i;if(function(t){return t instanceof vS}(i)||function(t){try{return t instanceof Element}catch(e){const i=["children","innerHTML","classList","setAttribute","tagName","getBoundingClientRect"],r=Object.keys(t);return i.every((t=>r.includes(t)))}}(i))return i;const o=et(i),n=i.length;r=o?new Array(n):"object"==typeof i?{}:K(i)||ot(i)||tt(i)?i:rt(i)?new Date(+i):void 0;const s=o?void 0:Object.keys(Object(i));let a=-1;if(r)for(;++a<(s||i).length;){const t=s?s[a]:a,o=i[t];(null==e?void 0:e.includes(t.toString()))?r[t]=o:r[t]=jS(o,e)}return r}const VS=Math.sqrt(50),US=Math.sqrt(10),KS=Math.sqrt(2);class $S{_extend={};_scale;_scales;nice;zero;domain;expand;forceTickCount;tickCount;niceType;type;constructor(t){this.type=t??"linear",this._scale="log"===t?new gS:"symlog"===t?new pS:new cS,this._scales=[this._scale]}setExtraAttrFromSpec(t,e,i,r,o,n){this.nice=!1,this.zero=e,this.zero&&(i.min=Math.min(i.min,0),i.max=Math.max(i.max,0)),this.domain=i,this.expand=r,"log"===this.type?this._scale.base(o??10):"symlog"===this.type&&this._scale.constant(n??10)}transformScaleDomain(){"symlog"===this.type||"log"===this.type||this.setScaleNice()}setScaleNice(){"log"===this.type?this.setLogScaleNice():this.setLinearScaleNice()}setLogScaleNice(){X(this.domain?.min)&&X(this.domain?.max)?this.nice&&this._scale.nice():Y(this.domain?.min)&&X(this.domain?.max)?this.nice&&this._scale.niceMax():X(this.domain?.min)&&Y(this.domain?.max)&&this.nice&&this._scale.niceMin()}setLinearScaleNice(){let t=this.forceTickCount??this.tickCount??10;"accurateFirst"===this.niceType&&(t=Math.max(10,t)),X(this.domain?.min)&&X(this.domain?.max)?this.nice&&this._scale.nice(t):Y(this.domain?.min)&&X(this.domain?.max)?this.nice&&this._scale.niceMax(t):X(this.domain?.min)&&Y(this.domain?.max)?this.nice&&this._scale.niceMin(t):this.nice&&this._scale.nice(t)}dataToPosition(t){return this.valueToPosition(t[0])}valueToPosition(t){return this._scale.scale(t)}computeLinearDomain(t){const e=[];return t.forEach((t=>{const{min:i,max:r}=t;e[0]=void 0===e[0]?i:Math.min(e[0],i),e[1]=void 0===e[1]?r:Math.max(e[1],r)})),this.expandDomain(e),this.includeZero(e),this.setDomainMinMax(e),e}expandDomain(t){if(!this.expand)return;const e=t[0],i=t[t.length-1];Y(this.expand.min)&&(t[0]=e-(i-e)*this.expand.min),Y(this.expand.max)&&(t[t.length-1]=i+(i-e)*this.expand.max)}niceDomain(t){if(Y(t[0])||Y(t[1])||"linear"!==this.type)return t;if(Math.abs(Mt(t)-Bt(t))<=1e-12){let e=t[0];const i=e>=0?1:-1;if(e=Math.abs(e),e<1)t[0]=0,t[1]=1;else{let i=e/5;const r=Math.floor(Math.log(i)/Math.LN10),o=i/Math.pow(10,r);i=(o>=VS?10:o>=US?5:o>=KS?2:1)*Math.pow(10,r),t[0]=0,t[1]=10*i}i<0&&(t.reverse(),t[0]*=-1,t[1]*=-1)}return t}niceMinMax(){if(this.nice){let t=this.forceTickCount??this.tickCount??10;"accurateFirst"===this.niceType&&(t=Math.max(10,t)),X(this.domain?.min)&&X(this.domain?.max)?this._scale.nice(t):Y(this.domain?.min)&&X(this.domain?.max)?this._scale.niceMax(t):X(this.domain?.min)&&Y(this.domain?.max)?this._scale.niceMin(t):this._scale.nice(t)}}includeZero(t){this.zero&&(t[0]=Math.min(t[0],0),t[t.length-1]=Math.max(t[t.length-1],0))}setExtendDomain(t,e){if(void 0===e)return void delete this._extend[t];this._extend[t]=e;const i=this._scale.domain();this.extendDomain(i),this.includeZero(i),this.setDomainMinMax(i),this.niceDomain(i),this._scale.domain(i,this.nice),this.niceMinMax()}extendDomain(t){let e;const i=t.length-1,r=t[0]-t[i]>0,o=r?i:0,n=r?0:i;for(const i in this._extend)e=this._extend[i],e>t[n]&&(t[n]=e),e<t[o]&&(t[o]=e)}setDomainMinMax(t){if(!this.domain)return;const{min:e,max:i}=this.domain;Y(e)&&(t[0]=e),Y(i)&&(t[1]=i)}setZero(t){this.zero!==t&&(this.zero=t,this.updateScaleDomain())}updateScaleDomain(){const t=this.computeDomain([this.domain]);this.updateScaleDomainByModel(t)}computeDomain(t){return this.computeLinearDomain(t)}updateScaleDomainByModel(t){t=t??this._scale.domain(),this.extendDomain(t),this.includeZero(t),this.setDomainMinMax(t),this.niceDomain(t),this._scale.domain(t,this.nice),this.niceMinMax()}updateRange(t){const[e,i]=this._scale.range();t[0]===e&&t[1]===i||this._scale.range(t)}}function XS(t,e){const i=e.option;ut(t)||i?.label?.flush&&function(t,e){const{width:i,height:r}=e.getLayoutRect(),o=v_(e.orient),n=!0===e.option.inverse,s=t[0],a=Rt(t);if(o)if(n){const t=i,e=0,r=s.AABBBounds.x2,o=a.AABBBounds.x1;r>t&&s.setAttributes({x:t,textAlign:"right"}),o<e&&a.setAttributes({x:e,textAlign:"left"})}else{const t=0,e=i,r=s.AABBBounds.x1,o=a.AABBBounds.x2;r<t&&s.setAttributes({x:t,textAlign:"left"}),o>e&&a.setAttributes({x:e,textAlign:"right"})}else if(n){const t=s.AABBBounds.y1,e=a.AABBBounds.y2,i=0,o=r;t<i&&s.setAttributes({y:i,textBaseline:"top"}),e>o&&a.setAttributes({y:o,textBaseline:"bottom"})}else{const t=r,e=0,i=s.AABBBounds.y2,o=a.AABBBounds.y1;i>t&&s.setAttributes({y:t,textBaseline:"bottom"}),o<e&&a.setAttributes({y:e,textBaseline:"top"})}}(t,e)}const YS=t=>t;class qS{width;height;x=0;y=0;table;option;orient;visible;type;inverse;data;tickData;scale;component;constructor(t,e,i,r,o){if(this.table=o,this.orient=t.orient??"left",this.type=t.type??"band",this.option=wt({},function(t){return t?.colorScheme?.default?.palette?wt({},C_,{tick:{style:{stroke:t.colorScheme.default.palette.axisDomainColor||"#D9DDE4"}},subTick:{style:{stroke:t.colorScheme.default.palette.axisDomainColor||"#D9DDE4"}},label:{style:{fill:t.colorScheme.default.palette.axisLabelFontColor||"#89909D"}},title:{style:{fill:t.colorScheme.default.palette.secondaryFontColor||"#333333"}}}):C_}(t.__vtableChartTheme),function(t,e){let i;"left"===t?i=e.axisStyle.leftAxisStyle:"right"===t?i=e.axisStyle.rightAxisStyle:"top"===t?i=e.axisStyle.topAxisStyle:"bottom"===t&&(i=e.axisStyle.bottomAxisStyle);return wt({},e.axisStyle.defaultAxisStyle,i)}(this.orient,o.theme),function(t,e,i){if(!i)return{};const r=i.axis;let o,n;"linear"===e||"log"===e||"symlog"===e?o=i.axisLinear:"band"===e&&(o=i.axisBand);"top"===t||"bottom"===t?n=i.axisX:"left"!==t&&"right"!==t||(n=i.axisY);return wt({},r,o,n)}(this.orient,this.type,t.__vtableChartTheme),t),"left"===this.orient||"right"===this.orient){const t=0,o=0;this.width=e,this.height=i-r[2]-o,this.y=r[0]+t}else if("top"===this.orient||"bottom"===this.orient){const t=0,o=0;this.width=e-r[1]-o,this.height=i,this.x=r[3]+t}this.visible=t.visible??!0,this.inverse="inverse"in t&&!!t.inverse,"band"===t.type&&(this.data=t.domain),this.initScale(),this.initData(),this.createComponent(),this.initEvent()}initScale(){const t=this.option;"band"===this.type||"point"===this.type?(this.scale=new fS,this.scale.bandPadding=t.bandPadding,this.scale.paddingInner=t.paddingInner,this.scale.paddingOuter=t.paddingOuter,this.scale.calcScales(.1,.3),this.scale.updateScaleDomain(this.data),this.updateScaleRange()):"linear"!==this.type&&"time"!==this.type&&"log"!==this.type&&"symlog"!==this.type||(this.scale=new $S(this.type),this.scale.setExtraAttrFromSpec(t.nice,t.zero,t.range,t.expand,t.base,t.constant),this.scale.transformScaleDomain(),this.scale.updateScaleDomain(),this.updateScaleRange())}initData(){var t,e,i;!function(t,e,i){t.getParser(e)||t.registerParser(e,i)}(this.table._vDataSet,"scale",YS),t=this.table._vDataSet,e="ticks",i=GS,t.getTransform(e)||t.registerTransform(e,i);const r=this.option.label||{},o=this.option.tick||{},n=new vS(this.table._vDataSet).parse(this.scale._scale,{type:"scale"}).transform({type:"ticks",options:{sampling:!1!==this.option.sampling,tickCount:o.tickCount,forceTickCount:o.forceTickCount,tickStep:o.tickStep,tickMode:o.tickMode,noDecimals:o.noDecimals,axisOrientType:this.orient,coordinateType:"cartesian",labelStyle:r.style,labelFormatter:r.formatMethod,labelGap:r.minGap,labelLastVisible:r.lastVisible,labelFlush:r.flush}},!1);this.tickData=n,this.computeData()}computeData(){this.tickData.reRunAllTransform()}initEvent(){}createComponent(){const t=w_(this.option),e=this.getUpdateAttribute();e.verticalFactor="top"===this.orient||"right"===this.orient?-1:1,this.component=new Xv(wt({},t,e)),this.component.setAttributes(this.setLayoutStartPosition({x:0,y:0})),this.component.originAxis=this}resize(t,e){this.width=t,this.height=e,this.updateScaleRange(),this.computeData();const i=w_(this.option),r=this.getUpdateAttribute();r.verticalFactor="top"===this.orient||"right"===this.orient?-1:1,this.component.setAttributes(wt({},i,r)),this.component.setAttributes(this.setLayoutStartPosition({x:0,y:0})),this.overlap()}overlap(){!function(t,e){const i=t.find((t=>"axis-label-container-layer-0"===t.name),!0),r=t.find((t=>"axis-label-container-layer-1"===t.name),!0);XS(i?i.getChildren():[],e),XS(r?r.getChildren():[],e)}(this.component,this)}getLayoutRect(){return{width:this.width,height:this.height}}getUpdateAttribute(){this.table.tableNoFrameHeight,this.table.tableNoFrameWidth;const{width:t,height:e}=this.getLayoutRect(),i=v_(this.orient),r="left"===(o=this.orient)||"right"===o;var o;let n={x:0,y:0},s=0;i?(n={x:t,y:0},s=t):r&&(n={x:0,y:e},s=e);const a="top"===this.orient||"bottom"===this.orient?e:t;return{start:{x:this.x,y:this.y},end:n,title:{text:this.option.title.text,maxWidth:this._getTitleLimit(i)},items:this.getLabelItems(s),verticalLimitSize:a,verticalMinSize:a}}getLabelItems(t){return[this.tickData.latestData.map((e=>({id:e.value,label:e.value,value:0===t?0:this.scale.dataToPosition([e.value])/t,rawValue:e.value}))).filter((t=>t.value>=0&&t.value<=1))]}updateScaleRange(){const t=this.option.innerOffset?.right??0,e=this.option.innerOffset?.left??0,i=this.option.innerOffset?.top??0,r=this.option.innerOffset?.bottom??0,{width:o,height:n}=this.getLayoutRect(),s=this.option.inverse||!1;let a=[0,0];v_(this.orient)?nt(o)&&(a=s?[o-t,e]:[e,o-t]):nt(n)&&(a=s?[i,n-r]:[n-r,i]),this.scale.updateRange(a)}setLayoutStartPosition(t){let{x:e,y:i}=t;return nt(e)&&(e+=Number("left"===this.orient)*this.getLayoutRect().width),nt(i)&&(i+=Number("top"===this.orient)*this.getLayoutRect().height),{x:e,y:i}}_getTitleLimit(t){if(this.option.title.visible&&X(this.option.title.style?.maxLineWidth)){let e=this.option.title.style?.angle||0;if(this.option.title?.autoRotate&&X(this.option.title.angle)&&(e="left"===this.option.orient?-90:90),t){const t=this.getLayoutRect().width,i=Math.abs(Math.cos(ge(e)));return i<1e-6?1/0:t/i}const i=this.getLayoutRect().height,r=Math.abs(Math.sin(ge(e)));return r<1e-6?1/0:i/r}return null}getScale(){return this.scale._scale}getDomainSpec(){return this.scale.domain}}function ZS(t,e,i,r,o,n){const s=function(t,e){const i=new Array(e);for(let r=0;r<e;r++)i[r]=t(r);return i}(t,i);s.sort(((t,e)=>r(n(t),n(e),o)));for(let t=0;t<i;t++)e(t,s[t])}class JS{className="Aggregator";isRecord=!0;records=[];type;field;formatFun;_formatedValue;constructor(t,e,i){this.field=t,this.formatFun=e,this.isRecord=i??this.isRecord}clearCacheValue(){this._formatedValue=void 0}formatValue(t,e,i){return this._formatedValue||(this.formatFun?this._formatedValue=this.formatFun(this.value(),t,e,i):this._formatedValue=this.value()),this._formatedValue}reset(){this.records=[]}}class QS extends JS{type=nC.RECORD;isRecord=!0;push(t){this.isRecord&&("Aggregator"===t.className?this.records.push(...t.records):this.records.push(t))}value(){return this.records}reset(){this.records=[]}recalculate(){}}class tA extends JS{type=nC.NONE;isRecord=!0;fieldValue;push(t){this.isRecord&&(this.records=[t]),this.fieldValue=t[this.field]}value(){return this.fieldValue}reset(){this.records=[],this.fieldValue=void 0}recalculate(){}}class eA extends JS{type=nC.CUSTOM;isRecord=!0;aggregationFun;values=[];fieldValue;constructor(t,e,i,r){super(t,e,i),this.aggregationFun=r}push(t){this.isRecord&&("Aggregator"===t.className?this.records.push(...t.records):this.records.push(t)),this.values.push(t[this.field])}value(){return this.fieldValue||(this.fieldValue=this.aggregationFun?.(this.values,this.records,this.field)),this.fieldValue}reset(){this.records=[],this.fieldValue=void 0}recalculate(){}}class iA extends JS{type=nC.SUM;sum=0;positiveSum=0;nagetiveSum=0;needSplitPositiveAndNegativeForSum=!1;constructor(t,e,i,r){super(t,e,i),this.needSplitPositiveAndNegativeForSum=r??!1}push(t){if(this.isRecord&&("Aggregator"===t.className?this.records.push(...t.records):this.records.push(t)),"Aggregator"===t.className){const e=t.value();this.sum+=e,this.needSplitPositiveAndNegativeForSum&&(e>0?this.positiveSum+=e:e<0&&(this.nagetiveSum+=e))}else if(!isNaN(parseFloat(t[this.field]))){const e=parseFloat(t[this.field]);this.sum+=e,this.needSplitPositiveAndNegativeForSum&&(e>0?this.positiveSum+=e:e<0&&(this.nagetiveSum+=e))}}value(){return this.sum}positiveValue(){return this.positiveSum}negativeValue(){return this.nagetiveSum}reset(){this.records=[],this.sum=0}recalculate(){this.sum=0,this._formatedValue=void 0;for(let t=0;t<this.records.length;t++){const e=this.records[t];if("Aggregator"===e.className){const t=e.value();this.sum+=t,this.needSplitPositiveAndNegativeForSum&&(t>0?this.positiveSum+=t:t<0&&(this.nagetiveSum+=t))}else if(!isNaN(parseFloat(e[this.field]))){const t=parseFloat(e[this.field]);this.sum+=t,this.needSplitPositiveAndNegativeForSum&&(t>0?this.positiveSum+=t:t<0&&(this.nagetiveSum+=t))}}}}class rA extends JS{type=nC.COUNT;count=0;push(t){this.isRecord&&("Aggregator"===t.className?this.records.push(...t.records):this.records.push(t)),"Aggregator"===t.className?this.count+=t.value():this.count++}value(){return this.count}reset(){this.records=[],this.count=0}recalculate(){this.count=0,this._formatedValue=void 0;for(let t=0;t<this.records.length;t++){const e=this.records[t];"Aggregator"===e.className?this.count+=e.value():this.count++}}}class oA extends JS{type=nC.AVG;sum=0;count=0;push(t){this.isRecord&&("Aggregator"===t.className?this.records.push(...t.records):this.records.push(t)),"Aggregator"===t.className&&t.type===nC.AVG?(this.sum+=t.sum,this.count+=t.count):isNaN(parseFloat(t[this.field]))||(this.sum+=parseFloat(t[this.field]),this.count++)}value(){return this.sum/this.count}reset(){this.records=[],this.sum=0,this.count=0}recalculate(){this.sum=0,this.count=0,this._formatedValue=void 0;for(let t=0;t<this.records.length;t++){const e=this.records[t];"Aggregator"===e.className&&e.type===nC.AVG?(this.sum+=e.sum,this.count+=e.count):isNaN(parseFloat(e[this.field]))||(this.sum+=parseFloat(e[this.field]),this.count++)}}}class nA extends JS{type=nC.MAX;max=Number.MIN_SAFE_INTEGER;push(t){this.isRecord&&("Aggregator"===t.className?this.records.push(...t.records):this.records.push(t)),"Aggregator"===t.className?this.max=t.max>this.max?t.max:this.max:"number"==typeof t?this.max=t>this.max?t:this.max:"number"==typeof t[this.field]?this.max=t[this.field]>this.max?t[this.field]:this.max:isNaN(t[this.field])||(this.max=parseFloat(t[this.field])>this.max?parseFloat(t[this.field]):this.max)}value(){return this.max}reset(){this.records=[],this.max=Number.MIN_SAFE_INTEGER}recalculate(){this.max=Number.MIN_SAFE_INTEGER,this._formatedValue=void 0;for(let t=0;t<this.records.length;t++){const e=this.records[t];"Aggregator"===e.className?this.max=e.max>this.max?e.max:this.max:"number"==typeof e?this.max=e>this.max?e:this.max:"number"==typeof e[this.field]?this.max=e[this.field]>this.max?e[this.field]:this.max:isNaN(e[this.field])||(this.max=parseFloat(e[this.field])>this.max?parseFloat(e[this.field]):this.max)}}}class sA extends JS{type=nC.MIN;min=Number.MAX_SAFE_INTEGER;push(t){this.isRecord&&("Aggregator"===t.className?this.records.push(...t.records):this.records.push(t)),"Aggregator"===t.className?this.min=t.min<this.min?t.min:this.min:"number"==typeof t?this.min=t<this.min?t:this.min:"number"==typeof t[this.field]&&(this.min=t[this.field]<this.min?t[this.field]:this.min)}value(){return this.min}reset(){this.records=[],this.min=Number.MAX_SAFE_INTEGER}recalculate(){this.min=Number.MAX_SAFE_INTEGER,this._formatedValue=void 0;for(let t=0;t<this.records.length;t++){const e=this.records[t];"Aggregator"===e.className?this.min=e.min<this.min?e.min:this.min:"number"==typeof e?this.min=e<this.min?e:this.min:"number"==typeof e[this.field]&&(this.min=e[this.field]<this.min?e[this.field]:this.min)}}}function aA(t,e){return t&&e?t.toString().localeCompare(e.toString(),"zh"):t?1:-1}function lA(t,e){const i=/(\d+)|(\D+)/g,r=/\d/,o=/^0/;let n,s,a,l,h=0,c=0;if(null!==e&&null===t)return-1;if(null!==t&&null===e)return 1;if("number"==typeof t&&isNaN(t))return-1;if("number"==typeof e&&isNaN(e))return 1;if(h=+t,c=+e,h<c)return-1;if(h>c)return 1;if("number"==typeof t&&"number"!=typeof e)return-1;if("number"==typeof e&&"number"!=typeof t)return 1;if("number"==typeof t&&"number"==typeof e)return 0;if(isNaN(c)&&!isNaN(h))return-1;if(isNaN(h)&&!isNaN(c))return 1;if(n=String(t),a=String(e),n===a)return 0;if(!r.test(n)||!r.test(a))return n>a?1:-1;for(n=n.match(i),a=a.match(i);n.length&&a.length;)if(s=n.shift(),l=a.shift(),s!==l)return r.test(s)&&r.test(l)?s.replace(o,".0")-l.replace(o,".0"):s>l?1:-1;return n.length-a.length}const hA={SOURCE_LENGTH_UPDATE:"source_length_update",CHANGE_ORDER:"change_order"};function cA(t,e){const i=hw(t);if(cw(i)){const t=i.then((t=>(e(t),t)));return e(t),t}return i}function dA(t,e,i,r,o,n){if(null==t)return;if(cw(t))return t.then((t=>dA(t,e,i,r,o,n)));const s=function(t){if(fw.isObject(t)){const e=t;if(Y(e.get)&&Y(e.set))return!0}return!1}(e)?e.get:e;if(s in t){return cA(t[s],n)}if("function"==typeof s){return cA(s(t,i,r,o),n)}if(Array.isArray(s)){const e=function(t,e){let i,r=t;for(;i=e.shift();)r=r[i];return r}(t,[...s]);return cA(e,n)}const a=`${s}`.split(".");if(a.length<=1){return cA(t[s],n)}return cA(aw(t,((t,e)=>dA(t,e,i,r,o,Cw)),...a),n)}function uA(t,e){if(!t)return e;const i=t[e];return Y(i)?i:e}class gA extends gC{dataConfig;dataSourceObj;_get;_sourceLength;_source;sortedIndexMap;lastOrder;lastOrderFn;lastOrderField;currentIndexedData=[];userPagination;pagination;_currentPagerIndexedData;hierarchyExpandLevel=0;static get EVENT_TYPE(){return hA}hasHierarchyStateExpand=!1;beforeChangedRecordsMap=[];registedAggregators={};rowHierarchyType;fieldAggregators=[];layoutColumnObjects=[];lastFilterRules;constructor(t,e,i,r,o,n){super(),this.registerAggregators(),this.dataSourceObj=t,this.dataConfig=e,this._get=t?.get,this.layoutColumnObjects=r,this._source=t?.records?this.processRecords(t?.records):t,this._sourceLength=this._source?.length||0,this.sortedIndexMap=new Map,this._currentPagerIndexedData=[],this.userPagination=i,this.pagination=i||{totalCount:this._sourceLength,perPageCount:this._sourceLength,currentPage:0},n>=1&&(this.hierarchyExpandLevel=n),this.currentIndexedData=Array.from({length:this._sourceLength},((t,e)=>e)),"tree"===o&&this.initTreeHierarchyState(),this.rowHierarchyType=o,this.updatePagerData()}initTreeHierarchyState(){this.currentIndexedData=Array.from({length:this._sourceLength},((t,e)=>e));let t=this._sourceLength;for(let e=0;e<t;e++){const i=this.currentIndexedData[e],r=this.getOriginalRecord(i),o=r.filteredChildren??r.children;if(o?.length>0){if(this.hierarchyExpandLevel>1?!r.hierarchyState&&(r.hierarchyState=oC.expand):!r.hierarchyState&&(r.hierarchyState=oC.collapse),this.hasHierarchyStateExpand=!0,r.hierarchyState===oC.collapse)continue;const o=this.initChildrenNodeHierarchy(i,this.hierarchyExpandLevel,2,r);e+=o,t+=o}else!0===r.children&&!r.hierarchyState&&(r.hierarchyState=oC.collapse)}}registerAggregator(t,e){this.registedAggregators[t]=e}registerAggregators(){this.registerAggregator(nC.RECORD,QS),this.registerAggregator(nC.SUM,iA),this.registerAggregator(nC.COUNT,rA),this.registerAggregator(nC.MAX,nA),this.registerAggregator(nC.MIN,sA),this.registerAggregator(nC.AVG,oA),this.registerAggregator(nC.NONE,tA),this.registerAggregator(nC.CUSTOM,eA)}_generateFieldAggragations(){const t=this.layoutColumnObjects;for(let e=0;e<t?.length;e++){t[e].aggregator=null;const i=t[e].field,r=t[e].aggregation;if(r)if(Array.isArray(r))for(let o=0;o<r.length;o++){const n=r[o],s=new this.registedAggregators[n.aggregationType](i,n.formatFun,!0,n.aggregationFun);this.fieldAggregators.push(s),t[e].aggregator||(t[e].aggregator=[]),t[e].aggregator.push(s)}else{const o=new this.registedAggregators[r.aggregationType](i,r.formatFun,!0,r.aggregationFun);this.fieldAggregators.push(o),t[e].aggregator=o}}}processRecords(t){this._generateFieldAggragations();const e=[],i=this.fieldAggregators.length>=1;if(this.dataConfig?.filterRules?.length>=1||this.lastFilterRules?.length>=1||i){for(let r=0,o=t.length;r<o;r++){const o=t[r];this.dataConfig?.filterRules?.length>=1?this.filterRecord(o)&&(e.push(o),"tree"===this.rowHierarchyType&&o.children&&(o.filteredChildren=this.filteredChildren(o.children)),i&&this.processRecord(o)):this.lastFilterRules?.length>=1?(this.clearFilteredChildren(o),i&&this.processRecord(o)):i&&this.processRecord(o)}if(this.dataConfig?.filterRules?.length>=1)return e}return t}filteredChildren(t){const e=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];this.filterRecord(r)&&(e.push(r),r.children&&(r.filteredChildren=this.filteredChildren(r.children)))}return e}processRecord(t){for(let e=0;e<this.fieldAggregators.length;e++){this.fieldAggregators[e].push(t)}}initChildrenNodeHierarchy(t,e,i,r){let o=0;const n=r.filteredChildren?r.filteredChildren.length:r.children?.length??0;for(let s=0;s<n;s++){(i<=e||r.hierarchyState===oC.expand)&&(o+=1);const n=r.filteredChildren?r.filteredChildren[s]:r.children[s],a=Array.isArray(t)?t.concat(s):[t,s];(i<=e||r.hierarchyState===oC.expand)&&this.currentIndexedData.splice(this.currentIndexedData.indexOf(t)+o,0,a),(n.filteredChildren?n.filteredChildren.length>0:n.children?.length>0)&&(i<e||n.hierarchyState===oC.expand?(!n.hierarchyState&&(n.hierarchyState=oC.expand),this.hasHierarchyStateExpand=!0):!n.hierarchyState&&(n.hierarchyState=oC.collapse)),n.hierarchyState===oC.expand&&(o+=this.initChildrenNodeHierarchy(a,e,i+1,n))}return o}updatePagination(t){this.pagination=t||{totalCount:this._sourceLength,perPageCount:this._sourceLength,currentPage:0},this.updatePagerData()}updatePagerData(){const{currentIndexedData:t}=this,{perPageCount:e,currentPage:i}=this.pagination,r=e*(i||0),o=r+e;if(this._currentPagerIndexedData.length=0,t&&t.length>0){let e=-1;for(let i=0;i<t.length;i++)if((Array.isArray(t[i])&&1===t[i].length||!Array.isArray(t[i]))&&e++,e>=r&&e<o)this._currentPagerIndexedData.push(t[i]);else if(e>=o)break}else if(this._sourceLength>0)throw new Error("currentIndexedData should has values!")}get records(){return Array.isArray(this._source)?this._source:[]}get source(){return this._source}get(t){return this.getOriginalRecord(uA(this.currentPagerIndexedData,t))}getRaw(t){return this.getRawRecord(uA(this.currentPagerIndexedData,t))}getIndexKey(t){return uA(this.currentPagerIndexedData,t)}getTableIndex(t){return Array.isArray(t)?this.currentPagerIndexedData.findIndex((e=>Tt(e,t))):this.currentPagerIndexedData.findIndex((e=>e===t))}getField(t,e,i,r,o){return this.getOriginalField(uA(this.currentPagerIndexedData,t),e,i,r,o)}getRawField(t,e,i,r,o){return this.getRawFieldData(uA(this.currentPagerIndexedData,t),e,i,r,o)}hasField(t,e){return this.hasOriginalField(uA(this.currentPagerIndexedData,t),e)}getHierarchyState(t){const e=this.getOriginalRecord(this.currentIndexedData[t]);return e?.hierarchyState??null}toggleHierarchyState(t,e,i){const r=this.currentIndexedData.slice(0),o=this.getIndexKey(t),n=this.getHierarchyState(t),s=this.getOriginalRecord(o);if(this.clearSortedIndexMap(),n===oC.collapse)s.hierarchyState=oC.expand,this.pushChildrenNode(o,oC.expand,s),this.hasHierarchyStateExpand=!0;else if(n===oC.expand){let t=0;const e=(i,r,o)=>{if(!r||r===oC.collapse||r===oC.none)return;const n=o.filteredChildren?o.filteredChildren:o.children;if(n)for(let r=0;r<n.length;r++){t+=1;const o=Array.isArray(i)?i.concat([r]):[i,r];e(o,n[r].hierarchyState,n[r])}};e(o,n,s),this.currentIndexedData.splice(this.currentIndexedData.indexOf(o)+1,t),s.hierarchyState=oC.collapse}this.updatePagerData();const a=[],l=[];if(n===oC.collapse){const e=this.currentIndexedData.length-r.length;for(let i=0;i<e;i++)a.push(t+i+1)}else if(n===oC.expand){const e=r.length-this.currentIndexedData.length;for(let i=0;i<e;i++)l.push(t+i+1)}return{add:a,remove:l}}pushChildrenNode(t,e,i){if(!e||e===oC.collapse||e===oC.none)return 0;let r=0;const o=i.filteredChildren?i.filteredChildren:i.children;if(o){const e=Array.from({length:o.length},((t,e)=>e));this.lastOrder&&"normal"!==this.lastOrder&&this.lastOrderField&&ZS((t=>Y(e[t])?e[t]:e[t]=t),((t,i)=>{e[t]=i}),o.length,this.lastOrderFn,this.lastOrder,(e=>this.getOriginalField(Array.isArray(t)?t.concat([e]):[t,e],this.lastOrderField)));for(let i=0;i<e.length;i++){r+=1;const n=Array.isArray(t)?t.concat([e[i]]):[t,e[i]];this.currentIndexedData.splice(this.currentIndexedData.indexOf(t)+r,0,n);const s=this.getOriginalRecord(n);!s.hierarchyState&&(s.filteredChildren??s.children)&&(s.hierarchyState=oC.collapse),r+=this.pushChildrenNode(n,s.hierarchyState,o[e[i]])}}return r}changeFieldValue(t,e,i,r,o,n){if(null!==i&&e>=0){const r=this.getIndexKey(e);if(!this.beforeChangedRecordsMap[r]){const t=this.getOriginalRecord(r);this.beforeChangedRecordsMap[r]=mt(t)}if("string"==typeof i||"number"==typeof i){const e=this.beforeChangedRecordsMap[r][i],o=this.getOriginalRecord(r);let n=t;"number"==typeof e&&YC(t)&&(n=parseFloat(t)),cw(o)?o.then((t=>{t[i]=n})).catch((t=>{})):o[i]=n}}}setRecord(t,e){let i=!0;if(this.dataConfig?.filterRules?.length>=1&&(this.filterRecord(t)?"tree"===this.rowHierarchyType&&t.children&&(t.filteredChildren=this.filteredChildren(t.children)):i=!1),i&&Array.isArray(this.records)){const i=this.getIndexKey(e);Array.isArray(i)||this.records.splice(i,1,t)}}addRecord(t,e){if(Array.isArray(this.records)){if(this.records.splice(e,0,t),this.currentIndexedData.push(this.currentIndexedData.length),this._sourceLength+=1,"tree"===this.rowHierarchyType&&this.initTreeHierarchyState(),this.userPagination){this.pagination.totalCount=this._sourceLength;const{perPageCount:t,currentPage:i}=this.pagination;e<t*(i||0)+t&&this.updatePagerData()}else this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength,this.updatePagerData();this.dataSourceObj?.added&&this.dataSourceObj.added(e,1)}}addRecords(t,e){if(Array.isArray(this.records)){if(Array.isArray(t)){this.records.splice(e,0,...t);for(let e=0;e<t.length;e++)this.currentIndexedData.push(this.currentIndexedData.length);this._sourceLength+=t.length}if(this.userPagination){this.pagination.totalCount=this._sourceLength;const{perPageCount:t,currentPage:i}=this.pagination;e<t*(i||0)+t&&this.updatePagerData()}else this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength,this.updatePagerData();this.dataSourceObj?.added&&this.dataSourceObj.added(e,t.length)}}addRecordForSorted(t){Array.isArray(this.records)&&(this.records.push(t),this.currentIndexedData.push(this.currentIndexedData.length),this._sourceLength+=1,this.sortedIndexMap.clear(),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength))}addRecordsForSorted(t){if(Array.isArray(this.records)){if(Array.isArray(t)){this.records.push(...t);for(let e=0;e<t.length;e++)this.currentIndexedData.push(this.currentIndexedData.length);this._sourceLength+=t.length,this.sortedIndexMap.clear()}this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength)}}deleteRecords(t){if(Array.isArray(this.records)){const e=[],i=t.sort(((t,e)=>e-t));for(let t=0;t<i.length;t++){const r=i[t];r>=this._sourceLength||r<0||(e.push(r),this.records.splice(r,1),this.currentIndexedData.pop(),this._sourceLength-=1)}return this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength),this.updatePagerData(),this.dataSourceObj?.deleted&&this.dataSourceObj.deleted(e),e}return[]}deleteRecordsForSorted(t){if(Array.isArray(this.records)){const e=t.sort(((t,e)=>e-t));for(let t=0;t<e.length;t++){const i=e[t];if(i>=this._sourceLength||i<0)continue;const r=this.currentIndexedData[i];this.records.splice(r,1),this._sourceLength-=1}this.sortedIndexMap.clear(),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength)}}updateRecords(t,e){const i=[];for(let r=0;r<e.length;r++){const o=e[r];o>=this._sourceLength||o<0||(i.push(o),this.records[o]=t[r])}return this.userPagination&&this.updatePagerData(),i}updateRecordsForSorted(t,e){for(let i=0;i<e.length;i++){const r=e[i];if(r>=this._sourceLength||r<0)continue;const o=this.currentIndexedData[r];if("number"!=typeof o)return;this.records[o]=t[i]}this.sortedIndexMap.clear()}sort(t,e,i=("desc"!==e?(t,e)=>t===e?0:t>e?1:-1:(t,e)=>t===e?0:t<e?1:-1)){this.lastOrderField=t,this.lastOrder=e,this.lastOrderFn=i;let r,o=this.sortedIndexMap.get(t);if(o&&(r=o[e],r&&r.length>0))return this.currentIndexedData=r,this.updatePagerData(),void this.fireListeners(hA.CHANGE_ORDER,null);const n=[];if("normal"===e)for(let t=0;t<this._sourceLength;t++)n[t]=t;else ZS((t=>Y(n[t])?n[t]:n[t]=t),((t,e)=>{n[t]=e}),this._sourceLength,i,e,(e=>this.getOriginalField(e,t)));if(this.currentIndexedData=n,this.hierarchyExpandLevel){let t=n.length;window.performance.now();for(let e=0;e<t;e++){const i=this.getOriginalRecord(n[e]),r=this.pushChildrenNode(n[e],i.hierarchyState,this.getOriginalRecord(n[e]));t+=r,e+=r}}o||(o={asc:[],desc:[],normal:[]},this.sortedIndexMap.set(t,o)),o[e]=n,this.updatePagerData(),this.fireListeners(hA.CHANGE_ORDER,null)}clearFilteredChildren(t){t.filteredChildren=void 0;for(let e=0;e<t.children?.length;e++)this.clearFilteredChildren(t.children[e])}filterRecord(t){let e=!0;for(let i=0;i<this.dataConfig.filterRules?.length;i++){const r=this.dataConfig?.filterRules[i];if(r.filterKey){const i=t[r.filterKey];if(-1===r.filteredValues.indexOf(i)){e=!1;break}}else if(!r.filterFunc?.(t)){e=!1;break}}return e}updateFilterRulesForSorted(t){this.lastFilterRules=this.dataConfig.filterRules,this.dataConfig.filterRules=t,this._source=this.processRecords(this.dataSourceObj?.records??this.dataSourceObj),this._sourceLength=this._source?.length||0,this.sortedIndexMap.clear(),this.currentIndexedData=Array.from({length:this._sourceLength},((t,e)=>e)),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength)}updateFilterRules(t){this.lastFilterRules=this.dataConfig.filterRules,this.dataConfig.filterRules=t,this._source=this.processRecords(this.dataSourceObj?.records??this.dataSourceObj),this._sourceLength=this._source?.length||0,this.currentIndexedData=Array.from({length:this._sourceLength},((t,e)=>e)),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength,"tree"===this.rowHierarchyType&&this.initTreeHierarchyState()),this.updatePagerData()}clearSortedIndexMap(){this.lastOrderField&&this.lastOrder&&this.sortedIndexMap.forEach(((t,e)=>{e!==this.lastOrderField?this.sortedIndexMap.delete(e):"asc"===this.lastOrder?(t.desc=[],t.normal=[]):"desc"===this.lastOrder?(t.asc=[],t.normal=[]):(t.desc=[],t.asc=[])}))}get sourceLength(){return this._sourceLength}set sourceLength(t){this._sourceLength!==t&&(this._sourceLength=t,this.fireListeners(hA.SOURCE_LENGTH_UPDATE,this._sourceLength))}get length(){return this.currentPagerIndexedData.length}get dataSource(){return this}get currentPagerIndexedData(){return this._currentPagerIndexedData.length>0?this._currentPagerIndexedData:[]}release(){super.release?.(),this.lastFilterRules=null}clearSortedMap(){this.currentIndexedData&&(this.currentIndexedData.length=0),this.currentIndexedData=null,this.sortedIndexMap.forEach((t=>{t.asc&&(t.asc.length=0),t.desc&&(t.desc.length=0)})),this.sortedIndexMap.clear()}clearCurrentIndexedData(){this.currentIndexedData=null,this.currentPagerIndexedData.length=0}getOriginalRecord(t){let e;return e=this.dataSourceObj.records?Array.isArray(t)?pA(this.records,t):this.records[t]:this._get(t),cA(e,(e=>{this.recordPromiseCallBack(t,e)}))}getRawRecord(t){if(this.beforeChangedRecordsMap?.[t])return this.beforeChangedRecordsMap[t];let e;return e=this.dataSourceObj.records?Array.isArray(t)?pA(this.records,t):this.records[t]:this._get(t),cA(e,(e=>{this.recordPromiseCallBack(t,e)}))}getOriginalField(t,e,i,r,o){if(null===e)return;return dA(this.getOriginalRecord(t),e,i,r,o,(i=>{this.fieldPromiseCallBack(t,e,i)}))}getRawFieldData(t,e,i,r,o){if(null===e)return;return dA(this.getRawRecord(t),e,i,r,o,(i=>{this.fieldPromiseCallBack(t,e,i)}))}hasOriginalField(t,e){if(null===e)return!1;if("function"==typeof e)return!0;const i=this.getOriginalRecord(t);return Boolean(i&&e in i)}fieldPromiseCallBack(t,e,i){}recordPromiseCallBack(t,e){}static EMPTY=new gA({get(){},length:0});isCanExchangeOrder(t,e){if(this.hasHierarchyStateExpand){let i=this.currentPagerIndexedData[t],r=this.currentPagerIndexedData[e];if(i=Array.isArray(i)?[...i]:[i],r=Array.isArray(r)?[...r]:[r],e>t&&r.length>i.length){let t=this.currentPagerIndexedData[e+1];t=Array.isArray(t)?[...t]:[t],t.length<r.length&&r.splice(r.length-1,1)}if(i.length===r.length){for(let t=0;t<=i.length-2;t++)if(i[t]!==r[t])return!1;return!0}return!1}return!0}reorderRecord(t,e){if("asc"!==this.lastOrder&&"desc"!==this.lastOrder&&this.isCanExchangeOrder(t,e))if(this.hasHierarchyStateExpand){let i,r,o=this.currentPagerIndexedData[t],n=this.currentPagerIndexedData[e];if(o=Array.isArray(o)?[...o]:[o],n=Array.isArray(n)?[...n]:[n],o.length>1||n.length>1){if(e>t&&n.length>o.length){let t=this.currentPagerIndexedData[e+1];t=Array.isArray(t)?[...t]:[t],t.length<n.length&&n.splice(n.length-1,1)}if(i=o.splice(o.length-1,1)[0],r=n.splice(n.length-1,1)[0],o.length>=1){const t=this.getOriginalRecord(o),e=t.filteredChildren?t.filteredChildren.splice(i,1):t.children.splice(i,1);e.unshift(r,0),Array.prototype.splice.apply(t.filteredChildren??t.children,e)}else{const t=this.records.splice(i,1);t.unshift(r,0),Array.prototype.splice.apply(this.records,t)}}else{i=this.currentPagerIndexedData[t],r=this.currentPagerIndexedData[e];const o=this.records.splice(i,1);o.unshift(r,0),Array.prototype.splice.apply(this.records,o)}this.restoreTreeHierarchyState(),this.updatePagerData()}else{const i=this.records.splice(t,1);i.unshift(e,0),Array.prototype.splice.apply(this.records,i)}}restoreTreeHierarchyState(){if(this.hierarchyExpandLevel){for(let t=0;t<this._sourceLength;t++){const e=this.getOriginalRecord(t);(e.filteredChildren??e.children)&&!e.hierarchyState&&(e.hierarchyState=oC.collapse)}this.currentIndexedData=Array.from({length:this._sourceLength},((t,e)=>e));let t=this._sourceLength;for(let e=0;e<t;e++){const i=this.currentIndexedData[e],r=this.getOriginalRecord(i),o=r.filteredChildren??r.children;if(o?.length>0&&r.hierarchyState===oC.expand){this.hasHierarchyStateExpand=!0;const o=this.restoreChildrenNodeHierarchy(i,r);e+=o,t+=o}else!0===r.children&&!r.hierarchyState&&(r.hierarchyState=oC.collapse)}}}restoreChildrenNodeHierarchy(t,e){let i=0;const r=e.filteredChildren??e.children,o=r?.length??0;for(let n=0;n<o;n++){e.hierarchyState===oC.expand&&(i+=1);const o=r[n],s=Array.isArray(t)?t.concat(n):[t,n];e.hierarchyState===oC.expand&&this.currentIndexedData.splice(this.currentIndexedData.indexOf(t)+i,0,s),i+=this.restoreChildrenNodeHierarchy(s,o)}return i}}function pA(t,e){let i=t;for(let t=0;t<e.length;t++){const r=e[t];if(!i[r])return;i=i[r];const o=i.filteredChildren??i?.children;o&&t+1<e.length&&(i=o)}return i}class fA extends gA{_recordCache;_fieldCache;static get EVENT_TYPE(){return gA.EVENT_TYPE}static ofArray(t,e,i,r,o,n){return new fA({get:e=>t[e],length:t.length,records:t},e,i,r,o,n)}constructor(t,e,i,r,o,n){super(t,e,i,r,o,n),this._recordCache=[],this._fieldCache={}}getOriginalRecord(t){return this._recordCache&&this._recordCache[t]?this._recordCache[t]:super.getOriginalRecord(t)}getOriginalField(t,e,i,r,o){const n=this._fieldCache&&this._fieldCache[t];if(n){const t=n.get(e);if(t)return t}return super.getOriginalField(t,e,i,r,o)}clearCache(){this._recordCache&&(this._recordCache=[]),this._fieldCache&&(this._fieldCache={})}fieldPromiseCallBack(t,e,i){!function(t,e,i,r){(t[e]||(t[e]=new Map)).set(i,r)}(this._fieldCache,t,e,i)}recordPromiseCallBack(t,e){this._recordCache[t]=e}get records(){return Array.isArray(this._recordCache)&&this._recordCache.length>0?this._recordCache:super.records}release(){super.release?.(),this._recordCache=null,this._fieldCache=null}}var mA=Object.freeze({__proto__:null,CachedDataSource:fA,DataSource:gA}),bA={exports:{}},yA={},CA=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))","?\\s*([-,\\\"\\'\\sa-z]+?)\\s*$"].join(""),"i"),wA=["style","variant","weight","size","lineHeight","family"],vA=/([\.0-9]+)(.*)/,xA=function(t,e,i){var r=t.match(vA);if(r){t=parseFloat(r[1]);var o=r[2].toLowerCase().trim(),n=Math.round(t);switch(n===t&&(t=n),o){case"em":if(null===e)return;return t*e;case"px":return t;case"pt":return t/(72/i);case"pc":return t/(6/i);case"mm":return t*(i/25.4);case"cm":return t*(i/2.54);case"in":return t*i;case"%":if(null===e)return;return e*(t/100)}}},_A={size:xA,lineHeight:xA},SA={serif:1,"sans-serif":1,cursive:1,fantasy:1,monospace:1},AA=bA.exports=function(t,e,i){var r=t+"-"+(e||"null")+"@"+i;if(i=i||96,void 0!==yA[r])return yA[r];if(e&&(e=AA(e,null,i)),"inherit"===t)return e;var o=CA.exec(t);if(o){o.shift();for(var n={},s=0;s<o.length;s++){var a=wA[s],l=o[s];if(_A[a]&&l){var h=e&&e[a]||null,c=_A[a](l,h,i);l=void 0===c&&"lineHeight"===a&&l?n.size*parseFloat(l):c}if(l&&"normal"!==l){if("inherit"===l){if(!e)return;l=e[a]}l.trim&&(l=l.trim()),n[a]=l}}Object.keys(n).length||(n=null),yA[r]=n;var d=[];n.style&&d.push(n.style),n.variant&&d.push(n.variant),n.weight&&"400"!==n.weight&&"normal"!==n.weight&&d.push(n.weight),d.push(n.size+"px"),n.lineHeight&&(d[d.length-1]+="/"+n.lineHeight+"px");var u=n.family.split(",");return n.family=u.map((function(t){return t=t.trim(),SA[t.toLowerCase()]&&(t=t.toLowerCase()),t})),d.push(n.family),Object.defineProperty(n,"toString",{value:function(){return d.map((function(t){return Array.isArray(t)?t.map((function(t){return t.indexOf(" ")>-1?'"'+t.replace(/["']/g,"")+'"':t})).join(", "):t})).join(" ")}}),n}yA[r]=null};bA.exports.generics=SA;var RA=G(bA.exports);function BA(t){if(ot(t)||tt(t)||et(t)){let e=Xo(t);return"number"==typeof e||"string"==typeof e?e=[e,e,e,e]:Array.isArray(e)&&(e=e.slice(0)),e}return t&&(isFinite(t.bottom)||isFinite(t.left)||isFinite(t.right)||isFinite(t.top))?[t.top??0,t.right??0,t.bottom??0,t.left??0]:[0,0,0,0]}const MA=0,TA=1,PA=2,HA=3,EA=10,kA=11,LA=12,FA=9,IA=13,zA=10,OA=12,DA=32,WA=37,NA=46,GA=48,jA=57,VA=65,UA=90,KA=97,$A=122;function XA(t){return function(t){return t>=KA&&t<=$A}(t)||function(t){return t>=VA&&t<=UA}(t)}function YA(t){return t===FA||t===zA||t===OA||t===IA||t===DA}function qA(t){return t>=GA&&t<=jA}function ZA(t){return t===NA}function JA(t){return XA(t)||t===WA}function QA(t){return new Error(`calc parse error: ${t}`)}const tR={"*":3,"/":3,"+":2,"-":2};function eR(t,e){function i(t){const i=t.pop(),r=t.pop(),o=t.pop();if(!(o&&o.nodeType&&r&&r.type===PA&&i&&i.nodeType))throw QA(e);return{nodeType:kA,left:o,op:r,right:i}}const r=[];for(;t.length;){const o=t.shift();if(o.type===MA&&"("===o.value){let i=0;const o=tw.findIndex(t,(t=>{if(t.type===MA&&"("===t.value)i++;else if(t.type===MA&&")"===t.value){if(!i)return!0;i--}return!1}));if(-1===o)throw QA(e);r.push(eR(t.splice(0,o),e)),t.shift()}else if(o.type===PA){if(r.length>=3){const t=r[r.length-2].value;tR[o.value]<=tR[t]&&r.push(i(r))}r.push(o)}else if(o.type===TA){const{value:t,unit:e}=o;r.push({nodeType:EA,value:t,unit:e})}else o.type===HA&&r.push({nodeType:LA,value:o.value})}for(;r.length>1;)r.push(i(r));return r[0]}function iR(t){const e=function(t){const e=t.replace(/calc\(/g,"(").trim(),i=[],r=e.length;for(let s=0;s<r;s++){const r=e[s],a=r.charCodeAt(0);if("("===r||")"===r)i.push({value:r,type:MA});else if("*"===r||"/"===r)i.push({value:r,type:PA});else if("+"===r||"-"===r)s=o(r,s+1)-1;else if(qA(a)||ZA(a))s=n(r,s+1)-1;else if(!YA(a))throw QA(t)}function o(t,o){if(o<r){const i=e[o],r=i.charCodeAt(0);if(qA(r)||ZA(r))return n(t+i,o+1)}return i.push({value:t,type:PA}),o}function n(o,n){let a=n;for(;a<r;a++){const i=e[a],r=i.charCodeAt(0);if(qA(r))o+=i;else{if("."!==i){if(JA(r))return s(o,i,a+1);break}if(o.indexOf(".")>=0)throw QA(t);o+=i}}if("."===o)throw QA(t);return i.push({value:parseFloat(o),type:HA}),a}function s(t,o,n){let s=n;for(;s<r;s++){const t=e[s];if(!JA(t.charCodeAt(0)))break;o+=t}return i.push({value:parseFloat(t),unit:o,type:TA}),s}return i}(t);return eR(e,t)}function rR(t,e){if(t.nodeType===kA){const i=rR(t.left,e),r=rR(t.right,e);switch(t.op.value){case"+":return i+r;case"-":return i-r;case"*":return i*r;case"/":return i/r;default:throw new Error(`calc error. unknown operator: ${t.op.value}`)}}else if(t.nodeType===EA)switch(t.unit){case"%":return t.value*e.full/100;case"px":return t.value;default:throw new Error(`calc error. unknown unit: ${t.unit}`)}else if(t.nodeType===LA)return t.value;throw new Error("calc error.")}function oR(t,e){return rR(iR(t),e)}function nR(t){return!!tt(t)&&(!!t.endsWith("%")&&function(t){return!(X(t)||!ot(t)&&+t!=+t)}(t.substring(0,t.length-1)))}function sR(t,e){const{dataSourceEventIds:i}=t.internalProps;i&&i.forEach((e=>t.internalProps.handler.off(e))),e(t),t.internalProps.dataSourceEventIds=[t.internalProps.handler.on(t.internalProps.dataSource,gA.EVENT_TYPE.CHANGE_ORDER,(()=>{t.dataSource.hierarchyExpandLevel&&t.refreshRowColCount(),t.render()}))]}function aR(t,e=[]){sR(t,(()=>{t.internalProps.records=e;const i=t.internalProps.dataSource=fA.ofArray(e,t.internalProps.dataConfig,t.pagination,t.internalProps.layoutMap.columnObjects,t.internalProps.layoutMap.rowHierarchyType,t.options.hierarchyExpandLevel??(t._hasHierarchyTreeHeader?.()?1:void 0));t.addReleaseObj(i)}))}function lR(t,e){sR(t,(()=>{if(e)if(e instanceof gA)t.internalProps.dataSource=e;else{const i=t.internalProps.dataSource=new fA(e);t.addReleaseObj(i)}else t.internalProps.dataSource=gA.EMPTY;t.internalProps.records=null}))}function hR(t,e){return Math.round((i=e,r=t.internalProps.calcWidthContext,"string"==typeof i?oR(i.trim(),r):i-0));var i,r}function cR(t,e,i,r,o,n=!0){const s=BA(o("padding",t,i,r,e)),a=o("bgColor",t,i,r,e),l=o("font",t,i,r,e);let h,c,d,u,g;if(l){const{family:t,size:e,weight:i,style:r,variant:o}=function(t){return RA(t)}(l);h=t.join(" "),c=e,d=i,u=r,u=o}else h=o("fontFamily",t,i,r,e),c=o("fontSize",t,i,r,e),d=o("fontWeight",t,i,r,e),u=o("fontStyle",t,i,r,e),g=o("fontVariant",t,i,r,e);const p=o("textAlign",t,i,r,e),f=o("textBaseline",t,i,r,e),m=o("color",t,i,r,e),b=o("lineHeight",t,i,r,e),y=o("underline",t,i,r,e),C=o("underlineDash",t,i,r,e),w=o("underlineOffset",t,i,r,e),v=o("lineThrough",t,i,r,e),x=Math.max(1,Math.floor(c/10)),_=o("textOverflow",t,i,r,e),S=o("borderColor",t,i,r,e),A=o("borderLineWidth",t,i,r,e),R=o("borderLineDash",t,i,r,e),B=o("marked",t,i,r,e),M=o("cursor",t,i,r,e),T=!(s&&a&&l&&p&&f&&m&&_&&S&&A&&R&&"boolean"==typeof y&&"boolean"==typeof v&&"boolean"==typeof B);if(!n)return{hasFunctionPros:T};const P={text:{fontFamily:h,fontSize:c,fontWeight:d,fontStyle:u,fontVariant:g,fill:m,textAlign:p,textBaseline:f,lineHeight:b??c,underline:y?x:void 0,underlineDash:C,underlineOffset:w,lineThrough:v?x:void 0,ellipsis:_&&"clip"!==_?"ellipsis"===_?"...":_:void 0},group:{fill:a,lineDash:R,lineWidth:A,stroke:S,cursor:"auto"===M||"default"===M?void 0:M},_vtable:{padding:s,marked:B}};if(Array.isArray(A)&&(P.group.strokeArrayWidth=BA(A)),Array.isArray(S)){const t=BA(S);P.group.stroke=!t.every((t=>!t))&&t,P.group.strokeArrayColor=BA(S)}return{theme:P,hasFunctionPros:T}}function dR(t){if(t.sortState){let e,i;if(Array.isArray(t.sortState)?0!==t.sortState.length&&({order:e,field:i}=t.sortState?.[0]):({order:e,field:i}=t.sortState),e&&i&&"normal"!==e){const r=t._getSortFuncFromHeaderOption(void 0,i),o=t.internalProps.layoutMap.headerObjects.find((t=>t&&t.field===i));t.dataSource.sort(o.field,e,r??XC)}}}function uR(t,e,i){const r=i.theme.frameStyle.cornerRadius;if(r){if(0===t&&0===e)return[r,0,0,0];if(t===i.colCount-1&&0===e)return[0,r,0,0];if(0===t&&e===i.rowCount-1)return[0,0,0,r];if(t===i.colCount-1&&e===i.rowCount-1)return[0,0,r,0]}return 0}function gR(t){if(t){if(Array.isArray(t)){let e;for(let i=0;i<t.length;i++)if(t[i].autoRange){if("sum"===t[i].y||"sum"===t[i].x||"sum"===t[i].y1||"sum"===t[i].x1)return"sum";"max"!==t[i].y&&"max"!==t[i].x&&"max"!==t[i].y1&&"max"!==t[i].x1||(e="max"),"number"==typeof t[i].y&&"number"==typeof(e??0)&&(e=Math.max(e??0,t[i].y)),"number"==typeof t[i].x&&"number"==typeof(e??0)&&(e=Math.max(e??0,t[i].x)),"number"==typeof t[i].y1&&"number"==typeof(e??0)&&(e=Math.max(e??0,t[i].y1)),"number"==typeof t[i].x1&&"number"==typeof(e??0)&&(e=Math.max(e??0,t[i].x1))}return e}if(t.autoRange){if("sum"===t.y||"sum"===t.x||"sum"===t.y1||"sum"===t.x1)return"sum";if("max"===t.y||"max"===t.x||"max"===t.y1||"max"===t.x1)return"max";if("number"==typeof t.y)return t.y;if("number"==typeof t.x)return t.x;if("number"==typeof t.y1)return t.y1;if("number"==typeof t.x1)return t.x1}}}let pR=class extends Sl{role;tooltip;constructor(t){super(t),"mouseenter_cell"!==this.attribute.visibleTime&&"click_cell"!==this.attribute.visibleTime||(this.attribute.opacity=0),this.attribute.hoverImage&&(this.attribute.originImage=this.attribute.image)}get backgroundWidth(){return this.attribute.backgroundWidth??this.attribute.width??0}get backgroundHeight(){return this.attribute.backgroundHeight??this.attribute.height??0}};function fR(t,e,i,r,o,n,s,a,l,h){let c,d,u,g,p=!0,f=!1;if("function"==typeof t){const e=t({col:i,row:r,dataValue:h.getCellOriginValue(i,r),value:h.getCellValue(i,r)||"",rect:{left:0,top:0,right:o,bottom:n,width:o,height:n},table:h});e.rootContainer&&(e.rootContainer=yR(e.rootContainer)),e.rootContainer instanceof hs&&(g=e.rootContainer,g.name="custom-container"),p=e.renderDefault,f=e.enableCellPadding}else if("function"==typeof e){const t=e({col:i,row:r,dataValue:h.getCellOriginValue(i,r),value:h.getCellValue(i,r)||"",rect:{left:0,top:0,right:o,bottom:n,width:o,height:n},table:h});t&&(u=t.elements,p=t.renderDefault,c=t.expectedWidth,d=t.expectedHeight)}else e&&(c=e.expectedWidth,d=e.expectedHeight,u=e.elements,p=e.renderDefault);if(u){g=function(t,e,i,r){const o=new hs({x:0,y:0,width:e,height:i,fill:!1,stroke:!1,pickable:!1});o.name="custom-container";const n=function(t,e,i,r){const o=[],n=0,s=0,a=[0,0,0,0];for(let l=0;l<t.length;l++){const h=t[l],c=Object.assign({},h);for(const t in c)c.hasOwnProperty(t)&&$(c[t])&&(c[t]=c[t](r));const d=c;Y(d.x)&&(d.x=tt(d.x)?mR(d.x,e-a[1]):Number(d.x)),Y(d.y)&&(d.y=tt(d.y)?mR(d.y,i-a[2]):Number(d.y)),"width"in c&&(c.width=tt(c.width)?mR(c.width,e-a[1]):Number(c.width)),"height"in c&&(c.height=tt(c.height)?mR(c.height,i-a[2]):Number(c.height)),"radius"in c&&(c.radius=tt(c.radius)?mR(c.radius,Math.min(e-a[1],i-a[2])):Number(c.radius)),"hover"in c&&(c.hover.x=tt(c.hover.x)?mR(c.hover.x,e-a[1]):Number(c.hover.x),c.hover.y=tt(c.hover.y)?mR(c.hover.y,i-a[2]):Number(c.hover.y),c.hover.width=tt(c.hover.width)?mR(c.hover.width,e-a[1]):Number(c.hover.width),c.hover.height=tt(c.hover.height)?mR(c.hover.height,i-a[2]):Number(c.hover.height),c.hover.x+=n,c.hover.y+=s),d.x=d.x+n,d.y=d.y+s,o.push(c)}return o}(t,e,i,r);return n.forEach((t=>{switch(t.clickable&&(t.pickable=t.clickable),t.type){case"arc":const e=Wl({x:t.x,y:t.y,dx:t.dx??0,dy:t.dy??0,fill:t.fill,stroke:t.stroke,outerRadius:t.radius,startAngle:t.startAngle,endAngle:t.endAngle,pickable:!!t.pickable,cursor:t.cursor});e.name=t.name,o.appendChild(e);break;case"text":if(t.background){const e=t.background?.expandX??0,i=t.background?.expandY??0,r=fl({x:t.x-e,y:t.y-i,dx:t.dx??0,dy:t.dy??0,width:t.width+2*e,height:t.height+2*i,cornerRadius:t.background?.cornerRadius??0,fill:t.background?.fill??"#888"});o.appendChild(r)}const i=new ta(Object.assign({pickable:!!t.pickable,fill:t.color??t.fill},t));i.name=t.name,o.appendChild(i);break;case"rect":const r=fl({x:t.x,y:t.y,dx:t.dx??0,dy:t.dy??0,width:t.width,height:t.height,cornerRadius:t.radius,fill:t.fill,stroke:t.stroke,pickable:!!t.pickable,cursor:t.cursor});r.name=t.name,o.appendChild(r);break;case"circle":const n=Xs({x:t.x,y:t.y,dx:t.dx??0,dy:t.dy??0,radius:t.radius,fill:t.fill,stroke:t.stroke,pickable:!!t.pickable,cursor:t.cursor});n.name=t.name,o.appendChild(n);break;case"icon":const s=new pR({x:t.x,y:t.y,dx:t.dx??0,dy:t.dy??0,width:t.width,height:t.height,image:t.svg,backgroundWidth:t.hover?t.hover.width??t.width:void 0,backgroundHeight:t.hover?t.hover.width??t.width:void 0,backgroundColor:t.hover?t.hover.bgColor??"rgba(22,44,66,0.2)":void 0,pickable:!!t.pickable,cursor:t.cursor});s.name=t.name,s.role="icon-custom",o.appendChild(s);break;case"image":const a=new pR({x:t.x,y:t.y,dx:t.dx??0,dy:t.dy??0,width:t.width,height:t.height,image:t.src,backgroundWidth:t.hover?t.hover.width??t.width:void 0,backgroundHeight:t.hover?t.hover.width??t.width:void 0,backgroundColor:t.hover?t.hover.bgColor??"rgba(22,44,66,0.2)":void 0,pickable:!!t.pickable,cursor:t.cursor,shape:t.shape});a.name=t.name,a.role="image-custom",o.appendChild(a);break;case"line":const l=ul({points:t.points,stroke:t.stroke,pickable:!!t.pickable,cursor:t.cursor});l.name=t.name,o.appendChild(l)}})),o}(u,s?c:o,a?d:n,h.getCellValue(i,r))}return f&&g.setAttributes({x:l[3],y:l[0],width:o-l[1]-l[3],height:n-l[0]-l[2]}),bR(g,o,n),{elementsGroup:g,renderDefault:p}}function mR(t,e){return t.endsWith("px")?parseInt(t,10):t.endsWith("%")&&e?parseInt(t,10)/100*e:parseInt(t,10)}function bR(t,e,i){t&&t.forEachChildren((t=>{t&&(q(t.attribute.width)&&t.attribute.width.percent&&t.setAttribute("width",Math.max(0,t.attribute.width.percent/100*e+(t.attribute.width.delta??0))),t.attribute.width<0&&t.setAttribute("width",0),q(t.attribute.height)&&t.attribute.height.percent&&t.setAttribute("height",Math.max(0,t.attribute.height.percent/100*i+(t.attribute.height.delta??0))),t.attribute.height<0&&t.setAttribute("height",0),"group"===t.type&&bR(t,t.attribute.width,t.attribute.height))}))}function yR(t){if(!t||!Y(t.$$typeof)&&!Y(t.vtype))return t;const e=t.type,{attribute:i,children:r,stateProxy:o}=t.props,n=e({attribute:i});return function(t,e){let i=!1;switch(t.type){case"richtext":case"rich/image":break;default:i=!0}i&&Object.keys(e).forEach((i=>{const r=Xg[i];r&&t.on(r,e[i])}))}(n,t.props),o&&(n.stateProxy=o),n.id=i.id,n.name=i.name,et(r)?r.forEach((t=>{const e=yR(t);e&&e.type&&n.add(e)})):r&&n.add(yR(r)),n}const CR={};class wR{static cache=new Map;static setIcon(t,e){this.cache.set(t,e)}static getIcon(t){return this.cache.has(t)?this.cache.get(t):null}static hasIcon(t){return this.cache.has(t)}static clear(t){return this.cache.delete(t)}static clearAll(){this.cache=new Map}}const vR={get sort_downward(){return{type:"svg",svg:'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M4.6665 9H11.3332L7.99984 13.1667L4.6665 9Z" fill="#282F38" fill-opacity="0.35"/><path d="M11.3335 7L4.66683 7L8.00016 2.83333L11.3335 7Z" fill="#416EFF"/> </svg>',width:16,height:16,funcType:lC.sort,name:"sort_downward",positionType:aC.contentRight,marginLeft:3,hover:{width:22,height:22,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get sort_upward(){return{type:"svg",svg:'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M4.6665 9H11.3332L7.99984 13.1667L4.6665 9Z" fill="#416EFF"/><path d="M11.3335 7L4.66683 7L8.00016 2.83333L11.3335 7Z" fill="#282F38" fill-opacity="0.35"/></svg> ',width:16,height:16,funcType:lC.sort,positionType:aC.contentRight,name:"sort_upward",marginLeft:3,hover:{width:22,height:22,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get sort_normal(){return{type:"svg",svg:'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.6665 9H11.3332L7.99984 13.1667L4.6665 9Z" fill="#282F38" fill-opacity="0.35"/><path d="M11.3335 7L4.66683 7L8.00016 2.83333L11.3335 7Z" fill="#282F38" fill-opacity="0.35"/></svg> ',width:16,height:16,funcType:lC.sort,positionType:aC.contentRight,name:"sort_normal",marginLeft:3,hover:{width:22,height:22,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get freeze(){return{type:"svg",svg:'<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)"><path d="M17.1313 8.42047C17.1932 8.48238 17.2423 8.55587 17.2759 8.63676C17.3094 8.71764 17.3266 8.80434 17.3266 8.89189C17.3266 8.97944 17.3094 9.06613 17.2759 9.14702C17.2423 9.2279 17.1932 9.3014 17.1313 9.3633L13.3843 13.1103C13.7007 14.3048 13.5305 15.4443 12.8388 16.2395C12.8104 16.2781 12.7778 16.3136 12.7417 16.3451L12.712 16.3755C12.6501 16.4374 12.5766 16.4865 12.4957 16.52C12.4148 16.5535 12.3281 16.5707 12.2406 16.5707C12.153 16.5707 12.0663 16.5535 11.9854 16.52C11.9046 16.4865 11.8311 16.4374 11.7692 16.3755L9.17633 13.7826L6.05316 16.9058L5.11983 17.0925C5.09291 17.0979 5.06508 17.0965 5.03881 17.0886C5.01254 17.0806 4.98863 17.0663 4.96923 17.0469C4.94982 17.0275 4.9355 17.0036 4.92755 16.9773C4.9196 16.951 4.91827 16.9232 4.92366 16.8963L5.11033 15.963L8.23333 12.8396L5.64066 10.2471C5.57875 10.1852 5.52964 10.1117 5.49614 10.0309C5.46263 9.94997 5.44539 9.86327 5.44539 9.77572C5.44539 9.68817 5.46263 9.60148 5.49614 9.52059C5.52964 9.43971 5.57875 9.36621 5.64066 9.3043C5.65066 9.2943 5.66066 9.2843 5.67099 9.27464C5.70266 9.2383 5.73833 9.20547 5.77766 9.17664C6.57283 8.48564 7.71199 8.31564 8.90599 8.63197L12.6528 4.88497C12.7147 4.82306 12.7882 4.77395 12.8691 4.74045C12.95 4.70694 13.0367 4.6897 13.1242 4.6897C13.2118 4.6897 13.2985 4.70694 13.3794 4.74045C13.4603 4.77395 13.5338 4.82306 13.5957 4.88497L17.1312 8.42047H17.1313ZM15.7172 8.8918L13.1243 6.29914L9.56483 9.8588C9.47574 9.94788 9.36323 10.0099 9.24034 10.0376C9.11746 10.0654 8.98922 10.0578 8.87049 10.0156C8.22783 9.78764 7.63899 9.7553 7.17749 9.89814L12.1182 14.8388C12.261 14.3771 12.2287 13.7885 12.0007 13.146C11.9585 13.0272 11.9509 12.899 11.9787 12.7761C12.0064 12.6532 12.0684 12.5407 12.1575 12.4516L15.7172 8.89164V8.8918Z" fill="#282F38" fill-opacity="0.2"/></g><defs><clipPath id="clip0"><rect width="22" height="22" fill="white"/></clipPath></defs></svg>',width:22,height:22,name:"freeze",funcType:lC.frozen,positionType:aC.right,marginRight:0,hover:{width:22,height:22,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get frozen(){return{type:"svg",svg:'<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M8.49975 3.66663C8.32294 3.66663 8.15337 3.73686 8.02835 3.86189C7.90332 3.98691 7.83309 4.15648 7.83309 4.33329V9.63246C6.76475 10.2533 6.07942 11.1795 6.00625 12.2308C5.99892 12.2786 5.99692 12.3268 6.00009 12.3741L5.99975 12.4166C5.99975 12.5934 6.06999 12.763 6.19501 12.888C6.32004 13.0131 6.48961 13.0833 6.66642 13.0833H10.3333L10.3331 17.5L10.8611 18.292C10.8763 18.3148 10.8969 18.3335 10.9211 18.3464C10.9453 18.3594 10.9723 18.3662 10.9998 18.3662C11.0272 18.3662 11.0542 18.3594 11.0784 18.3464C11.1026 18.3335 11.1232 18.3148 11.1384 18.292L11.6664 17.5L11.6666 13.0833H15.3331C15.5099 13.0833 15.6795 13.0131 15.8045 12.888C15.9295 12.763 15.9998 12.5934 15.9998 12.4166C15.9998 12.4025 15.9998 12.3883 15.9994 12.3741C16.0028 12.3263 16.0008 12.2776 15.9933 12.2295C15.9196 11.1786 15.2343 10.2528 14.1664 9.63229V4.33329C14.1664 4.15648 14.0962 3.98691 13.9712 3.86189C13.8461 3.73686 13.6766 3.66663 13.4998 3.66663H8.49975Z" fill="#282F38" fill-opacity="0.35"/></svg>',width:22,height:22,name:"frozen",funcType:lC.frozen,positionType:aC.right,marginRight:0,hover:{width:22,height:22,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get frozenCurrent(){return{type:"svg",svg:'<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.49975 3.66663C8.32294 3.66663 8.15337 3.73686 8.02835 3.86189C7.90332 3.98691 7.83309 4.15648 7.83309 4.33329V9.63246C6.76475 10.2533 6.07942 11.1795 6.00625 12.2308C5.99892 12.2786 5.99692 12.3268 6.00009 12.3741L5.99975 12.4166C5.99975 12.5934 6.06999 12.763 6.19501 12.888C6.32004 13.0131 6.48961 13.0833 6.66642 13.0833H10.3333L10.3331 17.5L10.8611 18.292C10.8763 18.3148 10.8969 18.3335 10.9211 18.3464C10.9453 18.3594 10.9723 18.3662 10.9998 18.3662C11.0272 18.3662 11.0542 18.3594 11.0784 18.3464C11.1026 18.3335 11.1232 18.3148 11.1384 18.292L11.6664 17.5L11.6666 13.0833H15.3331C15.5099 13.0833 15.6795 13.0131 15.8045 12.888C15.9295 12.763 15.9998 12.5934 15.9998 12.4166C15.9998 12.4025 15.9998 12.3883 15.9994 12.3741C16.0028 12.3263 16.0008 12.2776 15.9933 12.2295C15.9196 11.1786 15.2343 10.2528 14.1664 9.63229V4.33329C14.1664 4.15648 14.0962 3.98691 13.9712 3.86189C13.8461 3.73686 13.6766 3.66663 13.4998 3.66663H8.49975Z" fill="#416EFF"/></svg>',width:22,height:22,funcType:lC.frozen,positionType:aC.right,name:"frozenCurrent",marginRight:0,hover:{width:22,height:22,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get dropdownIcon(){return{type:"svg",svg:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g><rect x="2" y="1" width="20" height="20" rx="10" fill="white"/><rect x="2.5" y="1.5" width="19" height="19" rx="9.5" stroke="#959DA5"/></g><path d="M14.9492 9.39531C15.0086 9.31911 15.0165 9.21887 14.9698 9.1356C14.923 9.05234 14.8294 9 14.7273 9L9.27273 9C9.17057 9 9.07697 9.05234 9.03023 9.1356C8.98348 9.21887 8.99142 9.31911 9.0508 9.39531L11.7781 12.8953C11.8293 12.961 11.9119 13 12 13C12.0881 13 12.1707 12.961 12.2219 12.8953L14.9492 9.39531Z" fill="#4F5965"/></svg>',width:24,height:24,funcType:lC.dropDown,positionType:aC.absoluteRight,name:"dropdownIcon",marginRight:0,hover:{width:24,height:24,bgColor:"rgba(101, 117, 168, 0.1)",image:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g><rect x="2" y="1" width="20" height="20" rx="10" fill="#1E54C9"/><rect x="2.5" y="1.5" width="19" height="19" rx="9.5" stroke="#141414" stroke-opacity="0.2"/></g><path d="M14.9492 9.39531C15.0086 9.31911 15.0165 9.21887 14.9698 9.1356C14.923 9.05234 14.8294 9 14.7273 9L9.27273 9C9.17057 9 9.07697 9.05234 9.03023 9.1356C8.98348 9.21887 8.99142 9.31911 9.0508 9.39531L11.7781 12.8953C11.8293 12.961 11.9119 13 12 13C12.0881 13 12.1707 12.961 12.2219 12.8953L14.9492 9.39531Z" fill="white"/></svg>'},cursor:"pointer",visibleTime:"mouseenter_cell"}},get play(){return{type:"svg",svg:'<svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="48" height="48" fill="white" fill-opacity="0.01" /><path d="M24 44C35.0457 44 44 35.0457 44 24C44 12.9543 35.0457 4 24 4C12.9543 4 4 12.9543 4 24C4 35.0457 12.9543 44 24 44Z" fill="none" stroke="#686a6e" stroke-width="4" stroke-linejoin="round" stroke-opacity="0.7" /><path d="M20 24V17.0718L26 20.5359L32 24L26 27.4641L20 30.9282V24Z" fill="none" stroke="#686a6e" stroke-width="4" stroke-linejoin="round" stroke-opacity="0.7" /></svg>',width:24,height:24,funcType:lC.play,positionType:aC.right,name:"play",marginRight:0,hover:{width:24,height:24,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get damage_pic(){return{type:"svg",svg:'<svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 10V38C5 39.1046 5.89543 40 7 40H14H18L15 29L22 27L21 20L29 16L27 13L30 8H7C5.89543 8 5 8.89543 5 10Z" fill="none" stroke="#333" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M43 38V10C43 8.89543 42.1046 8 41 8H38L34 14L37 19L28 23L29 31L22 33L24 40H41C42.1046 40 43 39.1046 43 38Z" fill="none" stroke="#333" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path fill-rule="evenodd" clip-rule="evenodd" d="M14.5 18C15.3284 18 16 17.3284 16 16.5C16 15.6716 15.3284 15 14.5 15C13.6716 15 13 15.6716 13 16.5C13 17.3284 13.6716 18 14.5 18Z" fill="none" stroke="#333" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/></svg>',width:24,height:24,funcType:lC.damagePic,positionType:aC.left,name:"damage_pic",marginRight:0,hover:{width:24,height:24,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get loading_pic(){return{type:"svg",svg:'<svg viewBox="0 0 400 300" fill="none" xmlns="http://www.w3.org/2000/svg"><mask id="a" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="50" y="65" width="301" height="170"><path d="M350.3 65H50v169.8h300.3V65Z" fill="#fff"/></mask><g mask="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M58.3 233.2h32.8v-36.8H58.3v36.8Z" fill="#C7DEFF"/><path d="M91.1 224.5v8.8H58.3M82.4 196.2H58.3" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M305.4 182.5s-2.7 12.6 0 17.4c2.7 4.8 8.3 6.7 12.4 4.4 4.2-2.4 5.3-8.1 2.6-12.9-2.7-4.8-15-8.9-15-8.9ZM336 204.7c4.3 2 9.7-.4 12-5.4 2.3-5-1.5-17.3-1.5-17.3s-11.8 5.1-14.1 10.1c-2.3 5-.7 10.6 3.6 12.6Z" fill="#00E4E5"/><path fill-rule="evenodd" clip-rule="evenodd" d="M326.7 174s-10 11.8-10 18.6c0 6.7 4.5 12.2 10 12.2s10-5.5 10-12.3c0-6.8-10-18.5-10-18.5Z" fill="#00E4E5"/><path d="M332.3 181.5c2.3 3.6 4.4 7.8 4.4 10.9M316.7 192.5c0-3.1 2.1-7.2 4.3-10.8" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M343.1 227.3v-9.7h-34v9.7c0 3.7 3 6.6 6.6 6.6h20.9c3.6 0 6.5-2.9 6.5-6.6Z" fill="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M350.4 220.8V198H302v22.8c0 5.9 4.8 10.7 10.7 10.7h26.9c5.9 0 10.7-4.8 10.8-10.7Z" fill="#C7DEFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M331.7 74.2H117.8L87.4 203h213.8l30.5-128.8Z" fill="#fff"/><path fill-rule="evenodd" clip-rule="evenodd" d="M337 74.2h-6.2l-30.6 129.2h6.2L337 74.2Z" fill="#fff"/><path fill-rule="evenodd" clip-rule="evenodd" d="M303.8 203.5h2.4l30.7-129.3h-1.8l-31.3 129.3Z" fill="#C7DEFF"/><path d="m337 74.2-30.6 129.2h-5.9" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M229.9 202.1h-47.6l2 9.6h47.3l-1.7-9.6Z" fill="#C7DEFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M94.7 172.6 87.4 203h213.1l7.8-30.4H94.7Z" fill="#006EFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M94.7 172.6 87.4 203h213.1l7.8-30.4H94.7Z" fill="#006EFF"/><path d="M138.5 74.2h193.2l-23.4 98.6M94.5 172.7l11-46.3M104.8 155.4l-2.3 11.5h6.7M316 112.1l1.1-4.5" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M148.3 138.1h97V119h-97v19.1Z" fill="#00E4E5"/><path d="M303.1 80.6h20.3l-4.6 19.6M228.3 234.3c3.6 0 6.3-3.2 5.7-6.8l-4.1-24.1" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M226.2 229.5h-68.9v1.2c0 2 1.6 3.7 3.7 3.7h60.1c2.8 0 5-2.2 5.1-4.9Z" fill="#C7DEFF"/><path d="M180.699 226.8h-19.9c-2.8 0-4.6 3-3.3 5.5m0 0c.6 1.2 1.9 2 3.3 2h57.8M175.9 203.4l3.6 17.6M241.2 234.3h65.1M104.6 234.3h41.3" stroke="#071F4D"/><path d="M206.2 234.3h14.9c3.1 0 5.5-2.8 5-5.9l-4.3-24.9M160.7 226.8h46M62.2 226.1h-9.5c-1.2 0-2.2-1-2.2-2.2v-18.3c0-1.2 1-2.2 2.2-2.2h9.5" stroke="#071F4D"/><path d="M53.4 171.7H68c2.1 0 3.7 1.7 3.7 3.7v16.1M79.1 192v-21.8c0-2.5 2-4.6 4.6-4.6h2.2c2.5 0 4.5-2 4.5-4.5m0 0c0-2.5-2-4.5-4.5-4.5H56.1c-2.4 0-4.3-1.9-4.3-4.3V148M71.2 165.2h-18M64 181.7v10.1" stroke="#C7DEFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M85.7 120H124c4.3 0 7.7-3.5 7.7-7.7V65.5H94.2c-4.7 0-8.5 4.9-8.5 11V120Z" fill="#C7DEFF"/><path d="M85.7 110.7V73c0-4.1 3.4-7.5 7.5-7.5h38.5M146.2 73.8v-2.5c0-3.2-2-5.8-5.8-5.8-2.8 0-6 1.1-6 5.8v42.4c0 4.7-3.8 8.5-8.5 8.5h-15.6" stroke="#071F4D"/><path d="M119.7 122.3H87c-6.1 0-11.1-5-11.1-11.1m0 0h39M126.1 122.3c-6.1 0-11.1-5-11.1-11.1" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M85.4 122.1h37.2c-6.5-1.8-8-10.5-8-10.5H76.2c.6 8.8 9.2 10.5 9.2 10.5Z" fill="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M95.8 102.9h4.8V83.6h-4.8v19.3ZM106.6 102.9h4.8V77.6h-4.8v25.3ZM117.3 102.9h4.8V89.1h-4.8v13.8Z" fill="#fff"/><path d="M273.2 195.9h16.9M261.2 195.9h5" stroke="#fff"/><path d="M62.4 201.9v2.9M62.4 224.5v2.9" stroke="#071F4D"/><path d="m153.6 138.1 9.7-19.1M168.8 138.1l9.7-19.1M184.1 138.1l9.7-19.1M199.4 138.1l9.7-19.1M214.6 138.1l9.8-19.1M229.9 138.1l9.7-19.1" stroke="#fff"/><path d="M148.3 138.1h121.6V119H148.3v19.1Z" stroke="#071F4D"/></g></svg>',width:400,height:300,name:"loading_pic",positionType:aC.left}},get expand(){return{type:"svg",svg:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">\n      <path d="M4.64988 6.81235C4.38797 6.48497 4.62106 6 5.04031 6L10.9597 6C11.3789 6 11.612 6.48497 11.3501 6.81235L8.39043 10.512C8.19027 10.7622 7.80973 10.7622 7.60957 10.512L4.64988 6.81235Z" fill="#141414" fill-opacity="0.65"/>\n      </svg>',width:16,height:16,funcType:lC.expand,name:"expand",positionType:aC.contentLeft,marginLeft:0,marginRight:4,hover:{width:22,height:22,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get collapse(){return{type:"svg",svg:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">\n      <path d="M5.81235 11.3501C5.48497 11.612 5 11.3789 5 10.9597L5 5.04031C5 4.62106 5.48497 4.38797 5.81235 4.64988L9.51196 7.60957C9.76216 7.80973 9.76216 8.19027 9.51196 8.39044L5.81235 11.3501Z" fill="#141414" fill-opacity="0.65"/>\n      </svg>',width:16,height:16,funcType:lC.collapse,name:"collapse",positionType:aC.contentLeft,marginLeft:0,marginRight:4,hover:{width:22,height:22,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get drillDown(){return{name:"drillDown",type:"svg",positionType:aC.absolute,funcType:lC.drillDown,svg:'<svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><rect x="0" y="0" width="1024" height="1024" rx="20%" ry="20%" fill="#ffffff" /><path  d="M810.666667 85.333333c70.688 0 128 57.312 128 128v597.333334c0 70.688-57.312 128-128 128H213.333333c-70.688 0-128-57.312-128-128V213.333333c0-70.688 57.312-128 128-128h597.333334z m0 85.333334H213.333333a42.666667 42.666667 0 0 0-42.613333 40.533333L170.666667 213.333333v597.333334a42.666667 42.666667 0 0 0 40.533333 42.613333L213.333333 853.333333h597.333334a42.666667 42.666667 0 0 0 42.613333-40.533333L853.333333 810.666667V213.333333a42.666667 42.666667 0 0 0-40.533333-42.613333L810.666667 170.666667zM549.333333 288a5.333333 5.333333 0 0 1 5.333334 5.333333V469.333333h176a5.333333 5.333333 0 0 1 5.333333 5.333334v74.666666a5.333333 5.333333 0 0 1-5.333333 5.333334H554.666667v176a5.333333 5.333333 0 0 1-5.333334 5.333333h-74.666666a5.333333 5.333333 0 0 1-5.333334-5.333333V554.666667H293.333333a5.333333 5.333333 0 0 1-5.333333-5.333334v-74.666666a5.333333 5.333333 0 0 1 5.333333-5.333334H469.333333V293.333333a5.333333 5.333333 0 0 1 5.333334-5.333333h74.666666z"></path></svg>',width:13,height:13,cursor:"pointer"}},get drillUp(){return{name:"drillUp",type:"svg",positionType:aC.absolute,funcType:lC.drillUp,svg:'<svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><rect x="0" y="0" width="1024" height="1024" rx="20%" ry="20%" fill="#ffffff" /><path d="M810.666667 85.333333c70.688 0 128 57.312 128 128v597.333334c0 70.688-57.312 128-128 128H213.333333c-70.688 0-128-57.312-128-128V213.333333c0-70.688 57.312-128 128-128h597.333334z m0 85.333334H213.333333a42.666667 42.666667 0 0 0-42.613333 40.533333L170.666667 213.333333v597.333334a42.666667 42.666667 0 0 0 40.533333 42.613333L213.333333 853.333333h597.333334a42.666667 42.666667 0 0 0 42.613333-40.533333L853.333333 810.666667V213.333333a42.666667 42.666667 0 0 0-40.533333-42.613333L810.666667 170.666667zM693.333333 469.333333a42.666667 42.666667 0 1 1 0 85.333334H330.666667a42.666667 42.666667 0 1 1 0-85.333334h362.666666z"></path></svg>',width:13,height:13,cursor:"pointer"}},get dragReorder(){return{type:"svg",svg:'<svg t="1710129136961" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5166" width="200" height="200"><path d="M362.666667 192m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#666666" p-id="5167"></path><path d="M661.333333 192m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#666666" p-id="5168"></path><path d="M362.666667 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#666666" p-id="5169"></path><path d="M661.333333 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#666666" p-id="5170"></path><path d="M362.666667 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#666666" p-id="5171"></path><path d="M661.333333 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#666666" p-id="5172"></path></svg>',width:20,height:20,funcType:lC.dragReorder,positionType:aC.left,name:"dragReorder",marginLeft:-10,marginRight:10,cursor:"grab"}}};function xR(){return sw(vR,CR)}let _R=class extends hs{role;col;row;mergeStartCol;mergeStartRow;mergeEndCol;mergeEndRow;contentWidth;contentHeight;rowNumber;colHeight;border;needUpdate;needUpdateWidth;needUpdateHeight;clear(){this.removeAllChild()}getChildByName(t,e){let i=null;return this.forEachChildren((e=>e.name===t&&(i=e,!0))),e&&this.forEachChildren((e=>{if(e.getChildByName){const r=e.getChildByName(t,!0);if(r)return i=r,!0}return!1})),i}get width(){let t=this.AABBBounds.width();return t!==1/0&&t!==-1/0||(t=0),Math.max(t,this.attribute.width??0)}get height(){let t=this.AABBBounds.height();return t!==1/0&&t!==-1/0||(t=0),Math.max(t,this.attribute.height??0)}setDeltaWidth(t){0!==t&&(this.setAttribute("width",(this.attribute.width??0)+t),this.border&&(this.border.setAttribute("width",this.border.attribute.width+t),"group"===this.border.type&&this.border.firstChild.setAttribute("width",this.border.firstChild.attribute.width+t)))}setDeltaHeight(t){0!==t&&(this.setAttribute("height",(this.attribute.height??0)+t),this.border&&(this.border.setAttribute("height",this.border.attribute.height+t),"group"===this.border.type&&this.border.firstChild.setAttribute("width",this.border.firstChild.attribute.height+t)))}setDeltaX(t){0!==t&&this.setAttribute("x",this.attribute.x+t)}setDeltaY(t){0!==t&&this.setAttribute("y",this.attribute.y+t)}forEachChildrenSkipChild(t,e="border-rect",i=!1){if(i){let i=this._lastChild,r=0;for(;i;){if(i.name!==e){if(t(i,r++))return}i=i._prev}}else{let i=this._firstChild,r=0;for(;i;){if(i.name!==e){if(t(i,r++))return}i=i._next}}}getColGroup(t){let e=this._firstChild;if(!e)return null;for(let i=0;i<this.childrenCount;i++){if(e.col===t)return e;e=e._next}return null}getRowGroup(t){let e=this._firstChild;if(!e)return null;for(let i=0;i<this.childrenCount;i++){if(e.row===t)return e;e=e._next}return null}addCellGroup(t){if(0===this.childrenCount||this.lastChild.row===t.row-1)this.addChild(t);else{let e=this._firstChild;for(let i=0;i<this.childrenCount;i++){if(e.row===t.row-1)return void this.insertAfter(t,e);e=e._next}this.addChild(t)}}getChildAt(t){const e=super.getChildAt(t);return e&&"border-rect"===e.name?e._next:e}tryUpdateAABBBounds(){if("cell"===this.role){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;const t=this.shouldSelfChangeUpdateAABBBounds(),e=this.doUpdateAABBBounds();return this.addUpdateLayoutTag(),function(t,e){if(!t.stage.dirtyBounds)return;if(!t.stage||!t.stage.renderCount)return;if(t.isContainer&&!e)return;t.stage.dirty(t.globalAABBBounds)}(this,t),e}return super.tryUpdateAABBBounds()}doUpdateAABBBounds(){if("cell"===this.role){const t=this.attribute,{x:e,y:i,width:r,height:o}=t;return this._AABBBounds.setValue(e,i,e+r,i+o),this.parent&&this.parent.addChildUpdateBoundTag(),this.clearUpdateBoundTag(),this._AABBBounds}return"body"===this.role||"row-header"===this.role||"col-header"===this.role||"right-frozen"===this.role||"bottom-frozen"===this.role||"corner-header"===this.role||"corner-right-top-header"===this.role||"corner-right-bottom-header"===this.role||"corner-left-bottom-header"===this.role?(this._AABBBounds.setValue(-1/0,-1/0,1/0,1/0),this.parent&&this.parent.addChildUpdateBoundTag(),this.clearUpdateBoundTag(),this._AABBBounds):super.doUpdateAABBBounds()}updateColumnRowNumber(t){this.rowNumber?this.rowNumber=Math.max(this.rowNumber,t):this.rowNumber=t}updateColumnHeight(t){this.colHeight?this.colHeight+=t:this.colHeight=t}};function SR(t,e,i,r){const o=t/e;let n,s;return o>i/r?(n=i,s=n/o):(s=r,n=s*o),{width:n,height:s}}function AR(t,e,i,r,o,n,s="left",a="middle",l=[0,0,0,0],h=0,c=0,d=0,u=0){const g=t+i,p=e+r;let f=t+l[3]+h;"right"===s||"end"===s?f=g-o-l[1]-c:"center"===s&&(f=t+(i-o+h-c)/2);let m=e+l[0]+d;return"bottom"===a||"alphabetic"===a||"ideographic"===a?m=p-n-l[2]-u:"middle"===a&&(m=e+(r-n+d-u)/2),{x:f,y:m}}function RR(t,e,i,r,o){const n=e&&Y(e[t])?e[t]:void 0;if("function"==typeof n){return n({col:i,row:r,table:o,value:o.getCellValue(i,r),dataValue:o.getCellOriginValue(i,r),cellHeaderPaths:o.getCellHeaderPaths(i,r)})}return n}function BR(t,e,i,r,o){const n=e&&Y(e[t])?e[t]:void 0;if("function"==typeof n){return n({col:i,row:r,table:o,value:o.getCellValue(i,r),dataValue:o.getCellOriginValue(i,r),cellHeaderPaths:o.getCellHeaderPaths(i,r)})}}function MR(t,e,i,r){const o=yw.toBoxArray(r.internalProps.theme.frameStyle?.borderLineWidth??[null]);let n=i?.group?.strokeArrayWidth??void 0;return r.theme.cellInnerBorder||(0===t&&o[3]&&(n=n??[i?.group?.lineWidth,i?.group?.lineWidth,i?.group?.lineWidth,i?.group?.lineWidth],n[3]=0),t===r.colCount-1&&o[1]&&(n=n??[i?.group?.lineWidth,i?.group?.lineWidth,i?.group?.lineWidth,i?.group?.lineWidth],n[1]=0),0===e&&o[0]&&(n=n??[i?.group?.lineWidth,i?.group?.lineWidth,i?.group?.lineWidth,i?.group?.lineWidth],n[0]=0),e===r.rowCount-1&&o[2]&&(n=n??[i?.group?.lineWidth,i?.group?.lineWidth,i?.group?.lineWidth,i?.group?.lineWidth],n[2]=0)),n}function TR(t,e,i,r,o,n,s){let a=!1,l=null,h=null;const{width:c,height:d,isMerge:u}=HR(s,o.table);if(c<i+n[1]+n[3]&&(l=i+n[1]+n[3],a=!0),d<r+n[2]+n[0]&&(h=r+n[2]+n[0],a=!0),a){if("number"==typeof l)if(u)for(let t=s.mergeStartCol;t<=s.mergeEndCol;t++)o.setColWidth(t,l/(s.mergeEndCol-s.mergeStartCol+1));else o.setColWidth(t,l);if("number"==typeof h)if(u)for(let t=s.mergeStartRow;t<=s.mergeEndRow;t++)o.setRowHeight(t,h/(s.mergeEndRow-s.mergeStartRow+1));else o.setRowHeight(e,h);return o.component.updateScrollBar(),!0}return!1}function PR(t,e,i,r){const o=t.getChildByName("image");if(!o)return;const n="string"!=typeof o.attribute.image&&o.attribute.image||o.resources?.get(o.attribute.image).data;if(!n)return;const s=r._getCellStyle(e,i),a=RR("textAlign",s,e,i,r)??"left",l=RR("textBaseline",s,e,i,r)??"middle",h=BA(RR("padding",s,e,i,r))??[0,0,0,0],{width:c,height:d,isMerge:u}=HR(t,r),g=t.mergeStartCol??t.col,p=t.mergeStartRow??t.row,f=t.mergeEndCol??t.col,m=t.mergeEndCol??t.row;if(o.keepAspectRatio){const{width:t,height:e}=SR(n.width||n.videoWidth,n.height||n.videoHeight,c-(h[1]+h[3]),d-(h[0]+h[2])),i=AR(0,0,c,d,t,e,a,l,h);for(let o=g;o<=f;o++)for(let n=p;n<=m;n++){const s=r.scenegraph.getCell(o,n).getChildByName("image");s?.setAttributes({x:i.x,y:i.y,width:t,height:e})}}else for(let t=g;t<=f;t++)for(let e=p;e<=m;e++){const i=r.scenegraph.getCell(t,e).getChildByName("image");i?.setAttributes({x:h[3],y:h[0],width:c-h[1]-h[3],height:d-h[0]-h[2]})}if(t.getChildByName("play-icon")){const e=0,i=0,{width:n,height:s}=HR(t,r),a=Math.floor(Math.min(n-h[1]-h[3],s-h[2]-h[0])/2),l=e+(n>o.attribute.width?o.attribute.x-e+o.attribute.width/2:n/2),c=i+(s>o.attribute.height?o.attribute.y-i+o.attribute.height/2:s/2);for(let t=g;t<=f;t++)for(let e=p;e<=m;e++){r.scenegraph.getCell(t,e).getChildByName("play-icon").setAttributes({x:l-a/2,y:c-a/2,width:a,height:a})}}u&&ER(t.mergeStartCol,t.mergeEndCol,t.mergeStartRow,t.mergeEndRow,r)}function HR(t,e){return"cell"===t.role&&Y(t.mergeStartCol)&&Y(t.mergeEndCol)&&Y(t.mergeStartRow)&&Y(t.mergeEndRow)?{width:e.getColsWidth(t.mergeStartCol,t.mergeEndCol),height:e.getRowsHeight(t.mergeStartRow,t.mergeEndRow),isMerge:!0}:{width:t.attribute.width,height:t.attribute.height,isMerge:!1}}function ER(t,e,i,r,o){for(let n=t;n<=e;n++)for(let t=i;t<=r;t++){const e=o.scenegraph.getCell(n,t);if(e){const i=e.getChildByName("image");i&&i.setAttributes({dx:-o.getColsWidth(e.mergeStartCol,n-1),dy:-o.getRowsHeight(e.mergeStartRow,t-1)});const r=e.getChildByName("play-icon");r&&r.setAttributes({dx:-o.getColsWidth(e.mergeStartCol,n-1),dy:-o.getRowsHeight(e.mergeStartRow,t-1)})}}}function kR(t,e,i,r,o,n,s,a){const l=n.resources.get(n.attribute.image).data,{col:h,row:c}=s;if(t&&!LR(n)&&TR(h,c,l.width,l.height,a.scenegraph,i,s),e||LR(n)){const{width:t,height:e,isMerge:h}=HR(s,a),{width:c,height:d}=SR(l.width,l.height,t-i[1]-i[3],e-i[0]-i[2]),u=AR(0,0,t,e,c,d,r,o,i);n.setAttributes({x:u.x,y:u.y,width:c,height:d}),h&&ER(s.mergeStartCol,s.mergeEndCol,s.mergeStartRow,s.mergeEndRow,a)}}function LR(t){const e=xR();return t.attribute.image===e.damage_pic.svg}function FR(t,e,i,r,o,n,s,a,l){t.dependField&&(o=l.getCellOriginRecord(n,s)?.[t.dependField]??o),t.barType=t.barType??"default",t.min=hw(t.min,{col:n,row:s,table:l,value:r,dataValue:o,cellHeaderPaths:void 0})??0,t.max=hw(t.max,{col:n,row:s,table:l,value:r,dataValue:o,cellHeaderPaths:void 0})??t.min+100;const h=l.getRowHeight(s);let c=i,d=h,u=0;ot(l.theme._contentOffset)&&(u=l.theme._contentOffset);const g=new _R({x:-u,y:-u,width:c,height:d});g.name="progress-bar";const{showBar:p,barColor:f,barBgColor:m,barPositiveColor:b,barNegativeColor:y,barAxisColor:C,barRightToLeft:w,showBarMark:v,barMarkPositiveColor:x,barMarkNegativeColor:_,barMarkWidth:S,barMarkPosition:A}=e;let{barHeight:R,barBottom:B,barPadding:M}=e;1===M.length?M=[M[0],M[0],M[0],M[0]]:2===M.length?M=[M[0],M[1],M[0],M[1]]:3===M.length&&(M=[M[0],M[1],M[2],M[1]]),M=M.map(((t,e)=>{if("string"==typeof t&&mw.endsWith(t,"%")){const r=Number(t.substr(0,t.length-1));return 0===e||2===e?h*r/100:i*r/100}return Number(t)}));const T=BA(RR("borderLineWidth",e,n,s,l)),P=Math.max(M[0],Math.ceil(T[0]/2)),H=Math.max(M[1],Math.floor(T[1]/2)),E=Math.max(M[2],Math.floor(T[2]/2)),k=Math.max(M[3],Math.ceil(T[3]/2));c-=H+k,d-=E+P,s===l.rowCount-1&&[0,"0"].includes(B)&&(d-=1);const L=P,F=k,I=c;"string"==typeof R&&mw.endsWith(R,"%")?(R=Number(R.substr(0,R.length-1)),R=d*R/100):R=Number(R),"string"==typeof B&&mw.endsWith(B,"%")?(B=Number(B.substr(0,B.length-1)),B=d*B/100):B=Number(B);if(hw(p,{col:n,row:s,table:l,context:null,value:r,dataValue:o})){let e=`${o}`;mw.endsWith(e,"%")&&(e=e.substr(0,e.length-1));const i=Number(e);if(isNaN(i))return g;if("default"===(t.barType??"default")){const e=i<t.min?0:i>t.max?1:(i-t.min)/(t.max-t.min),a=c,h=L+d-R-B;let u=Math.min(a*e,a);const p=w?F+I-u:F;n===l.colCount-1&&1===e&&(u-=1);const b=hw(m,{col:n,row:s,table:l,context:null,value:r,dataValue:o,percentile:e});if(b){const t=fl({x:p,y:h,width:a,height:R,fill:b});g.addChild(t)}const y=fl({x:p,y:h,width:u,height:R,fill:hw(f,{col:n,row:s,table:l,context:null,value:r,dataValue:o,percentile:e})||"#20a8d8"});g.addChild(y)}else if("negative"===t.barType){const e=t.min<0?-t.min:0,a=t.max>0?t.max:0,u=e/(e+a),p=1-u,f=i>0?i/a:0,M=i<0?-i/e:0,T=c,P=L+d-R-B,H=F,E=hw(m,{col:n,row:s,table:l,context:null,value:r,dataValue:o,percentile:f});if(E){const t=fl({x:H,y:P,width:T,height:R,fill:E});g.addChild(t)}const k=w?p*T:u*T,I=Math.min(T*u*M,T),z=w?{left:H+k,top:P,width:I,height:R}:{left:H+k-I,top:P,width:I,height:R},O=hw(y,{col:n,row:s,table:l,context:null,value:r,dataValue:o,percentile:M})||"#20a8d8",D=fl({x:z.left,y:z.top,width:z.width,height:z.height,fill:O});g.addChild(D);let W=Math.min(T*p*f,T);n===l.colCount-1&&1===f&&(W-=1);const N=w?{left:H+k-W,top:P,width:W,height:R}:{left:H+k,top:P,width:W,height:R},G=hw(b,{col:n,row:s,table:l,context:null,value:r,dataValue:o,percentile:f})||"#20a8d8",j=fl({x:N.left,y:N.top,width:N.width,height:N.height,fill:G});g.addChild(j);const V=w?z.left:N.left,U=ul({x:0,y:0,stroke:hw(C),lineWidth:1,lineDash:[2,2],points:[{x:V,y:0},{x:V,y:h}]});if(g.addChild(U),v&&(f||M)){const t=S,e=[];let i;if(f>0)if(i=hw(x,{col:n,row:s,table:l,context:null,value:r,dataValue:o,percentile:f})||"#20a8d8","right"===A){const t=w?N.left+S/2:N.left+N.width-S/2;e.push({x:t,y:N.top}),e.push({x:t,y:N.top+N.height})}else"bottom"===A&&(e.push({x:N.left,y:N.top+N.height-S/2}),e.push({x:N.left+N.width,y:N.top+N.height-S/2}));else if(M>0)if(i=hw(_,{col:n,row:s,table:l,context:null,value:r,dataValue:o,percentile:M})||"#20a8d8","right"===A){const t=w?z.left+z.width-S/2:z.left+S/2;e.push({x:t,y:z.top}),e.push({x:t,y:z.top+z.height})}else"bottom"===A&&(e.push({x:z.left,y:z.top+z.height-S/2}),e.push({x:z.left+z.width,y:z.top+z.height-S/2}));const a=ul({x:0,y:0,stroke:i,lineWidth:t,points:e});g.addChild(a)}}else if("negative_no_axis"===t.barType){const e=t.min<0?-t.min:0,a=t.max>0?t.max:0,h=Math.max(e,a),u=0===h?0:Math.abs(i)/h,p=c;let f=Math.min(p*u,p);n===l.colCount-1&&1===u&&(f-=1);const C=L+d-R-B,M=w?F+I-f:F,T=hw(m,{col:n,row:s,table:l,context:null,value:r,dataValue:o,percentile:u});if(T){const t=fl({x:M,y:C,width:p,height:R,fill:T});g.addChild(t)}const P={left:M,top:C,width:f,height:R};let H;H=i>=0?hw(b,{col:n,row:s,table:l,context:null,value:r,percentile:u,dataValue:o})||"#20a8d8":hw(y,{col:n,row:s,table:l,context:null,value:r,dataValue:o,percentile:u})||"#20a8d8";const E=fl({x:P.left,y:P.top,width:P.width,height:P.height,fill:H});if(g.addChild(E),v&&i){const t=S,e=[];let a;if(a=i>=0?hw(x,{col:n,row:s,table:l,context:null,value:r,dataValue:o,percentile:u})||"#20a8d8":hw(_,{col:n,row:s,table:l,context:null,value:r,dataValue:o,percentile:u})||"#20a8d8","right"===A){const t=w?P.left+S/2:P.left+P.width-S/2;e.push({x:t,y:P.top}),e.push({x:t,y:P.top+P.height})}else"bottom"===A&&(e.push({x:P.left,y:P.top+P.height-S/2}),e.push({x:P.left+P.width,y:P.top+P.height-S/2}));const h=ul({x:0,y:0,stroke:a,lineWidth:t,points:e});g.addChild(h)}}}return g}const IR=new class extends j_{constructor(t){super(!1),this.type=x_.Point,this._padding=0,this.paddingInner(1,t),this.padding=this.paddingOuter,this.paddingInner=void 0,this.paddingOuter=void 0}},zR=new cS;function OR(t,e,i,r,o,n,s,a,l,h,c,d){if(!t){const l=MR(o,n,c,h);d&&(t=h.scenegraph.highPerformanceGetCell(o,n,!0))&&"cell"===t.role&&t.setAttributes({x:i,y:r,width:s,height:a,lineWidth:c?.group?.lineWidth??void 0,fill:c?.group?.fill??void 0,stroke:c?.group?.stroke??void 0,strokeArrayWidth:l,strokeArrayColor:c?.group?.strokeArrayColor??void 0,cursor:c?.group?.cursor??void 0,lineDash:c?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:c.group.cornerRadius}),t&&"cell"===t.role||((t=new _R({x:i,y:r,width:s,height:a,lineWidth:c?.group?.lineWidth??void 0,fill:c?.group?.fill??void 0,stroke:c?.group?.stroke??void 0,strokeArrayWidth:l,strokeArrayColor:c?.group?.strokeArrayColor??void 0,cursor:c?.group?.cursor??void 0,lineDash:c?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:c.group.cornerRadius})).role="cell",t.col=o,t.row=n,e?.addCellGroup(t))}const u=function(t,e,i,r,o,n){let s,a;const l=n.internalProps.layoutMap.getBody(t,e).sparklineSpec,h=n.getCellValue(t,e);if(!Array.isArray(h))return;const c=o[3],d=o[0];i-=o[1]+o[3],r-=o[0]+o[2];const u=0,g=r;if("function"==typeof l){const o={col:t,row:e,dataValue:n.getCellOriginValue(t,e)||"",value:n.getCellValue(t,e)||"",rect:n.getCellRangeRelativeRect(n.getCellRange(t,e)),table:n};s=l(o),a=DR(s,c,d,i,r)}else s=l,a=DR(l,c,d,i,r);const p=[],f=[];let m,b;if("object"==typeof s.xField)IR.domain(s.xField.domain),m=s.xField.field;else if("string"==typeof s.xField){const t=h.map((t=>t[s.xField]));IR.domain(t),m=s.xField}else Array.isArray(h)&&(IR.domain(Array.from({length:h.length},((t,e)=>e))),m=s.xField);if(IR.range([0,i]),"object"==typeof s.yField)zR.domain(s.yField.domain),b=s.yField.field;else if("string"==typeof s.yField){const t=h.map((t=>t[s.yField]));zR.domain([Math.min(...t),Math.max(...t)]),b=s.yField}else Array.isArray(h)&&h.every((t=>"number"==typeof t))&&(zR.domain([Math.min(...h),Math.max(...h)]),b=s.yField);if(zR.range([0,r]),"object"==typeof s.xField&&Array.isArray(s.xField.domain)){const t=h.map((t=>t[s.xField.field])),e=s.xField.domain;for(let i=0;i<e.length;i++){let r=!1;for(let o=0;o<t.length;o++)if(e[i]==t[o]){const t=h[o];if(!Y(t[m])||!Y(t[b]))break;p.push({x:u+IR.scale(t[m]),y:g-zR.scale(t[b]),defined:Y(t[b])}),f.push(t),r=!0;break}r||(p.push({x:u+IR.scale(e[i]),y:0,defined:!1}),f.push({[m]:e[i],[b]:null}))}}else for(let t=0;t<h.length;t++){const e=h[t];p.push({x:u+IR.scale(m?e[m]:t),y:g-zR.scale(b?e[b]:e),defined:Y(b?e[b]:e),rawData:e}),f.push(e)}const y=a.getChildByName("sparkline-line");y&&y.setAttribute("points",p);y.bandwidth=IR.step(),y.min=zR.range()[0],y.max=zR.range()[1];const C=a.getChildByName("sparkline-symbol-group");if(C){const t="isolatedPoint"===s.pointShowRule;if("all"===s.pointShowRule)for(let t=0;t<p.length;t++){const{x:e,y:i,defined:r}=p[t];if(r){const t=hl({x:e,y:i});C.appendChild(t)}}else if(t)for(let t=0;t<p.length;t++){const{x:e,y:i,defined:r}=p[t];if(r&&(!p[t-1]||!p[t-1].defined)&&(!p[t+1]||!p[t+1].defined)){const t=hl({x:e,y:i});C.appendChild(t)}}}return a}(o,n,s,a,l,h);return u&&t.appendChild(u),t}function DR(t,e,i,r,o){let n;n="function"==typeof t?t(null):t;const s=new _R({x:e,y:i,width:r,height:o,stroke:!1,fill:!1});if(s.name="sparkline","line"===n.type){const t=ul({x:0,y:0,curveType:n.smooth?"monotoneX":"linear",stroke:n.line?.style?.stroke??"blue",lineWidth:n.line?.style?.strokeWidth??2});t.name="sparkline-line",s.addChild(t),n.crosshair&&(t.hover=n.crosshair?.style??{stroke:"#000",interpolate:"linear"});const e=new _R({x:0,y:0,width:r,height:o,stroke:!1,fill:!1});e.name="sparkline-symbol-group",e.setTheme({symbol:{stroke:n.point?.style?.stroke??"#000",lineWidth:n.point?.style?.strokeWidth??1,fill:n.point?.style?.fill??"#000",size:2*(n.point?.style?.size??3),symbolType:"circle"}}),s.addChild(e),e.hover=n.point?.hover??!1}return s}const WR=In();class NR extends hs{type="chart";chartInstance;activeChartInstance;active;cacheCanvas;isShareChartSpec;constructor(t,e){if(super(e),this.numberType=WR,this.isShareChartSpec=t,e.chartInstance)this.chartInstance=e.chartInstance;else{const t=new e.ClassType(e.spec,{renderCanvas:e.canvas,mode:"node"===this.attribute.mode?"node":"desktop-browser",modeParams:this.attribute.modeParams,canvasControled:!1,viewBox:{x1:0,x2:0,y1:0,y2:0},dpr:e.dpr,interactive:!1,animation:!1,autoFit:!1});t.renderSync(),e.chartInstance=this.chartInstance=t}}activate(t){this.active=!0;const{col:e,row:i}=this.parent,{x1:r,y1:o,x2:n,y2:s}=this.getViewBox(),a=function(t,e,i){const{layoutMap:r}=i.internalProps,o=new de,n=i.scenegraph.tableGroup.globalAABBBounds;o.x1=n.x1,o.x2=n.x2,o.y1=n.y1,o.y2=n.y2,r.isFrozenColumn(t,e)||r.isRightFrozenColumn(t,e)?r.isLeftBottomCorner(t,e)||r.isRightTopCorner(t,e)||(r.isFrozenColumn(t,e)||r.isRightFrozenColumn(t,e)?(o.y1=n.y1+i.getFrozenRowsHeight(),o.y2=n.y2-i.getBottomFrozenRowsHeight()):r.isBottomFrozenRow(t,e)&&(o.x1=n.x1+i.getFrozenColsWidth(),o.x2=n.x2-i.getRightFrozenColsWidth())):(o.x1=n.x1+i.getFrozenColsWidth(),o.x2=n.x2-i.getRightFrozenColsWidth(),o.y1=n.y1+i.getFrozenRowsHeight(),o.y2=n.y2-i.getBottomFrozenRowsHeight());return o}(e,i,t),l=a.intersect({x1:r-t.scrollLeft,x2:n-t.scrollLeft,y1:o-t.scrollTop,y2:s-t.scrollTop});this.activeChartInstance=new this.attribute.ClassType(this.attribute.spec,{renderCanvas:this.attribute.canvas,mode:"desktop-browser",canvasControled:!1,viewBox:{x1:r-t.scrollLeft,x2:n-t.scrollLeft,y1:o-t.scrollTop,y2:s-t.scrollTop},dpr:t.internalProps.pixelRatio,animation:!1,interactive:!0,autoFit:!1,beforeRender:t=>{const e=t.window.getContext();e.inuse=!0,e.clearMatrix(),e.setTransformForCurrent(!0),e.beginPath(),e.rect(l.x1,l.y1,l.x2-l.x1,l.y2-l.y1),e.clip()},afterRender(t){t.window.getContext().inuse=!1}}),this.activeChartInstance.renderSync(),t.internalProps.layoutMap?.updateDataStateToActiveChartInstance?.(this.activeChartInstance),this.activeChartInstance.on("click",(e=>{NR.temp&&t.scenegraph.updateChartState(e?.datum)})),this.activeChartInstance.on("brushEnd",(e=>{t.scenegraph.updateChartState(e?.value?.inBrushData),NR.temp=0,setTimeout((()=>{NR.temp=1}),0)})),t._bindChartEvent?.(this.activeChartInstance)}static temp=1;deactivate(){this.active=!1,this.activeChartInstance?.updateViewBox({x1:-1e3,x2:-800,y1:-1e3,y2:-800},!1,!1),this.activeChartInstance?.release(),this.activeChartInstance=null}updateData(t){this.attribute.data=t}getViewBox(){const t=this.parent,e=this.attribute.cellPadding,i=this.stage.table;return{x1:Math.ceil(t.globalAABBBounds.x1+e[3]+i.scrollLeft),x2:Math.ceil(t.globalAABBBounds.x1+t.attribute.width-e[1]+i.scrollLeft),y1:Math.ceil(t.globalAABBBounds.y1+e[0]+i.scrollTop),y2:Math.ceil(t.globalAABBBounds.y1+t.attribute.height-e[2]+i.scrollTop)}}}const GR={},jR={};function VR(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p,f,m,b){const y=sw(jR,GR)[c],C=BR("padding",p._getCellStyle(o,n),o,n,p);if(Y(C)&&(l=C),!t){const l=MR(o,n,f,p);b&&(t=p.scenegraph.highPerformanceGetCell(o,n,!0))&&"cell"===t.role&&t.setAttributes({x:i,y:r,width:s,height:a,lineWidth:f?.group?.lineWidth??void 0,fill:f?.group?.fill??void 0,stroke:f?.group?.stroke??void 0,strokeArrayWidth:l,strokeArrayColor:f?.group?.strokeArrayColor??void 0,cursor:f?.group?.cursor??void 0,lineDash:f?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius}),t&&"cell"===t.role||((t=new _R({x:i,y:r,width:s,height:a,lineWidth:f?.group?.lineWidth??void 0,fill:f?.group?.fill??void 0,stroke:f?.group?.stroke??void 0,strokeArrayWidth:l,strokeArrayColor:f?.group?.strokeArrayColor??void 0,cursor:f?.group?.cursor??void 0,lineDash:f?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius})).role="cell",t.col=o,t.row=n,e?.addCellGroup(t))}t.AABBBounds.width();const w=new NR(m,{stroke:!1,x:l[3],y:l[0],canvas:p.canvas??p.scenegraph.stage.window.getContext().canvas,mode:p.options.mode,modeParams:p.options.modeParams,spec:d,ClassType:y,width:s-l[3]-l[1],height:a-l[2]-l[0],chartInstance:u,dataId:g,data:p.getCellValue(o,n),cellPadding:l,dpr:p.internalProps.pixelRatio,axes:p.isPivotChart()?p.internalProps.layoutMap.getChartAxes(o,n):[]});return t.appendChild(w),p.internalProps.layoutMap.setChartInstance(o,n,w.chartInstance),t}class UR extends _R{_leftGroup;_rightGroup;_centerGroup;_autoWidth=!1;_autoHeight=!1;_cellWidth;_originCellWidth;_cellHeight;_align;_baseline;constructor(t){super(t),this._leftGroup=new _R({pickable:!1,fill:!1,stroke:!1}),this._leftGroup.role="content-left",this._rightGroup=new _R({pickable:!1,fill:!1,stroke:!1}),this._rightGroup.role="content-right",this._centerGroup=new _R({pickable:!1,fill:!1,stroke:!1}),this._centerGroup.role="content-center",this.appendChild(this._leftGroup),this.appendChild(this._rightGroup),this.appendChild(this._centerGroup)}setCellContentOption(t){this._autoWidth=t.autoWidth,this._autoHeight=t.autoHeight,this._cellWidth=t.cellWidth,this._originCellWidth=t.cellWidth,this._cellHeight=t.cellHeight,this._align=t.align,this._baseline=t.baseline}addLeftOccupyingIcon(t){t.setAttribute("x",this._leftGroup.width+(t.attribute.marginLeft??0)),this._leftGroup.appendChild(t),this._leftGroup.setDeltaWidth((t.attribute.marginLeft??0)+(t.attribute.marginRight??0)+t.attribute.width)}addRightOccupyingIcon(t){t.setAttribute("x",this._rightGroup.width+(t.attribute.marginLeft??0)),this._rightGroup.appendChild(t),this._rightGroup.setDeltaWidth((t.attribute.marginLeft??0)+(t.attribute.marginRight??0)+t.attribute.width)}addContent(t){const e=this._centerGroup.lastChild;e&&t.setAttributes({x:e.attribute.x+e.AABBBounds.width()}),this._centerGroup.appendChild(t),t instanceof ta&&(this._centerGroup.setAttribute("pickable",!1),t.setAttribute("textAlign","left"))}layout(){let t=this._leftGroup.width;t===1/0&&(t=0);let e=this._rightGroup.width;if(e===-1/0&&(e=0),this._autoWidth){const i=this._centerGroup.width;this._cellWidth=t+e+i,this.setAttribute("width",this._cellWidth)}else{const i=this._cellWidth-t-e;this.updateCenterLayout(i);const r=this._centerGroup.width;this._cellWidth=t+e+r,this.setAttribute("width",this._cellWidth)}this.updateHorizontalPos();const i=this._leftGroup.height,r=this._rightGroup.height,o=this._centerGroup.height;this._cellHeight=Math.max(i,r,o),this.setAttribute("height",this._cellHeight),this.updateVerticalPos()}updateCenterLayout(t){let e=t;this._centerGroup.forEachChildren((t=>{t instanceof pR&&(e-=t.AABBBounds.width())}));const i=this._centerGroup.getChildByName("text");i instanceof Pl?i.setAttribute("width",e):i instanceof ta&&i.setAttribute("maxLineWidth",e);let r=0;this._centerGroup.forEachChildren((t=>{t.setAttribute("x",r),r+=t.AABBBounds.width()}))}updateHorizontalPos(){this._leftGroup.setAttribute("x",0),this._rightGroup.setAttribute("x",this._cellWidth-this._rightGroup.width),this._centerGroup.setAttribute("x",this._leftGroup.width),"left"===this._align||"start"===this._align?this.setAttribute("dx",0):"center"===this._align?this.setAttribute("dx",-this.attribute.width/2):"right"!==this._align&&"end"!==this._align||this.setAttribute("dx",-this.attribute.width)}updateVerticalPos(){"top"===this._baseline?(this._leftGroup.setAttribute("y",0),this._rightGroup.setAttribute("y",0),this._centerGroup.setAttribute("y",0)):"middle"===this._baseline?(this._leftGroup.forEachChildren((t=>{t.setAttribute("y",(this._leftGroup.height-t.AABBBounds.height())/2)})),this._rightGroup.forEachChildren((t=>{t.setAttribute("y",(this._rightGroup.height-t.AABBBounds.height())/2)})),this._leftGroup.setAttribute("y",this._cellHeight/2-this._leftGroup.height/2),this._rightGroup.setAttribute("y",this._cellHeight/2-this._rightGroup.height/2),this._centerGroup.setAttribute("y",this._cellHeight/2-this._centerGroup.height/2)):"bottom"===this._baseline&&(this._leftGroup.forEachChildren((t=>{t.setAttribute("y",this._leftGroup.height-t.AABBBounds.height())})),this._rightGroup.forEachChildren((t=>{t.setAttribute("y",this._rightGroup.height-t.AABBBounds.height())})),this._leftGroup.setAttribute("y",this._cellHeight-this._leftGroup.height),this._rightGroup.setAttribute("y",this._cellHeight-this._rightGroup.height),this._centerGroup.setAttribute("y",this._cellHeight-this._centerGroup.height))}updateWidth(t){this._cellWidth=t,this._originCellWidth=t,this.layout()}updateHeight(t){this._cellHeight=t,this._cellWidth=this._originCellWidth,this.layout()}}function KR(t,e,i){let r=0;const o=i.internalProps.layoutMap;if(o.isHeader(t,e)){const n=o.getHeader(t,e);Y(n?.hierarchyLevel)&&(r=(n.hierarchyLevel??0)*(o.rowHierarchyIndent??0),o.rowHierarchyTextStartAlignment&&!i.internalProps.headerHelper.getHierarchyIcon(t,e)&&(r+=i.internalProps.headerHelper.getHierarchyIconWidth()))}else{const n=i.getBodyColumnDefine(t,e);if(n?.tree){const n=i.dataSource.getIndexKey(i.getRecordShowIndexByCell(t,e));r=Array.isArray(n)&&i.getHierarchyState(t,e)!==oC.none?(n.length-1)*(o.hierarchyIndent??0):0,o.hierarchyTextStartAlignment&&!i.internalProps.bodyHelper.getHierarchyIcon(t,e)&&(r+=i.internalProps.bodyHelper.getHierarchyIconWidth())}}return r}function $R(t,e){let i;for(i=e.internalProps.enableLineBreak||e.options.customConfig?.multilinesForXTable?NC(t).replace(/\r?\n/g,"\n").replace(/\r/g,"\n").split("\n")||[]:[NC(t)];i.length&&!i[i.length-1];)i.pop();return i}function XR(t,e,i,r,o,n){const s={};"image"===t.type?s.image=t.src:("svg"===t.type||"svg"in t)&&(s.image=t.svg),s.width=t.width,s.height=t.height,s.visibleTime=t.visibleTime??"always",s.funcType=t.funcType,s.interactive=t.interactive;let a=0;if(ot(i)&&ot(r)&&n&&(t.funcType===lC.collapse||t.funcType===lC.expand)&&(a=o?KR(o.start.col,o.start.row,n):KR(i,r,n)),s.marginLeft=(t.marginLeft??0)+a,s.marginRight=t.marginRight??0,!1===t.interactive&&(s.pickable=!1),t.hover&&(s.backgroundWidth=t.hover.width??t.width,s.backgroundHeight=t.hover.width??t.width,s.backgroundColor=t.hover.bgColor??"rgba(22,44,66,0.2)",s.hoverImage=t.hover.image),t.cursor&&(s.cursor=t.cursor),"shape"in t&&"circle"===t.shape&&(s.shape=t.shape),e)return e.setAttributes(s),e.loadImage(s.image),e;const l=new pR(s);return l.tooltip=t.tooltip,l}function YR(t){const e={};return"image"===t.type?e.image=t.src:("svg"===t.type||"svg"in t)&&(e.image=t.svg),e.visibleTime=t.visibleTime??"always",e.funcType=t.funcType,e.id=t.name,e.width=t.width,e.height=t.height,(t.marginRight||t.marginLeft)&&(e.margin=[0,t.marginRight??0,0,t.marginLeft??0]),t.hover&&(e.backgroundWidth=t.hover.width??t.width,e.backgroundHeight=t.hover.height??t.height,e.backgroundShowMode="hover",e.hoverImage=t.hover.image,e.backgroundStroke=!1,e.backgroundFill=t.hover.bgColor??"rgba(22,44,66,0.2)"),t.cursor&&(e.cursor=t.cursor),e.tooltip=t.tooltip,e}function qR(t,e,i,r,o,n,s,a,l){let h,c=0,d=0,u=0,g=0;t.forEachChildren((t=>{"icon-left"===t.role?(c+=t.AABBBounds.width(),d=Math.max(d,t.AABBBounds.height())):"icon-right"===t.role&&(u+=t.AABBBounds.width(),g=Math.max(g,t.AABBBounds.height()))}));const p=t.getChildByName("text"),f=t.getChildByName("content");let m;p instanceof ta?(h=p.AABBBounds.height(),p.setAttribute("maxLineWidth",e-c-g-(n[1]+n[3])-(p.attribute.dx??0)),m=p.AABBBounds.height()):p instanceof Pl?(h=p.AABBBounds.height(),p.setAttribute("width",e-c-g-(n[1]+n[3])),m=p.AABBBounds.height()):f&&(h=f.AABBBounds.height(),f.updateWidth(e-c-g-(n[1]+n[3])),m=f.AABBBounds.height());const b=Math.round(Math.max(d,g,h)+n[0]+n[2]);if(t.forEachChildren((i=>{if("icon-left"===i.role);else if("icon-right"===i.role)i.setAttribute("x",i.attribute.x+r);else if("icon-absolute-right"===i.role)i.setAttribute("x",i.attribute.x+r);else if("content"===i.name||"text"===i.name){const t=i.attribute.textAlign??s;"center"===t?i.setAttribute("x",n[3]+c+(e-(n[1]+n[3])-c-u)/2):"right"===t&&i.setAttribute("x",n[3]+e-(n[1]+n[3])-u)}else"mark"===i.name&&i.setAttribute("x",t.attribute.width)})),o){let e=Math.max(d,m,g);if(function(t,e,i,r){const o=t.table,n=iv(o,e.col,e.row);if(n&&n.end.row-n.start.row){r/=n.end.row-n.start.row+1,i/=n.end.row-n.start.row+1;for(let t=n.start.row;t<=n.end.row;t++){const e=o.getRowHeight(t);if(e===r&&i!==e)return!0;if(i>e)return!0}}else{const t=o.getRowHeight(e.row);if(t===r&&i!==t)return!0;if(i>t)return!0}return!1}(l,t,e+n[0]+n[2],b))return!0;e=(t.contentHeight??i)-(n[0]+n[2]),t.forEachChildren((t=>{"rect"!==t.type&&"chart"!==t.type&&("mark"===t.name?t.setAttribute("y",0):"middle"===a?t.setAttribute("y",n[0]+(e-t.AABBBounds.height())/2):"bottom"===a?t.setAttribute("y",n[0]+e-t.AABBBounds.height()):t.setAttribute("y",n[0]))}))}else"middle"!==a&&"bottom"!==a||t.forEachChildren((t=>{"rect"!==t.type&&"chart"!==t.type&&("mark"===t.name?t.setAttribute("y",0):"middle"===a?t.setAttribute("y",(i-n[2]+n[0]-t.AABBBounds.height())/2):"bottom"===a?t.setAttribute("y",i-t.AABBBounds.height()-n[2]):t.setAttribute("y",n[0]))}));return!1}function ZR(t,e,i,r,o,n,s){const a=e-(o[0]+o[2]),l=t.getChildByName("text");if(l instanceof ta&&!r)l.setAttributes({heightLimit:a});else if(l instanceof Pl&&!r)l.setAttributes({height:a});else if(t.getChildByName("content")){t.getChildByName("content").updateHeight(a)}t.forEachChildren((t=>{t.setAttribute("dy",0),"rect"===t.type||"chart"===t.type||("mark"===t.name?t.setAttribute("y",0):"middle"===s?t.setAttribute("y",o[0]+(a-t.AABBBounds.height())/2):"bottom"===s?t.setAttribute("y",o[0]+a-t.AABBBounds.height()):t.setAttribute("y",o[0]))}))}function JR(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p,f,m,b,y){const C=t._getCellStyle(n,s),w=BR("padding",C,n,s,t);Y(w)&&(c=w),m?.text?.textAlign&&(d=m?.text?.textAlign),m?.text?.textBaseline&&(u=m?.text?.textBaseline);const v=t.isAutoRowHeight(s),x="auto"===a,_=C.autoWrapText??t.internalProps.autoWrapText,S=C.lineClamp,A=MR(n,s,m,t);let R;if(y&&(R=t.scenegraph.getCell(n,s,!0),R&&"cell"===R.role&&R.setAttributes({x:r,y:o,width:l,height:h,lineWidth:m?.group?.lineWidth??void 0,fill:m?.group?.fill??void 0,stroke:m?.group?.stroke??void 0,strokeArrayWidth:A??void 0,strokeArrayColor:m?.group?.strokeArrayColor??void 0,cursor:m?.group?.cursor??void 0,lineDash:m?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:m.group.cornerRadius})),R&&"cell"===R.role||(R=new _R({x:r,y:o,width:l,height:h,lineWidth:m?.group?.lineWidth??void 0,fill:m?.group?.fill??void 0,stroke:m?.group?.stroke??void 0,strokeArrayWidth:A??void 0,strokeArrayColor:m?.group?.strokeArrayColor??void 0,cursor:m?.group?.cursor??void 0,lineDash:m?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:m.group.cornerRadius}),R.role="cell",R.col=n,R.row=s,i?.addCellGroup(R)),p&&R.appendChild(p),f){const i=e;let r;if(g){let e=n,i=s;b&&(e=b.start.col,i=b.start.row),r=t.getCellIcons(e,i)}if(function(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p){const f=[],m=[],b=[],y=[],C=[],w=[],v=[],x=[];let _,S=0,A=0,R=0,B=0,M=0,T=0;if(Array.isArray(e)&&0!==e.length){let P;if(e.forEach((t=>{switch(t.positionType){case aC.left:f.push(t);break;case aC.right:m.push(t);break;case aC.contentLeft:b.push(t);break;case aC.contentRight:y.push(t);break;case aC.absoluteRight:x.push(t);break;case aC.inlineFront:C.push(t);break;case aC.inlineEnd:w.push(t)}})),f.forEach((e=>{const i=XR(e,void 0,t.col,t.row,p,u);i.role="icon-left",i.name=e.name,i.setAttribute("x",S+(i.attribute.marginLeft??0)),S+=i.AABBBounds.width()+(i.attribute.marginLeft??0)+(i.attribute.marginRight??0),A=Math.max(A,i.AABBBounds.height()),t.appendChild(i)})),m.forEach((e=>{const i=XR(e,void 0,t.col,t.row,p,u);i.role="icon-right",i.name=e.name,i.setAttribute("x",R+(i.attribute.marginLeft??0)),R+=i.AABBBounds.width()+(i.attribute.marginLeft??0)+(i.attribute.marginRight??0),B=Math.max(B,i.AABBBounds.height()),t.appendChild(i)})),v.forEach((e=>{const i=XR(e,void 0,t.col,t.row,p,u);i.role="icon-absolute-left",i.name=e.name,i.setAttribute("x",M+(i.attribute.marginLeft??0)),M+=i.AABBBounds.width()+(i.attribute.marginLeft??0)+(i.attribute.marginRight??0),t.appendChild(i)})),x.forEach((e=>{const i=XR(e,void 0,t.col,t.row,p,u);i.role="icon-absolute-right",i.name=e.name,i.setAttribute("x",T+(i.attribute.marginLeft??0)),T+=i.AABBBounds.width()+(i.attribute.marginLeft??0)+(i.attribute.marginRight??0),t.appendChild(i)})),0===C.length&&0===w.length){let e=0;ot(u.theme._contentOffset)&&("left"===c?e=u.theme._contentOffset:"right"===c&&(e=-u.theme._contentOffset));const d=p?KR(p.start.col,p.start.row,u):KR(t.col,t.row,u),f=$R(i,u),m={text:1===f.length?f[0]:f,maxLineWidth:o?1/0:l-(r[1]+r[3])-S-R-d,textBaseline:"top",heightLimit:n&&!u.options.customConfig?.multilinesForXTable?-1:h-(r[0]+r[2]),pickable:!1,autoWrapText:s,lineClamp:a,wordBreak:"break-word",whiteSpace:1!==f.length||s?"normal":"no-wrap",dx:("left"===c?b.length||y.length?0:d:0)+e},C=new ta(g.text?Object.assign({},g.text,m):m);C.name="text",P=C}else{const e=Object.assign({text:i?.toString()},t.parent?.theme?.userTheme?.text||{});g.text&&Object.assign(e,g.text),e.textBaseline="middle";const a=[...C.map((t=>YR(t))),e,...w.map((t=>YR(t)))];a[0].textAlign=c;const u=new Pl({width:o?0:l-(r[1]+r[3])-S-R,height:n&&s?0:Math.ceil(h-(r[0]+r[2])),textConfig:a,verticalDirection:n&&s?"top":d,ellipsis:e.ellipsis});u.name="text",P=u,u.bindIconEvent()}if(0!==b.length||0!==y.length){const e=new UR({x:0,y:0,fill:!1,stroke:!1});e.name="content",e.setCellContentOption({autoWidth:o,autoHeight:n,cellWidth:l-(r[1]+r[3])-S-R,cellHeight:h-(r[0]+r[2]),align:c,baseline:d}),b.forEach((i=>{const r=XR(i,void 0,t.col,t.row,p,u);r.role="icon-content-left",r.name=i.name,e.addLeftOccupyingIcon(r)})),y.forEach((i=>{const r=XR(i,void 0,t.col,t.row,p,u);r.role="icon-content-right",r.name=i.name,e.addRightOccupyingIcon(r)})),e.addContent(P),t.appendChild(e),e.layout(),_=e.AABBBounds.width(),e.AABBBounds.height()}else t.firstChild?t.insertBefore(P,t.firstChild):t.appendChild(P),_=P.AABBBounds.width(),P.AABBBounds.height()}else if(Y(i)){const e=$R(i,u),f=p?KR(p.start.col,p.start.row,u):KR(t.col,t.row,u);let m=0;ot(u.theme._contentOffset)&&("left"===c?m=u.theme._contentOffset:"right"===c&&(m=-u.theme._contentOffset));const b={text:1===e.length?e[0]:e,maxLineWidth:o?1/0:l-(r[1]+r[3]+f),textBaseline:"top",autoWrapText:s,lineClamp:a,wordBreak:"break-word",heightLimit:n&&!u.options.customConfig?.multilinesForXTable?-1:h-(r[0]+r[2]),pickable:!1,dx:("left"===c?f:0)+m,whiteSpace:1!==e.length||s?"normal":"no-wrap"},y=new ta(g.text?Object.assign({},g.text,b):b);y.name="text",y.textBaseline=d,t.appendChild(y),_=y.AABBBounds.width(),y.AABBBounds.height()}const P=o?S+_+R:l-(r[1]+r[3]),H=h-(r[0]+r[2]);t.forEachChildren((t=>{"icon-left"===t.role?t.setAttribute("x",t.attribute.x+r[3]):"icon-right"===t.role?t.setAttribute("x",t.attribute.x+P-R+r[3]):"icon-absolute-right"===t.role?t.setAttribute("x",t.attribute.x+P-T+r[3]+r[1]):"content"!==t.name&&"text"!==t.name||("center"===c&&"richtext"!==t.type?t.setAttribute("x",r[3]+S+(P-S-R)/2):"right"===c&&"richtext"!==t.type?t.setAttribute("x",r[3]+P-R):t.setAttribute("x",r[3]+S))})),t.forEachChildren((t=>{"middle"===d?t.setAttribute("y",r[0]+(H-t.AABBBounds.height())/2):"bottom"===d?t.setAttribute("y",r[0]+H-t.AABBBounds.height()):t.setAttribute("y",r[0])})),t.setAttributes({width:P+r[1]+r[3],height:H+r[0]+r[2]})}(R,r,i,c,x,v,_,"number"==typeof S?S:void 0,l,h,d,u,t,m,b),m?._vtable?.marked){const t=Wl({x:R.attribute.width,y:0,startAngle:Math.PI/2,endAngle:Math.PI,outerRadius:6,fill:"#3073F2",pickable:!1});t.name="mark",R.appendChild(t)}}return p&&R.setAttributes({width:Math.max(R.attribute.width,p.attribute.width??0),height:Math.max(R.attribute.height,p.attribute.height??0)}),R}const QR=xR();function tB(t,e,i){t.then((()=>{i(),e.scenegraph.updateNextFrame()})).catch((t=>{}))}function eB(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p,f){if(!t){const s=MR(o,n,g,u);f&&(t=u.scenegraph.highPerformanceGetCell(o,n,!0))&&"cell"===t.role&&t.setAttributes({x:i,y:r,width:a,height:l,lineWidth:g?.group?.lineWidth??void 0,fill:g?.group?.fill??void 0,stroke:g?.group?.stroke??void 0,strokeArrayWidth:s,strokeArrayColor:g?.group?.strokeArrayColor??void 0,cursor:g?.group?.cursor??void 0,lineDash:g?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:g.group.cornerRadius}),t&&"cell"===t.role||((t=new _R({x:i,y:r,width:a,height:l,lineWidth:g?.group?.lineWidth??void 0,fill:g?.group?.fill??void 0,stroke:g?.group?.stroke??void 0,strokeArrayWidth:s,strokeArrayColor:g?.group?.strokeArrayColor??void 0,cursor:g?.group?.cursor??void 0,lineDash:g?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:g.group.cornerRadius})).role="cell",t.col=o,t.row=n,e?.addCellGroup(t))}const m=function(t,e,i,r,o,n,s,a,l){const h=l._getCellStyle(t,e),c=RR("size",h,t,e,l),d=RR("spaceBetweenTextAndIcon",h,t,e,l),u=RR("defaultFill",h,t,e,l),g=RR("defaultStroke",h,t,e,l),p=RR("disableFill",h,t,e,l),f=RR("checkedFill",h,t,e,l),m=RR("checkedStroke",h,t,e,l),b=RR("disableCheckedFill",h,t,e,l),y=RR("disableCheckedStroke",h,t,e,l),C=RR("checkIconImage",h,t,e,l),w=RR("indeterminateIconImage",h,t,e,l),v=l.getCellValue(t,e),x=l.getCellOriginValue(t,e);let _,S,A=v??"";q(v)?(_=v.checked,S=v.disable,A=v.text??""):"boolean"==typeof v&&(_=v,A="");_=l.stateManager.syncCheckedState(t,e,a.field,_);const R=KR(t,e,l),B=l._getCellStyle(t,e),M=B.autoWrapText??l.internalProps.autoWrapText,{lineClamp:T}=B,{checked:P,disable:H}=a;if(null==_||"function"==typeof _){const i=hw(P,{col:t,row:e,table:l,context:null,value:v,dataValue:x});_=l.stateManager.syncCheckedState(t,e,a.field,i)}const E=hw(H,{col:t,row:e,table:l,context:null,value:v,dataValue:x}),k="auto"===i,L=l.isAutoRowHeight(e),F={text:1===A.length?A[0]:A,maxLineWidth:k?1/0:r-(n[1]+n[3]+R)-c-d,textBaseline:"top",autoWrapText:M,lineClamp:T,wordBreak:"break-word",heightLimit:L?-1:o-(n[0]+n[2]),pickable:!1,dx:R,whiteSpace:1!==A.length||M?"normal":"no-wrap"},I=s.text?Object.assign({},s.text,F):F,z={x:0,y:0,text:I,icon:{width:Math.floor(c/1.4),height:Math.floor(c/1.4)},box:{width:c,height:c},spaceBetweenTextAndIcon:d,disabled:S??E??!1};"indeterminate"===_?(z.checked=void 0,z.indeterminate=!0):(z.checked=_,z.indeterminate=void 0);u&&(z.box.fill=u),g&&(z.box.stroke=g),p&&(z.box.disableFill=p),f&&(z.box.checkedFill=f),m&&(z.box.checkedStroke=m),b&&(z.box.disableCheckedFill=b),y&&(z.box.disableCheckedStroke=y),C&&(z.icon.checkIconImage=C),w&&(z.icon.indeterminateIconImage=w);const O=new h_(z);return O.name="checkbox",O}(o,n,s,a,l,h,g,p,u);return m&&t.appendChild(m),m.render(),a-=h[1]+h[3],l-=h[0]+h[2],"center"===c?m.setAttribute("x",h[3]+(a-m.AABBBounds.width())/2):"right"===c?m.setAttribute("x",h[3]+a-m.AABBBounds.width()):m.setAttribute("x",h[3]),"middle"===d?m.setAttribute("y",h[0]+(l-m.AABBBounds.height())/2):"bottom"===d?m.setAttribute("y",h[0]+l-m.AABBBounds.height()):m.setAttribute("y",h[0]),t}function iB(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p){if(!t){const s=MR(o,n,g,u);(t=new _R({x:i,y:r,width:a,height:l,lineWidth:g?.group?.lineWidth??void 0,fill:g?.group?.fill??void 0,stroke:g?.group?.stroke??void 0,strokeArrayWidth:s,strokeArrayColor:g?.group?.strokeArrayColor??void 0,cursor:g?.group?.cursor??void 0,lineDash:g?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:g.group.cornerRadius})).role="cell",t.col=o,t.row=n,e?.addCellGroup(t)}const{width:f,height:m}=function(t,e,i,r,o,n,s,a,l,h){const c=h._getCellStyle(t,e);let d=RR("size",c,t,e,h),u=RR("innerRadius",c,t,e,h),g=RR("outerRadius",c,t,e,h);const p=RR("spaceBetweenTextAndIcon",c,t,e,h),f=RR("spaceBetweenRadio",c,t,e,h),m=RR("defaultFill",c,t,e,h),b=RR("defaultStroke",c,t,e,h),y=RR("disableFill",c,t,e,h),C=RR("checkedFill",c,t,e,h),w=RR("checkedStroke",c,t,e,h),v=RR("disableCheckedFill",c,t,e,h),x=RR("disableCheckedStroke",c,t,e,h);ot(g)?d=2*g:g=Math.round(d/2);(!ot(u)||u<0)&&(u=Math.round(g/7*3));const _=h.getCellValue(t,e),S=h.getCellOriginValue(t,e),A=KR(t,e,h),R=h._getCellStyle(t,e),B=R.autoWrapText??h.internalProps.autoWrapText,{lineClamp:M}=R,T="auto"===i,P="autoHeight"===h.heightMode,H={maxLineWidth:T?1/0:r-(n[1]+n[3]+A)-d-p,textBaseline:"top",autoWrapText:B,lineClamp:M,wordBreak:"break-word",heightLimit:P?-1:o-(n[0]+n[2]),pickable:!1,dx:A},E=s.text?Object.assign({},s.text,H):H,k={x:0,y:0,text:E,circle:{innerRadius:u,outerRadius:g},spaceBetweenTextAndIcon:p};m&&(k.circle.fill=m),b&&(k.circle.stroke=b),y&&(k.circle.disableFill=y),C&&(k.circle.checkedFill=C),w&&(k.circle.checkedStroke=w),v&&(k.circle.disableCheckedFill=v),x&&(k.circle.disableCheckedStroke=x);let L=0,F=0;const I=a.radioDirectionInCell??"vertical";if(et(_))_.forEach(((i,r)=>{const o=rB(i,S,r,t,e,a,B,k,h);o&&l.appendChild(o),o.id=`radio-${t}-${e}-${r}`,o.render();const n=o.AABBBounds;"vertical"===I?(o.setAttribute("y",F),F+=n.height()+(r!==_.length-1?f:0),L=Math.max(L,n.width())):"horizontal"===I&&(o.setAttribute("x",L),L+=n.width()+(r!==_.length-1?f:0),F=Math.max(F,n.height()))}));else{const i=rB(_,S,void 0,t,e,a,B,k,h);i&&l.appendChild(i),i.id=`radio-${t}-${e}`,i.render();const r=i.AABBBounds;L=r.width(),F=r.height()}return{width:L,height:F}}(o,n,s,a,l,h,g,p,t,u);return a-=h[1]+h[3],l-=h[0]+h[2],t.forEachChildren((t=>{"center"===c?t.setAttribute("x",h[3]+t.attribute.x+(a-f)/2):"right"===c?t.setAttribute("x",h[3]+t.attribute.x+a-f):t.setAttribute("x",h[3]+t.attribute.x),"middle"===d?t.setAttribute("y",h[0]+t.attribute.y+(l-m)/2):"bottom"===d?t.setAttribute("y",h[0]+t.attribute.y+l-m):t.setAttribute("y",h[0]+t.attribute.y)})),t}function rB(t,e,i,r,o,n,s,a,l){const h=function(t,e,i,r,o,n,s){const a=n.radioCheckType??"column";let l,h;q(t)?l=t.checked:"boolean"==typeof t&&(l=t);l=s.stateManager.syncRadioState(r,o,n.field,a,i,l),(null==l||"function"==typeof l)&&(h=hw(n.checked,{col:r,row:o,table:s,context:null,value:t,dataValue:e}),l=s.stateManager.syncRadioState(r,o,n.field,a,i,h));return l??h??!1}(t,e,i,r,o,n,l),c=function(t,e,i,r,o,n){let s;q(t)&&(s=t.disable);const a=hw(o.disable,{col:i,row:r,table:n,context:null,value:t,dataValue:e});return s??a??!1}(t,e,r,o,n,l),d=q(t)?t.text:K(t)?"":t??"",u=wt({},a,{checked:h,disabled:c,text:{text:1===d.length?d[0]:d,whiteSpace:1!==d.length||s?"normal":"no-wrap"},boundsPadding:0}),g=new c_(u);return g.name="radio",g}function oB(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p,f,m,b){let y,C=!1;if(cw(e)&&(e=r.getCellValue(o,n),C=!0),"text"===t||"link"===t){if("link"===t){const s=e,a=r._getCellStyle(o,n);"link"===t&&("templateLink"in i&&i.templateLink||!("linkDetect"in i)||!i.linkDetect||zw.test(s))&&(f?(f.text.fill=RR("linkColor",a,o,n,r),f.group.cursor="pointer"):f={text:{fill:RR("linkColor",a,o,n,r)},group:{cursor:"pointer"}})}let w,v=!0;if(b)w=b.elementsGroup,v=b.renderDefault;else{let t,e;if("body"!==r.getCellLocation(o,n)?(t=i?.headerCustomRender,e=i?.headerCustomLayout):(t=i?.customRender||r.customRender,e=i?.customLayout),e||t){const i=fR(e,t,o,n,a,l,!1,r.isAutoRowHeight(n),d,r);w=i.elementsGroup,v=i.renderDefault}}y=JR(r,e,h,0,c,o,n,s,a,l,d,u,g,p,w,v,f,m,C);const x=r.internalProps.layoutMap.getAxisConfigInPivotChart(o,n);if(x){const t=new qS(x,y.attribute.width,y.attribute.height,d,r);y.clear(),y.appendChild(t.component),t.overlap()}else r.internalProps.layoutMap.isEmpty(o,n)?(y.setAttributes({fill:!1,stroke:!1}),y.clear()):r.internalProps.layoutMap.isAxisCell(o,n)&&y.clear()}else if("image"===t)y=function(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p){const f=BR("padding",u._getCellStyle(r,o),r,o,u);Y(f)&&(h=f),g?.text?.textAlign&&(c=g?.text?.textAlign),g?.text?.textBaseline&&(d=g?.text?.textBaseline);const m=MR(r,o,g,u);let b;p&&(b=u.scenegraph.highPerformanceGetCell(r,o,!0),b&&"cell"===b.role&&b.setAttributes({x:e,y:i,width:n,height:s,lineWidth:g?.group?.lineWidth??void 0,fill:g?.group?.fill??void 0,stroke:g?.group?.stroke??void 0,strokeArrayWidth:m??void 0,strokeArrayColor:g?.group?.strokeArrayColor??void 0,cursor:g?.group?.cursor??void 0,lineDash:g?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:g.group.cornerRadius})),b&&"cell"===b.role||(b=new _R({x:e,y:i,width:n,height:s,lineWidth:g?.group?.lineWidth??void 0,fill:g?.group?.fill??void 0,stroke:g?.group?.stroke??void 0,strokeArrayWidth:m??void 0,strokeArrayColor:g?.group?.strokeArrayColor??void 0,cursor:g?.group?.cursor??void 0,lineDash:g?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:g.group.cornerRadius}),b.role="cell",b.col=r,b.row=o,t?.addCellGroup(b));const y=u.getCellValue(r,o),C=Al({x:h[3],y:h[0],width:n-h[1]-h[3],height:s-h[0]-h[2],image:y,cursor:"pointer"});return C.name="image",C.keepAspectRatio=a,C.textAlign=c,C.textBaseline=d,a||l?C.resources&&C.resources.has(C.attribute.image)&&"success"===C.resources.get(C.attribute.image).state?setTimeout((()=>{kR(l,a,h,c,d,C,b,u)}),0):C.successCallback=()=>{kR(l,a,h,c,d,C,b,u),u.scenegraph.updateNextFrame()}:C.resources&&C.resources.has(C.attribute.image)&&"success"===C.resources.get(C.attribute.image).state?PR(b,r,o,u):C.successCallback=()=>{PR(b,r,o,u)},C.failCallback=()=>{const t=xR();C.image=t.damage_pic.svg},b.appendChild(C),b}(h,0,c,o,n,a,l,i.keepAspectRatio,i.imageAutoSizing,d,u,g,r,f,C);else if("video"===t)y=function(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p){const f=BR("padding",u._getCellStyle(r,o),r,o,u);Y(f)&&(h=f),g?.text?.textAlign&&(c=g?.text?.textAlign),g?.text?.textBaseline&&(d=g?.text?.textBaseline);const m=MR(r,o,g,u);let b;p&&(b=u.scenegraph.highPerformanceGetCell(r,o,!0),b&&"cell"===b.role&&b.setAttributes({x:e,y:i,width:n,height:s,lineWidth:g?.group?.lineWidth??void 0,fill:g?.group?.fill??void 0,stroke:g?.group?.stroke??void 0,strokeArrayWidth:m,strokeArrayColor:g?.group?.strokeArrayColor??void 0,cursor:g?.group?.cursor??void 0,lineDash:g?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:g.group.cornerRadius})),b&&"cell"===b.role||(b=new _R({x:e,y:i,width:n,height:s,lineWidth:g?.group?.lineWidth??void 0,fill:g?.group?.fill??void 0,stroke:g?.group?.stroke??void 0,strokeArrayWidth:m,strokeArrayColor:g?.group?.strokeArrayColor??void 0,cursor:g?.group?.cursor??void 0,lineDash:g?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:g.group.cornerRadius}),b.role="cell",b.col=r,b.row=o,t?.addCellGroup(b));const y=u.getCellValue(r,o),C=document.createElement("video");C.addEventListener("loadeddata",(()=>{l&&TR(r,o,C.videoWidth,C.videoHeight,u.scenegraph,h,b);const{width:t,height:e,isMerge:i}=HR(b,u);if(a){const{width:i,height:r}=SR(C.videoWidth,C.videoHeight,t-h[1]-h[3],e-h[0]-h[2]),o=AR(0,0,t,e,i,r,c,d,h);w.setAttributes({width:i,height:r,x:o.x,y:o.y,dx:0})}else w.setAttributes({x:h[3],y:h[0],width:t-h[1]-h[3],height:e-h[2]-h[0],dy:0});i&&ER(b.mergeStartCol,b.mergeEndCol,b.mergeStartRow,b.mergeEndRow,u);const{width:n,height:s}=HR(b,u),g=Math.floor(Math.min(n-h[1]-h[3],s-h[2]-h[0])/2),p=0+(n>w.attribute.width?w.attribute.x-0+w.attribute.width/2:n/2),f=0+(s>w.attribute.height?w.attribute.y-0+w.attribute.height/2:s/2),m=new pR({x:p-g/2,y:f-g/2,width:g,height:g,image:QR.play.svg,cursor:QR.play.cursor});m.name="play-icon",b.appendChild(m),u.scenegraph.updateNextFrame()})),C.onerror=()=>{w.image=QR.damage_pic.svg},C.src=y,C.setAttribute("preload","auto");const w=Al({x:h[3],y:h[0],width:n-h[1]-h[3],height:s-h[2]-h[0],image:C,cursor:"pointer"});return w.name="image",w.keepAspectRatio=a,w.textAlign=c,w.textBaseline=d,b.appendChild(w),b}(h,0,c,o,n,a,l,i.keepAspectRatio,i.imageAutoSizing,d,u,g,r,f,C);else if("chart"===t){const t=r.internalProps.layoutMap.getChartInstance(o,n);y=VR(null,h,0,c,o,n,a,l,d,0,i.chartModule,r.internalProps.layoutMap.getChartSpec(o,n),t,r.internalProps.layoutMap.getChartDataId(o,n)??"data",r,f,r.internalProps.layoutMap.isShareChartSpec(o,n),C)}else if("progressbar"===t){const t=r._getCellStyle(o,n),p=r.getCellOriginValue(o,n);y=JR(r,e,h,0,c,o,n,s,a,l,d,u,g,!1,null,!0,f,m,C);const b=FR(i,t,s,e,p,o,n,0,r);y.firstChild?y.insertBefore(b,y.firstChild):y.appendChild(b)}else"sparkline"===t?y=OR(null,h,0,c,o,n,a,l,d,r,f,C):"checkbox"===t?y=eB(null,h,0,c,o,n,s,a,l,d,u,g,r,f,i,C):"radio"===t&&(y=iB(null,h,0,c,o,n,s,a,l,d,u,g,r,f,i));return y}function nB(t,e,i,r){const o=i.scenegraph.highPerformanceGetCell(t,e,!0),n=i._getCellStyle(t,e),s=n.autoWrapText??i.internalProps.autoWrapText,a=i.getCellLocation(t,e);let l,h,c,d,u,g=i.getCellValue(t,e);if(i.internalProps.customMergeCell){const r=i.getCustomMerge(t,e);if(r){const{range:o,text:n,style:s,customLayout:a,customRender:p}=r;h=o,l=h.start.col!==h.end.col||h.start.row!==h.end.row,g=n,d=s,d&&(c=cR(d,i,h.start.col,h.start.row,RR).theme,c.group.cornerRadius=uR(t,e,i)),(a||p)&&(u=fR(a,p,o.start.col,o.start.row,i.getColsWidth(o.start.col,o.end.col),i.getRowsHeight(o.start.row,o.end.row),!1,i.isAutoRowHeight(e),[0,0,0,0],i))}}let p=t,f=e;h&&(p=h.start.col,f=h.start.row);const m="body"!==a?i.getHeaderDefine(p,f):i.getBodyColumnDefine(p,f);if(h||"body"===a&&!m?.mergeCell||(h=i.getCellRange(t,e),l=h.start.col!==h.end.col||h.start.row!==h.end.row),c||(c=cR(n,i,l?h.start.col:t,l?h.start.row:e,RR).theme),c.group.cornerRadius=uR(t,e,i),!r&&!l&&function(t,e,i,r,o){const n=o.getBodyColumnDefine(t,e),s=!!n?.icon||!!n?.tree||n?.dragOrder,a=o.getBodyColumnType(t,e),l=o.isAutoRowHeight(e),h=o.getCellValue(t,e);if(!(o.isHeader(t,e)||"cell"!==i.role||"text"!==a||r||l||s||"text"!==i.firstChild?.type||cw(h)))return!0;return!1}(t,e,o,s,i)){const r=i.getColWidth(t),a=i.getRowHeight(e);o.setAttributes({width:r,height:a,lineWidth:c?.group?.lineWidth??void 0,fill:c?.group?.fill??void 0,stroke:c?.group?.stroke??void 0,strokeArrayWidth:c?.group?.strokeArrayWidth??void 0,strokeArrayColor:c?.group?.strokeArrayColor??void 0,cursor:c?.group?.cursor??void 0,cornerRadius:c?.group?.cornerRadius??0,y:i.scenegraph.getCellGroupY(e)}),o.forEachChildren((t=>{t.setAttributes({dx:0,dy:0})}));const l=o.getChildByName("text");if(l){const o=$R(i.getCellValue(t,e),i),h=KR(t,e,i),d=n.lineClamp,u=BA(RR("padding",n,t,e,i))??[0,0,0,0],g=c.text.textAlign;let p=0;p="center"===g?u[3]+(r-(u[1]+u[3]))/2:"right"===g?u[3]+r-(u[1]+u[3]):u[3];const f={text:1!==o.length||s?o:o[0],maxLineWidth:r-(u[1]+u[3]+h),textBaseline:"top",autoWrapText:s,lineClamp:d,wordBreak:"break-word",heightLimit:a-(u[0]+u[2]),pickable:!1,dx:"left"===g?h:0,x:p};if(l.setAttributes(c.text?Object.assign({},c.text,f):f),l.attribute.text){const t=c.text.textBaseline,e=a-(u[0]+u[2]);let i=0;i="middle"===t?u[0]+(e-l.AABBBounds.height())/2:"bottom"===t?u[0]+e-l.AABBBounds.height():u[0],l.setAttributes({y:i})}}return o}if(!r&&"empty"===o.role)return;const b=i.isHeader(t,e)?i._getHeaderLayoutMap(t,e).headerType:i.getBodyColumnType(t,e),y="body"!==a||(m?.dragOrder||!!m?.icon||!!m?.tree),C=c._vtable.padding,w=c.text.textAlign,v=c.text.textBaseline;let x,_,S;if(h?(_=i.getColsWidth(h.start.col,h.end.col),S=i.getRowsHeight(h.start.row,h.end.row)):(_=i.getColWidth(t),S=i.getRowHeight(e)),cw(g)?(o.removeAllChild(),tB(g,i,sB.bind(null,b,g,m,i,t,e,_,S,o,C,w,v,y,r,c,h,u))):x=sB(b,g,m,i,t,e,_,S,o,C,w,v,y,r,c,h,u),l){const{width:t}=x.attribute,{height:e}=x.attribute;x.contentWidth=t,x.contentHeight=e,aB(h,_,S,C,w,v,i)}return x}function sB(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p,f,m){if(cw(e)&&(e=r.getCellValue(o,n)),!g&&(l.row!==n||l.col!==o))return null;const b=oB(t,e,i,r,o,n,r.getColWidth(o),s,a,g?r.scenegraph.getColGroup(o):l.parent,g?0:r.scenegraph.getCellGroupY(n),h,c,d,u,p,f,m);return!g&&l.parent&&(l.parent.insertAfter(b,l),l.parent.removeChild(l),r.scenegraph?.proxy.cellCache.get(o)&&r.scenegraph?.proxy.cellCache.set(o,b)),b}function aB(t,e,i,r,o,n,s){for(let a=t.start.col;a<=t.end.col;a++)for(let l=t.start.row;l<=t.end.row;l++){const h=s.scenegraph.getCell(a,l,!0);"cell"===h.role&&t.start.row!==t.end.row&&h.contentWidth!==e&&ZR(h,i,0,s.isAutoRowHeight(l),r,0,n),"cell"===h.role&&t.start.col!==t.end.col&&h.contentHeight!==i&&qR(h,e,i,0,s.isAutoRowHeight(l),r,o,n,s.scenegraph),h.contentWidth=e,h.contentHeight=i;const c=s.getRowHeight(l);lB(h,s.getColWidth(a),c,t,s)}}function lB(t,e,i,r,o){const{col:n,row:s}=t,a=-o.getColsWidth(r.start.col,n-1),l=-o.getRowsHeight(r.start.row,s-1);t.forEachChildren((t=>{"number"==typeof t._dx?t.setAttributes({dx:(t._dx??0)+a}):(t._dx=t.attribute.dx??0,t.setAttributes({dx:(t.attribute.dx??0)+a})),"number"==typeof t._dy?t.setAttributes({dy:(t._dy??0)+l}):(t._dy=t.attribute.dy??0,t.setAttributes({dy:(t.attribute.dy??0)+l}))}));const h=t.attribute.strokeArrayWidth??t.attribute.lineWidth,c=et(h),d=[0,0,0,0];n===r.start.col&&(d[3]=c?h[3]:h),s===r.start.row&&(d[0]=c?h[0]:h),n===r.end.col&&(d[1]=c?h[1]:h),s===r.end.row&&(d[2]=c?h[2]:h);const u=e!==t.attribute.width,g=i!==t.attribute.height;return t.setAttributes({width:e,height:i,strokeArrayWidth:d}),t.mergeStartCol=r.start.col,t.mergeStartRow=r.start.row,t.mergeEndCol=r.end.col,t.mergeEndRow=r.end.row,{widthChange:u,heightChange:g}}function hB(t,e,i,r){if(r.internalProps.customMergeCell){const o=r.getCustomMerge(t,e);if(o){const{range:n,text:s,style:a,customLayout:l,customRender:h}=o;if(l||h){const o=fR(l,h,n.start.col,n.start.row,r.getColsWidth(n.start.col,n.end.col),r.getRowsHeight(n.start.row,n.end.row),!1,r.isAutoRowHeight(e),[0,0,0,0],r),s=o.elementsGroup;i.childrenCount>0&&s?i.insertBefore(s,i.firstChild):s&&i.appendChild(s);const a=r.getRowHeight(e),c=r.getColWidth(t),{width:d}=i.attribute,{height:u}=i.attribute;return i.contentWidth=d,i.contentHeight=u,lB(i,c,a,n,r),o}}}}function cB(t){return!!("cell"===t.role&&ot(t.mergeStartCol)&&ot(t.mergeStartRow)&&ot(t.mergeEndCol)&&ot(t.mergeEndRow))}const dB=5;function uB(t,e,i,r,o,n){if(i?.zero&&(t=Math.min(t,0),e=Math.max(e,0)),i?.expand){const r=t,o=e;Y(i.expand.min)&&(t=r-(o-r)*i.expand.min),Y(i.expand.max)&&(e=o+(o-r)*i.expand.max)}let s,a;if(ot(i?.min)&&(t=i.min),ot(i?.max)&&(e=i.max),"log"===i?.type?(s=new gS,s.base(i?.base??10)):"symlog"===i?.type?(s=new pS,s.constant(i?.constant??10)):s=new cS,s.domain([t,e],!!i?.nice),i?.nice){let t=i.tick?.forceTickCount??i.tick?.tickCount??10;$(t)&&(t=t({axisLength:o,labelStyle:i?.label?.style??{fontSize:y_.LABEL_FONT_SIZE}})),"accurateFirst"===i.niceType&&(t=Math.max(10,t)),X(i.min)&&X(i.max)?s.nice(t):Y(i.min)&&X(i.max)?s.niceMax(t):X(i.min)&&Y(i.max)&&s.niceMin(t)}return delete s._niceType,n||(a=s.ticks(ot(i?.tickCount)?i?.tickCount:dB,{noDecimals:i?.tick?.noDecimals})),{range:s.domain(),ticks:a}}function gB(t){return 2===t.length&&nt(t[0])&&nt(t[1])&&t[1]>=t[0]}function pB(t){const e=t[1]-t[0],i=t[1]*t[0]<0;let r=t[0]<=0?0-t[0]:0,o=t[1]>0?t[1]-0:0;return 0===e?t[0]<0?(r=1,o=0):t[0]>0&&(r=0,o=1):(r/=e,o/=e),{total:e,negative:r,positive:o,includeZero:i,domain:t,extendable_min:!0,extendable_max:!0}}function fB(t,e){const{positive:i,negative:r,extendable_min:o,extendable_max:n,domain:s}=t,{positive:a,negative:l,extendable_min:h,extendable_max:c,domain:d}=e;if(a>0){if(!h)return!1;let t=r/i;n&&(t=r/Math.max(i,a),s[1]=-s[0]/t),d[0]=-d[1]*t}else if(l>0){if(!c)return!1;let t=i/r;o&&(t=i/Math.max(r,r),s[0]=-s[1]/t),d[1]=-d[0]*t}return!0}function mB(t,e){const{extendable_min:i,extendable_max:r,domain:o}=t,{positive:n,negative:s,domain:a}=e;return(0!==n||0!==s)&&(!(n>0&&!r)&&(!(s>0&&!i)&&(o[0]=a[0],o[1]=a[1],!0)))}function bB(t,e){const{positive:i,negative:r,extendable_max:o,domain:n}=t,{positive:s,negative:a,extendable_min:l,domain:h}=e;if(o&&l){const t=Math.max(r,a)/Math.max(i,s);n[1]=-n[0]/t,h[0]=-h[1]*t}else if(l){const t=r/i;h[0]=-h[1]*t}else{if(!o)return!1;{const t=a/s;n[1]=-n[0]/t}}return!0}function yB(t,e){const{extendable_min:i,domain:r}=t,{extendable_max:o,domain:n}=e;return!(!i||!o)&&(r[0]=-r[1],n[1]=-n[0],!0)}function CB(t,e){const i=[t.min,t.max],r=[e.min,e.max];if(!gB(i)||!gB(r))return;const o=pB(i),n=pB(r),{positive:s,negative:a,extendable_min:l,extendable_max:h,includeZero:c}=o,{positive:d,negative:u,extendable_min:g,extendable_max:p,includeZero:f}=n;if(0===s&&0===a){if(!mB(o,n))return}else if(0===d&&0===u){if(!mB(n,o))return}else if(c||f)if(c&&!f){if(!fB(o,n))return}else if(f&&!c){if(!fB(n,o))return}else{if(a===u)return;if(a>u){if(!bB(o,n))return}else if(!bB(n,o))return}else{if(0===a&&0===d){if(!yB(o,n))return}else if(0===u&&0===s&&!yB(n,o))return;if(0===a&&0===u)if(0===i[0]&&r[0]>0){if(!g)return;r[0]=0}else{if(!(0===r[0]&&i[0]>0))return;if(!l)return;i[0]=0}if(0===s&&0===d)if(0===i[1]&&r[1]>0){if(!p)return;r[1]=0}else{if(!(0===r[1]&&i[1]>0))return;if(!h)return;i[1]=0}}return{range1:i,range2:r}}function wB(t,e,i){if(i._table.isPivotChart())if(i.indicatorsAsCol){if(i.hasTwoIndicatorAxes&&e===i.columnHeaderLevelCount-1&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount){const r=SB("top",t,e+1,t,i.columnHeaderLevelCount-1,t,e,1,i);if(!r)return;const{range:o,ticks:n,axisOption:s,isZeroAlign:a,theme:l}=r;if(a){const r=SB("bottom",t,e+1,t,i.columnHeaderLevelCount-1,t,e,0,i);if(r){const{range:t}=r,e=CB(o,t);e&&(o.min=e.range1[0],o.max=e.range1[1])}}return ot(s?.min)&&(o.min=s.min,o.min>0&&(s.zero=!1)),ot(s?.max)&&(o.max=s.max,o.max<0&&(s.zero=!1)),wt({range:o},s,{orient:"top",type:s?.type||"linear",label:{flush:!0},__ticksForVTable:n,__vtableChartTheme:l})}if(e===i.rowCount-i.bottomFrozenRowCount&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount){const r=i.getIndicatorKeyInChartSpec(t,e);let o=null;r?.forEach((t=>{const e=i.getIndicatorInfo(t);e&&(o=e)}));const n=SB("bottom",t,e-1,t,e,t,e,0,i);if(!n)return;const{range:s,ticks:a,axisOption:l,isZeroAlign:h,theme:c}=n;if(h){const r=SB("top",t,e-1,t,e,t,e,1,i);if(r){const{range:t}=r,e=CB(s,t);e&&(s.min=e.range1[0],s.max=e.range1[1])}}return ot(l?.min)&&(s.min=l.min,s.min>0&&(l.zero=!1)),ot(l?.max)&&(s.max=l.max,s.max<0&&(l.zero=!1)),wt({title:{visible:!0,text:o?.title},range:s},l,{orient:"bottom",type:l?.type||"linear",label:{flush:!0},__ticksForVTable:a,__vtableChartTheme:c})}if(t===i.rowHeaderLevelCount-1&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount){let r=i.getDimensionKeyInChartSpec(i.rowHeaderLevelCount,e);et(r)&&(r=r[0]);const o=(i.dataset.collectedValues[r]??[])[i.getRowKeysPath(t,e)??""]??[],{axisOption:n,theme:s,chartType:a}=vB(t+1,e,"left",i);if(!1===n?.visible)return;return wt({domain:"common"===a?Array.from(o):Array.from(o).reverse(),title:{autoRotate:!0}},n,{orient:"left",type:"band",__vtableChartTheme:s})}}else{if(t===i.rowHeaderLevelCount-1&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount){const r=i.getIndicatorKeyInChartSpec(t,e);let o=null;r?.forEach((t=>{const e=i.getIndicatorInfo(t);e&&(o=e)}));const n=SB("left",t+1,e,t,e,t,e,0,i);if(!n)return;const{range:s,ticks:a,axisOption:l,isZeroAlign:h,theme:c}=n;if(h){const r=SB("right",t+1,e,t,e,t,e,1,i);if(r){const{range:t}=r,e=CB(s,t);e&&(s.min=e.range1[0],s.max=e.range1[1])}}return ot(l?.min)&&(s.min=l.min,s.min>0&&(l.zero=!1)),ot(l?.max)&&(s.max=l.max,s.max<0&&(l.zero=!1)),wt({title:{visible:!0,text:o?.title,autoRotate:!0},range:s},l,{orient:"left",type:l?.type||"linear",label:{flush:!0},__ticksForVTable:a,__vtableChartTheme:c})}if(t===i.colCount-i.rightFrozenColCount&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount){const r=SB("right",t-1,e,i.rowHeaderLevelCount-1,e,t,e,1,i);if(!r)return;const{range:o,ticks:n,axisOption:s,isZeroAlign:a,theme:l}=r;if(a){const r=SB("left",t-1,e,i.rowHeaderLevelCount-1,e,t,e,0,i);if(r){const{range:t}=r,e=CB(o,t);e&&(o.min=e.range1[0],o.max=e.range1[1])}}return ot(s?.min)&&(o.min=s.min,o.min>0&&(s.zero=!1)),ot(s?.max)&&(o.max=s.max,o.max<0&&(s.zero=!1)),wt({range:o,title:{autoRotate:!0}},s,{orient:"right",type:s?.type||"linear",label:{flush:!0},__ticksForVTable:n,__vtableChartTheme:l})}if(e===i.rowCount-i.bottomFrozenRowCount&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount){let r=i.getDimensionKeyInChartSpec(t,i.columnHeaderLevelCount);et(r)&&(r=r[0]);const o=i.dataset.collectedValues[r]??[],n=i.getColKeysPath(t,e),s=o?.[n??""]??[],{axisOption:a,isPercent:l,theme:h}=vB(t,e-1,"bottom",i);if(!1===a?.visible)return;return wt({domain:Array.from(s)},a,{orient:"bottom",type:"band",__vtableChartTheme:h})}}}function vB(t,e,i,r){const o=r.getRawChartSpec(t,e);if(o&&et(o.axes)){const t=o.axes.find((t=>t.orient===i));if(t){const{seriesIndex:e,seriesId:n}=t;let s;return Y(n)&&et(o.series)?s=(et(n)?n:[n]).map((t=>o.series.findIndex((e=>e.id===t)))):Y(e)&&et(o.series)&&(s=e),{axisOption:t,isPercent:o.percent,isZeroAlign:xB(o,i,r),seriesIndice:s,theme:o.theme,chartType:o.type}}}return{axisOption:r._table.pivotChartAxes.find((t=>t.orient===i)),isPercent:!1,isZeroAlign:xB(o,i,r),theme:o.theme,chartType:o.type}}function xB(t,e,i){const r=[];let o;if("left"===e||"right"===e?r.push("left","right"):"top"!==e&&"bottom"!==e||r.push("top","bottom"),o=t&&et(t.axes)?t.axes:i._table.pivotChartAxes,et(o)){const t=[];o.forEach((e=>{r.includes(e.orient)&&t.push(e)}));for(let e=0;e<t.length;e++){const i=t[e];if(i.sync&&i.sync.zeroAlign&&i.sync.axisId&&t.find((t=>t.id===i.sync.axisId)))return!0}}return!1}function _B(t,e,i,r,o){if(et(o)){const n={min:1/0,max:-1/0};for(let s=0;s<o.length;s++){const a=_B(t,e,i,r,o[s]);a&&(n.min=Math.min(n.min,a.min),n.max=Math.max(n.max,a.max))}return isFinite(n.min)&&isFinite(n.max)?n:null}let n=e?.[o];if(et(n)&&(n=n[0]),!n)return null;const s=t[n],a=wt({},s?.[r??""]??{min:0,max:1});return a.positiveMax&&a.positiveMax>a.max&&(a.max=a.positiveMax),a.negativeMin&&a.negativeMin<a.min&&(a.min=a.negativeMin),a.min===a.max&&(a.min>0?a.min=0:a.max=0),a}function SB(t,e,i,r,o,n,s,a,l){const{axisOption:h,isPercent:c,isZeroAlign:d,seriesIndice:u,theme:g,chartType:p}=vB(e,i,t,l);if(!1===h?.visible)return;const f=l.getIndicatorKeyInChartSpec(r,o);let m;m="top"===t||"bottom"===t?l.getColKeysPath(n,s):l.getRowKeysPath(n,s);const b=_B(l.dataset.collectedValues,f,d,m,u??a);if(!b)return;c&&(b.min=b.min<0?-1:0,b.max=b.max>0?1:0);const{range:y,ticks:C}=uB(b.min,b.max,h,0,l._table.getColWidth(n));return b.min=isNaN(y[0])?0:y[0],b.max=isNaN(y[1])?1:y[1],ot(h?.min)&&(b.min=h.min,b.min>0&&(h.zero=!1)),ot(h?.max)&&(b.max=h.max,b.max<0&&(h.zero=!1)),{axisOption:h,isZeroAlign:d,range:b,ticks:C,theme:g,chartType:p}}function AB(t,e){const i=wt({},C_,t);let r=0;!1!==i.tick.visible&&(r=i.tick.width??4);let o=0;if(i.label.visible){if("band"===i.type){i.domain.forEach((t=>{i.label.formatMethod&&(t=i.label.formatMethod(t));const{width:r,height:n}=e.measureText(t,{fontSize:i.label?.style?.fontSize??b_,fontWeight:i.label?.style?.fontWeight??"normal",fontFamily:i.label?.style?.fontFamily??m_}),s=i.label?.style?.maxLineWidth||1/0,a=(i.label?.style?.angle??0)+("vertical"===i.label?.style?.direction?90:0);o=Math.max(o,MB(Math.min(r,s),n,a).width)}))}else{let r;if(et(t.__ticksForVTable))r=t.__ticksForVTable;else{const t=i.range,e=Math.abs(t.min)>1?Math.round(t.min):t.min,o=Math.abs(t.max)>1?Math.round(t.max):t.max;r=[BB(e),BB(o)]}r.forEach((t=>{i.label.formatMethod&&(t=i.label.formatMethod(t));const{width:r,height:n}=e.measureText(t,{fontSize:i.label?.style?.fontSize??b_,fontWeight:i.label?.style?.fontWeight??"normal",fontFamily:i.label?.style?.fontFamily??m_}),s=i.label?.style?.maxLineWidth||1/0,a=(i.label?.style?.angle??0)+("vertical"===i.label?.style?.direction?90:0);o=Math.max(o,MB(Math.min(r,s),n,a).width)}))}o+=i.label.space??4}let n=0;if(i.title.visible&&i.title.text){const{width:r,height:o}=e.measureText(i.title.text,{fontSize:i.title?.style?.fontSize??b_,fontWeight:i.title?.style?.fontWeight??"normal",fontFamily:i.title?.style?.fontFamily??m_}),s=i.label?.style?.maxLineWidth||1/0,a=MB(Math.min(r,s),o,i.title?.style?.angle);n="left"!==t.orient&&"right"!==t.orient||!i.title.autoRotate?a.width:a.height,n+=i.title.space??4}return r+o+n+1}function RB(t,e){const i=wt({},C_,t);let r=0;!1!==i.tick.visible&&(r=i.tick.width??4);let o=0;if(i.label.visible){if("band"===i.type){i.domain.forEach((t=>{i.label.formatMethod&&(t=i.label.formatMethod(t));const{width:r,height:n}=e.measureText(t,{fontSize:i.label?.style?.fontSize??b_,fontWeight:i.label?.style?.fontWeight??"normal",fontFamily:i.label?.style?.fontFamily??m_}),s=i.label?.style?.maxLineWidth||1/0,a=(i.label?.style?.angle??0)+("vertical"===i.label?.style?.direction?90:0);o=Math.max(o,MB(Math.min(r,s),n,a).height)}))}else{let r;if(et(t.__ticksForVTable))r=t.__ticksForVTable;else{const t=i.range,e=Math.abs(t.min)>1?Math.round(t.min):t.min,o=Math.abs(t.max)>1?Math.round(t.max):t.max;r=[BB(e),BB(o)]}r.forEach((t=>{i.label.formatMethod&&(t=i.label.formatMethod(t));const{width:r,height:n}=e.measureText(t,{fontSize:i.label?.style?.fontSize??b_,fontWeight:i.label?.style?.fontWeight??"normal",fontFamily:i.label?.style?.fontFamily??m_}),s=i.label?.style?.maxLineWidth||1/0,a=(i.label?.style?.angle??0)+("vertical"===i.label?.style?.direction?90:0);o=Math.max(o,MB(Math.min(r,s),n,a).height)}))}o+=i.label.space??4}let n=0;if(i.title.visible&&i.title.text){const{width:r,height:o}=e.measureText(i.title.text,{fontSize:i.title?.style?.fontSize??b_,fontWeight:i.title?.style?.fontWeight??"normal",fontFamily:i.title?.style?.fontFamily??m_}),s=i.label?.style?.maxLineWidth||1/0,a=MB(Math.min(r,s),o,i.title?.style?.angle);n="bottom"!==t.orient&&"top"!==t.orient||!i.title.autoRotate?a.height:a.width,n+=i.title.space??4}return r+o+n+1}function BB(t){return"number"!=typeof t&&(t=Number(t)),Number(t.toPrecision(1)).toString()}function MB(t,e,i=0){const r=i*Math.PI/180,o=-t/2,n=-e/2,s=t/2,a=-e/2,l=t/2,h=e/2,c=-t/2,d=e/2,u={x:o*Math.cos(r)-n*Math.sin(r),y:o*Math.sin(r)+n*Math.cos(r)},g={x:s*Math.cos(r)-a*Math.sin(r),y:s*Math.sin(r)+a*Math.cos(r)},p={x:l*Math.cos(r)-h*Math.sin(r),y:l*Math.sin(r)+h*Math.cos(r)},f={x:c*Math.cos(r)-d*Math.sin(r),y:c*Math.sin(r)+d*Math.cos(r)},m=Math.min(u.x,g.x,p.x,f.x),b=Math.max(u.x,g.x,p.x,f.x),y=Math.min(u.y,g.y,p.y,f.y);return{width:b-m,height:Math.max(u.y,g.y,p.y,f.y)-y}}const TB=new h_({}),PB=new c_({});function HB(t,e,i,r,o,n,s,a,l,h,c,d,u,g){const p=KC(q(t)?t.text:t).split("\n")||[],f=g.getColsWidth(e,r),m=RR("size",o,e,i,g);let b=RR("outerRadius",o,e,i,g);const y=ot(b)?2*b:m;let C=0;if(n){const t=RR("spaceBetweenTextAndIcon",o,e,i,g),r=f-(u[1]+u[3])-s-y-t;ot(b)||(b=Math.round(m/2)),PB.setAttributes({text:{maxLineWidth:r,text:p,fontSize:a,fontStyle:l,fontWeight:h,fontFamily:c,lineHeight:d,wordBreak:"break-word"},circle:{outerRadius:b},spaceBetweenTextAndIcon:t}),PB.render(),C=PB.AABBBounds.height()}else C=Math.max(m,p.length*d);return C}let EB="",kB="quick";const LB=new i(((t,e,i,r)=>{i(Kr)?r(Kr).to(OB).inSingletonScope():t(Kr).to(OB).inSingletonScope()})),FB=new i(((t,e,i,r)=>{i(Kr)?r(Kr).to($r).inSingletonScope():t(Kr).to($r).inSingletonScope()})),IB=new Map;function zB(t,e,i,r="normal"){const o=`${t}-${e}-${i}-${r}`,n=IB.get(o);if(n)return n;const s=(a={fontSize:t,fontFamily:i,fontWeight:e,fontStyle:r},new Ke({defaultFontParams:{fontFamily:pr.fontFamily,fontSize:pr.fontSize},getTextBounds:h?void 0:dh,specialCharSet:`{}()//&-/: .,@%'"~…=${Ke.ALPHABET_CHAR_SET}${Ke.ALPHABET_CHAR_SET.toUpperCase()}0123456789${EB}`,...l??{}},a));var a,l,h;return IB.set(o,s),s}class OB extends $r{measureTextWidth(t,e){const{fontSize:i,fontFamily:r="Arial,sans-serif",fontWeight:o="normal",fontStyle:n="normal"}=e;return zB(i,o,r,n).measure(t,kB).width}measureText(t,e){const{fontSize:i,fontFamily:r="Arial,sans-serif",fontWeight:o="normal",fontStyle:n="normal"}=e;return zB(i,o,r,n).measure(t,kB)}}const DB=new class{measureText(t,e){const{fontSize:i,fontFamily:r="Arial,sans-serif",fontWeight:o="normal",fontStyle:n="normal"}=e;return zB(i,o,r,n).measure(t,kB)}measureTextWidth(t,e){const{fontSize:i,fontFamily:r="Arial,sans-serif",fontWeight:o="normal",fontStyle:n="normal"}=e;return zB(i,o,r,n).measure(t,kB).width}clipText(t,e,i){if(0===t.length)return{str:"",width:0};let r=this.measureTextWidth(t,e);return r<=i?{str:t,width:r}:(r=this.measureTextWidth(t[0],e),r>i?{str:"",width:0}:this._clipText(t,e,i,0,t.length-1))}_clipText(t,e,i,r,o){const n=Math.floor((r+o)/2),s=t.substring(0,n+1),a=this.measureTextWidth(s,e);let l;if(a>i){if(s.length<=1)return{str:"",width:0};const o=t.substring(0,n);return l=this.measureTextWidth(o,e),l<=i?{str:o,width:l}:this._clipText(t,e,i,r,n)}if(a<i){if(n>=t.length-1)return{str:t,width:this.measureTextWidth(t,e)};const r=t.substring(0,n+2);return l=this.measureTextWidth(r,e),l>=i?{str:s,width:a}:this._clipText(t,e,i,n,o)}return{str:s,width:a}}clipTextWithSuffix(t,e,i,r){if(""===r)return this.clipText(t,e,i);if(0===t.length)return{str:"",width:0};const o=this.measureTextWidth(t,e);if(o<=i)return{str:t,width:o};const n=this.measureTextWidth(r,e);if(n>i)return{str:"",width:0};i-=n;const s=this._clipText(t,e,i,0,t.length-1);return s.str+=r,s.width+=n,s}};const WB=new ta({ignoreBuf:!0});function NB(t){return WB.setAttributes(t),WB.AABBBounds}const GB=new Pl({width:0,height:0,textConfig:[]});function jB(t,e,i,r=!0,o){"undefined"!=typeof window&&window.performance.now();const n=[],s=[];if(o)for(let r=e;r<=i;r++)n[r]=t.getRowHeight(r);t.defaultHeaderRowHeight,t.defaultHeaderColWidth;const a="auto"===t.defaultHeaderRowHeight||et(t.defaultHeaderRowHeight)&&t.defaultHeaderRowHeight.some((t=>"auto"===t)),l="autoHeight"===t.heightMode||"adaptive"===t.heightMode;if(l||a){e=e??0,i=i??t.rowCount-1,(0===e&&i===t.rowCount-1||r)&&t._clearRowRangeHeightsMap();for(let i=e;i<t.columnHeaderLevelCount;i++){let e=0,r=t.colCount-1;if((t.isPivotTable()&&!t.isPivotChart()||t.isPivotChart()&&!t.internalProps.layoutMap.indicatorsAsCol)&&KB(t,i)&&!iv(t,t.rowHeaderLevelCount,i)&&(e=0,r=t.rowHeaderLevelCount),l||"auto"===t.getDefaultRowHeight(i)){const o=VB(i,e,r,t);s[i]=Math.round(o),t._setRowHeight(i,o)}}for(let e=t.rowCount-t.bottomFrozenRowCount;e<=i;e++)if(l||"auto"===t.getDefaultRowHeight(e)){const i=VB(e,0,t.colCount-1,t);o?s[e]=Math.round(i):t._setRowHeight(e,i)}if(i<t.columnHeaderLevelCount||!l);else if(t.internalProps.transpose||t.isPivotTable()&&!t.internalProps.layoutMap.indicatorsAsCol||!function(t){const{layoutMap:e}=t.internalProps,i=t.columnHeaderLevelCount;if((t.internalProps.autoWrapText||t.internalProps.enableLineBreak||t.isPivotChart())&&("autoHeight"===t.options.heightMode||"adaptive"===t.options.heightMode))return!1;for(let r=0;r<t.colCount;r++){const o=e.getBody(r,i);if("radio"===o.cellType)return!1;if("function"==typeof o.style||"function"==typeof o.icon||o.define?.customRender||o.define?.customLayout||"function"==typeof o.define?.icon)return!1;const n=t._getCellStyle(r,i);if("function"==typeof n.padding||"function"==typeof n.fontSize||"function"==typeof n.lineHeight||!0===n.autoWrapText)return!1}return!0}(t))if(t.internalProps.transpose||t.isPivotTable()&&!t.internalProps.layoutMap.indicatorsAsCol)for(let r=Math.max(e,t.columnHeaderLevelCount);r<=i;r++){let e;e=UB(t,r)?VB(r,0,t.rowHeaderLevelCount,t):VB(r,0,t.colCount-1,t),o?s[r]=Math.round(e):t._setRowHeight(r,e)}else for(let r=Math.max(e,t.columnHeaderLevelCount);r<=i;r++){const e=VB(r,0,t.colCount-1,t);o?s[r]=Math.round(e):t._setRowHeight(r,e)}else{!function(t,e,i,r,o){for(let n=e;n<=i;n++)o?o[n]=t:r._setRowHeight(n,t)}(VB(t.columnHeaderLevelCount,0,t.colCount-1,t),t.columnHeaderLevelCount,t.rowCount-1-t.bottomFrozenRowCount,t,o?s:void 0);for(let e=t.rowCount-t.bottomFrozenRowCount;e<=i;e++){const i=VB(e,0,t.colCount-1,t);o?s[e]=Math.round(i):t._setRowHeight(e,i)}}}else if(("adaptive"===t.heightMode||t.autoFillHeight)&&t.clearRowHeightCache(),o)for(let r=e;r<=i;r++)s[r]=t.getRowHeight(r);if((0===e&&i===t.rowCount-1||r)&&t._clearRowRangeHeightsMap(),"adaptive"===t.heightMode){t._clearRowRangeHeightsMap();let e=t.tableNoFrameHeight,i=0,r=t.rowCount;if("only-body"===t.heightAdaptiveMode){const o=t.getRowsHeight(0,t.columnHeaderLevelCount-1),n=t.isPivotChart()?t.getBottomFrozenRowsHeight():0;e=t.tableNoFrameHeight-o-n,i=t.columnHeaderLevelCount,r=t.isPivotChart()?t.rowCount-t.bottomFrozenRowCount:t.rowCount}let n=0;for(let e=i;e<r;e++)n+=o?s[e]:t.getRowHeight(e);const a=e/n;for(let n=i;n<r;n++){let l;l=n===r-1?e-(o?s.reduce(((t,e,o)=>o>=i&&o<=r-2?t+e:t),0):t.getRowsHeight(i,r-2)):Math.round((o?s[n]:t.getRowHeight(n))*a),o?s[n]=l:t._setRowHeight(n,l,!1)}}else if(t.autoFillHeight){t._clearRowRangeHeightsMap();const e=t.tableNoFrameHeight;let i=0,r=0;for(let e=0;e<t.rowCount;e++){const n=o?s[e]??t.getRowHeight(e):t.getRowHeight(e);(e<t.columnHeaderLevelCount||t.isPivotChart()&&e>=t.rowCount-t.bottomFrozenRowCount)&&(r+=n),i+=n}if(t.scenegraph._dealAutoFillHeightOriginRowsHeight=i,i<e&&i-r>0){const n=t.columnHeaderLevelCount,a=t.isPivotChart()?t.rowCount-t.bottomFrozenRowCount:t.rowCount,l=(e-r)/(i-r);for(let i=n;i<a;i++){let h;h=i===a-1?e-r-(o?s.reduce(((t,e,i)=>i>=n&&i<=a-2?t+e:t),0):t.getRowsHeight(n,a-2)):Math.round((o?s[i]:t.getRowHeight(i))*l),o?s[i]=h:t._setRowHeight(i,h,!1)}}}if(o){for(let r=e;r<=i;r++){const e=s[r]??t.getRowHeight(r);e!==n[r]&&t._setRowHeight(r,e)}if("adaptive"===t.heightMode||t.autoFillHeight&&t.getAllRowsHeight()<=t.tableNoFrameHeight){for(let e=0;e<=t.columnHeaderLevelCount-1;e++){const i=t.getRowHeight(e);i!==n[e]&&t.scenegraph.updateRowHeight(e,i-n[e],!0)}for(let e=t.rowCount-t.bottomFrozenRowCount;e<=t.rowCount-1;e++){const i=t.getRowHeight(e);i!==n[e]&&t.scenegraph.updateRowHeight(e,i-n[e],!0)}}for(let e=t.scenegraph.proxy.rowStart;e<=t.scenegraph.proxy.rowEnd;e++){const i=t.getRowHeight(e);i!==n[e]&&t.scenegraph.updateRowHeight(e,i-n[e],!0)}}}function VB(t,e,i,r){let o;if(r.isPivotChart()&&t>=r.columnHeaderLevelCount&&t<r.rowCount-r.bottomFrozenRowCount)if(r.internalProps.layoutMap.indicatorsAsCol){const e=r.internalProps.layoutMap.getOptimunHeightForChart(t);if(e>0)return e}else{const e=r.getDefaultRowHeight(t);if(ot(e))return e}for(let n=e;n<=i;n++){const e=$B(n,t,r);if(e&&(o=Y(o)?Math.max(e.height,o):e.height,!e.renderDefault))continue;if(r.isPivotChart()){const e=wB(n,t,r.internalProps.layoutMap);if(e){const t=RB(e,r);if("number"==typeof t){o=Y(o)?Math.max(t,o):t;continue}}}if(r.isPivotChart()&&(r.isLeftFrozenColumn(n)&&r.isBottomFrozenRow(t)||r.isRightFrozenColumn(n)&&r.isBottomFrozenRow(t)))continue;const i=XB(n,t,r.isHeader(n,t)?r._getHeaderLayoutMap(n,t)?.headerType:r.getBodyColumnType(n,t),r);o=Y(o)?Math.max(i,o):i}if(Y(o))return o;const n=r.getDefaultRowHeight(t);return ot(n)?n:r.defaultRowHeight}function UB(t,e){const{layoutMap:i}=t.internalProps;if((t.internalProps.autoWrapText||t.internalProps.enableLineBreak)&&("autoHeight"===t.options.heightMode||"adaptive"===t.options.heightMode))return!1;const r=i.getBody(t.rowHeaderLevelCount,e);if("function"==typeof r.style||"function"==typeof r.icon||r.define?.customRender||r.define?.customLayout||"function"==typeof r.define?.icon)return!1;const o=t._getCellStyle(t.rowHeaderLevelCount,e);return"function"!=typeof o.padding&&"function"!=typeof o.fontSize&&"function"!=typeof o.lineHeight&&!0!==o.autoWrapText}function KB(t,e){const{layoutMap:i}=t.internalProps;if(t.internalProps.autoWrapText&&("autoHeight"===t.options.heightMode||"adaptive"===t.options.heightMode))return!1;const r=i.getHeader(t.rowHeaderLevelCount,e);if("function"==typeof r.style||"function"==typeof r.icons||r.define?.headerCustomRender||r.define?.headerCustomLayout||"function"==typeof r.define?.icon)return!1;const o=t._getCellStyle(t.rowHeaderLevelCount,e);return"function"!=typeof o.padding&&"function"!=typeof o.fontSize&&"function"!=typeof o.lineHeight&&!0!==o.autoWrapText}function $B(t,e,i){const r=i.getCustomRender(t,e),o=i.getCustomLayout(t,e);if(r||o){let n=1,s=0,a=!1,l=!1;if(i.isHeader(t,e)||i.getBodyColumnDefine(t,e)?.mergeCell||i.hasCustomMerge()){const r=i.getCellRange(t,e);n=r.end.row-r.start.row+1}const h={col:t,row:e,dataValue:i.getCellOriginValue(t,e),value:i.getCellValue(t,e)||"",rect:YB(t,e,i),table:i};if(o){const e=o(h);e.rootContainer instanceof hs?(e.rootContainer=yR(e.rootContainer),bR(e.rootContainer,i.getColWidth(t),0),e.rootContainer.setStage(i.scenegraph.stage),s=e.rootContainer.AABBBounds.height()??0,a=e.renderDefault,l=e.enableCellPadding):s=0}else if("function"==typeof r){const t=r(h);s=t?.expectedHeight??0,a=t?.renderDefault}else s=r?.expectedHeight??0,a=r?.renderDefault;if(l){const r=BA(RR("padding",i._getCellStyle(t,e),t,e,i));s+=r[0]+r[2]}return{height:s/n,renderDefault:a}}}function XB(t,e,i,r){let o=0;const n=r.getCellValue(t,e),s=r._getCellStyle(t,e);let a=0,l=0;const h=[];let c=0;const d=[];let u=0,g=!1;if("body"!==r.getCellLocation(t,e))g=!0;else{const i=r.getBodyColumnDefine(t,e);g=!!i?.icon||!!i?.tree||i?.dragOrder}if(g){const i=r.getCellIcons(t,e);i?.forEach((t=>{t.positionType!==aC.absoluteRight&&t.positionType!==aC.inlineFront&&t.positionType!==aC.inlineEnd?(l+=(t.width??0)+(t.marginLeft??0)+(t.marginRight??0),a=Math.max(a,t.height??0)):t.positionType===aC.inlineFront?(h.push(t),c=Math.max(c,(t.height??0)+(t.marginLeft??0)+(t.marginRight??0))):t.positionType===aC.inlineEnd&&(d.push(t),u=Math.max(u,(t.height??0)+(t.marginLeft??0)+(t.marginRight??0)))}))}let p=1,f=t;if(r.isHeader(t,e)||r.getBodyColumnDefine(t,e)?.mergeCell||r.hasCustomMerge()){const i=r.getCellRange(t,e);p=i.end.row-i.start.row+1,t=i.start.col,f=i.end.col}const m=BA(RR("padding",s,t,e,r)),b=RR("fontSize",s,t,e,r),y=RR("fontStyle",s,t,e,r),C=RR("fontWeight",s,t,e,r),w=RR("lineHeight",s,t,e,r)??b,v=RR("fontFamily",s,t,e,r),x=RR("autoWrapText",s,t,e,r);let _;if("text"!==i&&"link"!==i&&"progressbar"!==i&&"checkbox"!==i&&"radio"!==i)o=w;else if("checkbox"===i)o=function(t,e,i,r,o,n,s,a,l,h,c,d,u,g){const p=KC(q(t)?t.text:t).split("\n")||[],f=g.getColsWidth(e,r),m=RR("size",o,e,i,g);let b=0;if(n){const t=RR("spaceBetweenTextAndIcon",o,e,i,g),r=f-(u[1]+u[3])-s-m-t;TB.setAttributes({text:{maxLineWidth:r,text:p,fontSize:a,fontStyle:l,fontWeight:h,fontFamily:c,lineHeight:d,wordBreak:"break-word"},icon:{width:Math.floor(m/1.4),height:Math.floor(m/1.4)},box:{width:m,height:m},spaceBetweenTextAndIcon:t}),TB.render(),b=TB.AABBBounds.height()}else b=Math.max(m,p.length*d);return b}(n,t,e,f,s,x,l,b,y,C,v,w,m,r);else if("radio"===i)o=function(t,e,i,r,o,n,s,a,l,h,c,d,u,g){if(et(t)){let p=0;const f=g.getBodyColumnDefine(e,i),m=RR("spaceBetweenRadio",o,e,i,g),b=f?.radioDirectionInCell??"vertical";return"vertical"===b?t.forEach(((f,b)=>{const y=HB(f,e,i,r,o,n,s,a,l,h,c,d,u,g);p+=y,b!==t.length-1&&(p+=m)})):"horizontal"===b&&t.forEach((t=>{const f=HB(t,e,i,r,o,n,s,a,l,h,c,d,u,g);p=Math.max(f,p)})),p}return HB(t,e,i,r,o,n,s,a,l,h,c,d,u,g)}(n,t,e,f,s,x,l,b,y,C,v,w,m,r);else{_=n;const i=KC(_).split("\n")||[],s=r.getColsWidth(t,f);if(h.length||d.length)if(x){const t=Object.assign({text:n?.toString(),fontFamily:v,fontSize:b,fontStyle:y,fontWeight:C,lineHeight:w});t.textBaseline="middle";const e=[...h.map((t=>YR(t))),t,...d.map((t=>YR(t)))];GB.setAttributes({width:s-(m[1]+m[3])-l,height:0,textConfig:e}),o=GB.AABBBounds.height()}else o=0,i.forEach(((t,e)=>{r.options.customConfig?.multilinesForXTable&&0!==e||(0===e&&h.length?o+=Math.max(w,c):e===i.length-1&&d.length?o+=Math.max(w,u):o+=w)}));else if(x){const n=KR(t,e,r),a=NB({maxLineWidth:s-(m[1]+m[3])-l-n,text:i,fontSize:b,fontStyle:y,fontWeight:C,fontFamily:v,lineHeight:w,wordBreak:"break-word",whiteSpace:1!==i.length||x?"normal":"no-wrap"});o=a.height()||("number"==typeof w?w:b)}else o=i.length*w}return(Math.max(o,a)+m[0]+m[2])/p}function YB(t,e,i){return{left:0,top:0,right:i.getColWidth(t),bottom:i.getRowHeight(e),width:i.getColWidth(t),height:0}}function qB(t,e){if(!e||!e.proxy)return{colStart:0,colEnd:0,rowStart:0,rowEnd:0};const{mergeStartCol:i,mergeEndCol:r,mergeStartRow:o,mergeEndRow:n,col:s,row:a}=t,{colStart:l,colEnd:h,rowStart:c,rowEnd:d,bodyLeftCol:u,bodyRightCol:g,bodyTopRow:p,bodyBottomRow:f}=e.proxy;let m=i,b=r,y=o,C=n;return s>=u&&s<=g&&(m=Math.max(t.mergeStartCol,l),b=Math.min(t.mergeEndCol,h)),a>=p&&a<=f&&(y=Math.max(t.mergeStartRow,c),C=Math.min(t.mergeEndRow,d)),{colStart:m,colEnd:b,rowStart:y,rowEnd:C}}function ZB(t,e,i,r){r||t.table._setRowHeight(e,t.table.getRowHeight(e)+i,!0);for(let r=0;r<t.table.colCount;r++){const o=t.getCell(r,e);if("empty"===o.role)continue;const n=iv(t.table,r,e);if(n&&n.start.col!==r)continue;JB(t,o,r,e,o.attribute.height+i,i,t.table.isHeader(r,e)),t.updateCellContentWhileResize(r,e)}let o=0,n=0;e<t.table.columnHeaderLevelCount?(o=e+1,n=t.table.columnHeaderLevelCount-1):e>=t.table.rowCount-t.table.bottomFrozenRowCount?(o=e+1,n=t.table.rowCount-1):(o=e+1,n=Math.min(t.proxy.rowEnd,t.table.rowCount-t.table.bottomFrozenRowCount-1));for(let e=o;e<=n;e++)for(let r=0;r<t.table.colCount;r++){const o=t.getCell(r,e);"cell"===o.role&&o.setAttribute("y",o.attribute.y+i)}}function JB(t,e,i,r,o,n,s){e&&function(t,e,i,r,o,n,s){if(e.attribute.height===o&&!e.needUpdateHeight)return;e.needUpdateHeight=!1,e.setAttribute("height",o);const a=t.table.isHeader(i,r)?t.table._getHeaderLayoutMap(i,r).headerType:t.table.getBodyColumnType(i,r);if("progressbar"===a){const o=t.table.getBodyColumnDefine(i,r),n=t.table._getCellStyle(i,r),s=t.table.getCellValue(i,r),a=t.table.getCellOriginValue(i,r),l=(BA(RR("padding",n,i,r,t.table)),FR(o,n,e.attribute.width,s,a,i,r,0,t.table)),h=e.getChildByName("progress-bar");e.insertBefore(l,h),e.removeChild(h),h.removeAllChild(),h.release()}else if("sparkline"===a){e.removeAllChild();const o=t.table._getCellStyle(i,r),n=BA(RR("padding",o,i,r,t.table));OR(e,e.parent,e.attribute.x,e.attribute.y,i,r,e.attribute.width,e.attribute.height,n,t.table,cR(o,t.table,i,r,RR).theme,!1)}else if("image"===a||"video"===a)PR(e,i,r,t.table);else if("axis"===e.firstChild?.name)e.firstChild?.originAxis.resize(e.attribute.width,e.attribute.height);else{let n=!0;const s=e.getChildByName("custom-container");if(s){let o;if(s.removeAllChild(),e.removeChild(s),!hB(i,r,e,t.table)){let s,a;if("body"!==t.table.getCellLocation(i,r)){const e=t.table.getHeaderDefine(i,r);s=e?.headerCustomRender,a=e?.headerCustomLayout}else{const e=t.table.getBodyColumnDefine(i,r);s=e?.customRender||t.table.customRender,a=e?.customLayout}if(a||s){const l=BA(RR("padding",t.table._getCellStyle(i,r),i,r,t.table));let h=e.attribute.width,c=e.attribute.height;cB(e)&&(h=t.table.getColsWidth(e.mergeStartCol,e.mergeEndCol),c=t.table.getRowsHeight(e.mergeStartRow,e.mergeEndRow));const d=fR(a,s,i,r,h,c,!1,t.table.isAutoRowHeight(r),l,t.table);o=d.elementsGroup,n=d.renderDefault}e.childrenCount>0&&o?e.insertBefore(o,e.firstChild):o&&e.appendChild(o)}}!function(t,e,i,r,o,n){if(cB(t)){e=0;for(let i=t.mergeStartRow;i<=t.mergeEndRow;i++)e+=n.getRowHeight(i);const{colStart:i,colEnd:s,rowStart:a,rowEnd:l}=qB(t,n.scenegraph);for(let h=i;h<=s;h++)for(let i=a;i<=l;i++){const s=n.scenegraph.getCell(h,i);if(s.forEachChildren((t=>{t.setAttributes({dx:0,dy:0})})),o){const t=n._getCellStyle(h,i);ZR(s,e,0,r,BA(t.padding),t.textAlign,t.textBaseline)}const a=n.getRowHeight(i),l=n.getColWidth(h);s.contentHeight=e;const{widthChange:c}=lB(s,l,a,{start:{col:t.mergeStartCol,row:t.mergeStartRow},end:{col:t.mergeEndCol,row:t.mergeEndRow}},n);c&&(s.needUpdateWidth=!0)}}else{const i=n._getCellStyle(t.col,t.row);ZR(t,e,0,r,BA(i.padding),i.textAlign,i.textBaseline)}}(e,o,0,t.table.isAutoRowHeight(r),n,t.table)}}(t,e,i,r,o)}function QB(t,e,i,r){let o=!1;const n=t?.attribute.width??0;if(t?.setAttribute("width",n+e),t?.forEachChildren(((t,s)=>{const a=function(t,e,i,r,o,n,s,a,l){if(e.attribute.width===n&&!e.needUpdateWidth)return!1;e.needUpdateWidth=!1,e.setAttribute("width",n);const h=e;if(!h)return!1;const c=t.table.isAutoRowHeight(r),d=t.table.isHeader(i,r)?t.table._getHeaderLayoutMap(i,r).headerType:t.table.getBodyColumnType(i,r);let u=!1;if("progressbar"===d){const e=t.table.getBodyColumnDefine(i,r),o=t.table._getCellStyle(i,r),n=t.table.getCellValue(i,r),s=t.table.getCellOriginValue(i,r),a=(BA(RR("padding",o,i,r,t.table)),FR(e,o,h.attribute.width,n,s,i,r,0,t.table)),l=h.getChildByName("progress-bar");h.insertBefore(a,l),h.removeChild(l),l.removeAllChild(),l.release()}else if("sparkline"===d){h.removeAllChild();const e=t.table._getCellStyle(i,r),o=BA(RR("padding",e,i,r,t.table));OR(h,h.parent,h.attribute.x,h.attribute.y,i,r,h.attribute.width,h.attribute.height,o,t.table,cR(e,t.table,i,r,RR).theme,!1)}else if("image"===d||"video"===d)PR(h,i,r,t.table);else if("axis"===h.firstChild?.name){const e=t.table.internalProps.layoutMap.getAxisConfigInPivotChart(i,r),o=BA(RR("padding",t.table._getCellStyle(i,r),i,r,t.table));if(e){const i=new qS(e,h.attribute.width,h.attribute.height,o,t.table);h.clear(),h.appendChild(i.component),i.overlap()}}else if("axis"===e.firstChild?.name)e.firstChild?.originAxis.resize(e.attribute.width,e.attribute.height);else{let o=!0;const a=e.getChildByName("custom-container");if(a){let n;if(a.removeAllChild(),e.removeChild(a),!hB(i,r,e,t.table)){let s,a;if("body"!==t.table.getCellLocation(i,r)){const e=t.table.getHeaderDefine(i,r);s=e?.headerCustomRender,a=e?.headerCustomLayout}else{const e=t.table.getBodyColumnDefine(i,r);s=e?.customRender||t.table.customRender,a=e?.customLayout}if(a||s){const e=BA(RR("padding",t.table._getCellStyle(i,r),i,r,t.table));let l=h.attribute.width,c=h.attribute.height;cB(h)&&(l=t.table.getColsWidth(h.mergeStartCol,h.mergeEndCol),c=t.table.getRowsHeight(h.mergeStartRow,h.mergeEndRow));const d=fR(a,s,i,r,l,c,!1,t.table.isAutoRowHeight(r),e,t.table);n=d.elementsGroup,o=d.renderDefault,u=!0}e.childrenCount>0&&n?e.insertBefore(n,e.firstChild):n&&e.appendChild(n)}}const l=function(t,e,i,r,o,n){if(cB(t)){e=0;let s=!1;for(let i=t.mergeStartCol;i<=t.mergeEndCol;i++)e+=n.getColWidth(i);let a=0;for(let e=t.mergeStartRow;e<=t.mergeEndRow;e++)a+=n.getRowHeight(e);const{colStart:l,colEnd:h,rowStart:c,rowEnd:d}=qB(t,n.scenegraph);for(let u=l;u<=h;u++)for(let l=c;l<=d;l++){if(u===t.col&&l!==t.row)continue;const h=n.scenegraph.getCell(u,l);h.forEachChildren((t=>{t.setAttributes({dx:0,dy:0})}));let c=!1;if(o){const t=n._getCellStyle(u,l);c=qR(h,e,a,i,r,BA(t.padding),t.textAlign,t.textBaseline,n.scenegraph);const o=KR(h.col,h.row,n);if(o){const t=h.getChildByName("text"),e=h.getChildByName("expand")||h.getChildByName("collapse");"icon-left"!==e?.role&&t&&t.setAttribute("dx",o)}}const d=n.getRowHeight(l),g=n.getColWidth(u);h.contentWidth=e;const{heightChange:p}=lB(h,g,d,{start:{col:t.mergeStartCol,row:t.mergeStartRow},end:{col:t.mergeEndCol,row:t.mergeEndRow}},n);p&&(h.needUpdateHeight=!0),s=s||c}return s}const s=n._getCellStyle(t.col,t.row),a=BA(s.padding),l=s.textAlign,h=s.textBaseline;return qR(t,e,n.getRowHeight(t.row),i,r,a,l,h,n.scenegraph)}(h,n,s,c,o,t.table);u=u||l}return!(!c||!l)&&u}(r,t,t.col,t.row,0,n+e,e,"row-body"!==i||(t.col,r.table.rowHeaderLevelCount),r.table.internalProps.autoWrapText);if(a){const e=iv(r.table,t.col,t.row);if(e&&e.end.row-e.start.row)for(let t=e.start.row;t<=e.end.row;t++)tM(r,t);else tM(r,t.row);o=!0}})),o){let t,e,o,n=0;for(let s=0;s<r.table.colCount;s++){if("col-corner"===i?(o=0,t=r.getColGroup(s,!0),e=r.colHeaderGroup.attribute.height??0):"row-body"===i?(o=r.table.frozenRowCount,t=r.getColGroup(s,!1),e=r.bodyGroup.attribute.height??0):"bottom"===i?(o=r.table.rowCount-r.table.bottomFrozenRowCount,t=r.getColGroupInBottom(s),e=r.bottomFrozenGroup.attribute.height??0):"left-bottom"===i?(o=r.table.rowCount-r.table.bottomFrozenRowCount,t=r.getColGroupInLeftBottomCorner(s),e=r.leftBottomCornerGroup.attribute.height??0):"right-top"===i?(o=0,t=r.getColGroupInRightTopCorner(s),e=r.rightTopCornerGroup.attribute.height??0):"right-bottom"===i&&(o=r.table.rowCount-r.table.bottomFrozenRowCount,t=r.getColGroupInRightBottomCorner(s),e=r.rightBottomCornerGroup.attribute.height??0),!t)continue;let a=0;t.forEachChildren((t=>{t.setAttribute("y",a),a+=r.table.getRowHeight(t.row)??0})),n=a}r.updateContainerHeight(o,n-e);for(let t=0;t<r.table.frozenColCount;t++){const e=r.getColGroupInLeftBottomCorner(t);let i=0;e?.forEachChildren((t=>{t.setAttribute("y",i),i+=r.table.getRowHeight(t.row)}))}for(let t=r.table.colCount-r.table.rightFrozenColCount;t<r.table.colCount;t++){const e=r.getColGroupInRightBottomCorner(t);let i=0;e?.forEachChildren((t=>{t.setAttribute("y",i),i+=r.table.getRowHeight(t.row)}))}for(let t=r.table.frozenColCount;t<r.table.colCount-r.table.rightFrozenColCount;t++){const e=r.getColGroupInBottom(t);let i=0;e?.forEachChildren((t=>{t.setAttribute("y",i),i+=r.table.getRowHeight(t.row)}))}}}function tM(t,e){const i=Math.round(VB(e,0,t.table.colCount-1,t.table));t.table._setRowHeight(e,i,!0);for(let r=0;r<t.table.colCount;r++){const o=i,n=t.highPerformanceGetCell(r,e);if("empty"===n.role)return;JB(t,n,r,e,o,n.attribute.height,t.table.isHeader(r,e))}}var eM;!function(t){t.dropDown="dropDown",t.contextmenu="contextmenu",t.custom="custom"}(eM||(eM={}));const iM={fontSize:12,fontFamily:"Arial,sans-serif",color:"#000",highlightColor:"#2E68CF",hoverBgColor:"#EEE",lineHeight:30,bgColor:"#FFF",cornerRadius:4,borderWidth:.5,borderColor:"#CCC",menuPadding:6,menuItemPadding:9,maxLineWidth:200};const rM=xR();class oM{icon;constructor(){const t=rM.drillDown;this.icon=new pR({x:-1e3,y:-1e3,image:t.svg,width:t.width,height:t.height,dx:-t.width/2,dy:-t.height/2,visible:!1,funcType:t.funcType,cursor:t.cursor}),this.icon.role="icon-drill"}appand(t){t.appendChild(this.icon)}update(t,e,i,r,o,n){if(!t||r&&o)return this.icon.setAttributes({x:-1e3,y:-1e3,visible:!1}),void n.updateNextFrame();const s=rM.drillDown,a=rM.drillUp;this.icon.setAttributes({x:e,y:i,image:r?s.svg:a.svg,visible:!0}),this.icon.loadImage(this.icon.attribute.image),n.updateNextFrame()}}class nM{columnMoverLabel;columnMoverLine;columnMoverBack;table;x;constructor(t){const e=t.theme.dragHeaderSplitLine.lineWidth,i=t.theme.dragHeaderSplitLine.lineColor,r=t.theme.dragHeaderSplitLine.shadowBlockColor;this.columnMoverLabel=hl({visible:!1,pickable:!1,x:0,y:0,symbolType:"triangle",fill:i}),this.columnMoverLine=ul({visible:!1,pickable:!1,stroke:i,lineWidth:e,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]}),this.columnMoverBack=fl({visible:!1,pickable:!1,fill:r,x:0,y:0,width:0,height:0}),this.table=t}appand(t){t.appendChild(this.columnMoverLabel),t.appendChild(this.columnMoverLine),t.appendChild(this.columnMoverBack)}show(t,e,i){const r=this.table.getCellLocation(t,e),o=iv(this.table,t,e);o&&(t=o.start.col,e=o.start.row);let n=0,s=0,a=0,l=0,h=0,c=0,d=0,u=0,g=Math.PI;const p=[];"columnHeader"===r?(n=this.table.getColsWidth(0,t-1)-this.table.stateManager.scroll.horizontalBarPos,s=this.table.getRowsHeight(0,this.table.frozenRowCount-1),l=this.table.tableNoFrameHeight,a=o?this.table.getColsWidth(o.start.col,o.end.col):this.table.getColWidth(t),h=n-i,d=n+a,u=2,p.push({x:0,y:0}),p.push({x:0,y:this.table.tableNoFrameHeight})):("rowHeader"===r||this.table.internalProps.layoutMap.isSeriesNumberInBody(t,e))&&(s=this.table.getRowsHeight(0,e-1)-this.table.stateManager.scroll.verticalBarPos,n=this.table.getColsWidth(0,this.table.frozenColCount-1),a=this.table.tableNoFrameWidth,l=o?this.table.getRowsHeight(o.start.row,o.end.row):this.table.getRowHeight(e),c=s-i,d=2,u=s+l,g=Math.PI/2,p.push({x:0,y:0}),p.push({x:this.table.tableNoFrameWidth,y:0})),this.columnMoverBack.setAttributes({visible:!0,x:n-h,y:s-c,width:a,height:l,dx:h,dy:c}),this.columnMoverLine.setAttributes({x:d,y:u,visible:!0,points:p}),this.columnMoverLabel.setAttributes({visible:!0,x:d,y:u,angle:g})}hide(){this.columnMoverLabel.setAttribute("visible",!1),this.columnMoverLine.setAttribute("visible",!1),this.columnMoverBack.setAttribute("visible",!1)}update(t,e,i,r){"number"==typeof t&&"number"==typeof e?(this.columnMoverLabel.setAttribute("x",e),this.columnMoverLine.setAttribute("x",e),this.columnMoverBack.setAttribute("x",t)):"number"==typeof i&&"number"==typeof r&&(this.columnMoverLabel.setAttribute("y",r),this.columnMoverLine.setAttribute("y",r),this.columnMoverBack.setAttribute("y",i))}updateStyle(){const t=this.table.theme.dragHeaderSplitLine.lineWidth,e=this.table.theme.dragHeaderSplitLine.lineColor,i=this.table.theme.dragHeaderSplitLine.shadowBlockColor;this.columnMoverLabel.setAttributes({fill:e}),this.columnMoverLine.setAttributes({stroke:e,lineWidth:t}),this.columnMoverBack.setAttributes({fill:i})}}function sM(t,e,i){if(i)return Math.min(e.tableNoFrameWidth,e.getAllColsWidth())-e.getColsWidth(t,e.colCount-1);let r=e.getColsWidth(0,t);return t>=e.frozenColCount&&(r-=e.scrollLeft),r}function aM(t,e,i){if(i)return Math.min(e.tableNoFrameWidth,e.getAllRowsHeight())-e.getRowsHeight(t,e.rowCount-1);let r=e.getRowsHeight(0,t);return t>=e.frozenRowCount&&(r-=e.scrollLeft),r}class lM{table;border;columnResizeLine;columnResizeBgLine;columnResizeLabel;rowResizeLine;rowResizeBgLine;rowResizeLabel;menu;vScrollBar;hScrollBar;frozenShadowLine;rightFrozenShadowLine;drillIcon;cellMover;constructor(t){this.table=t;const e=this.table.theme;this.createScrollBar();const i=e.columnResize?.lineColor,r=e.columnResize?.lineWidth,o=e.columnResize?.bgColor,n=e.columnResize?.width,s=e.columnResize?.labelColor,a=e.columnResize?.labelFontSize,l=e.columnResize?.labelFontFamily,h=e.columnResize?.labelBackgroundFill,c=e.columnResize?.labelBackgroundCornerRadius;this.columnResizeLine=ul({visible:!1,pickable:!1,stroke:i,lineWidth:r,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]}),this.columnResizeBgLine=ul({visible:!1,pickable:!1,stroke:o,lineWidth:n,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]});const d=ea({visible:!1,pickable:!1,x:0,y:0,fontSize:a,fill:s,fontFamily:l,text:"",textBaseline:"top",dx:16,dy:-a/2}),u=fl({visible:!1,pickable:!1,fill:h,x:0,y:0,width:5*a*.8,height:a+8,cornerRadius:c,dx:12,dy:-a/2-4});this.columnResizeLabel=cs({visible:!1,pickable:!1,x:0,y:0}),this.columnResizeLabel.appendChild(u),this.columnResizeLabel.appendChild(d),this.rowResizeLine=ul({visible:!1,pickable:!1,stroke:i,lineWidth:r,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]}),this.rowResizeBgLine=ul({visible:!1,pickable:!1,stroke:o,lineWidth:n,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]});const g=ea({visible:!1,pickable:!1,x:0,y:0,fontSize:a,fill:s,fontFamily:l,text:"",textBaseline:"top",dx:16,dy:-a/2}),p=fl({visible:!1,pickable:!1,fill:h,x:0,y:0,width:5*a*.8,height:a+8,cornerRadius:c,dx:12,dy:-a/2-4});this.rowResizeLabel=cs({visible:!1,pickable:!1,x:0,y:0}),this.rowResizeLabel.appendChild(p),this.rowResizeLabel.appendChild(g),this.cellMover=new nM(this.table);const f=e.frozenColumnLine?.shadow?.width,m=e.frozenColumnLine?.shadow?.startColor,b=e.frozenColumnLine?.shadow?.endColor;this.frozenShadowLine=fl({visible:!0,pickable:!1,x:0,y:0,width:f,height:0,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:m,offset:0},{color:b,offset:1}]}}),this.rightFrozenShadowLine=fl({visible:!0,pickable:!1,x:0,y:0,width:f,height:0,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:b,offset:0},{color:m,offset:1}]}}),this.menu=new class{_table;_menuInstance;_menuInfo;constructor(t){this._table=t,this._menuInstance=new _R({x:0,y:0,fill:iM.bgColor,stroke:iM.borderColor,cornerRadius:iM.cornerRadius,lineWidth:iM.borderWidth}),this._menuInfo={x:-1,y:-1,col:-1,row:-1,type:eM.dropDown,menuInfo:[],highlightIndex:-1}}bindTableComponent(t){t.appendChild(this._menuInstance),this.bindEvent()}release(){}attach(t,e,i,r,o,n){if(o===eM.dropDown&&this.checkDropDownMenuChange(i,r)){const t=this.getMenuInfo(i,r,o);if(!t)return;const{menuInfo:e,highlightIndex:n}=t;this.updateMenuInfo(i,r,o,e,n),this.updateMenuInstance(e,n)}else if(o===eM.contextmenu&&this.checkContextMenuChange(t,e)){const t=this.getMenuInfo(i,r,o);if(!t)return;const{menuInfo:e,highlightIndex:n}=t;this.updateMenuInfo(i,r,o,e,n),this.updateMenuInstance(e,n)}this.updatePosition(t-this._table.scenegraph.x,e-this._table.scenegraph.y),this.addToScene()}updateMenuInfo(t,e,i,r,o){this._menuInfo.col=t,this._menuInfo.row=e,this._menuInfo.type=i,this._menuInfo.menuInfo=r,this._menuInfo.highlightIndex=o}checkDropDownMenuChange(t,e){const{type:i,col:r,row:o}=this._menuInfo;return i!==eM.dropDown||t!==r||e!==o}checkContextMenuChange(t,e){const{type:i,menuInfo:r}=this._menuInfo;return i!==eM.contextmenu||r!==this._table.internalProps.menu?.contextMenuItems}updateMenuInstance(t,e){this._menuInstance.removeAllChild();let i=iM.menuPadding;const r=iM.menuPadding;let o=0;t.forEach(((t,n)=>{const s=e===n;let a,l;"string"==typeof t?l=t:"object"==typeof t&&(l=t.text,a=s?t.selectedIcon:t.icon);const h=new _R({y:i,x:r,height:iM.lineHeight,fill:iM.bgColor});h.role="menu-item",this._menuInstance.appendChild(h),h.stateProxy=t=>"hover"===t?{fill:iM.hoverBgColor}:{fill:iM.bgColor},h.addEventListener("pointerenter",(t=>{h.addState("hover",!0,!1),this._table.scenegraph.updateNextFrame()})),h.addEventListener("pointerleave",(t=>{h.removeState("hover",!1),this._table.scenegraph.updateNextFrame()}));const c=new ta({x:iM.menuItemPadding,y:iM.menuItemPadding,fill:s?iM.highlightColor:iM.color,text:l,textBaseline:"top",fontSize:iM.fontSize,fontFamily:iM.fontFamily,pickable:!1,maxLineWidth:iM.maxLineWidth,ellipsis:"…"});if(h.addChild(c),a){c.AABBBounds.height();const t=a.width??16,e=a.height??16,i=new pR({x:iM.menuItemPadding,y:(iM.lineHeight-e)/2,width:t,height:e,image:a.svg,pickable:!1});i.role="menu-icon",h.insertBefore(i,c),c.setAttribute("x",t+iM.menuItemPadding)}o=Math.max(h.AABBBounds.width(),o),i+=iM.lineHeight})),this._menuInstance.setAttributes({width:o+2*iM.menuItemPadding+2*iM.menuPadding,height:i+iM.menuPadding}),this._menuInstance.forEachChildren((t=>{t.setAttribute("width",o+2*iM.menuItemPadding)}))}updatePosition(t,e){this._menuInstance.setAttributes({x:this._menuInfo.type===eM.dropDown?t-this._menuInstance.attribute.width:t,y:e}),this._menuInfo.x=eM.dropDown?t-this._menuInstance.attribute.width:t,this._menuInfo.y=e}addToScene(){this._table.scenegraph.updateNextFrame()}detach(){this._menuInstance.setAttributes({x:-1e3,y:-1e3}),this._table.scenegraph.updateNextFrame()}getMenuInfo(t,e,i){if(i===eM.dropDown){const{dropDownMenu:i=this._table.globalDropDownMenu,pivotInfo:r}=this._table._getHeaderLayoutMap(t,e);let o=-1;if(Array.isArray(i))for(let r=0;r<i.length;r++)if(this._table._dropDownMenuIsHighlight(t,e,r)){o=r;break}return{menuInfo:i,highlightIndex:o}}if(i===eM.contextmenu){const i=this._table.internalProps.menu?.contextMenuItems;let r;if(Array.isArray(i))r=i;else if("function"==typeof i){const{field:o}=this._table.isHeader(t,e)?this._table.getHeaderDefine(t,e):this._table.getBodyColumnDefine(t,e);r=i(o,e,t)}return{menuInfo:r,highlightIndex:-1}}}bindEvent(){this._menuInstance.addEventListener("click",(t=>{const{target:e}=t;if(e&&"menu-item"===e.role){const i=this.getEventInfo(e),r=this._table.getMenuInfo(this._menuInfo.col,this._menuInfo.row,this._menuInfo.type),o=Object.assign(i,r);o.event=t.nativeEvent,this._table.fireListeners(ww.DROPDOWN_MENU_CLICK,o)}}))}getEventInfo(t){const e=t.parent;let i=0;e.forEachChildren(((e,r)=>e===t&&(i=r-1,!0)));const r="string"==typeof this._menuInfo.menuInfo[i]?this._menuInfo.menuInfo[i]:this._menuInfo.menuInfo[i].text,o="string"==typeof this._menuInfo.menuInfo[i]?r:this._menuInfo.menuInfo[i].menuKey||r;return{col:this._menuInfo.col,row:this._menuInfo.row,dropDownIndex:i,highlight:i===this._menuInfo.highlightIndex,text:r,menuKey:o}}get bounds(){return this._menuInstance.globalAABBBounds}}(this.table),this.drillIcon=new oM}addToGroup(t){t.addChild(this.frozenShadowLine),t.addChild(this.rightFrozenShadowLine),t.addChild(this.columnResizeBgLine),t.addChild(this.columnResizeLine),t.addChild(this.columnResizeLabel),t.addChild(this.rowResizeBgLine),t.addChild(this.rowResizeLine),t.addChild(this.rowResizeLabel);this.table.theme.scrollStyle.hoverOn&&!this.table.theme.scrollStyle.barToSide?(t.addChild(this.hScrollBar),t.addChild(this.vScrollBar)):(t.stage.defaultLayer.addChild(this.hScrollBar),t.stage.defaultLayer.addChild(this.vScrollBar)),this.menu.bindTableComponent(t),this.drillIcon.appand(t),this.cellMover.appand(t)}createScrollBar(){const t=this.table.theme,e=t.scrollStyle?.scrollRailColor,i=t.scrollStyle?.scrollSliderColor,r=t.scrollStyle?.width;this.hScrollBar=new cv({direction:"horizontal",x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,width:this.table.tableNoFrameWidth,height:r,padding:0,railStyle:{fill:e},sliderStyle:{fill:i},range:[0,.1],visible:!1}),this.hScrollBar.render(),this.hScrollBar.hideAll(),this.vScrollBar=new cv({direction:"vertical",x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,width:r,height:this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight(),padding:0,railStyle:{fill:e},sliderStyle:{fill:i},range:[0,.1],visible:!1}),this.vScrollBar.render(),this.vScrollBar.hideAll()}updateScrollBar(){const t=this.table.stateManager.scroll.horizontalBarPos,e=this.table.stateManager.scroll.verticalBarPos,i=this.table.theme,r=i.scrollStyle?.width,o=i.scrollStyle?.visible,n=Math.ceil(this.table.scenegraph.tableGroup.attribute.width),s=Math.ceil(this.table.scenegraph.tableGroup.attribute.height),a=this.table.getAllRowsHeight(),l=this.table.getAllColsWidth(),h=this.table.getFrozenRowsHeight(),c=this.table.getFrozenColsWidth(),d=this.table.getBottomFrozenRowsHeight(),u=this.table.getRightFrozenColsWidth();if(l>n){const t=Math.min(s,a),e=Math.max(.05,(n-c)/(l-c)),i=this.table.theme.scrollStyle.hoverOn;let h=0;h=this.table.theme.scrollStyle.barToSide?this.table.tableNoFrameHeight-(i?r:-this.table.scenegraph.tableGroup.attribute.y)+this.table.tableY:t-(i?r:-this.table.scenegraph.tableGroup.attribute.y),this.hScrollBar.setAttributes({x:c+(i?0:this.table.scenegraph.tableGroup.attribute.x),y:h,width:n-c-u,range:[0,e],visible:"always"===o});const d=this.hScrollBar.AABBBounds&&this.hScrollBar.globalAABBBounds;this.hScrollBar._viewPosition={x:d.x1,y:d.y1},"always"===o&&this.hScrollBar.showAll()}else this.hScrollBar.setAttributes({x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,width:0,visible:!1});if(a>s){const t=Math.min(n,l),e=Math.max(.05,(s-h)/(a-h));let i=0;const c=this.table.theme.scrollStyle.hoverOn;i=this.table.theme.scrollStyle.barToSide?this.table.tableNoFrameWidth-(c?r:-this.table.scenegraph.tableGroup.attribute.x)+this.table.tableX:t-(c?r:-this.table.scenegraph.tableGroup.attribute.x),this.vScrollBar.setAttributes({x:i,y:h+(c?0:this.table.scenegraph.tableGroup.attribute.y),height:s-h-d,range:[0,e],visible:"always"===o});const u=this.vScrollBar.AABBBounds&&this.vScrollBar.globalAABBBounds;this.vScrollBar._viewPosition={x:u.x1,y:u.y1},"always"===o&&this.vScrollBar.showAll()}else this.vScrollBar.setAttributes({x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,height:0,visible:!1});this.table.stateManager.setScrollLeft(t),this.table.stateManager.setScrollTop(e)}hideResizeCol(){this.columnResizeLine.setAttribute("visible",!1),this.columnResizeBgLine.setAttribute("visible",!1),this.columnResizeLabel.setAttribute("visible",!1),this.columnResizeLabel.hideAll()}showResizeCol(t,e,i){const r=sM(t,this.table,i);this.columnResizeLine.setAttributes({visible:!0,x:r,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.columnResizeBgLine.setAttributes({visible:!0,x:r,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.columnResizeLabel.showAll(),this.columnResizeLabel.setAttributes({visible:!0,x:r,y:e}),this.columnResizeLabel.lastChild.setAttribute("text",`${this.table.getColWidth(t)}px`)}updateResizeCol(t,e,i){const r=sM(t,this.table,i);this.columnResizeLine.setAttributes({x:r,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.columnResizeBgLine.setAttributes({x:r,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.columnResizeLabel.setAttributes({x:r,y:e}),this.columnResizeLabel.lastChild.setAttribute("text",`${Math.floor(this.table.getColWidth(t))}px`)}hideResizeRow(){this.rowResizeLine.setAttribute("visible",!1),this.rowResizeBgLine.setAttribute("visible",!1),this.rowResizeLabel.setAttribute("visible",!1),this.rowResizeLabel.hideAll()}showResizeRow(t,e,i){const r=aM(t,this.table,i);this.rowResizeLine.setAttributes({visible:!0,y:r,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.rowResizeBgLine.setAttributes({visible:!0,y:r,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.rowResizeLabel.showAll(),this.rowResizeLabel.setAttributes({visible:!0,y:r,x:e}),this.rowResizeLabel.lastChild.setAttribute("text",`${this.table.getRowHeight(t)}px`)}updateResizeRow(t,e,i){const r=aM(t,this.table,i);this.rowResizeLine.setAttributes({y:r,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.rowResizeBgLine.setAttributes({y:r,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.rowResizeLabel.setAttributes({y:r,x:e}),this.rowResizeLabel.lastChild.setAttribute("text",`${Math.floor(this.table.getRowHeight(t))}px`)}hideMoveCol(){this.cellMover.hide()}showMoveCol(t,e,i){this.cellMover.show(t,e,i)}updateMoveCol(t,e,i,r){this.cellMover.update(t,e,i,r)}setFrozenColumnShadow(t,e){if(t<0)this.frozenShadowLine.setAttributes({visible:!1});else{const i=sM(t,this.table,e);this.frozenShadowLine.setAttributes({visible:!0,x:i,height:this.table.getDrawRange().height})}}setRightFrozenColumnShadow(t){if(t>=this.table.colCount)this.rightFrozenShadowLine.setAttributes({visible:!1});else{const e=sM(t,this.table,!0);this.rightFrozenShadowLine.setAttributes({visible:!0,x:e-this.rightFrozenShadowLine.attribute.width,height:this.table.getDrawRange().height})}}hideVerticalScrollBar(){const t=this.table.theme.scrollStyle.visible;"focus"!==t&&"scrolling"!==t||(this.vScrollBar.setAttribute("visible",!1),this.vScrollBar.hideAll(),this.table.scenegraph.updateNextFrame())}showVerticalScrollBar(){const t=this.table.theme.scrollStyle.visible;"focus"!==t&&"scrolling"!==t||(this.vScrollBar.setAttribute("visible",!0),this.vScrollBar.showAll(),this.table.scenegraph.updateNextFrame())}hideHorizontalScrollBar(){const t=this.table.theme.scrollStyle.visible;"focus"!==t&&"scrolling"!==t||(this.hScrollBar.setAttribute("visible",!1),this.hScrollBar.hideAll(),this.table.scenegraph.updateNextFrame())}showHorizontalScrollBar(){const t=this.table.theme.scrollStyle.visible;"focus"!==t&&"scrolling"!==t||(this.hScrollBar.setAttribute("visible",!0),this.hScrollBar.showAll(),this.table.scenegraph.updateNextFrame())}updateVerticalScrollBarPos(t){const e=this.vScrollBar.attribute.range,i=e[1]-e[0],r=t*(1-i);this.vScrollBar.setAttribute("range",[r,r+i]);const o=this.vScrollBar.AABBBounds&&this.vScrollBar.globalAABBBounds;this.vScrollBar._viewPosition={x:o.x1,y:o.y1}}updateHorizontalScrollBarPos(t){const e=this.hScrollBar.attribute.range,i=e[1]-e[0],r=t*(1-i);this.hScrollBar.setAttribute("range",[r,r+i]);const o=this.hScrollBar.AABBBounds&&this.hScrollBar.globalAABBBounds;this.hScrollBar._viewPosition={x:o.x1,y:o.y1}}updateStyle(){const t=this.table.theme,e=t.scrollStyle?.scrollRailColor,i=t.scrollStyle?.scrollSliderColor,r=t.scrollStyle?.width;this.hScrollBar.setAttributes({height:r,railStyle:{fill:e},sliderStyle:{fill:i}}),this.vScrollBar.setAttributes({width:r,railStyle:{fill:e},sliderStyle:{fill:i}});const o=t.columnResize?.lineColor,n=t.columnResize?.lineWidth,s=t.columnResize?.bgColor,a=t.columnResize?.width;this.columnResizeLine.setAttributes({stroke:o,lineWidth:n}),this.columnResizeBgLine=ul({stroke:s,lineWidth:a});const l=t.columnResize?.labelColor,h=t.columnResize?.labelFontSize,c=t.columnResize?.labelFontFamily,d=t.columnResize?.labelBackgroundFill,u=t.columnResize?.labelBackgroundCornerRadius;this.columnResizeLabel.lastChild.setAttributes({fontSize:h,fill:l,fontFamily:c,dy:-h/2}),this.columnResizeLabel.firstChild.setAttributes({fill:d,width:5*h*.8,height:h+8,cornerRadius:u,dy:-h/2-4}),this.rowResizeLabel.lastChild.setAttributes({fontSize:h,fill:l,fontFamily:c,dy:-h/2}),this.rowResizeLabel.firstChild.setAttributes({fill:d,width:5*h*.8,height:h+8,cornerRadius:u,dy:-h/2-4});const g=t.frozenColumnLine?.shadow?.width,p=t.frozenColumnLine?.shadow?.startColor,f=t.frozenColumnLine?.shadow?.endColor;this.frozenShadowLine.setAttributes({width:g,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:p,offset:0},{color:f,offset:1}]}}),this.rightFrozenShadowLine.setAttributes({width:g,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:f,offset:0},{color:p,offset:1}]}}),this.cellMover.updateStyle()}}function hM(t,e,i,r,o){if(!e)return;const n="table"===i,{shadowBlur:s,shadowOffsetX:a,shadowOffsetY:l,shadowColor:h,cornerRadius:c,borderColor:d,borderLineWidth:u,borderLineDash:g}=e;let p=!1;const f={},m={pickable:!1};s&&n&&(m.shadowBlur=s,m.shadowOffsetX=a,m.shadowOffsetY=l,m.shadowColor=h,m.stroke=!0,m.stroke=h,m.lineWidth=1,p=!0),u&&(m.stroke=!0,m.fill=!1,m.stroke=dM(d,r),m.lineWidth=u,g&&(m.lineDash=g),m.lineCap="butt"),Array.isArray(d)&&(m.strokeArrayColor=BA(d)),Array.isArray(u)&&(m.strokeArrayWidth=BA(u),m.lineWidth=1),c&&(m.cornerRadius=c,f.cornerRadius=c);const b=m.strokeArrayWidth?m.strokeArrayWidth[0]:m.lineWidth??0,y=m.strokeArrayWidth?m.strokeArrayWidth[1]:m.lineWidth??0,C=m.strokeArrayWidth?m.strokeArrayWidth[2]:m.lineWidth??0,w=m.strokeArrayWidth?m.strokeArrayWidth[3]:m.lineWidth??0;if(t.setAttributes(f),!o&&m.stroke)if(m.x=w/2,m.y=b/2,m.pickable=!1,n){let i,r;if(e.innerBorder?(m.x=t.attribute.x+w/2,m.y=t.attribute.y+b/2,m.width=t.attribute.width-w/2-y/2,m.height=t.attribute.height-b/2-C/2):(m.x=t.attribute.x-w/2,m.y=t.attribute.y-b/2,m.width=t.attribute.width+w/2+y/2,m.height=t.attribute.height+b/2+C/2),p){m.fill="white",m.notAdjustPos=!0,r=cs(m),r.name="table-border-rect",i=fl({x:w/2,y:b/2,width:t.attribute.width,height:t.attribute.height,fill:"red",cornerRadius:t.attribute.cornerRadius,globalCompositeOperation:"destination-out"}),r.addChild(i);const e=fl({width:1,height:1,fill:"transparent",pickable:!1});r.addChild(e)}else r=fl(m),r.name="table-border-rect";e.innerBorder&&!p?t.parent.insertAfter(r,t):t.parent.insertBefore(r,t),t.border=r}else{m.width=t.attribute.width-w/2-y/2,m.height=t.attribute.height-b/2-C/2;const e=fl(m);e.name="border-rect",t.addChild(e),t.border=e}}function cM(t,e,i){const{borderColor:r}=e;t.border?.setAttribute("stroke",dM(r,i))}function dM(t,e){let i=!0;return e&&!et(t)?i=e.map((e=>!!e&&t)):e?i=e:e||et(t)?et(t)&&(i=!0):i=t,i}function uM(t){if(!t.border)return;const e=t.border.attribute.strokeArrayWidth?t.border.attribute.strokeArrayWidth[0]:t.border.attribute.lineWidth??0,i=t.border.attribute.strokeArrayWidth?t.border.attribute.strokeArrayWidth[1]:t.border.attribute.lineWidth??0,r=t.border.attribute.strokeArrayWidth?t.border.attribute.strokeArrayWidth[2]:t.border.attribute.lineWidth??0,o=t.border.attribute.strokeArrayWidth?t.border.attribute.strokeArrayWidth[3]:t.border.attribute.lineWidth??0;t.border.setAttributes({width:t.attribute.width-o/2-i/2,height:t.attribute.height-e/2-r/2}),"group"===t.border.type&&t.border.firstChild.setAttributes({width:t.attribute.width,height:t.attribute.height})}function gM(t,e){t.setAttribute("cornerRadius",e),t.border&&t.border.setAttribute("cornerRadius",e)}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function pM(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s}const fM=[],mM=[];let bM=5,yM=!1;function CM(t){Y(t)&&(bM=t)}function wM(t){const{axes:e,dataId:i,data:r,spec:o}=t.attribute,{chartInstance:n}=t,s=t.getViewBox();s.x2<=s.x1&&(s.x2=s.x1+1),s.y2<=s.y1&&(s.y2=s.y1+1),e?.forEach(((t,e)=>{"band"===t.type?n.updateModelSpec({type:"axes",index:e},{domain:t.domain.slice(0)},!0):n.updateModelSpecSync({type:"axes",index:e},{min:t.range?.min??0,max:t.range?.max??0},!0)})),n.updateViewBox({x1:s.x1-t.getRootNode().table.scrollLeft,x2:s.x2-t.getRootNode().table.scrollLeft,y1:s.y1-t.getRootNode().table.scrollTop,y2:s.y2-t.getRootNode().table.scrollTop},!1,!1);const a=t.getRootNode().table;if(a.internalProps.layoutMap?.updateDataStateToActiveChartInstance?.(n),"string"==typeof i)n.updateDataSync(i,r??[]);else{const t=[];for(const e in i){const s=i[e],a=o.series.find((t=>t?.data?.id===e));t.push({id:e,values:s?r?.filter((t=>t.hasOwnProperty(s)))??[]:r??[],fields:a?.data?.fields}),n.updateFullDataSync||n.updateDataSync(e,s?r?.filter((t=>t.hasOwnProperty(s)))??[]:r??[])}n.updateFullDataSync?.(t)}!function(t,e){const{viewWidth:i,viewHeight:r}=t;if(i<xM&&r<xM)return e.cacheCanvas=t.toCanvas(),void(e.isShareChartSpec||(e.chartInstance?.release(),e.chartInstance=null,e.setAttribute("chartInstance",null)));const o=Math.ceil(r/xM),n=Math.ceil(i/xM),s=[];for(let e=0;e<o;e++)for(let o=0;o<n;o++){const n=o*xM,a=e*xM,l=n+xM>i?i:n+xM,h=a+xM>r?r:a+xM,c=l-n,d=h-a,u=new de;u.setValue(n,a,l,h);const g=t.toCanvas(!1,u);s.push({canvas:g,x:n,y:a,width:c,height:d})}e.cacheCanvas=s}(n.getStage(),t)}function vM(t){yM=!0,mM.length>0?requestAnimationFrame((()=>{const e=mM.splice(0,bM);fM.splice(0,bM),e.forEach((t=>{wM(t),t.addUpdateBoundTag()})),t.render(),vM(t)})):yM=!1}const xM=2e3;const _M=Symbol.for("ChartRender");let SM=class{type;numberType=WR;drawShape(t,e,i,r,o,n,s,a){const l=yo(t,n?.theme).group,{dataId:h,data:c,spec:d}=t.attribute;t.getViewBox();const{width:u=l.width,height:g=l.height}=t.attribute,{active:p,cacheCanvas:f,activeChartInstance:m}=t;if(!p&&f)et(f)?f.forEach((t=>{const{x:i,y:r,width:o,height:n,canvas:s}=t;e.drawImage(s,i,r,o,n)})):e.drawImage(f,i,r,u,g);else if(m)if("string"==typeof h)m.updateDataSync(h,c??[]);else{const t=[];for(const e in h){const i=h[e],r=d.series.find((t=>t?.data?.id===e));t.push({id:e,values:i?c?.filter((t=>t.hasOwnProperty(i)))??[]:c??[],fields:r?.data?.fields}),m.updateFullDataSync||m.updateDataSync(e,i?c?.filter((t=>t.hasOwnProperty(i)))??[]:c??[])}m.updateFullDataSync?.(t)}else t.getRootNode().table.internalProps.renderChartAsync?(-1===fM.indexOf(`${t.parent.col}+${t.parent.row}`)&&(fM.push(`${t.parent.col}+${t.parent.row}`),mM.push(t)),yM||vM(t.getRootNode().table)):wM(t)}draw(t,e,i,r){const{context:o}=i;if(!o)return;const{clip:n}=t.attribute;n?o.save():o.highPerformanceSave(),o.transformFromMatrix(t.transMatrix,!0),o.beginPath(),r.skipDraw?this.drawShape(t,o,0,0,i,r,(()=>!1),(()=>!1)):this.drawShape(t,o,0,0,i),n?o.restore():o.highPerformanceRestore()}};SM=pM([f()],SM);let AM=class{time=Ri.beforeFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){const{shape:g}=t.attribute;if("circle"===g){const{width:o=l.width,height:n=l.height}=t.attribute;e.beginPath(),e.arc(i+o/2,r+n/2,Math.min(o,n)/2,0,2*Math.PI),e.closePath(),e.save(),e.clip()}}};AM=pM([f()],AM);let RM=class{time=Ri.afterFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){const{shape:g}=t.attribute;"circle"===g&&e.restore()}};function BM(t,e,i,r){const{highlightScope:o,disableHeader:n,cellPos:s}=t.hover,a=t.table,l=a.isHeader(e,i);if(l&&n)return;let h;if(o===iC.single&&s.col===e&&s.row===i?h="cellBgColor":o===iC.column&&s.col===e?h=s.col===e&&s.row===i?"cellBgColor":"inlineColumnBgColor":o===iC.row&&s.row===i?h=s.col===e&&s.row===i?"cellBgColor":"inlineRowBgColor":o===iC.cross&&(s.col===e&&s.row===i?h="cellBgColor":s.col===e?h="inlineColumnBgColor":s.row===i&&(h="inlineRowBgColor")),h){let t;if(l){const o=a.getHeaderDefine(e,i);t=o?.disableHeaderHover,r.firstChild&&"axis"===r.firstChild.name&&a.options.hover?.disableAxisHover&&(t=!0)}else{const r=a.getBodyColumnDefine(e,i);t=r?.disableHover}t&&(h=void 0)}return h}RM=pM([f()],RM);let MM=class{time=Ri.beforeFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){const{stroke:g=l.stroke,strokeArrayWidth:p=l.strokeArrayWidth,strokeArrayColor:f=l.strokeArrayColor}=t.attribute;g&&(Array.isArray(p)||Array.isArray(f))&&(u.doStroke=!1)}};MM=pM([f()],MM);let TM=class{time=Ri.afterFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d){const{width:u=l.width,height:g=l.height,stroke:p=l.stroke,strokeArrayColor:f=l.strokeArrayColor,strokeArrayWidth:m=l.strokeArrayWidth,lineWidth:b=l.lineWidth,strokeColor:y=l.stroke}=t.attribute;if(!p||!Array.isArray(m)&&0===b)return;let C,w;if(Array.isArray(f)||Array.isArray(m)){if("number"==typeof b&&1&b||Array.isArray(m)&&m.some((t=>1&t))){const e=t.stage.table;if(!e)return;let o=0,n=0;if("bottom-right"===e?.theme.cellBorderClipDirection){if(i=Math.floor(i)-.5,r=Math.floor(r)-.5,"cell"===t.role){const i=t.col,r=t.row;e&&i===e.colCount-1&&(o=1),e&&r===e.rowCount-1&&(n=1)}}else i=Math.floor(i)+.5,r=Math.floor(r)+.5;const{width:s,height:a}=DM(t,Math.ceil(u+o),Math.ceil(g+n));C=s,w=a}else C=Math.ceil(u),w=Math.ceil(g);PM(t,e,i,r,l,p,m||b,f||y,C,w)}}};function PM(t,e,i,r,o,n,s,a,l,h,c,d){const u=function(t){if(!Array.isArray(t))return{isSplitDraw:!1,width:t};let e;for(let i=0;i<t.length;i++){const r=t[i];if(r)if(e){if(r!==e)return{isSplitDraw:!0}}else e=r}return{isSplitDraw:!1,width:e}}(s),g=!Array.isArray(s),p=!Array.isArray(n),f=Array.isArray(d),m=Array.isArray(a)||u.isSplitDraw;e.setStrokeStyle(t,t.attribute,i,r,o);const{lineDash:b=o.lineDash}=t.attribute;let y=!1;b.length&&b.some((t=>Array.isArray(t)))&&(y=!0),e.beginPath(),e.moveTo(i,r),(p||n[0])&&(g||s[0])?(f&&Array.isArray(d[0])?(e.moveTo(i+l*d[0][0],r),e.lineTo(i+l*(d[0][1]-d[0][0]),r),e.moveTo(i+l,r)):(e.moveTo(i,r),e.lineTo(i+l,r)),(m||y)&&(a&&a[0]?e.strokeStyle=a[0]:e.strokeStyle="transparent",g||(e.lineWidth=s[0]),e.lineDashOffset=e.currentMatrix.e/e.currentMatrix.a,y&&e.setLineDash(b[0]??[]),e.stroke(),e.beginPath(),e.moveTo(i+l,r))):e.moveTo(i+l,r),(p||n[1])&&(g||s[1])?(f&&Array.isArray(d[1])?(e.moveTo(i+l,r+h*d[1][0]),e.lineTo(i+l,r+h*(d[1][1]-d[1][0])),e.moveTo(i+l,r+h)):(e.moveTo(i+l,r),e.lineTo(i+l,r+h)),(m||y)&&(a&&a[1]?e.strokeStyle=a[1]:e.strokeStyle="transparent",g||(e.lineWidth=s[1]),e.lineDashOffset=e.currentMatrix.f/e.currentMatrix.d,y&&e.setLineDash(b[1]??[]),e.stroke(),e.beginPath(),e.moveTo(i+l,r+h))):e.moveTo(i+l,r+h),(p||n[2])&&(g||s[2])?(f&&Array.isArray(d[2])?(e.moveTo(i+l*d[2][0],r+h),e.lineTo(i+l*(d[2][1]-d[2][0]),r+h),e.moveTo(i,r+h)):(e.moveTo(i,r+h),e.lineTo(i+l,r+h)),(m||y)&&(a&&a[2]?e.strokeStyle=a[2]:e.strokeStyle="transparent",g||(e.lineWidth=s[2]),e.lineDashOffset=e.currentMatrix.e/e.currentMatrix.a,y&&e.setLineDash(b[2]??[]),e.stroke(),e.beginPath(),e.moveTo(i,r+h))):e.moveTo(i,r+h),(p||n[3])&&(g||s[3])?(f&&Array.isArray(d[3])?(e.moveTo(i,r+h*d[3][0]),e.lineTo(i,r+h*(d[3][1]-d[3][0])),e.moveTo(i,r)):(e.moveTo(i,r),e.lineTo(i,r+h)),(m||y)&&(a&&a[3]?e.strokeStyle=a[3]:e.strokeStyle="transparent",g||(e.lineWidth=s[3]),e.lineDashOffset=e.currentMatrix.f/e.currentMatrix.d,y&&e.setLineDash(b[3]??[]),e.stroke(),e.beginPath(),e.moveTo(i,r))):e.moveTo(i,r),m||y||(!g&&u.width&&(e.lineWidth=u.width),e.stroke()),e.lineDashOffset=0,e.setLineDash([])}TM=pM([f()],TM);let HM=class{time=Ri.beforeFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){const{lineDash:g=l.lineDash,stroke:p=l.stroke,strokeArrayColor:f=l.strokeArrayColor,strokeArrayWidth:m=l.strokeArrayWidth}=t.attribute;p&&Array.isArray(g)&&g.length&&!Array.isArray(f)&&!Array.isArray(m)&&(u.doStroke=!1)}};HM=pM([f()],HM);let EM=class{time=Ri.afterFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d){const{lineDash:u=l.lineDash,stroke:g=l.stroke,strokeArrayColor:p=l.strokeArrayColor,strokeArrayWidth:f=l.strokeArrayWidth,lineWidth:m=l.lineWidth}=t.attribute;if(!g||!Array.isArray(u)||!u.length||Array.isArray(p)||Array.isArray(f))return;let b,y,{width:C=l.width,height:w=l.height}=t.attribute;if(C=Math.ceil(C),w=Math.ceil(w),1&m){const e=t.stage.table;if(!e)return;let o=0,n=0;if("bottom-right"===e?.theme.cellBorderClipDirection){if(i=Math.floor(i)-.5,r=Math.floor(r)-.5,"cell"===t.role){const i=t.col,r=t.row;e&&i===e.colCount-1&&(o=1),e&&r===e.rowCount-1&&(n=1)}}else i=Math.floor(i)+.5,r=Math.floor(r)+.5;const{width:s,height:a}=DM(t,Math.ceil(C+o),Math.ceil(w+n));b=s,y=a}else b=Math.ceil(C),y=Math.ceil(w);e.setStrokeStyle(t,t.attribute,i,r,l),e.beginPath(),e.moveTo(i,r),e.lineTo(i+b,r),e.lineDashOffset=e.currentMatrix.e/e.currentMatrix.a,e.setLineDash(u[0]??[]),e.stroke(),e.beginPath(),e.moveTo(i+b,r),e.lineTo(i+b,r+y),e.lineDashOffset=e.currentMatrix.f/e.currentMatrix.d,e.setLineDash(u[1]??[]),e.stroke(),e.beginPath(),e.moveTo(i,r+y),e.lineTo(i+b,r+y),e.lineDashOffset=e.currentMatrix.e/e.currentMatrix.a,e.setLineDash(u[2]??[]),e.stroke(),e.beginPath(),e.moveTo(i,r),e.lineTo(i,r+y),e.lineDashOffset=e.currentMatrix.f/e.currentMatrix.d,e.setLineDash(u[3]??[]),e.stroke(),e.lineDashOffset=0,e.setLineDash([])}};EM=pM([f()],EM);let kM=class{time=Ri.beforeFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){const{lineWidth:g=l.lineWidth,stroke:p=l.stroke,lineDash:f=l.lineDash,strokeArrayWidth:m=l.strokeArrayWidth,strokeArrayColor:b=l.strokeArrayColor,notAdjustPos:y}=t.attribute;!0!==y&&p&&Array.isArray(f)&&!f.length&&!Array.isArray(b)&&!Array.isArray(m)&&1&g&&(u.doStroke=!1)}};kM=pM([f()],kM);let LM=class{time=Ri.afterFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d){const{lineWidth:u=l.lineWidth,stroke:g=l.stroke,lineDash:p=l.lineDash,strokeArrayWidth:f=l.strokeArrayWidth,strokeArrayColor:m=l.strokeArrayColor,notAdjustPos:b,cornerRadius:y=l.cornerRadius}=t.attribute,{width:C=l.width,height:w=l.height}=t.attribute;if(!0!==b&&g&&Array.isArray(p)&&!p.length&&!Array.isArray(m)&&!Array.isArray(f)&&1&u){const{width:o,height:n}=DM(t,Math.ceil(C),Math.ceil(w));e.beginPath();const s=t.stage.table;if(!s)return;let a=0,h=0;if("bottom-right"===s?.theme.cellBorderClipDirection){if(i=Math.floor(i)-.5,r=Math.floor(r)-.5,"cell"===t.role){const e=t.col,i=t.row;s&&e===s.colCount-1&&(a=1),s&&i===s.rowCount-1&&(h=1)}}else i=Math.floor(i)+.5,r=Math.floor(r)+.5;y?Lh(e,i,r,o+a,n+h,y):e.rect(i,r,o,n),e.setStrokeStyle(t,t.attribute,i,r,l),e.stroke()}}};LM=pM([f()],LM);let FM=class{time=Ri.beforeFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){if("cell"===t.role){const e=t.stage.table;if(e&&e.stateManager.interactionState!==eC.scrolling){const i=function(t,e){let i,r;if("cell"===t.role&&Y(t.mergeStartCol)&&Y(t.mergeStartRow)&&Y(t.mergeEndCol)&&Y(t.mergeEndRow)){const{colStart:r,colEnd:o,rowStart:n,rowEnd:s}=qB(t,e.scenegraph);for(let a=r;a<=o;a++)for(let r=n;r<=s;r++){const o=BM(e.stateManager,a,r,t);!o||i&&"cellBgColor"!==o||(i=o)}}else"cell"===t.role&&(i=BM(e.stateManager,t.col,t.row,t));if(!i)return;const o=e.internalProps.layoutMap;return o.isCornerHeader(t.col,t.row)?r=e.theme.cornerHeaderStyle?.hover||e.theme.headerStyle?.hover:o.isColumnHeader(t.col,t.row)?r=e.theme.headerStyle?.hover:o.isRowHeader(t.col,t.row)?r=e.theme.rowHeaderStyle?.hover:o.isBottomFrozenRow(t.col,t.row)?r=e.theme.bottomFrozenStyle?.hover||(e.isListTable()?e.theme.bodyStyle?.hover:e.theme.headerStyle?.hover):o.isRightFrozenColumn(t.col,t.row)?r=e.theme.rightFrozenStyle?.hover||(e.isListTable()?e.theme.bodyStyle?.hover:e.theme.rowHeaderStyle?.hover):e.isHeader(t.col,t.row)||(r=e.theme.bodyStyle?.hover),RR(i,r,t.col,t.row,e)}(t,e);i&&(t.attribute._vtableHoverFill=i)}}}};FM=pM([f()],FM);let IM=class{time=Ri.afterFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d){if(t.attribute._vtableHoverFill)if(c);else if(s){const o=t.attribute.fill;t.attribute.fill=t.attribute._vtableHoverFill,e.setCommonStyle(t,t.attribute,i,r,l),e.fill(),t.attribute.fill=o,t.attribute._vtableHoverFill=void 0}}};IM=pM([f()],IM);let zM=class{time=Ri.beforeFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){const g=t.stage.table;if(g)if("body"===t.role){const i=-(t.attribute.x??0)+g.getFrozenColsWidth(),r=-(t.attribute.y??0)+g.getFrozenRowsHeight(),o=t.parent.attribute.width-g.getFrozenColsWidth()-g.getRightFrozenColsWidth(),n=t.parent.attribute.height-g.getFrozenRowsHeight()-g.getBottomFrozenRowsHeight();e.beginPath(),e.rect(i,r,o,n)}else if("row-header"===t.role){const i=0,r=-(t.attribute.y??0)+g.getFrozenRowsHeight(),o=g.getFrozenColsWidth(),n=t.parent.attribute.height-g.getFrozenRowsHeight()-g.getBottomFrozenRowsHeight();e.beginPath(),e.rect(i,r,o,n)}else if("col-header"===t.role){const i=-(t.attribute.x??0)+g.getFrozenColsWidth(),r=0,o=t.parent.attribute.width-g.getFrozenColsWidth()-g.getRightFrozenColsWidth(),n=g.getFrozenRowsHeight();e.beginPath(),e.rect(i,r,o,n)}else if("right-frozen"===t.role){const i=0,r=-(t.attribute.y??0)+g.getFrozenRowsHeight(),o=g.getRightFrozenColsWidth(),n=t.parent.attribute.height-g.getFrozenRowsHeight()-g.getBottomFrozenRowsHeight();e.beginPath(),e.rect(i,r,o,n)}else if("bottom-frozen"===t.role){const i=-(t.attribute.x??0)+g.getFrozenColsWidth(),r=0,o=t.parent.attribute.width-g.getFrozenColsWidth()-g.getRightFrozenColsWidth(),n=g.getBottomFrozenRowsHeight();e.beginPath(),e.rect(i,r,o,n)}else if("corner-header"===t.role){const t=0,i=0,r=g.getFrozenColsWidth(),o=g.getFrozenRowsHeight();e.beginPath(),e.rect(t,i,r,o)}else if("corner-right-top-header"===t.role){const t=0,i=0,r=g.getRightFrozenColsWidth(),o=g.getFrozenRowsHeight();e.beginPath(),e.rect(t,i,r,o)}else if("corner-right-bottom-header"===t.role){const t=0,i=0,r=g.getRightFrozenColsWidth(),o=g.getBottomFrozenRowsHeight();e.beginPath(),e.rect(t,i,r,o)}else if("corner-left-bottom-header"===t.role){const t=0,i=0,r=g.getFrozenColsWidth(),o=g.getBottomFrozenRowsHeight();e.beginPath(),e.rect(t,i,r,o)}}};zM=pM([f()],zM);let OM=class{time=Ri.afterFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d){t.role}};function DM(t,e,i){const r=t.stage.table;if("cell"===t.role){let o=t.col,n=t.row;const s=iv(r,o,n);s&&(o=s.end.col,n=s.end.row),(r&&o===r.colCount-1||r&&o===r.frozenColCount-1&&r.scrollLeft)&&(e-=1),(r&&n===r.rowCount-1||r&&n===r.frozenRowCount-1&&r.scrollTop)&&(i-=1)}else"corner-frozen"===t.role&&(r&&r.scrollLeft&&(e-=1),r&&r.scrollTop&&(i-=1));return{width:e,height:i}}OM=pM([f()],OM);let WM=class{time=Ri.beforeFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){const{stroke:g=l.stroke,strokeArrayWidth:p=l.strokeArrayWidth,strokeArrayColor:f=l.strokeArrayColor}=t.attribute;g&&(Array.isArray(g)||Array.isArray(p)||Array.isArray(f))&&(u.doStroke=!1)}};WM=pM([f()],WM);let NM,GM=class{time=Ri.afterFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d){const{width:u=l.width,height:g=l.height,stroke:p=l.stroke,strokeArrayColor:f=l.strokeArrayColor,strokeArrayWidth:m=l.strokeArrayWidth,lineWidth:b=l.lineWidth,strokeColor:y=l.stroke}=t.attribute;if(p&&(Array.isArray(m)||0!==b)&&(Array.isArray(p)||Array.isArray(f)||Array.isArray(m))){const o=0,n=0;"border-rect"!==t.name&&"table-border-rect"!==t.name&&("number"==typeof b&&1&b||Array.isArray(m)&&m.some((t=>1&t)))&&(i=Math.floor(i)+.5,r=Math.floor(r)+.5),PM(t,e,i,r,l,p,m||b,f||y,Math.ceil(u+o),Math.ceil(g+n))}}};GM=pM([f()],GM);let jM=class{order=1;interceptors;constructor(){this.interceptors=[new VM]}afterDrawItem(t,e,i,r,o){for(let n=0;n<this.interceptors.length;n++)if(this.interceptors[n].afterDrawItem&&this.interceptors[n].afterDrawItem(t,e,i,r,o))return!0;return!1}beforeDrawItem(t,e,i,r,o){if((!t.in3dMode||i.in3dInterceptor)&&!t.shadowRoot&&!(t.baseGraphic||t.attribute.globalZIndex||t.interactiveGraphic))return!1;for(let n=0;n<this.interceptors.length;n++)if(this.interceptors[n].beforeDrawItem&&this.interceptors[n].beforeDrawItem(t,e,i,r,o))return!0;return!1}};jM=pM([f()],jM);class VM{order=1;afterDrawItem(t,e,i,r,o){return"image"===t.type&&this.drawItem(t,e,i,r,o),!1}drawItem(t,e,i,r,o){const{image:n}=t.attribute;if(!n||!t.resources)return!1;if("loading"!==t.resources.get(n).state)return!1;if(!NM){const t=xR(),e=t.loading_pic.svg,i=t.loading_pic.width,r=t.loading_pic.height;NM=Al({width:i,height:r,image:e})}const{image:s}=NM.attribute;if(!n||!NM.resources)return!1;const a=NM.resources.get(s);if("success"!==a.state)return!1;const{context:l}=i;l.highPerformanceSave(),t.parent&&l.setTransformFromMatrix(t.parent.globalTransMatrix,!0),t.glyphHost&&t.glyphHost.parent&&l.setTransformFromMatrix(t.glyphHost.parent.globalTransMatrix,!0);const h=t.AABBBounds,{width:c,height:d}=SR(a.data.width,a.data.height,h.width(),h.height());return l.drawImage(a.data,h.x1+(h.width()-c)/2,h.y1+(h.height()-d)/2,c,d),l.highPerformanceRestore(),!0}}let UM=class{time=Ri.afterFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){const{text:g,underline:p=l.underline,lineThrough:f=l.lineThrough,direction:m=l.direction,whiteSpace:b=l.whiteSpace,fontSize:y=l.fontSize,verticalMode:C=l.verticalMode,ellipsis:w=l.ellipsis,textAlign:v=l.textAlign,textBaseline:x=l.textBaseline,x:_=l.x,y:S=l.y}=t.attribute;let A=!1;if(Array.isArray(t)){const e=t.cache?.layoutData;w&&e&&e.lines.every((t=>""===t.str))&&(A=!0)}else{const{cache:e}=t;w&&e&&""===e.clipedText&&0===e.clipedWidth&&(A=!0)}if(!A)return;const R=tt(w)?w:"...",B=on(t.attribute.lineHeight,y)??y;let M=0;B!==y&&("top"===x?M=(B-y)/2:"middle"===x||"bottom"===x&&(M=-(B-y)/2)),n&&(d?d(e,t.attribute,l):a&&(e.setStrokeStyle(t,t.attribute,_-i,S-r,l),e.strokeText(R,_,S+M))),o&&(c?c(e,t.attribute,l):s&&(e.setCommonStyle(t,t.attribute,_-i,S-r,l),e.fillText(R,_,S+M),this.drawUnderLine(p,f,t,_,S+M,0,l,e,R)))}drawUnderLine(t,e,i,r,o,n,s,a,l){if(e+t<=0)return;const{textAlign:h=s.textAlign,textBaseline:c=s.textBaseline,fontSize:d=s.fontSize,fontFamily:u=s.fontFamily,fontWeight:g=s.fontWeight,fontStyle:p=s.fontStyle,fill:f=s.fill,opacity:m=s.opacity,underlineOffset:b=s.underlineOffset,underlineDash:y=s.underlineDash,fillOpacity:C=s.fillOpacity}=i.attribute;if(!t&&!e)return;const w=DB.measureTextWidth(l,{fontSize:d,fontFamily:u,fontWeight:g,fontStyle:p}),v=qs(h,w),x=Zs(c,d,d),_={lineWidth:0,stroke:f,opacity:m,strokeOpacity:C};if(t){_.lineWidth=t,a.setStrokeStyle(i,_,r,o,s),a.setLineDash(y),a.beginPath();const e=o+x+d+b;a.moveTo(r+v,e,n),a.lineTo(r+v+w,e,n),a.stroke()}if(e){_.lineWidth=e,a.setStrokeStyle(i,_,r,o,s),a.beginPath();const t=o+x+d/2;a.moveTo(r+v,t,n),a.lineTo(r+v+w,t,n),a.stroke()}}};UM=pM([f()],UM);var KM=new i(((t,e,i,r)=>{i(zh)?r(zh).to(WM).inSingletonScope():(t(WM).toSelf().inSingletonScope(),t(Gs).toService(WM)),i(Oh)?r(Oh).to(GM).inSingletonScope():(t(GM).toSelf().inSingletonScope(),t(Gs).toService(GM)),t(SM).toSelf().inSingletonScope(),t(_M).to(SM),t(Zc).to(SM),t(AM).toSelf().inSingletonScope(),t(Ds).toService(AM),t(RM).toSelf().inSingletonScope(),t(Ds).toService(RM),t(FM).toSelf().inSingletonScope(),t(Os).toService(FM),t(IM).toSelf().inSingletonScope(),t(Os).toService(IM),t(TM).toSelf().inSingletonScope(),t(Os).toService(TM),t(MM).toSelf().inSingletonScope(),t(Os).toService(MM),t(HM).toSelf().inSingletonScope(),t(Os).toService(HM),t(EM).toSelf().inSingletonScope(),t(Os).toService(EM),t(kM).toSelf().inSingletonScope(),t(Os).toService(kM),t(LM).toSelf().inSingletonScope(),t(Os).toService(LM),t(zM).toSelf().inSingletonScope(),t(Os).toService(zM),t(OM).toSelf().inSingletonScope(),t(Os).toService(OM),t(jM).toSelf().inSingletonScope(),t(gd).toService(jM),t(UM).toSelf().inSingletonScope(),t(Vs).toService(UM)}));function $M(t,e,i,r){"undefined"!=typeof window&&window.performance.now(),e=e??0,i=i??t.colCount-1,0===e&&i===t.colCount-1&&t._clearColRangeWidthsMap();const o=[],n=[];if(r)for(let e=0;e<t.colCount;e++)o[e]=t.getColWidth(e);for(let o=e;o<=i;o++){let e;if(t.internalProps.transpose||"only-header"!==t.internalProps.layoutMap.columnObjects?.[o]?.columnWidthComputeMode&&"only-header"!==t.columnWidthComputeMode||!("showHeader"in t.internalProps.layoutMap))e=t.internalProps.transpose||"only-body"!==t.internalProps.layoutMap.columnObjects?.[o]?.columnWidthComputeMode&&"only-body"!==t.columnWidthComputeMode?XM(o,0,t.rowCount-1,t):XM(o,t.internalProps.layoutMap.getBodyRange().start.row,t.internalProps.layoutMap.getBodyRange().end.row,t);else{const i=t.internalProps.layoutMap.showHeader;t.internalProps.layoutMap.showHeader=!0,e=XM(o,0,t.internalProps.layoutMap.headerLevelCount-1,t),t.internalProps.layoutMap.showHeader=i}t._setColContentWidth(o,e);t.getColWidth(o)!==e&&t._clearColRangeWidthsMap(o),r?n[o]=Math.round(t._adjustColWidth(o,e)):t._setColWidth(o,t._adjustColWidth(o,e),!1,!0)}if("adaptive"===t.widthMode){t._clearColRangeWidthsMap();const e=t.tableNoFrameWidth;let i=0,o=0,s=t.colCount;if("only-body"===t.widthAdaptiveMode){for(let e=0;e<t.colCount;e++){const o=r?n[e]:t.getColWidth(e);(e<t.rowHeaderLevelCount||t.isPivotChart()&&e>=t.colCount-t.rightFrozenColCount)&&(i+=o)}o=t.rowHeaderLevelCount,s=t.isPivotChart()?t.colCount-t.rightFrozenColCount:t.colCount}QM(e-i,o,s,r,n,t)}else if(t.autoFillWidth){t._clearColRangeWidthsMap();const e=t.tableNoFrameWidth;let i=0,o=0;for(let e=0;e<t.colCount;e++){const s=r?n[e]:t.getColWidth(e);(e<t.rowHeaderLevelCount||t.isPivotChart()&&e>=t.colCount-t.rightFrozenColCount)&&(i+=s),o+=s}if(o<e&&o>i){QM(e-i,t.rowHeaderLevelCount,t.isPivotChart()?t.colCount-t.rightFrozenColCount:t.colCount,r,n,t)}}if(r){for(let e=0;e<t.colCount;e++){const i=n[e]??t.getColWidth(e);i!==o[e]&&t._setColWidth(e,i,!1,!0)}t.stateManager.checkFrozen();for(let e=0;e<t.colCount;e++){const i=t.getColWidth(e);i!==o[e]&&t.scenegraph.updateColWidth(e,i-o[e],!0,!0)}t.scenegraph.updateContainer(!0)}}function XM(t,e,i,r,o=!1){let n=function(t,e){const i=e.getColWidthDefined(t);if(e.internalProps._widthResizedColMap.has(t))return e.getColWidth(t);return i}(t,r);return r.internalProps.transpose&&"auto"===n&&("only-header"===r.columnWidthComputeMode&&t>=r.rowHeaderLevelCount||"only-body"===r.columnWidthComputeMode&&t<r.rowHeaderLevelCount)&&(n=r.getDefaultColumnWidth(t)),o&&!r.internalProps.transpose?YM(n,t,e,i,o,r):"number"==typeof n?n:"auto"!==n&&"string"==typeof n?r._adjustColWidth(t,r._colWidthDefineToPxWidth(n)):YM(n,t,e,i,o,r)}function YM(t,e,i,r,o,n){let s=0,a=1,l=1;if(r-i>5e3&&(l=Math.ceil((r-i)/5e3)),n.isPivotChart()&&e>=n.rowHeaderLevelCount&&e<n.colCount-n.rightFrozenColCount){if(n.internalProps.layoutMap.indicatorsAsCol)return n.defaultColWidth;{const t=n.internalProps.layoutMap.getOptimunWidthForChart(e);if(t>0)return t}}for(let h=i;h<=r;h+=a){if(n.isPivotChart()){const t=n.internalProps.layoutMap,i=wB(e,h,t);if(i){const t=AB(i,n);if("number"==typeof t){s=Math.max(t,s);continue}}else if(t.isLeftBottomCorner(e,h)||t.isRightTopCorner(e,h)||t.isRightBottomCorner(e,h))continue}const i=qM(e,h,n);if(i&&(s=Math.max(i.width,s),!i.renderDefault))continue;const r=t;if("number"==typeof r&&"standard"===n.widthMode&&!o){s=Math.max(r,s);continue}const c=n.isHeader(e,h)?n._getHeaderLayoutMap(e,h)?.headerType:n.getBodyColumnType(e,h);if(Y(c)&&"text"!==c&&"link"!==c&&"progressbar"!==c&&"checkbox"!==c&&"radio"!==c){s=Math.max(s,n.getColWidthDefinedNumber(e)||0);continue}let d=0;const u=n.internalProps.layoutMap;if(u.isHeader(e,h)){const t=u.getHeader(e,h);if("only-body"===t?.define?.columnWidthComputeMode)continue;t?.hierarchyLevel&&(d=(t.hierarchyLevel??0)*(u.rowHierarchyIndent??0))}else{a=l;const t=n.getBodyColumnDefine(e,h);if(t?.tree){const t=n.dataSource.getIndexKey(n.getRecordShowIndexByCell(e,h));d=Array.isArray(t)&&n.getHierarchyState(e,h)!==oC.none?(t.length-1)*(u.hierarchyIndent??0):0}}const g=ZM(e,h,c,n);s=Math.max(g+d,s),a>1&&n.bottomFrozenRowCount>0&&h<n.rowCount-n.bottomFrozenRowCount&&h+a>=n.rowCount-n.bottomFrozenRowCount&&(h=n.rowCount-n.bottomFrozenRowCount-a,a=1,l=1)}const h=n.getMinColWidth(e),c=n.getMaxColWidth(e);return s<h?h:s>c?c:s}function qM(t,e,i){const r=i.getCustomRender(t,e),o=i.getCustomLayout(t,e);if(r||o){let n=1,s=0,a=!1,l=!1;if(i.isHeader(t,e)||i.getBodyColumnDefine(t,e)?.mergeCell||i.hasCustomMerge()){const r=i.getCellRange(t,e);n=r.end.col-r.start.col+1}const h={col:t,row:e,dataValue:i.getCellOriginValue(t,e),value:i.getCellValue(t,e)||"",rect:JM(t,e,i),table:i};if(o){const t=o(h);if(t.rootContainer instanceof hs){t.rootContainer=yR(t.rootContainer),bR(t.rootContainer,0,i.getRowHeight(e));const r=t.rootContainer.attribute.width;t.rootContainer.setStage(i.scenegraph.stage),s=r>0?r:t.rootContainer.AABBBounds.width()??0,a=t.renderDefault,l=t.enableCellPadding}else s=0}else if("function"==typeof r){const t=r(h);s=t?.expectedWidth??0,a=t?.renderDefault}else s=r?.expectedWidth??0,a=r?.renderDefault;if(l){const r=BA(RR("padding",i._getCellStyle(t,e),t,e,i));s+=r[1]+r[3]}return{width:s/n,renderDefault:a}}}function ZM(t,e,i,r){let o=0;const n=r.getCellValue(t,e),s=r._getCellStyle(t,e);let a=0,l=!1;if("body"!==r.getCellLocation(t,e))l=!0;else{const i=r.getBodyColumnDefine(t,e);l=!!i?.icon||!!i?.tree||i?.dragOrder}if(l){const i=r.getCellIcons(t,e);i?.forEach((t=>{t.positionType!==aC.absoluteRight&&(a+=(t.width??0)+(t.marginLeft??0)+(t.marginRight??0))}))}let h=1;if(r.isHeader(t,e)||r.getBodyColumnDefine(t,e)?.mergeCell||r.hasCustomMerge()){const i=r.getCellRange(t,e);h=i.end.col-i.start.col+1}const c=BA(RR("padding",s,t,e,r)),d=c[1]+c[3],u=RR("fontSize",s,t,e,r),g=RR("fontFamily",s,t,e,r),p=RR("fontWeight",s,t,e,r);let f,m;if("checkbox"===i)f=q(n)?n.text:n;else if("radio"===i)if(et(n)){f="";const i=r.getBodyColumnDefine(t,e),o=i?.radioDirectionInCell??"vertical";"vertical"===o?n.forEach((t=>{f+=(q(t)?t.text:t).toString()+"\n"})):"horizontal"===o&&n.forEach((t=>{f+=(q(t)?t.text:t).toString()}))}else f=q(n)?n.text:n;else f=n;if(m=r.internalProps.enableLineBreak||r.options.customConfig?.multilinesForXTable?KC(f).split("\n")||[]:[KC(f)],m.length>=1?m.forEach((t=>{const e=r.measureText(t.slice(0,r.options.maxCharactersNumber||200),{fontSize:u,fontFamily:g,fontWeight:p}).width;o=Math.max((e+d+4+a)/h,o)})):o=Math.max((d+4+a)/h,o),!1!==r.internalProps.limitMaxAutoWidth&&(o=Math.min("number"==typeof r.internalProps.limitMaxAutoWidth?r.internalProps.limitMaxAutoWidth:450,o)),"checkbox"===i){const i=RR("size",s,t,e,r);if(o+=i,f){const i=RR("spaceBetweenTextAndIcon",s,t,e,r);o+=i}}else if("radio"===i){const i=RR("size",s,t,e,r),a=RR("outerRadius",s,t,e,r),l=ot(a)?2*a:i,h=RR("spaceBetweenTextAndIcon",s,t,e,r);if(et(n)){const i=r.getBodyColumnDefine(t,e),a=RR("spaceBetweenRadio",s,t,e,r),c=i?.radioDirectionInCell??"vertical";"vertical"===c?(o+=l,o+=h):"horizontal"===c&&(o+=(l+h)*n.length,o+=a*(n.length-1))}else o+=l,f&&(o+=h)}return o}function JM(t,e,i){return{left:0,top:0,right:i.getColWidth(t),bottom:i.getRowHeight(e),width:null,height:null}}function QM(t,e,i,r,o,n,s){let a=0;const l=[];for(let s=e;s<i;s++){const e=r?o[s]:n.getColWidth(s),i=n.getMaxColWidth(s),h=n.getMinColWidth(s);e!==i&&e!==h?(a+=e,l.push(s)):t-=e}const h=t/a;for(let e=0;e<l.length;e++){const i=l[e];let a;a=e===l.length-1?t-l.reduce(((t,e,s)=>e!==i?t+(r?o[e]:n.getColWidth(e)):t),0):Math.round((r?o[i]:n.getColWidth(i))*h),r?o[i]=n._adjustColWidth(i,a):s?n.scenegraph.setColWidth(i,n._adjustColWidth(i,a)):n._setColWidth(i,n._adjustColWidth(i,a),!1,!0)}}const tT=new _R({});function eT(t,e,i,r,o,n,s,a,l,h){let c,d,u,g=0;t.lastChild&&t.lastChild.row===r-1?g=t.lastChild.attribute.y+t.lastChild.attribute.height:t.colHeight&&(g=t.colHeight);for(let p=r;p<=o;p++){const o=p;let f,m,b,y,C=a.getCellValue(e,o),w=i,v=a.getRowHeight(o);if(a.internalProps.customMergeCell){const t=a.getCustomMerge(e,o);if(t){const{range:e,text:i,style:s,customLayout:l,customRender:h}=t;if(f=e,m=f.start.col!==f.end.col||f.start.row!==f.end.row,m){const t=iT(f,n,a,r>f.start.row);w=t.cellWidth,v=t.cellHeight}C=i,b=s,(l||h)&&(y=fR(l,h,e.start.col,e.start.row,a.getColsWidth(e.start.col,e.end.col),a.getRowsHeight(e.start.row,e.end.row),!1,a.isAutoRowHeight(o),[0,0,0,0],a))}}let x=e,_=o;f&&(x=f.start.col,_=f.start.row);const S="body"!==l?a.getHeaderDefine(x,_):a.getBodyColumnDefine(x,_),A="body"!==l||(S?.dragOrder||!!S?.icon||!!S?.tree);if(!f&&("body"!==l||S?.mergeCell)&&(f=a.getCellRange(e,o),m=f.start.col!==f.end.col||f.start.row!==f.end.row,m)){const t=iT(f,n,a,r>f.start.row);w=t.cellWidth,v=t.cellHeight}const R=cR(b||a._getCellStyle(e,o),a,f?f.start.col:e,f?f.start.row:o,RR).theme;R.group.cornerRadius=uR(e,o,a),R.group.width=i,R.group.height=Array.isArray(s)?s[o]:s,R._vtable.padding&&(c=R._vtable.padding),R.text.textAlign&&(d=R.text.textAlign),R.text.textBaseline&&(u=R.text.textBaseline),"body"===l||R.group.fill||(R.group.fill="#fff");const B=(a.isHeader(e,o)?a._getHeaderLayoutMap(e,o).headerType:a.getBodyColumnType(e,o))||"text";if(cw(C)){rT(e,o,0,g,w,v,t),tB(C,a,oB.bind(null,B,C,S,a,e,o,i,w,v,t,g,c,d,u,A,R,f,y)),t.updateColumnRowNumber(o);const r=a.getRowHeight(o);t.updateColumnHeight(r),g+=r}else{const r=oB(B,C,S,a,e,o,i,w,v,t,g,c,d,u,A,R,f,y);if(t.updateColumnRowNumber(o),m){const i=a.getRowHeight(o);a.getColWidth(e);const{width:n}=r.attribute,{height:s}=r.attribute;r.contentWidth=n,r.contentHeight=s,aB(f,n,s,c,d,u,a),t.updateColumnHeight(i),g+=i}else t.updateColumnHeight(r.attribute.height),g+=r.attribute.height}if(h&&o>h)break}return t.setAttribute("width",i),{width:i,height:g}}function iT(t,e,i,r){let o=0,n=0;const s=e.get(`${t.start.col},${t.start.row};${t.end.col},${t.end.row}`);if(!s||r){for(let e=t.start.col;e<=t.end.col;e++)o+=i.getColWidth(e);for(let e=t.start.row;e<=t.end.row;e++)n+=i.getRowHeight(e);e.set(`${t.start.col},${t.start.row};${t.end.col},${t.end.row}`,{cellWidth:o,cellHeight:n})}else o=s.cellWidth,n=s.cellHeight;return{cellWidth:o,cellHeight:n}}function rT(t,e,i,r,o,n,s){const a=new _R({x:i,y:r,width:o,height:n});a.role="cell",a.col=t,a.row=e,s.addChild(a)}function oT(t,e,i,r,o,n,s,a,l,h){if(r>o||n>s)return;const{layoutMap:c,defaultRowHeight:d,defaultHeaderRowHeight:u,defaultColWidth:g}=l.internalProps;let p=0,f=0;for(let c=r;c<=o;c++){const r=c,o=l.getColWidth(r),g=new _R({x:e+p,y:i,width:o,height:0,clip:!1,pickable:!1});g.role="column",g.col=c,t.addChild(g);const{width:m,height:b}=eT(g,r,o,n,s,l.scenegraph.mergeMap,"columnHeader"===a&&ot(u)?u:d,l,a,h);p+=m,f=Math.max(f,b)}t.setAttribute("width",p),t.setAttribute("height",f)}function nT(t){let e=t.firstChild;for(;"group"!==e.type;)e=e._next;return e}function sT(t){let e=t.lastChild;for(;"group"!==e.type;)e=e._prev;return e}function aT(t,e,i,r="left"){for(let o=t;o<=e;o++){const t=i.scenegraph.getColGroup(o);t&&lT(t,i,r);const e=i.scenegraph.getColGroup(o,!0);e&&lT(e,i,r);const n=i.scenegraph.getColGroupInBottom(o);n&&lT(n,i,r)}const o=Math.min(i.scenegraph.proxy.colLimit,i.scenegraph.proxy.bodyRightCol-i.scenegraph.proxy.bodyLeftCol+1),n=i.getColsWidth(i.frozenColCount,i.frozenColCount+o),s=i.getColsWidth(i.frozenColCount,i.colCount-1);i.scenegraph.proxy.xLimitLeft=n/2,i.scenegraph.proxy.xLimitRight=s-n/2}function lT(t,e,i="left"){if("left"===i){let i;const r=function(t){let e=t._prev;for(;e&&"group"!==e.type;)e=e._prev;return e}(t);i=r?r.attribute.x+e.getColWidth(t._prev.col):e.getColsWidth(e.frozenColCount,t.col-1),t.setAttribute("x",i)}else{let i;const r=function(t){let e=t._next;for(;e&&"group"!==e.type;)e=e._next;return e}(t);i=r?r.attribute.x-e.getColWidth(t.col):e.getColsWidth(e.frozenColCount,t.col-1),t.setAttribute("x",i)}}async function hT(t,e,i){const r=i.table.getTargetColAt(t+i.table.scenegraph.rowHeaderGroup.attribute.width);if(!r)return;const o=r.col,n=r.left;let s;if(i.screenLeftCol=o,s=e?i.bodyRightCol-i.colEnd:i.screenLeftCol-i.referenceCol,function(t,e,i,r,o){t>0?(cT(t,"left",o.screenLeftCol,i,r,o),o.updateDeltaX(r,i,e),o.table.scenegraph.setBodyAndColHeaderX(-r+o.deltaX)):t<0?(cT(-t,"right",o.screenLeftCol,i,r,o),o.updateDeltaX(r,i,e),o.table.scenegraph.setBodyAndColHeaderX(-r+o.deltaX)):(o.updateDeltaX(r,i,e),o.table.scenegraph.setBodyAndColHeaderX(-r+o.deltaX))}(s,o,n,t,i),e){const e=i.table.scenegraph.getColGroup(i.colEnd);if(e){const r=e.attribute.x+e.attribute.width-(i.table.tableNoFrameWidth-i.table.getFrozenColsWidth()-i.table.getRightFrozenColsWidth())-t;i.deltaX=-r,i.table.scenegraph.setBodyAndColHeaderX(-t+i.deltaX)}}i.table.scenegraph.updateNextFrame()}async function cT(t,e,i,r,o,n){if("left"===e&&n.colEnd+t>n.bodyRightCol?t=n.bodyRightCol-n.colEnd:"right"===e&&n.colStart-t<n.bodyLeftCol&&(t=n.colStart-n.bodyLeftCol),0!==t)if(t<0&&(e="left"===e?"right":"left",t=-t),t<n.colEnd-n.colStart){const o="left"===e?n.colStart:n.colEnd-t+1,s="left"===e?n.colStart+t-1:n.colEnd,a="left"===e?n.colEnd+1:n.colStart-t,l="left"===e?n.colEnd+t:n.colStart-1;$M(n.table,a,l),function(t,e,i,r){for(let o=t;o<=e;o++)r.table.scenegraph.bodyGroup.childrenCount>0&&"group"===r.table.scenegraph.bodyGroup.firstChild.type&&gT(r.table.scenegraph.bodyGroup,i,r),r.table.scenegraph.colHeaderGroup.childrenCount>0&&"group"===r.table.scenegraph.colHeaderGroup.firstChild.type&&gT(r.table.scenegraph.colHeaderGroup,i,r),r.table.scenegraph.bottomFrozenGroup.childrenCount>0&&"group"===r.table.scenegraph.bottomFrozenGroup.firstChild.type&&gT(r.table.scenegraph.bottomFrozenGroup,i,r)}(o,s,e,n);const h=a,c=l;n.colStart="left"===e?n.colStart+t:n.colStart-t,n.colEnd="left"===e?n.colEnd+t:n.colEnd-t,pT(h,c,n),aT(h,c,n.table,e);const d=r-((n.table.scenegraph.getColGroup(i)||n.table.scenegraph.getColGroup(i,!0)).attribute.x+n.table.getFrozenColsWidth()+n.table.scenegraph.proxy.deltaX);n.table.scenegraph.proxy.deltaX+=d,n.currentCol="left"===e?n.currentCol+t:n.currentCol-t,n.totalCol=Math.max(0,Math.min(n.table.colCount-1,"left"===e?n.totalCol+t:n.totalCol-t)),n.referenceCol=n.colStart+Math.floor((n.colEnd-n.colStart)/2),n.colUpdatePos=a,n.colUpdateDirection=e,n.table.scenegraph.updateNextFrame()}else{const i="left"===e?n.colStart+t:n.colStart-t,r="left"===e?n.colEnd+t:n.colEnd-t;$M(n.table,i,r);!function(t,e,i,r){r.table.scenegraph.colHeaderGroup.forEachChildren(((o,n)=>{"group"===o.type&&dT(o,"left"===i?o.col+e:o.col-e,0===n?t:o._prev.attribute.x+r.table.getColWidth(o._prev.col))})),r.table.scenegraph.bottomFrozenGroup.forEachChildren(((o,n)=>{"group"===o.type&&dT(o,"left"===i?o.col+e:o.col-e,0===n?t:o._prev.attribute.x+r.table.getColWidth(o._prev.col))})),r.table.scenegraph.bodyGroup.forEachChildren(((o,n)=>{"group"===o.type&&dT(o,"left"===i?o.col+e:o.col-e,0===n?t:o._prev.attribute.x+r.table.getColWidth(o._prev.col))}))}(n.table.getColsWidth(n.bodyLeftCol,i-1),t,e,n);const o=i,s=r;n.colStart=i,n.colEnd=r,pT(o,s,n),aT(o,s,n.table,r>n.bodyRightCol-(n.colEnd-n.colStart+1)?"right":"left"),n.currentCol="left"===e?n.currentCol+t:n.currentCol-t,n.totalCol=Math.max(0,Math.min(n.table.colCount-1,"left"===e?n.totalCol+t:n.totalCol-t)),n.referenceCol=n.colStart+Math.floor((n.colEnd-n.colStart)/2),n.colUpdatePos=n.colStart,n.colUpdateDirection=r>n.bodyRightCol-(n.colEnd-n.colStart+1)?"right":"left",n.table.scenegraph.updateNextFrame()}}function dT(t,e,i){t.col=e,t.forEachChildren((t=>{t.col=e,t.needUpdate=!0})),t.setAttribute("x",i),t.needUpdate=!0}function uT(t,e){if(!t)return;let i=t.firstChild;for(;i;){i=e.updateCellGroupContent(i)._next}t.needUpdate=!1,t.setAttribute("width",e.table.getColWidth(t.col))}function gT(t,e,i){if("left"===e){const e=nT(t),r=sT(t);dT(e,r.col+1,r.attribute.x+i.table.getColWidth(r.col)),t.appendChild(e),t.border&&t.appendChild(t.border)}else{const e=sT(t),r=nT(t);dT(e,r.col-1,r.attribute.x-i.table.getColWidth(r.col-1)),t.insertBefore(e,t.firstChild)}}function pT(t,e,i){for(let r=t;r<=e;r++){const t=i.table.scenegraph.getColGroup(r);t&&uT(t,i);const e=i.table.scenegraph.getColGroup(r,!0);e&&uT(e,i);const o=i.table.scenegraph.getColGroupInBottom(r);o&&uT(o,i);const n=i.table.scenegraph.getColGroupInRightTopCorner(r);n&&uT(n,i);const s=i.table.scenegraph.getColGroupInRightBottomCorner(r);s&&uT(s,i)}}function fT(t,e,i,r,o,n="up",s){if("up"===n)for(let n=t;n<=e;n++)for(let t=i;t<=r;t++){const e=o.scenegraph.highPerformanceGetCell(n,t,!0);if(!e.row)continue;let a;if(e._prev)a=e._prev?.attribute.y+o.getRowHeight(e._prev.row);else if(s){if(a=o.scenegraph.highPerformanceGetCell(n,r+1,!0).attribute.y,Y(a))for(let t=i;t<=r;t++)a-=o.getRowHeight(t)}else a=o.getRowsHeight(o.columnHeaderLevelCount,e.row-1);Y(a)&&e.setAttribute("y",a)}else for(let n=t;n<=e;n++)for(let t=r;t>=i;t--){const e=o.scenegraph.highPerformanceGetCell(n,t,!0);if(!e.row)continue;let a;if(e._next)a=e._next?.attribute.y-o.getRowHeight(e.row);else if(s){a=o.scenegraph.highPerformanceGetCell(n,i-1,!0).attribute.y;for(let t=i-1;t<r;t++)a+=o.getRowHeight(t)}else a=o.getRowsHeight(o.columnHeaderLevelCount,e.row-1);e.setAttribute("y",a)}const a=Math.min(o.scenegraph.proxy.rowLimit,o.scenegraph.proxy.bodyBottomRow-o.scenegraph.proxy.bodyTopRow+1),l=o.getRowsHeight(o.columnHeaderLevelCount,o.columnHeaderLevelCount+a),h=o.getRowsHeight(o.columnHeaderLevelCount,o.rowCount-1);o.scenegraph.proxy.yLimitTop=l/2,o.scenegraph.proxy.yLimitBottom=h-l/2}async function mT(t,e,i){const r=i.table.getTargetRowAt(t+i.table.scenegraph.colHeaderGroup.attribute.height);if(!r)return;const o=r.row,n=r.top;let s;if(i.screenTopRow=o,s=e?i.bodyBottomRow-i.rowEnd:o-i.referenceRow,function(t,e,i,r,o){t>0?(bT(t,"up",e,i,r,o),o.updateDeltaY(r,i,e),o.updateBody(r-o.deltaY)):t<0?(bT(-t,"down",e,i,r,o),o.updateDeltaY(r,i,e),o.updateBody(r-o.deltaY)):(o.updateDeltaY(r,i,e),o.updateBody(r-o.deltaY))}(s,o,n,t,i),e){const e=i.table.scenegraph.highPerformanceGetCell(i.colStart,i.rowEnd,!0);if("cell"===e.role){const r=e.attribute.y+e.attribute.height-(i.table.tableNoFrameHeight-i.table.getFrozenRowsHeight()-i.table.getBottomFrozenRowsHeight())-t;i.deltaY=-r,i.updateBody(t-i.deltaY)}}}async function bT(t,e,i,r,o,n){if("up"===e&&n.rowEnd+t>n.bodyBottomRow?t=n.bodyBottomRow-n.rowEnd:"down"===e&&n.rowStart-t<n.bodyTopRow&&(t=n.rowStart-n.bodyTopRow),0!==t)if(t<0&&(e="up"===e?"down":"up",t=-t),t<n.rowEnd-n.rowStart){const r="up"===e?n.rowStart:n.rowEnd-t+1,o="up"===e?n.rowStart+t-1:n.rowEnd,s="up"===e?n.rowEnd+1:n.rowStart-t,a="up"===e?n.rowEnd+t:n.rowStart-1;let l,h;if("autoHeight"===n.table.heightMode)l=s,h=a;else{l=Math.max(n.bodyTopRow,i-1*n.screenRowCount),h=Math.min(n.bodyBottomRow,i+2*n.screenRowCount)}jB(n.table,l,h,!1),function(t,e,i,r){for(let o=0;o<r.table.frozenColCount;o++){const n=r.table.scenegraph.getColGroup(o);if(n)for(let o=t;o<=e;o++)yT(n,i,r)}for(let o=r.table.colCount-r.table.rightFrozenColCount;o<r.table.colCount;o++){const n=r.table.scenegraph.getColGroup(o);if(n)for(let o=t;o<=e;o++)yT(n,i,r)}for(let o=r.bodyLeftCol;o<=r.bodyRightCol;o++){const n=r.table.scenegraph.getColGroup(o);if(n)for(let o=t;o<=e;o++)yT(n,i,r)}}(r,o,e,n),n.rowStart="up"===e?n.rowStart+t:n.rowStart-t,n.rowEnd="up"===e?n.rowEnd+t:n.rowEnd-t,CT(l,h,n),"autoHeight"===n.table.heightMode&&(fT(n.bodyLeftCol,n.bodyRightCol,l,h,n.table,a>n.bodyBottomRow-(n.rowEnd-n.rowStart+1)?"down":"up",!0),fT(0,n.table.frozenColCount-1,l,h,n.table,a>n.bodyBottomRow-(n.rowEnd-n.rowStart+1)?"down":"up",!0),fT(n.table.colCount-n.table.rightFrozenColCount,n.table.colCount-1,l,h,n.table,a>n.bodyBottomRow-(n.rowEnd-n.rowStart+1)?"down":"up",!0)),n.currentRow="up"===e?n.currentRow+t:n.currentRow-t,n.totalRow=Math.max(0,Math.min(n.bodyBottomRow,"up"===e?n.totalRow+t:n.totalRow-t)),n.referenceRow=n.rowStart+Math.floor((n.rowEnd-n.rowStart)/2),"autoHeight"===n.table.heightMode?n.rowUpdatePos=Math.min(n.rowUpdatePos,n.rowEnd+1):n.rowUpdatePos=Math.min(n.rowUpdatePos,s),n.rowUpdateDirection=e,n.table.scenegraph.updateNextFrame(),"autoHeight"!==n.table.heightMode&&await n.progress()}else{const r="up"===e?n.rowStart+t:n.rowStart-t,o="up"===e?n.rowEnd+t:n.rowEnd-t,s=n.table.getRowsHeight(n.bodyTopRow,r-1);let a,l;"autoHeight"===n.table.heightMode?(a=r,l=o):(a=Math.max(n.bodyTopRow,i-1*n.screenRowCount),l=Math.min(n.bodyBottomRow,i+2*n.screenRowCount)),jB(n.table,a,l,!1),function(t,e,i,r){for(let o=0;o<r.table.frozenColCount;o++){const n=r.table.scenegraph.getColGroup(o);n?.forEachChildren(((o,n)=>{r.updateCellGroupPosition(o,"up"===i?o.row+e:o.row-e,0===n?t:o._prev.attribute.y+r.table.getRowHeight(o._prev.row))}))}for(let o=r.table.colCount-r.table.rightFrozenColCount;o<r.table.colCount;o++){const n=r.table.scenegraph.getColGroup(o);n?.forEachChildren(((o,n)=>{r.updateCellGroupPosition(o,"up"===i?o.row+e:o.row-e,0===n?t:o._prev.attribute.y+r.table.getRowHeight(o._prev.row))}))}for(let o=r.bodyLeftCol;o<=r.bodyRightCol;o++){const n=r.table.scenegraph.getColGroup(o);n?.forEachChildren(((o,n)=>{r.updateCellGroupPosition(o,"up"===i?o.row+e:o.row-e,0===n?t:o._prev.attribute.y+r.table.getRowHeight(o._prev.row))}))}}(s,t,e,n),n.rowStart=r,n.rowEnd=o,CT(a,l,n),"autoHeight"===n.table.heightMode&&(fT(n.bodyLeftCol,n.bodyRightCol,a,l,n.table,o>n.bodyBottomRow-(n.rowEnd-n.rowStart+1)?"down":"up"),fT(0,n.table.frozenColCount-1,a,l,n.table,o>n.bodyBottomRow-(n.rowEnd-n.rowStart+1)?"down":"up"),fT(n.table.colCount-n.table.rightFrozenColCount,n.table.colCount-1,a,l,n.table,o>n.bodyBottomRow-(n.rowEnd-n.rowStart+1)?"down":"up")),n.currentRow="up"===e?n.currentRow+t:n.currentRow-t,n.totalRow=Math.max(0,Math.min(n.bodyBottomRow,"up"===e?n.totalRow+t:n.totalRow-t)),n.referenceRow=n.rowStart+Math.floor((n.rowEnd-n.rowStart)/2),"autoHeight"===n.table.heightMode?n.rowUpdatePos=n.rowEnd+1:n.rowUpdatePos=n.rowStart,n.rowUpdateDirection=o>n.bodyBottomRow-(n.rowEnd-n.rowStart+1)?"down":"up",n.table.scenegraph.updateNextFrame(),"autoHeight"!==n.table.heightMode&&await n.progress()}}function yT(t,e,i){if(t.childrenCount>=1)if("up"===e){const e=t.firstChild;i.updateCellGroupPosition(e,t.lastChild.row+1,t.lastChild.attribute.y+i.table.getRowHeight(t.lastChild.row)),t.appendChild(e)}else{const e=t.lastChild;i.updateCellGroupPosition(e,t.firstChild.row-1,t.firstChild.attribute.y-i.table.getRowHeight(e.row)),t.insertBefore(e,t.firstChild)}}function CT(t,e,i){for(let r=0;r<i.table.frozenColCount;r++)for(let o=t;o<=e;o++){const t=i.highPerformanceGetCell(r,o,!0);i.updateCellGroupContent(t)}for(let r=i.table.colCount-i.table.rightFrozenColCount;r<i.table.colCount;r++)for(let o=t;o<=e;o++){const t=i.highPerformanceGetCell(r,o);i.updateCellGroupContent(t)}for(let r=i.bodyLeftCol;r<=i.bodyRightCol;r++)for(let o=t;o<=e;o++){const t=i.highPerformanceGetCell(r,o);i.updateCellGroupContent(t)}i.table.scenegraph.updateNextFrame()}function wT(t){const{changedCells:e}=t.internalProps.stick;e.forEach((e=>{t.scenegraph.getCell(e.col,e.row).forEachChildren((t=>{t.setAttributes({dx:e.dx,dy:e.dy})}))})),e.clear();const{scrollTop:i,scrollLeft:r,frozenRowCount:o,frozenColCount:n}=t,s=t.getFrozenRowsHeight(),a=t.getFrozenColsWidth(),{row:l}=t.getRowAt(i+s+1),{col:h}=t.getColAt(r+a+1),c=Math.max(l,t.frozenRowCount),d=Math.max(h,t.frozenColCount),u=t.getAllRowsHeight()>t.tableNoFrameHeight?t.getRowAt(i+t.tableNoFrameHeight-t.getBottomFrozenRowsHeight()-1).row:t.rowCount-t.bottomFrozenRowCount-1,g=t.getAllColsWidth()>t.tableNoFrameWidth?t.getColAt(r+t.tableNoFrameWidth-t.getRightFrozenColsWidth()-1).col:t.colCount-t.rightFrozenColCount-1;if(!(g<0||u<0)){for(let i=0;i<o&&!(g<d);i++)[d,g].forEach((r=>{const o=t._getCellStyle(r,i);if(o?.textStick){_T(t.scenegraph.getCell(r,i),a+t.tableX,t.tableNoFrameWidth-t.getRightFrozenColsWidth()+t.tableX,e,o?.textStickBaseOnAlign,t)}}));for(let i=0;i<n&&!(u<c);i++)[c,u].forEach((r=>{const o=t._getCellStyle(i,r);if(o?.textStick&&"tree"!==t.internalProps.layoutMap.rowHierarchyType){vT(t.scenegraph.getCell(i,r),s+t.tableY,t.tableNoFrameHeight-t.getBottomFrozenRowsHeight()+t.tableY,e,o?.textStickBaseOnAlign,t)}}));for(let i=d;i<=g&&!(u<c);i++)[c,u].forEach((r=>{const o=t._getCellStyle(i,r);if(o?.textStick){vT(t.scenegraph.getCell(i,r),s+t.tableY,t.tableNoFrameHeight-t.getBottomFrozenRowsHeight()+t.tableY,e,o?.textStickBaseOnAlign,t)}}));for(let i=c;i<u&&!(g<d);i++)[d,g].forEach((r=>{const o=t._getCellStyle(r,i);if(t._getCellStyle(r,i)?.textStick){_T(t.scenegraph.getCell(r,i),a+t.tableX,t.tableNoFrameWidth-t.getRightFrozenColsWidth()+t.tableX,e,o?.textStickBaseOnAlign,t)}}))}}function vT(t,e,i,r,o,n){if(ot(t.mergeStartCol)&&ot(t.mergeStartRow)&&ot(t.mergeEndCol)&&ot(t.mergeEndRow)){const{colStart:s,colEnd:a,rowStart:l,rowEnd:h}=qB(t,n.scenegraph);for(let t=s;t<=a;t++)for(let s=l;s<=h;s++){xT(n.scenegraph.getCell(t,s),e,i,r,o)}}else xT(t,e,i,r,o)}function xT(t,e,i,r,o){const n=t.getChildByName("text",!0)||t.getChildByName("image",!0);if(!n)return;if("image"===n.type){const{image:t}=n.attribute;if(!t||!n.resources)return;if("success"!==n.resources.get(t).state)return}const s=n.textBaseline??"top";n.AABBBounds.width();const a=n.globalAABBBounds.y1,l=n.globalAABBBounds.y2;if("middle"===s&&o){const o=t.globalAABBBounds.y1+(t.firstChild?.attribute.dy??0),s=o+(t.contentHeight??t.attribute.height??0);if(o<e||s>i){const a=Math.max(o,e),l=Math.min(s,i),h=n.globalTransMatrix.f-(l+a)/2;!r.has(`${t.col}-${t.row}`)&&r.set(`${t.col}-${t.row}`,{col:t.col,row:t.row,dx:t.firstChild?.attribute.dx??0,dy:t.firstChild?.attribute.dy??0}),t.forEachChildren((t=>{t.setAttribute("dy",(t.attribute.dy??0)-h+2)}))}}else if(a<e){const i=a-e;!r.has(`${t.col}-${t.row}`)&&r.set(`${t.col}-${t.row}`,{col:t.col,row:t.row,dx:t.firstChild?.attribute.dx??0,dy:t.firstChild?.attribute.dy??0}),t.forEachChildren((t=>{t.setAttribute("dy",(t.attribute.dy??0)-i+2)}))}else if(l>i){const e=l-i;!r.has(`${t.col}-${t.row}`)&&r.set(`${t.col}-${t.row}`,{col:t.col,row:t.row,dx:t.firstChild?.attribute.dx??0,dy:t.firstChild?.attribute.dy??0}),t.forEachChildren((t=>{t.setAttribute("dy",(t.attribute.dy??0)-e)}))}}function _T(t,e,i,r,o,n){if(ot(t.mergeStartCol)&&ot(t.mergeStartRow)&&ot(t.mergeEndCol)&&ot(t.mergeEndRow)){const{colStart:s,colEnd:a,rowStart:l,rowEnd:h}=qB(t,n.scenegraph);for(let t=s;t<=a;t++)for(let s=l;s<=h;s++){ST(n.scenegraph.getCell(t,s),e,i,r,o)}}else ST(t,e,i,r,o)}function ST(t,e,i,r,o){const n=t.getChildByName("text",!0)||t.getChildByName("image",!0);if(!n)return;if("image"===n.type){const{image:t}=n.attribute;if(!t||!n.resources)return;if("success"!==n.resources.get(t).state)return}const s=n.attribute.textAlign??n.textAlign??"left";n.AABBBounds.width();const a=n.globalAABBBounds.x1,l=n.globalAABBBounds.x2;if("center"===s&&o){const o=t.globalAABBBounds.x1+(t.firstChild?.attribute.dx??0),s=o+(t.contentWidth??t.attribute.width??0);if(o<e||s>i){const a=Math.max(o,e),l=Math.min(s,i),h=n.globalTransMatrix.e-(l+a)/2;!r.has(`${t.col}-${t.row}`)&&r.set(`${t.col}-${t.row}`,{col:t.col,row:t.row,dx:t.firstChild?.attribute.dx??0,dy:t.firstChild?.attribute.dy??0}),t.forEachChildren((t=>{t.setAttribute("dx",(t.attribute.dx??0)-h+2)}))}}else if(a<e){const i=a-e;!r.has(`${t.col}-${t.row}`)&&r.set(`${t.col}-${t.row}`,{col:t.col,row:t.row,dx:t.firstChild?.attribute.dx??0,dy:t.firstChild?.attribute.dy??0}),t.forEachChildren((t=>{t.setAttribute("dx",(t.attribute.dx??0)-i+2)}))}else if(l>i){const e=l-i;!r.has(`${t.col}-${t.row}`)&&r.set(`${t.col}-${t.row}`,{col:t.col,row:t.row,dx:t.firstChild?.attribute.dx??0,dy:t.firstChild?.attribute.dy??0}),t.forEachChildren((t=>{t.setAttribute("dx",(t.attribute.dx??0)-e)}))}}function AT(t){const e=t.internalProps.layoutMap.headerObjects,i=t.internalProps.layoutMap.columnObjects;for(let t=0;t<e.length;t++){const i=e[t];if(i&&i.style?.textStick)return!0}for(let t=0;t<i.length;t++){const e=i[t];if(e&&e.style?.textStick)return!0}return!!(t.theme.headerStyle.textStick||t.theme.rowHeaderStyle.textStick||t.theme.bodyStyle.textStick)}tT.role="empty";class RT{table;isRelease=!1;mode="column";isProgressing;rowLimit=200;currentRow=0;totalRow;yLimitTop;yLimitBottom;rowStart=0;rowEnd=0;referenceRow=0;bodyTopRow;bodyBottomRow;screenRowCount;firstScreenRowLimit;taskRowCount;rowUpdatePos;rowUpdateDirection;screenTopRow=0;totalActualBodyRowCount;deltaY=0;deltaHeight=0;colLimit=100;bodyRightCol;totalCol;colStart;colEnd;taskColCount;xLimitLeft;xLimitRight;screenColCount;firstScreenColLimit;colUpdatePos;currentCol;referenceCol;screenLeftCol=0;colUpdateDirection;totalActualBodyColCount;deltaX=0;deltaWidth=0;cellCache=new Map;constructor(t){this.table=t,this.table.isPivotChart()?(this.rowLimit=100,this.colLimit=100):"autoHeight"===this.table.heightMode?this.rowLimit=100:"autoWidth"===this.table.widthMode&&(this.colLimit=100),this.table.internalProps.transpose?this.mode="row":this.table.isPivotTable()&&(this.mode="pivot"),this.table.options.maintainedDataCount&&(this.rowLimit=this.table.options.maintainedDataCount)}get bodyLeftCol(){return this.table.frozenColCount}setParamsForColumn(){this.bodyRightCol=this.table.colCount-1-this.table.rightFrozenColCount;const t=Math.min(this.colLimit,this.bodyRightCol-this.bodyLeftCol+1);this.totalActualBodyColCount=t,this.totalCol=this.bodyLeftCol+t-1,this.colStart=this.bodyLeftCol;const e=this.table.defaultColWidth;this.taskColCount=1*Math.ceil(this.table.tableNoFrameWidth/e);const i=e*t,r=e*(this.bodyRightCol-this.bodyLeftCol+1);this.xLimitLeft=i/2,this.xLimitRight=r-i/2;const o=5*this.table.tableNoFrameWidth;this.screenColCount=Math.ceil(this.table.tableNoFrameWidth/e),this.firstScreenColLimit=Math.max(15,this.bodyLeftCol+Math.min(this.colLimit,Math.ceil(o/e))),this.colUpdatePos=this.bodyRightCol}setParamsForRow(){this.bodyTopRow=this.table.columnHeaderLevelCount,this.bodyBottomRow=this.table.rowCount-1-this.table.bottomFrozenRowCount;const t=Math.min(this.rowLimit,this.bodyBottomRow-this.bodyTopRow+1);this.totalActualBodyRowCount=t,this.totalRow=this.bodyTopRow+t-1,this.rowStart=this.bodyTopRow;const e=this.table.defaultRowHeight;this.taskRowCount=1*Math.ceil(this.table.tableNoFrameHeight/e);const i=e*t,r=e*(this.bodyBottomRow-this.bodyTopRow+1);this.yLimitTop=i/2,this.yLimitBottom=r-i/2;const o=5*this.table.tableNoFrameHeight;this.screenRowCount=Math.ceil(this.table.tableNoFrameHeight/e),this.firstScreenRowLimit=Math.max(30,this.bodyTopRow+Math.min(this.rowLimit,Math.ceil(o/e))),this.rowUpdatePos=this.bodyBottomRow}resize(){const t=this.table.defaultColWidth;this.taskColCount=1*Math.ceil(this.table.tableNoFrameWidth/t);const e=5*this.table.tableNoFrameWidth;this.screenColCount=Math.ceil(this.table.tableNoFrameWidth/t),this.firstScreenColLimit=this.bodyLeftCol+Math.min(this.colLimit,Math.ceil(e/t));const i=this.table.defaultRowHeight;this.taskRowCount=1*Math.ceil(this.table.tableNoFrameHeight/i);const r=5*this.table.tableNoFrameHeight;this.screenRowCount=Math.ceil(this.table.tableNoFrameHeight/i),this.firstScreenRowLimit=this.bodyTopRow+Math.min(this.rowLimit,Math.ceil(r/i))}createGroupForFirstScreen(t,e,i,r,o,n,s,a){!function(t,e,i,r,o,n,s,a,l){const{table:h}=l,{leftBottomCornerGroup:c,rightTopCornerGroup:d,rightBottomCornerGroup:u}=h.scenegraph;let g,p;l.setParamsForRow(),l.setParamsForColumn(),g="adaptive"===h.widthMode||h.options.autoWrapText&&("adaptive"===h.heightMode||"autoHeight"===h.heightMode)?h.colCount-1:Math.min(l.firstScreenColLimit,h.colCount-1),p="adaptive"===h.heightMode?h.rowCount-1:Math.min(l.firstScreenRowLimit,h.rowCount-1),0===h.internalProps._widthResizedColMap.size&&$M(h,0,g),0===h.internalProps._heightResizedRowMap.size&&jB(h,0,p),g<h.colCount-h.rightFrozenColCount&&$M(h,h.colCount-h.rightFrozenColCount,h.colCount-1),p<h.rowCount-h.bottomFrozenRowCount&&jB(h,h.rowCount-h.bottomFrozenRowCount,h.rowCount-1),h.scenegraph.colHeaderGroup.setAttribute("x",h.getFrozenColsWidth()),h.scenegraph.rowHeaderGroup.setAttribute("y",h.getFrozenRowsHeight()),h.scenegraph.bottomFrozenGroup.setAttribute("x",h.getFrozenColsWidth()),h.scenegraph.rightFrozenGroup.setAttribute("y",h.getFrozenRowsHeight()),h.scenegraph.bodyGroup.setAttributes({x:h.getFrozenColsWidth(),y:h.getFrozenRowsHeight()}),oT(t,s,a,0,h.frozenColCount-1,0,h.columnHeaderLevelCount-1,h.isListTable()?"columnHeader":"cornerHeader",h),g-h.rightFrozenColCount>=h.frozenColCount&&oT(e,s,a,h.frozenColCount,g-h.rightFrozenColCount,0,h.columnHeaderLevelCount-1,"columnHeader",h),h.frozenColCount>0&&(h.leftRowSeriesNumberCount>0&&oT(i,s,a,0,h.leftRowSeriesNumberCount-1,h.columnHeaderLevelCount,p-h.bottomFrozenRowCount,"rowHeader",h),h.rowHeaderLevelCount>0&&oT(i,s,a,h.leftRowSeriesNumberCount,h.leftRowSeriesNumberCount+h.rowHeaderLevelCount-1,h.columnHeaderLevelCount,p-h.bottomFrozenRowCount,"rowHeader",h),h.frozenColCount>h.rowHeaderLevelCount+h.leftRowSeriesNumberCount&&oT(i,s,a,h.rowHeaderLevelCount+h.leftRowSeriesNumberCount,h.frozenColCount-1,h.columnHeaderLevelCount,p-h.bottomFrozenRowCount,"body",h)),h.bottomFrozenRowCount>0&&(h.frozenColCount>0&&(h.leftRowSeriesNumberCount>0&&oT(c,s,a,0,h.leftRowSeriesNumberCount-1,h.rowCount-1-h.bottomFrozenRowCount+1,h.rowCount-1,"rowHeader",h),h.rowHeaderLevelCount>0&&oT(c,s,a,h.leftRowSeriesNumberCount,h.leftRowSeriesNumberCount+h.rowHeaderLevelCount-1,h.rowCount-1-h.bottomFrozenRowCount+1,h.rowCount-1,"rowHeader",h),h.frozenColCount>h.rowHeaderLevelCount+h.leftRowSeriesNumberCount&&oT(c,s,a,h.rowHeaderLevelCount+h.leftRowSeriesNumberCount,h.frozenColCount-1,h.rowCount-1-h.bottomFrozenRowCount+1,h.rowCount-1,"body",h)),g-h.rightFrozenColCount>=h.frozenColCount&&oT(o,s,a,h.frozenColCount,g-h.rightFrozenColCount,h.rowCount-1-h.bottomFrozenRowCount+1,h.rowCount-1,h.isPivotChart()?"rowHeader":"body",h)),h.rightFrozenColCount>0&&(oT(d,s,a,h.colCount-1-h.rightFrozenColCount+1,h.colCount-1,0,h.columnHeaderLevelCount-1,"columnHeader",h),oT(r,s,a,h.colCount-1-h.rightFrozenColCount+1,h.colCount-1,h.columnHeaderLevelCount,p-h.bottomFrozenRowCount,h.isPivotChart()?"rowHeader":"body",h)),h.bottomFrozenRowCount>0&&h.rightFrozenColCount>0&&oT(u,s,a,h.colCount-1-h.rightFrozenColCount+1,h.colCount-1,h.rowCount-1-h.bottomFrozenRowCount+1,h.rowCount-1,"body",h),g-h.rightFrozenColCount>=h.frozenColCount&&oT(n,s,a,h.frozenColCount,g-h.rightFrozenColCount,h.columnHeaderLevelCount,p-h.bottomFrozenRowCount,"body",h),n.firstChild||e.firstChild||t.firstChild||i.firstChild?(l.currentRow=n.firstChild?.rowNumber??i.firstChild?.rowNumber??l.totalRow,l.rowEnd=l.currentRow,l.rowUpdatePos=l.rowEnd+1,l.referenceRow=l.rowStart+Math.floor((l.rowEnd-l.rowStart)/2),l.currentCol=n.lastChild?.col??e.lastChild?.col??i.lastChild?.col??t.lastChild?.col??l.totalCol,l.colEnd=l.currentCol,l.colUpdatePos=l.colEnd+1,l.referenceCol=l.colStart+Math.floor((l.colEnd-l.colStart)/2),l.progress()):(l.currentRow=l.totalRow,l.rowEnd=l.currentRow,l.rowUpdatePos=l.rowEnd+1,l.referenceRow=l.rowStart+Math.floor((l.rowEnd-l.rowStart)/2),l.currentCol=l.totalCol,l.colEnd=l.currentCol,l.colUpdatePos=l.colEnd+1,l.referenceCol=l.colStart+Math.floor((l.colEnd-l.colStart)/2))}(t,e,i,r,o,n,s,a,this)}async progress(){if(!this.isProgressing)return this.isProgressing=!0,new Promise(((t,e)=>{setTimeout((async()=>{this.isProgressing=!1,this.isRelease||(this.colUpdatePos<=this.colEnd?(await this.updateColCellGroupsAsync(),await this.progress()):this.rowUpdatePos<=this.rowEnd?(await this.updateRowCellGroupsAsync(),await this.progress()):this.currentCol<this.totalCol?(await this.createCol(),await this.progress()):this.currentRow<this.totalRow&&(await this.createRow(),await this.progress()),wT(this.table),this.table.scenegraph.updateNextFrame(),t())}),16)}))}async createRow(){this.taskRowCount&&this.createRowCellGroup(this.taskRowCount)}async createCol(){this.taskColCount&&this.createColGroup(this.taskRowCount)}createRowCellGroup(t){const e=Math.min(this.totalRow,this.currentRow+t);if(jB(this.table,this.currentRow+1,e,!1),this.table.frozenColCount){let t=0;for(let i=0;i<this.table.frozenColCount;i++){const r=this.table.scenegraph.getColGroup(i),o=this.table.isListTable()?"body":"rowHeader",{height:n}=eT(r,i,r.attribute.width,this.currentRow+1,e,this.table.scenegraph.mergeMap,this.table.internalProps.defaultRowHeight,this.table,o);t=Math.max(t,n),this.table.scenegraph.rowHeaderGroup.setAttribute("height",t)}}if(this.table.rightFrozenColCount){let t=0;for(let i=this.table.colCount-this.table.rightFrozenColCount;i<this.table.colCount;i++){const r=this.table.scenegraph.getColGroup(i),o=this.table.isPivotChart()?"rowHeader":"body",{height:n}=eT(r,i,r.attribute.width,this.currentRow+1,e,this.table.scenegraph.mergeMap,this.table.internalProps.defaultRowHeight,this.table,o);t=Math.max(t,n),this.table.scenegraph.rightFrozenGroup.setAttribute("height",t)}}let i=0;for(let t=this.bodyLeftCol;t<=this.bodyRightCol;t++){const r=this.table.scenegraph.getColGroup(t);if(!r)continue;const o=t<this.table.rowHeaderLevelCount?"rowHeader":"body",{height:n}=eT(r,t,r.attribute.width,this.currentRow+1,e,this.table.scenegraph.mergeMap,this.table.internalProps.defaultRowHeight,this.table,o);i=Math.max(i,n)}this.table.scenegraph.bodyGroup.setAttribute("height",i),this.currentRow=e,this.rowEnd=e,this.rowUpdatePos=this.rowEnd,this.table.scenegraph.updateContainer(),this.table.scenegraph.updateBorderSizeAndPosition()}createColGroup(t){const e=Math.min(this.totalCol,this.currentCol+t);$M(this.table,this.currentCol+1,e);for(let t=0;t<this.table.rowCount;t++){const e=this.highPerformanceGetCell(this.currentCol,t);"cell"===e.role&&ot(e.mergeStartCol)&&e.mergeStartCol>this.currentCol&&this.table.scenegraph.updateCellContent(e.col,e.row)}if(this.table.columnHeaderLevelCount){const t=this.table.scenegraph.colHeaderGroup.lastChild instanceof _R?this.table.scenegraph.colHeaderGroup.lastChild:this.table.scenegraph.colHeaderGroup.lastChild._prev,i=t.attribute.x+t.attribute.width,r=t.attribute.y;oT(this.table.scenegraph.colHeaderGroup,i,r,this.currentCol+1,e,0,this.table.columnHeaderLevelCount-1,"columnHeader",this.table)}if(this.table.bottomFrozenRowCount){const t=this.table.scenegraph.bottomFrozenGroup.lastChild instanceof _R?this.table.scenegraph.bottomFrozenGroup.lastChild:this.table.scenegraph.bottomFrozenGroup.lastChild._prev,i=t.attribute.x+t.attribute.width,r=t.attribute.y;oT(this.table.scenegraph.bottomFrozenGroup,i,r,this.currentCol+1,e,this.table.rowCount-this.table.bottomFrozenRowCount,this.table.rowCount-1,"columnHeader",this.table)}let i=this.table.scenegraph.bodyGroup.lastChild&&(this.table.scenegraph.bodyGroup.lastChild instanceof _R?this.table.scenegraph.bodyGroup.lastChild:this.table.scenegraph.bodyGroup.lastChild._prev);i||(i=this.table.scenegraph.colHeaderGroup.lastChild&&(this.table.scenegraph.colHeaderGroup.lastChild instanceof _R?this.table.scenegraph.colHeaderGroup.lastChild:this.table.scenegraph.colHeaderGroup.lastChild._prev));const r=i.attribute.x+i.attribute.width,o=i.attribute.y;oT(this.table.scenegraph.bodyGroup,r,o,this.currentCol+1,e,this.rowStart,this.rowEnd,"body",this.table),this.currentCol=e,this.colEnd=e,this.colUpdatePos=this.colEnd,this.table.scenegraph.updateContainer(),this.table.scenegraph.updateBorderSizeAndPosition()}async setY(t,e=!1){const i=this.table.getRowsHeight(this.bodyTopRow,this.bodyTopRow+(this.rowEnd-this.rowStart+1))/2,r=this.table.getAllRowsHeight()-i;t<i&&this.rowStart===this.bodyTopRow||t>r&&this.rowEnd===this.bodyBottomRow?(this.updateDeltaY(t),this.updateBody(t-this.deltaY)):this.table.scenegraph.bodyGroup.firstChild&&0!==this.table.scenegraph.bodyGroup.firstChild.childrenCount||this.table.scenegraph.rowHeaderGroup.firstChild&&0!==this.table.scenegraph.rowHeaderGroup.firstChild.childrenCount?this.dynamicSetY(t,e):(this.updateDeltaY(t),this.updateBody(t-this.deltaY))}async setX(t,e=!1){const i=this.table.getColsWidth(this.bodyLeftCol,this.bodyLeftCol+(this.colEnd-this.colStart+1))/2,r=this.table.getAllColsWidth()-i;t<i&&this.colStart===this.bodyLeftCol||t>r&&this.colEnd===this.bodyRightCol||this.table.scenegraph.bodyGroup.firstChild&&0===this.table.scenegraph.bodyGroup.firstChild.childrenCount?(this.updateDeltaX(t),this.table.scenegraph.setBodyAndColHeaderX(-t+this.deltaX)):this.dynamicSetX(t,e)}async dynamicSetY(t,e=!1){mT(t,e,this)}async dynamicSetX(t,e=!1){hT(t,e,this)}updateBody(t){this.table.scenegraph.setBodyAndRowHeaderY(-t)}async updateRowCellGroupsAsync(){this.updateCellGroups(this.taskRowCount)}updateCellGroups(t){const e=Math.min(this.bodyBottomRow,this.rowUpdatePos+t);"autoHeight"===this.table.heightMode&&jB(this.table,this.rowUpdatePos,e,!1),CT(this.rowUpdatePos,e,this),"autoHeight"===this.table.heightMode&&(fT(this.bodyLeftCol,this.bodyRightCol,this.rowUpdatePos,e,this.table,this.rowUpdateDirection,!0),fT(0,this.table.frozenColCount-1,this.rowUpdatePos,e,this.table,this.rowUpdateDirection,!0),fT(this.table.colCount-this.table.rightFrozenColCount,this.table.colCount-1,this.rowUpdatePos,e,this.table,this.rowUpdateDirection,!0)),this.rowUpdatePos=e+1}updateBottomFrozenCellGroups(){const t=this.table.rowCount-this.table.bottomFrozenRowCount,e=this.table.rowCount-1;"autoHeight"===this.table.heightMode&&jB(this.table,t,e,!1),CT(t,e,this),"autoHeight"===this.table.heightMode&&(fT(this.bodyLeftCol,this.bodyRightCol,t,e,this.table,this.rowUpdateDirection),fT(0,this.table.frozenColCount-1,t,e,this.table,this.rowUpdateDirection),fT(this.table.colCount-this.table.rightFrozenColCount,this.table.colCount-1,t,e,this.table,this.rowUpdateDirection))}updateRightFrozenCellGroups(){const t=this.table.colCount-this.table.rightFrozenColCount,e=this.table.colCount-1;"autoWidth"===this.table.widthMode&&$M(this.table,t,e,!1),pT(t,e,this),"autoHeight"===this.table.heightMode&&aT(t,e,this.table,this.colUpdateDirection)}async updateColCellGroupsAsync(){this.updateColGroups(this.taskRowCount)}updateColGroups(t){const e=Math.min(this.bodyRightCol,this.colUpdatePos+t);$M(this.table,this.colUpdatePos,e),pT(this.colUpdatePos,e,this),this.colUpdatePos=e+1}updateCellGroupPosition(t,e,i){t.row=e,t.mergeStartCol=void 0,t.mergeStartRow=void 0,t.mergeEndCol=void 0,t.mergeEndRow=void 0,t.setAttribute("y",i),t.needUpdate=!0,t.needUpdateForAutoRowHeight=!0}updateCellGroupContent(t){if(!t.needUpdate||"cell"!==t.role)return t;const e=this.table.scenegraph.updateCellContent(t.col,t.row);return t.needUpdate=!1,e||t}async sortCellVertical(){await async function(t){t.table.scenegraph.bodyGroup.forEachChildren(((t,e)=>{"group"===t.type&&(t.needUpdate=!0,t?.forEachChildren((t=>{t.needUpdate=!0})))}));for(let e=0;e<t.table.frozenColCount;e++){const i=t.table.scenegraph.getColGroup(e);i?.setAttribute("chartInstance",void 0);for(let i=t.rowStart;i<=t.rowEnd;i++)t.table.scenegraph.updateCellContent(e,i);for(let i=t.table.rowCount-t.table.bottomFrozenRowCount;i<t.table.rowCount;i++)t.table.scenegraph.updateCellContent(e,i)}for(let e=t.colStart;e<=t.colEnd;e++){const i=t.table.scenegraph.getColGroup(e);i?.setAttribute("chartInstance",void 0);for(let i=t.table.rowCount-t.table.bottomFrozenRowCount;i<t.table.rowCount;i++)t.table.scenegraph.updateCellContent(e,i)}for(let e=t.table.colCount-t.table.rightFrozenColCount;e<t.table.colCount;e++){const i=t.table.scenegraph.getColGroup(e);i?.setAttribute("chartInstance",void 0);for(let i=t.rowStart;i<=t.rowEnd;i++)t.table.scenegraph.updateCellContent(e,i);for(let i=t.table.rowCount-t.table.bottomFrozenRowCount;i<t.table.rowCount;i++)t.table.scenegraph.updateCellContent(e,i)}let e,i;"autoHeight"===t.table.heightMode?(e=t.rowStart,i=t.rowEnd):(e=Math.max(t.bodyTopRow,t.screenTopRow-1*t.screenRowCount),i=Math.min(t.bodyBottomRow,t.screenTopRow+2*t.screenRowCount));const r=t.table.getAllRowsHeight();jB(t.table,e,i);const o=t.table.getAllRowsHeight();r!==o&&t.table.scenegraph.updateContainerHeight(t.table.frozenRowCount,o-r),CT(e,i,t),"autoHeight"===t.table.heightMode&&fT(t.bodyLeftCol,t.bodyRightCol,e,i,t.table,t.rowEnd>t.bodyBottomRow-(t.rowEnd-t.rowStart+1)?"down":"up"),t.rowUpdatePos=t.rowStart,t.rowUpdateDirection=t.rowEnd>t.bodyBottomRow-(t.rowEnd-t.rowStart+1)?"down":"up",t.table.scenegraph.updateNextFrame(),"autoHeight"!==t.table.heightMode&&await t.progress()}(this)}async sortCellHorizontal(){await async function(t){t.table.scenegraph.bodyGroup.forEachChildren(((t,e)=>{"group"===t.type&&(t.needUpdate=!0,t?.forEachChildren((t=>{t.needUpdate=!0})))}));for(let e=t.colStart;e<=t.colEnd;e++){const i=t.table.scenegraph.getColGroup(e);i?.setAttribute("chartInstance",void 0);for(let i=t.table.rowCount-t.table.bottomFrozenRowCount;i<t.table.rowCount;i++)t.table.scenegraph.updateCellContent(e,i)}for(let e=t.table.colCount-t.table.rightFrozenColCount;e<t.table.colCount;e++){const i=t.table.scenegraph.getColGroup(e);i?.setAttribute("chartInstance",void 0);for(let i=t.rowStart;i<=t.rowEnd;i++)t.table.scenegraph.updateCellContent(e,i);for(let i=t.table.rowCount-t.table.bottomFrozenRowCount;i<t.table.rowCount;i++)t.table.scenegraph.updateCellContent(e,i)}const e=Math.max(t.bodyLeftCol,t.screenLeftCol-1*t.screenColCount),i=Math.min(t.bodyRightCol,t.screenLeftCol+2*t.screenColCount);$M(t.table,e,i),pT(e,i,t),t.colUpdatePos=t.colStart,t.colUpdateDirection=t.colEnd>t.bodyRightCol-(t.colEnd-t.colStart+1)?"right":"left",t.table.scenegraph.updateNextFrame(),await t.progress()}(this)}highPerformanceGetCell(t,e,i){if(e>=this.table.columnHeaderLevelCount&&e<this.table.rowCount-this.table.bottomFrozenRowCount&&(e<this.rowStart||e>this.rowEnd))return tT;if(t>=this.table.frozenColCount&&t<this.table.colCount-this.table.rightFrozenColCount&&(t<this.colStart||t>this.colEnd))return tT;if(this.cellCache.get(t)){const r=this.cellCache.get(t);if((r._next||r._prev)&&Math.abs(r.row-e)<e){let o=BT(r,e);return o&&(i||"shadow-cell"!==o.role)||(o=this.table.scenegraph.getCell(t,e,i)),o.row&&this.cellCache.set(t,o),o}const o=this.table.scenegraph.getCell(t,e,i);return o.col===t&&o.row&&this.cellCache.set(t,o),o}const r=this.table.scenegraph.getCell(t,e,i);return r.col===t&&r.row&&this.cellCache.set(t,r),r}updateDeltaY(t,e,i){if(this.rowStart===this.bodyTopRow){const t=this.table.scenegraph.highPerformanceGetCell(this.colStart,this.rowStart,!0);if("cell"===t.role){const e=t.attribute.y;this.deltaY=-e}}else if(this.rowEnd===this.bodyBottomRow){const t=this.table.scenegraph.highPerformanceGetCell(this.colStart,this.rowEnd,!0);if("cell"===t.role){const e=t.attribute.y+t.attribute.height-(this.table.getAllRowsHeight()-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight());this.deltaY=-e}}else if(Y(e)&&Y(i)){let r=this.table.scenegraph.highPerformanceGetCell(this.colStart,i,!0);"cell"!==r.role&&(r=this.table.scenegraph.highPerformanceGetCell(0,i,!0));const o=t-this.deltaY,n=e-o,s=r.attribute.y-o+this.table.getFrozenRowsHeight();this.deltaY=n-s}}updateDeltaX(t,e,i){if(this.colStart===this.bodyLeftCol){const t=this.table.scenegraph.getColGroup(this.colStart);if(t){const e=t.attribute.x;this.deltaX=-e}}else if(this.colEnd===this.bodyRightCol){const t=this.table.scenegraph.getColGroup(this.colEnd);if(t){const e=t.attribute.x+t.attribute.width-(this.table.getAllColsWidth()-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth());this.deltaX=-e}}else if(Y(e)&&Y(i)){const r=this.table.scenegraph.getColGroup(i)||this.table.scenegraph.getColGroup(i,!0),o=t-this.deltaX,n=e-o,s=r.attribute.x-o+this.table.getFrozenColsWidth();this.deltaX=n-s}}release(){this.isRelease=!0}}function BT(t,e){if(!t)return null;if(t.row===e)return t;const i=t._prev,r=t._next;return t.row>e&&i&&i.row===e-1?BT(i,e):t.row<e&&r&&r.row===e+1?BT(r,e):null}function MT(t,e,i){const[r,o,n,s]=e.split("-"),a=parseInt(r,10),l=parseInt(o,10),h=parseInt(n,10),c=parseInt(s,10);let d,u=a,g=l,p=h,f=c;switch(t.role){case"rowHeader":d=i.table.getBodyVisibleRowRange(),d&&(g=Math.max(l,d.rowStart-1),f=Math.min(c,d.rowEnd+1));break;case"columnHeader":case"bottomFrozen":d=i.table.getBodyVisibleCellRange(),d&&(u=Math.max(a,d.colStart-1),p=Math.min(h,d.colEnd+1));break;case"cornerHeader":case"rightTopCorner":case"leftBottomCorner":case"rightBottomCorner":break;case"rightFrozen":d=i.table.getBodyVisibleCellRange(),d&&(g=Math.max(l,d.rowStart-1),f=Math.min(c,d.rowEnd+1));break;default:d=i.table.getBodyVisibleCellRange(),d&&(g=Math.max(l,d.rowStart-1),f=Math.min(c,d.rowEnd+1),u=Math.max(a,d.colStart-1),p=Math.min(h,d.colEnd+1))}const m=i.table.getColsWidth(u,p),b=i.table.getRowsHeight(g,f),y=i.highPerformanceGetCell(u,g).globalAABBBounds,C=i.highPerformanceGetCell(p,f).globalAABBBounds;t.rect.setAttributes({x:y.x1-i.tableGroup.attribute.x,y:y.y1-i.tableGroup.attribute.y,width:m,height:b,visible:!0}),t.fillhandle&&t.fillhandle.setAttributes({x:C.x2-i.tableGroup.attribute.x-3,y:C.y2-i.tableGroup.attribute.y-3,width:6,height:6,visible:!0});const w=!!i.table.frozenColCount&&a===i.table.frozenColCount,v=!!i.table.rightFrozenColCount&&(i.table.rightFrozenColCount>0&&h===i.table.colCount-i.table.rightFrozenColCount-1),x=!i.table.frozenRowCount||l===i.table.frozenRowCount,_=!!i.table.bottomFrozenRowCount&&c===i.table.rowCount-i.table.bottomFrozenRowCount-1;if(w&&t.rect.attribute.stroke[3]||v&&t.rect.attribute.stroke[1]||x&&t.rect.attribute.stroke[0]||_&&t.rect.attribute.stroke[2]){if(w&&t.rect.attribute.stroke[3]&&i.tableGroup.insertAfter(t.rect,"columnHeader"===t.role?i.cornerHeaderGroup:"bottomFrozen"===t.role?i.leftBottomCornerGroup:i.rowHeaderGroup),_&&t.rect.attribute.stroke[2]&&i.tableGroup.insertAfter(t.rect,"rowHeader"===t.role?i.leftBottomCornerGroup:"rightFrozen"===t.role?i.rightBottomCornerGroup:i.bottomFrozenGroup),x&&t.rect.attribute.stroke[0]&&i.tableGroup.insertAfter(t.rect,"rowHeader"===t.role?i.cornerHeaderGroup:"rightFrozen"===t.role?i.rightTopCornerGroup:i.colHeaderGroup),v&&t.rect.attribute.stroke[1]&&i.tableGroup.insertAfter(t.rect,"columnHeader"===t.role?i.rightTopCornerGroup:"bottomFrozen"===t.role?i.rightBottomCornerGroup:i.rightFrozenGroup),t.rect.attribute.x<i.table.getFrozenColsWidth()&&i.table.scrollLeft>0&&("body"===t.role||"columnHeader"===t.role||"bottomFrozen"===t.role)){const e=t.rect.attribute.width-(i.table.getFrozenColsWidth()-t.rect.attribute.x);t.rect.setAttributes({x:t.rect.attribute.x+(i.table.getFrozenColsWidth()-t.rect.attribute.x),width:e>0?e:0})}if(i.table.getRightFrozenColsWidth()>0&&i.rightFrozenGroup.attribute.height>0&&t.rect.attribute.x+t.rect.attribute.width>i.rightFrozenGroup.attribute.x&&("body"===t.role||"columnHeader"===t.role||"bottomFrozen"===t.role)){const e=i.rightFrozenGroup.attribute.x-t.rect.attribute.x;t.rect.setAttributes({x:t.rect.attribute.x,width:e>0?e:0})}if(t.rect.attribute.y<i.colHeaderGroup.attribute.height&&i.table.scrollTop>0&&("body"===t.role||"rowHeader"===t.role||"rightFrozen"===t.role)){const e=t.rect.attribute.height-(i.colHeaderGroup.attribute.height-t.rect.attribute.y);t.rect.setAttributes({y:t.rect.attribute.y+(i.colHeaderGroup.attribute.height-t.rect.attribute.y),height:e>0?e:0})}if(i.bottomFrozenGroup.attribute.width>0&&i.bottomFrozenGroup.attribute.height>0&&t.rect.attribute.y+t.rect.attribute.height>i.bottomFrozenGroup.attribute.y&&("body"===t.role||"rowHeader"===t.role||"rightFrozen"===t.role)){const e=i.bottomFrozenGroup.attribute.y-t.rect.attribute.y;t.rect.setAttributes({y:t.rect.attribute.y,height:e>0?e:0})}}else i.tableGroup.insertAfter(t.rect,"body"===t.role?i.bodyGroup:"columnHeader"===t.role?i.colHeaderGroup:"rowHeader"===t.role?i.rowHeaderGroup:"cornerHeader"===t.role?i.cornerHeaderGroup:"rightTopCorner"===t.role?i.rightTopCornerGroup:"rightFrozen"===t.role?i.rightFrozenGroup:"leftBottomCorner"===t.role?i.leftBottomCornerGroup:"bottomFrozen"===t.role?i.bottomFrozenGroup:i.rightBottomCornerGroup);let S=0;"number"==typeof t.rect.attribute.lineWidth&&(S=Math.ceil(t.rect.attribute.lineWidth/2)),h===i.table.colCount-1&&(Array.isArray(t.rect.attribute.lineWidth)&&(S=Math.ceil((t.rect.attribute.lineWidth[1]??0)/2)),t.rect.setAttributes({width:t.rect.attribute.width-S})),0===a&&(Array.isArray(t.rect.attribute.lineWidth)&&(S=Math.ceil((t.rect.attribute.lineWidth[3]??0)/2)),t.rect.setAttributes({x:t.rect.attribute.x+S,width:t.rect.attribute.width-S})),c===i.table.rowCount-1&&(Array.isArray(t.rect.attribute.lineWidth)&&(S=Math.ceil((t.rect.attribute.lineWidth[2]??0)/2)),t.rect.setAttributes({height:t.rect.attribute.height-S})),0===l&&(Array.isArray(t.rect.attribute.lineWidth)&&(S=Math.ceil((t.rect.attribute.lineWidth[0]??0)/2)),t.rect.setAttributes({y:t.rect.attribute.y+S,height:t.rect.attribute.height-S}))}function TT(t,e,i,r,o,n=!0){let s=Math.max(Math.min(r,e),0),a=Math.max(Math.min(o,i),0),l=Math.min(Math.max(r,e),t.table.colCount-1),h=Math.min(Math.max(o,i),t.table.rowCount-1);const c=()=>{let e=!1;for(let i=s;i<=l;i++){if(i===s)for(let r=a;r<=h;r++){const o=iv(t.table,i,r);if(o&&o.start.col<s){s=o.start.col,e=!0;break}}if(!e&&i===l)for(let r=a;r<=h;r++){const o=iv(t.table,i,r);if(o&&Math.min(o.end.col,t.table.colCount-1)>l){l=o.end.col,e=!0;break}}if(e)break}if(!e)for(let i=a;i<=h;i++){if(i===a)for(let r=s;r<=l;r++){const o=iv(t.table,r,i);if(o&&o.start.row<a){a=o.start.row,e=!0;break}}if(!e&&i===h)for(let r=s;r<=l;r++){const o=iv(t.table,r,i);if(o&&Math.min(o.end.row,t.table.rowCount-1)>h){h=o.end.row,e=!0;break}}if(e)break}e&&c()};n&&c(),t.selectingRangeComponents.forEach(((t,e)=>{t.rect.delete(),t.fillhandle?.delete()})),t.selectingRangeComponents=new Map;let d=!1,u=!1,g=!1,p=!1,f=!1,m=!1,b=!1,y=!1,C=!1;if(s<=t.table.frozenColCount-1&&a<=t.table.frozenRowCount-1&&(m=!0),l>=t.table.colCount-t.table.rightFrozenColCount&&a<=t.table.frozenRowCount-1&&(b=!0),s<=t.table.frozenColCount-1&&h>=t.table.rowCount-t.table.bottomFrozenRowCount&&(C=!0),l>=t.table.colCount-t.table.rightFrozenColCount&&h>=t.table.rowCount-t.table.bottomFrozenRowCount&&(y=!0),s<=t.table.frozenColCount-1&&h>=t.table.frozenRowCount&&a<=t.table.rowCount-t.table.bottomFrozenRowCount-1&&(d=!0),l>=t.table.colCount-t.table.rightFrozenColCount&&h>=t.table.frozenRowCount&&a<=t.table.rowCount-t.table.bottomFrozenRowCount-1&&(u=!0),a<=t.table.frozenRowCount-1&&l>=t.table.frozenColCount&&s<=t.table.colCount-t.table.rightFrozenColCount-1&&(g=!0),h>=t.table.rowCount-t.table.bottomFrozenRowCount&&l>=t.table.frozenColCount&&s<=t.table.colCount-t.table.rightFrozenColCount-1&&(p=!0),s<=t.table.colCount-t.table.rightFrozenColCount-1&&l>=t.table.frozenColCount&&a<=t.table.rowCount-t.table.bottomFrozenRowCount-1&&h>=t.table.frozenRowCount&&(f=!0),m){const e=Math.min(l,t.table.frozenColCount-1),i=Math.min(h,t.table.frozenRowCount-1),r=[!0,!g,!d,!0];t.createCellSelectBorder(s,a,e,i,"cornerHeader",`${s}${a}${l}${h}`,r)}if(b){const e=Math.max(s,t.table.colCount-t.table.rightFrozenColCount),i=Math.min(h,t.table.frozenRowCount-1),r=[!0,!0,!u,!g];t.createCellSelectBorder(e,a,l,i,"rightTopCorner",`${s}${a}${l}${h}`,r)}if(C){const e=Math.min(l,t.table.frozenColCount-1),i=Math.max(a,t.table.rowCount-t.table.bottomFrozenRowCount),r=[!d,!p,!0,!0];t.createCellSelectBorder(s,i,e,h,"leftBottomCorner",`${s}${a}${l}${h}`,r)}if(y){const e=Math.max(s,t.table.colCount-t.table.rightFrozenColCount),i=Math.max(a,t.table.rowCount-t.table.bottomFrozenRowCount),r=[!u,!0,!0,!p];t.createCellSelectBorder(e,i,l,h,"rightBottomCorner",`${s}${a}${l}${h}`,r)}if(g){const e=Math.max(s,t.table.frozenColCount),i=Math.min(l,t.table.colCount-t.table.rightFrozenColCount-1),r=Math.min(h,t.table.frozenRowCount-1),o=[!0,!b,!f,!m];t.createCellSelectBorder(e,a,i,r,"columnHeader",`${s}${a}${l}${h}`,o)}if(p){const e=Math.max(s,t.table.frozenColCount),i=Math.min(l,t.table.colCount-t.table.rightFrozenColCount-1),r=Math.max(a,t.table.rowCount-t.table.bottomFrozenRowCount),o=[!f,!y,!0,!C];t.createCellSelectBorder(e,r,i,h,"bottomFrozen",`${s}${a}${l}${h}`,o)}if(d){const e=Math.max(a,t.table.frozenRowCount),i=Math.min(h,t.table.rowCount-t.table.bottomFrozenRowCount-1),r=Math.min(l,t.table.frozenColCount-1),o=[!m,!f,!C,!0];t.createCellSelectBorder(s,e,r,i,"rowHeader",`${s}${a}${l}${h}`,o)}if(u){const e=Math.max(a,t.table.frozenRowCount),i=Math.min(h,t.table.rowCount-t.table.bottomFrozenRowCount-1),r=Math.max(s,t.table.colCount-t.table.rightFrozenColCount),o=[!b,!0,!y,!f];t.createCellSelectBorder(r,e,l,i,"rightFrozen",`${s}${a}${l}${h}`,o)}if(f){const e=Math.max(s,t.table.frozenColCount),i=Math.max(a,t.table.frozenRowCount),r=Math.min(l,t.table.colCount-t.table.rightFrozenColCount-1),o=Math.min(h,t.table.rowCount-t.table.bottomFrozenRowCount-1),n=[!g,!u,!p,!d];t.createCellSelectBorder(e,i,r,o,"body",`${s}${a}${l}${h}`,n)}}function PT(t){t.selectingRangeComponents.forEach(((t,e)=>{t.rect.setAttribute("opacity",0)})),t.selectedRangeComponents.forEach(((t,e)=>{t.rect.setAttribute("opacity",0)}))}function HT(t){t.selectingRangeComponents.forEach(((t,e)=>{t.rect.setAttribute("opacity",1)})),t.selectedRangeComponents.forEach(((t,e)=>{t.rect.setAttribute("opacity",1)}))}function ET(t){t.selectingRangeComponents.forEach(((e,i)=>{t.selectedRangeComponents.get(i)&&(t.selectingRangeComponents.get(i).rect.delete(),t.selectingRangeComponents.get(i).fillhandle?.delete()),t.selectedRangeComponents.set(i,e)})),t.selectingRangeComponents=new Map,t.updateNextFrame()}function kT(t){t.selectedRangeComponents.forEach(((t,e)=>{t.rect.delete(),t.fillhandle?.delete()})),t.selectedRangeComponents=new Map}function LT(t,e,i,r){const o=r.scenegraph,n=qC(t.map((t=>t.row))).sort(((t,e)=>e-t)),s=qC(e.map((t=>t.row))).sort(((t,e)=>t-e)),a=qC(i.map((t=>t.row))).sort(((t,e)=>t-e));let l;if(a.length){l=zT(a[0]-1,a[a.length-1]+1,o)}if(s.length){const t=zT(s[0]-1,s[s.length-1]+1,o);l=Y(l)?Y(t)?Math.min(l,t):l:t}if(n.length){const t=zT(n[0]-1,n[n.length-1]+1,o);l=Y(l)?Y(t)?Math.min(l,t):l:t}n.forEach((t=>{!function(t,e){const i=e.proxy;t>=i.rowStart&&t<=i.rowEnd&&(!function(t,e){for(let i=0;i<e.table.colCount;i++){const r=e.getColGroup(i,!1);if(!r)continue;let o;r.forEachChildren((e=>e.row===t&&(o=e,!0))),o&&(r.updateColumnHeight(-o.attribute.height),r.removeChild(o))}}(t,e),i.rowEnd--,i.currentRow--);i.bodyBottomRow--;const r=Math.min(i.rowLimit,i.bodyBottomRow-i.bodyTopRow+1);i.totalActualBodyRowCount=r,i.totalRow=i.rowStart+r-1}(t,o)}));const h=r.rowHeightsMap;if(n.forEach((t=>{h.delete(t)})),n.length){!function(t){function e(e,i){e.row=i;const r=iv(t.table,e.col,e.row);r?(e.mergeStartCol=r.start.col,e.mergeEndCol=r.end.col,e.mergeStartRow=r.start.row,e.mergeEndRow=r.end.row):(e.mergeStartCol=void 0,e.mergeEndCol=void 0,e.mergeStartRow=void 0,e.mergeEndRow=void 0)}t.bodyGroup.forEachChildren((i=>{let r=t.bodyRowStart;i?.forEachChildren((t=>{e(t,r),r++}))})),t.rowHeaderGroup.forEachChildren((i=>{let r=t.bodyRowStart;i?.forEachChildren((t=>{e(t,r),r++}))})),t.rightFrozenGroup.forEachChildren((i=>{let r=t.bodyRowStart;i?.forEachChildren((t=>{e(t,r),r++}))})),t.bottomFrozenGroup.forEachChildren((i=>{let r=t.table.rowCount-t.table.bottomFrozenRowCount;i?.forEachChildren((t=>{e(t,r),r++}))})),t.leftBottomCornerGroup.forEachChildren((i=>{let r=t.table.rowCount-t.table.bottomFrozenRowCount;i?.forEachChildren((t=>{e(t,r),r++}))})),t.rightBottomCornerGroup.forEachChildren((i=>{let r=t.table.rowCount-t.table.bottomFrozenRowCount;i?.forEachChildren((t=>{e(t,r),r++}))}))}(o);const t=IT(n[n.length-1]-1,n[0]-n.length+1,o);l=Y(l)?Y(t)?Math.min(l,t):l:t}let c;if(o.table._clearRowRangeHeightsMap(),s.forEach((t=>{const e=function(t,e){const i=e.proxy;i.bodyBottomRow++;const r=Math.min(i.rowLimit,i.bodyBottomRow-i.bodyTopRow+1);if(i.totalActualBodyRowCount=r,i.totalRow=i.rowStart+r-1,t<i.rowStart)return;if(t>i.rowEnd)return i.rowEnd-i.rowStart+1<i.rowLimit?(i.rowEnd++,i.currentRow++,FT(t,e),t):void 0;if(i.rowEnd-i.rowStart+1<i.rowLimit)return i.rowEnd++,i.currentRow++,FT(t,e),t;return t}(t,o);c=c??e,h.insert(t)})),function(t){function e(e,i,r){e.row=i,e.setAttribute("y",r);const o=iv(t.table,e.col,e.row);o?(e.mergeStartCol=o.start.col,e.mergeEndCol=o.end.col,e.mergeStartRow=o.start.row,e.mergeEndRow=o.end.row):(e.mergeStartCol=void 0,e.mergeEndCol=void 0,e.mergeStartRow=void 0,e.mergeEndRow=void 0)}t.bodyGroup.forEachChildren((i=>{let r=t.bodyRowStart,o=t.getCellGroupY(r);i?.forEachChildren((t=>{e(t,r,o),r++,o+=t.attribute.height}))})),t.rowHeaderGroup.forEachChildren((i=>{let r=t.bodyRowStart,o=t.getCellGroupY(r);i?.forEachChildren((t=>{e(t,r,o),r++,o+=t.attribute.height}))})),t.rightFrozenGroup.forEachChildren((i=>{let r=t.bodyRowStart,o=t.getCellGroupY(r);i?.forEachChildren((t=>{e(t,r,o),r++,o+=t.attribute.height}))})),t.bottomFrozenGroup.forEachChildren((i=>{let r=t.table.rowCount-t.table.bottomFrozenRowCount,o=0;i?.forEachChildren((t=>{e(t,r,o),r++,o+=t.attribute.height}))})),t.leftBottomCornerGroup.forEachChildren((i=>{let r=t.table.rowCount-t.table.bottomFrozenRowCount,o=0;i?.forEachChildren((t=>{e(t,r,o),r++,o+=t.attribute.height}))})),t.rightBottomCornerGroup.forEachChildren((i=>{let r=t.table.rowCount-t.table.bottomFrozenRowCount,o=0;i?.forEachChildren((t=>{e(t,r,o),r++,o+=t.attribute.height}))}))}(o),s.length){const t=IT(s[0]-1,s[s.length-1]+1,o);l=Y(l)?Y(t)?Math.min(l,t):l:t}for(let t=0;t<r.colCount;t++)a.forEach((e=>{const i=iv(o.table,t,e);if(i)for(let t=i.start.col;t<=i.end.col;t++)for(let e=i.start.row;e<=i.end.row;e++)nB(t,e,o.table,!1);else nB(t,e,o.table,!1)}));if(a.length){const t=IT(a[0]-1,a[a.length-1]+1,o);l=Y(l)?Y(t)?Math.min(l,t):l:t}if(ot(c)){for(let t=0;t<r.colCount;t++)for(let e=c;e<r.rowCount;e++){const i=o.highPerformanceGetCell(t,e,!0);i&&(i.needUpdate=!0)}l=Y(l)?Y(c)?Math.min(l,c):l:c}if(ot(l)&&(o.proxy.rowUpdatePos=Math.min(o.proxy.rowUpdatePos,l)),s.length){if(!ot(c)){const t=Math.min(...s);o.proxy.rowUpdatePos=Math.min(t,o.proxy.rowUpdatePos)}o.proxy.rowUpdateDirection="up",o.proxy.updateCellGroups(2*o.proxy.screenRowCount),u()}else n.length&&(!function(t,e){if(e.table.isHasSeriesNumber())for(let i=t;i<=e.table.rowCount-1;i++)nB(0,i,e.table,!1)}(n[n.length-1],o),o.proxy.updateCellGroups(2*o.proxy.screenRowCount),u(),o.proxy.progress());o.proxy.progress();const d=r.getRowsHeight(r.frozenRowCount,r.rowCount-1-r.bottomFrozenRowCount);function u(){if(s?.[s?.length-1]>=r.rowCount-r.bottomFrozenRowCount||a?.[a?.length-1]>=r.rowCount-r.bottomFrozenRowCount||n?.[0]>=r.rowCount-r.bottomFrozenRowCount){for(let t=0;t<r.colCount;t++)for(let e=r.rowCount-r.bottomFrozenRowCount;e<r.rowCount;e++){const i=o.highPerformanceGetCell(t,e,!0);i&&(i.needUpdate=!0)}o.proxy.updateBottomFrozenCellGroups()}}o.updateContainerHeight(o.table.frozenRowCount,d-o.bodyGroup.attribute.height)}function FT(t,e){for(let i=0;i<e.table.colCount;i++){const r=new _R({x:0,y:0,width:e.table.getColWidth(i),height:e.table.getRowHeight(t)});if(r.role="cell",r.col=i,r.row=t,r.needUpdate=!0,!r)continue;const o=e.getColGroup(i);if(o)if(o.firstChild&&t<o.firstChild.row)o.insertBefore(r,o.firstChild),o.firstChild.row=o.firstChild.row+1;else if(o.lastChild&&t>o.lastChild.row)o.appendChild(r);else{const n=e.highPerformanceGetCell(i,t,!0);n!==r&&(o.insertBefore(r,n),n&&(n.row=n.row+1),n!==o.lastChild&&o.lastChild&&(o.lastChild.row=o.lastChild.row+1))}}}function IT(t,e,i){let r;for(let o=0;o<i.table.colCount;o++){const n=i.table.getCellRange(o,t);let s;n.start.row<=t+1&&n.end.row>=t+1&&(OT(n,i),s=n.start.row);const a=i.table.getCellRange(o,e);a.start.row<=e+1&&a.end.row>=e+1&&(OT(a,i),s=a.start.row),Y(s)&&(r=Y(r)?Math.min(r,s):s)}return r}function zT(t,e,i){let r;for(let o=0;o<i.table.colCount;o++){let n;const s=i.highPerformanceGetCell(o,t);s.mergeStartRow&&s.mergeEndRow&&s.mergeEndRow>t&&(OT({start:{row:s.mergeStartRow,col:"autoHeight"===i.table.heightMode?0:s.mergeStartCol},end:{row:s.mergeEndRow,col:"autoHeight"===i.table.heightMode?i.table.colCount-1:s.mergeEndCol}},i),n=s.mergeStartRow);const a=i.highPerformanceGetCell(o,e);a.mergeStartRow&&a.mergeEndRow&&a.mergeStartRow<e&&(OT({start:{row:a.mergeStartRow,col:"autoHeight"===i.table.heightMode?0:a.mergeStartCol},end:{row:a.mergeEndRow,col:"autoHeight"===i.table.heightMode?i.table.colCount-1:a.mergeEndCol}},i),n=a.mergeStartRow),Y(n)&&(r=Y(r)?Math.min(r,n):n)}return r}function OT(t,e){const{start:i,end:r}=t;for(let t=i.col;t<=r.col;t++)for(let o=i.row;o<=r.row;o++){const i=e.highPerformanceGetCell(t,o,!0);i&&(i.needUpdate=!0)}}function DT(t){const e=t.bodyGroup.firstChild instanceof _R?t.bodyGroup.firstChild:null;e&&(t.rowHeaderGroup.appendChild(e),t.rowHeaderGroup.setAttribute("width",t.rowHeaderGroup.attribute.width+e.attribute.width),t.bodyGroup.setAttribute("width",t.bodyGroup.attribute.width-e.attribute.width))}function WT(t){const e=t.colHeaderGroup.firstChild instanceof _R?t.colHeaderGroup.firstChild:null;e&&(t.cornerHeaderGroup.appendChild(e),t.cornerHeaderGroup.setAttribute("width",t.cornerHeaderGroup.attribute.width+e.attribute.width),t.colHeaderGroup.setAttribute("width",t.colHeaderGroup.attribute.width-e.attribute.width))}function NT(t){const e=t.rowHeaderGroup.lastChild instanceof _R?t.rowHeaderGroup.lastChild:t.rowHeaderGroup.lastChild?._prev;e&&(UT(t.bodyGroup,e,t.bodyGroup.firstChild),t.bodyGroup.setAttribute("width",t.bodyGroup.attribute.width+e.attribute.width),t.rowHeaderGroup.setAttribute("width",t.rowHeaderGroup.attribute.width-e.attribute.width))}function GT(t){const e=t.cornerHeaderGroup.lastChild instanceof _R?t.cornerHeaderGroup.lastChild:t.cornerHeaderGroup.lastChild?._prev;e&&(UT(t.colHeaderGroup,e,t.colHeaderGroup.firstChild),t.colHeaderGroup.setAttribute("width",t.colHeaderGroup.attribute.width+e.attribute.width),t.cornerHeaderGroup.setAttribute("width",t.cornerHeaderGroup.attribute.width-e.attribute.width))}function jT(t){const e=t.bottomFrozenGroup.firstChild instanceof _R?t.bottomFrozenGroup.firstChild:null;e&&(t.leftBottomCornerGroup.appendChild(e),t.leftBottomCornerGroup.setAttribute("width",t.leftBottomCornerGroup.attribute.width+e.attribute.width),t.bottomFrozenGroup.setAttribute("width",t.bottomFrozenGroup.attribute.width-e.attribute.width),t.table.isPivotChart()&&e.forEachChildren((t=>{t.setAttributes({stroke:!1,fill:!1})})))}function VT(t){const e=t.leftBottomCornerGroup.lastChild instanceof _R?t.leftBottomCornerGroup.lastChild:t.leftBottomCornerGroup.lastChild?._prev;e&&(UT(t.bottomFrozenGroup,e,t.bottomFrozenGroup.firstChild),t.bottomFrozenGroup.setAttribute("width",t.bottomFrozenGroup.attribute.width+e.attribute.width),t.leftBottomCornerGroup.setAttribute("width",t.leftBottomCornerGroup.attribute.width-e.attribute.width),t.table.isPivotChart()&&e.forEachChildren((e=>{const i=t.table._getCellStyle(e.col,e.row),r=t.table.getCellRange(e.col,e.row),o=cR(i,t.table,r?r.start.col:e.col,r?r.start.row:e.row,RR).theme;e.setAttributes({fill:o?.group?.fill??void 0,stroke:o?.group?.stroke??void 0})})))}function UT(t,e,i){e&&t&&(i?t.insertBefore(e,i):t.appendChild(e))}function KT(t){for(let e=t.proxy.colStart;e<=t.proxy.colEnd;e++){const i=t.getColGroup(e);i?.getChildren()?.forEach((t=>{t.children.forEach((t=>{"chart"===t.type&&(t.cacheCanvas=null,t.addUpdateBoundTag())}))}))}}function $T(t,e){t.forEachChildren((t=>{"column"===t.role&&t.forEachChildren((t=>{if("cell"===t.role){let i=!1;if(t.forEachChildren((t=>"axis"===t.name&&(i=!0,!0))),i){const i=e.internalProps.layoutMap.getAxisConfigInPivotChart(t.col,t.row),r=BA(RR("padding",e._getCellStyle(t.col,t.row),t.col,t.row,e)),o=new qS(i,t.attribute.width,t.attribute.height,r,e);t.clear(),t.appendChild(o.component),o.overlap()}}}))}))}function XT(t,e,i){return new _R({x:0,y:0,width:t,height:e,clip:i??!1,pickable:!1})}function YT(t,e){return t.forEachChildrenSkipChild(((t,i)=>{t.setAttribute("x",e),e+=t.attribute.width})),e}function qT(t,e,i,r,o){const n=t.name;QT(i,r,(t=>t.name===n),(t=>{XR(e,t),t.name=e.name}),o),o.updateNextFrame()}function ZT(t,e,i,r,o,n,s,a){const l=a.table.internalProps.headerHelper.getSortIcon(r,a.table,t,e);if(i&&qT(i,l,t,e,a),!function(t,e,i,r,o){const n=o.getCellRange(t,e),s=o.getCellRange(i,r);return n.start.col===s.start.col&&n.start.row===s.start.row&&n.end.col===s.end.col&&n.end.row===s.end.row}(t,e,o,n,a.table)){const t=a.table.internalProps.headerHelper.getSortIcon("normal",a.table,o,n);s?qT(s,t,o,n,a):function(t,e,i,r){const o=r.getCell(t,e);if(Y(o.mergeStartCol)&&Y(o.mergeStartRow)&&Y(o.mergeEndCol)&&Y(o.mergeEndRow))for(let t=o.mergeStartCol;t<=o.mergeEndCol;t++)for(let e=o.mergeStartRow;e<=o.mergeEndRow;e++){let o;r.getCell(t,e).forEachChildren((t=>"sort"===t.attribute.funcType&&(o=t,!0))),o&&(XR(i,o),o.name=i.name)}else{let t;o.forEachChildren((e=>"sort"===e.attribute.funcType&&(t=e,!0))),t&&(XR(i,t),t.name=i.name)}}(o,n,t,a)}}function JT(t,e,i){t.forEachChildren((t=>{"group"===t.type?JT(t,e,i):e(t)&&i(t)}))}function QT(t,e,i,r,o){const n=o.getCell(t,e);if("cell"===n.role&&Y(n.mergeStartCol)&&Y(n.mergeStartRow)&&Y(n.mergeEndCol)&&Y(n.mergeEndRow)){const{colStart:t,colEnd:e,rowStart:s,rowEnd:a}=qB(n,o);for(let n=t;n<=e;n++)for(let t=s;t<=a;t++)JT(o.highPerformanceGetCell(n,t),i,r)}else JT(n,i,r)}function tP(t,e){const{bgColor:i,borderColor:r,borderLineWidth:o,borderLineDash:n}=e,s={x:0,y:0,width:0,height:0,visible:!1,pickable:!0,fill:i};return s.stroke=dM(r,void 0),s.lineWidth=o,n&&(s.lineDash=n),s.lineCap="butt",Array.isArray(r)&&(s.strokeArrayColor=BA(r)),Array.isArray(o)&&(s.strokeArrayWidth=BA(o),s.lineWidth=1),t.setAttributes(s),t.role="corner-frozen",t}function eP(t,e,i,r){const o=r.scenegraph,n=iP(t.map((t=>t.col))).sort(((t,e)=>e-t)),s=iP(e.map((t=>t.col))).sort(((t,e)=>t-e)),a=iP(i.map((t=>t.col))).sort(((t,e)=>t-e));n.forEach((t=>{!function(t,e){const i=e.proxy;if(t>=e.table.rowHeaderLevelCount)if(t>=e.table.colCount-e.table.rightFrozenColCount);else{const i=e.getColGroup(t,!1);i&&i.parent===e.bodyGroup&&e.bodyGroup.removeChild(i);const r=e.getColGroupInBottom(t);r&&r.parent===e.bottomFrozenGroup&&e.bottomFrozenGroup.removeChild(r)}t>=i.colStart&&t<=i.colEnd&&(i.colEnd--,i.currentCol--);i.bodyRightCol--;const r=Math.min(i.colLimit,i.bodyRightCol-i.bodyLeftCol+1);i.totalActualBodyColCount=r,i.totalCol=i.colStart+r-1}(t,o)}));const l=r.colWidthsMap;let h;if(n.forEach((t=>{l.delAndReorder(t)})),n.length&&rP(o),o.table._clearColRangeWidthsMap(),s.forEach((t=>{const e=function(t,e){const i=e.proxy;i.bodyRightCol++;const r=Math.min(i.colLimit,i.bodyRightCol-i.bodyLeftCol+1);if(i.totalActualBodyColCount=r,i.totalCol=i.colStart+r-1,t<i.colStart)return;if(t>i.colEnd)return i.colEnd-i.colStart+1<i.colLimit?(i.colEnd++,i.currentCol++,oP(t,e),t):void 0;if(i.colEnd-i.colStart+1<i.colLimit)return i.colEnd++,i.currentCol++,oP(t,e),t;return t}(t,o);rP(o),h=h??e,l.addAndReorder(t)})),function(t){let e=t.bodyColStart,i=t.getCellGroupX(e);function r(i){i.col=e;const r=iv(t.table,i.col,i.row);r&&(i.mergeStartCol=r.start.col,i.mergeStartCol=r.start.col,i.mergeEndCol=r.end.col,i.mergeEndCol=r.end.col),i.role}t.bodyGroup.forEachChildren((t=>{t.col=e,t?.forEachChildren((t=>{r(t)})),t.setAttribute("x",i),i+=t.attribute.width,e++})),e=t.bodyColStart,i=t.getCellGroupX(e),t.colHeaderGroup.forEachChildren((t=>{t.col=e,t?.forEachChildren((t=>{r(t)})),t.setAttribute("x",i),i+=t.attribute.width,e++})),e=t.bodyColStart,i=t.getCellGroupX(e),t.bottomFrozenGroup.forEachChildren((t=>{t.col=e,t?.forEachChildren((t=>{r(t)})),t.setAttribute("x",i),i+=t.attribute.width,e++})),e=t.table.colCount-t.table.rightFrozenColCount,i=0,t.rightFrozenGroup.forEachChildren((t=>{t.col=e,t?.forEachChildren((t=>{r(t)})),t.setAttribute("x",i),i+=t.attribute.width,e++})),e=t.table.colCount-t.table.rightFrozenColCount,i=0,t.rightTopCornerGroup.forEachChildren((t=>{t.col=e,t?.forEachChildren((t=>{r(t)})),t.setAttribute("x",i),i+=t.attribute.width,e++})),e=t.table.colCount-t.table.rightFrozenColCount,i=0,t.rightBottomCornerGroup.forEachChildren((t=>{t.col=e,t?.forEachChildren((t=>{r(t)})),t.setAttribute("x",i),i+=t.attribute.width,e++}))}(o),a.forEach((t=>{for(let e=0;e<r.rowCount;e++){const i=iv(o.table,t,e);if(i)for(let t=i.start.col;t<=i.end.col;t++)for(let t=i.start.col;t<=i.end.col;t++)nB(t,e,o.table,!1);else nB(t,e,o.table,!1)}})),ot(h)){for(let t=h;t<r.colCount;t++)for(let e=0;e<r.rowCount;e++){const i=o.highPerformanceGetCell(t,e,!0);i&&(i.needUpdate=!0)}o.proxy.colUpdatePos=h}if(s.length){if(!ot(h)){const t=Math.min(...s);o.proxy.colUpdatePos=t}o.proxy.colUpdateDirection="left",o.proxy.updateColGroups(2*o.proxy.screenColCount),d(),o.proxy.progress()}else n.length&&(o.proxy.updateColGroups(2*o.proxy.screenColCount),d(),o.proxy.progress());const c=r.getColsWidth(r.frozenColCount,r.colCount-1);function d(){if(s?.[s?.length-1]>=r.colCount-r.rightFrozenColCount||a?.[a?.length-1]>=r.colCount-r.rightFrozenColCount||n?.[0]>=r.colCount-r.rightFrozenColCount){for(let t=r.colCount-r.rightFrozenColCount;t<r.colCount;t++)for(let e=0;e<r.rowCount;e++){const i=o.highPerformanceGetCell(t,e,!0);i&&(i.needUpdate=!0)}o.proxy.updateRightFrozenCellGroups()}}o.updateContainerWidth(o.table.frozenColCount,c-o.bodyGroup.attribute.width)}function iP(t){const e=[];for(let i=0;i<t.length;i++)-1===e.indexOf(t[i])&&e.push(t[i]);return e}function rP(t){let e=t.bodyColStart;function i(i){i.col=e;const r=iv(t.table,i.col,i.row);r&&(i.mergeStartCol=r.start.col,i.mergeStartCol=r.start.col,i.mergeEndCol=r.end.col,i.mergeEndCol=r.end.col),i.role}t.bodyGroup.forEachChildren((t=>{t.col=e,t?.forEachChildren((t=>{i(t)})),e++})),e=t.bodyColStart,t.colHeaderGroup.forEachChildren((t=>{t.col=e,t?.forEachChildren((t=>{i(t)})),e++})),e=t.bodyColStart,t.bottomFrozenGroup.forEachChildren((t=>{t.col=e,t?.forEachChildren((t=>{i(t)})),e++}))}function oP(t,e){if(e.colHeaderGroup&&e.table.columnHeaderLevelCount>0){const r=new _R({x:0,y:0,width:e.table.getColWidth(t),height:0,clip:!1,pickable:!1});r.role="column",r.col=t;const o=e.getColGroup(t,!0);o?e.colHeaderGroup.insertBefore(r,o):e.colHeaderGroup.appendChild(r),i(r,t,0,e.table.columnHeaderLevelCount-1)}if(e.bodyGroup){const r=new _R({x:0,y:0,width:e.table.getColWidth(t),height:0,clip:!1,pickable:!1});r.role="column",r.col=t;const o=e.getColGroup(t,!1);o?e.bodyGroup.insertBefore(r,o):e.bodyGroup.appendChild(r),i(r,t,e.bodyRowStart,e.bodyRowEnd)}if(e.bottomFrozenGroup&&e.table.bottomFrozenRowCount>0){const r=new _R({x:0,y:0,width:e.table.getColWidth(t),height:0,clip:!1,pickable:!1});r.role="column",r.col=t;const o=e.getColGroupInBottom(t);o?e.bottomFrozenGroup.insertBefore(r,o):e.bottomFrozenGroup.appendChild(r),i(r,t,e.table.rowCount-e.table.bottomFrozenRowCount,e.table.rowCount-1)}function i(t,i,r,o){for(let n=r;n<=o;n++){const r=new _R({x:0,y:0,width:e.table.getColWidth(i),height:e.table.getRowHeight(n)});r.role="cell",r.col=i,r.row=n,r.needUpdate=!0,t.appendChild(r)}}}tC(),Xr.load(Tv),Xr.load(KM),Xr.load(LB);class nP{proxy;tableGroup;colHeaderGroup;cornerHeaderGroup;rowHeaderGroup;bodyGroup;rightFrozenGroup;bottomFrozenGroup;rightTopCornerGroup;leftBottomCornerGroup;rightBottomCornerGroup;componentGroup;selectedRangeComponents;selectingRangeComponents;lastSelectId;component;stage;table;isPivot;hasFrozen;frozenColCount;frozenRowCount;clear;mergeMap;_dealAutoFillHeightOriginRowsHeight;_needUpdateContainer=!1;constructor(t){var e;let i,r;var o;this.table=t,this.hasFrozen=!1,this.clear=!0,this.mergeMap=new Map,e=this.table.theme.textPopTipStyle,wt(wv.poptip,Cv,e),"node"===kC.mode?(Su.setEnv("node",t.options.modeParams),i=t.canvasWidth,r=t.canvasHeight):(Su.setEnv("browser"),i=t.canvas.width,r=t.canvas.height),this.stage=(o={canvas:t.canvas,width:i,height:r,disableDirtyBounds:!1,background:t.theme.underlayBackgroundColor,dpr:t.internalProps.pixelRatio,enableLayout:!0,afterRender:()=>{this.table.fireListeners("after_render",null)}},new $u(o)),this.stage.defaultLayer.setTheme({group:{boundsPadding:0,strokeBoundsBuffer:0,lineJoin:"round"},text:{ignoreBuf:!0}}),this.initSceneGraph(),this.stage.defaultLayer.add(this.tableGroup),this.stage.table=this.table,this.createComponent()}get width(){return this.tableGroup.attribute?.width??0}get height(){return this.tableGroup.attribute?.height??0}get x(){return this.tableGroup.attribute?.x??0}get y(){return this.tableGroup.attribute?.y??0}get bodyRowStart(){return this.proxy.rowStart??0}get bodyRowEnd(){return this.proxy.rowEnd??this.table.rowCount-1}get bodyColStart(){return this.proxy.colStart??0}get bodyColEnd(){return this.proxy.colEnd??this.table.colCount-1}initSceneGraph(){this.isPivot=this.table.isPivotTable(),function(t){const e=t.table.tableNoFrameWidth,i=t.table.tableNoFrameHeight;t.tableGroup=new _R({x:0,y:0,width:e,height:i,clip:!0,pickable:!1}),t.tableGroup.role="table";const r=XT(0,0,!0);r.role="col-header",t.colHeaderGroup=r;const o=XT(0,0,!0);o.role="corner-header",t.cornerHeaderGroup=o;const n=XT(0,0,!0);n.role="row-header",t.rowHeaderGroup=n;const s=XT(e,0,!0);s.role="body",t.bodyGroup=s;const a=XT(0,0,!0);a.role="right-frozen",t.rightFrozenGroup=a;const l=XT(0,0,!0);l.role="bottom-frozen",t.bottomFrozenGroup=l;const h=XT(0,0);h.role="component",t.componentGroup=h;const c=XT(0,0,!0);c.role="corner-right-top-header",t.rightTopCornerGroup=c;const d=XT(0,0,!0);d.role="corner-right-bottom-header",t.rightBottomCornerGroup=d;const u=XT(0,0,!0);u.role="corner-left-bottom-header",t.leftBottomCornerGroup=u,t.tableGroup.addChild(s),t.tableGroup.addChild(n),t.tableGroup.addChild(l),t.tableGroup.addChild(r),t.tableGroup.addChild(a),t.tableGroup.addChild(d),t.tableGroup.addChild(c),t.tableGroup.addChild(u),t.tableGroup.addChild(o),t.tableGroup.addChild(h)}(this)}clearCells(){(this.table.isPivotChart()||this.table._hasCustomRenderOrLayout())&&this.stage.pluginService.findPluginsByName("poptipForText").forEach((t=>{t.deactivate(this.stage.pluginService)})),this.clear=!0,this.hasFrozen=!1,this.mergeMap.clear(),this.colHeaderGroup.clear(),this.rowHeaderGroup.clear(),this.cornerHeaderGroup.clear(),this.bodyGroup.clear(),this.bottomFrozenGroup.clear(),this.rightFrozenGroup.clear(),this.rightTopCornerGroup.clear(),this.rightBottomCornerGroup.clear(),this.leftBottomCornerGroup.clear(),this.colHeaderGroup.setAttributes({x:0,y:0,width:0,height:0}),this.rowHeaderGroup.setAttributes({x:0,y:0,width:0,height:0}),this.cornerHeaderGroup.setAttributes({x:0,y:0,width:0,height:0}),this.bodyGroup.setAttributes({x:0,y:0,width:0,height:0}),this.rightFrozenGroup.setAttributes({x:0,y:0,width:0,height:0}),this.bottomFrozenGroup.setAttributes({x:0,y:0,width:0,height:0}),this.rightTopCornerGroup.setAttributes({x:0,y:0,width:0,height:0,visible:!1}),this.leftBottomCornerGroup.setAttributes({x:0,y:0,width:0,height:0,visible:!1}),this.rightBottomCornerGroup.setAttributes({x:0,y:0,width:0,height:0,visible:!1}),this.tableGroup.setAttributes({x:this.table.tableX,y:this.table.tableY,width:0,height:0}),this.tableGroup.border&&(this.tableGroup.parent.removeChild(this.tableGroup.border),delete this.tableGroup.border),this.proxy?.release()}updateStageBackground(){this.stage.background=this.table.theme.underlayBackgroundColor,this.stage.renderNextFrame()}createComponent(){this.component=new lM(this.table),this.component.addToGroup(this.componentGroup),this.selectedRangeComponents=new Map,this.selectingRangeComponents=new Map}updateComponent(){this.component.updateStyle()}createSceneGraph(){this.table.rowHeightsMap.clear(),(this.table.isPivotChart()||this.table._hasCustomRenderOrLayout())&&this.stage.pluginService.autoEnablePlugins.getContributions().forEach((t=>{"poptipForText"===t.name&&this.stage.pluginService.register(t)})),this.clear=!1,this.frozenColCount=this.table.frozenColCount,this.frozenRowCount=this.table.columnHeaderLevelCount,this.proxy=new RT(this.table),hM(this.tableGroup,this.table.theme.frameStyle,this.tableGroup.role,void 0,!0),this.table.isPivotChart()&&(tP(this.rightTopCornerGroup,this.table.theme.cornerRightTopCellStyle||this.table.theme.cornerHeaderStyle||{}),tP(this.leftBottomCornerGroup,this.table.theme.cornerLeftBottomCellStyle||this.table.theme.cornerHeaderStyle||{}),tP(this.rightBottomCornerGroup,this.table.theme.cornerRightBottomCellStyle||this.table.theme.cornerHeaderStyle||{})),this.proxy.createGroupForFirstScreen(this.cornerHeaderGroup,this.colHeaderGroup,this.rowHeaderGroup,this.rightFrozenGroup,this.bottomFrozenGroup,this.bodyGroup,0,0),this.afterScenegraphCreated()}renderSceneGraph(){this.stage.render()}getCell(t,e,i){let r;if(r=this.table.rightFrozenColCount>0&&t>=this.table.colCount-this.table.rightFrozenColCount&&e<this.table.frozenRowCount?this.rightTopCornerGroup.getColGroup(t)?.getRowGroup(e):this.table.bottomFrozenRowCount>0&&e>=this.table.rowCount-this.table.bottomFrozenRowCount&&t<this.table.frozenColCount?this.leftBottomCornerGroup.getColGroup(t)?.getRowGroup(e):this.table.rightFrozenColCount>0&&this.table.bottomFrozenRowCount>0&&t>=this.table.colCount-this.table.rightFrozenColCount&&e>=this.table.rowCount-this.table.bottomFrozenRowCount?this.rightBottomCornerGroup.getColGroup(t)?.getRowGroup(e):this.table.rightFrozenColCount>0&&t>this.table.colCount-1-this.table.rightFrozenColCount?this.rightFrozenGroup.getColGroup(t)?.getRowGroup(e):this.table.bottomFrozenRowCount>0&&e>this.table.rowCount-1-this.table.bottomFrozenRowCount?this.bottomFrozenGroup.getColGroup(t)?.getRowGroup(e):this.getColGroup(t,e<this.frozenRowCount)?.getRowGroup(e),r&&"shadow-cell"===r.role&&!i){const i=this.table.getCellRange(t,e);i.start.col===t&&i.start.row===e||(r=this.getCell(i.start.col,i.start.row))}return r||tT}highPerformanceGetCell(t,e,i){return this.proxy.highPerformanceGetCell(t,e,i)}getColGroup(t,e=!1){let i;return i=t<this.frozenColCount&&e?this.cornerHeaderGroup.getColGroup(t):t<this.frozenColCount?this.rowHeaderGroup.getColGroup(t):e&&this.table.rightFrozenColCount>0&&t>this.table.colCount-1-this.table.rightFrozenColCount?this.rightTopCornerGroup.getColGroup(t):!e&&this.table.rightFrozenColCount>0&&t>this.table.colCount-1-this.table.rightFrozenColCount?this.rightFrozenGroup.getColGroup(t):e?this.colHeaderGroup.getColGroup(t):this.bodyGroup.getColGroup(t),i||void 0}getColGroupInBottom(t){if(this.table.bottomFrozenRowCount>0)return this.bottomFrozenGroup.getColGroup(t)}getColGroupInLeftBottomCorner(t){if(this.table.bottomFrozenRowCount>0)return this.leftBottomCornerGroup.getColGroup(t)}getColGroupInRightTopCorner(t){if(this.table.rightFrozenColCount>0)return this.rightTopCornerGroup.getColGroup(t)}getColGroupInRightBottomCorner(t){if(this.table.rightFrozenColCount>0&&this.table.bottomFrozenRowCount>0)return this.rightBottomCornerGroup.getColGroup(t)}getCellSize(t,e){const i=this.getCell(t,e),r=iv(this.table,t,e);let o=i.attribute.width,n=i.attribute.height;return r&&(o/=r.end.col-r.start.col+1,n/=r.end.row-r.start.row+1),{width:o,height:n}}updateNextFrame(){this.updateContainerSync(),this.resetAllSelectComponent(),this.stage.renderNextFrame()}resetAllSelectComponent(){var t;this.table.stateManager.select?.ranges?.length>0&&((t=this).selectingRangeComponents.forEach(((e,i)=>{MT(e,i,t)})),t.selectedRangeComponents.forEach(((e,i)=>{MT(e,i,t)})))}hideHoverIcon(t,e){!function(t,e,i){-1!==t&&-1!==e&&(QT(t,e,(t=>"mouseenter_cell"===t.attribute.visibleTime),(t=>{t.setAttribute("opacity",0);const e=t.parent.getChildByName("icon-back");e&&e.setAttribute("visible",!1)}),i),i.updateNextFrame())}(t,e,this)}showHoverIcon(t,e){!function(t,e,i){-1!==t&&-1!==e&&(QT(t,e,(t=>"mouseenter_cell"===t.attribute.visibleTime),(t=>{t.setAttribute("opacity",1)}),i),i.updateNextFrame())}(t,e,this)}hideClickIcon(t,e){!function(t,e,i){-1!==t&&-1!==e&&(QT(t,e,(t=>"click_cell"===t.attribute.visibleTime),(t=>{t.setAttribute("opacity",0)}),i),i.updateNextFrame())}(t,e,this)}showClickIcon(t,e){!function(t,e,i){-1!==t&&-1!==e&&(QT(t,e,(t=>"click_cell"===t.attribute.visibleTime),(t=>{t.setAttribute("opacity",1)}),i),i.updateNextFrame())}(t,e,this)}getIcon(t,e,i,r){return function(t,e,i,r,o){let n;return o.getCell(t,e).forEachChildren((t=>{t.role&&t.role.startsWith("icon")&&t.containsPoint(i,r,Ci.GLOBAL)&&(n=t)})),n}(t,e,i,r,this)}setIconHoverStyle(t,e,i,r){!function(t,e,i,r,o){if((t.attribute.backgroundColor||t.attribute.hoverImage)&&QT(e,i,(e=>e.name===t.name),(t=>{if(t.attribute.backgroundColor){let e=t.parent.getChildByName("icon-back");e?e.setAttributes({x:(t.attribute.x??0)+(t.attribute.dx??0)+(t.AABBBounds.width()-t.backgroundWidth)/2,y:(t.attribute.y??0)+(t.AABBBounds.height()-t.backgroundHeight)/2,dx:t.attribute.dx??0,dy:t.attribute.dy??0,width:t.backgroundWidth,height:t.backgroundHeight,fill:t.attribute.backgroundColor,cornerRadius:5,visible:!0}):(e=fl({x:(t.attribute.x??0)+(t.attribute.dx??0)+(t.AABBBounds.width()-t.backgroundWidth)/2,y:(t.attribute.y??0)+(t.AABBBounds.height()-t.backgroundHeight)/2,dx:t.attribute.dx??0,dy:t.attribute.dy??0,width:t.backgroundWidth,height:t.backgroundHeight,fill:t.attribute.backgroundColor,cornerRadius:5,pickable:!1,visible:!0}),e.name="icon-back"),t.parent.insertBefore(e,t)}t.attribute.hoverImage&&t.attribute.image!==t.attribute.hoverImage&&(t.image=t.attribute.hoverImage)}),o),t.tooltip){const{x1:r,x2:n,y1:s,y2:a}=t.globalAABBBounds,l={content:t.tooltip.title,referencePosition:{rect:{left:r,right:n,top:s,bottom:a,width:t.globalAABBBounds.width(),height:t.globalAABBBounds.height()},placement:t.tooltip.placement},style:Object.assign({},o.table.internalProps.theme?.tooltipStyle,t.tooltip?.style)};o.table.internalProps.tooltipHandler.isBinded(l)||o.table.showTooltip(e,i,l)}}(t,e,i,0,this)}updateSortIcon(t,e,i,r,o,n,s){ZT(t,e,i,r,o,n,s,this)}updateFrozenIcon(t,e){!function(t){for(let e=0;e<t.table.colCount;e++)for(let i=0;i<t.table.columnHeaderLevelCount;i++)QT(e,i,(t=>"frozen"===t.attribute.funcType),(r=>{const o=t.table.internalProps.headerHelper.getFrozenIcon(e,i);XR(o,r),r.name=o.name}),t)}(this)}updateHierarchyIcon(t,e){!function(t,e,i){let r;r=i.table.isHeader(t,e)?i.table.internalProps.headerHelper.getHierarchyIcon(t,e):i.table.internalProps.bodyHelper.getHierarchyIcon(t,e),QT(t,e,(t=>t.attribute.funcType===lC.collapse||t.attribute.funcType===lC.expand),(t=>{XR(r,t),t.name=r.name}),i)}(t,e,this)}setIconNormalStyle(t,e,i){!function(t,e,i,r){(t.attribute.backgroundColor||t.attribute.hoverImage)&&QT(e,i,(e=>e.name===t.name),(t=>{const e=t.parent.getChildByName("icon-back");e&&e.setAttribute("visible",!1),t.attribute.hoverImage&&t.attribute.image!==t.attribute.originImage&&(t.image=t.attribute.originImage)}),r)}(t,e,i,this)}residentHoverIcon(t,e){!function(t,e,i){QT(t,e,(t=>t.attribute.funcType===lC.dropDown),(t=>{t.oldVisibleTime=t.attribute.visibleTime,t.setAttribute("visibleTime","always"),t.setAttribute("opacity",1)}),i)}(t,e,this)}resetResidentHoverIcon(t,e){!function(t,e,i){QT(t,e,(t=>t.attribute.funcType===lC.dropDown),(t=>{t.oldVisibleTime&&t.setAttribute("visibleTime",t.oldVisibleTime),t.setAttribute("opacity","always"===t.attribute.visibleTime?1:0)}),i)}(t,e,this)}deactivateChart(t,e){if(-1===t||-1===e)return;const i=this.getCell(t,e);i?.firstChild?.deactivate?.()}activateChart(t,e){if(-1===t||-1===e)return;const i=this.getCell(t,e);i?.firstChild?.activate?.(this.table)}removeInteractionBorder(t,e){const i=this.getCell(t,e);i.setAttribute("highlightStroke",void 0),i.setAttribute("highlightStrokeArrayWidth",void 0),i.setAttribute("highlightStrokeArrayColor",void 0)}createCellSelectBorder(t,e,i,r,o,n,s){!function(t,e,i,r,o,n,s,a){let l=!!t.table.options.excelOptions?.fillHandle;if(t.table.stateManager.select.ranges?.length>1)l=!1,t.removeFillHandleFromSelectComponents();else if(1===t.table.stateManager.select.ranges?.length){const e=Math.max(t.table.stateManager.select.ranges[0].start.row,t.table.stateManager.select.ranges[0].end.row),i=Math.max(t.table.stateManager.select.ranges[0].start.col,t.table.stateManager.select.ranges[0].end.col);t.table.isHeader(i,e)&&(l=!1)}!Array.isArray(a)||!1!==a[1]&&!1!==a[2]||(l=!1);const h=Math.min(e,r),c=Math.min(i,o),d=Math.max(e,r),u=Math.max(i,o),g=t.highPerformanceGetCell(h,c).globalAABBBounds,p=t.highPerformanceGetCell(d,u).globalAABBBounds,f=t.table.theme,m=f.selectionStyle?.cellBorderColor,b=f.selectionStyle?.cellBorderLineWidth,y=fl({pickable:!1,fill:f.selectionStyle?.cellBgColor??"rgba(0, 0, 255,0.1)",lineWidth:b,stroke:a.map((t=>!!t&&m)),x:g.x1-t.tableGroup.attribute.x,y:g.y1-t.tableGroup.attribute.y,width:0,height:0,visible:!0});let C;l&&(C=fl({pickable:!1,fill:m,stroke:m,x:p.x2-3,y:p.y2-3,width:6,height:6,visible:!0})),t.lastSelectId=s,t.selectingRangeComponents.set(`${h}-${c}-${d}-${u}-${s}`,{rect:y,fillhandle:C,role:n}),t.tableGroup.insertAfter(y,"body"===n?t.bodyGroup:"columnHeader"===n?t.colHeaderGroup:"rowHeader"===n?t.rowHeaderGroup:"cornerHeader"===n?t.cornerHeaderGroup:"rightTopCorner"===n?t.rightTopCornerGroup:"rightFrozen"===n?t.rightFrozenGroup:"leftBottomCorner"===n?t.leftBottomCornerGroup:"bottomFrozen"===n?t.bottomFrozenGroup:t.rightBottomCornerGroup),l&&t.tableGroup.insertAfter(C,"body"===n?t.bodyGroup:"columnHeader"===n?t.colHeaderGroup:"rowHeader"===n?t.rowHeaderGroup:"cornerHeader"===n?t.cornerHeaderGroup:"rightTopCorner"===n?t.rightTopCornerGroup:"rightFrozen"===n?t.rightFrozenGroup:"leftBottomCorner"===n?t.leftBottomCornerGroup:"bottomFrozen"===n?t.bottomFrozenGroup:t.rightBottomCornerGroup)}(this,t,e,i,r,o,n,s)}moveSelectingRangeComponentsToSelectedRangeComponents(){ET(this)}deleteLastSelectedRangeComponents(){var t;(t=this).selectedRangeComponents.forEach(((e,i)=>{i.split("-")[4]===t.lastSelectId&&(e.rect.delete(),e.fillhandle?.delete(),t.selectedRangeComponents.delete(i))}))}deleteAllSelectBorder(){kT(this)}updateCellSelectBorder(t,e,i,r,o=!0){TT(this,t,e,i,r,o)}removeFillHandleFromSelectComponents(){this.selectedRangeComponents.forEach(((t,e)=>{t.fillhandle?.delete(),t.fillhandle=void 0}))}recreateAllSelectRangeComponents(){kT(this),this.table.stateManager.select.ranges.forEach((t=>{TT(this,t.start.col,t.start.row,t.end.col,t.end.row)})),ET(this)}updateColWidth(t,e,i,r){!function(t,e,i,r){r||t.table._setColWidth(e,t.table.getColWidth(e)+i,!0);const o=t.getColGroup(e,!0),n=t.getColGroupInRightTopCorner(e);o&&!n&&QB(o,i,"col-corner",t),n&&QB(n,i,"right-top",t);const s=t.getColGroup(e);s&&QB(s,i,"row-body",t);const a=t.getColGroupInLeftBottomCorner(e);a&&QB(a,i,"left-bottom",t);const l=t.getColGroupInBottom(e);l&&QB(l,i,"bottom",t);const h=t.getColGroupInRightBottomCorner(e);h&&QB(h,i,"right-bottom",t),e<t.frozenColCount?(t.cornerHeaderGroup.forEachChildrenSkipChild(((t,r)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)})),t.rowHeaderGroup.forEachChildrenSkipChild(((t,r)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)}))):(t.colHeaderGroup.forEachChildrenSkipChild(((t,r)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)})),t.bodyGroup.forEachChildrenSkipChild(((t,r)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)}))),a&&t.leftBottomCornerGroup.forEachChildrenSkipChild(((t,r)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)})),l&&t.bottomFrozenGroup.forEachChildrenSkipChild(((t,r)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)})),h&&t.rightBottomCornerGroup.forEachChildrenSkipChild(((t,r)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)}))}(this,t,Math.round(e),r),i||this.updateContainer(!0)}updateChartSize(t){!function(t,e){for(let i=e;i<=t.proxy.colEnd;i++){const e=t.getColGroup(i);e?.getChildren()?.forEach((e=>{const i=t.table.getColWidth(e.col),r=t.table.getRowHeight(e.row);e.children.forEach((t=>{"chart"===t.type&&(t.cacheCanvas=null,t.setAttribute("width",Math.ceil(i-t.attribute.cellPadding[3]-t.attribute.cellPadding[1])),t.setAttribute("height",Math.ceil(r-t.attribute.cellPadding[0]-t.attribute.cellPadding[2])))}))}))}if(!t.table.isPivotChart()&&t.table.rightFrozenColCount>=1)for(let e=t.table.colCount-t.table.rightFrozenColCount;e<=t.table.colCount-1;e++){const i=t.getColGroup(e);i?.getChildren()?.forEach((e=>{const i=t.table.getColWidth(e.col),r=t.table.getRowHeight(e.row);e.children.forEach((t=>{"chart"===t.type&&(t.cacheCanvas=null,t.setAttribute("width",Math.ceil(i-t.attribute.cellPadding[3]-t.attribute.cellPadding[1])),t.setAttribute("height",Math.ceil(r-t.attribute.cellPadding[0]-t.attribute.cellPadding[2])))}))}))}}(this,t)}updateChartState(t){this.table.isPivotChart()&&function(t,e){const i=t.table;if(i.isPivotChart()){const r=i._selectedDataItemsInChart.length;if((null===e||0===e?.length||0===Object.keys(e).length)&&0===r)return;const o=[];if(Array.isArray(e))e.forEach((t=>{if(t&&0!==t.key&&Object.keys(t).length>0){const e={};for(const i in t)i.startsWith("VGRAMMAR_")||i.startsWith("__VCHART")||(e[i]=t[i]);o.push(e)}}));else if(e&&0!==e.key&&Object.keys(e).length>0){const t={};for(const i in e)i.startsWith("VGRAMMAR_")||i.startsWith("__VCHART")||(t[i]=e[i]);o.push(t)}_t(i._selectedDataItemsInChart,o)||(i._selectedDataItemsInChart=o,i.internalProps.layoutMap.updateDataStateToChartInstance(),KT(t),i.scenegraph.updateNextFrame())}}(this,t)}updateCheckboxCellState(t,e,i){if(this.table.transpose)this.bodyGroup.children?.forEach((t=>{t.getChildAt(e).getChildren().forEach((t=>{"checkbox"===t.name&&t.setAttribute("checked",i)}))}));else{const e=this.getColGroup(t);e.children?.forEach((t=>{t.getChildren().find((t=>{"checkbox"===t.name&&t.setAttribute("checked",i)}))}))}}updateHeaderCheckboxCellState(t,e,i){if(this.table.transpose)this.rowHeaderGroup.children?.forEach((t=>{t.getChildAt(e).getChildren().forEach((t=>{"checkbox"===t.name&&("indeterminate"===i?(t.setAttribute("indeterminate",!0),t.setAttribute("checked",void 0)):(t.setAttribute("indeterminate",void 0),t.setAttribute("checked",i)))}))}));else{const e=this.getColGroup(t,!0);e.children?.forEach((t=>{t.getChildren().find((t=>{"checkbox"===t.name&&("indeterminate"===i?(t.setAttribute("indeterminate",!0),t.setAttribute("checked",void 0)):(t.setAttribute("indeterminate",void 0),t.setAttribute("checked",i)))}))}))}}updateAutoColWidth(t){this.table.internalProps._widthResizedColMap.delete(t);const e=this.table.getColWidth(t),i=XM(t,0,this.table.rowCount-1,this.table,!0);i!==e&&this.updateColWidth(t,i-e)}recalculateColWidths(){$M(this.table,0,this.table.colCount-1,!0)}recalculateRowHeights(){jB(this.table,0,this.table.rowCount-1,!0,!0)}resize(){this.proxy.resize(),("adaptive"===this.table.widthMode||this.table.autoFillWidth)&&(0===this.table.internalProps._widthResizedColMap.size?this.recalculateColWidths():this.dealWidthMode()),"adaptive"===this.table.heightMode?0===this.table.internalProps._heightResizedRowMap.size?this.recalculateRowHeights():this.dealHeightMode():this.table.autoFillHeight&&this.dealHeightMode(),this.resetFrozen(),this.updateTableSize(),this.updateBorderSizeAndPosition(),this.component.updateScrollBar(),("adaptive"===this.table.widthMode||"adaptive"===this.table.heightMode||this.table.autoFillWidth||this.table.autoFillHeight)&&this.updateChartSize(this.table.rowHeaderLevelCount),this.proxy.progress(),this.updateNextFrame()}updateTableSize(){this.tableGroup.setAttributes({x:this.table.tableX,y:this.table.tableY,width:Math.min(this.table.tableNoFrameWidth,Math.max(this.colHeaderGroup.attribute.width,this.bodyGroup.attribute.width,this.bottomFrozenGroup.attribute.width,0)+Math.max(this.cornerHeaderGroup.attribute.width,this.rowHeaderGroup.attribute.width,this.leftBottomCornerGroup.attribute.width,0)+Math.max(this.rightTopCornerGroup.attribute.width,this.rightFrozenGroup.attribute.width,this.rightBottomCornerGroup.attribute.width,0)),height:Math.min(this.table.tableNoFrameHeight,Math.max(this.colHeaderGroup.attribute.height,this.cornerHeaderGroup.attribute.height,this.rightTopCornerGroup.attribute.height,0)+Math.max(this.rowHeaderGroup.attribute.height,this.bodyGroup.attribute.height,this.rightFrozenGroup.attribute.height,0)+Math.max(this.leftBottomCornerGroup.attribute.height,this.bottomFrozenGroup.attribute.height,this.rightBottomCornerGroup.attribute.height,0))}),this.tableGroup.border&&"rect"===this.tableGroup.border.type?this.table.theme.frameStyle?.innerBorder?this.tableGroup.border.setAttributes({x:this.table.tableX+this.tableGroup.border.attribute.lineWidth/2,y:this.table.tableY+this.tableGroup.border.attribute.lineWidth/2,width:this.tableGroup.attribute.width-this.tableGroup.border.attribute.lineWidth,height:this.tableGroup.attribute.height-this.tableGroup.border.attribute.lineWidth}):this.tableGroup.border.setAttributes({x:this.table.tableX-this.tableGroup.border.attribute.lineWidth/2,y:this.table.tableY-this.tableGroup.border.attribute.lineWidth/2,width:this.tableGroup.attribute.width+this.tableGroup.border.attribute.lineWidth,height:this.tableGroup.attribute.height+this.tableGroup.border.attribute.lineWidth}):this.tableGroup.border&&"group"===this.tableGroup.border.type&&(this.table.theme.frameStyle?.innerBorder?(this.tableGroup.border.setAttributes({x:this.table.tableX+this.tableGroup.border.attribute.lineWidth/2,y:this.table.tableY+this.tableGroup.border.attribute.lineWidth/2,width:this.tableGroup.attribute.width-this.tableGroup.border.attribute.lineWidth,height:this.tableGroup.attribute.height-this.tableGroup.border.attribute.lineWidth}),this.tableGroup.border.firstChild?.setAttributes({x:0,y:0,width:this.tableGroup.attribute.width-this.tableGroup.border.attribute.lineWidth,height:this.tableGroup.attribute.height-this.tableGroup.border.attribute.lineWidth})):(this.tableGroup.border.setAttributes({x:this.table.tableX-this.tableGroup.border.attribute.lineWidth/2,y:this.table.tableY-this.tableGroup.border.attribute.lineWidth/2,width:this.tableGroup.attribute.width+this.tableGroup.border.attribute.lineWidth,height:this.tableGroup.attribute.height+this.tableGroup.border.attribute.lineWidth}),this.tableGroup.border.firstChild?.setAttributes({x:this.tableGroup.border.attribute.lineWidth/2,y:this.tableGroup.border.attribute.lineWidth/2,width:this.tableGroup.attribute.width,height:this.tableGroup.attribute.height}))),this.table.bottomFrozenRowCount>0&&(this.bottomFrozenGroup.setAttribute("y",this.tableGroup.attribute.height-this.table.getBottomFrozenRowsHeight()),this.leftBottomCornerGroup.setAttributes({visible:!0,y:this.tableGroup.attribute.height-this.table.getBottomFrozenRowsHeight(),height:this.table.getBottomFrozenRowsHeight(),width:this.table.getFrozenColsWidth()}),this.rightBottomCornerGroup.setAttributes({visible:!0,y:this.tableGroup.attribute.height-this.table.getBottomFrozenRowsHeight(),height:this.table.getBottomFrozenRowsHeight()})),this.table.rightFrozenColCount>0&&(this.rightFrozenGroup.setAttribute("x",this.tableGroup.attribute.width-this.table.getRightFrozenColsWidth()),this.rightTopCornerGroup.setAttributes({visible:!0,x:this.tableGroup.attribute.width-this.table.getRightFrozenColsWidth(),width:this.table.getRightFrozenColsWidth(),height:this.table.getFrozenRowsHeight()}),this.rightBottomCornerGroup.setAttributes({visible:!0,x:this.tableGroup.attribute.width-this.table.getRightFrozenColsWidth(),width:this.table.getRightFrozenColsWidth()}))}updateRowHeight(t,e,i){ZB(this,t,e=Math.round(e),i),this.updateContainerHeight(t,e)}updateRowsHeight(t,e,i){for(let r=0;r<t.length;r++){const o=t[r];if(o>=this.proxy.rowStart&&o<=this.proxy.rowEnd){const t=e[r];ZB(this,o,Math.round(t),i),this._updateContainerHeight(o,t)}}this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame()}updateContainerWidth(t,e){t<this.frozenColCount?(this.rowHeaderGroup.setDeltaWidth(e),this.cornerHeaderGroup.setDeltaWidth(e),this.colHeaderGroup.setDeltaX(e),this.bodyGroup.setDeltaX(e)):(this.colHeaderGroup.setDeltaWidth(e),this.bodyGroup.setDeltaWidth(e)),this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame()}_updateContainerHeight(t,e){t<this.table.frozenRowCount?(this.colHeaderGroup.setDeltaHeight(e),this.cornerHeaderGroup.setDeltaHeight(e),this.rowHeaderGroup.setDeltaY(e),this.bodyGroup.setDeltaY(e),this.table.rightFrozenColCount&&this.rightFrozenGroup.setDeltaY(e)):t>=this.table.rowCount-this.table.bottomFrozenRowCount?(this.leftBottomCornerGroup.setDeltaHeight(e),this.bottomFrozenGroup.setDeltaHeight(e),this.table.rightFrozenColCount&&this.rightBottomCornerGroup.setDeltaHeight(e)):(this.rowHeaderGroup.setDeltaHeight(e),this.bodyGroup.setDeltaHeight(e),this.table.rightFrozenColCount&&this.rightFrozenGroup.setDeltaHeight(e))}updateContainerHeight(t,e){this._updateContainerHeight(t,e),this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame()}setColWidth(t,e){const i=this.table.getColWidth(t);i!==e&&(this.updateColWidth(t,e-i),this.table._clearColRangeWidthsMap(t))}setRowHeight(t,e){const i=this.table.getRowHeight(t);i!==e&&((t>=this.proxy.rowStart&&t<=this.proxy.rowEnd||t>=this.table.rowCount-this.table.bottomFrozenRowCount&&t<=this.table.rowCount-1||t<this.table.frozenRowCount)&&this.updateRowHeight(t,e-i),this.table._clearRowRangeHeightsMap(t))}setX(t,e=!1){this.table.scenegraph.proxy.setX(-t,e)}setY(t,e=!1){this.table.scenegraph.proxy.setY(-t,e)}setBodyAndRowHeaderY(t){const e=this.bodyGroup.firstChild?.firstChild,i=this.bodyGroup.firstChild?.lastChild;0===t&&e&&e.row===this.table.frozenRowCount&&e.attribute.y+t<0?t=-e.attribute.y:i&&this.table.tableNoFrameHeight<this.table.getAllRowsHeight()&&i.row===this.table.rowCount-this.table.bottomFrozenRowCount-1&&i.attribute.y+i.attribute.height+t<this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight()&&(t=this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight()-i.attribute.y-i.attribute.height),this.colHeaderGroup.attribute.height+t!==this.bodyGroup.attribute.y&&(this.bodyGroup.setAttribute("y",this.colHeaderGroup.attribute.height+t),this.rowHeaderGroup.setAttribute("y",this.cornerHeaderGroup.attribute.height+t),this.table.rightFrozenColCount>0&&this.rightFrozenGroup.setAttribute("y",this.rightTopCornerGroup.attribute.height+t),this.updateNextFrame())}setBodyAndColHeaderX(t){const e=this.bodyGroup.firstChild,i=this.bodyGroup.lastChild;0===t&&e&&e.col===this.table.frozenColCount&&e.attribute.x+t<0?t=-e.attribute.x:i&&this.table.tableNoFrameWidth<this.table.getAllColsWidth()&&i.col===this.table.colCount-this.table.rightFrozenColCount-1&&i.attribute.x+i.attribute.width+t<this.table.tableNoFrameWidth-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth()&&(t=this.table.tableNoFrameWidth-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth()-i.attribute.x-i.attribute.width),this.table.getFrozenColsWidth()+t!==this.bodyGroup.attribute.x&&(this.bodyGroup.setAttribute("x",this.table.getFrozenColsWidth()+t),this.colHeaderGroup.setAttribute("x",this.table.getFrozenColsWidth()+t),this.table.bottomFrozenRowCount>0&&this.bottomFrozenGroup.setAttribute("x",this.table.getFrozenColsWidth()+t),this.updateNextFrame())}afterScenegraphCreated(){this.isPivot||this.table.transpose?this.table.options.frozenColCount?this.component.setFrozenColumnShadow(this.table.frozenColCount-1):this.table.options.rightFrozenColCount?this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount):this.component.setFrozenColumnShadow(-1):(this.component.setFrozenColumnShadow(this.table.frozenColCount-1),this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount)),this.table.stateManager.checkFrozen(),this.updateContainer(),this.createFrameBorder(),this.updateBorderSizeAndPosition(),this.component.updateScrollBar(),wT(this.table),this.updateNextFrame()}dealWidthMode(){const t=this.table;if("adaptive"===t.widthMode){t._clearColRangeWidthsMap();const e=t.tableNoFrameWidth;let i=0;for(let e=0;e<t.colCount;e++)if(e<t.rowHeaderLevelCount||t.isPivotChart()&&e>=t.colCount-t.rightFrozenColCount){i+=t.getColWidth(e)}QM(e-i,t.rowHeaderLevelCount,t.isPivotChart()?t.colCount-t.rightFrozenColCount:t.colCount,!1,[],t,!0)}else if(t.autoFillWidth){t._clearColRangeWidthsMap();const e=t.tableNoFrameWidth;let i=0,r=0;for(let e=0;e<t.colCount;e++){const o=t.getColWidth(e);(e<t.rowHeaderLevelCount||t.isPivotChart()&&e>=t.colCount-t.rightFrozenColCount)&&(i+=o),r+=o}if(r<e&&r>i){QM(e-i,t.rowHeaderLevelCount,t.isPivotChart()?t.colCount-t.rightFrozenColCount:t.colCount,!1,[],t,!0)}}let e=0;this.bodyGroup.forEachChildrenSkipChild((t=>{e+=t.attribute.width})),this.bodyGroup.setAttribute("width",e);let i=0;this.colHeaderGroup.forEachChildrenSkipChild((t=>{i+=t.attribute.width})),this.colHeaderGroup.setAttribute("width",i);let r=0;this.rowHeaderGroup.forEachChildrenSkipChild((t=>{r+=t.attribute.width})),this.rowHeaderGroup.setAttribute("width",r);let o=0;this.cornerHeaderGroup.forEachChildrenSkipChild((t=>{o+=t.attribute.width})),this.cornerHeaderGroup.setAttribute("width",o),this.colHeaderGroup.setAttribute("x",this.cornerHeaderGroup.attribute.width),this.rowHeaderGroup.setAttribute("y",this.cornerHeaderGroup.attribute.height),this.bodyGroup.setAttributes({x:this.rowHeaderGroup.attribute.width,y:this.colHeaderGroup.attribute.height})}dealHeightMode(){const t=this.table;if("adaptive"===t.heightMode){t._clearRowRangeHeightsMap();const e=t.getRowsHeight(0,t.columnHeaderLevelCount-1),i=t.isPivotChart()?t.getBottomFrozenRowsHeight():0,r=t.tableNoFrameHeight-e-i,o=t.columnHeaderLevelCount,n=t.isPivotChart()?t.rowCount-t.bottomFrozenRowCount:t.rowCount;let s=0;for(let e=o;e<n;e++)s+=t.getRowHeight(e);const a=r/s;for(let e=o;e<n;e++){let i;i=e===n-1?r-t.getRowsHeight(o,n-2):Math.round(t.getRowHeight(e)*a),this.setRowHeight(e,i)}}else if(t.autoFillHeight){t._clearRowRangeHeightsMap();const e=t.tableNoFrameHeight;let i=0,r=0;for(let e=0;e<t.rowCount;e++){const o=t.getRowHeight(e);(e<t.columnHeaderLevelCount||t.isPivotChart()&&e>=t.rowCount-t.bottomFrozenRowCount)&&(r+=o),i+=o}if((this._dealAutoFillHeightOriginRowsHeight??i)<e&&i-r>0){const o=t.columnHeaderLevelCount,n=t.isPivotChart()?t.rowCount-t.bottomFrozenRowCount:t.rowCount,s=(e-r)/(i-r);for(let i=o;i<n;i++){let a;a=i===n-1?e-r-t.getRowsHeight(o,n-2):Math.round(t.getRowHeight(i)*s),this.setRowHeight(i,a)}}}}dealFrozen(){!function(t){if(t.table.frozenColCount>t.table.rowHeaderLevelCount){t.rowHeaderGroup.setAttribute("height",t.bodyGroup.attribute.height),t.rowHeaderGroup.setAttribute("y",t.bodyGroup.attribute.y),t.cornerHeaderGroup.setAttribute("height",t.colHeaderGroup.attribute.height);for(let e=0;e<t.table.frozenColCount-t.table.rowHeaderLevelCount;e++)DT(t),WT(t),jT(t)}else if(t.table.frozenColCount<t.table.rowHeaderLevelCount)for(let e=0;e<t.table.rowHeaderLevelCount-t.table.frozenColCount;e++)NT(t),GT(t),VT(t);t.bodyGroup.setAttribute("x",t.rowHeaderGroup.attribute.width),t.colHeaderGroup.setAttribute("x",t.cornerHeaderGroup.attribute.width),t.updateContainer(),t.updateBorderSizeAndPosition(),t.isPivot||t.table.transpose?t.table.options.frozenColCount?t.component.setFrozenColumnShadow(t.table.frozenColCount-1):t.table.options.frozenColCount&&t.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount):(t.component.setFrozenColumnShadow(t.table.frozenColCount-1),t.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount)),t.hasFrozen=!0,t.frozenColCount=t.table.frozenColCount,t.frozenRowCount=t.colHeaderGroup.firstChild?.childrenCount??0}(this)}resetFrozen(){!function(t){if(t.frozenColCount>t.table.frozenColCount)for(let e=0;e<t.frozenColCount-t.table.frozenColCount;e++)NT(t),GT(t),VT(t);else if(t.frozenColCount<t.table.frozenColCount){t.rowHeaderGroup.setAttribute("height",t.bodyGroup.attribute.height),t.rowHeaderGroup.setAttribute("y",t.bodyGroup.attribute.y),t.cornerHeaderGroup.setAttribute("height",t.colHeaderGroup.attribute.height);for(let e=0;e<t.table.frozenColCount-t.frozenColCount;e++)DT(t),WT(t),jT(t)}t.deleteAllSelectBorder(),t.table.stateManager.select.ranges.forEach((e=>{t.updateCellSelectBorder(e.start.col,e.start.row,e.end.col,e.end.row)})),t.frozenColCount=t.table.frozenColCount,t.frozenRowCount=t.colHeaderGroup.firstChild?.childrenCount??0,t.proxy.colStart=t.table.frozenColCount,t.bodyGroup.setAttribute("x",t.rowHeaderGroup.attribute.width),t.colHeaderGroup.setAttribute("x",t.cornerHeaderGroup.attribute.width),t.updateContainer(),t.updateBorderSizeAndPosition(),t.isPivot||t.table.transpose?t.table.options.frozenColCount?t.component.setFrozenColumnShadow(t.table.frozenColCount-1):t.table.options.rightFrozenColCount&&t.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount):(t.component.setFrozenColumnShadow(t.table.frozenColCount-1),t.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount)),t.hasFrozen=!0}(this)}updateCellLayoutWidthCertainWidth(t,e,i){const r=t.attribute.width;let o=!1;return t.forEachChildren(((t,n)=>{n+=e;const s=iv(this.table,i,n);s?t=this.getCell(s.start.col,s.start.row):t.setAttribute("width",r);const a=BA(RR("padding",this.table._getCellStyle(i,n),i,n,this.table)),l=t.getChildByName("text");let h=0,c=0;if(l)h=l.AABBBounds.height()+(a[0]+a[2]),l.setAttribute("maxLineWidth",r-(a[1]+a[3])),c=l.AABBBounds.height()+(a[0]+a[2]);else{const e=t.getChildAt(1);h=e.AABBBounds.height()+(a[0]+a[2]),e._cellWidth=r-(a[1]+a[3]),e.layout(),c=e.AABBBounds.height()+(a[0]+a[2])}const d=this.table.getRowHeight(n);t.attribute.height!==c&&(t.setAttribute("height",c),(d===h||c>d)&&(o=!0))})),o}updateHeaderPosition(t,e,i,r,o){!function(t,e,i,r,o,n){const s=n.scenegraph;for(let i=t;i<=e;i++){const t=n.getColWidth(i),e=n.scenegraph.getColGroup(i,!0),r=n.scenegraph.getColGroup(i),o=n.scenegraph.getColGroupInBottom(i),s=n.scenegraph.getColGroupInLeftBottomCorner(i),a=n.scenegraph.getColGroupInRightBottomCorner(i);e&&(e.setAttribute("width",t),e.forEachChildren((e=>{e.setAttribute("width",t)}))),r&&(r.setAttribute("width",t),r.forEachChildren((e=>{e.setAttribute("width",t)}))),o&&(o.setAttribute("width",t),o.forEachChildren((e=>{e.setAttribute("width",t)}))),a&&(a.setAttribute("width",t),a.forEachChildren((e=>{e.setAttribute("width",t)}))),s&&(s.setAttribute("width",t),s.forEachChildren((e=>{e.setAttribute("width",t)})))}if(s.updateContainer(),"column"===o)for(let i=t;i<=e;i++){const t=n.scenegraph.getColGroup(i);t?.setAttribute("chartInstance",void 0);for(let t=0;t<=n.frozenRowCount-1;t++)s.updateCellContent(i,t);for(let t=s.bodyRowStart;t<=s.bodyRowEnd;t++)s.updateCellContent(i,t);for(let t=n.rowCount-n.bottomFrozenRowCount;t<=n.rowCount-1;t++)s.updateCellContent(i,t)}else{for(let t=0;t<=n.frozenColCount-1;t++){const e=n.scenegraph.getColGroup(t);e?.setAttribute("chartInstance",void 0);for(let e=i;e<=r;e++)s.updateCellContent(t,e)}for(let t=s.bodyColStart;t<=s.bodyColEnd;t++){const e=n.scenegraph.getColGroup(t);e?.setAttribute("chartInstance",void 0);for(let e=i;e<=r;e++)s.updateCellContent(t,e)}for(let t=n.colCount-n.rightFrozenColCount;t<=n.colCount-1;t++){const e=n.scenegraph.getColGroup(t);e?.setAttribute("chartInstance",void 0);for(let e=i;e<=r;e++)s.updateCellContent(t,e)}}}(t,e,i,r,o,this.table)}updateContainerAttrWidthAndX(){const t=YT(this.cornerHeaderGroup,0),e=YT(this.rowHeaderGroup,0),i=this.colHeaderGroup.hasChildNodes()&&this.colHeaderGroup.firstChild?YT(this.colHeaderGroup,this.colHeaderGroup.firstChild.col>0?this.table.getColsWidth(this.table.frozenColCount??0,this.colHeaderGroup.firstChild.col-1):0):0,r=this.bodyGroup.hasChildNodes()&&this.bodyGroup.firstChild?YT(this.bodyGroup,this.bodyGroup.firstChild.col>0?this.table.getColsWidth(this.table.frozenColCount??0,this.bodyGroup.firstChild.col-1):0):0,o=YT(this.rightFrozenGroup,0);this.bottomFrozenGroup.hasChildNodes()&&this.bottomFrozenGroup.firstChild&&YT(this.bottomFrozenGroup,this.bottomFrozenGroup.firstChild.col>0?this.table.getColsWidth(this.table.frozenColCount??0,this.bottomFrozenGroup.firstChild.col-1):0),YT(this.leftBottomCornerGroup,0),YT(this.rightTopCornerGroup,0),YT(this.rightBottomCornerGroup,0),this.cornerHeaderGroup.setDeltaWidth(t-this.cornerHeaderGroup.attribute.width),this.leftBottomCornerGroup.setDeltaWidth(t-this.leftBottomCornerGroup.attribute.width),this.colHeaderGroup.setDeltaWidth(i-this.colHeaderGroup.attribute.width),this.rowHeaderGroup.setDeltaWidth(e-this.rowHeaderGroup.attribute.width),this.bottomFrozenGroup.setDeltaWidth(i-this.bottomFrozenGroup.attribute.width),this.rightFrozenGroup.setDeltaWidth(o-this.rightFrozenGroup.attribute.width),this.rightTopCornerGroup.setDeltaWidth(o-this.rightTopCornerGroup.attribute.width),this.rightBottomCornerGroup.setDeltaWidth(o-this.rightBottomCornerGroup.attribute.width),this.bodyGroup.setDeltaWidth(r-this.bodyGroup.attribute.width),this.colHeaderGroup.setAttribute("x",this.cornerHeaderGroup.attribute.width),this.bottomFrozenGroup.setAttribute("x",this.table.getFrozenColsWidth()),this.bodyGroup.setAttribute("x",this.rowHeaderGroup.attribute.width)}updateContainer(t=!1){t?this._needUpdateContainer||(this._needUpdateContainer=!0,setTimeout((()=>{this.updateContainerSync()}),0)):(this._needUpdateContainer=!0,this.updateContainerSync())}updateContainerSync(){this._needUpdateContainer&&(this._needUpdateContainer=!1,this.updateContainerAttrWidthAndX(),this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame())}updateCellContentWhileResize(t,e){const i=this.table.getBodyColumnType(t,e),r=this.getCell(t,e);"image"!==i&&"video"!==i||PR(r,t,e,this.table)}createFrameBorder(){this.updateTableSize();const t=!this.isPivot&&!this.table.internalProps.transpose;hM(this.bodyGroup,this.table.theme.bodyStyle.frameStyle,this.bodyGroup.role,t?[!0,!0,!0,!1]:void 0),hM(this.rowHeaderGroup,this.isPivot||this.table.internalProps.transpose?this.table.theme.rowHeaderStyle.frameStyle:this.table.theme.bodyStyle.frameStyle,this.rowHeaderGroup.role,t?[!0,!1,!0,!0]:void 0),hM(this.colHeaderGroup,this.table.theme.headerStyle.frameStyle,this.colHeaderGroup.role,t?[!0,!0,!0,!1]:void 0),hM(this.cornerHeaderGroup,this.isPivot?this.table.theme.cornerHeaderStyle.frameStyle:this.table.theme.headerStyle.frameStyle,this.cornerHeaderGroup.role,t?[!0,!1,!0,!0]:void 0),hM(this.tableGroup,this.table.theme.frameStyle,this.tableGroup.role,void 0)}getResizeColAt(t,e,i,r=8){let o;return i?(t<i.globalAABBBounds.x1+r?o={col:i.col-1,row:i.row,x:i.globalAABBBounds.x1}:i.globalAABBBounds.x2-r<t&&(o={col:i.col,row:i.row,x:i.globalAABBBounds.x2}),o&&this.table.rightFrozenColCount>0&&o.col===this.table.colCount-this.table.rightFrozenColCount-1&&this.table.tableNoFrameWidth-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth()+this.table.scrollLeft<this.bodyGroup.attribute.width&&(o.col=o.col+1,o.rightFrozen=!0)):o=this.table.getCellAt(t-r,e),o||{col:-1,row:-1}}getResizeRowAt(t,e,i,r=8){if(i){let t;if(e<i.globalAABBBounds.y1+r?t={col:i.col,row:i.row-1,y:i.globalAABBBounds.y1}:i.globalAABBBounds.y2-r<e&&(t={col:i.col,row:i.row,y:i.globalAABBBounds.y2}),t&&this.table.bottomFrozenRowCount>0&&t.row===this.table.rowCount-this.table.bottomFrozenRowCount-1&&this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight()+this.table.scrollTop<this.bodyGroup.attribute.height&&(t.row=t.row+1,t.bottomFrozen=!0),t)return t}else;return{col:-1,row:-1}}updateFrozen(){this.clear||(this.resetFrozen(),this.component.updateScrollBar())}dealWidthRightFrozen(t){this.clear?this.table.internalProps.rightFrozenColCount=t:function(t,e){const{table:i,proxy:r,rightTopCornerGroup:o,rightFrozenGroup:n,rightBottomCornerGroup:s,bottomFrozenGroup:a,bodyGroup:l,colHeaderGroup:h}=e,c=e.table.rightFrozenColCount;if(t>c){for(let r=i.colCount-c-1;r>=i.colCount-t;r--)UT(n,e.getColGroup(r),n.firstChild),UT(o,e.getColGroup(r,!0),o.firstChild),UT(s,e.getColGroupInBottom(r),s.firstChild);let r=0;n.forEachChildren((t=>{t.setAttribute("x",r),r+=t.attribute.width})),r=0,o.forEachChildren((t=>{t.setAttribute("x",r),r+=t.attribute.width})),r=0,s.forEachChildren((t=>{t.setAttribute("x",r),r+=t.attribute.width}))}else if(t<c){for(let r=i.colCount-c;r<i.colCount-t;r++){const t=e.getColGroup(r);t.setAttribute("x",l.lastChild.attribute.x+i.getColWidth(l.lastChild.col)),l.appendChild(t);const o=e.getColGroupInRightTopCorner(r);o.setAttribute("x",h.lastChild.attribute.x+i.getColWidth(h.lastChild.col)),h.appendChild(o);const n=e.getColGroupInRightBottomCorner(r);n.setAttribute("x",a.lastChild.attribute.x+i.getColWidth(a.lastChild.col)),a.appendChild(n)}let r=0;n.forEachChildren((t=>{t.setAttribute("x",r),r+=t.attribute.width})),r=0,o.forEachChildren((t=>{t.setAttribute("x",r),r+=t.attribute.width})),r=0,s.forEachChildren((t=>{t.setAttribute("x",r),r+=t.attribute.width}))}n.setAttribute("width",i.getColsWidth(i.colCount-t,i.colCount-1)),o.setAttribute("width",i.getColsWidth(i.colCount-t,i.colCount-1)),s.setAttribute("width",i.getColsWidth(i.colCount-t,i.colCount-1)),i.internalProps.rightFrozenColCount=t,e.updateContainer(),e.component.updateScrollBar(),e.updateNextFrame()}(t,this)}dealWidthBottomFrozen(t){this.clear?this.table.internalProps.bottomFrozenRowCount=t:function(t,e){const{table:i,proxy:r,bottomFrozenGroup:o,leftBottomCornerGroup:n,rightBottomCornerGroup:s}=e;o.childrenCount||(r.table.isPivotChart()||(oT(n,0,0,0,i.frozenColCount-1,0,-1,"rowHeader",i),oT(s,0,0,i.colCount-i.rightFrozenColCount,i.colCount-1,0,-1,"body",i)),oT(o,0,0,r.colStart,r.colEnd,0,-1,"body",i));const a=e.table.bottomFrozenRowCount;if(t>a){for(let r=0;r<i.frozenColCount;r++){const o=e.getColGroupInLeftBottomCorner(r);for(let n=i.rowCount-a-1;n>=i.rowCount-t;n--)UT(o,e.getCell(r,n,!0),o.firstChild);let n=0;o.forEachChildren((t=>{t.setAttribute("y",n),n+=i.getRowHeight(t.row)}))}for(let o=r.colStart;o<=r.colEnd;o++){const r=e.getColGroupInBottom(o);for(let n=i.rowCount-a-1;n>=i.rowCount-t;n--)UT(r,e.getCell(o,n,!0),r.firstChild);let n=0;r.forEachChildren((t=>{t.setAttribute("y",n),n+=i.getRowHeight(t.row)}))}if(i.rightFrozenColCount>0)for(let r=i.colCount-i.rightFrozenColCount;r<i.colCount;r++){const o=e.getColGroupInRightBottomCorner(r);for(let n=i.rowCount-a-1;n>=i.rowCount-t;n--)UT(o,e.getCell(r,n,!0),o.firstChild);let n=0;o.forEachChildren((t=>{t.setAttribute("y",n),n+=i.getRowHeight(t.row)}))}}else if(t<a){for(let r=0;r<i.rowHeaderLevelCount;r++){const o=e.getColGroup(r);for(let n=i.rowCount-a;n<i.rowCount-t;n++){const t=e.getCell(r,n,!0);t.setAttribute("y",o.lastChild.attribute.y+i.getRowHeight(o.lastChild.row)),o.appendChild(t)}const n=e.getColGroupInLeftBottomCorner(r);let s=0;n.forEachChildren((t=>{t.setAttribute("y",s),s+=i.getRowHeight(t.row)}))}for(let o=r.colStart;o<=r.colEnd;o++){const r=e.getColGroup(o);for(let n=i.rowCount-a;n<i.rowCount-t;n++){const t=e.getCell(o,n,!0);t.setAttribute("y",r.lastChild.attribute.y+i.getRowHeight(r.lastChild.row)),r.appendChild(t)}const n=e.getColGroupInBottom(o);let s=0;n.forEachChildren((t=>{t.setAttribute("y",s),s+=i.getRowHeight(t.row)}))}if(i.rightFrozenColCount>0)for(let r=i.colCount-i.rightFrozenColCount;r<i.colCount;r++){const o=e.getColGroup(r);for(let n=i.rowCount-a;n<i.rowCount-t;n++){const t=e.getCell(r,n,!0);t.setAttribute("y",o.lastChild.attribute.y+i.getRowHeight(o.lastChild.row)),o.appendChild(t)}const n=e.getColGroupInRightBottomCorner(r);let s=0;n.forEachChildren((t=>{t.setAttribute("y",s),s+=i.getRowHeight(t.row)}))}}o.setAttribute("height",i.getRowsHeight(i.rowCount-t,i.rowCount-1)),n.setAttribute("height",i.getRowsHeight(i.rowCount-t,i.rowCount-1)),s.setAttribute("height",i.getRowsHeight(i.rowCount-t,i.rowCount-1)),i.internalProps.bottomFrozenRowCount=t,e.updateContainer(),e.component.updateScrollBar(),e.updateNextFrame()}(t,this)}updateBorderSizeAndPosition(){this.bodyGroup.border&&(this.bodyGroup.appendChild(this.bodyGroup.border),uM(this.bodyGroup),this.rowHeaderGroup.attribute.width,cM(this.bodyGroup,this.table.theme.bodyStyle.frameStyle)),this.colHeaderGroup.border&&(this.colHeaderGroup.appendChild(this.colHeaderGroup.border),uM(this.colHeaderGroup),this.cornerHeaderGroup.attribute.width,cM(this.colHeaderGroup,this.table.theme.headerStyle.frameStyle)),this.rowHeaderGroup.border&&(this.rowHeaderGroup.appendChild(this.rowHeaderGroup.border),uM(this.rowHeaderGroup)),this.cornerHeaderGroup.border&&(this.cornerHeaderGroup.appendChild(this.cornerHeaderGroup.border),uM(this.cornerHeaderGroup)),function(t){if(!t.theme.frameStyle.cornerRadius)return;const e=t.theme.frameStyle.cornerRadius,{cornerHeaderGroup:i,colHeaderGroup:r,rowHeaderGroup:o,bodyGroup:n,rightTopCornerGroup:s,leftBottomCornerGroup:a,rightBottomCornerGroup:l,rightFrozenGroup:h,bottomFrozenGroup:c}=t.scenegraph;i.setAttribute("cornerRadius",0),r.setAttribute("cornerRadius",0),o.setAttribute("cornerRadius",0),n.setAttribute("cornerRadius",0),s.setAttribute("cornerRadius",0),a.setAttribute("cornerRadius",0),l.setAttribute("cornerRadius",0),h.setAttribute("cornerRadius",0),c.setAttribute("cornerRadius",0),i.attribute.width>0&&i.attribute.height>0?gM(i,[e,0,0,0]):r.attribute.height>0?gM(r,[e,0,0,0]):o.attribute.width>0?gM(o,[e,0,0,0]):gM(n,[e,0,0,0]),a.attribute.width>0&&a.attribute.height>0?gM(a,[0,0,0,e]):c.attribute.height>0?gM(c,[0,0,0,e]):o.attribute.width>0?gM(o,[0,0,0,e]):gM(n,[0,0,0,e]),s.attribute.width>0&&s.attribute.height>0?gM(s,[0,e,0,0]):r.attribute.height>0?gM(r,[0,e,0,0]):h.attribute.width>0?gM(h,[0,e,0,0]):gM(n,[0,e,0,0]),l.attribute.width>0&&l.attribute.height>0?gM(l,[0,0,e,0]):h.attribute.width>0?gM(h,[0,0,e,0]):c.attribute.height>0?gM(c,[0,0,e,0]):gM(n,[0,0,e,0])}(this.table)}sortCell(){this.isPivot||(this.table.transpose?this.proxy.sortCellHorizontal():this.proxy.sortCellVertical())}getCellOverflowText(t,e){const i=this.getCell(t,e).getChildByName("text",!0);if(i&&"text"===i.type){const t=et(i.attribute.text)?i.attribute.text.join(""):i.attribute.text;let e="";if(tt(i.cache.clipedText)?e=i.cache.clipedText:i.cache.layoutData?.lines?.forEach((t=>{e+=t.str})),e!==t)return t}else if(i&&"richtext"===i.type){const t=i;if(t.attribute.ellipsis&&t._frameCache&&t.attribute.height<t._frameCache.actualHeight){return t.attribute.textConfig.find((t=>t.text)).text}}return null}updateDrill(t,e,i,r,o){this.component.drillIcon.update(t,e,i,r,o,this)}updateCellContent(t,e){if(!this.clear)return nB(t,e,this.table)}setPixelRatio(t){this.stage.disableDirtyBounds(),this.stage.window.setDpr(t),this.stage.render(),this.stage.enableDirtyBounds()}updateRow(t,e,i=[]){this.table.internalProps.layoutMap.clearCellRangeMap();const r=qC(e.map((t=>t.row))).sort(((t,e)=>t-e)),o=qC(i.map((t=>t.row))).sort(((t,e)=>t-e)),n=this.table.getAllRowsHeight()-[...r,...o].reduce(((t,e)=>t+this.table.getRowHeight(e)),0)<=this.table.tableNoFrameHeight;if(LT(t,e,i,this.table),this.recalculateColWidths(),"adaptive"===this.table.heightMode||this.table.autoFillHeight&&(this.table.getAllRowsHeight()<=this.table.tableNoFrameHeight||n))this.table.scenegraph.recalculateRowHeights();else if("autoHeight"===this.table.heightMode)for(let t=0;t<o.length;t++){const e=o[t],i=this.table.getRowHeight(e),r=VB(e,0,this.table.colCount-1,this.table);(e>=this.proxy.rowStart&&e<=this.proxy.rowEnd||e>=this.table.rowCount-this.table.bottomFrozenRowCount&&e<=this.table.rowCount-1)&&this.table.scenegraph.updateRowHeight(e,r-i)}this.table.stateManager.checkFrozen(),this.isPivot||this.table.transpose?this.table.options.frozenColCount?this.component.setFrozenColumnShadow(this.table.frozenColCount-1):this.table.options.rightFrozenColCount&&this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount):(this.component.setFrozenColumnShadow(this.table.frozenColCount-1),this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount)),this.component.updateScrollBar(),this.updateNextFrame()}updateCol(t,e,i=[]){eP(t,e,i,this.table),this.recalculateColWidths(),this.recalculateRowHeights(),this.table.stateManager.checkFrozen(),this.isPivot||this.table.transpose?this.table.options.frozenColCount?this.component.setFrozenColumnShadow(this.table.frozenColCount-1):this.table.options.rightFrozenColCount&&this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount):(this.component.setFrozenColumnShadow(this.table.frozenColCount-1),this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount)),this.component.updateScrollBar(),this.updateNextFrame()}getColumnGroupX(t){return t<this.table.rowHeaderLevelCount?this.table.getColsWidth(0,t-1):t<this.table.colCount-this.table.rightFrozenColCount?this.table.getColsWidth(this.table.rowHeaderLevelCount,t-1):t<this.table.colCount?this.table.getColsWidth(this.table.colCount-this.table.bottomFrozenRowCount,t-1):0}getCellGroupY(t){return t<this.table.columnHeaderLevelCount?this.table.getRowsHeight(0,t-1):t<this.table.rowCount-this.table.bottomFrozenRowCount?this.table.getRowsHeight(this.table.columnHeaderLevelCount,t-1):t<this.table.rowCount?this.table.getRowsHeight(this.table.rowCount-this.table.bottomFrozenRowCount,t-1):0}getCellGroupX(t){return t<this.table.rowHeaderLevelCount?this.table.getColsWidth(0,t-1):t<this.table.colCount-this.table.rightFrozenColCount?this.table.getColsWidth(this.table.rowHeaderLevelCount,t-1):t<this.table.colCount?this.table.getColsWidth(this.table.colCount-this.table.rightFrozenColCount,t-1):0}}function sP(t,e,i){const r=t.highPerformanceGetCell(e,i);if("cell"===r.role&&Y(r.mergeStartCol)&&Y(r.mergeStartRow)&&Y(r.mergeEndCol)&&Y(r.mergeEndRow)){const{colStart:e,colEnd:i,rowStart:o,rowEnd:n}=qB(r,t);for(let r=e;r<=i;r++)for(let e=o;e<=n;e++){t.highPerformanceGetCell(r,e).addUpdateBoundTag()}}else r.addUpdateBoundTag()}function aP(t,e,i,r,o){const n=t.table;for(let i=0;i<n.columnHeaderLevelCount;i++)sP(t,e,i);const s=t.getColGroup(e);return s?.addUpdateBoundTag(),!0}function lP(t,e,i,r,o,n){const s=t.table;for(let i=0;i<s.columnHeaderLevelCount;i++)sP(t,e,i);const a=t.getColGroup(e);return a?.addUpdateBoundTag(),!0}function hP(t,e,i,r,o){const n=t.table;for(let e=0;e<n.colCount;e++)sP(t,e,i);return!0}function cP(t,e,i,r,o,n){const s=t.table;for(let e=0;e<s.colCount;e++)sP(t,e,i);return!0}function dP(t,e,i){const{table:r}=t,{scenegraph:o}=r,{highlightScope:n,singleStyle:s,disableHeader:a,cellPos:l,cellPosContainHeader:h}=t.hover,c=l.col,d=l.row;if(n===iC.none||a&&(h.col!==e||h.row!==i)){const t=h.col,r=h.row;o.hideHoverIcon(t,r),o.showHoverIcon(e,i),h.col=e,h.row=i}if((a&&r.isHeader(e,i)||n===iC.none)&&(e=-1,i=-1),c===e&&d===i)return;o.deactivateChart(c,d),o.activateChart(e,i);let u=!1;const{ranges:g,highlightScope:p}=t.select;if(-1!==c&&-1!==d&&(u=function(t,e,i,r,o,n,s){let a=!1;n===iC.single?a=!!function(t,e,i,r,o){return sP(t,e,i),!0}(t,e,i)||a:n===iC.row?a=!!hP(t,0,i)||a:n===iC.column?a=!!aP(t,e)||a:n===iC.cross&&(a=!!hP(t,0,i)||a,a=!!aP(t,e)||a);return a}(o,c,d,0,0,n),a||o.hideHoverIcon(c,d)),-1===e||-1===i)return l.col=-1,l.row=-1,void(!u||c===e&&d===i||t.table.scenegraph.updateNextFrame());n===iC.single?u=!!function(t,e,i,r,o){return sP(t,e,i),!0}(o,e,i)||u:n===iC.row?u=!!cP(o,0,i)||u:n===iC.column?u=!!lP(o,e)||u:n===iC.cross&&(u=!!cP(o,0,i)||u,u=!!lP(o,e)||u),n===iC.none||a||o.showHoverIcon(e,i),l.col=e,l.row=i,u&&t.table.scenegraph.updateNextFrame()}function uP(t,e,i,r){let o,n=null,s=!1;if(Array.isArray(i.sortState))for(let r=0;r<i.sortState.length&&(o=i.sortState[r],o&&(n=i._getHeaderCellBySortState(o)),n&&(s=gP(t,e,n.col,n.row,i)),!s);r++);else o=i.sortState,o&&(n=i._getHeaderCellBySortState(o)),n&&(s=gP(t,e,n.col,n.row,i));const a=i.getHeaderDefine(t,e);o&&s&&a?.sort?o.order="asc"===o.order?"desc":"desc"===o.order?"normal":"asc":a?.sort?o={field:i.getHeaderField(t,e),order:"asc"}:s&&a?.showSort||(o={field:i.getHeaderField(t,e),order:"normal"}),o.event=r;i.fireListeners(ww.SORT_CLICK,o).includes(!1)||(i.internalProps.sortState=o,i.stateManager.setSortState(o),a?.sort&&function(t,e,i){const r=e.internalProps.layoutMap.headerObjects.find((e=>e&&e.field===t.field));if(!r)return;const{field:o}=r;if(null===o)return;"function"==typeof i.sort?e.dataSource.sort(o,t.order||"asc",i.sort):e.dataSource.sort(o,t.order||"asc",XC)}(o,i,a),i.internalProps.layoutMap.clearCellRangeMap(),i.scenegraph.sortCell(),i.stateManager.updateSelectPos(-1,-1))}function gP(t,e,i,r,o){return o._getLayoutCellId(t,e)===o._getLayoutCellId(i,r)}const pP=sw(ww,{PIVOT_SORT_CLICK:"pivot_sort_click",DRILLMENU_CLICK:"drillmenu_click"}),fP=sw(ww,{VCHART_EVENT_TYPE:"vchart_event_type"});function mP(t,e,i,r,o){for(let i=t;i<=e;i++)o._clearColRangeWidthsMap(i);for(let t=i;t<=r;t++)o._clearRowRangeHeightsMap(t)}function bP(t){if(!t)return;const e=t.role?.startsWith("icon")?t:"richtext"===t.type?t._currentHoverIcon:void 0;return e?"richtext"===t.type?{icon:e,position:{left:t.globalAABBBounds.x1+e.globalAABBBounds.x1,right:t.globalAABBBounds.x1+e.globalAABBBounds.x2,top:t.globalAABBBounds.y1+e.globalAABBBounds.y1,bottom:t.globalAABBBounds.y1+e.globalAABBBounds.y2,width:e.globalAABBBounds.x2-e.globalAABBBounds.x1,height:e.globalAABBBounds.y2-e.globalAABBBounds.y1},type:"richtext-icon"}:{icon:e,position:{left:e.globalAABBBounds.x1,right:e.globalAABBBounds.x2,top:e.globalAABBBounds.y1,bottom:e.globalAABBBounds.y2,width:e.globalAABBBounds.x2-e.globalAABBBounds.x1,height:e.globalAABBBounds.y2-e.globalAABBBounds.y1},type:"icon"}:void 0}function yP(t,e){"adaptive"===e.table.widthMode&&e.columnResize.col<e.table.colCount-1?(e.table.scenegraph.updateColWidth(e.columnResize.col,t),e.table.scenegraph.updateColWidth(e.columnResize.col+1,-t),e.table.internalProps._widthResizedColMap.add(e.columnResize.col),e.table.internalProps._widthResizedColMap.add(e.columnResize.col+1)):(e.table.scenegraph.updateColWidth(e.columnResize.col,t),e.table.internalProps._widthResizedColMap.add(e.columnResize.col))}function CP(t,e){"adaptive"===e.table.heightMode&&e.rowResize.row<e.table.colCount-1?(e.table.scenegraph.updateRowHeight(e.rowResize.row,t),e.table.scenegraph.updateRowHeight(e.rowResize.row+1,-t),e.table.internalProps._heightResizedRowMap.add(e.rowResize.row),e.table.internalProps._heightResizedRowMap.add(e.rowResize.row+1)):(e.table.scenegraph.updateRowHeight(e.rowResize.row,t),e.table.internalProps._heightResizedRowMap.add(e.rowResize.row))}class wP{table;interactionState;select;fillHandle;hover;hoverIcon;residentHoverIcon;columnResize;rowResize;columnMove;menu;sort;frozen;scroll;tablePosition;drill;sparkLine;_clearVerticalScrollBar;_clearHorizontalScrollBar;fastScrolling=!1;checkedState=[];headerCheckedState={};_checkboxCellTypeFields=[];_headerCheckFuncs={};radioState={};resetInteractionState=xw((()=>{this.updateInteractionState(eC.default)}),100);constructor(t){this.table=t,this.initState(),this.updateVerticalScrollBar=this.updateVerticalScrollBar.bind(this),this.updateHorizontalScrollBar=this.updateHorizontalScrollBar.bind(this)}initState(){this._initState(),this.setHoverState(),this.setSelectState(),this.setFrozenState()}updateOptionSetState(){this._updateOptionSetState(),this.setHoverState(),this.setSelectState(),this.setFrozenState()}_updateOptionSetState(){this.interactionState=eC.default,this.hoverIcon={col:-1,row:-1,icon:null},this.columnResize={col:-1,x:0,resizing:!1},this.rowResize={row:-1,y:0,resizing:!1},this.columnMove={colSource:-1,colTarget:-1,rowSource:-1,rowTarget:-1,x:0,y:0,moving:!1},this.menu={x:-1,y:-1,isShow:!1,itemList:[],bounds:new de,highlightIndex:-1,dropDownMenuHighlight:[]},this.sort={col:-1,row:-1,order:"normal"},this.frozen={col:-1},this.tablePosition={absoluteX:0,absoluteY:0},this.drill={col:-1,row:-1},this.sparkLine={col:-1,row:-1}}_initState(){this.interactionState=eC.default,this.select={highlightScope:iC.single,ranges:[],cellPos:{col:-1,row:-1},selecting:!1},this.fillHandle={isFilling:!1,startX:void 0,startY:void 0},this.hover={highlightScope:iC.single,cellPos:{col:-1,row:-1}},this.hoverIcon={col:-1,row:-1,icon:null},this.columnResize={col:-1,x:0,resizing:!1},this.rowResize={row:-1,y:0,resizing:!1},this.columnMove={colSource:-1,colTarget:-1,rowSource:-1,rowTarget:-1,x:0,y:0,moving:!1},this.menu={x:-1,y:-1,isShow:!1,itemList:[],bounds:new de,highlightIndex:-1,dropDownMenuHighlight:[]},this.sort={col:-1,row:-1,order:"normal"},this.frozen={col:-1},this.scroll={horizontalBarPos:0,verticalBarPos:0},this.tablePosition={absoluteX:0,absoluteY:0},this.drill={col:-1,row:-1},this.sparkLine={col:-1,row:-1}}setHoverState(){const{highlightMode:t,disableHover:e,disableHeaderHover:i}=this.table.options.hover??{highlightMode:"cell"};e?this.hover.highlightScope=iC.none:"cross"===t?this.hover.highlightScope=iC.cross:"row"===t?this.hover.highlightScope=iC.row:"column"===t?this.hover.highlightScope=iC.column:"cell"===t&&(this.hover.highlightScope=iC.single),this.hover.singleStyle=!e,this.hover.disableHeader=i,(this.hover.highlightScope===iC.none||i)&&(this.hover.cellPosContainHeader={col:-1,row:-1})}setSelectState(){const{headerSelectMode:t,disableSelect:e,disableHeaderSelect:i}=Object.assign({},{headerSelectMode:"inline",disableSelect:!1,disableHeaderSelect:!1},this.table.options.select);this.select.highlightScope=e?iC.none:iC.single,this.select.singleStyle=!e,this.select.disableHeader=i,this.select.headerSelectMode=t}isSelected(t,e){let i=!1;return this.select.ranges.forEach((r=>{dw(r,t,e)&&(i=!0)})),i}setSortState(t){this.sort.field=t?.field,this.sort.order=t?.order}setFrozenState(){this.frozen.col=this.table.frozenColCount-1}updateInteractionState(t){if(this.interactionState===t)return;const e=this.interactionState;this.interactionState=t,e===eC.scrolling&&eC.default}updateHoverhighlightScope(t){this.hover.highlightScope!==t&&(this.hover.highlightScope=t)}updateHoverPos(t,e){dP(this,t,e)}updateSelectPos(t,e,i=!1,r=!1,o=!1,n=!1){-1!==e&&-1!==e&&(this.select.selecting=!0),function(t,e,i,r,o,n,s=!1){const{table:a,interactionState:l}=t,{scenegraph:h}=a,{highlightScope:c,disableHeader:d,cellPos:u}=t.select;if((d&&a.isHeader(e,i)||"none"===c)&&(e=-1,i=-1),-1!==e&&-1!==i&&!s)if(l===eC.grabing&&t.select.ranges.length>0){const r=t.select.ranges[t.select.ranges.length-1];e>r.start.col&&e>r.end.col&&a._makeVisibleCell(e+1,i),i>r.start.row&&i>r.end.row&&a._makeVisibleCell(e,i+1),e<r.start.col&&e<r.end.col&&a._makeVisibleCell(e-1,i),i<r.start.row&&i<r.end.row&&a._makeVisibleCell(e,i-1)}else a._makeVisibleCell(e,i);if(n){t.select.ranges=[],h.deleteAllSelectBorder(),t.select.ranges.push({start:{col:0,row:0},end:{col:a.colCount-1,row:a.rowCount-1}});const e=t.select.ranges[t.select.ranges.length-1];h.updateCellSelectBorder(e.start.col,e.start.row,e.end.col,e.end.row,!1)}else if(-1===u.col||-1===u.row||-1!==e&&-1!==i)if(l!==eC.default||a.eventManager.isDraging||a.stateManager.isResizeCol()){if((l===eC.grabing||a.eventManager.isDraging)&&!a.stateManager.isResizeCol()){let r=!0;-1===u.col&&(u.col=e),-1===u.row&&(u.row=i),u.col=e,u.row=i;const o=t.select.ranges[t.select.ranges.length-1];if(o){if(a.internalProps.layoutMap.isSeriesNumberInBody(o.start.col,o.start.row))r=!1,o.end={col:a.colCount-1,row:i};else if(t.fillHandle.isFilling){if("top"===t.fillHandle.direction)if(i===t.fillHandle.beforeFillMinRow&&i===t.fillHandle.beforeFillMaxRow)o.start.row=o.end.row=i;else if(i<=t.fillHandle.beforeFillMinRow){if(o.start.row<o.end.row){const t=o.start.row;o.start.row=o.end.row,o.end.row=t}o.end.row=i}else i===t.fillHandle.beforeFillMaxRow&&(o.start.row>o.end.row?o.start.row=i:o.end.row=i);else if("bottom"===t.fillHandle.direction){if(i>=t.fillHandle.beforeFillMaxRow){if(o.start.row>o.end.row){const t=o.start.row;o.start.row=o.end.row,o.end.row=t}o.end.row=i}}else if("left"===t.fillHandle.direction)if(e===t.fillHandle.beforeFillMinCol&&e===t.fillHandle.beforeFillMaxCol)o.start.col=o.end.col=e;else if(e<=t.fillHandle.beforeFillMinCol){if(o.start.col<o.end.col){const t=o.start.col;o.start.col=o.end.col,o.end.col=t}o.end.col=e}else e===t.fillHandle.beforeFillMaxCol&&(o.start.col>o.end.col?o.start.col=e:o.end.col=e);else if("right"===t.fillHandle.direction&&e>=t.fillHandle.beforeFillMaxCol){if(o.start.col>o.end.col){const t=o.start.col;o.start.col=o.end.col,o.end.col=t}o.end.col=e}}else o.end={col:e,row:i};h.updateCellSelectBorder(o.start.col,o.start.row,o.end.col,o.end.row,r)}}}else{const n=t.select.ranges[t.select.ranges.length-1];if(r&&n){if("cell"!==t.select.headerSelectMode&&a.isColumnHeader(e,i)){const t=Math.min(n.start.col,n.end.col,e),r=Math.max(n.start.col,n.end.col,e),o=Math.min(n.start.row,n.end.row,i),s=a.rowCount-1;n.start={col:t,row:o},n.end={col:r,row:s}}else if("cell"!==t.select.headerSelectMode&&a.isRowHeader(e,i)){const t=Math.min(n.start.col,n.end.col,e),r=a.colCount-1,o=Math.min(n.start.row,n.end.row,i),s=Math.max(n.start.row,n.end.row,i);n.start={col:t,row:o},n.end={col:r,row:s}}else n.end={col:e,row:i};h.deleteLastSelectedRangeComponents(),h.updateCellSelectBorder(n.start.col,n.start.row,n.end.col,n.end.row)}else{let r=!0;if(-1===u.col||-1===u.row||o||(t.select.ranges=[],h.deleteAllSelectBorder()),"cell"!==t.select.headerSelectMode&&a.isColumnHeader(e,i)){const r=a.getCellRange(e,i);t.select.ranges.push({start:{col:r.start.col,row:i},end:{col:r.end.col,row:a.rowCount-1}})}else if("cell"!==t.select.headerSelectMode&&a.isRowHeader(e,i)){const r=a.getCellRange(e,i);t.select.ranges.push({start:{col:e,row:r.start.row},end:{col:a.colCount-1,row:r.end.row}})}else if(a.internalProps.layoutMap.isSeriesNumberInHeader(e,i))r=!1,t.select.ranges.push({start:{col:0,row:0},end:{col:a.colCount-1,row:a.rowCount-1}});else if(a.internalProps.layoutMap.isSeriesNumberInBody(e,i))r=!1,t.select.ranges.push({start:{col:e,row:i},end:{col:a.colCount-1,row:i}});else if(e>=0&&i>=0){const r=a.getCellRange(e,i);t.select.ranges.push({start:{col:r.start.col,row:r.start.row},end:{col:r.end.col,row:r.end.row}})}u.col=e,u.row=i;const n=t.select.ranges?.[t.select.ranges.length-1];n&&h.updateCellSelectBorder(n.start.col,n.start.row,n.end.col,n.end.row,r)}}else u.col=-1,u.row=-1,t.select.ranges=[],h.deleteAllSelectBorder();h.updateNextFrame()}(this,t,e,i,r,o,n)}checkCellRangeInSelect(t,e){return function(t,e,i,r){for(let r=0;r<i.length;r++)if(gw(i[r],{start:t,end:e}))return!0;return!1}(t,e,this.select.ranges,this.select.highlightScope)}updateHoverIcon(t,e,i,r,o){if(this.residentHoverIcon?.icon&&i===this.residentHoverIcon?.icon)return;const n=bP(i);if(n)if("richtext-icon"===n.type){const i=n.icon;if(this.hoverIcon.icon&&this.hoverIcon.icon!==this.residentHoverIcon?.icon&&(this.table.scenegraph.setIconNormalStyle(this.hoverIcon.icon,this.hoverIcon.col,this.hoverIcon.row),this.hoverIcon.col=-1,this.hoverIcon.col=-1,this.hoverIcon.icon=null,this.table.scenegraph.updateNextFrame()),i.attribute.tooltip){const r={content:i.attribute.tooltip.title,referencePosition:{rect:n.position,placement:i.attribute.tooltip.placement},style:Object.assign({},this.table.internalProps.theme?.tooltipStyle,i.tooltip?.style,i.attribute?.tooltip?.style)};this.table.internalProps.tooltipHandler.isBinded(r)||this.table.showTooltip(t,e,r)}}else{const i=n.icon;i!==this.hoverIcon.icon&&(this.hoverIcon.icon&&this.hoverIcon.icon!==this.residentHoverIcon?.icon&&this.table.scenegraph.setIconNormalStyle(this.hoverIcon.icon,this.hoverIcon.col,this.hoverIcon.row),this.hoverIcon.col=t,this.hoverIcon.row=e,this.hoverIcon.icon=i,this.table.scenegraph.setIconHoverStyle(i,t,e,r),this.table.scenegraph.updateNextFrame())}else this.hoverIcon.icon&&this.hoverIcon.icon!==this.residentHoverIcon?.icon&&(this.table.scenegraph.setIconNormalStyle(this.hoverIcon.icon,this.hoverIcon.col,this.hoverIcon.row),this.hoverIcon.col=-1,this.hoverIcon.col=-1,this.hoverIcon.icon=null,this.table.scenegraph.updateNextFrame())}isResizeCol(){return this.columnResize.resizing}isResizeRow(){return this.rowResize.resizing}isFillHandle(){return this.fillHandle.isFilling}isSelecting(){return this.select.selecting}endSelectCells(t=!0){if(this.select.selecting){if(this.select.selecting=!1,0===this.select.ranges.length)return;this.table.scenegraph.moveSelectingRangeComponentsToSelectedRangeComponents();const e=this.select.ranges[this.select.ranges.length-1].end.col,i=this.select.ranges[this.select.ranges.length-1].end.row;t&&this.table.fireListeners(ww.SELECTED_CELL,{ranges:this.select.ranges,col:e,row:i})}}endResizeCol(){setTimeout((()=>{this.columnResize.resizing=!1}),0),this.table.scenegraph.updateChartSize(this.columnResize.col),this.checkFrozen(),this.table.scenegraph.component.hideResizeCol(),this.table.scenegraph.updateNextFrame()}startResizeCol(t,e,i,r){this.columnResize.resizing=!0,this.columnResize.col=t,this.columnResize.x=e,this.columnResize.isRightFrozen=r,this.table.scenegraph.component.showResizeCol(t,i,r),this.updateSelectPos(-1,-1),this.table.scenegraph.updateNextFrame()}updateResizeCol(t,e){!function(t,e,i){t=Math.ceil(t),e=Math.ceil(e);let r=i.columnResize.isRightFrozen?i.columnResize.x-t:t-i.columnResize.x;if(Math.abs(r)<1)return;const o=i.table.getColWidth(i.columnResize.col);let n=o;n+=r;const s=i.table.getMinColWidth(i.columnResize.col),a=i.table.getMaxColWidth(i.columnResize.col);if(n<s||n>a){if(o===s||o===a)return;r=o-s>a-o?a-o:s-o}let l=i.table.getColWidth(i.columnResize.col)+r;if(l<i.table.internalProps.limitMinWidth&&(l=i.table.internalProps.limitMinWidth,r=l-i.table.getColWidth(i.columnResize.col)),"adaptive"===i.table.widthMode&&i.columnResize.col<i.table.colCount-1){const t=i.table.getColWidth(i.columnResize.col+1),e=i.table.getMinColWidth(i.columnResize.col+1),o=i.table.getMaxColWidth(i.columnResize.col+1);let n=t;if(n-=r,n<e||n>o){if(t===e||t===o)return;r=t-e>o-t?o-t:e-t}n-r<i.table.internalProps.limitMinWidth&&(r=n-i.table.internalProps.limitMinWidth)}r=Math.ceil(r),i.columnResize.col<i.table.rowHeaderLevelCount||i.columnResize.col>=i.table.colCount-i.table.rightFrozenColCount?yP(r,i):"indicator"===i.table.internalProps.columnResizeType?function(t,e){const i=e.table.internalProps.layoutMap;let r,o,n;if(i.indicatorsAsCol)r=i.getIndicatorKey(e.columnResize.col,e.table.columnHeaderLevelCount);else{const t=i.getCellHeaderPaths(e.columnResize.col,e.table.columnHeaderLevelCount-1),r=t.colHeaderPaths[t.colHeaderPaths.length-1];o=r.dimensionKey,n=r.value}for(let s=e.table.rowHeaderLevelCount;s<e.table.colCount-e.table.rightFrozenColCount;s++){const a=i.getIndicatorKey(s,e.table.columnHeaderLevelCount);if(i.indicatorsAsCol&&a===r)e.table.scenegraph.updateColWidth(s,t),e.table.internalProps._widthResizedColMap.add(s);else if(!i.indicatorsAsCol){const r=i.getCellHeaderPaths(s,e.table.columnHeaderLevelCount-1),a=r?.colHeaderPaths[r.colHeaderPaths.length-1];a&&o===a.dimensionKey&&n===a.value&&(e.table.scenegraph.updateColWidth(s,t),e.table.internalProps._widthResizedColMap.add(s))}}}(r,i):"indicatorGroup"===i.table.internalProps.columnResizeType?function(t,e){const i=e.table.internalProps.layoutMap,r=i.getCellHeaderPaths(e.columnResize.col,e.table.columnHeaderLevelCount),o=i.getHeadNode(r.colHeaderPaths.slice(0,r.colHeaderPaths.length-1)),n=o.startInTotal+e.table.frozenColCount,s=o.startInTotal+e.table.frozenColCount+o.size-1,a=e.table.getColsWidth(n,s),l=t;for(let t=n;t<=s;t++){if(!(e.table.internalProps.transpose||e.table.isPivotTable()&&!i.indicatorsAsCol)){const r=i.getBody(t,e.table.columnHeaderLevelCount);if(r?.disableColumnResize)continue}let r=e.table.getColWidth(t)/a*l;r>0&&r<.5?r=.5:r<0&&r>=-.5&&(r=-.5),e.table.scenegraph.updateColWidth(t,r),e.table.internalProps._widthResizedColMap.add(t)}}(r,i):"all"===i.table.internalProps.columnResizeType?function(t,e){const i=e.table.internalProps.layoutMap;for(let r=e.table.frozenColCount;r<e.table.colCount-e.table.rightFrozenColCount;r++){if(!(e.table.internalProps.transpose||e.table.isPivotTable()&&!i.indicatorsAsCol)){const t=i.getBody(r,e.table.columnHeaderLevelCount);if(t?.disableColumnResize)continue}e.table.scenegraph.updateColWidth(r,t),e.table.internalProps._widthResizedColMap.add(r)}}(r,i):yP(r,i),i.columnResize.x=t,i.table.scenegraph.component.updateResizeCol(i.columnResize.col,e,i.columnResize.isRightFrozen),i.columnResize.col<i.table.frozenColCount&&!i.table.isPivotTable()&&!i.table.transpose?i.table.scenegraph.component.setFrozenColumnShadow(i.table.frozenColCount-1,i.columnResize.isRightFrozen):i.columnResize.col>=i.table.colCount-i.table.rightFrozenColCount&&!i.table.isPivotTable()&&!i.table.transpose?i.table.scenegraph.component.setRightFrozenColumnShadow(i.table.colCount-i.table.rightFrozenColCount):i.table.options.frozenColCount?i.table.scenegraph.component.setFrozenColumnShadow(i.table.frozenColCount-1):i.table.options.rightFrozenColCount&&i.table.scenegraph.component.setRightFrozenColumnShadow(i.table.colCount-i.table.rightFrozenColCount),i.table.scenegraph.updateNextFrame()}(t,e,this)}endResizeRow(){setTimeout((()=>{this.rowResize.resizing=!1}),0),this.table.scenegraph.updateChartSize(this.rowResize.row),this.table.scenegraph.component.hideResizeRow(),this.table.scenegraph.updateNextFrame()}startResizeRow(t,e,i,r){this.rowResize.resizing=!0,this.rowResize.row=t,this.rowResize.y=i,this.rowResize.isBottomFrozen=r,this.table.scenegraph.component.showResizeRow(t,e,r),this.updateSelectPos(-1,-1),this.table.scenegraph.updateNextFrame()}updateResizeRow(t,e){!function(t,e,i){t=Math.ceil(t),e=Math.ceil(e);let r=i.rowResize.isBottomFrozen?i.rowResize.y-e:e-i.rowResize.y;if(Math.abs(r)<1)return;i.table.getRowHeight(i.rowResize.row);let o=i.table.getRowHeight(i.rowResize.row)+r;if(o<i.table.internalProps.limitMinHeight&&(o=i.table.internalProps.limitMinHeight,r=o-i.table.getRowHeight(i.rowResize.row)),"adaptive"===i.table.heightMode&&i.rowResize.row<i.table.rowCount-1){let t=i.table.getRowHeight(i.rowResize.row+1);t-=r,t-r<i.table.internalProps.limitMinHeight&&(r=t-i.table.internalProps.limitMinHeight)}r=Math.ceil(r),i.rowResize.row<i.table.columnHeaderLevelCount||i.rowResize.row>=i.table.rowCount-i.table.bottomFrozenRowCount?CP(r,i):"indicator"===i.table.internalProps.rowResizeType?function(t,e){const i=e.table.internalProps.layoutMap;let r,o,n;if(i.indicatorsAsCol){const t=i.getCellHeaderPaths(e.table.rowHeaderLevelCount-1,e.rowResize.row),r=t.rowHeaderPaths[t.rowHeaderPaths.length-1];o=r.dimensionKey,n=r.value}else r=i.getIndicatorKey(e.table.rowHeaderLevelCount,e.rowResize.row);for(let s=e.table.columnHeaderLevelCount;s<e.table.rowCount-e.table.bottomFrozenRowCount;s++){const a=i.getIndicatorKey(e.table.rowHeaderLevelCount,s);if(i.indicatorsAsCol||a!==r){if(i.indicatorsAsCol){const r=i.getCellHeaderPaths(e.table.rowHeaderLevelCount-1,s),a=r?.rowHeaderPaths[r.rowHeaderPaths.length-1];a&&o===a.dimensionKey&&n===a.value&&(e.table.scenegraph.updateRowHeight(s,t),e.table.internalProps._heightResizedRowMap.add(s))}}else e.table.scenegraph.updateRowHeight(s,t),e.table.internalProps._heightResizedRowMap.add(s)}}(r,i):"indicatorGroup"===i.table.internalProps.rowResizeType?function(t,e){const i=e.table.internalProps.layoutMap,r=i.getCellHeaderPaths(e.table.rowHeaderLevelCount,e.rowResize.row),o=i.getHeadNode(r.rowHeaderPaths.slice(0,r.rowHeaderPaths.length-1)),n=o.startInTotal+e.table.frozenRowCount,s=o.startInTotal+e.table.frozenRowCount+o.size-1,a=e.table.getRowsHeight(n,s),l=t;for(let t=n;t<=s;t++){let i=e.table.getRowHeight(t)/a*l;i>0&&i<.5?i=.5:i<0&&i>=-.5&&(i=-.51),e.table.scenegraph.updateRowHeight(t,i),e.table.internalProps._heightResizedRowMap.add(t)}}(r,i):"all"===i.table.internalProps.rowResizeType?function(t,e){for(let i=e.table.frozenRowCount;i<e.table.rowCount-e.table.bottomFrozenRowCount;i++)e.table.scenegraph.updateRowHeight(i,t),e.table.internalProps._heightResizedRowMap.add(i)}(r,i):CP(r,i),i.rowResize.y=e,i.table.scenegraph.component.updateResizeRow(i.rowResize.row,t,i.rowResize.isBottomFrozen),i.table.scenegraph.updateNextFrame()}(t,e,this)}startFillSelect(t,e){this.fillHandle.isFilling=!0,this.fillHandle.startX=t,this.fillHandle.startY=e;const i=this.select.ranges[this.select.ranges.length-1];this.fillHandle.beforeFillMinCol=Math.min(i.start.col,i.end.col),this.fillHandle.beforeFillMinRow=Math.min(i.start.row,i.end.row),this.fillHandle.beforeFillMaxCol=Math.max(i.start.col,i.end.col),this.fillHandle.beforeFillMaxRow=Math.max(i.start.row,i.end.row),this.table.fireListeners(ww.MOUSEDOWN_FILL_HANDLE,{})}endFillSelect(){this.fillHandle.isFilling=!1,this.fillHandle.startX=void 0,this.fillHandle.startY=void 0,this.fillHandle.directionRow=void 0;const t=Math.min(this.select.ranges[0].start.col,this.select.ranges[0].end.col),e=Math.min(this.select.ranges[0].start.row,this.select.ranges[0].end.row),i=Math.max(this.select.ranges[0].start.col,this.select.ranges[0].end.col),r=Math.max(this.select.ranges[0].start.row,this.select.ranges[0].end.row);this.fillHandle.beforeFillMinCol===t&&this.fillHandle.beforeFillMinRow===e&&this.fillHandle.beforeFillMaxCol===i&&this.fillHandle.beforeFillMaxRow===r||this.table.eventManager.isDraging&&this.table.fireListeners(ww.DRAG_FILL_HANDLE_END,{direction:this.fillHandle.direction}),this.fillHandle.beforeFillMaxCol=void 0,this.fillHandle.beforeFillMaxRow=void 0,this.fillHandle.beforeFillMinCol=void 0,this.fillHandle.beforeFillMinRow=void 0}startMoveCol(t,e,i,r){!function(t,e,i,r,o){if(!("canMoveHeaderPosition"in o.table.internalProps.layoutMap))return;o.columnMove.moving=!0,o.columnMove.colSource=t,o.columnMove.rowSource=e,o.columnMove.x=i-o.table.tableX,o.columnMove.y=r-o.table.tableY;const n=o.table.getCellLocation(t,e),s="columnHeader"===n?o.columnMove.x:"rowHeader"===n||o.table.internalProps.layoutMap.isSeriesNumberInBody(t,e)?o.columnMove.y:0;o.table.scenegraph.component.showMoveCol(t,e,s),o.table.stateManager.updateSelectPos(-1,-1),o.table.scenegraph.updateNextFrame()}(t,e,i,r,this)}updateMoveCol(t,e,i,r){!function(t,e,i,r,o){if(!("canMoveHeaderPosition"in o.table.internalProps.layoutMap))return;const n=function(t,e,i){const r=i.getCellRange(t.col,t.row);if(i.isColumnHeader(t.col,t.row)){const o=i.getCellRange(e.col,r.start.row);e.row>=i.columnHeaderLevelCount&&(e.row=i.columnHeaderLevelCount-1),e.col>=t.col?e.col=o.end.col:e.col=o.start.col}else if(i.isRowHeader(t.col,t.row)){const o=i.internalProps.layoutMap,n=i.getCellRange(r.start.col,e.row);if(e.col>=i.rowHeaderLevelCount+o.leftRowSeriesNumberColumnCount&&(e.col=i.rowHeaderLevelCount+o.leftRowSeriesNumberColumnCount-1),"tree"===o.rowHierarchyType){const r=o.getCellHeaderPathsWidthTreeNode(t.col,t.row).rowHeaderPaths,n=o.getCellHeaderPathsWidthTreeNode(e.col,e.row).rowHeaderPaths;if(r.length<=n.length){const o=n[r.length-1];o&&(e.row>=t.row?e.row=o.startInTotal+o.size-1+i.columnHeaderLevelCount:e.row=o.startInTotal+i.columnHeaderLevelCount)}}else e.row>=t.row?e.row=n.end.row:e.row=n.start.row}return e}({col:o.columnMove.colSource,row:o.columnMove.rowSource},{col:t,row:e},o.table);let s,a,l,h;o.columnMove.x=i-o.table.tableX,o.columnMove.y=r-o.table.tableY,o.columnMove.colTarget=n.col,o.columnMove.rowTarget=n.row,o.table.internalProps.layoutMap.canMoveHeaderPosition({col:o.columnMove.colSource,row:o.columnMove.rowSource},{col:o.columnMove.colTarget,row:o.columnMove.rowTarget})?o.updateCursor("grabbing"):o.updateCursor("not-allowed");const c=o.table.getCellLocation(o.columnMove.colSource,o.columnMove.rowSource);"columnHeader"===c?(a=o.columnMove.x,s=o.table.isLeftFrozenColumn(t)?o.columnMove.colTarget>=o.columnMove.colSource?o.table.getColsWidth(0,o.columnMove.colTarget):o.table.getColsWidth(0,o.columnMove.colTarget-1):o.table.isRightFrozenColumn(t)?o.table.tableNoFrameWidth-o.table.getColsWidth(n.col+1,o.table.colCount-1):(o.columnMove.colTarget>=o.columnMove.colSource?o.table.getColsWidth(0,o.columnMove.colTarget):o.table.getColsWidth(0,o.columnMove.colTarget-1))-o.table.stateManager.scroll.horizontalBarPos):("rowHeader"===c||o.table.internalProps.layoutMap.isSeriesNumberInBody(t,e))&&(h=o.columnMove.y,l=o.table.isFrozenRow(e)?o.columnMove.rowTarget>=o.columnMove.rowSource?o.table.getRowsHeight(0,o.columnMove.rowTarget):o.table.getRowsHeight(0,o.columnMove.rowTarget-1):o.table.isBottomFrozenRow(e)?o.table.tableNoFrameHeight-o.table.getRowsHeight(n.row+1,o.table.rowCount-1):(o.columnMove.rowTarget>=o.columnMove.rowSource?o.table.getRowsHeight(0,o.columnMove.rowTarget):o.table.getRowsHeight(0,o.columnMove.rowTarget-1))-o.table.stateManager.scroll.verticalBarPos),o.table.scenegraph.component.updateMoveCol(a,s,h,l),o.table.scenegraph.updateNextFrame()}(t,e,i,r,this)}isMoveCol(){return this.columnMove.moving}endMoveCol(){!function(t){if("canMoveHeaderPosition"in t.table.internalProps.layoutMap&&t.columnMove.moving&&t.columnMove.colSource>=0&&t.columnMove.rowSource>=0&&t.columnMove.colTarget>=0&&t.columnMove.rowTarget>=0){const e=t.table.getCellRange(t.columnMove.colSource,t.columnMove.rowSource),i=t.table.getCellRange(t.columnMove.colTarget,t.columnMove.rowTarget),r=t.table._moveHeaderPosition({col:t.columnMove.colSource,row:t.columnMove.rowSource},{col:t.columnMove.colTarget,row:t.columnMove.rowTarget});if(r){t.table.internalProps.layoutMap.clearCellRangeMap();const o=t.table.getCellRange(t.columnMove.colSource,t.columnMove.rowSource),n=t.table.getCellRange(t.columnMove.colTarget,t.columnMove.rowTarget),s=Math.min(o.start.col,n.start.col,e.start.col,i.start.col),a=Math.max(o.end.col,n.end.col,e.end.col,i.end.col),l=Math.min(o.start.row,n.start.row,e.start.row,i.start.row);let h=Math.max(o.end.row,n.end.row,e.end.row,i.end.row);"row"===r.moveType&&"tree"===t.table.internalProps.layoutMap.rowHierarchyType&&(h=r.targetIndex>r.sourceIndex?h+r.targetSize-1:h+r.sourceSize-1),!t.table.transpose&&t.table.internalProps.layoutMap.isSeriesNumberInBody(t.columnMove.colSource,t.columnMove.rowSource)&&t.table.changeRecordOrder(r.sourceIndex,r.targetIndex),"column"===r.moveType?mP(s,a,0,-1,t.table):mP(0,-1,l,h,t.table),t.table.clearCellStyleCache(),t.table.internalProps.layoutMap.isSeriesNumberInBody(t.columnMove.colSource,t.columnMove.rowSource)?t.table.scenegraph.updateHeaderPosition(t.table.scenegraph.proxy.colStart,t.table.scenegraph.proxy.colEnd,t.table.scenegraph.proxy.rowStart,t.table.scenegraph.proxy.rowEnd,r.moveType):"column"===r.moveType?t.table.scenegraph.updateHeaderPosition(s,a,0,-1,r.moveType):t.table.scenegraph.updateHeaderPosition(0,-1,l,h,r.moveType),"adjustFrozenCount"===t.table.internalProps.frozenColDragHeaderMode&&t.table.isListTable()&&(t.table.isLeftFrozenColumn(t.columnMove.colTarget)&&!t.table.isLeftFrozenColumn(t.columnMove.colSource)?t.table.frozenColCount+=o.end.col-o.start.col+1:t.table.isLeftFrozenColumn(t.columnMove.colSource)&&!t.table.isLeftFrozenColumn(t.columnMove.colTarget)&&(t.table.frozenColCount-=o.end.col-o.start.col+1),t.table.isRightFrozenColumn(t.columnMove.colTarget)&&!t.table.isRightFrozenColumn(t.columnMove.colSource)?t.table.rightFrozenColCount+=o.end.col-o.start.col+1:t.table.isRightFrozenColumn(t.columnMove.colSource)&&!t.table.isRightFrozenColumn(t.columnMove.colTarget)&&(t.table.rightFrozenColCount-=o.end.col-o.start.col+1))}t.updateCursor()}setTimeout((()=>{t.columnMove.moving=!1,delete t.columnMove.colSource,delete t.columnMove.rowSource,delete t.columnMove.colTarget,delete t.columnMove.rowTarget}),0),t.table.scenegraph.component.hideMoveCol(),t.columnResize.col<t.table.frozenColCount&&!t.table.isPivotTable()&&!t.table.transpose?(t.table.scenegraph.component.setFrozenColumnShadow(t.table.frozenColCount-1,t.columnResize.isRightFrozen),t.table.scenegraph.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount)):t.columnResize.col>=t.table.colCount-t.table.rightFrozenColCount&&!t.table.isPivotTable()&&!t.table.transpose?t.table.scenegraph.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount):t.table.options.frozenColCount?t.table.scenegraph.component.setFrozenColumnShadow(t.table.frozenColCount-1):t.table.options.rightFrozenColCount&&t.table.scenegraph.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount),t.table.scenegraph.updateNextFrame()}(this)}checkFrozen(){const t=this.table.isListTable()&&!this.table.internalProps.transpose?this.table.options.frozenColCount:this.table.isPivotChart()?this.table.rowHeaderLevelCount??0:Math.max((this.table.rowHeaderLevelCount??0)+this.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount,this.table.options.frozenColCount??0);if(t){if(this.table.tableNoFrameWidth-this.table.getColsWidth(0,t-1)<=120)return this.table._setFrozenColCount(0),this.setFrozenCol(-1),!1;if(this.table.frozenColCount!==t)return this.table._setFrozenColCount(t),this.setFrozenCol(t),!1}return!0}setFrozenCol(t){t!==this.frozen.col?(this.frozen.col=t,this.table.scenegraph.updateFrozen(),this.table.scenegraph.updateFrozenIcon(0,this.table.colCount-1)):this.table.scenegraph.updateFrozenIcon(0,this.table.colCount-1)}checkVerticalScrollBarEnd(){const t=this.table.getAllRowsHeight(),e=this.scroll.verticalBarPos,i=this.table.tableNoFrameHeight;e+i>=t&&this.table.fireListeners(ww.SCROLL_VERTICAL_END,{scrollTop:e,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:this.table.theme.scrollStyle?.width,scrollWidth:this.table.theme.scrollStyle?.width,viewHeight:i,viewWidth:this.table.tableNoFrameWidth})}checkHorizontalScrollBarEnd(){const t=this.table.getAllColsWidth(),e=this.scroll.horizontalBarPos,i=this.table.tableNoFrameWidth;e+i>=t&&this.table.fireListeners(ww.SCROLL_HORIZONTAL_END,{scrollTop:this.scroll.verticalBarPos,scrollLeft:e,scrollHeight:this.table.theme.scrollStyle?.width,scrollWidth:this.table.theme.scrollStyle?.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:i})}updateVerticalScrollBar(t){const e=this.table.getAllRowsHeight(),i=this.scroll.verticalBarPos;this.scroll.verticalBarPos=Math.ceil(t*(e-this.table.scenegraph.height)),Y(this.scroll.verticalBarPos)&&!isNaN(this.scroll.verticalBarPos)||(this.scroll.verticalBarPos=0),this.table.scenegraph.setY(-this.scroll.verticalBarPos,1===t),this.scroll.verticalBarPos-=this.table.scenegraph.proxy.deltaY,this.table.scenegraph.proxy.deltaY=0,this.updateHoverPos(-1,-1),this.table.fireListeners(ww.SCROLL,{scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:this.table.theme.scrollStyle?.width,scrollWidth:this.table.theme.scrollStyle?.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"vertical",scrollRatioY:t}),i!==this.scroll.verticalBarPos&&this.checkVerticalScrollBarEnd()}updateHorizontalScrollBar(t){const e=this.table.getAllColsWidth(),i=this.scroll.horizontalBarPos;this.scroll.horizontalBarPos=Math.ceil(t*(e-this.table.scenegraph.width)),Y(this.scroll.horizontalBarPos)&&!isNaN(this.scroll.horizontalBarPos)||(this.scroll.horizontalBarPos=0),this.table.scenegraph.setX(-this.scroll.horizontalBarPos,1===t),this.scroll.horizontalBarPos-=this.table.scenegraph.proxy.deltaX,this.table.scenegraph.proxy.deltaX=0,this.updateHoverPos(-1,-1),this.table.fireListeners(ww.SCROLL,{scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:this.table.theme.scrollStyle?.width,scrollWidth:this.table.theme.scrollStyle?.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"horizontal",scrollRatioX:t}),i!==this.scroll.horizontalBarPos&&this.checkHorizontalScrollBarEnd()}setScrollTop(t){const e=this.table.getAllRowsHeight();t=Math.max(0,Math.min(t,e-this.table.scenegraph.height)),((t=Math.ceil(t))!==this.scroll.verticalBarPos||this.table.isPivotChart())&&this.updateHoverPos(-1,-1);const i=this.scroll.verticalBarPos;this.scroll.verticalBarPos=t,Y(this.scroll.verticalBarPos)&&!isNaN(this.scroll.verticalBarPos)||(this.scroll.verticalBarPos=0),this.table.scenegraph.setY(-t);const r=t/(e-this.table.scenegraph.height);this.table.scenegraph.component.updateVerticalScrollBarPos(r),i!==t&&(this.table.fireListeners(ww.SCROLL,{scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:this.table.theme.scrollStyle?.width,scrollWidth:this.table.theme.scrollStyle?.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"vertical",scrollRatioY:r}),this.checkVerticalScrollBarEnd())}setScrollLeft(t){this.table.scrollLeft;const e=this.table.getAllColsWidth();this.table.getFrozenColsWidth(),t=Math.max(0,Math.min(t,e-this.table.scenegraph.width)),(t=Math.ceil(t))!==this.scroll.horizontalBarPos&&this.updateHoverPos(-1,-1);const i=this.scroll.horizontalBarPos;this.scroll.horizontalBarPos=t,Y(this.scroll.horizontalBarPos)&&!isNaN(this.scroll.horizontalBarPos)||(this.scroll.horizontalBarPos=0),this.table.scenegraph.setX(-t);const r=t/(e-this.table.scenegraph.width);this.table.scenegraph.component.updateHorizontalScrollBarPos(r),i!==t&&(this.table.fireListeners(ww.SCROLL,{scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:this.table.theme.scrollStyle?.width,scrollWidth:this.table.theme.scrollStyle?.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"horizontal",scrollRatioX:r}),this.checkHorizontalScrollBarEnd())}hideVerticalScrollBar(){this.table.scenegraph.component.hideVerticalScrollBar()}showVerticalScrollBar(t){this.table.scenegraph.component.showVerticalScrollBar(),t&&(clearTimeout(this._clearVerticalScrollBar),this._clearVerticalScrollBar=setTimeout((()=>{this.table.scenegraph.component.hideVerticalScrollBar()}),1e3))}hideHorizontalScrollBar(){this.table.scenegraph.component.hideHorizontalScrollBar()}showHorizontalScrollBar(t){this.table.scenegraph.component.showHorizontalScrollBar(),t&&(clearTimeout(this._clearHorizontalScrollBar),this._clearHorizontalScrollBar=setTimeout((()=>{this.table.scenegraph.component.hideHorizontalScrollBar()}),1e3))}triggerContextMenu(t,e,i,r){this.menu.isShow&&this.menu.x===i&&this.menu.y===r?this.hideMenu():this.showContextMenu(t,e,i,r)}showContextMenu(t,e,i,r){this.table.internalProps.menu?.contextMenuItems&&("html"===this.table.internalProps.menu.renderMode?this.menu.isShow=!0:(this.menu.isShow=!0,this.menu.x=i,this.menu.y=r,this.table.scenegraph.component.menu.attach(i,r,t,e,eM.contextmenu)),this.table.fireListeners(ww.SHOW_MENU,{x:i,y:r,col:t,row:e,type:"contextmenu"}))}triggerDropDownMenu(t,e,i,r,o){this.table.fireListeners(ww.DROPDOWN_ICON_CLICK,{col:t,row:e,event:o}),this.menu.isShow?this.hideMenu():this.showDropDownMenu(t,e,i,r)}showDropDownMenu(t,e,i,r){"html"===this.table.internalProps.menu.renderMode?this.menu.isShow=!0:(this.menu.isShow=!0,this.table.scenegraph.component.menu.attach(i,r,t,e,eM.dropDown),this.menu.bounds=this.table.scenegraph.component.menu.bounds),this.table.fireListeners(ww.SHOW_MENU,{x:i,y:r,col:t,row:e,type:"dropDown"}),this.residentHoverIcon&&this.table.scenegraph.setIconNormalStyle(this.residentHoverIcon.icon,this.residentHoverIcon.col,this.residentHoverIcon.row);const o=this.table.scenegraph.getCell(t,e);let n;o.forEachChildren((t=>t.attribute.funcType===lC.dropDown&&(n=t,!0))),n&&(this.residentHoverIcon={col:t,row:e,icon:n},this.table.scenegraph.setIconHoverStyle(this.residentHoverIcon.icon,this.residentHoverIcon.col,this.residentHoverIcon.row,o),this.table.scenegraph.residentHoverIcon(t,e))}hideMenu(){this.menu.isShow&&(this.table.fireListeners(ww.DROPDOWN_MENU_CLEAR,null),this.table.fireListeners(ww.HIDE_MENU,null),this.menu.isShow=!1,this.table.scenegraph.component.menu.detach(),this.residentHoverIcon&&(this.table.scenegraph.setIconNormalStyle(this.residentHoverIcon.icon,this.residentHoverIcon.col,this.residentHoverIcon.row),this.table.scenegraph.resetResidentHoverIcon(this.residentHoverIcon.col,this.residentHoverIcon.row),this.residentHoverIcon=null))}setDropDownMenuHighlight(t){this.menu.dropDownMenuHighlight=t;for(let e=0;e<t.length;e++){const{col:i,row:r}=t[e],o=this.table.getCellRange(i,r);if(o)for(let t=o.start.col;t<=o.end.col;t++)for(let e=o.start.row;e<=o.end.row;e++)this.table.scenegraph.updateCellContent(t,e)}}dropDownMenuIsHighlight(t,e,i){const r=this.menu.dropDownMenuHighlight;if(Array.isArray(r))for(let o=0;o<r.length;o++){const n=r[o];let{col:s,row:a}=n;const{field:l,menuKey:h}=n;if("number"!=typeof s||"number"!=typeof a)if(this.table.isPivotTable()&&(Array.isArray(l),1)){const t=this.table.internalProps.layoutMap.getPivotCellAdress(l);if(!t)continue;s=t.col,a=t.row}else{const t=this.table.internalProps.layoutMap.getHeaderCellAddressByField(l);if(!t)continue;s=t.col,a=t.row}if(Y(s)&&Y(a)&&this.table.isCellRangeEqual(t,e,s,a)){const r=this.table._getHeaderLayoutMap(s??t,a??e).dropDownMenu||this.table.globalDropDownMenu;if(r)for(let t=0;t<r.length;t++){const e=r[t];if(q(e)&&(e.menuKey||e.text)===(h||"")&&t===i)return!0;if(tt(e)&&e===h&&t===i)return!0}}}return!1}triggerSort(t,e,i,r){if(this.table.isPivotTable()){const i=this.table.getPivotSortState(t,e);return void this.table.fireListeners(pP.PIVOT_SORT_CLICK,{col:t,row:e,order:i||"normal",dimensionInfo:this.table.internalProps.layoutMap.getPivotDimensionInfo(t,e),cellLocation:this.table.getCellLocation(t,e),event:r})}const o=this.sort.col,n=this.sort.row;uP(t,e,this.table,r),this.sort.col=t,this.sort.row=e,this.table.scenegraph.updateSortIcon(this.sort.col,this.sort.row,i,this.sort.order,o,n,this.sort.icon),this.sort.icon=i}updateSortState(t){if(t.field===this.sort.field&&t.order===this.sort.order)return;const e=this.sort.col,i=this.sort.row,r="asc"===this.sort.order?"sort_downward":"desc"===this.sort.order?"sort_upward":"sort_normal";this.setSortState(t);const o=this.table.internalProps.layoutMap.getHeaderCellAddressByField(t.field);this.sort.col=o.col,this.sort.row=o.row;const n=this.table.scenegraph.getCell(this.sort.col,this.sort.row).getChildByName(r,!0);this.table.scenegraph.updateSortIcon(this.sort.col,this.sort.row,n,this.sort.order,e,i,this.sort.icon)}triggerFreeze(t,e,i){this.table.isPivotTable()||this.table.transpose||(!function(t,e,i){i.frozenColCount>0?t!==i.frozenColCount-1?i.setFrozenColCount(t+1):i.setFrozenColCount(0):i.setFrozenColCount(t+1)}(t,0,this.table),this.frozen.icon=i)}updateCursor(t="default"){this.table.getElement().style.cursor=t}updateDrillState(t,e,i,r,o,n){this.drill.dimensionKey=t,this.drill.title=e,this.drill.drillDown=i,this.drill.drillUp=r,this.drill.col=o,this.drill.row=n,function(t,e,i,r,o){const n=o.getCellLocation(t,e);let s=0,a=0,l=!1;"columnHeader"===n?(s=o.getColsWidth(0,o.rowHeaderLevelCount-1)-(0===o.frozenColCount?o.scrollLeft:0),a=o.getRowsHeight(0,e-1)+o.getRowHeight(e)/2,l=!0):"rowHeader"===n&&(a=o.getRowsHeight(0,o.columnHeaderLevelCount-1),s=o.getColsWidth(0,t-1)+o.getColWidth(t)/2,l=!0),o.scenegraph.updateDrill(l,s,a,i,r)}(o,n,i,r,this.table)}updateSparklineHoverPose(t,e,i,r){-1!==this.sparkLine.col&&-1!==this.sparkLine.row&&function(t,e,i){const r=i.scenegraph.getCell(t,e).getChildByName("sparkline"),o=r?.getChildByName("highlight-line"),n=r?.getChildByName("highlight-symbol");o&&o.setAttributes({visible:!1,pickable:!1}),n&&n.setAttributes({visible:!1,pickable:!1}),i.scenegraph.updateNextFrame()}(this.sparkLine.col,this.sparkLine.row,this.table);let o=!1;-1!==t&&-1!==e&&(o=function(t,e,i,r,o){const n=o.scenegraph.getCell(t,e).getChildByName("sparkline"),s=n?.getChildByName("sparkline-line"),a=n?.getChildByName("sparkline-symbol-group");if(!s)return!1;const l=s.bandwidth,h=s.min,c=s.max,d=s.attribute.points;let u;i-=n.globalAABBBounds.x1,n.globalAABBBounds.y1;for(let t=0;t<d.length;t++){const{x:e,y:r,defined:o,rawData:g}=d[t];if(Math.abs(i-e)<l/2&&(u={point:d[t],points:d,pointsBandWidth:l,pointData:g},o)){const t=n.getChildByName("highlight-line");if(t)t.setAttributes({points:[{x:e,y:c},{x:e,y:h}],visible:!0,pickable:!0});else{const t=ul({points:[{x:e,y:c},{x:e,y:h}],lineWidth:s.hover?.strokeWidth,stroke:s.hover?.stroke});t.name="highlight-line",n.addChild(t)}const i=n.getChildByName("highlight-symbol");if(i)i.setAttributes({x:e,y:r,visible:!0,pickable:!0});else{const t=hl({x:e,y:r,stroke:a.hover.stroke,lineWidth:a.hover.strokeWidth,fill:a.hover.fill,size:2*a.hover.size,symbolType:"circle"});t.name="highlight-symbol",n.addChild(t)}break}}if(o.scenegraph.updateNextFrame(),u){const i={col:t,row:e,field:o.getHeaderField(t,e),value:o.getCellValue(t,e),dataValue:o.getCellOriginValue(t,e),cellHeaderPaths:o.internalProps.layoutMap.getCellHeaderPaths(t,e),title:o.getBodyColumnDefine(t,e).title,cellRange:o.getCellRelativeRect(t,e),sparkline:{pointData:u.pointData},scaleRatio:o.canvas.getBoundingClientRect().width/o.canvas.offsetWidth};o.fireListeners(ww.MOUSEOVER_CHART_SYMBOL,i)}return!0}(t,e,i,0,this.table)),o?(this.sparkLine.col=t,this.sparkLine.row=e):(this.sparkLine.col=-1,this.sparkLine.row=-1)}setCheckedState(t,e,i,r){return function(t,e,i,r,o){const n=o.table.getRecordShowIndexByCell(t,e);if(n>=0){const t=o.table.dataSource.getIndexKey(n);o.checkedState[t]||(o.checkedState[t]={}),o.checkedState[t][i]=r}}(t,e,i,r,this)}setHeaderCheckedState(t,e){return function(t,e,i){i.headerCheckedState[t]=e,i.checkedState?.forEach((i=>{i[t]=e}))}(t,e,this)}syncCheckedState(t,e,i,r){return function(t,e,i,r,o){if(o.table.isHeader(t,e)){if(Y(o.headerCheckedState[i]))return o.headerCheckedState[i];if("function"==typeof r)return;if(Y(r))o.headerCheckedState[i]=r;else if(o.checkedState?.length>0)return o.updateHeaderCheckedState(i);return o.headerCheckedState[i]}const n=o.table.getRecordShowIndexByCell(t,e);if(n>=0){const t=o.table.dataSource.getIndexKey(n);if(Y(o.checkedState[t]?.[i]))return o.checkedState[t][i];o.checkedState[t]||(o.checkedState[t]={}),o.checkedState[t][i]=r}return r}(t,e,i,r,this)}initCheckedState(t){return function(t,e){e.checkedState=[],e.headerCheckedState={},e.radioState={};let i=!1;e._checkboxCellTypeFields=[],e._headerCheckFuncs={},e.table.internalProps.layoutMap.headerObjects.forEach(((t,r)=>{if("checkbox"===t.headerType){const r=t.define.checked;null==r||"function"==typeof r?(i=!0,"function"==typeof r&&(e._headerCheckFuncs[t.field]=r)):e.headerCheckedState[t.field]=r,"checkbox"!==t.define.cellType||t.fieldFormat||e._checkboxCellTypeFields.push(t.field)}})),i&&t.forEach(((t,i)=>{e._checkboxCellTypeFields.forEach((r=>{const o=t[r];let n;if(q(o)?n=o.checked:"boolean"==typeof o&&(n=o),null==n){const t=e._headerCheckFuncs[r];if(t){const s=e.table.getCellAddrByFieldRecord(r,i);n=hw(t,{col:s.col,row:s.row,table:e.table,context:null,value:o})}}e.checkedState[i]||(e.checkedState[i]={}),e.checkedState[i][r]=n}))}))}(t,this)}updateHeaderCheckedState(t){return function(t,e){const i=e.checkedState.every((e=>!0===e[t]));return i?(e.headerCheckedState[t]=!0,i):e.checkedState.every((e=>!1===e[t]))?(e.headerCheckedState[t]=!1,!1):!!e.checkedState.find((e=>!0===e[t]))&&(e.headerCheckedState[t]="indeterminate","indeterminate")}(t,this)}initLeftRecordsCheckState(t){return function(t,e){for(let i=e.checkedState.length;i<t.length;i++){const r=t[i];e._checkboxCellTypeFields.forEach((t=>{const o=r[t];let n;q(o)?n=o.checked:"boolean"==typeof o&&(n=o),e.checkedState[i]||(e.checkedState[i]={}),e.checkedState[i][t]=n}))}}(t,this)}setRadioState(t,e,i,r,o){!function(t,e,i,r,o,n){const s=n.table.getRecordShowIndexByCell(t,e);if(s>=0){const t=n.table.dataSource.getIndexKey(s);"column"===r?ot(o)?(n.radioState[i]={},n.radioState[i][t]=o):n.radioState[i]=t:(n.radioState[i]||(n.radioState[i]={}),ot(o)?n.radioState[i][t]=o:n.radioState[i][t]=!0)}}(t,e,i,r,o,this)}syncRadioState(t,e,i,r,o,n){return function(t,e,i,r,o,n,s){const a=s.table.getRecordShowIndexByCell(t,e);if(a>=0){const t=s.table.dataSource.getIndexKey(a);if("column"===r){if(!Y(s.radioState[i])&&n)return ot(o)?(s.radioState[i]={},s.radioState[i][t]=o):s.radioState[i]=t,!0;if(ot(s.radioState[i])&&!ot(o))return s.radioState[i]===t;if(ot(s.radioState[i])&&ot(o))return!1;if(q(s.radioState[i])&&!ot(o))return!1;if(q(s.radioState[i])&&ot(o))return s.radioState[i][t]===o}else if("cell"===r){if(!Y(s.radioState[i])&&n)return s.radioState[i]={},ot(o)?s.radioState[i][t]=o:s.radioState[i][t]=!0,!0;if(!Y(s.radioState[i]?.[t])&&n)return ot(o)?s.radioState[i][t]=o:s.radioState[i][t]=!0,!0;if(K(s.radioState[i]?.[t])&&!ot(o))return s.radioState[i][t];if(K(s.radioState[i]?.[t])&&ot(o))return!1;if(ot(s.radioState[i]?.[t])&&!ot(o))return!1;if(ot(s.radioState[i]?.[t])&&ot(o))return s.radioState[i][t]===o}}return n}(t,e,i,r,o,n,this)}}function vP(t){const e={abstractPos:{x:t.x,y:t.y}},i=function(t){for(;t&&t.parent;){if("cell"===t.role)return t;t=t.parent}return null}(t.target);return i&&(e.eventArgs={col:i.col,row:i.row,event:t,targetCell:i,target:t.target}),e}const xP=/radio-\d+-\d+-(\d+)/;function _P(t){const e=t.table;t.gesture=new Qg(e.scenegraph.tableGroup,{tap:{interval:300}}),t.gesture.on("doubletap",(t=>{!function(t,e){const i=vP(t);let r=-1,o=-1;i.eventArgs&&(r=i.eventArgs.col,o=i.eventArgs.row);const n=e.getCellValue(r,o),s=i.eventArgs?.targetCell?.globalAABBBounds;if(s&&e.internalProps.focusControl.setFocusRect(new Mw(s.x1+e.scrollLeft,s.y1+e.scrollTop,s.x2-s.x1,s.y2-s.y1),n),e.hasListeners(ww.DBLCLICK_CELL)){const n=e.getCellInfo(r,o);let s,a;if(i.eventArgs?.target){const t=bP(i.eventArgs?.target);t&&(s=t.icon,a=t.position)}const l={...n,event:t.nativeEvent,federatedEvent:t,cells:[],targetIcon:s?{name:s.name,position:a,funcType:s.attribute.funcType}:void 0,target:i?.eventArgs?.target};e.fireListeners(ww.DBLCLICK_CELL,l)}}(t,e)}))}function SP(t){t.stateManager.endResizeCol();const e=[];for(let i=0;i<t.colCount;i++)e.push(t.getColWidth(i));t.fireListeners(ww.RESIZE_COLUMN_END,{col:t.stateManager.columnResize.col,colWidths:e})}function AP(t){t.stateManager.endResizeRow(),t.fireListeners(ww.RESIZE_ROW_END,{row:t.stateManager.rowResize.row,rowHeight:t.getRowHeight(t.stateManager.rowResize.row)})}function RP(t,e,i=!0){let{deltaX:r,deltaY:o}=t;t.shiftKey&&t.deltaY&&(r=o,o=0);const[n,s]=function(t,e,i){const r=2,o=Math.abs(t/e),n=o<=1/r?0:t,s=o>r?0:e;return[Math.ceil(n*(i.horizontal??0)),Math.ceil(s*(i.vertical??0))]}(r,o,{horizontal:1,vertical:1});(n||s)&&e.interactionState!==eC.scrolling&&e.updateInteractionState(eC.scrolling),n&&(e.setScrollLeft(e.scroll.horizontalBarPos+n),e.showHorizontalScrollBar(!0)),s&&(e.setScrollTop(e.scroll.verticalBarPos+s),e.showVerticalScrollBar(!0)),i&&e.resetInteractionState(),t.cancelable&&("none"===e.table.internalProps.overscrollBehavior||Math.abs(o)>=Math.abs(r)&&0!==o&&BP(o,e)||Math.abs(o)<=Math.abs(r)&&0!==r&&MP(r,e))&&t.preventDefault()}function BP(t,e){return 0!=e.table.getAllRowsHeight()-e.table.scenegraph.height&&(!function(t,e){const i=e.table.getAllRowsHeight()-e.table.scenegraph.height;return 0!==i&&t<=0&&e.scroll.verticalBarPos<1}(t,e)&&!function(t,e){const i=e.table.getAllRowsHeight()-e.table.scenegraph.height;return 0!==i&&t>=0&&Math.abs(e.scroll.verticalBarPos-i)<1}(t,e))}function MP(t,e){return 0!=e.table.getAllColsWidth()-e.table.scenegraph.width&&(!function(t,e){const i=e.table.getAllColsWidth()-e.table.scenegraph.width;return 0!==i&&t<=0&&e.scroll.horizontalBarPos<1}(t,e)&&!function(t,e){const i=e.table.getAllColsWidth()-e.table.scenegraph.width;return 0!==i&&t>=0&&Math.abs(e.scroll.horizontalBarPos-i)<1}(t,e))}class TP{friction;lastTime;speedX;speedY;stateManager;runingId;scrollHandle;constructor(t){this.stateManager=t}setScrollHandle(t){this.scrollHandle=t}startInertia(t,e,i){this.lastTime=Date.now(),this.speedX=t,this.speedY=e,this.friction=i,this.runingId||(this.runingId=requestAnimationFrame(this.inertia.bind(this)))}inertia(){const t=Date.now(),e=t-this.lastTime;let i=!0;const r=Math.pow(this.friction,e/16),o=r*this.speedX,n=r*this.speedY;let s=0,a=0;Math.abs(o)>.05&&(i=!1,s=(this.speedX+o)/2*e),Math.abs(n)>.05&&(i=!1,a=(this.speedY+n)/2*e),this.scrollHandle?.(s,a),i?this.runingId=null:(this.lastTime=t,this.speedX=o,this.speedY=n,this.runingId=requestAnimationFrame(this.inertia.bind(this)))}endInertia(){cancelAnimationFrame(this.runingId),this.runingId=null}isInertiaScrolling(){return!!this.runingId}}function PP(t){return!!t.changedTouches}function HP(t,e,i){if(i.indicatorsAsCol){if(i.hasTwoIndicatorAxes&&e===i.columnHeaderLevelCount-1&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount)return"top";if(e===i.rowCount-i.bottomFrozenRowCount&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount)return"bottom";if(t===i.rowHeaderLevelCount-1&&e>=i.rowHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount)return"left"}else{if(t===i.rowHeaderLevelCount-1&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount)return"left";if(t===i.colCount-i.rightFrozenColCount&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount)return"right";if(e===i.rowCount-i.bottomFrozenRowCount&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount)return"bottom"}return"bottom"}class EP{table;isTouchdown;touchMovePoints;touchSetTimeout;touchEnd;touchMove;gesture;handleTextStickBindId;LastPointerXY;LastBodyPointerXY;isDown=!1;isDraging=!1;scrollYSpeed;scrollXSpeed;downIcon;globalEventListeners=[];inertiaScroll;constructor(t){this.table=t,this.handleTextStickBindId=[],this.inertiaScroll=new TP(t.stateManager),"node"!==kC.mode&&(this.bindOuterEvent(),setTimeout((()=>{this.bindSelfEvent()}),0))}bindOuterEvent(){!function(t){const e=t.table,i=e.stateManager;e.scenegraph.tableGroup.addEventListener("pointermove",(r=>{const o=e.eventManager.LastPointerXY?.x??r.x,n=e.eventManager.LastPointerXY?.y??r.y;e.eventManager.LastPointerXY={x:r.x,y:r.y},t.touchSetTimeout&&(clearTimeout(t.touchSetTimeout),t.touchSetTimeout=void 0);const s=vP(r);if(i.interactionState===eC.grabing)return void(Math.abs(o-r.x)+Math.abs(n-r.y)>=1&&(i.isResizeCol()||(i.isMoveCol()?t.dealColumnMover(s):i.isFillHandle()?t.dealFillSelect(s,!0):t.dealTableSelect(s,!0))));e.eventManager.isDraging&&i.isSelecting()&&t.dealTableSelect(s,!0);const a=r.path.find((t=>"cell"===t.role));if(e.hasListeners(ww.MOUSELEAVE_CELL)&&(-1===e.stateManager.hover.cellPos.col||-1===e.stateManager.hover.cellPos.row||a?.col===e.stateManager.hover.cellPos.col&&a?.row===e.stateManager.hover.cellPos.row||e.fireListeners(ww.MOUSELEAVE_CELL,{col:e.stateManager.hover.cellPos.col,row:e.stateManager.hover.cellPos.row,cellRange:e.getCellRangeRelativeRect({col:e.stateManager.hover.cellPos.col,row:e.stateManager.hover.cellPos.row}),scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,event:r.nativeEvent,target:s?.eventArgs?.target})),e.hasListeners(ww.MOUSEENTER_CELL)&&("cell"!==a?.role||!Y(a.col)||!Y(a.row)||a.col===e.stateManager.hover.cellPos.col&&a.row===e.stateManager.hover.cellPos.row||a.col===e.stateManager.hover.cellPosContainHeader?.col&&a.row===e.stateManager.hover.cellPosContainHeader?.row||e.fireListeners(ww.MOUSEENTER_CELL,{col:a.col,row:a.row,cellRange:e.getCellRangeRelativeRect({col:a.col,row:a.row}),scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,event:r.nativeEvent,target:s?.eventArgs?.target})),t.dealIconHover(s),t.dealTableHover(s),s.eventArgs&&e.hasListeners(ww.MOUSEMOVE_CELL)){let t,i;if(s.eventArgs?.target){const e=bP(s.eventArgs?.target);e&&(t=e.icon,i=e.position)}e.fireListeners(ww.MOUSEMOVE_CELL,{col:s.eventArgs.col,row:s.eventArgs.row,x:s.abstractPos.x,y:s.abstractPos.y,event:r.nativeEvent,targetIcon:t?{name:t.name,position:i,funcType:t.attribute.funcType}:void 0,target:s?.eventArgs?.target})}})),e.scenegraph.tableGroup.addEventListener("pointerout",(e=>{const i=vP(e),r=i?.eventArgs?.target;"table"===r?.role&&t.dealTableHover()})),e.scenegraph.tableGroup.addEventListener("pointerover",(t=>{const i=vP(t),r=i?.eventArgs?.target;if(r&&e.hasListeners(ww.MOUSEOVER_CHART_SYMBOL)&&"symbol"===r.type){const r=t.composedPath().find((t=>"cell"===t.roll));if(r){const{col:o,row:n}=r,s={col:o,row:n,field:e.getHeaderField(o,n),value:e.getCellValue(o,n),dataValue:e.getCellOriginValue(o,n),cellHeaderPaths:e.internalProps.layoutMap.getCellHeaderPaths(o,n),title:e.getBodyColumnDefine(o,n).title,cellRange:e.getCellRelativeRect(o,n),event:t.nativeEvent,sparkline:{pointData:void 0},scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,target:i?.eventArgs?.target};e.fireListeners(ww.MOUSEOVER_CHART_SYMBOL,s)}}})),e.scenegraph.tableGroup.addEventListener("pointerenter",(t=>{"focus"===e.theme.scrollStyle.visible&&(i.showHorizontalScrollBar(),i.showVerticalScrollBar()),e.hasListeners(ww.MOUSEENTER_TABLE)&&e.fireListeners(ww.MOUSEENTER_TABLE,{event:t.nativeEvent})})),e.scenegraph.tableGroup.addEventListener("pointerleave",(r=>{i.isResizeCol()||i.isMoveCol()||i.isSelecting()||(i.updateInteractionState(eC.default),i.updateCursor()),"focus"===e.theme.scrollStyle.visible&&(i.hideHorizontalScrollBar(),i.hideVerticalScrollBar()),e.hasListeners(ww.MOUSELEAVE_CELL)&&-1!==e.stateManager.hover.cellPos.col&&-1!==e.stateManager.hover.cellPos.row&&e.fireListeners(ww.MOUSELEAVE_CELL,{col:e.stateManager.hover.cellPos.col,row:e.stateManager.hover.cellPos.row,cellRange:e.getCellRangeRelativeRect({col:e.stateManager.hover.cellPos.col,row:e.stateManager.hover.cellPos.row}),scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,event:r.nativeEvent,target:void 0}),t.dealTableHover();const o=r.target;o&&!o.isDescendantsOf(e.scenegraph.tableGroup)&&e.fireListeners(ww.MOUSELEAVE_TABLE,{event:r.nativeEvent})})),e.scenegraph.tableGroup.addEventListener("pointerupoutside",(r=>{const o=vP(r);if(i.menu.isShow&&o.eventArgs?.target!==i.residentHoverIcon?.icon&&setTimeout((()=>{e.internalProps.menuHandler.pointInMenuElement(r.page.x,r.page.y)||i.menu.isShow&&i.hideMenu()}),0),i.isResizeCol())SP(e);else if(i.isResizeRow())AP(e);else if(i.isMoveCol())e.stateManager.endMoveCol(),-1!==e.stateManager.columnMove?.colSource&&-1!==e.stateManager.columnMove?.rowSource&&-1!==e.stateManager.columnMove?.colTarget&&-1!==e.stateManager.columnMove?.rowTarget&&e.hasListeners(ww.CHANGE_HEADER_POSITION)&&e.fireListeners(ww.CHANGE_HEADER_POSITION,{target:{col:e.stateManager.columnMove.colTarget,row:e.stateManager.columnMove.rowTarget},source:{col:e.stateManager.columnMove.colSource,row:e.stateManager.columnMove.rowSource}});else if(i.isSelecting()&&e.stateManager.select?.ranges?.length){const t=e.stateManager.select.ranges[e.stateManager.select.ranges.length-1].end.col,i=e.stateManager.select.ranges[e.stateManager.select.ranges.length-1].end.row;if(e.stateManager.endSelectCells(),e.hasListeners(ww.DRAG_SELECT_END)){const o={event:r.nativeEvent,cells:[],col:t,row:i,scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,target:void 0};o.cells=e.getSelectedCellInfos(),e.fireListeners(ww.DRAG_SELECT_END,o)}}e.editorManager?.completeEdit(r.nativeEvent),i.updateInteractionState(eC.default),t.dealTableHover()})),e.scenegraph.tableGroup.addEventListener("pointerdown",(r=>{if(e.hasListeners(ww.MOUSEDOWN_TABLE)&&e.fireListeners(ww.MOUSEDOWN_TABLE,{event:r.nativeEvent}),e.eventManager.isDown=!0,e.eventManager.LastBodyPointerXY={x:r.x,y:r.y},e.eventManager.LastPointerXY={x:r.x,y:r.y},0!==r.button)return;const o=vP(r);if(t.downIcon=void 0,i.interactionState!==eC.default)return;e.isPivotChart()&&"chart"!==o?.eventArgs?.target.type&&e.scenegraph.updateChartState(null),o.eventArgs?.target!==i.residentHoverIcon?.icon&&i.hideMenu(),e.editorManager?.completeEdit(r.nativeEvent);const n=o?.eventArgs?.target?.role?.startsWith("icon")?o.eventArgs.target:void 0;if(t.downIcon=n,n&&!1!==n.attribute.interactive)n.attribute.funcType===lC.dragReorder&&(i.startMoveCol(o.eventArgs.col,o.eventArgs.row,o.abstractPos.x,o.abstractPos.y),i.updateInteractionState(eC.grabing));else if("touch"===r.pointerType)t.touchEnd=!1,t.touchSetTimeout=setTimeout((()=>{t.isTouchdown=!1,t.touchMove=!0,(!t.touchEnd&&(t.checkColumnResize(o,!0)||t.checkRowResize(o,!0))||!t.touchEnd&&t.chechColumnMover(o)||t.dealTableSelect(o)&&!t.touchEnd)&&i.updateInteractionState(eC.grabing)}),500),t.dealTableHover(o);else{if(!t.checkCellFillhandle(o)&&(t.checkColumnResize(o,!0)||t.checkRowResize(o,!0)))return e.scenegraph.updateChartState(null),void i.updateInteractionState(eC.grabing);if(t.chechColumnMover(o))return void i.updateInteractionState(eC.grabing);if(t.checkCellFillhandle(o,!0)&&t.dealFillSelect(o))return void i.updateInteractionState(eC.grabing);t.dealTableSelect(o)&&i.updateInteractionState(eC.grabing)}if(e.hasListeners(ww.MOUSEDOWN_CELL)){const t=vP(r);t.eventArgs&&e.fireListeners(ww.MOUSEDOWN_CELL,{col:t.eventArgs.col,row:t.eventArgs.row,event:r.nativeEvent,target:t?.eventArgs?.target})}})),e.scenegraph.tableGroup.addEventListener("pointerup",(t=>{if(0===t.button){if("grabing"===i.interactionState){if(i.updateInteractionState(eC.default),i.isResizeCol())SP(e);else if(i.isResizeRow())AP(e);else if(i.isMoveCol()){const i=vP(t);e.stateManager.endMoveCol(),i.eventArgs&&e.hasListeners(ww.CHANGE_HEADER_POSITION)&&e.fireListeners(ww.CHANGE_HEADER_POSITION,{target:{col:i.eventArgs.col,row:i.eventArgs.row},source:{col:e.stateManager.columnMove.colSource,row:e.stateManager.columnMove.rowSource}})}else if(i.isSelecting()){e.stateManager.endSelectCells(),e.stateManager.isFillHandle()&&e.stateManager.endFillSelect();const i=vP(t);if(e.eventManager.isDraging&&i.eventArgs&&e.hasListeners(ww.DRAG_SELECT_END)){const r={event:t.nativeEvent,cells:[],col:i.eventArgs.target.col,row:i.eventArgs.target.row,scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,target:i?.eventArgs?.target};r.cells=e.getSelectedCellInfos(),e.fireListeners(ww.DRAG_SELECT_END,r)}}}else i.interactionState===eC.scrolling&&i.updateInteractionState(eC.default);if(e.hasListeners(ww.MOUSEUP_CELL)){const i=vP(t);i.eventArgs&&e.fireListeners(ww.MOUSEUP_CELL,{col:i.eventArgs.col,row:i.eventArgs.row,event:t.nativeEvent,target:i?.eventArgs?.target})}}})),e.scenegraph.tableGroup.addEventListener("rightdown",(t=>{const r=vP(t);if(r.eventArgs){i.triggerContextMenu(r.eventArgs.col,r.eventArgs.row,r.abstractPos.x,r.abstractPos.y);const{col:o,row:n}=r.eventArgs;if(e.hasListeners(ww.CONTEXTMENU_CELL)){const i=e.getCellInfo(o,n);let s,a;if(r.eventArgs?.target){const t=bP(r.eventArgs?.target);t&&(s=t.icon,a=t.position)}const l={...i,event:t.nativeEvent,cells:[],targetIcon:s?{name:s.name,position:a,funcType:s.attribute.funcType}:void 0,target:r?.eventArgs?.target};!function(t,e,i){for(let r=0;r<t.length;r++){const o=t[r];if(o.start.col<=e&&e<=o.end.col&&o.start.row<=i&&i<=o.end.row||o.end.col<=e&&e<=o.start.col&&o.end.row<=i&&i<=o.start.row)return!0}return!1}(e.stateManager.select.ranges,o,n)?l.cells=[[i]]:l.cells=e.getSelectedCellInfos(),e.fireListeners(ww.CONTEXTMENU_CELL,l)}}})),e.scenegraph.tableGroup.addEventListener("pointertap",(r=>{if(e.stateManager.columnResize.resizing||e.stateManager.columnMove.moving)return;const o=vP(r);if(t.dealIconClick(r,o),o?.eventArgs){if(t.touchSetTimeout&&"touch"===r.pointerType){const e=vP(r);t.touchSetTimeout&&(clearTimeout(t.touchSetTimeout),t.dealTableSelect(e),i.endSelectCells(),t.touchSetTimeout=void 0)}if(!t.touchMove&&0===r.button&&e.hasListeners(ww.CLICK_CELL)){const{col:t,row:i}=o.eventArgs,n=e.getCellInfo(t,i);let s,a;if(o.eventArgs?.target){const t=bP(o.eventArgs?.target);t&&(s=t.icon,a=t.position)}const l={...n,event:r.nativeEvent,federatedEvent:r,cells:[],targetIcon:s?{name:s.name,position:a,funcType:s.attribute.funcType}:void 0,target:o?.eventArgs?.target};e.fireListeners(ww.CLICK_CELL,l)}}})),e.scenegraph.stage.addEventListener("pointerdown",(r=>{const o=vP(r);if(o.eventArgs?.target!==i.residentHoverIcon?.icon&&i.hideMenu(),e.editorManager?.completeEdit(r.nativeEvent),!t.checkCellFillhandle(o)&&t.checkColumnResize(o,!0))return e.scenegraph.updateChartState(null),void i.updateInteractionState(eC.grabing)})),e.scenegraph.stage.addEventListener("pointerup",(t=>{"grabing"===i.interactionState&&(i.updateInteractionState(eC.default),i.isResizeCol()&&SP(e))})),e.scenegraph.stage.addEventListener("pointertap",(r=>{const o=r.target;e.eventManager.isDraging||!o||!o.isDescendantsOf(e.scenegraph.stage)&&o.stage!==o||o.isDescendantsOf(e.scenegraph.tableGroup)?e.eventManager.isDraging&&i.isSelecting()&&i.endSelectCells():(i.updateInteractionState(eC.default),t.dealTableHover(),t.dealTableSelect(),i.updateCursor(),e.scenegraph.updateChartState(null))})),e.scenegraph.stage.addEventListener("pointermove",(r=>{const o=vP(r);i.isResizeCol()||t.checkColumnResize(o)?e.stateManager.select&&t.checkCellFillhandle(o)?i.updateCursor("crosshair"):i.updateCursor("col-resize"):i.isResizeRow()||t.checkRowResize(o)?e.stateManager.select&&t.checkCellFillhandle(o)?i.updateCursor("crosshair"):i.updateCursor("row-resize"):i.updateCursor()})),e.scenegraph.tableGroup.addEventListener("checkbox_state_change",(t=>{const i=vP(t),{col:r,row:o}=i.eventArgs,n=e.getCellInfo(r,o),s=iv(e,r,o);if(s)for(let i=s.start.col;i<=s.end.col;i++)for(let r=s.start.row;r<=s.end.row;r++)e.scenegraph.getCell(i,r).forEachChildren((e=>{"checkbox"===e.name&&e.setAttributes({checked:t.target.attribute.checked,indeterminate:t.target.attribute.indeterminate})}));const a={...n,event:t.nativeEvent,target:i?.eventArgs?.target,checked:t.detail.checked};if(e.isHeader(r,o))e.stateManager.setHeaderCheckedState(n.field,t.detail.checked),"checkbox"===e.getCellType(r,o)&&e.scenegraph.updateCheckboxCellState(r,o,t.detail.checked);else if(e.stateManager.setCheckedState(r,o,n.field,t.detail.checked),"checkbox"===e.getCellType(r,o)){const t=e.stateManager.headerCheckedState[n.field],i=e.stateManager.updateHeaderCheckedState(n.field);t!==i&&e.scenegraph.updateHeaderCheckboxCellState(r,o,i)}e.fireListeners(ww.CHECKBOX_STATE_CHANGE,a),e.scenegraph.updateNextFrame()})),e.scenegraph.tableGroup.addEventListener("radio_checked",(t=>{const i=vP(t),{col:r,row:o,target:n}=i.eventArgs,s=e.getCellInfo(r,o),a=xP.exec(n.id)?.[1],l=iv(e,r,o);if(l)for(let t=l.start.col;t<=l.end.col;t++)for(let i=l.start.row;i<=l.end.row;i++)e.scenegraph.getCell(t,i).forEachChildren((t=>{"radio"===t.name&&t.id===n.id&&t.setAttributes({checked:!0})}));const h=e.getBodyColumnDefine(r,o).radioCheckType||"column";if("cell"===h)if(l)for(let t=l.start.col;t<=l.end.col;t++)for(let i=l.start.row;i<=l.end.row;i++)e.scenegraph.getCell(t,i).forEachChildren((t=>{"radio"===t.name&&t.id!==n.id&&t.setAttributes({checked:!1})}));else e.scenegraph.getCell(r,o).forEachChildren((t=>{"radio"===t.name&&t.id!==n.id&&t.setAttributes({checked:!1})}));else"column"===h&&e.scenegraph.getColGroup(r).forEachChildren((t=>{t.forEachChildren((t=>{"radio"===t.name&&t.id!==n.id&&t.setAttributes({checked:!1})}))}));const c=a?Number(a):void 0;e.stateManager.setRadioState(r,o,s.field,h,c);const d={...s,event:t.nativeEvent,target:i?.eventArgs?.target,radioIndexInCell:c};e.fireListeners(ww.RADIO_STATE_CHANGE,d),e.scenegraph.updateNextFrame()}))}(this),function(t){const e=t.table,i=e.stateManager,r=e.internalProps.handler;function o(t){const i=e.stateManager.select.ranges,r=i.length,o=Math.min(i[r-1].start.col,i[r-1].end.col),s=Math.min(i[r-1].start.row,i[r-1].end.row),l=Math.max(i[r-1].start.col,i[r-1].end.col),h=Math.max(i[r-1].start.row,i[r-1].end.row);let c=0,d=0,u=[];t.getType("text/html").then((t=>{t.text().then((t=>{if(t&&/(<table)|(<TABLE)/g.test(t)){const i=/<tr[^>]*>(.*?)<\/tr>/gs,r=Array.from(t.matchAll(i));for(const t of r){const e=t[1],i=/<td[^>]*>(.*?)<\/td>/gs,r=Array.from(e.matchAll(i)).map((t=>t[1].replace(/(<(?!br)([^>]+)>)/gi,"").replace(/<br(\s*|\/)>[\r\n]?/gim,"\n").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#9;/gi,"\t").replace(/&nbsp;/g," ")));u.push(r),c=Math.max(c,r?.length??0)}d=u.length??0,u=a(u,d,c,h-s+1,l-o+1),e.changeCellValues(o,s,u,!0)}else navigator.clipboard.read().then((t=>{for(const e of t)e.types.includes("text/plain")&&e.getType("text/plain").then((t=>{t.text().then(n)}))}))}))}))}function n(t){const i=e.stateManager.select.ranges,r=i.length,o=Math.min(i[r-1].start.col,i[r-1].end.col),n=Math.min(i[r-1].start.row,i[r-1].end.row),s=Math.max(i[r-1].start.col,i[r-1].end.col),l=Math.max(i[r-1].start.row,i[r-1].end.row);let h=0,c=0,d=[];t.split("\n").forEach((function(t,e){const i=t.split("\t"),r=[];d.push(r),i.forEach((function(t,e){e===i.length-1&&(t=t.trim()),r.push(t)})),h=Math.max(h,r?.length??0)})),c=d.length??0,d=a(d,c,h,l-n+1,s-o+1),e.changeCellValues(o,n,d,!0)}function s(t){const i=e.stateManager.select.ranges,r=i.length,o=Math.min(i[r-1].start.col,i[r-1].end.col),n=Math.min(i[r-1].start.row,i[r-1].end.row),s=Math.max(i[r-1].start.col,i[r-1].end.col),l=Math.max(i[r-1].start.row,i[r-1].end.row);let h=0,c=0;t.getType("text/plain").then((t=>{t.text().then((t=>{const i=t.replace(/\r(?!\n)/g,"\r\n").split("\r\n");let r=[];i.length>1&&""===i[i.length-1]&&i.pop(),i.forEach((function(t,e){const i=t.split("\t"),o=[];r.push(o),i.forEach((function(t,e){t.includes("\n")&&(t=t.replace(/^"(.*)"$/,"$1").replace(/["]*/g,(t=>new Array(Math.floor(t.length/2)).fill('"').join("")))),o.push(t)})),h=Math.max(h,o?.length??0)})),c=r.length??0,r=a(r,c,h,l-n+1,s-o+1),e.changeCellValues(o,n,r,!0)}))}))}function a(t,e,i,r,o){if(o>i||r>e){if(o%i==0&&r%e==0){const n=[];for(let s=0;s<r;s++){const r=[];n.push(r);for(let n=0;n<o;n++){const o=s%e,a=n%i;r.push(t[o][a])}}return n}return t}return t}r.on(e.getElement(),"blur",(e=>{t.dealTableHover()})),r.on(e.getElement(),"wheel",(t=>{RP(t,i)})),r.on(e.getElement(),"keydown",(r=>{if("a"===r.key&&(r.ctrlKey||r.metaKey))e.keyboardOptions?.selectAllOnCtrlA&&(r.preventDefault(),t.deelTableSelectAll());else if(i.select.cellPos.col>=0&&i.select.cellPos.row>=0&&("ArrowUp"===r.key||"ArrowDown"===r.key||"ArrowLeft"===r.key||"ArrowRight"===r.key)){if(!e.options.keyboardOptions?.moveEditCellOnArrowKeys&&e.editorManager.editingEditor)return;let t,o;r.preventDefault(),r.stopPropagation(),"ArrowUp"===r.key?(t=i.select.cellPos.col,o=Math.min(e.rowCount-1,Math.max(0,i.select.cellPos.row-1))):"ArrowDown"===r.key?(t=i.select.cellPos.col,o=Math.min(e.rowCount-1,Math.max(0,i.select.cellPos.row+1))):"ArrowLeft"===r.key?(o=i.select.cellPos.row,t=Math.min(e.colCount-1,Math.max(0,i.select.cellPos.col-1))):"ArrowRight"===r.key&&(o=i.select.cellPos.row,t=Math.min(e.colCount-1,Math.max(0,i.select.cellPos.col+1))),e.selectCell(t,o),e.options.keyboardOptions?.moveEditCellOnArrowKeys&&e.editorManager.editingEditor&&(e.editorManager.completeEdit(),e.getElement().focus(),e.getEditor(t,o)&&e.editorManager.startEditCell(t,o))}else if("Escape"===r.key)e.editorManager.cancelEdit();else if("Enter"===r.key){if(e.editorManager.editingEditor)e.editorManager.completeEdit(),e.getElement().focus();else if((e.options.keyboardOptions?.editCellOnEnter??1)&&1===(e.stateManager.select.ranges?.length??0)){const t=e.stateManager.select.ranges[0].start.col,i=e.stateManager.select.ranges[0].start.row,r=e.stateManager.select.ranges[0].end.col,o=e.stateManager.select.ranges[0].end.row;t===r&&i===o&&e.getEditor(t,i)&&e.editorManager.startEditCell(t,i)}}else if("Tab"===r.key&&(e.options.keyboardOptions?.moveFocusCellOnTab??1)&&(r.preventDefault(),i.select.cellPos.col>=0&&i.select.cellPos.row>=0)){let t,r;i.select.cellPos.col===e.colCount-1?(r=Math.min(e.rowCount-1,i.select.cellPos.row+1),t=e.rowHeaderLevelCount):i.select.cellPos.row===e.rowCount-1?(r=e.rowCount-1,t=e.rowHeaderLevelCount):(r=i.select.cellPos.row,t=i.select.cellPos.col+1),e.selectCell(t,r),e.editorManager.editingEditor&&(e.editorManager.completeEdit(),e.getElement().focus(),e.getEditor(t,r)&&e.editorManager.startEditCell(t,r))}if(e.hasListeners(ww.KEYDOWN)){const t={keyCode:r.keyCode??r.which,code:r.code,event:r,scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth};e.fireListeners(ww.KEYDOWN,t)}})),r.on(e.getElement(),"copy",(t=>{if(e.keyboardOptions?.copySelected){const i=e.getCopyValue();if(Y(i)){if(t.preventDefault(),navigator.clipboard?.write){const t=t=>{const e=["<table>"],i=['<meta name="author" content="Visactor"/>','<style type="text/css">td{white-space:normal}br{mso-data-placement:same-cell}</style>'].join("");return t.split("\r\n").forEach((function(t,i){const r=t.split("\t"),o=[];0===i&&e.push("<tbody>"),r.forEach((function(t,e){const i=t?t.toString().replace(/&/g,"&amp;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>").replace(/(<br(\s*|\/)>(\r\n|\n)?|\r\n|\n)/g,"<br>\r\n").replace(/\x20{2,}/gi,(t=>`<span style="mso-spacerun: yes">${"&nbsp;".repeat(t.length-1)} </span>`)).replace(/\t/gi,"&#9;"):"";o.push(`<td>${i}</td>`)})),e.push("<tr>",...o,"</tr>"),i===t.length-1&&e.push("</tbody>")})),e.push("</table>"),[i,e.join("")].join("")},e=t(i);navigator.clipboard.write([new ClipboardItem({"text/html":new Blob([e],{type:"text/html"}),"text/plain":new Blob([i],{type:"text/plain"})})])}else pw?window.clipboardData.setData("Text",i):t.clipboardData.setData("text/plain",i);e.fireListeners(ww.COPY_DATA,{cellRange:e.stateManager.select.ranges,copyData:i})}}})),r.on(e.getElement(),"paste",(t=>{if(e.keyboardOptions?.pasteValueToCell&&e.changeCellValues){if(e.editorManager?.editingEditor)return;if(e.stateManager.select.ranges?.length>0)if(navigator.clipboard?.read)navigator.clipboard.read().then((t=>{for(const e of t)e.types.includes("text/html")?o(e):1===e.types.length&&"text/plain"===e.types[0]&&s(e)}));else{const i=e.stateManager.select.ranges,r=Math.min(i[0].start.col,i[0].end.col),o=Math.min(i[0].start.row,i[0].end.row),n=(t.clipboardData||window.Clipboard).getData("text").split("\n"),s=[];n.forEach((function(t,e){const i=t.split("\t"),r=[];s.push(r),i.forEach((function(t,e){e===i.length-1&&(t=t.trim()),r.push(t)}))})),e.changeCellValues(r,o,s)}}})),r.on(e.getElement(),"contextmenu",(t=>{!1!==e.eventOptions?.preventDefaultContextMenu&&t.preventDefault()})),r.on(e.getContainer(),"resize",(t=>{0===t.width&&0===t.height||e.resize()}));const l=t=>{e.eventManager.LastBodyPointerXY={x:t.x,y:t.y},e.eventManager.isDown=!0};t.globalEventListeners.push({name:"pointerdown",env:"body",callback:l}),document.body.addEventListener("pointerdown",l);const h=t=>{e.eventManager.LastBodyPointerXY=null,e.eventManager.isDown=!1,e.eventManager.isDraging=!1,e.eventManager.inertiaScroll.endInertia()};t.globalEventListeners.push({name:"pointerup",env:"document",callback:h}),document.addEventListener("pointerup",h);const c=r=>{if(e.eventManager.isDown&&e.eventManager.LastBodyPointerXY){const t=e.eventManager.LastBodyPointerXY?.x??r.x,i=e.eventManager.LastBodyPointerXY?.y??r.y;(Math.abs(t-r.x)>1||Math.abs(i-r.y)>1)&&(e.eventManager.isDraging=!0)}const{x:o,y:n}=e._getMouseAbstractPoint(r,!1);i.interactionState===eC.grabing&&(i.isResizeCol()?(t.dealColumnResize(o,n),e.hasListeners(ww.RESIZE_COLUMN)&&e.fireListeners(ww.RESIZE_COLUMN,{col:e.stateManager.columnResize.col,colWidth:e.getColWidth(e.stateManager.columnResize.col)})):i.isResizeRow()&&(t.dealRowResize(o,n),e.hasListeners(ww.RESIZE_ROW)&&e.fireListeners(ww.RESIZE_ROW,{row:e.stateManager.rowResize.row,rowHeight:e.getRowHeight(e.stateManager.rowResize.row)})));const s=e.stateManager.isSelecting();if(t.isDraging&&s&&e.stateManager.select.ranges?.length>0){const t=e.getDrawRange(),i=e.getFrozenRowsHeight(),r=e.getBottomFrozenRowsHeight(),s=e.getFrozenColsWidth(),a=e.getRightFrozenColsWidth(),l=e.stateManager.select.ranges[e.stateManager.select.ranges.length-1].start,h=e.stateManager.select.ranges[e.stateManager.select.ranges.length-1].end,c=(!1===e.isFrozenRow(l.row)||!1===e.isFrozenRow(h.row))&&e.getAllRowsHeight()>e.tableNoFrameHeight,d=(!1===e.isFrozenColumn(l.col)||!1===e.isFrozenColumn(h.col))&&e.getAllColsWidth()>e.tableNoFrameWidth;if((n>t.bottom-r||n<t.top+i)&&c||(o>t.right-a||o<t.left+s)&&d){e.eventManager.scrollXSpeed=0,e.eventManager.scrollYSpeed=0;let l=!1,h=!1,u=!1,g=!1;n>t.bottom-r&&c&&e.scrollTop+e.tableNoFrameWidth<e.getAllRowsHeight()?(l=!0,e.eventManager.scrollYSpeed=-(n-t.bottom+r)/50):n<t.top+i&&c&&e.scrollTop>0&&(h=!0,e.eventManager.scrollYSpeed=-(n-t.top-i)/50),o>t.right-a&&d&&e.scrollLeft+e.tableNoFrameWidth<e.getAllColsWidth()?(u=!0,e.eventManager.scrollXSpeed=-(o-t.right+a)/50):o<t.left+s&&d&&e.scrollLeft>0&&(g=!0,e.eventManager.scrollXSpeed=-(o-t.left-s)/50),e.eventManager.inertiaScroll.startInertia(e.eventManager.scrollXSpeed,e.eventManager.scrollYSpeed,1),e.eventManager.inertiaScroll.setScrollHandle(((c,d)=>{let p,f;RP({deltaX:-c,deltaY:-d},e.stateManager,!1),l?f=e.scrollTop+t.height-r-20:h&&(f=e.scrollTop+i+20),u?p=e.scrollLeft+t.width-a-20:g&&(p=e.scrollLeft+s+20);let m=!1,b=!1;u||g||(o>e.tableNoFrameWidth-e.getRightFrozenColsWidth()&&o<e.tableNoFrameWidth||o>0&&o<e.getFrozenColsWidth()?(p=o,b=!0):p=e.scrollLeft+o),l||h||(n>e.tableNoFrameHeight-e.getBottomFrozenRowsHeight()&&n<e.tableNoFrameHeight||n>0&&n<e.getFrozenRowsHeight()?(f=n,m=!0):f=e.scrollTop+n),e.stateManager.updateInteractionState(eC.grabing),e.stateManager.updateSelectPos(e.getTargetColAtConsiderRightFrozen(p,b).col,e.getTargetRowAtConsiderBottomFrozen(f,m).row,!1,!1,!1,!0)}))}else e.eventManager.inertiaScroll.isInertiaScrolling()?e.eventManager.inertiaScroll.endInertia():e.eventManager.scrollYSpeed=0}};t.globalEventListeners.push({name:"pointermove",env:"body",callback:c}),document.body.addEventListener("pointermove",c)}(this),function(t){const e=t.table,i=e.stateManager,r=e.scenegraph;r.component.vScrollBar.addEventListener("pointerover",(t=>{i.showVerticalScrollBar()})),r.component.hScrollBar.addEventListener("pointerover",(t=>{i.showHorizontalScrollBar()})),r.component.vScrollBar.addEventListener("pointerout",(t=>{i.interactionState!==eC.scrolling&&i.hideVerticalScrollBar()})),r.component.hScrollBar.addEventListener("pointerout",(t=>{i.interactionState!==eC.scrolling&&i.hideHorizontalScrollBar()})),r.component.vScrollBar.addEventListener("pointermove",(t=>{r.table.stateManager.updateCursor("default"),t.stopPropagation()})),r.component.vScrollBar.addEventListener("pointerdown",(t=>{t.stopPropagation()})),r.component.vScrollBar.addEventListener("scrollDown",(t=>{r.table.eventManager.LastBodyPointerXY={x:t.x,y:t.y},r.table.eventManager.isDown=!0,i.interactionState!==eC.scrolling&&i.updateInteractionState(eC.scrolling),r.table.stateManager.hideMenu(),r.table.editorManager?.completeEdit(),r.table.hasListeners(ww.MOUSEDOWN_TABLE)&&r.table.fireListeners(ww.MOUSEDOWN_TABLE,{event:t.nativeEvent})})),r.component.vScrollBar.addEventListener("pointerup",(()=>{i.fastScrolling=!1,r.table.eventManager.isDraging=!1,i.interactionState===eC.scrolling&&i.updateInteractionState(eC.default)})),r.component.vScrollBar.addEventListener("pointerupoutside",(()=>{i.fastScrolling=!1,i.interactionState===eC.scrolling&&i.updateInteractionState(eC.default)})),r.component.vScrollBar.addEventListener("scrollUp",(t=>{r.table.eventManager.isDraging=!1})),r.component.hScrollBar.addEventListener("pointermove",(t=>{r.table.stateManager.updateCursor("default"),t.stopPropagation()})),r.component.hScrollBar.addEventListener("pointerdown",(t=>{t.stopPropagation()})),r.component.hScrollBar.addEventListener("scrollDown",(t=>{r.table.eventManager.LastBodyPointerXY={x:t.x,y:t.y},r.table.eventManager.isDown=!0,i.interactionState!==eC.scrolling&&i.updateInteractionState(eC.scrolling),r.table.stateManager.hideMenu(),r.table.editorManager?.completeEdit(),r.table.hasListeners(ww.MOUSEDOWN_TABLE)&&r.table.fireListeners(ww.MOUSEDOWN_TABLE,{event:t.nativeEvent})})),r.component.hScrollBar.addEventListener("pointerup",(()=>{i.fastScrolling=!1,r.table.eventManager.isDraging=!1,i.interactionState===eC.scrolling&&i.updateInteractionState(eC.default)})),r.component.hScrollBar.addEventListener("pointerupoutside",(()=>{i.fastScrolling=!1,i.interactionState===eC.scrolling&&i.updateInteractionState(eC.default)})),r.component.hScrollBar.addEventListener("scrollUp",(t=>{r.table.eventManager.isDraging=!1}));const o=jC(i.updateVerticalScrollBar,20),n=jC(i.updateHorizontalScrollBar,20);r.component.vScrollBar.addEventListener("scrollDrag",(t=>{r.table.eventManager.isDown&&(r.table.eventManager.isDraging=!0),i.fastScrolling=!0,i.interactionState!==eC.scrolling&&i.updateInteractionState(eC.scrolling);const e=t.detail.value[0]/(1-t.detail.value[1]+t.detail.value[0]);o(e,t)})),r.component.hScrollBar.addEventListener("scrollDrag",(t=>{r.table.eventManager.isDown&&(r.table.eventManager.isDraging=!0),i.fastScrolling=!0,i.interactionState!==eC.scrolling&&i.updateInteractionState(eC.scrolling);const e=t.detail.value[0]/(1-t.detail.value[1]+t.detail.value[0]);n(e)}))}(this),function(t){const e=t.table,i=e.stateManager,r=e.scenegraph;t.touchMovePoints=[],e.scenegraph.tableGroup.addEventListener("touchstart",(e=>{e.target.isChildOf(r.component.vScrollBar)||e.target.isChildOf(r.component.vScrollBar)||(t.isTouchdown=!0,t.touchMovePoints.push({x:e.page.x,y:e.page.y,timestamp:Date.now()}))}));const o=r=>{if(t.touchMove&&r.preventDefault(),t.isTouchdown&&PP(r))if(t.downIcon?.attribute?.funcType===lC.dragReorder)r.preventDefault();else{t.touchMovePoints.length>4&&t.touchMovePoints.shift(),t.touchMovePoints.push({x:r.changedTouches[0].pageX,y:r.changedTouches[0].pageY,timestamp:Date.now()});const o=-t.touchMovePoints[t.touchMovePoints.length-1].x+t.touchMovePoints[t.touchMovePoints.length-2].x,n=-t.touchMovePoints[t.touchMovePoints.length-1].y+t.touchMovePoints[t.touchMovePoints.length-2].y;RP({deltaX:o,deltaY:n},i),r.cancelable&&("none"===e.internalProps.overscrollBehavior||Math.abs(n)>=Math.abs(o)&&0!==n&&BP(n,i)||Math.abs(n)<=Math.abs(o)&&0!==o&&MP(o,i))&&r.preventDefault()}};window.addEventListener("touchmove",o,{passive:!1}),t.globalEventListeners.push({name:"touchmove",env:"window",callback:o});const n=i=>{if(t.touchEnd=!0,t.touchMove=!1,t.isTouchdown&&PP(i)){if(t.downIcon?.attribute?.funcType===lC.dragReorder)i.preventDefault();else if(t.touchMovePoints?.length){t.touchMovePoints.length>4&&t.touchMovePoints.shift(),t.touchMovePoints.push({x:i.changedTouches[0].pageX,y:i.changedTouches[0].pageY,timestamp:Date.now()});const r=t.touchMovePoints[0],o=t.touchMovePoints[t.touchMovePoints?.length-1],n=(o.x-r.x)/(o.timestamp-r.timestamp),s=(o.y-r.y)/(o.timestamp-r.timestamp);t.inertiaScroll.startInertia(n,s,.95),e.eventManager.inertiaScroll.setScrollHandle(((t,i)=>{RP({deltaX:-t,deltaY:-i},e.stateManager)}))}t.isTouchdown=!1,t.touchMovePoints=[]}};window.addEventListener("touchend",n),t.globalEventListeners.push({name:"touchend",env:"window",callback:n});const s=e=>{t.touchEnd=!0,t.touchMove=!1,t.isTouchdown&&(t.isTouchdown=!1,t.touchMovePoints=[])};window.addEventListener("touchcancel",s),t.globalEventListeners.push({name:"touchcancel",env:"window",callback:s})}(this),_P(this)}updateEventBinder(){setTimeout((()=>{AT(this.table)&&0===this.handleTextStickBindId?.length?(this.handleTextStickBindId.push(this.table.on(ww.SCROLL,(t=>{wT(this.table)}))),this.handleTextStickBindId.push(this.table.on(ww.RESIZE_COLUMN_END,(t=>{wT(this.table)}))),this.handleTextStickBindId.push(this.table.on(ww.RESIZE_ROW_END,(t=>{wT(this.table)})))):!AT(this.table)&&this.handleTextStickBindId&&(this.handleTextStickBindId.forEach((t=>{this.table.off(t)})),this.handleTextStickBindId=[])}),0)}bindSelfEvent(){if(this.table.isReleased)return;const t=this.table.stateManager;var e;this.table.on(ww.ICON_CLICK,(e=>{const{col:i,row:r,x:o,y:n,funcType:s,icon:a,event:l}=e;var h;s===lC.dropDown?t.triggerDropDownMenu(i,r,o,n,l):s===lC.sort?t.triggerSort(i,r,a,l):s===lC.frozen?t.triggerFreeze(i,r,a):s===lC.drillDown?(h=this.table).fireListeners(pP.DRILLMENU_CLICK,h.stateManager.drill):s!==lC.collapse&&s!==lC.expand||(this.table.stateManager.updateSelectPos(-1,-1),this.table.toggleHierarchyState(i,r))})),this.table.on(ww.DROPDOWN_MENU_CLICK,(()=>{t.hideMenu()})),this.updateEventBinder(),e=this.table,"browser"===kC.mode&&e.on(ww.CLICK_CELL,(t=>{const{col:i,row:r}=t;let o;o=e.internalProps.layoutMap.isHeader(i,r)?e.isPivotTable()?e._getHeaderLayoutMap(i,r).headerType:e.getHeaderDefine(i,r).headerType:e.getBodyColumnType(i,r);const n=e.isHeader(i,r)?e.getHeaderDefine(i,r):e.getBodyColumnDefine(i,r),s=e.getCellValue(i,r),a=e.getCellOriginValue(i,r);if("link"===o){if(!1===n.linkJump)return;const t=n.templateLink,o=!1!==n.linkDetect;let l;if(t){const o=e.getCellOriginRecord(i,r),n=Object.assign({__value:s,__dataValue:a},o),h=/\{\s*(\S+?)\s*\}/g;l=t.replace(h,((t,e)=>n[e]))}else if(o){if(!zw.test(s))return;l=s}else l=s;window.open(l)}else if("image"===o){const{clickToPreview:t}=n;if(!1===t)return;const e=document.createElement("div");e.style.width="100%",e.style.height="100%",e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.backgroundColor="rgba(30, 30, 30, 0.4)",e.style.display="flex",e.style.justifyContent="center",e.style.alignItems="center",e.style.overflow="hidden",e.style.zIndex="9999",e.addEventListener("click",(t=>{t.target===e&&document.body.removeChild(e)}));const i=new Image;i.src=s,i.style.maxWidth="80%",i.style.maxHeight="80%",e.appendChild(i),document.body.appendChild(e)}else if("video"===o){const{clickToPreview:t}=n;if(!1===t)return;const e=document.createElement("div");e.style.width="100%",e.style.height="100%",e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.backgroundColor="rgba(30, 30, 30, 0.4)",e.style.display="flex",e.style.justifyContent="center",e.style.alignItems="center",e.style.overflow="hidden",e.style.zIndex="9999",e.addEventListener("click",(t=>{t.target===e&&document.body.removeChild(e)}));const i=document.createElement("video");i.src=s,i.style.maxWidth="80%",i.style.maxHeight="80%",i.setAttribute("preload","auto"),i.setAttribute("controls","true"),e.appendChild(i),document.body.appendChild(e)}})),this.table.on(ww.DBLCLICK_CELL,(t=>{if(t.federatedEvent){const e=vP(t.federatedEvent),i=this.table.scenegraph.getResizeColAt(e.abstractPos.x,e.abstractPos.y,e.eventArgs?.targetCell);if(this.table.eventManager.checkCellFillhandle(e))this.table.fireListeners(ww.DBLCLICK_FILL_HANDLE,{});else if(this.table._canResizeColumn(i.col,i.row)&&i.col>=0){this.table.scenegraph.updateAutoColWidth(i.col),this.table.internalProps._widthResizedColMap.add(i.col),this.table.scenegraph.updateChartSize(i.col);const t=this.table.stateManager;t.columnResize.col<t.table.frozenColCount&&!t.table.isPivotTable()&&!t.table.transpose&&t.table.scenegraph.component.setFrozenColumnShadow(t.table.frozenColCount-1,t.columnResize.isRightFrozen);const e=[];for(let t=0;t<this.table.colCount;t++)e.push(this.table.getColWidth(t));this.table.fireListeners(ww.RESIZE_COLUMN_END,{col:i.col,colWidths:e})}}})),this.table.isPivotTable()&&function(t){const e=t.internalProps.layoutMap.rowsDefine,i=t.internalProps.layoutMap.columnsDefine;for(let t=0;t<e.length;t++){const i=e[t];if("string"!=typeof i&&(i.drillDown||i.drillUp))return!0}for(let t=0;t<i.length;t++){const e=i[t];if("string"!=typeof e&&(e.drillDown||e.drillUp))return!0}return!1}(this.table)&&function(t){t.on(ww.MOUSEENTER_CELL,(e=>{const{col:i,row:r}=e;if(-1===i||-1===r)return;const o=t.internalProps.layoutMap.getHeaderDimension(i,r);o?.drillDown||o?.drillUp?t.stateManager.updateDrillState(o.dimensionKey,o.title,o.drillDown,o.drillUp,i,r):t.stateManager.updateDrillState(void 0,void 0,!1,!1,-1,-1)})),t.on(ww.MOUSELEAVE_TABLE,(e=>{t.stateManager.updateDrillState(void 0,void 0,!1,!1,-1,-1)}))}(this.table),function(t){let e=!1;e=t.isPivotTable()?t.internalProps.layoutMap.indicatorsDefine.some((t=>"string"!=typeof t&&"sparkline"===t.cellType)):t.internalProps.layoutMap.columnObjects.some((t=>"sparkline"===t.cellType||"function"==typeof t.cellType));e&&(t.on(ww.MOUSEMOVE_CELL,(e=>{const{col:i,row:r,x:o,y:n}=e;"sparkline"!==t.getBodyColumnType(i,r)&&t.stateManager.updateSparklineHoverPose(-1,-1,0,0),t.stateManager.updateSparklineHoverPose(i,r,o,n)})),t.on(ww.MOUSELEAVE_TABLE,(e=>{t.stateManager.updateSparklineHoverPose(-1,-1,0,0)})))}(this.table),function(t){t.isPivotChart()&&t.scenegraph.tableGroup.addEventListener("click",(e=>{if(!t.stateManager.columnMove.moving&&!t.stateManager.columnResize.resizing)if("axis-label"===e.target.name){const i=vP(e),{col:r,row:o}=i.eventArgs,n=t.internalProps.layoutMap;let s,a;n.indicatorsAsCol?(s=n.getDimensionKeyInChartSpec(n.rowHeaderLevelCount,o),a=n.getCellHeaderPaths(n.rowHeaderLevelCount-2,o).rowHeaderPaths):(s=n.getDimensionKeyInChartSpec(r,n.columnHeaderLevelCount),a=n.getCellHeaderPaths(r,n.columnHeaderLevelCount-1).colHeaderPaths);const l=a.map((t=>({key:t.dimensionKey,value:t.value}))).filter((t=>t.key));if(l.push({key:s,value:e.target.attribute.text}),t._selectedDimensionInChart.length&&function(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i].key!==e[i].key||t[i].value!==e[i].value)return!1;return!0}(t._selectedDimensionInChart,l))return;t._selectedDimensionInChart=l,n.updateDataStateToChartInstance(),KT(t.scenegraph),t.scenegraph.updateNextFrame()}else t._selectedDimensionInChart?.length&&(t._selectedDimensionInChart.length=0,t.internalProps.layoutMap.updateDataStateToChartInstance(),KT(t.scenegraph),t.scenegraph.updateNextFrame())}))}(this.table),function(t){t.isPivotChart()&&(t.on(ww.MOUSEENTER_CELL,(e=>{t.scenegraph.getCell(e.col,e.row).forEachChildren((i=>{if("axis"===i.name){const i=HP(e.col,e.row,t.internalProps.layoutMap);e.axisPosition=i,t.fireListeners(ww.MOUSEENTER_AXIS,e)}}))})),t.on(ww.MOUSELEAVE_CELL,(e=>{t.scenegraph.getCell(e.col,e.row).forEachChildren((i=>{if("axis"===i.name){const i=HP(e.col,e.row,t.internalProps.layoutMap);e.axisPosition=i,t.fireListeners(ww.MOUSELEAVE_AXIS,e)}}))})))}(this.table)}dealTableHover(t){if(!t)return void this.table.stateManager.updateHoverPos(-1,-1);const{eventArgs:e}=t;e?this.table.stateManager.updateHoverPos(e.col,e.row):this.table.stateManager.updateHoverPos(-1,-1)}dealIconHover(t){const{eventArgs:e}=t;e?this.table.stateManager.updateHoverIcon(e.col,e.row,e.target,e.targetCell,e.event):this.table.stateManager.updateHoverIcon(-1,-1,void 0,void 0)}dealMenuHover(t){}dealTableSelect(t,e){if(!t)return this.table.stateManager.updateSelectPos(-1,-1),!1;const{eventArgs:i}=t;if(i){if("checkbox"===i.target.name||"radio"===i.target.name)return!1;const r=this.table.getBodyColumnDefine(i.col,i.row);return this.table.isHeader(i.col,i.row)&&(r?.disableHeaderSelect||this.table.stateManager.select?.disableHeader)||!this.table.isHeader(i.col,i.row)&&r?.disableSelect?(e||this.table.stateManager.updateSelectPos(-1,-1),!1):!this.table.isPivotChart()||"axis-label"!==t?.eventArgs?.target.name&&"chart"!==t?.eventArgs?.target.type?(this.table.stateManager.updateSelectPos(i.col,i.row,i.event.shiftKey,i.event.ctrlKey||i.event.metaKey,!1,e),!0):(this.table.stateManager.updateSelectPos(-1,-1),!1)}return!1}dealFillSelect(t,e){const{eventArgs:i}=t;if(i){if(this.table.stateManager.select?.ranges?.length&&this.table.stateManager.isFillHandle()){let r,o;const n=this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1];e&&(Y(this.table.stateManager.fillHandle.directionRow)||(Math.abs(this.table.stateManager.fillHandle.startY-t.abstractPos.y)>=Math.abs(this.table.stateManager.fillHandle.startX-t.abstractPos.x)?this.table.stateManager.fillHandle.directionRow=!0:this.table.stateManager.fillHandle.directionRow=!1),Math.abs(this.table.stateManager.fillHandle.startY-t.abstractPos.y)>=Math.abs(this.table.stateManager.fillHandle.startX-t.abstractPos.x)?this.table.stateManager.fillHandle.startY-t.abstractPos.y>0?this.table.stateManager.fillHandle.direction="top":this.table.stateManager.fillHandle.direction="bottom":this.table.stateManager.fillHandle.startX-t.abstractPos.x>0?this.table.stateManager.fillHandle.direction="left":this.table.stateManager.fillHandle.direction="right",this.table.stateManager.fillHandle.directionRow?(r=i.row,o=n.end.col):(r=n.end.row,o=i.col)),this.table.stateManager.updateSelectPos(e?o:n.end.col,e?r:n.end.row,!0,i.event.ctrlKey||i.event.metaKey,!1,e)}else this.table.stateManager.updateSelectPos(i.col,i.row,i.event.shiftKey,i.event.ctrlKey||i.event.metaKey,!1,e);return!0}return!1}deelTableSelectAll(){this.table.stateManager.updateSelectPos(-1,-1,!1,!1,!0)}dealMenuSelect(t){}checkColumnResize(t,e){const{eventArgs:i}=t,r=this.table.scenegraph.getResizeColAt(t.abstractPos.x,t.abstractPos.y,i?.targetCell);return!!(this.table._canResizeColumn(r.col,r.row)&&r.col>=0)&&(e&&this.table.stateManager.startResizeCol(r.col,t.abstractPos.x,t.abstractPos.y,r.rightFrozen),!0)}checkRowResize(t,e){const{eventArgs:i}=t;if(i){const r=this.table.scenegraph.getResizeRowAt(t.abstractPos.x,t.abstractPos.y,i.targetCell);if(this.table._canResizeRow(r.col,r.row)&&r.row>=0)return e&&this.table.stateManager.startResizeRow(r.row,t.abstractPos.x,t.abstractPos.y,r.bottomFrozen),!0}return!1}checkCellFillhandle(t,e){if(this.table.options.excelOptions?.fillHandle){const{eventArgs:i}=t;if(i&&this.table.stateManager.select?.ranges?.length){const i=Math.max(this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].start.col,this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].end.col),r=Math.max(this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].start.row,this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].end.row),o=this.table.scenegraph.highPerformanceGetCell(i,r).globalAABBBounds,n=Math.abs(t.abstractPos.x-o.x2),s=Math.abs(t.abstractPos.y-o.y2),a=18;if(this.table.stateManager.fillHandle?.isFilling||n<=a/2&&s<=a/2)return e&&this.table.stateManager.startFillSelect(t.abstractPos.x,t.abstractPos.y),!0}}return!1}dealColumnResize(t,e){this.table.stateManager.updateResizeCol(t,e)}dealRowResize(t,e){this.table.stateManager.updateResizeRow(t,e)}chechColumnMover(t){const{eventArgs:e}=t;return!!(e&&this.table.isHeader(e.col,e.row)&&function(t,e,i){for(let r=0;r<i.length;r++)if(dw(i[r],t,e))return!0;return!1}(e.col,e.row,this.table.stateManager.select.ranges)&&this.table._canDragHeaderPosition(e.col,e.row))&&(this.table.stateManager.startMoveCol(e.col,e.row,t.abstractPos.x,t.abstractPos.y),!0)}dealColumnMover(t){const{eventArgs:e}=t;Y(e.col)&&Y(e.row)&&this.table.stateManager.updateMoveCol(e.col,e.row,t.abstractPos.x,t.abstractPos.y)}startColumnResize(t){}dealIconClick(t,e){const{eventArgs:i}=e,{target:r,event:o,col:n,row:s}=i||{target:t.target,event:t,col:-1,row:-1},a=r;if(a.role&&a.role.startsWith("icon-"))return this.table.fireListeners(ww.ICON_CLICK,{name:a.name,x:(a.globalAABBBounds.x1+a.globalAABBBounds.x2)/2,y:a.globalAABBBounds.y2,col:n,row:s,funcType:a.attribute.funcType,icon:a,event:o}),!0;if(r instanceof Pl){const t=r.pickIcon(o.global);if(t)return this.table.fireListeners(ww.ICON_CLICK,{name:t.attribute.id,x:t.globalX+t.globalAABBBounds.width()/2,y:t.globalY+t.AABBBounds.height(),col:n,row:s,funcType:t.attribute.funcType,icon:t,event:o}),!0}return!1}release(){this.gesture.release(),this.globalEventListeners.forEach((t=>{"document"===t.env?document.removeEventListener(t.name,t.callback):"body"===t.env?document.body.removeEventListener(t.name,t.callback):"window"===t.env&&window.removeEventListener(t.name,t.callback)})),this.globalEventListeners=[]}}let kP;const LP=t=>{const e=t.value;return Number(e)>80?"#20a8d8":Number(e)>50?"#4dbd74":Number(e)>20?"#ffc107":"#f86c6b"};class FP extends yC{_showBar;_barColor;_barBgColor;_barPositiveColor;_barNegativeColor;_barAxisColor;_barHeight;_barBottom;_barPadding;_showBarMark;_barMarkPositiveColor;_barMarkNegativeColor;_barMarkWidth;_barMarkPosition;_barRightToLeft;static get DEFAULT(){return kP||(kP=new FP)}constructor(t={},e={}){super(t,e),this._showBar=t.showBar??!0,this._barColor=t.barColor??LP,this._barPositiveColor=t.barPositiveColor??"#4dbd74",this._barNegativeColor=t.barNegativeColor??"#f86c6b",this._barAxisColor=t.barAxisColor??"black",this._barBgColor=t.barBgColor,this._barHeight=t.barHeight??3,this._barHeight=t.barHeight??3,this._barBottom=t.barBottom??0,this._barPadding=t.barPadding??[0,0,0,0],this._showBarMark=t.showBarMark??!1,this._barMarkPositiveColor=t.barMarkPositiveColor??"#4dbd74",this._barMarkNegativeColor=t.barMarkNegativeColor??"#f86c6b",this._barMarkWidth=t.barMarkWidth??2,this._barMarkPosition=t.barMarkPosition??"right",this._barRightToLeft=t.barRightToLeft??!1}get showBar(){return this._showBar}set showBar(t){this._showBar=t}get barColor(){return this._barColor}set barColor(t){this._barColor=t}get barBgColor(){return this._barBgColor}set barBgColor(t){this._barBgColor=t}get barHeight(){return this._barHeight}set barHeight(t){this._barHeight=t}get barBottom(){return this._barBottom}set barBottom(t){this._barBottom=t}get barPositiveColor(){return this._barPositiveColor}set barPositiveColor(t){this._barPositiveColor=t}get barNegativeColor(){return this._barNegativeColor}set barNegativeColor(t){this._barNegativeColor=t}get barAxisColor(){return this._barAxisColor}set barAxisColor(t){this._barAxisColor=t}get barPadding(){return this._barPadding}set barPadding(t){this._barPadding=t}get showBarMark(){return this._showBarMark}set showBarMark(t){this._showBarMark=t}get barMarkPositiveColor(){return this._barMarkPositiveColor}set barMarkPositiveColor(t){this._barMarkPositiveColor=t}get barMarkNegativeColor(){return this._barMarkNegativeColor}set barMarkNegativeColor(t){this._barMarkNegativeColor=t}get barMarkWidth(){return this._barMarkWidth}set barMarkWidth(t){this._barMarkWidth=t}get barMarkPosition(){return this._barMarkPosition}set barMarkPosition(t){this._barMarkPosition=t}get barRightToLeft(){return this._barRightToLeft}set barRightToLeft(t){this._barRightToLeft=t}clone(){return new FP(this,null)}}const IP=["type","content","font","color","width","height","marginRight","marginLeft","src","svg","name","path","positionType","tooltip","hover","cursor","shape","interactive"];class zP{expandIcon;collapseIcon;_table;constructor(t){this._table=t;const e=xR();this.expandIcon=e[hC.expandIconName],this.collapseIcon=e[hC.collapseIconName]}getIcons(t,e,i,r,o){const n=[],{icon:s}=this._table.getBodyColumnDefine(t,e);if(s){let o;if("function"==typeof s){o=s({col:t,row:e,value:i,dataValue:r,table:this._table})}else o=s;const a=xR(),l=t=>{let e;e="string"==typeof t?a[t]:t,e&&n.push(e)};Array.isArray(o)?o.forEach(((t,e)=>{l(t)})):l(o)}const a=this.getHierarchyIcon(t,e);return a&&n.push(a),o&&n.forEach(((i,r)=>{(i.content||i.src)&&(n[r]=this.getCellIconFromRecordValue(i,t,e))})),n}getStyleClass(t){switch(t){case"text":case"link":return wC;case"image":case"video":return CC;case"chart":case"sparkline":return yC;case"progressbar":return FP;case"checkbox":return _C;case"radio":return SC}return wC}getCellIconFromRecordValue(t,e,i){if(Array.isArray(t))return t.map((t=>this.getCellIconFromRecordValue(t,e,i)));if(!fw.isObject(t)||"function"==typeof t)return this._table.getFieldData(t,e,i);const r={},o=t;return IP.forEach((t=>{if(void 0!==o[t]){const n=this._table.getFieldData(o[t],e,i);null!=n?r[t]=n:this._table._hasField?.(o[t],e,i)||(r[t]=o[t])}})),r}getHierarchyIcon(t,e){const i=this._table.getHierarchyState(t,e);return i===oC.expand?this.expandIcon:i===oC.collapse?this.collapseIcon:void 0}getHierarchyIconWidth(){return this.expandIcon.width+(this.expandIcon.marginLeft??0)+(this.expandIcon.marginRight??0)}}function OP(t,e){const i=document.createElement(t);return e&&i.classList.add(...e),i}!function(){if("node"===kC.mode)return;const t=document.createElement("style");t.id="vtable-menu-styleSheet",t.textContent="\n@keyframes vtable__menu-element--shown-animation {\n\t0% {\n\t\topacity: 0;\n\t}\n\t100% {\n\t\topacity: 1;\n\t}\n}\n.vtable__menu-element {\n\tposition: absolute;\n\tbox-sizing: border-box;\n\tborder-radius: 4px;\n\tbackground-color: #fff;\n\tpadding: 6px 0;\n\t/* pointer-events: none; */\n\tuser-select: none;\n\tcolor: #000;\n\tmax-width: 300px;\n\tz-index: 99999;\n\tborder: #CCC 0.5px solid;\n\tcursor: default;\n\twidth: max-content;\n\tbox-shadow: 0px 8px 16px rgba(27, 31, 35, 0.12);\n}\n.vtable__menu-element--hidden {\n\topacity: 0;\n\t/* transform: translate(-50%, -50%); */\n\ttransition: opacity 75ms linear;\n\tz-index: -9999;\n}\n.vtable__menu-element--shown {\n\topacity: 1;\n\t/* transform: translate(-50%, -50%); */\n\tanimation: vtable__menu-element--shown-animation 150ms ease-out;\n}\n.vtable__menu-element__content {\n\tfont-family: Roboto;\n\tfont-size: 12px;\n\toverflow: hidden;\n\tdisplay: inline-block;\n\t/* height: 100%; */\n\tline-height: 30px;\n}\n.vtable__menu-element__item {\n\theight: 32px;\n\tpadding: 0px 12px;\n\tcursor: pointer;\n\tposition: relative;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: flex-start;\n}\n.vtable__menu-element__item:hover {\n\tbackground-color: rgba(27, 31, 35, 0.06);\n}\n.vtable__menu-element__icon{\n\t/* vertical-align: top; */\n\tdisplay: flex;\n\t/* line-height: 30px; */\n\tmargin-right: 6px;\n}\n.vtable__menu-element__no-event {\n\tpointer-events: none;\n}\n.vtable__menu-element--select {\n\tcolor: #2E68CF;\n}.vtable__menu-element--normal {\n\tcolor: rgba(20, 20, 20, 0.9);;\n}\n.vtable__menu-element__split {\n\theight: 0px;\n\tborder: 1px solid rgb(209, 213, 218);\n\tmargin: 5px 0;\n}\n.vtable__menu-element__title {\n\tcolor: rgb(149, 149, 149);\n}\n.vtable__menu-element__arrow {\n\tposition: absolute;\n\tright: 3px;\n\tfont-weight: bold;\n\tmargin-top: 1px;\n}\n.vtable__menu-element__item-text {\n\tmargin-right: 15px;\n}\n",document.head.appendChild(t)}();const DP="vtable__menu-element",WP=`${DP}__item`,NP=`${DP}__content`,GP=`${DP}--hidden`,jP=`${DP}--shown`,VP=`${DP}--normal`,UP=`${DP}--select`,KP=`${DP}__icon`,$P=`${DP}__split`,XP=`${DP}__title`,YP=`${DP}__arrow`,qP=`${DP}__no-event`,ZP=`${DP}__item-text`;function JP(){return OP("div",[DP,GP])}function QP(t,e,i,r,o,n){const s=t.getCellRange(r,o);for(let r=0;r<e.length;r++){const o=e[r];let{col:n,row:a}=o;const{field:l,menuKey:h}=o;if("number"!=typeof n||"number"!=typeof a)if(t.isPivotTable()&&(Array.isArray(l),1)){const e=t.internalProps.layoutMap.getPivotCellAdress(l);if(!e)continue;n=e.col,a=e.row}else{const e=t.internalProps.layoutMap.getHeaderCellAddressByField(l);if(!e)continue;n=e.col,a=e.row}if(Y(n)&&Y(a)&&dw(s,n,a)&&i===h)return!0}return!1}class tH{_handler;_rootElement;_secondElement;_menuInstanceInfo;_showChildrenIndex;_mouseEnterSecondElement;constructor(t){this._handler=new Aw,this._rootElement=JP(),this._secondElement=JP(),this._secondElement.sub=!0,this._showChildrenIndex=-1,this._rootElement.addEventListener("wheel",(t=>{t.stopPropagation()})),this._rootElement?.addEventListener("mousedown",(t=>{t.stopPropagation(),t.preventDefault()})),this._rootElement?.addEventListener("touchend",(e=>{if(e.stopPropagation(),e.preventDefault(),this._rootElement.classList.contains(GP))return;const{col:i,row:r,dropDownIndex:o,menuKey:n,text:s,hasChildren:a}=e.target;if("number"!=typeof o||a)return void e.stopPropagation();const l=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(i,r):t.getHeaderField(i,r),h=t._dropDownMenuIsHighlight(i,r,o);t.fireListeners(ww.DROPDOWN_MENU_CLICK,{col:i,row:r,field:l,menuKey:n,text:s,highlight:h,cellLocation:t.getCellLocation(i,r),event:e}),t.fireListeners(ww.DROPDOWN_MENU_CLEAR,null),t.fireListeners(ww.HIDE_MENU,null),e.stopPropagation()})),this._rootElement?.addEventListener("click",(e=>{if(e.stopPropagation(),e.preventDefault(),this._rootElement.classList.contains(GP))return;const{col:i,row:r,dropDownIndex:o,menuKey:n,text:s,hasChildren:a}=e.target;if("number"!=typeof o||a)return void e.stopPropagation();const l=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(i,r):t.getHeaderField(i,r),h=t._dropDownMenuIsHighlight(i,r,o);t.fireListeners(ww.DROPDOWN_MENU_CLICK,{col:i,row:r,field:l,menuKey:n,text:s,highlight:h,cellLocation:t.getCellLocation(i,r),event:e}),t.fireListeners(ww.DROPDOWN_MENU_CLEAR,null),t.fireListeners(ww.HIDE_MENU,null),e.stopPropagation()})),this._rootElement?.addEventListener("mousemove",(e=>{if(this._rootElement.classList.contains(GP))return;e.stopPropagation();const{hasChildren:i,dropDownIndex:r,col:o,row:n,sub:s}=e.target;if(i){this._showChildrenIndex=r;const i=this._secondElement;i?.classList.remove(GP),i?.classList.add(jP),i.innerHTML="";const s=this._menuInstanceInfo.content[r]?.children;for(let e=0;e<s.length;e++){const r=s[e],a=eH(r,!!t.stateManager.menu.dropDownMenuHighlight&&QP(t,t.stateManager.menu.dropDownMenuHighlight,"object"==typeof r?r?.menuKey||r?.text:r,o,n));a.col=o,a.row=n,a.dropDownIndex=e,"string"==typeof r?(a.text=r,a.menuKey=r):"object"==typeof r&&(a.text=r.text,a.menuKey=r.menuKey||r.text),a.sub=!0,a.sub=!0,i.appendChild(a)}const a=e.target.getBoundingClientRect();this._bindSecondElement(t,o,n,a.right,a.top)}else if(i&&this._showChildrenIndex===r){const t=this._secondElement;t?.classList.remove(GP),t?.classList.add(jP)}else!s&&this._secondElement?.classList.contains(jP)&&setTimeout((()=>{if(!0!==this._mouseEnterSecondElement){this._showChildrenIndex=-1;const t=this._secondElement;t?.classList.remove(jP),t?.classList.add(GP)}}),300)})),this._secondElement?.addEventListener("wheel",(t=>{t.stopPropagation()})),this._secondElement?.addEventListener("mousemove",(t=>{this._rootElement.classList.contains(GP)||t.stopPropagation()})),this._secondElement?.addEventListener("mouseenter",(t=>{this._mouseEnterSecondElement=!0})),this._secondElement?.addEventListener("mouseleave",(t=>{this._mouseEnterSecondElement=!1})),this._secondElement?.addEventListener("mousedown",(t=>{t.stopPropagation(),t.preventDefault()})),this._secondElement?.addEventListener("click",(e=>{if(e.stopPropagation(),e.preventDefault(),this._secondElement.classList.contains(GP))return;const{col:i,row:r,dropDownIndex:o,menuKey:n,text:s,hasChildren:a}=e.target;if("number"!=typeof o||a)return void e.stopPropagation();const l=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(i,r):t.getHeaderField(i,r);let h=!1;this._menuInstanceInfo.content.forEach(((e,o)=>{if("object"==typeof e&&e.children&&e.children.length)for(let o=0;o<e.children.length;o++){const s=e.children[o];if(QP(t,t.stateManager.menu.dropDownMenuHighlight,"object"==typeof s?s?.menuKey:s,i,r)&&n===("object"==typeof s?s?.menuKey:s))return void(h=!0)}})),t.fireListeners(ww.DROPDOWN_MENU_CLICK,{col:i,row:r,field:l,cellHeaderPaths:t.isPivotTable()?t.getCellHeaderPaths(i,r):void 0,menuKey:n,text:s,highlight:h,cellLocation:t.getCellLocation(i,r),event:e}),t.fireListeners(ww.DROPDOWN_MENU_CLEAR,null),t.fireListeners(ww.HIDE_MENU,null),e.stopPropagation()}))}get rootElement(){return this._rootElement}release(){this.unbindFromCell();const t=this._rootElement;t?.parentElement&&t.parentElement.removeChild(t),this._handler.release(),delete this._rootElement}bindToCell(t,e,i,r){const o=this._rootElement,n=this._secondElement;if(this._menuInstanceInfo=r,o?.classList.remove(jP),o?.classList.add(GP),n?.classList.remove(jP),n?.classList.add(GP),this._canBindToCell(t,e,i)){if(o.innerHTML="",Array.isArray(r.content)){const n=r.content;for(let r=0;r<n?.length;r++){const s=n[r];let a=!!t.stateManager.menu.dropDownMenuHighlight&&QP(t,t.stateManager.menu.dropDownMenuHighlight,"object"==typeof s?s?.menuKey||s?.text:s,e,i);if(t.stateManager.menu.dropDownMenuHighlight&&"object"==typeof s&&Array.isArray(s.children)&&s.children.length)for(let r=0;r<s.children.length;r++){const o=s.children[r];if(QP(t,t.stateManager.menu.dropDownMenuHighlight,"object"==typeof o?o?.menuKey||o?.text:o,e,i)){a=!0;break}}const l=eH(s,a);l.col=e,l.row=i,l.dropDownIndex=r,"string"==typeof s?(l.text=s,l.menuKey=s):"object"==typeof s&&(l.text=s.text,l.menuKey=s.menuKey||s.text,s.children?.length&&(l.hasChildren=!0)),o.appendChild(l)}}if(this._bindToCell(t,e,i,r.position,r.referencePosition))return o?.classList.add(jP),o?.classList.remove(GP),!0}else this.unbindFromCell();return!1}unbindFromCell(){const t=this._rootElement,e=this._secondElement;this._menuInstanceInfo=void 0,t?.parentElement&&(t.classList.remove(jP),t.classList.add(GP)),e?.parentElement&&(e.classList.remove(jP),e.classList.add(GP))}_canBindToCell(t,e,i){const r=t.getCellRangeRelativeRect({col:e,row:i}),o=t.getElement(),{top:n,bottom:s,left:a,right:l}=r;if(t.isFrozenCell(e,i))return!0;if(s<t.getFrozenRowsHeight()||l<t.getFrozenColsWidth()||a>t.tableNoFrameWidth-t.getRightFrozenColsWidth()||n>t.tableNoFrameHeight-t.getBottomFrozenRowsHeight())return!1;const{offsetHeight:h,offsetWidth:c}=o;return!(h<n)&&!(c<a)}_bindToCell(t,e,i,r,o){const n=this._rootElement,s=t.getElement(),{width:a,height:l}=t.internalProps.element.getBoundingClientRect();if(n){n.parentElement!==s&&s.appendChild(n),n.style.left="0px";const t=.8*a;n.style.maxWidth=`${t}px`;const e=n.clientWidth,i=n.clientHeight;let h,c;return r?(h=r.x,c=r.y):o&&(h=o.rect.right-e,c=o.rect.bottom),c+i>l&&(c=l-i),c<0&&(c/=2),n.style.top=`${c}px`,h<0?h=0:h+e>a&&(h=a-e),n.style.left=`${h}px`,!0}return!1}_bindSecondElement(t,e,i,r,o){const n=this._secondElement,s=this._rootElement,a=t.getElement(),{width:l,left:h,top:c}=t.internalProps.element.getBoundingClientRect(),{x:d,y:u,width:g}=s.getBoundingClientRect();if(n){n.parentElement!==a&&a.appendChild(n),n.style.left="0px";const t=.8*l;n.style.maxWidth=`${t}px`;const e=n.clientWidth,i=o-4-c,s=r-h;n.style.top=`${i}px`;let d=s;return d+e>l?d=d-e-g:d+=4,n.style.left=`${d}px`,!0}return!1}pointInMenuElement(t,e){const i=this._rootElement,{x:r,y:o,width:n,height:s}=i.getBoundingClientRect();if(t>r-5&&t<r+n+5&&e>o-5&&e<o+s+5)return!0;if(this._secondElement){const{x:r,y:o,width:n,height:s}=i.getBoundingClientRect();if(t>r-5&&t<r+n+5&&e>o-5&&e<o+s+5)return!0}return!1}}function eH(t,e){const i=OP("div",[WP,e?UP:VP]);if("string"==typeof t){const e=OP("span",[NP,qP,ZP]);e.innerHTML=t,i.appendChild(e)}else if("object"==typeof t){const r=t.type??"item";if("split"===r)return i?.classList.add($P),i;if(t?.icon?.svg)if(zw.test(t.icon.svg)){const e=new Image;t.icon.width?e.style.width=t.icon.width.toString()+"px":e.style.width="16px",t.icon.height?e.style.height=t.icon.height.toString()+"px":e.style.height="16px",e.src=t.icon.svg,i.appendChild(e)}else{const r=OP("span",[KP,qP]);r.innerHTML=e&&t.selectedIcon&&t.selectedIcon.svg?t.selectedIcon.svg:t.icon.svg,t.icon.width&&r.children[0].setAttribute("width",t.icon.width.toString()),t.icon.height&&r.children[0].setAttribute("height",t.icon.height.toString()),i.appendChild(r)}const o=OP("span",[NP,qP,ZP]);if(o.innerHTML=t.text,i.appendChild(o),"title"===r)i?.classList.add(qP,XP);else if(t?.children?.length){const t=OP("span",[NP,qP,YP]);t.innerHTML=e?'<svg width="8" height="12" viewBox="0 0 10 17" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: baseline"><path d="M1.78186 16.7729L0.300378 15.2915L6.8189 8.77295L0.300377 2.25443L1.78186 0.77295L9.78186 8.77295L1.78186 16.7729Z" fill="#2E68CF" fill-opacity="0.65"></path></svg>':'<svg width="8" height="12" viewBox="0 0 10 17" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: baseline"><path d="M1.78186 16.7729L0.300378 15.2915L6.8189 8.77295L0.300377 2.25443L1.78186 0.77295L9.78186 8.77295L1.78186 16.7729Z" fill="#141414" fill-opacity="0.65"></path></svg>',i.appendChild(t)}}return i}let iH;class rH extends BC{static get DEFAULT(){return iH||(iH=new rH)}constructor(t={},e={}){super(t,e),this.textAlign=(t.textAlign??e?.textAlign)||"center"}clone(){return new rH(this)}}class oH{normalIcon;upIcon;downIcon;freezeIcon;frozenIcon;frozenCurrentIcon;dropDownAbsoluteIcon;expandIcon;collapseIcon;_table;constructor(t){this._table=t;const e=xR();this.freezeIcon=e[hC.freezeIconName],this.frozenIcon=e[hC.frozenIconName],this.frozenCurrentIcon=e[hC.frozenCurrentIconName],this.normalIcon=e[hC.normalIconName],this.upIcon=e[hC.upwardIconName],this.downIcon=e[hC.downwardIconName],this.dropDownAbsoluteIcon=e[hC.dropdownIconName],this.expandIcon=e[hC.expandIconName],this.collapseIcon=e[hC.collapseIconName]}getIcons(t,e){const i=[];if(this._table.isPivotTable()){const{showSort:r}=this._table.internalProps.layoutMap.getHeader(t,e);if(r){const r=this._table.getPivotSortState(t,e),o="asc"===r?this.downIcon:"desc"===r?this.upIcon:this.normalIcon;o&&i.push(o)}}else{const r=this._table.sortState;let o;o=void 0;const n=this._table.getCellRange(t,e);if(r)if(Array.isArray(r))for(let t=0;t<r.length;t++){const e=r[t],i=this._table._getHeaderCellBySortState(e);if(i&&dw(n,i.col,i.row)){({order:o}=e);break}}else{const t=this._table._getHeaderCellBySortState(r);t&&dw(n,t.col,t.row)&&({order:o}=r)}const s=this.getSortIcon(o,this._table,t,e);s&&i.push(s)}if(this._table.showFrozenIcon&&t<this._table.allowFrozenColCount){const r=this.getFrozenIcon(t,e);r&&i.push(r)}if(this.checkDropDownIcon(this._table,t,e)){const t=this.dropDownAbsoluteIcon;i.push(t)}const r=this.getDropDownStateIcons(this._table,t,e);r.length&&i.push(...r);const{headerIcon:o}=this._table._getHeaderLayoutMap(t,e),n=this.getHierarchyIcon(t,e);if(n&&i.push(n),o){let r;if("function"==typeof o){r=o({col:t,row:e,value:this._table.getCellValue(t,e),dataValue:this._table.getCellOriginValue(t,e),table:this._table})}else r=o;const n=xR(),s=t=>{let e;e="string"==typeof t?n[t]:t,e&&i.push(e)};Array.isArray(r)?r.forEach(((t,e)=>{s(t)})):s(r)}return i}getFrozenIcon(t,e){if(this._table.isPivotTable()||this._table.transpose)return null;if(this._table.rightFrozenColCount&&t>=this._table.colCount-this._table.rightFrozenColCount)return null;const i=this._table.getHeaderDefine(t,e);if(i.columns&&i.columns.length>0)return null;let r=this.freezeIcon;return this._table.options.frozenColCount-1>t?r=this.frozenIcon:this._table.options.frozenColCount-1===t&&(r=this.frozenCurrentIcon),r}getSortIcon(t,e,i,r){const o="asc"===t?this.downIcon:"desc"===t?this.upIcon:this.normalIcon,n=e.getHeaderDefine(i,r);return!n||!1===n.showSort||!Y(n.showSort)&&!n.sort||n.columns&&n.columns.length>0?null:o}getDropDownStateIcons(t,e,i){const r=t.getHeaderDefine(e,i),o=t._getHeaderLayoutMap(e,i),{dropDownMenu:n}=o,s=[];if(Array.isArray(n)&&n.length||Array.isArray(t.globalDropDownMenu)&&t.globalDropDownMenu.length&&!r?.columns?.length){const r=n||t.globalDropDownMenu;let o=-1,a=-1;for(let n=0;n<r.length;n++){const s=r[n];if("object"==typeof s&&s.children&&s.children.length)for(let r=0;r<s.children.length;r++){const l=s.children[r];if(t.stateManager.menu?.dropDownMenuHighlight&&QP(t,t.stateManager.menu?.dropDownMenuHighlight,"object"==typeof l?l?.menuKey:l,e,i)){o=n,a=r;break}}if(t._dropDownMenuIsHighlight(e,i,n)){o=n;break}}if(-1!==o){let e;e=-1!==a?(n||t.globalDropDownMenu)[o].children[a]:(n||t.globalDropDownMenu)[o],e.stateIcon&&(e.stateIcon.svg?s.push({type:"svg",name:e.stateIcon.src||e.stateIcon.svg,width:e.stateIcon.width||22,height:e.stateIcon.height||22,svg:e.stateIcon.svg,positionType:aC.right,marginRight:0,funcType:lC.dropDownState,interactive:!1}):e.stateIcon.src&&s.push({type:"image",name:e.stateIcon.src||e.stateIcon.svg,width:e.stateIcon.width||22,height:e.stateIcon.height||22,src:e.stateIcon.src,positionType:aC.right,marginRight:0,funcType:lC.dropDownState,interactive:!1}))}}return s}getDropDownIconRect(t,e,i){const r=this.downIcon.hover?.width??this.downIcon?.width??0,o=this.downIcon.hover?.height??this.downIcon?.height??0,n=t.right-2-r,s=t.right-2;let a;a="middle"===i?t.top+t.height/2-r/2:"top"===i?t.top+e/2:"bottom"===i?t.bottom-2*e:t.top;return{left:n,right:s,top:a,bottom:o+a,width:r,height:o}}getHierarchyIcon(t,e){const{hierarchyState:i}=this._table._getHeaderLayoutMap(t,e);if(i){if(i===oC.expand)return this.expandIcon;if(i===oC.collapse)return this.collapseIcon}}getHierarchyIconWidth(){return this.expandIcon.width+(this.expandIcon.marginLeft??0)+(this.expandIcon.marginRight??0)}checkDropDownIcon(t,e,i){if(t.isPivotTable()){const r=t._getHeaderLayoutMap(e,i);if(Array.isArray(r.dropDownMenu)&&r.dropDownMenu.length)return!0}else{const r=t.getHeaderDefine(e,i);if(Array.isArray(r.dropDownMenu)&&r.dropDownMenu.length||(!Array.isArray(r.dropDownMenu)||0!==r.dropDownMenu.length)&&Array.isArray(t.globalDropDownMenu)&&t.globalDropDownMenu.length&&!r?.columns?.length)return!0}return!1}getStyleClass(t){switch(t){case"text":case"link":return PC;case"image":case"video":return rH;case"checkbox":return HC}}}class nH{_table;_tooltipElement;constructor(t){this._table=t}release(){this.unbindTooltipElement(),this._tooltipElement&&this._tooltipElement.release?.(),this._tooltipElement=void 0}_getTooltipElement(){return this._tooltipElement||(this._tooltipElement=this.createTooltipElementInternal()),this._tooltipElement}bindTooltipElement(t,e,i,r){return this._getTooltipElement().bindToCell(this._table,t,e,i,r)}moveTooltipElement(t,e,i,r){this._getTooltipElement().move(this._table,t,e,i,r)}unbindTooltipElement(){this._getTooltipElement().unbindFromCell()}locateTooltipElement(t,e,i,r,o){this._getTooltipElement()._locate(this._table,t,e,i,r,o)}}!function(){if("node"===kC.mode)return;const t=document.createElement("style");t.id="vtable-tooltip-styleSheet",t.textContent="\n@keyframes vtable__bubble-tooltip-element--shown-animation {\n\t0% {\n\t\topacity: 0;\n\t}\n\t100% {\n\t\topacity: 1;\n\t}\n}\n.vtable__bubble-tooltip-element {\n\tposition: absolute;\n\t\n\tpointer-events: none;\n\tuser-select: none;\n\tmax-width: 300px;\n\tz-index: 99999;\n\n\tbackground: #FFFFFF;\n    border: 1px solid #E6E8ED;\n    box-sizing: border-box;\n    border-radius: 4px;\n    box-shadow: 0px 2px 4px rgb(27 31 35 / 8%);\n    color: #141414;\n    font-size: 13px;\n}\n.vtable__bubble-tooltip-element--hidden {\n\topacity: 0;\n\t/* transform: translate(-50%, -50%); */\n\ttransition: opacity 75ms linear;\n}\n.vtable__bubble-tooltip-element--shown {\n\topacity: 1;\n\t/* transform: translate(-50%, -50%); */\n\tanimation: vtable__bubble-tooltip-element--shown-animation 150ms ease-out;\n}\n.vtable__bubble-tooltip-element__content {\n\t/* font-size: .75rem; */\n\tpadding: 6px 8px;\n\tmin-height: 1em;\n\tline-height: 1.5;\n\twidth: 100%;\n\tdisplay: block;\n\twhite-space: pre-wrap;\n\tmargin: 0;\n\tbox-sizing: border-box;\n\toverflow: hidden;\n\tword-wrap: break-word;\n\tposition: relative;\n\tbackground-color: #FFF;\n\tz-index: 2;\n\tborder-radius: 4px\n}\n.vtable__bubble-tooltip-element__triangle {\n\t/* font-size: .75rem; */\n\tposition: absolute;\n\twidth: 10px;\n\theight: 10px;\n\tdisplay: block;\n\ttransform: rotate(45deg);\n    transform-origin: 50% 50% 0;\n\tz-index: 1;\n\tbackground-color: #FFF;\n\tborder: 1px solid #E6E8ED;\n}\n",document.head.appendChild(t)}();const sH="vtable__bubble-tooltip-element",aH=`${sH}__content`,lH=`${sH}__triangle`,hH=`${sH}--hidden`,cH=`${sH}--shown`;class dH{_handler;_rootElement;_messageElement;_triangleElement;constructor(){this._handler=new Aw;const t=this._rootElement=OP("div",[sH,hH]),e=OP("span",[aH]),i=OP("span",[lH]);t.appendChild(i),t.appendChild(e),this._messageElement=t.querySelector(`.${aH}`)||void 0,this._triangleElement=t.querySelector(`.${lH}`)||void 0}bindToCell(t,e,i,r,o){const n=this._rootElement,s=this._messageElement,a=this._triangleElement;if(n?.classList.remove(cH),n?.classList.add(hH),this._canBindToCell(t,e,i)){s.setAttribute("style",""),a.setAttribute("style",""),r?.className&&n.classList.add(r.className),r?.style?.bgColor&&(s.style.backgroundColor=r?.style?.bgColor),r?.style?.bgColor&&(a.style.backgroundColor=r?.style?.bgColor),a.style.display=!0===r?.style?.arrowMark?"block":"none",r?.style?.fontSize&&(s.style.fontSize=(r?.style?.fontSize??12)+"px"),r?.style?.fontFamily&&(s.style.fontFamily=r?.style?.fontFamily),r?.style?.color&&(s.style.color=r?.style?.color),r?.style?.padding&&(s.style.padding=`${r?.style?.padding.join("px ")}px`),s&&(s.textContent=r?.content);if(this._bindToCell(t,e,i,r?.position,r?.referencePosition,o,r?.style?.arrowMark))return n?.classList.add(cH),n?.classList.remove(hH),!0}else this.unbindFromCell();return!1}release(){this.unbindFromCell();const t=this._rootElement;t?.parentElement&&t.parentElement.removeChild(t),this._handler?.release?.(),delete this._rootElement,delete this._messageElement}move(t,e,i,r,o){const n=this._rootElement;this._canBindToCell(t,e,i)?(this._bindToCell(t,e,i,r?.position,r?.referencePosition,o),n?.classList.add(cH),n?.classList.remove(hH)):this.unbindFromCell()}unbindFromCell(){const t=this._rootElement;t?.parentElement&&(t.classList.remove(cH),t.classList.add(hH))}_canBindToCell(t,e,i){const r=t.getCellRangeRelativeRect({col:e,row:i}),o=t.getElement(),{bottom:n,left:s,right:a,top:l}=r;if(t.isFrozenCell(e,i))return!0;if(n<t.getFrozenRowsHeight()||a<t.getFrozenColsWidth()||s>t.tableNoFrameWidth-t.getRightFrozenColsWidth()||l>t.tableNoFrameHeight-t.getBottomFrozenRowsHeight())return!1;const{offsetHeight:h,offsetWidth:c}=o;return!(l>h)&&!(s>c)}_bindToCell(t,e,i,r,o,n,s){const a=this._rootElement,l=t.getCellRangeRelativeRect({col:e,row:i}),h=t.getElement(),c=t.internalProps.element.offsetWidth,{width:d}=l;if(a){let l,u;a.parentElement!==h&&h.appendChild(a),a.style.left="0px";const g=Math.min(.8*c,4*d);a.style.maxWidth=`${g}px`;const p=a.clientWidth,f=a.clientHeight;if(!r&&!o)return!1;{const a=this.getComputedPosition(t,e,i,r,o,n,s);u=a.x,l=a.y}a.style.left=`${u}px`,a.style.top=`${l}px`,$C()&&(a.style.fontSize="11px");const{x1:m,x2:b,y1:y,y2:C}=t.stateManager.menu.bounds,w=u,v=w+p,x=l,_=w+f;return!(t.stateManager.menu.isShow&&m<v&&b>w&&C>x&&y<_)}return!1}getComputedPosition(t,e,i,r,o,n,s){const a=this._rootElement,l=t.getCellRangeRelativeRect({col:e,row:i}),{width:h,height:c}=t.internalProps.element.getBoundingClientRect(),{width:d}=l;let u,g;const p=Math.min(.8*h,4*d);a.style.maxWidth=`${p}px`;const f=a.clientWidth,m=a.clientHeight,b=s?6:0;if(r)g=r.x,u=r.y+b,this._triangleElement.style.left="50%",this._triangleElement.style.marginLeft="-5px",this._triangleElement.style.top="-5px";else if(o){let t=o.placement??rC.bottom;const e=o.rect.left+o.rect.width/2,i=o.rect.top+o.rect.height/2,r=o.rect.top,s=o.rect.bottom,a=o.rect.left,l=o.rect.right;let d=0;const p=()=>{d++,d>=4||(this.removeStyleFromTriangle(),t===rC.top?(g=e-f/2,u=r-m-b,this._triangleElement.style.left="50%",this._triangleElement.style.marginLeft="-5px",this._triangleElement.style.bottom="-5px",n&&u<0&&(t=rC.right,p())):t===rC.bottom?(g=e-f/2,u=s+b,this._triangleElement.style.left="50%",this._triangleElement.style.marginLeft="-5px",this._triangleElement.style.top="-5px",n&&u+m>c&&(t=rC.left,p())):t===rC.left?(u=i-m/2,g=a-f-b,this._triangleElement.style.top="50%",this._triangleElement.style.marginTop="-5px",this._triangleElement.style.right="-5px",n&&g<0&&(t=rC.top,p())):t===rC.right&&(u=i-m/2,g=l+b,this._triangleElement.style.top="50%",this._triangleElement.style.marginTop="-5px",this._triangleElement.style.left="-5px",n&&g+f>h&&(t=rC.bottom,p())))};p()}return n&&(g<0?g=0:g+a.offsetWidth>h&&(g=h-a.offsetWidth)),{x:g,y:u}}removeStyleFromTriangle(){this._triangleElement.style.left="",this._triangleElement.style.right="",this._triangleElement.style.top="",this._triangleElement.style.bottom="",this._triangleElement.style.marginLeft="",this._triangleElement.style.marginTop=""}_locate(t,e,i,r,o,n){const s=this.getComputedPosition(t,e,i,r,o,n),a=s.x,l=s.y;this._rootElement.style.left=`${a}px`,this._rootElement.style.top=`${l}px`}}class uH extends nH{createTooltipElementInternal(){return new dH}}const gH={"bubble-tooltip":function(t){return new uH(t)}};class pH{_table;_tooltipInstances;_attachInfo;confine;constructor(t,e){this._table=t,this._tooltipInstances={},this._bindTableEvent(t),this.confine=e}release(){const t=this._tooltipInstances;for(const e in t)t[e]?.release?.();delete this._tooltipInstances,this._attachInfo=null}_bindToCell(t,e,i){const r=this._attachInfo,o=this._getTooltipInstanceInfo(t,e);if(!r||o&&r.instance===o||(r.instance?.unbindTooltipElement(),this._attachInfo=null),!o)return;if(o&&o.bindTooltipElement(t,e,i,this.confine)){const r=this._table.getCellRange(t,e);this._attachInfo={range:r,instance:o,tooltipOptions:i}}}_move(t,e,i){const r=this._attachInfo;if(!r||!dw(r.range,t,e))return;const{instance:o}=r;o?.moveTooltipElement(t,e,i,this.confine)}moveToPosition(t,e,i,r){const o=this._attachInfo;if(!o||!dw(o.range,t,e))return;const{instance:n}=o;this._attachInfo.tooltipOptions.position=i,this._attachInfo.tooltipOptions.referencePosition=r,n?.locateTooltipElement(t,e,i,r,this.confine)}_unbindFromCell(){const t=this._attachInfo;if(!t)return;const{instance:e}=t;e?.unbindTooltipElement(),this._attachInfo=null}_isBindCell(t,e){const i=this._attachInfo;return!!i&&dw(i.range,t,e)}_bindTableEvent(t){t.on(ww.MOUSEENTER_CELL,(e=>{if($C())return;const{x1:i,x2:r,y1:o,y2:n}=t.stateManager.menu.bounds;if(t.stateManager.menu.isShow&&"number"==typeof e.x&&"number"==typeof e.y&&e.x>i&&e.x<r&&e.y>o&&e.y<n)return;const{col:s,row:a}=e;this.showTooltip(s,a)})),t.on(ww.MOUSEMOVE_CELL,(e=>{if(!$C()){if(this._attachInfo?.tooltipOptions?.referencePosition){const i=this._attachInfo.tooltipOptions.referencePosition,{event:r}=e,{left:o,right:n,top:s,bottom:a}=i.rect,l=t._getMouseAbstractPoint(r,!1);l.inTable&&l.x>=o-5&&l.x<=n+5&&l.y>=s-5&&l.y<=a+5||this._unbindFromCell()}this._attachInfo&&t.stateManager.menu.isShow&&this._bindToCell(e.col,e.row)}})),t.on(ww.MOUSELEAVE_CELL,(t=>{this._unbindFromCell()})),t.on(ww.SELECTED_CELL,(t=>{this._isBindCell(t.col,t.row)&&this._unbindFromCell()})),t.on(ww.MOUSELEAVE_TABLE,(t=>{this._unbindFromCell()})),t.on(ww.SCROLL,(t=>{this._unbindFromCell()}))}showTooltip(t,e){let i;const r=this._table,o=r.getHeaderDescription(t,e);if(o){const n=r.getCellRangeRelativeRect({col:t,row:e});i={content:o,referencePosition:{placement:rC.bottom,rect:n},style:{arrowMark:!1}}}else if(r.internalProps.tooltip?.isShowOverflowTextTooltip){const n=r.getCellOverflowText(t,e),s=r.getCellRangeRelativeRect({col:t,row:e});n&&(i={content:o?`${o}\n  ${n}`:n,referencePosition:{placement:rC.bottom,rect:s},style:r.theme.tooltipStyle})}i?this._bindToCell(t,e,i):this._unbindFromCell()}_getTooltipInstanceInfo(t,e){const i=this._table,r=this._tooltipInstances,o="bubble-tooltip";return r&&r[o]||r&&(r[o]=gH[o](i))}isBinded(t){return JSON.stringify(t)===JSON.stringify(this._attachInfo?.tooltipOptions)}}class fH{_table;_menuElement;constructor(t){this._table=t}release(){this.unbindMenuElement(),this._menuElement&&this._menuElement.release(),this._menuElement=void 0}_getMenuElement(){return this._menuElement||(this._menuElement=this.createMenuElementInternal()),this._menuElement}bindMenuElement(t,e,i){return this._getMenuElement().bindToCell(this._table,t,e,i)}unbindMenuElement(){this._getMenuElement().unbindFromCell()}pointInMenuElement(t,e){return this._getMenuElement().pointInMenuElement(t,e)}}const mH="vtable__menu-element",bH=`${mH}--hidden`,yH=`${mH}--shown`;class CH{_handler;_rootElement;_menuInstanceInfo;constructor(t){this._handler=new Aw,this._rootElement=OP("div",[mH,bH]),this._rootElement.addEventListener("wheel",(t=>{t.stopPropagation()})),this._rootElement?.addEventListener("mousedown",(t=>{t.stopPropagation(),t.preventDefault()})),this._rootElement?.addEventListener("click",(e=>{if(e.stopPropagation(),e.preventDefault(),this._rootElement.classList.contains(bH))return;const{col:i,row:r,dropDownIndex:o,menuKey:n,text:s,hasChildren:a}=e.target;if("number"!=typeof o||a)return void e.stopPropagation();const l=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(i,r):t.getHeaderField(i,r),h=t._dropDownMenuIsHighlight(i,r,o);t.fireListeners(ww.DROPDOWN_MENU_CLICK,{col:i,row:r,field:l,menuKey:n,text:s,highlight:h,cellLocation:t.getCellLocation(i,r),event:e}),t.fireListeners(ww.DROPDOWN_MENU_CLEAR,null),t.fireListeners(ww.HIDE_MENU,null),e.stopPropagation()})),this._rootElement?.addEventListener("mousemove",(t=>{this._rootElement.classList.contains(bH)||t.stopPropagation()}))}get rootElement(){return this._rootElement}release(){this.unbindFromCell();const t=this._rootElement;t?.parentElement&&t.parentElement.removeChild(t),this._handler.release(),delete this._rootElement}bindToCell(t,e,i,r){const o=this._rootElement;if(this._menuInstanceInfo=r,o?.classList.remove(yH),o?.classList.add(bH),this._canBindToCell(t,e,i)){o.innerHTML="",o.appendChild(r.content);if(this._bindCell(t,e,i,r.position,r.referencePosition))return o?.classList.add(yH),o?.classList.remove(bH),!0}else this.unbindFromCell();return!1}unbindFromCell(){const t=this._rootElement;this._menuInstanceInfo=void 0,t?.parentElement&&(t.classList.remove(yH),t.classList.add(bH))}_canBindToCell(t,e,i){const r=t.getCellRangeRelativeRect({col:e,row:i}),o=t.getElement(),{top:n,bottom:s,left:a,right:l}=r;if(t.isFrozenCell(e,i))return!0;if(s<t.getFrozenRowsHeight()||l<t.getFrozenColsWidth()||a>t.tableNoFrameWidth-t.getRightFrozenColsWidth()||n>t.tableNoFrameHeight-t.getBottomFrozenRowsHeight())return!1;const{offsetHeight:h,offsetWidth:c}=o;return!(h<n)&&!(c<a)}_bindCell(t,e,i,r,o){const n=this._rootElement,s=t.getElement(),{width:a,height:l}=t.internalProps.element.getBoundingClientRect();if(n){n.parentElement!==s&&s.appendChild(n),n.style.left="0px";const t=.8*a;n.style.maxWidth=`${t}px`;const e=n.clientWidth,i=n.clientHeight;let h,c;return r&&(h=r.x,c=r.y),o&&(h=o.rect.right-e,c=o.rect.bottom),c+i>l&&(c=l-i,h+=e-2),c<0&&(c/=2),n.style.top=`${c}px`,h<0?h=0:h+e>a&&(h=a-e),n.style.left=`${h}px`,!0}return!1}pointInMenuElement(t,e){const i=this._rootElement,{x:r,y:o,width:n,height:s}=i.getBoundingClientRect();return t>r-5&&t<r+n+5&&e>o-5&&e<o+s+5}}class wH extends fH{createMenuElementInternal(){return new tH(this._table)}}let vH=class extends fH{createMenuElementInternal(){return new CH(this._table)}};const xH={"dropdown-menu":function(t){return new wH(t)},"context-menu":function(t){return new wH(t)},container:t=>new vH(t)};class _H{_table;_menuInstances;_attachInfo;constructor(t){this._table=t,this._menuInstances={},this._bindTableEvent(t)}release(){const t=this._menuInstances;for(const e in t)t[e].release();delete this._menuInstances,this._attachInfo=null}_bindToCell(t,e,i,r){const o=this._attachInfo,n=this._getMenuInstanceInfo(t,e,i,r);if(!o||n&&o.instance===n.instance||(o.instance?.unbindMenuElement(),this._attachInfo=null),!n)return;const{instance:s,info:a}=n;if(s&&s.bindMenuElement(t,e,a)){const i=this._table.getCellRange(t,e);this._attachInfo={range:i,instance:s}}}_unbindFromCell(){const t=this._attachInfo;if(!t)return;const{instance:e}=t;e?.unbindMenuElement(),this._attachInfo=null}_isBindToCell(t,e){const i=this._attachInfo;return!!i&&dw(i.range,t,e)}pointInMenuElement(t,e){if(!this._attachInfo)return!1;const i=this._attachInfo,{instance:r}=i;return r.pointInMenuElement(t,e)}_bindTableEvent(t){t.on(ww.DROPDOWN_ICON_CLICK,(t=>{this._attachInfo&&this._isBindToCell(t.col,t.row)?this._unbindFromCell():this._bindToCell(t.col,t.row,"dropdown-menu")})),t.on(ww.DROPDOWN_MENU_CLEAR,(t=>{this._unbindFromCell()})),t.on(ww.CONTEXTMENU_CELL,(e=>{if("html"===t.internalProps.menu?.renderMode){const i=t._getMouseAbstractPoint(e.event,!1);let r=null;i.inTable&&"function"==typeof t.internalProps.menu?.contextMenuItems?r=t.internalProps.menu.contextMenuItems(t.getHeaderField(e.col,e.row),e.row,e.col):i.inTable&&Array.isArray(t.internalProps.menu?.contextMenuItems)&&(r=t.internalProps.menu?.contextMenuItems),this._bindToCell(e.col,e.row,"context-menu",{content:r,position:{x:i.x,y:i.y}})}}))}_getMenuInstanceInfo(t,e,i,r){const o=this._table,n=this._menuInstances,s=function(t,e,i,r,o){const{lineHeight:n,textBaseline:s,textStick:a}=t._getCellStyle(e,i);let l=t.getCellRangeRelativeRect(t.getCellRange(e,i));a&&(l=t.getVisibleCellRangeRelativeRect({col:e,row:i}));let{left:h,right:c,bottom:d,top:u,width:g,height:p}=l;if(t.isHeader(e,i)&&({left:h,right:c,bottom:d,top:u,width:g,height:p}=t.internalProps.headerHelper.getDropDownIconRect(l,n,s||"middle")),o?.content)return{type:r,position:o.position,referencePosition:o.referencePosition??{rect:{left:h,right:c,top:u,bottom:d,width:g,height:p}},content:o.content};if("dropdown-menu"===r){const{dropDownMenu:o=t.globalDropDownMenu,pivotInfo:n}=t._getHeaderLayoutMap(e,i);return{type:r,referencePosition:{rect:{left:h,right:c,top:u,bottom:d,width:g,height:p}},content:o,pivotInfo:n}}return null}(o,t,e,i,r);if(!s)return null;return{instance:n&&n[i]||n&&(n[i]=xH[i](o)),type:i,info:s}}}class SH extends EventTarget{_table;_input;constructor(t,e){if(super(),this._table=t,"node"===kC.mode)return;const i=document.createElement("div");i.style.opacity="0",i.dataset.vtable="vtable",i.style.pointerEvents="none",i.classList.add("input-container");const r=this._input=document.createElement("input");i.appendChild(r),r.classList.add("table-focus-control"),r.dataset.vtable="vtable",r.readOnly=!0,e.appendChild(i)}focus(){this._input.focus({preventScroll:!0})}setFocusRect(t,e){const i=this._input;i.value=e,i.select();const r=t.top-this._table.scrollTop,o=t.left-this._table.scrollLeft;i.style.top=`${r.toFixed()}px`,i.style.left=`${o.toFixed()}px`,i.style.width=`${t.width.toFixed()}px`,i.style.height=`${t.height.toFixed()}px`}get input(){return this._input}release(){}}let AH=1;ZC?AH=1:(AH=Math.ceil(window.devicePixelRatio||1),AH>1&&AH%2!=0&&(AH+=1));const RH={orient:"bottom",position:"middle",padding:30,title:{visible:!1,padding:0,textStyle:{fontSize:14,fill:"#000000",fontWeight:"normal"},space:12},item:{visible:!0,spaceCol:10,spaceRow:10,padding:2,background:{state:{selectedHover:{fill:"gray",fillOpacity:.7},unSelectedHover:{fill:"gray",fillOpacity:.2}}},shape:{space:4,state:{unSelected:{fillOpacity:.5}}},label:{space:4,style:{fill:"#89909D",fontSize:14},state:{unSelected:{fillOpacity:.5}}}},allowAllCanceled:!0,visible:!0};function BH(t,e){const{title:i={},item:r={},pager:o={},background:n={},type:s,id:a,visible:l,orient:h,position:c,data:d,filter:u,regionId:g,regionIndex:p,seriesIndex:f,seriesId:m,padding:b,...y}=wt({},RH,t),C=y;return i.visible&&(C.title=d_(i)),ut(r.focusIconStyle)||u_(r.focusIconStyle),g_(r.shape),g_(r.label),g_(r.value),g_(r.background),nR(r.maxWidth)&&(r.maxWidth=Number(r.maxWidth.substring(0,r.maxWidth.length-1))*e.width/100),nR(r.width)&&(r.width=Number(r.width.substring(0,r.width.length-1))*e.width/100),nR(r.height)&&(r.height=Number(r.height.substring(0,r.height.length-1))*e.width/100),C.item=r,ut(o.textStyle)||u_(o.textStyle),g_(o.handler),C.pager=o,n.visible&&!ut(n.style)&&(wt(C,n.style),Y(n.padding)&&(C.padding=n.padding)),C}class MH{table;option;orient;visible;position;selectedData;legendComponent;constructor(t,e){this.table=e,this.option=mt(t),this.orient=t.orient??"left",this.visible=t.visible??!0,this.position=t.position??"middle",this.selectedData=t.defaultSelected??null,this.createComponent(),this.initEvent()}createComponent(){const t=this.getLegendAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight}),e=new hx(wt({},t,{defaultSelected:this.selectedData}));e.name="legend",this.legendComponent=e,this.table.scenegraph.stage.defaultLayer.appendChild(e),this.adjustTableSize(t)}resize(){this.legendComponent&&(this.legendComponent.setAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight}),this.adjustTableSize(this.legendComponent.attribute))}adjustTableSize(t){let e=isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,i=isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0;if(e<=0||i<=0)return;const r=this.table.tableNoFrameWidth,o=this.table.tableNoFrameHeight,n=BA(t.padding??this.option.padding??10);let s=0,a=0;"left"===this.orient?(s=n[3],a=0,e+=n[1]+n[3]):"top"===this.orient?(s=0,a=n[0],i+=n[0]+n[2]):"right"===this.orient?(s=r-e-n[1],a=0,e+=n[1]+n[3]):"bottom"===this.orient&&(s=0,a=o-i-n[2],i+=n[0]+n[2]);const l="bottom"===this.orient||"top"===this.orient?"horizontal":"vertical",h=this.position;let c=0,d=0;"horizontal"===l?c="middle"===h?(r-e)/2:"end"===h?r-e-n[1]:n[3]:d="middle"===h?(o-i)/2:"end"===h?o-i-n[2]:n[0],this.legendComponent.setAttributes({dx:c,dy:d,x:s,y:a}),"left"===this.orient?(this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(e),this.table.tableX+=Math.ceil(e)):"top"===this.orient?(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(i),this.table.tableY+=Math.ceil(i)):"right"===this.orient?this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(e):"bottom"===this.orient&&(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(i))}getLegendAttributes(t){return{layout:"bottom"===this.orient||"top"===this.orient?"horizontal":"vertical",items:this.getLegendItems(),maxWidth:t.width,maxHeight:t.height,...BH(this.option,t)}}getLegendItems(){return this.option.data}initEvent(){this.legendComponent&&(this.legendComponent.addEventListener(ix.legendItemClick,(t=>{const e=gt(t,"detail.currentSelected");this.table.fireListeners(ww.LEGEND_ITEM_CLICK,{model:this,value:e,event:t})})),this.legendComponent.addEventListener(ix.legendItemHover,(t=>{const e=gt(t,"detail");this.table.fireListeners(ww.LEGEND_ITEM_HOVER,{model:this,value:e,event:t})})),this.legendComponent.addEventListener(ix.legendItemUnHover,(t=>{const e=gt(t,"detail");this.table.fireListeners(ww.LEGEND_ITEM_UNHOVER,{model:this,value:e,event:t})})),this.legendComponent.addEventListener("legendItemAttributeUpdate",(t=>{this.table.scenegraph.updateNextFrame()})))}getLegendBounds(){return{width:isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,height:isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0}}release(){this.legendComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this.legendComponent),this.legendComponent=null}}const TH={orient:"right",position:"middle",padding:30,title:{visible:!1,padding:0,textStyle:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"titleFontColor"}},space:12},handler:{visible:!0},startText:{style:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"labelFontColor"}}},endText:{style:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"labelFontColor"}}},handlerText:{style:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"labelFontColor"}}}},PH={horizontal:{...TH,rail:{width:200,height:8,style:{fill:"rgba(0,0,0,0.04)"}}},vertical:{...TH,rail:{width:8,height:200,style:{fill:"rgba(0,0,0,0.04)"}}}},HH={horizontal:{sizeBackground:{fill:"#cdcdcd"},track:{style:{fill:"rgba(20,20,20,0.1)"}},rail:{width:200,height:4,style:{fill:"rgba(0,0,0,0.04)"}},...TH},vertical:{sizeBackground:{fill:"#cdcdcd"},track:{style:{fill:"rgba(20,20,20,0.1)"}},rail:{width:4,height:200,style:{fill:"rgba(0,0,0,0.04)"}},...TH}};function EH(t,e){const{title:i={},handler:r={},rail:o={},track:n={},startText:s,endText:a,handlerText:l,sizeBackground:h,background:c={},type:d,id:u,visible:g,orient:p,position:f,data:m,defaultSelected:b,field:y,filter:C,regionId:w,regionIndex:v,seriesIndex:x,seriesId:_,padding:S,...A}=wt({},("color"===t.type?PH:HH)["bottom"===t.orient||"top"===t.orient?"horizontal":"vertical"],t),R=A;return i.visible&&(R.title=d_(i)),R.showHandler=!1!==r.visible,ut(r.style)||(R.handlerStyle=u_(r.style)),Y(o.width)&&(R.railWidth=o.width),Y(o.height)&&(R.railHeight=o.height),ut(o.style)||(R.railStyle=u_(o.style)),ut(n.style)||(R.trackStyle=u_(n.style)),R.startText=g_(s),R.endText=g_(a),R.handlerText=g_(l),ut(h)||(R.sizeBackground=u_(h)),c.visible&&!ut(c.style)&&(wt(R,c.style),Y(c.padding)&&(R.padding=c.padding)),R}class kH{table;option;orient;visible;position;selectedData;legendComponent;constructor(t,e){this.table=e,this.option=mt(t),this.orient=t.orient??"left",this.visible=t.visible??!0,this.position=t.position??"middle",this.selectedData=t.defaultSelected??null,this.createComponent(),this.initEvent()}createComponent(){const t=this.getLegendAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight});let e;e="color"===this.option.type?new n_(wt({},t,{slidable:!0})):new a_(wt({},t,{slidable:!0})),e.name="legend",this.legendComponent=e,this.table.scenegraph.stage.defaultLayer.appendChild(e),this.adjustTableSize(t)}resize(){this.legendComponent&&(this.legendComponent.setAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight}),this.adjustTableSize(this.legendComponent.attribute))}adjustTableSize(t){let e=isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,i=isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0;if(e<=0||i<=0)return;const r=this.table.tableNoFrameWidth,o=this.table.tableNoFrameHeight,n=BA(t.padding??this.option.padding??10);let s=0,a=0;"left"===this.orient?(s=n[3],a=0,e+=n[1]+n[3]):"top"===this.orient?(s=0,a=n[0],i+=n[0]+n[2]):"right"===this.orient?(s=r-e-n[1],a=0,e+=n[1]+n[3]):"bottom"===this.orient&&(s=0,a=o-i-n[2],i+=n[0]+n[2]);const l="bottom"===this.orient||"top"===this.orient?"horizontal":"vertical",h=this.position;let c=0,d=0;"horizontal"===l?c="middle"===h?(r-e)/2:"end"===h?r-e-n[1]:n[3]:d="middle"===h?(o-i)/2:"end"===h?o-i-n[2]:n[0],this.legendComponent.setAttributes({dx:c,dy:d,x:s,y:a}),"left"===this.orient?(this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(e),this.table.tableX+=Math.ceil(e)):"top"===this.orient?(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(i),this.table.tableY+=Math.ceil(i)):"right"===this.orient?this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(e):"bottom"===this.orient&&(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(i))}getLegendAttributes(t){const e="bottom"===this.orient||"top"===this.orient?"horizontal":"vertical",i="horizontal"===e?"bottom":this.orient;return{...EH(this.option),layout:e,align:i,min:this.option.min,max:this.option.max,value:this.option.value,["color"===this.option.type?"colors":"sizeRange"]:"color"===this.option.type?this.option.colors:this.option.sizeRange}}initEvent(){this.legendComponent&&this.legendComponent.addEventListener("change",(t=>{const e=gt(t,"detail.value");this.table.fireListeners(ww.LEGEND_CHANGE,{model:this,value:e,event:t}),this.table.scenegraph.updateNextFrame()}))}getLegendBounds(){return{width:isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,height:isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0}}release(){this.legendComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this.legendComponent),this.legendComponent=null}}function LH(t,e){return"color"===t.type||"size"===t.type?new kH(t,e):new MH(t,e)}class FH{data;cumulativeSum;difference;totalSum;table;isUpdate=!1;_keys=[];_sorted=!1;constructor(t){this.data=new Map,this._keys.length=0,this.cumulativeSum=new Map,this.difference=new Map,this.totalSum=0,this.table=t}get length(){return this.data.size}clear(){this._keys=[],this.data.clear(),this.cumulativeSum.clear(),this.difference.clear(),this.totalSum=0}clearRange(){this.cumulativeSum.clear(),this.difference.clear()}add(t,e){const i=this.table.getRowHeight(t);this.data.has(t)||(this._keys.push(t),this._sorted=!1),this.data.set(t,e),this.totalSum+=e,this.updateDifference(t,e-i)}remove(t){if(this.data.has(t)){const e=this.data.get(t);this.data.delete(t);const i=this._keys.indexOf(t);-1!==i&&this._keys.splice(i,1),this.totalSum-=e;const r=this.table.getRowHeight(t);this.updateDifference(t,r-e)}}put(t,e){if(this.data.has(t)){const i=this.data.get(t);this.data.set(t,e);const r=e-i;this.totalSum+=r,this.updateDifference(t,r)}else this.add(t,e)}get(t){return this.data.get(t)}has(t){return this.data.has(t)}_sort(){const{_keys:t}=this;this._sorted||(t.sort(((t,e)=>t<e?-1:t>e?1:0)),this._sorted=!0)}updateDifference(t,e){const i=this.difference.get(t)??0;this.difference.set(t,i+e),this.update()}getSumInRange(t,e){return this.calculatePrefixSum(e)-this.calculatePrefixSum(t-1)}updateCumulativeSum(t,e){for(const[i,r]of this.cumulativeSum)i>=t&&this.cumulativeSum.set(i,r+e)}calculatePrefixSum(t){if(t<0)return 0;if(this.cumulativeSum.has(t)){let e=this.cumulativeSum.get(t);for(const[i,r]of this.difference)i<=t&&(e+=r);return e}return this.dealDiffenence(),this.getCumulativeSum(t)}getCumulativeSum(t){let e=0;for(let i=t;i>=0;i--){if(this.cumulativeSum.has(i)){e+=this.cumulativeSum.get(i);break}e+=this.data.get(i)??this.table.getRowHeight(i)}return this.cumulativeSum.set(t,e),e}update(){this.isUpdate||(this.isUpdate=!0,setTimeout((()=>{this.dealDiffenence(),this.isUpdate=!1}),0))}dealDiffenence(){for(const[t]of this.cumulativeSum)for(const[e,i]of this.difference)if(t>=e){const e=this.cumulativeSum.get(t);this.cumulativeSum.set(t,e+i)}this.difference.clear()}insert(t,e){for(let e=t;e<=this.getLastIndex();e++)this.cumulativeSum.delete(e);const i=this.getLastIndex()+1;this.adjustOrder(t,t+1,i-t),Y(e)&&this.put(t,e)}getLastIndex(){return this._sort(),this._keys[this._keys.length-1]}delLast(){const t=this.getLastIndex();this.remove(t)}delete(t){if(!this.has(t))return;for(let e=t;e<=this.getLastIndex();e++)this.cumulativeSum.delete(e);const e=this.getLastIndex();this.adjustOrder(t+1,t,e-t),this.delLast()}adjustOrder(t,e,i){this.clearRange(),this._sort();const{_keys:r}=this;if(t>e){const o=[];for(let n=IH(r,t+i-1);n>=0;n--){const s=r[n];if(s>=t)o.push(this.get(s));else if(e<=s&&s<t)this.put(s+i,this.get(s));else if(s<e)break}for(let t=0;t<i;t++)this.put(e+t,o[i-1-t])}const{length:o}=r;if(t<e){const n=[];for(let s=IH(r,t);s<o;s++){const o=r[s];if(o>=t&&o<t+i)n.push(this.get(o));else if(t+i<=o&&o<=e)this.put(o-i,this.get(o));else if(o>e)break}for(let t=0;t<i;t++)this.put(e+t,n[t])}}exchangeOrder(t,e,i,r,o){const{_keys:n}=this;if(this._sorted||(n.sort(((t,e)=>t<e?-1:t>e?1:0)),this._sorted=!0),t>i){const r=[],s=[];for(let o=IH(n,i);o<t+e;o++){const i=n[o];i>=t&&i<t+e?s.push(this.get(i)):r.push(this.get(i))}for(let t=0;t<e;t++)this.put(o+t,s[t]);for(let t=0;t<r.length;t++)this.put(o+e+t,r[t])}else{const s=[],a=[];for(let o=IH(n,t);o<i+r;o++){const i=n[o];i>=t&&i<t+e?a.push(this.get(i)):s.push(this.get(i))}for(let t=0;t<e;t++)this.put(o+t,a[t]);for(let e=0;e<s.length;e++)this.put(t+e,s[e])}}}function IH(t,e){let i=0,r=t.length-1;for(;i<=r;){const o=Math.floor((i+r)/2);if(t[o]===e)return o;t[o]>e?r=o-1:i=o+1}return r<0?0:r}class zH{dragReorderIconName;_table;constructor(t){this._table=t;const e=xR();this.dragReorderIconName=e[hC.dragReorderIconName]}getIcons(t,e){return[this.dragReorderIconName]}}class OH{table;customCellStyle;customCellStyleArrangement;constructor(t,e,i){this.table=t,this.customCellStyle=e,this.customCellStyleArrangement=i}getCustomCellStyle(t,e){const i=this.getCustomCellStyleId(t,e);if(i){return this.getCustomCellStyleOption(i).style}}getCustomCellStyleId(t,e){let i;return this.customCellStyleArrangement.forEach((r=>{r.cellPosition.range?r.cellPosition.range.start.col<=t&&r.cellPosition.range.end.col>=t&&r.cellPosition.range.start.row<=e&&r.cellPosition.range.end.row>=e&&(i=r.customStyleId):r.cellPosition.col===t&&r.cellPosition.row===e&&(i=r.customStyleId)})),i}getCustomCellStyleOption(t){return this.customCellStyle.find((e=>e.id===t))}registerCustomCellStyle(t,e){const i=this.customCellStyle.findIndex((e=>e.id===t));-1===i?this.customCellStyle.push({id:t,style:e}):this.customCellStyle[i]={id:t,style:e},this.customCellStyleArrangement.forEach((e=>{const i=e.cellPosition;if(e.customStyleId===t)if(i.range)for(let t=i.range.start.col;t<=i.range.end.col;t++)for(let e=i.range.start.row;e<=i.range.end.row;e++)this.table.scenegraph.updateCellContent(t,e);else this.table.scenegraph.updateCellContent(i.col,i.row)})),this.table.scenegraph.updateNextFrame()}arrangeCustomCellStyle(t,e){const i=this.customCellStyleArrangement.findIndex((e=>e.cellPosition.range&&t.range?e.cellPosition.range.start.col===t.range.start.col&&e.cellPosition.range.start.row===t.range.start.row&&e.cellPosition.range.end.col===t.range.end.col&&e.cellPosition.range.end.row===t.range.end.row:e.cellPosition.col===t.col&&e.cellPosition.row===t.row));if(-1===i?this.customCellStyleArrangement.push({cellPosition:{col:t.col,row:t.row,range:t.range},customStyleId:e}):this.customCellStyleArrangement[i].customStyleId=e,t.range)for(let e=t.range.start.col;e<=t.range.end.col;e++)for(let i=t.range.start.row;i<=t.range.end.row;i++)this.table.scenegraph.updateCellContent(e,i);else this.table.scenegraph.updateCellContent(t.col,t.row);this.table.scenegraph.updateNextFrame()}updateCustomCell(t,e){t.forEach((t=>{this.registerCustomCellStyle(t.id,t.style)})),e.forEach((t=>{this.arrangeCustomCellStyle(t.cellPosition,t.customStyleId)}))}}function DH(t,e){t=t.clone();for(const i in e){const r=e[i];r&&(t[`_${i}`]=r)}return t}const{toBoxArray:WH}=yw,{isTouchEvent:NH}=bw,GH=/^\$(\d+)\$(\d+)$/;!function(){if("node"===kC.mode)return;const t=document.createElement("style");t.id="vtable-style-styleSheet",t.textContent="\n.vtable .input-container {\n\tposition: absolute;\n\ttop:0px;\n}\n.vtable .table-scrollable {\n\tposition: absolute;\n\toverflow: scroll;\n}\n.vtable .table-scrollable::-webkit-scrollbar-button{\n\tbackground-color: transparent;\n}\n.vtable .table-scrollable::-webkit-scrollbar-track-piece{\n\tbackground-color: transparent;\n}\n.vtable .table-scrollable::-webkit-scrollbar-corner {\n\tbackground-color: transparent;\n}\n.vtable .table-scrollable::-webkit-scrollbar-thumb {\n\tborder-radius      : 4px;\n\tbackground-color   : rgba(100, 100, 100, .5);\n}\n\n.vtable .table-scroll-end-point {\n\topacity: 0;\n\tposition: relative;\n}\n.vtable {\n\t/* 设置overflow: auto 应该是为了滚动条的某个问题 但设置了auto之后 dom的下拉菜单只能显示在vtable节点中 超出会截断;现在去掉auto 暂时滚动条的问题没有发现 */\n\t/* overflow: auto; */\n\tposition: relative;\n\twidth: 100%;\n\theight: 100%;\n\ttext-align: left;\n  -webkit-font-smoothing:auto;\n}\n.vtable > canvas {\n\tposition: absolute;\n\twidth: 0;\n\theight: 0;\n}\n.vtable .table-focus-control {\n\tposition: relative !important;\n\twidth: 1px;\n\theight: 1px;\n\topacity: 0;\n\tpadding: 0;\n\tmargin: 0;\n\tbox-sizing: border-box;\n\tpointer-events: none;\n\tmax-width: 500px;\n\tmax-height: 500px;\n\tfloat: none !important;\n}\n.vtable input.table-focus-control::-ms-clear {\n\tvisibility: hidden;\n}\n.vtable input.table-focus-control.composition {\n\topacity: 1;\n\tmax-width: none;\n\tmax-height: none;\n}\n",document.head.appendChild(t)}();const jH={};class VH extends gC{internalProps;showFrozenIcon=!0;padding;globalDropDownMenu;tableNoFrameWidth;tableNoFrameHeight;tableX;tableY;_widthMode;_heightMode;_autoFillWidth;_autoFillHeight;_widthAdaptiveMode;_heightAdaptiveMode;customRender;canvasWidth;canvasHeight;_vDataSet;scenegraph;stateManager;eventManager;_pixelRatio;static get EVENT_TYPE(){return ww}options;version="0.25.0";pagination;id=`VTable${Date.now()}`;headerStyleCache;bodyStyleCache;bodyBottomStyleCache;container;isReleased=!1;_chartEventMap={};customCellStylePlugin;columnWidthComputeMode;constructor(t,e={}){if(super(),!t&&"node"!==e.mode)throw new Error("vtable's container is undefined");const{frozenColCount:i=0,defaultRowHeight:r=40,defaultHeaderRowHeight:o,defaultColWidth:n=80,defaultHeaderColWidth:s,widthMode:a="standard",heightMode:l="standard",autoFillWidth:h=!1,autoFillHeight:c=!1,widthAdaptiveMode:d="only-body",heightAdaptiveMode:u="only-body",keyboardOptions:g,eventOptions:p,rowSeriesNumber:f,columnResizeMode:m,rowResizeMode:b="none",dragHeaderMode:y,showFrozenIcon:C,allowFrozenColCount:w,padding:v,hover:x,menu:_,select:S,customRender:A,pixelRatio:R=AH,renderChartAsync:B,renderChartAsyncBatchCount:M,mode:T,modeParams:P,canvasWidth:H,canvasHeight:E,overscrollBehavior:k,limitMinWidth:L,limitMinHeight:F}=e;this.container=t,this.options=e,this._widthMode=a,this._heightMode=l,this._widthAdaptiveMode=d,this._heightAdaptiveMode=u,this._autoFillWidth=h,this._autoFillHeight=c,this.customRender=A,this.padding={top:0,right:0,left:0,bottom:0},v&&("number"==typeof v?(this.padding.top=v,this.padding.left=v,this.padding.bottom=v,this.padding.right=v):(v.top&&(this.padding.top=v.top),v.bottom&&(this.padding.bottom=v.bottom),v.left&&(this.padding.left=v.left),v.right&&(this.padding.right=v.right))),this.tableNoFrameWidth=0,this.tableNoFrameHeight=0,this.canvasWidth=H,this.canvasHeight=E,this.columnWidthComputeMode=e.columnWidthComputeMode??"normal";const I=this.internalProps={};void 0!==C&&(this.showFrozenIcon=C),"number"==typeof w&&w<=0&&(this.showFrozenIcon=!1),"node"!==kC.mode&&(I.element=function(t){const e=document.createElement("div");e.setAttribute("tabindex","0"),e.classList.add("vtable"),e.style.outline="none",e.style.margin=`${t.top}px ${t.right}px ${t.bottom}px ${t.left}px`;const i=(e.offsetWidth||e.parentElement?.offsetWidth||1)-1,r=(e.offsetHeight||e.parentElement?.offsetHeight||1)-1;return e.style.width=i&&i-t.left-t.right+"px"||"0px",e.style.height=r&&r-t.top-t.bottom+"px"||"0px",e}(this.padding),I.focusControl=new SH(this,I.element),I.canvas=document.createElement("canvas"),I.element.appendChild(I.canvas),I.context=I.canvas.getContext("2d")),I.handler=new Aw,ot(this.options.resizeTime)&&(I.handler.resizeTime=this.options.resizeTime),I.pixelRatio=R,I.frozenColCount=i,I.defaultRowHeight=r,I.defaultHeaderRowHeight=o??r,I.defaultColWidth=n,I.defaultHeaderColWidth=s??n,I.keyboardOptions=g,I.eventOptions=p,I.rowSeriesNumber=f,I.columnResizeMode=m,I.rowResizeMode=b,I.dragHeaderMode=y,I.renderChartAsync=B,CM(M),I.overscrollBehavior=k??"auto",I._rowHeightsMap=new FH(this),I._rowRangeHeightsMap=new Map,I._colRangeWidthsMap=new Map,I._widthResizedColMap=new Set,I._heightResizedRowMap=new Set,this.colWidthsMap=new Bw,this.colContentWidthsMap=new Bw,this.colWidthsLimit={},I.calcWidthContext={_:I,get full(){return"node"===kC.mode?H/(R??1):this._.canvas.width/(this._.context.pixelRatio??window.devicePixelRatio)}},I.cellTextOverflows={},I.focusedTable=!1,I.theme=tv.of(e.theme??tv.DEFAULT),I.theme.isPivot=this.isPivotTable(),t?(t.innerHTML="",t.appendChild(I.element),this._updateSize()):this._updateSize(),this.options=e,I.theme=tv.of(e.theme??tv.DEFAULT),I.theme.isPivot=this.isPivotTable(),I.bodyHelper=new zP(this),I.headerHelper=new oH(this),I.rowSeriesNumberHelper=new zH(this),I.autoWrapText=e.autoWrapText,I.enableLineBreak=e.enableLineBreak,I.allowFrozenColCount=e.allowFrozenColCount??0,I.limitMaxAutoWidth=e.limitMaxAutoWidth??450,I.limitMinWidth=null!=L?"number"==typeof L?L:L?10:0:10,I.limitMinHeight=null!=F?"number"==typeof F?F:F?10:0:10,this._vDataSet=new CS,this.scenegraph=new nP(this),this.stateManager=new wP(this),this.eventManager=new EP(this),e.legends&&(I.legends=LH(e.legends,this),this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})),I.tooltip=Object.assign({renderMode:"html",isShowOverflowTextTooltip:!1,confine:!0},e.tooltip),"html"===I.tooltip.renderMode&&(I.tooltipHandler=new pH(this,I.tooltip.confine)),I.menu=Object.assign({renderMode:"html"},e.menu),Array.isArray(e.menu?.dropDownMenuHighlight)&&this.setDropDownMenuHighlight(e.menu?.dropDownMenuHighlight),Array.isArray(e.menu?.defaultHeaderMenuItems)&&(this.globalDropDownMenu=e.menu.defaultHeaderMenuItems),"html"===I.menu.renderMode&&(I.menuHandler=new _H(this)),this.headerStyleCache=new Map,this.bodyStyleCache=new Map,this.bodyBottomStyleCache=new Map,I.stick={changedCells:new Map},I.customMergeCell=e.customMergeCell,this.customCellStylePlugin=new OH(this,e.customCellStyle??[],e.customCellStyleArrangement??[])}throttleInvalidate=function(t,e){let i=null;return function(...r){i||(i=setTimeout((()=>{t.apply(this,r),i=null}),e))}}(this.render.bind(this),200);getContainer(){return this.container}getElement(){return this.internalProps.element}get canvas(){return this.internalProps.canvas}resize(){this._updateSize(),this.internalProps.legends&&this.internalProps.legends.resize(),this.internalProps.title&&this.internalProps.title.resize(),this.scenegraph.resize()}get rowCount(){return this.internalProps.rowCount}set rowCount(t){this.internalProps.rowCount=t}get colCount(){return this.internalProps.colCount??0}set colCount(t){this.internalProps.colCount=t}get frozenColCount(){return this.internalProps.layoutMap?.frozenColCount??this.internalProps.frozenColCount??0}set frozenColCount(t){t>=this.colCount&&(t=0),this.internalProps.frozenColCount=t,this.options.frozenColCount=t,this.tableNoFrameWidth-this.getColsWidth(0,t-1)<=120&&(this.internalProps.frozenColCount=0),this.stateManager.setFrozenCol(this.internalProps.frozenColCount)}setFrozenColCount(t){t>=this.colCount&&(t=0),this.internalProps.frozenColCount=t,this.options.frozenColCount=t,this.tableNoFrameWidth-this.getColsWidth(0,t-1)<=120&&(this.internalProps.frozenColCount=0),this.stateManager.setFrozenCol(this.internalProps.frozenColCount)}_setFrozenColCount(t){t>=this.colCount&&(t=0),this.internalProps.frozenColCount=t}_resetFrozenColCount(){this.options.frozenColCount&&(this.tableNoFrameWidth-this.getColsWidth(0,this.options.frozenColCount-1)<=120?this._setFrozenColCount(0):this.frozenColCount!==this.options.frozenColCount&&this._setFrozenColCount(this.options.frozenColCount))}get frozenRowCount(){return this.internalProps.layoutMap?.frozenRowCount??this.internalProps.frozenRowCount??0}set frozenRowCount(t){this.internalProps.frozenRowCount=t}get rightFrozenColCount(){return this.internalProps.layoutMap?.rightFrozenColCount??this.internalProps.rightFrozenColCount??0}set rightFrozenColCount(t){this.scenegraph.dealWidthRightFrozen(t)}get bottomFrozenRowCount(){return this.internalProps.layoutMap?.bottomFrozenRowCount??this.internalProps.bottomFrozenRowCount??0}set bottomFrozenRowCount(t){this.scenegraph.dealWidthBottomFrozen(t)}get defaultRowHeight(){return this.internalProps.defaultRowHeight}set defaultRowHeight(t){this.internalProps.defaultRowHeight=t,this.options.defaultRowHeight=t}get defaultHeaderRowHeight(){return this.internalProps.defaultHeaderRowHeight}set defaultHeaderRowHeight(t){this.internalProps.defaultHeaderRowHeight=t,this.options.defaultHeaderRowHeight=t}get defaultColWidth(){return this.internalProps.defaultColWidth}set defaultColWidth(t){this.internalProps.defaultColWidth=t,this.options.defaultColWidth=t}get defaultHeaderColWidth(){return this.internalProps.defaultHeaderColWidth}set defaultHeaderColWidth(t){this.internalProps.defaultHeaderColWidth=t,this.options.defaultHeaderColWidth=t}get colWidthsMap(){return this.internalProps._colWidthsMap}set colWidthsMap(t){this.internalProps._colWidthsMap=t}get colContentWidthsMap(){return this.internalProps._colContentWidthsMap}set colContentWidthsMap(t){this.internalProps._colContentWidthsMap=t}get _colRangeWidthsMap(){return this.internalProps._colRangeWidthsMap}set _colRangeWidthsMap(t){this.internalProps._colRangeWidthsMap=t}get _rowRangeHeightsMap(){return this.internalProps._rowRangeHeightsMap}set _rowRangeHeightsMap(t){this.internalProps._rowRangeHeightsMap=t}get rowHeightsMap(){return this.internalProps._rowHeightsMap}set rowHeightsMap(t){this.internalProps._rowHeightsMap=t}get colWidthsLimit(){return this.internalProps._colWidthsLimit}set colWidthsLimit(t){this.internalProps._colWidthsLimit=t}get keyboardOptions(){return this.internalProps.keyboardOptions??null}set keyboardOptions(t){this.internalProps.keyboardOptions=t??void 0}get eventOptions(){return this.internalProps.eventOptions??null}set eventOptions(t){this.internalProps.eventOptions=t??void 0}get widthMode(){return this._widthMode}set widthMode(t){t!==this._widthMode&&(this._widthMode=t,this.options.widthMode=t)}get heightMode(){return this._heightMode}set heightMode(t){t!==this._heightMode&&(this._heightMode=t,this.options.heightMode=t)}get autoFillWidth(){return this._autoFillWidth}set autoFillWidth(t){t!==this._autoFillWidth&&(this._autoFillWidth=t)}get autoFillHeight(){return this._autoFillHeight}set autoFillHeight(t){t!==this._autoFillHeight&&(this._autoFillHeight=t)}get widthAdaptiveMode(){return this._widthAdaptiveMode}set widthAdaptiveMode(t){t!==this._widthAdaptiveMode&&(this._widthAdaptiveMode=t)}get heightAdaptiveMode(){return this._heightAdaptiveMode}set heightAdaptiveMode(t){t!==this._heightAdaptiveMode&&(this._heightAdaptiveMode=t)}_colWidthDefineToPxWidth(t){return"auto"===t?0:hR(this,t)}_getColWidthLimits(t){const e=this.colWidthsLimit[t];if(!e)return null;const i={};return e.min&&(i.min=hR(this,e.min),i.minDef=e.min),e.max&&(i.max=hR(this,e.max),i.maxDef=e.max),i}_adjustColWidth(t,e){const i=this._getColWidthLimits(t);return Math.max(function(t,e){return t?t.min&&t.min>e?t.min:t.max&&t.max<e?t.max:e:e}(i,e),0)}setPixelRatio(t){this.internalProps.pixelRatio=t,this.scenegraph.setPixelRatio(t)}_updateSize(){const{padding:t}=this;let e=0,i=0;if("browser"===kC.mode){const r=this.getElement(),o=r.parentElement?.offsetWidth??0,n=r.parentElement?.offsetHeight??0;r.style.width=o&&o-t.left-t.right+"px"||"0px",r.style.height=n&&n-t.top-t.bottom+"px"||"0px";const{canvas:s}=this.internalProps;e=s.parentElement?.offsetWidth??0,i=s.parentElement?.offsetHeight??0,this?.scenegraph?.stage?this.scenegraph.stage.resize(e,i):(s.style.width="",s.style.height="",s.width=e,s.height=i,s.style.width=`${e}px`,s.style.height=`${i}px`)}else"node"===kC.mode&&(e=this.canvasWidth-1,i=this.canvasHeight-1);const r=Math.floor(e-LC(this.getTheme().scrollStyle)),o=Math.floor(i-LC(this.getTheme().scrollStyle));if(this.internalProps.theme?.frameStyle){const t=WH(this.internalProps.theme.frameStyle?.borderLineWidth??[null]),e=WH(this.internalProps.theme.frameStyle?.shadowBlur??[0]);this.theme.frameStyle?.innerBorder?(this.tableX=0,this.tableY=0,this.tableNoFrameWidth=r-(e[1]??0),this.tableNoFrameHeight=o-(e[2]??0)):(this.tableX=(t[3]??0)+(e[3]??0),this.tableY=(t[0]??0)+(e[0]??0),this.tableNoFrameWidth=r-((t[1]??0)+(e[1]??0))-((t[3]??0)+(e[3]??0)),this.tableNoFrameHeight=o-((t[0]??0)+(e[0]??0))-((t[2]??0)+(e[2]??0)))}}get rowHierarchyType(){return"grid"}getColsWidth(t,e){if(t>e)return 0;t=Math.max(t,0),e=Math.min(e,(this.colCount??1/0)-1);const i=this._colRangeWidthsMap.get(`$${t}$${e}`);if(null!=i)return i;const r=this._colRangeWidthsMap.get(`$${t}$${e-1}`);if(null!=r){const i=r+this.getColWidth(e);return t>=0&&e>=0&&!Number.isNaN(i)&&this._colRangeWidthsMap.set(`$${t}$${e}`,Math.round(i)),Math.round(i)}let o=0;for(let i=t;i<=e;i++)o+=this.getColWidth(i);return t>=0&&e>=0&&this._colRangeWidthsMap.set(`$${t}$${e}`,Math.round(o)),Math.round(o)}getRowHeight(t){if(Y(this.rowHeightsMap.get(t)))return this.rowHeightsMap.get(t);const e=this.getDefaultRowHeight(t);return ot(e)?e:this.defaultRowHeight}getDefaultColumnWidth(t){return this.isRowHeader(t,0)||this.isCornerHeader(t,0)?Array.isArray(this.defaultHeaderColWidth)?this.defaultHeaderColWidth[t]??this.defaultColWidth:this.defaultHeaderColWidth:this.isRightFrozenColumn(t,this.columnHeaderLevelCount)&&this.isPivotTable()?Array.isArray(this.defaultHeaderColWidth)?this.defaultHeaderColWidth[this.rowHeaderLevelCount-this.rightFrozenColCount]??this.defaultColWidth:this.defaultHeaderColWidth:this.defaultColWidth}getDefaultRowHeight(t){return this.isColumnHeader(0,t)||this.isCornerHeader(0,t)||this.isSeriesNumberInHeader(0,t)?Array.isArray(this.defaultHeaderRowHeight)?this.defaultHeaderRowHeight[t]??this.internalProps.defaultRowHeight:this.defaultHeaderRowHeight:this.isBottomFrozenRow(t)?Array.isArray(this.defaultHeaderRowHeight)?this.defaultHeaderRowHeight[this.columnHeaderLevelCount>0?this.columnHeaderLevelCount-this.bottomFrozenRowCount:0]??this.internalProps.defaultRowHeight:this.defaultHeaderRowHeight:this.internalProps.defaultRowHeight}_setRowHeight(t,e,i){this.rowHeightsMap.put(t,Math.round(e)),i&&this._clearRowRangeHeightsMap(t)}getRowsHeight(t,e){if(t>e||0===this.rowCount)return 0;t=Math.max(t,0),e=Math.min(e,(this.rowCount??1/0)-1);let i=0;if("standard"!==this.heightMode||this.autoFillHeight||!this.internalProps.layoutMap||this.hasAutoImageColumn()||0!==this.internalProps._heightResizedRowMap.size)i=this.rowHeightsMap.getSumInRange(t,e);else{for(let r=t;r<Math.min(e+1,this.columnHeaderLevelCount);r++)i+=this.getRowHeight(r);e>=this.columnHeaderLevelCount&&(i+=this.defaultRowHeight*(Math.min(e,this.rowCount-this.bottomFrozenRowCount-1)-Math.max(this.columnHeaderLevelCount,t)+1));for(let t=this.rowCount-this.bottomFrozenRowCount;t<e+1;t++)i+=this.getRowHeight(t)}return Math.round(i)}getColWidthDefined(t){const{layoutMap:e}=this.internalProps;if("autoWidth"===this.widthMode)return"auto";const{width:i}=e?.getColumnWidthDefined(t)??{};return"number"==typeof i&&i<=0?0:i||this.getDefaultColumnWidth(t)}getColWidthDefinedNumber(t){const e=this.getColWidthDefined(t);return this._adjustColWidth(t,this._colWidthDefineToPxWidth(e))}isAutoRowHeight(t){return"autoHeight"===this.heightMode||t>=0&&t<this.columnHeaderLevelCount&&"auto"===this.getDefaultRowHeight(t)}getColWidth(t){const e=this.colWidthsMap.get(t)??this.getDefaultColumnWidth(t);return"adaptive"===this.widthMode&&"number"==typeof e||this.transpose&&"number"==typeof e?this._colWidthDefineToPxWidth(e):this._adjustColWidth(t,this._colWidthDefineToPxWidth(e))}_setColWidth(t,e,i,r){this.colWidthsMap.put(t,"number"==typeof e?Math.round(e):e),i&&this._clearColRangeWidthsMap(t),r||this.stateManager.checkFrozen()}_clearColRangeWidthsMap(t){if("number"!=typeof t)this._colRangeWidthsMap.clear();else{const e=this._colRangeWidthsMap.keys();for(const i of e){const e=GH.exec(i);if(e){const r=Number(e[1]),o=Number(e[2]);t>=r&&t<=o&&this._colRangeWidthsMap.delete(i)}}}}_clearRowRangeHeightsMap(t){this.rowHeightsMap.clearRange()}_getColContentWidth(t){return Number(this.colContentWidthsMap.get(t))}_setColContentWidth(t,e){this.colContentWidthsMap.put(t,e)}getAllRowsHeight(){if(this.internalProps.rowCount<=0)return 0;return this.getRowsHeight(0,this.internalProps.rowCount-1)}getAllColsWidth(){if(this.internalProps.colCount<=0)return 0;return this.getColsWidth(0,this.internalProps.colCount-1)}getMaxColWidth(t){const e=this.colWidthsLimit[t];let i=(e&&e.max)??1/0;return"string"==typeof i&&(i=hR(this,i)),i}setMaxColWidth(t,e){(this.colWidthsLimit[t]||(this.colWidthsLimit[t]={})).max=e}getMinColWidth(t){const e=this.colWidthsLimit[t];let i=(e&&e.min)??0;return"string"==typeof i&&(i=hR(this,i)),i}setMinColWidth(t,e){(this.colWidthsLimit[t]||(this.colWidthsLimit[t]={})).min=e}getCellRect(t,e){const i=this.isFrozenCell(t,e);let r;const o=this.getColWidth(t);let n;r=i&&i.col&&this.isRightFrozenColumn(t,e)?this.tableNoFrameWidth-(this.getColsWidth(t,this.colCount-1)??0):this.getColsWidth(0,t-1)||0;const s=this.getRowHeight(e);return n=i&&i.row&&this.isBottomFrozenRow(t,e)?this.tableNoFrameHeight-(this.getRowsHeight(e,this.rowCount-1)??0):this.getRowsHeight(0,e-1),new Mw(Math.round(r),Math.round(n),Math.round(o),Math.round(s))}getMergeCellRect(t,e){const i=this.getCellRange(t,e),r=this.getColsWidth(0,i.start.col-1)||0,o=this.getColsWidth(i.start.col,i.end.col),n=this.getRowsHeight(0,i.start.row-1)||0,s=this.getRowsHeight(i.start.row,i.end.row);return new Mw(Math.round(r),Math.round(n),Math.round(o),Math.round(s))}getCellRelativeRect(t,e){const i=this.isFrozenCell(t,e);let r=!0,o=!0;i?.col&&i?.row?(r=!1,o=!1):i?.col?r=!1:i?.row&&(o=!1);const n=this.getCellRect(t,e);return this._toRelativeRect(n,r,o)}getCellRangeRelativeRect(t){if(t.start){const e=this.isFrozenCell(t.start.col,t.start.row);let i=!0,r=!0;return e?.col&&e?.row?(i=!1,r=!1):e?.col?i=!1:e?.row&&(r=!1),this._toRelativeRect(this.getCellsRect(t.start.col,t.start.row,t.end.col,t.end.row),i,r)}const e=this.getCellRange(t.col,t.row),i=this.isFrozenCell(t.col,t.row);let r=!0,o=!0;return i?.col&&i?.row?(r=!1,o=!1):i?.col?r=!1:i?.row&&(o=!1),this._toRelativeRect(this.getCellsRect(e.start.col,e.start.row,e.end.col,e.end.row),r,o)}getVisibleCellRangeRelativeRect(t){let e;return e=t.start?t:this.getCellRange(t.col,t.row),this._getVisiableRect(this.getCellRangeRelativeRect(t),e)}_getVisiableRect(t,e){const i=e.start.col>=this.frozenColCount?Math.max(t.left,this.frozenColCount>=1?this.getColsWidth(0,this.frozenColCount-1):0):t.left,r=Math.min(t.right,this.tableNoFrameWidth),o=t.copy();o.left=i,o.right=r;const n=e.start.row>=this.frozenRowCount?Math.max(t.top,this.frozenRowCount>=1?this.getRowsHeight(0,this.frozenRowCount-1):0):t.top,s=Math.min(t.bottom,this.tableNoFrameHeight);return o.top=n,o.bottom=s,o}getCellsRect(t,e,i,r){let o=this.getColsWidth(0,t-1)||0,n=this.getColsWidth(t,i);const s=this.scrollLeft;this.isLeftFrozenColumn(t)&&this.isRightFrozenColumn(i)?n=this.tableNoFrameWidth-(this.getColsWidth(t+1,this.colCount-1)??0)-o:this.isLeftFrozenColumn(t)&&!this.isLeftFrozenColumn(i)?n=Math.max(n-s,this.getColsWidth(t,this.frozenColCount-1)):!this.isRightFrozenColumn(t)&&this.isRightFrozenColumn(i)?(o=Math.min(o-s,this.tableNoFrameWidth-this.getRightFrozenColsWidth()),n=this.tableNoFrameWidth-(this.getColsWidth(t+1,this.colCount-1)??0)-o):this.isRightFrozenColumn(t)&&(o=this.tableNoFrameWidth-(this.getColsWidth(t,this.colCount-1)??0));let a=this.getRowsHeight(0,e-1),l=this.getRowsHeight(e,r);const h=this.scrollTop;return this.isTopFrozenRow(e)&&this.isBottomFrozenRow(r)?l=this.tableNoFrameHeight-(this.getRowsHeight(e+1,this.rowCount-1)??0)-a:this.isTopFrozenRow(e)&&!this.isTopFrozenRow(r)?l=Math.max(l-h,this.getRowsHeight(e,this.frozenRowCount-1)):!this.isBottomFrozenRow(e)&&this.isBottomFrozenRow(r)?(a=Math.min(a-h,this.tableNoFrameHeight-this.getBottomFrozenRowsHeight()),l=this.tableNoFrameHeight-(this.getRowsHeight(e+1,this.rowCount-1)??0)-a):this.isBottomFrozenRow(e)&&(a=this.tableNoFrameHeight-(this.getRowsHeight(e,this.rowCount-1)??0)),new Mw(Math.round(o),Math.round(a),Math.round(n),Math.round(l))}getCellsRectWidth(t,e,i,r){const o=this.isFrozenCell(t,e),n=this.isFrozenCell(i,r);let s=this.getColsWidth(t,i);if(o&&o.col){const e=this.scrollLeft;n&&n.col||(s-=e,s=Math.max(s,this.getColsWidth(t,this.frozenColCount-1)))}return s}getCellRangeRect(t){if(t.start)return this.getCellsRect(t.start.col,t.start.row,t.end.col,t.end.row);const e=this.getCellRange(t.col,t.row);return this.getCellsRect(e.start.col,e.start.row,e.end.col,e.end.row)}getCellRangeRectWidth(t){if(t.start)return this.getCellsRectWidth(t.start.col,t.start.row,t.end.col,t.end.row);const e=this.getCellRange(t.col,t.row);return this.getCellsRectWidth(e.start.col,e.start.row,e.end.col,e.end.row)}isFrozenCell(t,e){const i=this.isFrozenRow(e),r=this.isFrozenColumn(t);return i||r?{row:i,col:r}:null}getRowAt(t){const e=function(t,e){if(!t.internalProps.frozenRowCount)return null;let{scrollTop:i}=t;const r=t.internalProps.frozenRowCount;for(let o=0;o<r;o++){const r=t.getRowHeight(o),n=i+r;if(n>e)return{top:i,row:o,bottom:n,height:r};i=n}return null}(this,t);if(e)return e;let i=this.getTargetRowAt(t);return i||(i={top:-1,row:-1,bottom:-1,height:-1}),i}getColAt(t){const e=function(t,e){if(!t.internalProps.frozenColCount)return null;let{scrollLeft:i}=t;const r=t.internalProps.frozenColCount;for(let o=0;o<r;o++){const r=t.getColWidth(o),n=i+r;if(n>e)return{left:i,col:o,right:n,width:r};i=n}return null}(this,t);if(e)return e;let i=this.getTargetColAt(t);return i||(i={left:-1,col:-1,right:-1,width:1}),i}getCellAt(t,e){const i=this.getRowAt(e),{row:r,top:o,bottom:n,height:s}=i,a=this.getColAt(t),{col:l,left:h,right:c,width:d}=a;return{row:r,col:l,rect:{left:h,right:c,top:o,bottom:n,width:d,height:s}}}_checkRowCol(t,e){return t>=0&&t<this.colCount&&e>=0&&e<this.rowCount}_makeVisibleCell(t,e){if(this._checkRowCol(t,e)){const i=this.isFrozenCell(t,e);if(i&&i.col&&i.row)return;const r=this.getCellRect(t,e),o=function(t){let e=0,i=0;t.frozenColCount>0&&(e=t.getFrozenColsWidth()),t.rightFrozenColCount>0&&(i=t.getRightFrozenColsWidth());let r=0,o=0;return t.frozenRowCount>0&&(r=t.getFrozenRowsHeight()),t.bottomFrozenRowCount>0&&(o=t.getBottomFrozenRowsHeight()),new Mw(t.scrollLeft+e,t.scrollTop+r,t.tableNoFrameWidth-e-i,t.tableNoFrameHeight-r-o)}(this);if(o.contains(r))return;i&&i.col||this.getColsWidth(0,this.frozenColCount-1)+r.width>this.canvas.width||(r.left<o.left?this.scrollLeft-=o.left-r.left:o.right<r.right&&(this.scrollLeft-=o.right-r.right)),i&&i.row||this.getRowsHeight(0,this.frozenRowCount-1)+r.height>this.canvas.height||(r.top<o.top?this.scrollTop-=o.top-r.top:o.bottom<r.bottom&&(this.scrollTop-=o.bottom-r.bottom))}}render(){this.scenegraph.renderSceneGraph()}renderAsync(){return this.scenegraph.updateNextFrame(),new Promise(((t,e)=>{setTimeout((()=>{t()}),0)}))}_toRelativeRect(t,e=!0,i=!0){const r=t.copy(),o=this.getVisibleRect();return r.offsetLeft(this.tableX-(e?o.left:0)),r.offsetTop(this.tableY-(i?o.top:0)),r}getVisibleRect(){const{scrollTop:t,scrollLeft:e}=this,i=this.tableNoFrameWidth,r=this.tableNoFrameHeight;return new Mw(e,t,i,r)}get visibleRowCount(){const{frozenRowCount:t}=this,e=this.getVisibleRect(),i=t>0?e.top+this.getRowsHeight(0,t-1):e.top,r=this.getTargetRowAt(i);if(!r)return 0;const o=Math.max(r.top>=i?r.row:r.row+1,t);let n=this.getRowsHeight(0,o-1),s=0;const{rowCount:a}=this;for(let t=o;t<a;t++){const i=n+this.getRowHeight(t);if(e.bottom<i)break;s++,n=i}return s}getBodyVisibleCellRange(){const{scrollTop:t,scrollLeft:e}=this,i=this.getFrozenRowsHeight(),r=this.getFrozenColsWidth(),o=this.getBottomFrozenRowsHeight(),n=this.getRightFrozenColsWidth(),{row:s}=this.getRowAt(t+i+1),{col:a}=this.getColAt(e+r+1),l=this.getAllRowsHeight()>this.tableNoFrameHeight?this.getRowAt(t+this.tableNoFrameHeight-1-o).row:this.rowCount-1,h=this.getAllColsWidth()>this.tableNoFrameWidth?this.getColAt(e+this.tableNoFrameWidth-1-n).col:this.colCount-1;return h<0||l<0?null:{rowStart:s,colStart:a,rowEnd:l,colEnd:h}}getBodyVisibleRowRange(){const{scrollTop:t}=this,e=this.getFrozenRowsHeight(),i=this.getBottomFrozenRowsHeight(),{row:r}=this.getRowAt(t+e+1),o=this.getAllRowsHeight()>this.tableNoFrameHeight?this.getRowAt(t+this.tableNoFrameHeight-1-i).row:this.rowCount-1;return o<0?null:{rowStart:r,rowEnd:o}}getBodyVisibleColRange(){const{scrollLeft:t}=this,e=this.getFrozenColsWidth(),i=this.getRightFrozenColsWidth(),{col:r}=this.getColAt(t+e+1),o=this.getAllColsWidth()>this.tableNoFrameWidth?this.getColAt(t+this.tableNoFrameWidth-1-i).col:this.colCount-1;return o<0?null:{colStart:r,colEnd:o}}get visibleColCount(){const{frozenColCount:t}=this,e=this.getVisibleRect(),i=t>0?e.left+this.getColsWidth(0,t-1):e.left,r=this.getTargetColAt(i);if(!r)return 0;const o=Math.max(r.left>=i?r.col:r.col+1,t);let n=this.getColsWidth(0,o-1),s=0;const{colCount:a}=this;for(let t=o;t<a;t++){const i=n+this.getColWidth(t);if(e.right<i)break;s++,n=i}return s}get scrollTop(){return this.stateManager.scroll.verticalBarPos}set scrollTop(t){this.stateManager.setScrollTop(t)}get scrollLeft(){return this.stateManager.scroll.horizontalBarPos}set scrollLeft(t){this.stateManager.setScrollLeft(t)}getScrollLeft(){return this.scrollLeft}getScrollTop(){return this.scrollTop}setScrollLeft(t){this.scrollLeft=Math.ceil(t)}setScrollTop(t){this.scrollTop=Math.ceil(t)}getCellOverflowText(t,e){return this.scenegraph.getCellOverflowText(t,e)}addReleaseObj(t){if(!t||!t.release||"function"!=typeof t.release)throw new Error("not releaseObj!");(this.internalProps.releaseList=this.internalProps.releaseList||[]).push(t)}dispose(){this.release()}release(){const t=this.internalProps;t.tooltipHandler?.release?.(),t.menuHandler?.release?.(),wR.clearAll(),super.release?.(),t.handler?.release?.(),t.focusControl?.release?.(),t.legends?.release(),t.title?.release(),t.layoutMap.release(),t.releaseList&&(t.releaseList.forEach((t=>t?.release?.())),t.releaseList=null),this.scenegraph.stage.release(),this.scenegraph.proxy.release();const{parentElement:e}=t.element;e&&e.removeChild(t.element),this.editorManager?.editingEditor?.onEnd?.(),this.isReleased=!0}fireListeners(t,e){return super.fireListeners(t,e)}updateOption(t){this.options=t;const{frozenColCount:e=0,defaultRowHeight:i=40,defaultHeaderRowHeight:r,defaultColWidth:o=80,defaultHeaderColWidth:n=80,keyboardOptions:s,eventOptions:a,rowSeriesNumber:l,columnResizeMode:h,rowResizeMode:c="none",dragHeaderMode:d,showFrozenIcon:u,allowFrozenColCount:g,padding:p,hover:f,menu:m,select:b,pixelRatio:y,widthMode:C,heightMode:w,autoFillWidth:v,autoFillHeight:x,widthAdaptiveMode:_,heightAdaptiveMode:S,customRender:A,renderChartAsync:R,renderChartAsyncBatchCount:B,overscrollBehavior:M,limitMinWidth:T,limitMinHeight:P}=t;y&&y!==this.internalProps.pixelRatio&&(this.internalProps.pixelRatio=y),p&&("number"==typeof p?(this.padding.top=p,this.padding.left=p,this.padding.bottom=p,this.padding.right=p):(p.top&&(this.padding.top=p.top),p.bottom&&(this.padding.bottom=p.bottom),p.left&&(this.padding.left=p.left),p.right&&(this.padding.right=p.right))),this.showFrozenIcon="boolean"!=typeof u||u,"number"==typeof g&&g<=0&&(this.showFrozenIcon=!1),this.widthMode=C??"standard",this.heightMode=w??"standard",this._widthAdaptiveMode=_??"only-body",this._heightAdaptiveMode=S??"only-body",this.autoFillWidth=v??!1,this.autoFillHeight=x??!1,this.customRender=A;const H=this.internalProps;"node"!==kC.mode&&function(t,e){t.style.margin=`${e.top}px ${e.right}px ${e.bottom}px ${e.left}px`;const i=(t.offsetWidth||t.parentElement?.offsetWidth||1)-1,r=(t.offsetHeight||t.parentElement?.offsetHeight||1)-1;t.style.width=i&&i-e.left-e.right+"px"||"0px",t.style.height=r&&r-e.top-e.bottom+"px"||"0px"}(H.element,this.padding),this.columnWidthComputeMode=t.columnWidthComputeMode??"normal",H.frozenColCount=e,H.defaultRowHeight=i,H.defaultHeaderRowHeight=r??i,H.defaultColWidth=o,H.defaultHeaderColWidth=n??o,H.keyboardOptions=s,H.eventOptions=a,H.rowSeriesNumber=l,H.columnResizeMode=h,H.rowResizeMode=c,H.dragHeaderMode=d,H.renderChartAsync=R,CM(B),H.overscrollBehavior=M??"auto",H.cellTextOverflows={},H._rowHeightsMap=new FH(this),H._rowRangeHeightsMap=new Map,H._colRangeWidthsMap=new Map,H._widthResizedColMap=new Set,H._heightResizedRowMap=new Set,this.colWidthsMap=new Bw,this.colContentWidthsMap=new Bw,this.colWidthsLimit={},H.stick.changedCells.clear(),H.theme=tv.of(t.theme??tv.DEFAULT),H.theme.isPivot=this.isPivotTable(),this.scenegraph.updateStageBackground(),H.autoWrapText=t.autoWrapText,H.enableLineBreak=t.enableLineBreak,H.allowFrozenColCount=t.allowFrozenColCount??0,H.limitMaxAutoWidth=t.limitMaxAutoWidth??450,H.limitMinWidth=null!=T?"number"==typeof T?T:T?10:0:10,H.limitMinHeight=null!=P?"number"==typeof P?P:P?10:0:10,this._vDataSet=new CS,H.legends?.release(),H.title?.release(),H.layoutMap.release(),this.scenegraph.clearCells(),this.scenegraph.updateComponent(),this.stateManager.updateOptionSetState(),this._updateSize(),this.eventManager.updateEventBinder(),t.legends&&(H.legends=LH(t.legends,this),this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})),H.tooltip=Object.assign({renderMode:"html",isShowOverflowTextTooltip:!1,confine:!0},t.tooltip),"html"!==H.tooltip.renderMode||H.tooltipHandler||(H.tooltipHandler=new pH(this,H.tooltip.confine)),H.menu=Object.assign({renderMode:"html"},t.menu),Array.isArray(t.menu?.dropDownMenuHighlight)&&this.setDropDownMenuHighlight(t.menu?.dropDownMenuHighlight),Array.isArray(t.menu?.defaultHeaderMenuItems)&&(this.globalDropDownMenu=t.menu.defaultHeaderMenuItems),"html"!==H.menu.renderMode||H.menuHandler||(H.menuHandler=new _H(this)),this.clearCellStyleCache(),this.clearColWidthCache(),this.clearRowHeightCache(),H.customMergeCell=t.customMergeCell,this.customCellStylePlugin.updateCustomCell(t.customCellStyle??[],t.customCellStyleArrangement??[])}renderWithRecreateCells(){const t={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.refreshHeader(),this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(t.col,t.row),this.render()}getFrozenRowsHeight(){return this.getRowsHeight(0,this.frozenRowCount-1)}getFrozenColsWidth(){return this.getColsWidth(0,this.frozenColCount-1)}getBottomFrozenRowsHeight(){if(this.bottomFrozenRowCount>0){let t=0;for(let e=this.rowCount-this.bottomFrozenRowCount;e<=this.rowCount-1;e++)t+=this.getRowHeight(e);return t}return 0}getRightFrozenColsWidth(){if(this.rightFrozenColCount>0){let t=0;for(let e=this.colCount-this.rightFrozenColCount;e<=this.colCount-1;e++)t+=this.getColWidth(e);return t}return 0}getDrawRange(){const t=Math.min(this.tableNoFrameWidth,this.getAllColsWidth()),e=Math.min(this.tableNoFrameHeight,this.getAllRowsHeight());return new Mw(this.tableX,this.tableY,t,e)}_getMouseAbstractPoint(t,e=!0){const i=this;let r;if(!t)return{inTable:!1,x:void 0,y:void 0};r=NH(t)?t.changedTouches[0]:t;const o=r.clientX||r.pageX+window.scrollX,n=r.clientY||r.pageY+window.scrollY,s=i.internalProps.canvas.getBoundingClientRect();let a=!0;s.right<=o&&(a=!1),s.bottom<=n&&(a=!1);const l=s.width,h=l/(this.canvas.offsetWidth||l),c=s.height,d=c/(this.canvas.offsetHeight||c);return{x:(o-s.left)/h+(e?i.scrollLeft:0),y:(n-s.top)/d+(e?i.scrollTop:0),inTable:a}}getTheme(){return this.internalProps.theme}getTargetColAt(t){if(0===t)return{left:0,col:0,right:0,width:0};const e=(e,i)=>{let r=i-this.getColWidth(e);const{colCount:o}=this.internalProps;for(let i=e;i<o;i++){const e=this.getColWidth(i),o=r+e;if(Math.round(r)<=Math.round(t)&&Math.round(t)<Math.round(o))return{left:r,col:i,right:o,width:e};r=o}return null},i=this.computeTargetColByX(t),r=this.getColsWidth(0,i);return t>=r?e(i,r):((e,i)=>{let r=i;for(let i=e;i>=0;i--){const e=this.getColWidth(i),o=r-e;if(Math.round(o)<=Math.round(t)&&Math.round(t)<Math.round(r))return{left:o,col:i,right:r,width:e};r=o}return null})(i,r)}getTargetRowAt(t){if(0===t)return{top:0,row:0,bottom:0,height:0};const e=(e,i)=>{let r=i-this.getRowHeight(e);const{rowCount:o}=this.internalProps;for(let i=e;i<o;i++){const e=this.getRowHeight(i),o=r+e;if(Math.round(r)<=Math.round(t)&&Math.round(t)<Math.round(o))return{top:r,row:i,bottom:o,height:e};r=o}return null},i=this.computeTargetRowByY(t),r=this.getRowsHeight(0,i);return t>=r?e(i,r):((e,i)=>{let r=i;for(let i=e;i>=0;i--){const e=this.getRowHeight(i),o=r-e;if(Math.round(o)<=Math.round(t)&&Math.round(t)<Math.round(r))return{top:o,row:i,bottom:r,height:e};r=o}return null})(i,r)}getTargetColAtConsiderRightFrozen(t,e){if(0===t)return{left:0,col:0,right:0,width:0};if(e&&t>this.tableNoFrameWidth-this.getRightFrozenColsWidth()&&t<this.tableNoFrameWidth)for(let e=0;e<this.rightFrozenColCount;e++)if(t>this.tableNoFrameWidth-this.getColsWidth(this.colCount-e-1,this.colCount-1))return{col:this.colCount-e-1,left:void 0,right:void 0,width:void 0};return this.getTargetColAt(t)}getTargetRowAtConsiderBottomFrozen(t,e){if(0===t)return{top:0,row:0,bottom:0,height:0};if(e&&t>this.tableNoFrameHeight-this.getBottomFrozenRowsHeight()&&t<this.tableNoFrameHeight)for(let e=0;e<this.rightFrozenColCount;e++)if(t>this.tableNoFrameHeight-this.getRowsHeight(this.rowCount-e-1,this.rowCount-1))return{row:this.rowCount-e-1,top:void 0,bottom:void 0,height:void 0};return this.getTargetRowAt(t)}computeTargetRowByY(t){let e=this.internalProps.defaultRowHeight;return this._rowRangeHeightsMap.get("$0$"+(this.rowCount-1))&&(e=this._rowRangeHeightsMap.get("$0$"+(this.rowCount-1))/this.rowCount),Math.min(Math.ceil(t/e),this.rowCount-1)}computeTargetColByX(t){if(this._colRangeWidthsMap.get("$0$"+(this.colCount-1))){let e=0,i=this.colCount-1;for(;i-e>1;){const r=Math.floor((e+i)/2);if(t<this._colRangeWidthsMap.get(`$0$${r}`))i=r;else{if(!(t>this._colRangeWidthsMap.get(`$0$${r}`)))return r;e=r}}return i}return Math.min(Math.ceil(t/this.internalProps.defaultColWidth),this.colCount-1)}clearSelected(){this.stateManager.updateSelectPos(-1,-1)}selectCell(t,e){this.stateManager.updateSelectPos(t,e),this.stateManager.endSelectCells()}selectCells(t){const{scrollLeft:e,scrollTop:i}=this;t.forEach(((t,e)=>{t.start.col===t.end.col&&t.start.row===t.end.row?this.stateManager.updateSelectPos(t.start.col,t.start.row,!1,e>=1):(this.stateManager.updateSelectPos(t.start.col,t.start.row,!1,e>=1),this.stateManager.updateInteractionState(eC.grabing),this.stateManager.updateSelectPos(t.end.col,t.end.row,!1,e>=1)),this.stateManager.endSelectCells(!1),this.stateManager.updateInteractionState(eC.default)})),this.setScrollTop(i),this.setScrollLeft(e)}get recordsCount(){return this.records?.length}get allowFrozenColCount(){return this.internalProps.allowFrozenColCount}get rowHeaderLevelCount(){return this.internalProps.layoutMap.rowHeaderLevelCount}get columnHeaderLevelCount(){return this.internalProps.layoutMap.columnHeaderLevelCount}get records(){return this.internalProps.records}get dataSource(){return this.internalProps.dataSource}set dataSource(t){this.scenegraph.clearCells(),lR(this,t),this.refreshRowColCount(),this.scenegraph.createSceneGraph(),this.render()}get autoWrapText(){return this.internalProps.autoWrapText}set autoWrapText(t){this.internalProps.autoWrapText=t,this.options.autoWrapText=t}get enableLineBreak(){return this.internalProps.enableLineBreak}set enableLineBreak(t){this.internalProps.enableLineBreak=t,this.options.enableLineBreak=t}updateAutoWrapText(t){this.internalProps.autoWrapText!==t&&(this.internalProps.autoWrapText=t,this.options.autoWrapText=t,this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.render())}get theme(){return this.internalProps.theme}set theme(t){this.internalProps.theme=tv.of(t??tv.DEFAULT),this.internalProps.theme.isPivot=this.isPivotTable(),this.options.theme=t}updateTheme(t){const e={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.internalProps.theme=tv.of(t??tv.DEFAULT),this.internalProps.theme.isPivot=this.isPivotTable(),this.options.theme=t,this.scenegraph.updateComponent(),this.scenegraph.updateStageBackground(),this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(e.col,e.row),this.render()}getBodyField(t,e){return this.internalProps.layoutMap.getBody(t,e).field}getBodyColumnDefine(t,e){const i=this.internalProps.layoutMap.getBody(t,e);return i?.define}getBodyColumnType(t,e){return RR("cellType",{cellType:this.internalProps.layoutMap.getBody(t,e).cellType},t,e,this)}getCellType(t,e){let i;return this.isSeriesNumberInHeader(t,e)?this.internalProps.layoutMap.getSeriesNumberHeader(t,e).cellType:(i=this.isHeader(t,e)?this.internalProps.layoutMap.getHeader(t,e).headerType:this.internalProps.layoutMap.getBody(t,e).cellType,RR("cellType",{cellType:i},t,e,this))}getHeaderField(t,e){return this.internalProps.layoutMap.getHeaderField(t,e)}getHeaderDefine(t,e){const i=this.internalProps.layoutMap.getHeader(t,e);return i?.define}getCellLocation(t,e){return this.internalProps.layoutMap.getCellLocation(t,e)}getCellHeaderPaths(t,e){return this.internalProps.layoutMap.getCellHeaderPaths(t,e)}getHeadersDefine(t,e){const i=[];for(;;){const r=this.getHeaderDefine(t,e);if(!r||!r.field&&!r.columns)break;i.push(r),e++}return i}_getHeaderLayoutMap(t,e){return this.internalProps.layoutMap.getHeader(t,e)}_getBodyLayoutMap(t,e){return this.internalProps.layoutMap.getBody(t,e)}getContext(){return this.internalProps.context}getRecordByCell(t,e){if(!this.internalProps.layoutMap.isHeader(t,e))return this.internalProps.dataSource?.get(this.getRecordShowIndexByCell(t,e))}getRecordByRowCol(t,e){return this.getRecordByCell(t,e)}getRecordStartRowByRecordIndex(t){return this.internalProps.layoutMap.getRecordStartRowByRecordIndex(t)}_getHeaderCellBySortState(t){const{layoutMap:e}=this.internalProps,i=e.headerObjects.find((e=>e&&e.field===t.field));if(i){return e.getHeaderCellAdressById(i.id)}}getCellRange(t,e){if(this.internalProps.customMergeCell){const i=this.internalProps.customMergeCell(t,e,this);if(i&&i.range&&i.text)return i.range}return this.internalProps.layoutMap?.getCellRange(t,e)}hasCustomMerge(){return!!this.internalProps.customMergeCell}getCustomMerge(t,e){if(this.internalProps.customMergeCell){const i=this.internalProps.customMergeCell(t,e,this);if(i&&i.range&&(i.text||i.customLayout||this.customRender)){if(i.style){const r=this.internalProps.bodyHelper.getStyleClass("text"),o=AC(i.style,this.theme.bodyStyle,{col:t,row:e,table:this,value:i.text,dataValue:this.getCellOriginValue(t,e),cellHeaderPaths:this.getCellHeaderPaths(t,e)},r,this.options.autoWrapText,this.theme);i.style=o}return i}}}isCellRangeEqual(t,e,i,r){return this.internalProps.layoutMap.isCellRangeEqual(t,e,i,r)}_getLayoutCellId(t,e){return this.internalProps.layoutMap.getCellId(t,e)}getHeaderDescription(t,e){const i=this._getHeaderLayoutMap(t,e),r=i?.define,o=r?.description??i?.description;if("function"==typeof o){return o({col:t,row:e,value:this.getCellValue(t,e),dataValue:this.getCellOriginValue(t,e)})}return o}setDropDownMenuHighlight(t){this.stateManager.setDropDownMenuHighlight(t)}_dropDownMenuIsHighlight(t,e,i){return this.stateManager.dropDownMenuIsHighlight(t,e,i)}isSeriesNumberInBody(t,e){return this.internalProps.layoutMap&&this.internalProps.layoutMap.isSeriesNumberInBody(t,e)}isSeriesNumberInHeader(t,e){return this.internalProps.layoutMap&&this.internalProps.layoutMap.isSeriesNumberInHeader(t,e)}isHeader(t,e){return this.internalProps.layoutMap&&this.internalProps.layoutMap.isHeader(t,e)}isColumnHeader(t,e){return this.internalProps.layoutMap?.isColumnHeader(t,e)}isRowHeader(t,e){return this.internalProps.layoutMap?.isRowHeader(t,e)}isCornerHeader(t,e){return this.internalProps.layoutMap?.isCornerHeader(t,e)}isFrozenColumn(t,e){return this.isLeftFrozenColumn(t,e)||this.isRightFrozenColumn(t,e)}isLeftFrozenColumn(t,e){return this.internalProps.layoutMap?.isFrozenColumn(t,e)}isRightFrozenColumn(t,e){return this.internalProps.layoutMap?.isRightFrozenColumn(t,e)}isFrozenRow(t,e){return this.isTopFrozenRow(t,e)||this.isBottomFrozenRow(t,e)}isTopFrozenRow(t,e){return this.internalProps.layoutMap?.isFrozenRow(t,e)}isBottomFrozenRow(t,e){return this.internalProps.layoutMap?.isBottomFrozenRow(t,e)}getCellInfo(t,e){if(t>=0&&e>=0){const i=this.isHeader(t,e)?this.getHeaderDefine(t,e):this.getBodyColumnDefine(t,e);return{col:t,row:e,field:this.getHeaderField(t,e),cellHeaderPaths:this.internalProps.layoutMap.getCellHeaderPaths(t,e),title:i?.title,cellType:this.getCellType(t,e),originData:this.getCellOriginRecord(t,e),cellRange:this.getCellRangeRelativeRect({col:t,row:e}),value:this.getCellValue(t,e),dataValue:this.getCellOriginValue(t,e),cellLocation:this.getCellLocation(t,e),scaleRatio:this.canvas.getBoundingClientRect().width/this.canvas.offsetWidth}}}_hasField(t,e,i){if(null==t)return!1;const r=this;if(r.internalProps.layoutMap.isHeader(e,i))return!1;const o=r.getRecordShowIndexByCell(e,i);return r.internalProps.dataSource?.hasField(o,t)}_getCellStyle(t,e){const i=this.customCellStylePlugin.getCustomCellStyle(t,e),{layoutMap:r}=this.internalProps;if(r.isHeader(t,e)){let o;if(!this.isPivotTable()||this.isBottomFrozenRow(e)||this.isRightFrozenColumn(t))o=`${t}-${e}`;else{const i=this.getHeaderDefine(t,e);o=i?.dimensionKey?`dim-${i.dimensionKey}`:i?.indicatorKey?`ind-${i.indicatorKey}`:`${t}-${e}`}let n=this.headerStyleCache.get(o);if(n)return i?DH(n,i):n;const s=r.getHeader(t,e);let a;if(this.isPivotChart()&&function(t,e,i){if(!i._table.isPivotChart())return!1;if(i.indicatorsAsCol){if(i.hasTwoIndicatorAxes&&e===i.columnHeaderLevelCount-1&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount)return!0;if(e===i.rowCount-i.bottomFrozenRowCount&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount)return!0}else if(e===i.rowCount-i.bottomFrozenRowCount&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount)return!0;return!1}(t,e,r)&&r.isAxisCell(t,e)){const e=r.getBody(t,this.rowHeaderLevelCount);a=e.style?.padding??this.theme.bodyStyle.padding}else if(this.isPivotChart()&&function(t,e,i){if(!i._table.isPivotChart())return!1;if(i.indicatorsAsCol){if(t===i.rowHeaderLevelCount-1&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount)return!0}else{if(t===i.rowHeaderLevelCount-1&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount)return!0;if(t===i.colCount-i.rightFrozenColCount&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount)return!0}return!1}(t,e,r)&&r.isAxisCell(t,e)){const t=r.getBody(this.columnHeaderLevelCount,e);a=t.style?.padding??this.theme.bodyStyle.padding}if((!s||s.isEmpty)&&(r.isLeftBottomCorner(t,e)||r.isRightBottomCorner(t,e)||r.isCornerHeader(t,e)||r.isRightTopCorner(t,e)))return jH;const l=this.internalProps.headerHelper.getStyleClass(s?.headerType||"text");if(r.isBottomFrozenRow(t,e)&&this.theme.bottomFrozenStyle)n=EC(a?{padding:a}:{},this.theme.bottomFrozenStyle,{col:t,row:e,table:this,value:this.getCellValue(t,e),dataValue:this.getCellOriginValue(t,e),cellHeaderPaths:this.getCellHeaderPaths(t,e)},l,this.options.autoWrapText,this.theme);else if(r.isRightFrozenColumn(t,e)&&this.theme.rightFrozenStyle)n=EC(a?{padding:a}:{},this.theme.rightFrozenStyle,{col:t,row:e,table:this,value:this.getCellValue(t,e),dataValue:this.getCellOriginValue(t,e),cellHeaderPaths:this.getCellHeaderPaths(t,e)},l,this.options.autoWrapText,this.theme);else{const i=s?.style||{};a&&(i.padding=a),n=EC(i,r.isColumnHeader(t,e)||r.isBottomFrozenRow(t,e)?this.theme.headerStyle:r.isRowHeader(t,e)||r.isRightFrozenColumn(t,e)?this.theme.rowHeaderStyle:this.theme.cornerHeaderStyle,{col:t,row:e,table:this,value:this.getCellValue(t,e),dataValue:this.getCellOriginValue(t,e),cellHeaderPaths:this.getCellHeaderPaths(t,e)},l,this.options.autoWrapText,this.theme)}return this.headerStyleCache.set(o,n),i?DH(n,i):n}let o,n;this.internalProps?.dataConfig?.mappingRules&&!this.isHeader(t,e)&&this.internalProps?.dataConfig?.mappingRules?.forEach(((i,r)=>{i.bgColor&&this.internalProps.layoutMap.getIndicatorKey(t,e)===i.bgColor.indicatorKey&&(o=i.bgColor.mapping)}));const s=this.getCellType(t,e);let a;if(n=this.isSeriesNumberInBody(t,e)?`${t}-series-`+s:this.isListTable()&&!this.transpose||this.isPivotTable()&&this.internalProps.layoutMap.indicatorsAsCol?t+s:e+s,a=r.isBottomFrozenRow(e)?this.bodyBottomStyleCache.get(n):this.bodyStyleCache.get(n),a)return i?DH(a,i):a;const l=r.getBody(t,e),h=this.internalProps.bodyHelper.getStyleClass(this.getCellType(t,e)),c=l?.style;return a=AC(c,r.isBottomFrozenRow(e)&&this.theme.bottomFrozenStyle?this.theme.bottomFrozenStyle:r.isRightFrozenColumn(t)&&this.theme.rightFrozenStyle?this.theme.rightFrozenStyle:this.theme.bodyStyle,{col:t,row:e,table:this,value:this.getCellValue(t,e),dataValue:this.getCellOriginValue(t,e),cellHeaderPaths:this.getCellHeaderPaths(t,e)},h,this.options.autoWrapText,this.theme),o&&(a=DH(a,{bgColor:o})),$(c)||(r.isBottomFrozenRow(e)?this.bodyBottomStyleCache.set(n,a):this.bodyStyleCache.set(n,a)),i?DH(a,i):a}clearCellStyleCache(){this.headerStyleCache.clear(),this.bodyStyleCache.clear(),this.bodyBottomStyleCache.clear()}clearRowHeightCache(){this.internalProps._rowHeightsMap.clear(),this._clearRowRangeHeightsMap()}clearColWidthCache(){this.internalProps._colWidthsMap.clear(),this._clearColRangeWidthsMap()}_canResizeColumn(t,e){if(!(t>=0&&e>=0))return!1;if(this.isCellRangeEqual(t,e,t+1,e))return!1;if("none"===this.internalProps.columnResizeMode)return!1;if("header"===this.internalProps.columnResizeMode){if(!this.isHeader(t,e))return!1}else if("body"===this.internalProps.columnResizeMode&&this.isHeader(t,e))return!1;const i=this.colWidthsLimit[t];return!(i&&i.min&&i.max)||i.max!==i.min}_canResizeRow(t,e){if(!(t>=0&&e>=0))return!1;if(this.isCellRangeEqual(t,e,t,e+1))return!1;if("none"===this.internalProps.rowResizeMode)return!1;if("header"===this.internalProps.rowResizeMode){if(!this.isHeader(t,e))return!1}else if("body"===this.internalProps.rowResizeMode&&this.isHeader(t,e))return!1;return!0}_canDragHeaderPosition(t,e){if(this.isHeader(t,e)&&this.stateManager.isSelected(t,e)){if("disabled"===this.internalProps.frozenColDragHeaderMode&&this.isFrozenColumn(t))return!1;const i=this.stateManager.select.ranges[0];if(this.isColumnHeader(t,e)){if(i.end.row!==this.rowCount-1)return!1}else{if(!this.isRowHeader(t,e))return!1;if(i.end.col!==this.colCount-1)return!1}const r=this.getHeaderDefine(t,e);if(!r)return!1;if(void 0===r.dragHeader){if("all"===this.internalProps.dragHeaderMode)return!0;if("column"===this.internalProps.dragHeaderMode){if(this.isColumnHeader(t,e))return!0}else if("row"===this.internalProps.dragHeaderMode&&this.isRowHeader(t,e))return!0;return!1}return r.dragHeader}return!1}getCellIcons(t,e){let i;if(this.isHeader(t,e))i=this.internalProps.headerHelper.getIcons(t,e);else if(this.internalProps.layoutMap.isSeriesNumber(t,e)){const r=this.internalProps.layoutMap.getSeriesNumberBody(t,e)?.define?.dragOrder;r&&(i=this.internalProps.rowSeriesNumberHelper.getIcons(t,e));const o=this.getCellValue(t,e),n=this.getCellOriginValue(t,e),s=this.internalProps.context,a=this.internalProps.bodyHelper.getIcons(t,e,o,n,s);i?.length>0?i=i.concat():a?.length>0&&(i=a)}else{const r=this.getCellValue(t,e),o=this.getCellOriginValue(t,e),n=this.internalProps.context;i=this.internalProps.bodyHelper.getIcons(t,e,r,o,n)}return i}showDropDownMenu(t,e,i){let r="dropdown-menu";i&&(r=Array.isArray(i.content)?"dropdown-menu":"container"),"html"===this.internalProps.menu.renderMode&&(this.stateManager.menu.isShow=!0,this.internalProps.menuHandler._bindToCell(t,e,r,i))}showTooltip(t,e,i){"html"===this.internalProps.tooltip.renderMode&&this.internalProps.tooltipHandler._bindToCell(t,e,i)}getCellStyle(t,e){const i=this._getCellStyle(t,e),r=cR(i,this,t,e,RR).theme,{autoWrapText:o,lineClamp:n,textOverflow:s}=i;return{textAlign:r.text.textAlign,textBaseline:r.text.textBaseline,bgColor:K(r.group.fill)?RR("bgColor",i,t,e,this):r.group.fill,color:K(r.text.fill)?RR("color",i,t,e,this):r.text.fill,fontFamily:r.text.fontFamily,fontSize:r.text.fontSize,fontWeight:r.text.fontWeight,fontVariant:r.text.fontVariant,fontStyle:r.text.fontStyle,lineHeight:r.text.lineHeight,autoWrapText:o??!1,lineClamp:n??"auto",textOverflow:s,borderColor:K(r.group.stroke)?RR("borderColor",i,t,e,this):r.group.stroke,borderLineWidth:r.group.lineWidth,borderLineDash:r.group.lineDash,underline:!!r.text.underline,underlineDash:r.text.underlineDash,underlineOffset:r.text.underlineOffset,lineThrough:!!r.text.lineThrough,padding:r._vtable.padding,underlineWidth:r.text.underline,lineThroughLineWidth:r.text.lineThrough,_strokeArrayWidth:r.group.strokeArrayWidth,_strokeArrayColor:r.group.strokeArrayColor,_linkColor:RR("linkColor",i,t,e,this)}}getAllBodyCells(t,e){const i=this.rowHeaderLevelCount,r=this.columnHeaderLevelCount,o=this.colCount-1,n=this.rowCount-1;return Array(Math.min(e??2e3,n-r+1,this.rowCount)).fill(0).map(((e,n)=>Array(Math.min(t??2e3,o-i+1,this.colCount)).fill(0).map(((t,e)=>this.getCellInfo(e+i,n+r)))))}getAllCells(t,e){const i=0,r=0,o=this.colCount-1,n=this.rowCount-1;return Array(Math.min(e??2e3,n-r+1,this.rowCount)).fill(0).map(((e,n)=>Array(Math.min(t??2e3,o-i+1,this.colCount)).fill(0).map(((t,e)=>this.getCellInfo(e+i,n+r)))))}getAllColumnHeaderCells(){const t=this.rowHeaderLevelCount,e=0,i=this.colCount-1,r=this.columnHeaderLevelCount-1;return Array(r-e+1).fill(0).map(((r,o)=>Array(i-t+1).fill(0).map(((i,r)=>this.getCellInfo(r+t,o+e)))))}getAllRowHeaderCells(){const t=0,e=this.columnHeaderLevelCount,i=this.rowHeaderLevelCount-1,r=this.rowCount-1;return Array(r-e+1).fill(0).map(((r,o)=>Array(i-t+1).fill(0).map(((i,r)=>this.getCellInfo(r+t,o+e)))))}scrollToCell(t){const e=this.getDrawRange();if(Y(t.col)&&t.col>=this.frozenColCount){const i=this.getFrozenColsWidth(),r=this.getColsWidth(0,t.col-1);this.scrollLeft=Math.min(r-i,this.getAllColsWidth()-e.width)}if(Y(t.row)&&t.row>=this.frozenRowCount){const i=this.getFrozenRowsHeight(),r=this.getRowsHeight(0,t.row-1);this.scrollTop=Math.min(r-i,this.getAllRowsHeight()-e.height)}this.render()}getCopyValue(){if(this.stateManager.select?.ranges?.length>0){const t=this.stateManager.select.ranges;let e=Math.min(t[0].start.col,t[0].end.col),i=Math.max(t[0].start.col,t[0].end.col),r=Math.min(t[0].start.row,t[0].end.row),o=Math.max(t[0].start.row,t[0].end.row);t.forEach((t=>{e=Math.min(e,t.start.col,t.end.col),i=Math.max(i,t.start.col,t.end.col),r=Math.min(r,t.start.row,t.end.row),o=Math.max(o,t.start.row,t.end.row)}));const n=e=>{let i=!1;return t.forEach((t=>{const r=Math.min(t.start.row,t.end.row),o=Math.max(t.start.row,t.end.row);r<=e&&o>=e&&(i=!0)})),i},s=e=>{let i=!1;return t.forEach((t=>{const r=Math.min(t.start.col,t.end.col),o=Math.max(t.start.col,t.end.col);r<=e&&o>=e&&(i=!0)})),i},a=(e,i)=>{let r;return t.forEach((t=>{const o=Math.min(t.start.row,t.end.row),n=Math.max(t.start.row,t.end.row),s=Math.min(t.start.col,t.end.col),a=Math.max(t.start.col,t.end.col);s<=e&&a>=e&&o<=i&&n>=i&&(r=t)})),r},l=(t,e,i)=>{const r=this.getCellRange(t,e);let o=r.start.col,n=r.start.row;if(i){const t=Math.min(i.start.col,i.end.col),e=Math.min(i.start.row,i.end.row);o=Math.max(t,r.start.col),n=Math.max(e,r.start.row)}if(o!==t||n!==e)return"";return this.getCellValue(t,e)};let h="";for(let t=r;t<=o;t++){if(n(t)){for(let r=e;r<=i;r++){if(s(r)){const e=a(r,t);if(e){const o=l(r,t,e);if("undefined"!=typeof Promise&&o instanceof Promise);else{const t=Y(o)?`${o}`:"";/^\[object .*\]$/.exec(t)||(h+=t)}(r<e.end.col||r<i)&&(h+="\t")}else h+="\t"}}t<o&&(h+="\r\n")}}return h}return""}getSelectedCellInfos(){if(!this.stateManager.select?.ranges)return null;const t=this.stateManager.select.ranges;if(!t.length)return[];let e=Math.min(t[0].start.col,t[0].end.col),i=Math.max(t[0].start.col,t[0].end.col),r=Math.min(t[0].start.row,t[0].end.row),o=Math.max(t[0].start.row,t[0].end.row);t.forEach((t=>{e=Math.min(e,t.start.col,t.end.col),i=Math.max(i,t.start.col,t.end.col),r=Math.min(r,t.start.row,t.end.row),o=Math.max(o,t.start.row,t.end.row)}));const n=e=>{let i=!1;return t.forEach((t=>{const r=Math.min(t.start.row,t.end.row),o=Math.max(t.start.row,t.end.row);r<=e&&o>=e&&(i=!0)})),i},s=e=>{let i=!1;return t.forEach((t=>{const r=Math.min(t.start.col,t.end.col),o=Math.max(t.start.col,t.end.col);r<=e&&o>=e&&(i=!0)})),i},a=(e,i)=>{let r;return t.forEach((t=>{const o=Math.min(t.start.row,t.end.row),n=Math.max(t.start.row,t.end.row),s=Math.min(t.start.col,t.end.col),a=Math.max(t.start.col,t.end.col);s<=e&&a>=e&&o<=i&&n>=i&&(r=t)})),r},l=[];for(let t=r;t<=o;t++){if(n(t)){const r=[];for(let o=e;o<=i;o++){if(s(o)){if(a(o,t)){const e=this.getCellInfo(o,t);r.push(e)}}}l.push(r)}}return l}getSelectedCellRanges(){const t=this.stateManager.select.ranges;return t.length?mt(t):[]}measureText(t,e){return DB.measureText(t,e)}measureTextBounds(t){return NB(t)}getCustomRender(t,e){let i;if("body"!==this.getCellLocation(t,e)){const r=this.getHeaderDefine(t,e);i=r?.headerCustomRender}else{const r=this.getBodyColumnDefine(t,e);i=r?.customRender||this.customRender}return i}getCustomLayout(t,e){let i;if("body"!==this.getCellLocation(t,e)){const r=this.getHeaderDefine(t,e);i=r?.headerCustomLayout}else{const r=this.getBodyColumnDefine(t,e);i=r?.customLayout}return i}hasAutoImageColumn(){const t=this.internalProps.layoutMap.columnObjects.find((t=>!("image"!==t.cellType&&"video"!==t.cellType&&"function"!=typeof t.cellType||!t.define.imageAutoSizing))),e=this.internalProps.layoutMap.headerObjects.find((t=>!(!t||"image"!==t.headerType&&"video"!==t.headerType&&"function"!=typeof t.headerType||!t.define.imageAutoSizing)));return t||e}_getActiveChartInstance(){const t=this.scenegraph.getCell(this.stateManager.hover?.cellPos?.col,this.stateManager.hover?.cellPos?.row);return"chart"===t?.getChildren()?.[0]?.type?t.getChildren()[0].activeChartInstance:null}cellIsInVisualView(t,e){const i=this.getDrawRange(),r=this.getCellRelativeRect(t,e);if(t<this.frozenColCount&&e<this.frozenRowCount)return!0;const o=this.getCellRangeRelativeRect({start:{col:0,row:0},end:{col:this.colCount-1,row:this.columnHeaderLevelCount}}),n=this.getCellRangeRelativeRect({start:{col:0,row:0},end:{col:this.rowHeaderLevelCount,row:this.rowCount-1}});if(r.top>=i.top&&r.bottom<=i.bottom&&r.left>=i.left&&r.right<=i.right){if(this.isHeader(t,e))return!0;if(i.top>=o.bottom&&i.left>=n.right)return!0}return!1}getCustomMergeValue(t,e){if(this.internalProps.customMergeCell){const i=this.getCustomMerge(t,e);if(i){const{text:t}=i;return t}}}exportImg(){return this.scenegraph.stage.toCanvas().toDataURL()}exportCellImg(t,e){const i=this.cellIsInVisualView(t,e),{scrollTop:r,scrollLeft:o}=this;i||this.scrollToCell({col:t,row:e});const n=this.getCellRelativeRect(t,e);this.stateManager.select?.ranges?.length>0&&PT(this.scenegraph);const{col:s,row:a}=this.stateManager.hover.cellPos;this.stateManager.updateHoverPos(-1,-1),this.scenegraph.component.hideVerticalScrollBar(),this.scenegraph.component.hideHorizontalScrollBar(),this.scenegraph.renderSceneGraph();const l=this.scenegraph.stage.toCanvas(!1,(new ue).set(n.left+this.tableX+1,n.top+this.tableY+1,n.right+this.tableX,n.bottom+this.tableY));return i||(this.setScrollTop(r),this.setScrollLeft(o)),this.stateManager.select?.ranges?.length>0&&HT(this.scenegraph),this.stateManager.updateHoverPos(s,a),l.toDataURL()}exportCellRangeImg(t){const{scrollTop:e,scrollLeft:i}=this,r=Math.min(t.start.col,t.end.col),o=Math.min(t.start.row,t.end.row),n=Math.max(t.start.col,t.end.col),s=Math.max(t.start.row,t.end.row),a=this.cellIsInVisualView(r,o),l=this.cellIsInVisualView(n,s);a&&l||this.scrollToCell({col:r,row:o});const h=this.getCellRangeRelativeRect({start:{col:r,row:o},end:{col:n,row:s}});this.stateManager.select?.ranges?.length>0&&PT(this.scenegraph);const{col:c,row:d}=this.stateManager.hover.cellPos;this.stateManager.updateHoverPos(-1,-1),this.scenegraph.component.hideVerticalScrollBar(),this.scenegraph.component.hideHorizontalScrollBar(),this.scenegraph.renderSceneGraph();const u=this.scenegraph.stage.toCanvas(!1,(new ue).set(h.left+this.tableX+1,h.top+this.tableY+1,h.right+this.tableX,h.bottom+this.tableY)).toDataURL();return a&&l||(this.setScrollTop(e),this.setScrollLeft(i)),this.stateManager.select?.ranges?.length>0&&HT(this.scenegraph),this.stateManager.updateHoverPos(c,d),u}exportCanvas(){return this.scenegraph.stage.toCanvas()}getImageBuffer(t="image/png"){if("node"!==this.options.mode)return;this.render();const e=this.scenegraph.stage;if(e){const i=this.tableX+this.getAllColsWidth(),r=this.tableY+this.getAllRowsHeight();if(i>=this.canvasWidth&&r>=this.canvasHeight){e.render();return e.window.getImageBuffer(t)}return this.scenegraph.stage.toCanvas(!1,(new ue).set(0,0,Math.min(this.canvasWidth,i),Math.min(this.canvasHeight,r))).toBuffer(t)}return null}getBodyIndexByTableIndex(t,e){return{col:t-this.rowHeaderLevelCount,row:e-this.columnHeaderLevelCount}}getTableIndexByBodyIndex(t,e){return{col:t+this.rowHeaderLevelCount,row:e+this.columnHeaderLevelCount}}onVChartEvent(t,e,i){this._chartEventMap[t]||(this._chartEventMap[t]=[]),"function"==typeof e?this._chartEventMap[t].push({callback:e}):this._chartEventMap[t].push({callback:i,query:e})}offVChartEvent(t,e){this._chartEventMap[t]&&(this._chartEventMap[t]=e?this._chartEventMap[t].filter((t=>t.callback!==e)):[])}_bindChartEvent(t){if(t)for(const e in this._chartEventMap)(this._chartEventMap[e]||[]).forEach((i=>{i.query?t.on(e,i.query,i.callback):t.on(e,i.callback)}))}changeRecordOrder(t,e){}registerCustomCellStyle(t,e){this.customCellStylePlugin.registerCustomCellStyle(t,e)}arrangeCustomCellStyle(t,e){this.customCellStylePlugin.arrangeCustomCellStyle(t,e)}isSeriesNumber(t,e){return this.internalProps.layoutMap.isSeriesNumber(t,e)}isHasSeriesNumber(){return this.internalProps.layoutMap?.leftRowSeriesNumberColumnCount>0}get leftRowSeriesNumberCount(){return this.internalProps.layoutMap?.leftRowSeriesNumberColumnCount??0}setMinMaxLimitWidth(t=!1){const e=this.internalProps;for(let i=0;i<e.layoutMap.columnWidths.length;i++){const{width:r,minWidth:o,maxWidth:n}=e.layoutMap.columnWidths?.[i]??{};t&&r&&("string"==typeof r&&"auto"!==r||"number"==typeof r&&r>0)&&this._setColWidth(i,r),o&&("number"==typeof o&&o>0||"string"==typeof o)&&this.setMinColWidth(i,o),n&&("number"==typeof n&&n>0||"string"==typeof n)&&this.setMaxColWidth(i,n)}}}var UH=Object.freeze({__proto__:null,BaseTable:VH});const KH={};function $H(t){if(KH[t])return KH[t]}function XH(t,e,i){const r=t[e];return t[e]=i,r}function YH(t){for(const e in t)delete t[e]}function qH(){YH(Lw),YH(CR),YH(GR)}var ZH=Object.freeze({__proto__:null,chartModule:function(t,e){return null!=e?XH(GR,t,e):GR[t]},clearAll:qH,editor:function(t,e){return null!=e?XH(KH,t,e):KH[t]},icon:function(t,e){return null!=e?XH(CR,t,e):CR[t]},theme:function(t,e){return null!=e?XH(Lw,t,e):Lw[t]}});var JH=Object.freeze({__proto__:null,dateFormat:function(t,e,i,r,o){null==i&&(i=!1),null==r&&(r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]),null==o&&(o=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]);const n=i?"UTC":"",s=function(t){return`0${t}`.substring(0,2)};return function(i){const a=new Date(Date.parse(i[t]));return e.replace(/%(.)/g,(function(t,e){switch(e){case"y":return a[`get${n}FullYear`]();case"m":return s(a[`get${n}Month`]()+1);case"n":return r[a[`get${n}Month`]()];case"d":return s(a[`get${n}Date`]());case"w":return o[a[`get${n}Day`]()];case"x":return a[`get${n}Day`]();case"H":return s(a[`get${n}Hours`]());case"M":return s(a[`get${n}Minutes`]());case"S":return s(a[`get${n}Seconds`]());default:return`%${e}`}}))}},numberFormat:function(t){return t=Object.assign({},{digitsAfterDecimal:2,scaler:1,thousandsSep:",",decimalSep:".",prefix:"",suffix:""},t),function(e){if(isNaN(e)||!isFinite(e))return"";const i=function(t,e,i){const r=(t+="").split(".");let o=r[0];const n=r.length>1?i+r[1]:"";return o=function(t,e){return t.replace(/\d+/,(function(t){return t.replace(/(\d)(?=(\d{3})+$)/g,(function(t){return`${t}${e}`}))}))}(o,e),o+n}((t.scaler*e).toFixed(t.digitsAfterDecimal),t.thousandsSep,t.decimalSep);return`${t.prefix}${i}${t.suffix}`}}});const QH="NO_AXISID_FRO_VTABLE";function tE(t){let e=!1;for(let i=0;i<t.indicatorsDefine.length;i++){const r=t.indicatorsDefine[i];if(r.chartSpec&&"pie"!==r.chartSpec.type&&"funnel"!==r.chartSpec.type&&"rose"!==r.chartSpec.type){e=!0;break}}return e}function eE(t,e,i,r){let o=!1;if(r.indicatorsAsCol&&"row"===i||!r.indicatorsAsCol&&"col"===i)for(let t=0;t<r.indicatorsDefine.length;t++){const e=r.indicatorsDefine[t];if(e.chartSpec&&"pie"!==e.chartSpec.type&&"funnel"!==e.chartSpec.type&&"rose"!==e.chartSpec.type){o=!0;break}}else{const i=r.getRawChartSpec(t,e);i?"pie"!==i.type&&"funnel"!==i.type&&"rose"!==i.type&&(o=!0):o=!1}return o}function iE(t,e,i){const r=i.getRawChartSpec(t,e);if(r?.series){const t={};return r.data?.id&&(t[r.data.id]=void 0),r?.series.forEach((e=>{if(!e.data?.fromDataId)if(e.data?.transforms)t[e.data?.id??r.data?.id??"data"]=void 0;else{const i="horizontal"===e.direction?e.xField:e.yField;t[e.data?.id??r.data?.id??"data"]=e.data?.id?i:void 0}})),t}return r.data.id}function rE(t,e,i,r,o,n,s){const{axisOption:a,isPercent:l,isZeroAlign:h,seriesIndice:c}=vB(t,e,r,s),d=_B(s.dataset.collectedValues,o,h,n,c??i);if(l&&(d.min=d.min<0?-1:0,d.max=d.max>0?1:0),(a?.zero||d.min===d.max)&&(d.min=Math.min(d.min,0),d.max=Math.max(d.max,0)),a?.nice){const{range:e}=uB(d.min,d.max,a,0,s._table.getColWidth(t));d.min=e[0],d.max=e[1]}return ot(a?.min)&&(d.min=a.min),ot(a?.max)&&(d.max=a.max),{range:d,isZeroAlign:h,axisOption:a}}function oE(t){let e=!1;for(let i=0;i<t.columnObjects.length;i++){if(t.columnObjects[i].chartSpec){e=!0;break}}return e}class nE{sharedVar;sizeIncludeParent=!1;rowExpandLevel;hierarchyType;tree={id:0,dimensionKey:"",value:"",children:[],level:-1,levelSpan:1,startIndex:0,size:0,startInTotal:0,hierarchyState:void 0};totalLevel=0;dimensionKeys=new Bw;cache=new Map;constructor(t,e,i="grid",r=void 0){this.sizeIncludeParent=null!=r,this.rowExpandLevel=r,this.hierarchyType=i,this.sharedVar=e,this.reset(t)}reset(t,e=!1){this.cache.clear(),this.dimensionKeys=new Bw,this.tree.children=t,this.setTreeNode(this.tree,0,this.tree),this.totalLevel=this.dimensionKeys.count()}setTreeNode(t,e,i){t.startIndex=e,t.startInTotal=(i.startInTotal??0)+t.startIndex,(t.dimensionKey??t.indicatorKey)&&(!this.dimensionKeys.contain(t.indicatorKey?Ow:t.dimensionKey)&&this.dimensionKeys.put(t.level,t.indicatorKey?Ow:t.dimensionKey),t.id||(t.id=++this.sharedVar.seqId));let r=t.dimensionKey&&this.sizeIncludeParent?1:0;const o=t.children||t.columns;return"grid"===this.hierarchyType?o?.length>=1?o.forEach((e=>{e.level=(t.level??0)+1,r+=this.setTreeNode(e,r,t)})):r=1:t.hierarchyState===oC.expand&&o?.length>=1?o.forEach((e=>{e.level=(t.level??0)+1,r+=this.setTreeNode(e,r,t)})):t.hierarchyState===oC.collapse&&o?.length>=1?o.forEach((e=>{e.level=(t.level??0)+1,this.setTreeNode(e,r,t)})):!t.hierarchyState&&t.level+1<this.rowExpandLevel&&(o?.length>=1||!0===o)?(t.hierarchyState=oC.expand,o?.length>=1&&o.forEach((e=>{e.level=(t.level??0)+1,r+=this.setTreeNode(e,r,t)}))):o?.length>=1||!0===o?(t.hierarchyState=oC.collapse,o?.length>=1&&o.forEach((e=>{e.level=(t.level??0)+1,this.setTreeNode(e,r,t)}))):(t.hierarchyState=oC.none,r=1),t.size=r,r}getTreePath(t,e=30){const i=[];return this.searchPath(t,this.tree,i,e),i.shift(),i}getTreePathByCellIds(t){const e=[];let i=this.tree.children;for(let r=0;r<t.length;r++){const o=t[r],n=this.findNodeById(i,o);if(!n)break;e.push(n),i=n.children}return e}findNodeById(t,e){return t.find((t=>t.id===e))}searchPath(t,e,i,r){if(!e)return;if(t<e.startIndex||t>=e.startIndex+e.size)return;if(i.push(e),!e.children||0===e.children.length||e.level>=r)return;const o=t-e.startIndex;if(this.cache.has(e.level+1)){const t=this.cache.get(e.level+1);if(o>=t.startIndex&&o<t.startIndex+t.size)return void this.searchPath(o,t,i,r)}let n=0,s=e.children.length-1;for(;n<=s;){const t=Math.floor((n+s)/2),a=e.children[t];if(o>=a.startIndex&&o<a.startIndex+a.size){this.cache.set(a.level,a);const t=[];this.cache.forEach(((e,i)=>{i>a.level&&t.push(i)})),t.forEach((t=>{this.cache.delete(t)})),this.searchPath(o,a,i,r);break}o<a.startIndex?s=t-1:n=t+1}}movePosition(t,e,i){let r,o,n;const s=(a,l)=>{if(void 0!==o&&void 0!==n)return;a.level===t&&(a.startInTotal===e&&(o=l),a.startInTotal<=i&&i<=a.startInTotal+a.size-1&&(n=l));const h=a.children||a.columns;if(h&&a.level<t){r=a;for(let t=0;t<h.length;t++)(e>=h[t].startInTotal&&e<=h[t].startInTotal+h[t].size||i>=h[t].startInTotal&&i<=h[t].startInTotal+h[t].size)&&s(h[t],t)}};s(this.tree,0);const a=r.children||r.columns,l=a.splice(o,1);l.unshift(n,0),Array.prototype.splice.apply(a,l)}getCopiedTree(){const t=mt(this.tree.children);return cE(t),t}}function sE(t,e){e?.forEach((e=>{const i={dimensionKey:e.dimensionKey,indicatorKey:e.indicatorKey,value:e.value,hierarchyState:e.hierarchyState,children:void 0};t.push(i),e.children&&(i.children=[],sE(i.children,e.children))}))}function aE(t,e){let i=0;return t?.forEach((t=>{e?i++:t.children&&0!==t.children.length||i++,t.children&&(i+=aE(t.children,e))})),i}function lE(t,e,i,r,o,n){const s=t.id,a=n.rowsDefine?.find((e=>"string"!=typeof e&&e.dimensionKey===t.dimensionKey))??n.columnsDefine?.find((e=>"string"!=typeof e&&e.dimensionKey===t.dimensionKey)),l=n.indicatorsDefine?.find((e=>"string"!=typeof e&&(t.indicatorKey?e.indicatorKey===t.indicatorKey:e.title===t.value))),h={id:s,title:t.value??l?.title,field:t.dimensionKey,style:"function"==typeof(l??a)?.headerStyle?(l??a)?.headerStyle:Object.assign({},(l??a)?.headerStyle),headerType:l?.headerType??a?.headerType??"text",headerIcon:l?.headerIcon??a?.headerIcon,define:Object.assign({},t,l??a),fieldFormat:l?.headerFormat??a?.headerFormat,dropDownMenu:l?.dropDownMenu??a?.dropDownMenu,pivotInfo:{value:t.value,dimensionKey:t.dimensionKey,isPivotCorner:!1},width:a?.width,minWidth:a?.minWidth,maxWidth:a?.maxWidth,showSort:l?.showSort??a?.showSort,description:a?.description};l?(l.customRender&&(t.customRender=l.customRender),Y(n._indicators?.find((t=>t.indicatorKey===l.indicatorKey)))||n._indicators?.push({id:++n.sharedVar.seqId,indicatorKey:l.indicatorKey,field:l.indicatorKey,fieldFormat:l?.format,cellType:l?.cellType??l?.columnType??"text",chartModule:"chartModule"in l?l.chartModule:null,chartSpec:"chartSpec"in l?l.chartSpec:null,sparklineSpec:"sparklineSpec"in l?l.sparklineSpec:null,style:l?.style,icon:l?.icon,define:Object.assign({},t,l,{dragHeader:a?.dragHeader}),width:l?.width,minWidth:l?.minWidth,maxWidth:l?.maxWidth,disableColumnResize:l?.disableColumnResize})):t.indicatorKey&&(Y(n._indicators?.find((e=>e.indicatorKey===t.indicatorKey)))||n._indicators?.push({id:++n.sharedVar.seqId,indicatorKey:t.indicatorKey,field:t.indicatorKey,cellType:"text",define:Object.assign({},t)})),i[s]=h,n._headerObjects[s]=h,e[o][n.colIndex]=s;for(let t=o-1;t>=0;t--)e[t][n.colIndex]=r[t];if(t.levelSpan>1)for(let i=1;i<t.levelSpan;i++)e[o+i]||(e[o+i]=[]),e[o+i][n.colIndex]=s;if(t.children?.length>=1)n._addHeaders(e,o+(t.levelSpan??1),t.children??[],[...r,...Array(t.levelSpan??1).fill(s)],i);else{for(let t=o+1;t<e.length;t++)e[t][n.colIndex]=s;n.colIndex++}}function hE(t,e,i,r,o,n,s,a,l){const h=t.id,c=a.find((e=>"string"!=typeof e&&e.dimensionKey===t.dimensionKey)),d={id:h,title:t.value,field:t.dimensionKey,style:t.level+1===n||"function"==typeof c?.headerStyle?c?.headerStyle:Object.assign({},c?.headerStyle,{textAlign:"left"}),headerType:c?.headerType??"text",headerIcon:c?.headerIcon,define:Object.assign(t,{linkJump:c?.linkJump,linkDetect:c?.linkDetect,templateLink:c?.templateLink,keepAspectRatio:c?.keepAspectRatio??!1,imageAutoSizing:c?.imageAutoSizing,headerCustomRender:c?.headerCustomRender,headerCustomLayout:c?.headerCustomLayout,dragHeader:c?.dragHeader,disableHeaderHover:!!c?.disableHeaderHover,disableHeaderSelect:!!c?.disableHeaderSelect}),fieldFormat:c?.headerFormat,dropDownMenu:c?.dropDownMenu,pivotInfo:{value:t.value,dimensionKey:t.dimensionKey,isPivotCorner:!1},hierarchyLevel:t.level,dimensionTotalLevel:n,hierarchyState:t.hierarchyState,width:c?.width,minWidth:c?.minWidth,maxWidth:c?.maxWidth,parentCellId:r[r.length-1]};i[h]=d,l._headerObjects[h]=d,e[o][l.colIndex]=h;for(let t=o-1;t>=0;t--)e[t][l.colIndex]=r[t];if(t.hierarchyState===oC.expand&&t.children?.length>=1)s&&l.colIndex++,l._addHeadersForTreeMode(e,o,t.children??[],[...r,h],n,s&&t.hierarchyState===oC.expand,a,i);else{s&&l.colIndex++;for(let t=o+1;t<e.length;t++)e[t][l.colIndex]=h}}function cE(t){for(let e=0;e<t.length;e++){const i=t[e];delete i.level,delete i.startIndex,delete i.id,delete i.levelSpan,delete i.size,delete i.startInTotal;const r=i.children||i.columns;r&&cE(r)}}class dE{seqId=0;_headerObjects;_headerObjectMap;_headerCellIds;_columns;rowSeriesNumberColumn;leftRowSeriesNumberColumn;rightRowSeriesNumberColumn;leftRowSeriesNumberColumnCount=0;rightRowSeriesNumberColumnCount=0;columnTree;bodyRowSpanCount=1;hierarchyIndent;hierarchyTextStartAlignment;_transpose=!1;_showHeader=!0;_recordsCount=0;_table;_hasAggregation=!1;_hasAggregationOnTopCount=0;_hasAggregationOnBottomCount=0;rowHierarchyType;_cellRangeMap;constructor(t,e,i,r){this._cellRangeMap=new Map,this._showHeader=i,this._table=t,this._columns=[],this._headerCellIds=[],this.hierarchyIndent=r??20,this.hierarchyTextStartAlignment=t.options.hierarchyTextStartAlignment,this.columnTree=new nE(e,{seqId:0}),this._headerObjects=this._addHeaders(0,e,[]),this._headerObjectMap=this._headerObjects.reduce(((t,e)=>(t[e.id]=e,t)),{}),this.rowHierarchyType=function(t){const e=t.columnObjects;for(let t=0;t<e.length;t++){const i=e[t];if(i?.define?.tree)return!0}return!1}(this)?"tree":"grid",this._hasAggregation=function(t){const e=t.columnObjects;for(let t=0;t<e.length;t++){const i=e[t];if(i?.aggregation)return!0}return!1}(this),this._hasAggregationOnBottomCount=function(t){const e=t.columnObjects;let i=0;for(let t=0;t<e.length;t++){const r=e[t];r?.aggregation&&(Array.isArray(r?.aggregation)?i=Math.max(i,r.aggregation.filter((t=>!1===t.showOnTop)).length):!1===r.aggregation.showOnTop&&(i=Math.max(i,1)))}return i}(this),this._hasAggregationOnTopCount=function(t){const e=t.columnObjects;let i=0;for(let t=0;t<e.length;t++){const r=e[t];r?.aggregation&&(Array.isArray(r?.aggregation)?i=Math.max(i,r.aggregation.filter((t=>!0===t.showOnTop)).length):!0===r.aggregation.showOnTop&&(i=Math.max(i,1)))}return i}(this),this.handleRowSeriesNumber(t.internalProps.rowSeriesNumber)}handleRowSeriesNumber(t){t&&(Array.isArray(t)?this.rowSeriesNumberColumn=t.map((t=>({id:this.seqId++,title:t.title,define:t,cellType:t.cellType??"text",style:t.style,width:t.width,format:t.format,field:t.field,icon:t.icon,headerIcon:t.headerIcon,isChildNode:!1}))):this.rowSeriesNumberColumn=[{id:this.seqId++,title:t.title,define:t,cellType:t.cellType??"text",style:t.style,width:t.width,format:t.format,field:"",icon:t.icon,headerIcon:t.headerIcon,isChildNode:!1}],this.leftRowSeriesNumberColumn=this.rowSeriesNumberColumn.filter((t=>!0)),this.rightRowSeriesNumberColumn=this.rowSeriesNumberColumn.filter((t=>!1)),this.leftRowSeriesNumberColumnCount=this.leftRowSeriesNumberColumn.length,this.rightRowSeriesNumberColumnCount=this.rightRowSeriesNumberColumn.length)}get transpose(){return this._transpose}set transpose(t){this._transpose=t}get showHeader(){return this._showHeader}set showHeader(t){this._showHeader=t}isSeriesNumberInHeader(t,e){if(this.leftRowSeriesNumberColumnCount>0&&t>=0&&e>=0&&t<this.leftRowSeriesNumberColumnCount){if(this.transpose)return!1;if(e<this.headerLevelCount)return!0}if(this.rightRowSeriesNumberColumnCount>0&&e>=0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount){if(this.transpose)return!1;if(e<this.headerLevelCount)return!0}return!1}isSeriesNumberInBody(t,e){if(this.leftRowSeriesNumberColumnCount>0&&t>=0&&t<this.leftRowSeriesNumberColumnCount){if(this.transpose)return!0;if(e>=this.headerLevelCount)return!0}if(this.rightRowSeriesNumberColumnCount>0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount){if(this.transpose)return!0;if(e>=this.headerLevelCount)return!0}return!1}isSeriesNumber(t,e){return this.leftRowSeriesNumberColumnCount>0&&t>=0&&e>=0&&t<this.leftRowSeriesNumberColumnCount||this.rightRowSeriesNumberColumnCount>0&&e>=0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount}getSeriesNumberHeader(t,e){if(this.leftRowSeriesNumberColumnCount>0&&t>=0&&t<this.leftRowSeriesNumberColumnCount){if(this.transpose)return;if(e<this.headerLevelCount)return Object.assign({},this.leftRowSeriesNumberColumn[t],{style:this._table.internalProps.rowSeriesNumber.headerStyle})}if(this.rightRowSeriesNumberColumnCount>0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount&&e<this.headerLevelCount){if(this.transpose)return;if(e<this.headerLevelCount)return this.rightRowSeriesNumberColumn[t-(this.colCount-this.rightRowSeriesNumberColumnCount)]}}getSeriesNumberBody(t,e){if(this.leftRowSeriesNumberColumnCount>0&&t>=0&&t<this.leftRowSeriesNumberColumnCount){if(this.transpose)return this.leftRowSeriesNumberColumn[t];if(e>=this.headerLevelCount)return this.leftRowSeriesNumberColumn[t]}if(this.rightRowSeriesNumberColumnCount>0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount){if(this.transpose)return this.rightRowSeriesNumberColumn[t-(this.colCount-this.rightRowSeriesNumberColumnCount)];if(e>=this.headerLevelCount)return this.rightRowSeriesNumberColumn[t-(this.colCount-this.rightRowSeriesNumberColumnCount)]}}isHeader(t,e){return!!(this.transpose&&t>=this.leftRowSeriesNumberColumnCount&&t<this.headerLevelCount+this.leftRowSeriesNumberColumnCount)||!this.transpose&&e>=0&&e<this.headerLevelCount}isAggregation(t,e){if(this.hasAggregation){if(this.hasAggregationOnBottomCount)if(this.transpose){if(t>=this.colCount-this.hasAggregationOnBottomCount)return!0}else if(e>=this.rowCount-this.hasAggregationOnBottomCount)return!0;if(this.hasAggregationOnTopCount)if(this.transpose){if(t>=this.rowHeaderLevelCount&&t<this.rowHeaderLevelCount+this.hasAggregationOnTopCount)return!0}else if(e>=this.columnHeaderLevelCount&&e<this.columnHeaderLevelCount+this.hasAggregationOnTopCount)return!0}return!1}isTopAggregation(t,e){if(this.hasAggregationOnTopCount)if(this.transpose){if(t>=this.rowHeaderLevelCount&&t<this.rowHeaderLevelCount+this.hasAggregationOnTopCount)return!0}else if(e>=this.columnHeaderLevelCount&&e<this.columnHeaderLevelCount+this.hasAggregationOnTopCount)return!0;return!1}isBottomAggregation(t,e){if(this.hasAggregationOnBottomCount)if(this.transpose){if(t>=this.colCount-this.hasAggregationOnBottomCount)return!0}else if(e>=this.rowCount-this.hasAggregationOnBottomCount)return!0;return!1}get hasAggregation(){return this._hasAggregation}get hasAggregationOnTopCount(){return this._hasAggregationOnTopCount}get hasAggregationOnBottomCount(){return this._hasAggregationOnBottomCount}getAggregatorsByCell(t,e){return this.getBody(t,e).aggregator}getAggregatorsByCellRange(t,e,i,r){let o=[];if(!this.transpose){for(let r=t;r<=i;r++){const t=this.getBody(r,e);t.aggregator&&(o=o.concat(Array.isArray(t.aggregator)?t.aggregator:[t.aggregator]))}return o}for(let i=e;i<=r;i++){const e=this.getBody(t,i);e.aggregator&&(o=o.concat(Array.isArray(e.aggregator)?e.aggregator:[e.aggregator]))}return[]}getAggregatorOnTop(t,e){const i=this.getBody(t,e),r=i.aggregator,o=i.aggregation;if(Array.isArray(o)){const i=o.reduce(((t,e,i)=>(e.showOnTop&&t.push(i),t)),[]),n=i.map((t=>r[t]));return this.transpose?n[t-this.rowHeaderLevelCount]:n[e-this.columnHeaderLevelCount]}return this.transpose&&t-this.rowHeaderLevelCount==0?o?.showOnTop?r:null:this.transpose||e-this.columnHeaderLevelCount!=0?null:o?.showOnTop?r:null}getAggregatorOnBottom(t,e){const i=this.getBody(t,e),r=i.aggregator,o=i.aggregation;if(Array.isArray(o)){const i=o.reduce(((t,e,i)=>(!1===e.showOnTop&&t.push(i),t)),[]),n=i.map((t=>r[t]));return this.transpose?n[t-(this.colCount-this.hasAggregationOnBottomCount)]:n[e-(this.rowCount-this.hasAggregationOnBottomCount)]}return this.transpose&&t-(this.colCount-this.hasAggregationOnBottomCount)==0?!1===o?.showOnTop?r:null:this.transpose||e-(this.rowCount-this.hasAggregationOnBottomCount)!=0?null:!1===o?.showOnTop?r:null}getAggregatorCellAddress(t,e,i,r){const o=[],n=this.hasAggregationOnTopCount,s=this.hasAggregationOnBottomCount;if(this.transpose)for(let i=e;i<=r;i++){if(this.getBody(t,i).aggregator){for(let t=0;t<n;t++)o.push({col:this.headerLevelCount+t,row:i});for(let t=0;t<s;t++)o.push({col:this.rowCount-s+t,row:i})}}else for(let r=t;r<=i;r++){if(this.getBody(r,e).aggregator){for(let t=0;t<n;t++)o.push({col:r,row:this.headerLevelCount+t});for(let t=0;t<s;t++)o.push({col:r,row:this.rowCount-s+t})}}return o}getCellLocation(t,e){return this.isHeader(t,e)?this.transpose?"rowHeader":"columnHeader":"body"}isRowHeader(t,e){return!!(this.transpose&&t>=this.leftRowSeriesNumberColumnCount&&t<this.headerLevelCount+this.leftRowSeriesNumberColumnCount)}isColumnHeader(t,e){return!this.transpose&&e>=0&&e<=this.headerLevelCount-1&&t>=this.leftRowSeriesNumberColumnCount&&t<this.colCount-this.rightRowSeriesNumberColumnCount}isFrozenColumn(t,e){if(Y(e)){if(t>=0&&t<this.frozenColCount&&e>=this.frozenRowCount&&e<this.rowCount-this.bottomFrozenRowCount)return!0}else if(this.frozenColCount>0&&t>=0&&t<this.frozenColCount)return!0;return!1}isRightFrozenColumn(t,e){if(Y(e)){if(t>=this.colCount-this.rightFrozenColCount&&e>=this.frozenRowCount&&e<this.rowCount-this.bottomFrozenRowCount)return!0}else if(this.rightFrozenColCount>0&&t>=this.colCount-this.rightFrozenColCount)return!0;return!1}isFrozenRow(t,e){if(Y(e)){if(e>=0&&e<this.frozenRowCount&&t>=this.frozenColCount&&t<this.colCount-this.rightFrozenColCount)return!0}else if(e=t,this.frozenRowCount>0&&e>=0&&e<this.frozenRowCount)return!0;return!1}isBottomFrozenRow(t,e){if(Y(e)){if(e>=this.rowCount-this.bottomFrozenRowCount&&t>=this.frozenColCount&&t<this.colCount-this.rightFrozenColCount)return!0}else if(e=t,this.bottomFrozenRowCount>0&&e>=this.rowCount-this.bottomFrozenRowCount)return!0;return!1}isLeftBottomCorner(t,e){return t>=0&&t<this.rowHeaderLevelCount&&e>=this.rowCount-this.bottomFrozenRowCount}isRightTopCorner(t,e){return t>=this.colCount-this.rightFrozenColCount&&e>=0&&e<this.columnHeaderLevelCount}isRightBottomCorner(t,e){return t>=this.colCount-this.rightFrozenColCount&&e>=this.rowCount-this.bottomFrozenRowCount}isCornerHeader(t,e){return!1}getColumnHeaderRange(){return this.transpose?{start:{col:0,row:0},end:{col:this._headerCellIds.length-1,row:(this.rowCount??0)-1}}:{start:{col:0,row:0},end:{col:(this.colCount??0)-1,row:this._headerCellIds.length-1}}}getRowHeaderRange(){return this.transpose?{start:{col:0,row:0},end:{col:this._headerCellIds.length-1,row:(this.rowCount??0)-1}}:{start:{col:0,row:0},end:{col:(this.colCount??0)-1,row:this._headerCellIds.length-1}}}getCornerHeaderRange(){}getBodyRange(){return this.transpose?{start:{col:this.headerLevelCount,row:0},end:{col:(this.colCount??0)-1,row:(this.rowCount??0)-1}}:{start:{col:0,row:this.headerLevelCount},end:{col:(this.colCount??0)-1,row:(this.rowCount??0)-1}}}get headerLevelCount(){return this.showHeader?this._headerCellIds.length:0}get columnHeaderLevelCount(){return this.transpose?0:this.headerLevelCount}get rowHeaderLevelCount(){return this.transpose?this.headerLevelCount:0}get frozenColCount(){return this._table.internalProps.frozenColCount?this.colCount>this._table.internalProps.frozenColCount?this._table.internalProps.frozenColCount:this.colCount:0}get frozenRowCount(){return this._table.internalProps.frozenRowCount?this.rowCount>=this._table.internalProps.frozenRowCount?this._table.internalProps.frozenRowCount:this.rowCount:0}get bottomFrozenRowCount(){return this._table.internalProps.bottomFrozenRowCount?this.rowCount-this.headerLevelCount>=this._table.internalProps.bottomFrozenRowCount?this._table.internalProps.bottomFrozenRowCount:this.rowCount-this.headerLevelCount:0}get rightFrozenColCount(){return this._table.internalProps.rightFrozenColCount?this.colCount-this.frozenColCount>=this._table.internalProps.rightFrozenColCount?this._table.internalProps.rightFrozenColCount:Math.max(0,this.colCount-this.frozenColCount):0}get colCount(){return this.transpose?this.headerLevelCount+this.recordsCount+this.leftRowSeriesNumberColumnCount+this.rightRowSeriesNumberColumnCount:this._columns.length+this.leftRowSeriesNumberColumnCount+this.rightRowSeriesNumberColumnCount}get rowCount(){return this.transpose?this._columns.length:this.headerLevelCount+this.recordsCount}get bodyRowCount(){return this.transpose?this._columns.length:this.rowCount-this.bottomFrozenRowCount-this.headerLevelCount}get bodyColCount(){return this.transpose?this.colCount-this.rightFrozenColCount-this.rowHeaderLevelCount:this._columns.length}get recordsCount(){return this._recordsCount}set recordsCount(t){this._recordsCount=t}get headerObjects(){return this._headerObjects}get columnObjects(){return this._columns}get columnWidths(){if(this.leftRowSeriesNumberColumnCount){const t=this.leftRowSeriesNumberColumn.map((t=>({width:t.width,minWidth:t.minWidth,maxWidth:t.maxWidth})));return t.push(...this._columns.map((t=>({width:t.width,minWidth:t.minWidth,maxWidth:t.maxWidth})))),t}return this._columns.map((t=>({width:t.width,minWidth:t.minWidth,maxWidth:t.maxWidth})))}getColumnWidthDefined(t){if(t>=0){if(t<this.leftRowSeriesNumberColumnCount)return this.leftRowSeriesNumberColumn[t];if(this.transpose){let e,i,r=0;if(t>=this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount){let t;return this.columnObjects.forEach(((o,n)=>{"number"==typeof o.width?r=Math.max(o.width,r):"auto"===o.width&&(t=!0),"number"==typeof o.minWidth&&(i=Math.max(o.minWidth,i)),"number"==typeof o.maxWidth&&(e=Math.max(o.maxWidth,e))})),r=r>0?r:t?"auto":void 0,{width:r,minWidth:i,maxWidth:e}}if(this.isRowHeader(t,0)){const e=Array.isArray(this._table.defaultHeaderColWidth)?this._table.defaultHeaderColWidth[t]??this._table.defaultColWidth:this._table.defaultHeaderColWidth;return"auto"===e?{width:"auto"}:{width:e}}}return this._columns[t-this.leftRowSeriesNumberColumnCount]}}getCellId(t,e){return this.transpose?t>=this.headerLevelCount+this.leftRowSeriesNumberColumnCount?this._columns[e]?.id:this.isSeriesNumber(t,e)?e+"_series_number":this._headerCellIds[t-this.leftRowSeriesNumberColumnCount]?.[e]:this.isSeriesNumber(t,e)?this.rowSeriesNumberColumn[t].id:this.headerLevelCount<=e?this._columns[t-this.leftRowSeriesNumberColumnCount]?.id:this._headerCellIds[e]?.[t-this.leftRowSeriesNumberColumnCount]}getHeader(t,e){if(this.isSeriesNumberInHeader(t,e))return this.getSeriesNumberHeader(t,e);const i=this.getCellId(t,e);return this._headerObjectMap[i]}getHeaderField(t,e){const i=this.getCellId(t,e);return this._headerObjectMap[i]?.field||(this.transpose?this._columns[e]&&this._columns[e].field:this._columns[t-this.leftRowSeriesNumberColumnCount]&&this._columns[t-this.leftRowSeriesNumberColumnCount].field)}getHeaderCellAdressById(t){for(let e=0;e<this._headerCellIds.length;e++){const i=this._headerCellIds[e];for(let r=0;r<i.length;r++)if(i[r]===t)return this.transpose?{col:e,row:r}:{col:r+this.leftRowSeriesNumberColumnCount,row:e}}}getHeaderCellAddressByField(t){const e=this.headerObjects.find((e=>e&&e.field===t));return this.getHeaderCellAdressById(e.id)}getBody(t,e){return this.isSeriesNumber(t,e)?this.getSeriesNumberBody(t,e):this.transpose?this._columns[e]:this._columns[t-this.leftRowSeriesNumberColumnCount]}getBodyLayoutRangeById(t){if(this.transpose){for(let e=0;e<(this.rowCount??0);e++)if(t===this._columns[e].id)return{start:{col:0,row:e},end:{col:0,row:e}}}else for(let e=0;e<(this.colCount??0);e++)if(t===this._columns[e-this.leftRowSeriesNumberColumnCount].id)return{start:{col:e,row:0},end:{col:e,row:0}};throw new Error(`can not found body layout @id=${t}`)}getCellRange(t,e){if(-1===t||-1===e)return{start:{col:t,row:e},end:{col:t,row:e}};if(this._cellRangeMap.has(`$${t}$${e}`))return this._cellRangeMap.get(`$${t}$${e}`);let i={start:{col:t,row:e},end:{col:t,row:e}};if(this.transpose)i=this.getCellRangeTranspose(t,e);else if(this.headerLevelCount<=e){if(this.headerLevelCount<=e&&this.columnObjects[t-this.leftRowSeriesNumberColumnCount]?.define?.mergeCell){const r=this._table.getCellValue(t,e);for(let o=e-1;o>=this.headerLevelCount;o--){const e=this._table.getCellValue(t,o);if("boolean"==typeof this.columnObjects[t-this.leftRowSeriesNumberColumnCount].define.mergeCell){if(r!==e)break}else if(!this.columnObjects[t-this.leftRowSeriesNumberColumnCount].define.mergeCell(r,e))break;i.start.row=o}for(let o=e+1;o<this.rowCount;o++){const e=this._table.getCellValue(t,o);if("boolean"==typeof this.columnObjects[t-this.leftRowSeriesNumberColumnCount].define.mergeCell){if(r!==e)break}else if(!this.columnObjects[t-this.leftRowSeriesNumberColumnCount].define.mergeCell(r,e))break;i.end.row=o}}}else{const r=this.getCellId(t,e);for(let o=t-1;o>=0&&r===this.getCellId(o,e);o--)i.start.col=o;for(let o=t+1;o<(this.colCount??0)&&r===this.getCellId(o,e);o++)i.end.col=o;for(let o=e-1;o>=0&&r===this.getCellId(t,o);o--)i.start.row=o;for(let o=e+1;o<this.headerLevelCount&&r===this.getCellId(t,o);o++)i.end.row=o}return this._cellRangeMap.set(`$${t}$${e}`,i),i}getCellRangeTranspose(t,e){const i={start:{col:t,row:e},end:{col:t,row:e}};if(this.headerLevelCount+this.leftRowSeriesNumberColumnCount<=t||-1===t&&-1===e){if(this.headerLevelCount+this.leftRowSeriesNumberColumnCount<=t&&this.columnObjects[e]?.define?.mergeCell){const r=this._table.getCellValue(t,e);for(let o=t-1;o>=this.headerLevelCount+this.leftRowSeriesNumberColumnCount;o--){const t=this._table.getCellValue(o,e);if("boolean"==typeof this.columnObjects[e].define.mergeCell){if(r!==t)break}else if(!this.columnObjects[e].define.mergeCell(r,t))break;i.start.col=o}for(let o=t+1;o<(this.colCount??0);o++){const t=this._table.getCellValue(o,e);if("boolean"==typeof this.columnObjects[e].define.mergeCell){if(r!==t)break}else if(!this.columnObjects[e].define.mergeCell(r,t))break;i.end.col=o}}return i}const r=this.getCellId(t,e);for(let o=e-1;o>=0&&r===this.getCellId(t,o);o--)i.start.row=o;for(let o=e+1;o<(this.rowCount??0)&&r===this.getCellId(t,o);o++)i.end.row=o;for(let o=t-1;o>=0&&r===this.getCellId(o,e);o--)i.start.col=o;for(let o=t+1;o<this.headerLevelCount+this.leftRowSeriesNumberColumnCount&&r===this.getCellId(o,e);o++)i.end.col=o;return i}isCellRangeEqual(t,e,i,r){const o=this.getCellRange(t,e),n=this.getCellRange(i,r);return o.start.col===n.start.col&&o.end.col===n.end.col&&o.start.row===n.start.row&&o.end.row===n.end.row}getRecordShowIndexByCell(t,e){const i=this.hasAggregationOnTopCount?this.headerLevelCount+1:this.headerLevelCount;return this.transpose?t<i?-1:t-i:e<i?-1:e-i}getRecordStartRowByRecordIndex(t){return(this.hasAggregationOnTopCount?this.headerLevelCount+1:this.headerLevelCount)+t}_addHeaders(t,e,i,r){const o=[],n=this._newRow(t,r);return e.forEach((e=>{const s=this._columns.length,a=this.seqId++,l={id:a,title:e.title??e.caption,headerIcon:e.headerIcon,field:e.field,style:e.headerStyle,headerType:e.headerType??"text",dropDownMenu:e.dropDownMenu,define:e,columnWidthComputeMode:e.columnWidthComputeMode};o[a]=l;for(let e=t-1;e>=0;e--)this._headerCellIds[e]&&(this._headerCellIds[e][s]=i[e]);if(r?this._headerCellIds[t-1]&&(n[s]=this._headerCellIds[t-1][s]):n[s]=a,e.columns)this._addHeaders(t+1,e.columns,[...i,a],e.hideColumnsSubHeader||r).forEach((t=>o.push(t)));else{const i=e;this._columns.push({id:this.seqId++,field:i.field,fieldFormat:i.fieldFormat,width:i.width,minWidth:i.minWidth,maxWidth:i.maxWidth,icon:i.icon,cellType:i.cellType??i.columnType??"text",chartModule:"chartModule"in i?i.chartModule:null,chartSpec:"chartSpec"in i?i.chartSpec:null,sparklineSpec:"sparklineSpec"in i?i.sparklineSpec:Dw,style:i.style,define:i,columnWidthComputeMode:i.columnWidthComputeMode,disableColumnResize:i?.disableColumnResize,aggregation:this._getAggregationForColumn(i,s),isChildNode:t>=1});for(let e=t+1;e<this._headerCellIds.length;e++)this._headerCellIds[e][s]=a}})),o}_getAggregationForColumn(t,e){let i;return t.aggregation?i=t.aggregation:this._table.options.aggregation&&(i="function"==typeof this._table.options.aggregation?this._table.options.aggregation({col:e,field:t.field}):this._table.options.aggregation),i?Array.isArray(i)?i.map((t=>(Y(t.showOnTop)||(t.showOnTop=!1),t))):Object.assign({showOnTop:!1},i):null}_newRow(t,e=!1){if(this._headerCellIds[t]){const e=this._headerCellIds[t-1];if(e.length>this._headerCellIds[t].length)for(let i=this._headerCellIds[t].length;i<e.length;i++)this._headerCellIds[t][i]=e[i];return this._headerCellIds[t]}if(e)return[];const i=this._headerCellIds[t]=[];if(!this._columns.length)return i;const r=this._headerCellIds[t-1];for(let t=0;t<r.length;t++)i[t]=r[t];return i}getCellHeaderPaths(t,e){if(this.isSeriesNumber(t,e))return;let i=[],r=[];return this.transpose?r=[{field:this._columns[e].field}]:i=[{field:this._columns[t-this.leftRowSeriesNumberColumnCount].field}],{colHeaderPaths:i,rowHeaderPaths:r,cellLocation:this.getCellLocation(t,e)}}getParentCellId(t,e){if(0!==e){if(this.isColumnHeader(t,e))return this.getCellId(t,e-1);if(this.isRowHeader(t,e)){if(this.isSeriesNumberInBody(t-1,e))return;return this.getCellId(t-1,e)}}}canMoveHeaderPosition(t,e){if(this.isSeriesNumberInHeader(e.col,e.row)||this.isSeriesNumberInHeader(t.col,t.row))return!1;if(!this.transpose&&this.isSeriesNumberInBody(e.col,e.row)&&this.isSeriesNumberInBody(t.col,t.row))return!0;if(this.transpose&&this.isSeriesNumberInBody(e.col,e.row)&&this.isSeriesNumberInBody(t.col,t.row)&&(this._getColumnDefine(t.col+this.leftRowSeriesNumberColumnCount,t.row).isChildNode&&this._getColumnDefine(e.col+this.leftRowSeriesNumberColumnCount,e.row).isChildNode?(t.col=t.col+this.leftRowSeriesNumberColumnCount+this.rowHeaderLevelCount-1,e.col=e.col+this.leftRowSeriesNumberColumnCount+this.rowHeaderLevelCount-1):(t.col=t.col+this.leftRowSeriesNumberColumnCount,e.col=e.col+this.leftRowSeriesNumberColumnCount)),t.col<0||t.row<0||e.col<0||e.row<0)return!1;if("disabled"===this._table.internalProps.frozenColDragHeaderMode&&this._table.isFrozenColumn(e.col))return!1;const i=this.getCellRange(t.col,t.row);if(this.isColumnHeader(t.col,t.row)){return this.getParentCellId(t.col,i.start.row)===this.getParentCellId(e.col,i.start.row)}if(this.isRowHeader(t.col,t.row)){return this.getParentCellId(i.start.col,t.row)===this.getParentCellId(i.start.col,e.row)}return!1}moveHeaderPosition(t,e){if(this.canMoveHeaderPosition(t,e)){let i=this.getCellRange(t.col,t.row);if(this.isColumnHeader(t.col,t.row)){const r=i.end.col-i.start.col+1;let o;const n=this.getCellRange(e.col,i.start.row);if(o=e.col>=t.col?n.end.col-r+1:n.start.col,o===i.start.col)return null;for(let t=0;t<this._headerCellIds.length;t++){const e=this._headerCellIds[t].splice(i.start.col-this.leftRowSeriesNumberColumnCount,r);e.unshift(o-this.leftRowSeriesNumberColumnCount,0),Array.prototype.splice.apply(this._headerCellIds[t],e)}const s=this._columns.splice(i.start.col-this.leftRowSeriesNumberColumnCount,r);return s.unshift(o-this.leftRowSeriesNumberColumnCount,0),Array.prototype.splice.apply(this._columns,s),this.columnTree.movePosition(i.start.row,i.start.col-this.leftRowSeriesNumberColumnCount,o-this.leftRowSeriesNumberColumnCount),this.columnTree.reset(this.columnTree.tree.children,!0),this._cellRangeMap=new Map,{sourceIndex:i.start.col,targetIndex:o,sourceSize:r,targetSize:n.end.col-n.start.col+1,moveType:"column"}}if(this.isRowHeader(t.col,t.row)||this.isSeriesNumberInBody(t.col,t.row)&&this.transpose){this.isSeriesNumberInBody(t.col,t.row)&&(i=this.getCellRange(t.col+this.leftRowSeriesNumberColumnCount,t.row));const r=i.end.row-i.start.row+1;let o;const n=this.getCellRange(i.start.col,e.row);if(o=e.row>=t.row?n.end.row-r+1:n.start.row,o===i.start.row)return null;for(let t=0;t<this._headerCellIds.length;t++){const e=this._headerCellIds[t].splice(i.start.row,r);e.unshift(o,0),Array.prototype.splice.apply(this._headerCellIds[t],e)}const s=this._columns.splice(i.start.row,r);return s.unshift(o,0),Array.prototype.splice.apply(this._columns,s),this.columnTree.movePosition(i.start.col-this.leftRowSeriesNumberColumnCount,i.start.row,o+(e.row>t.row?i.end.row-i.start.row:0)),this.columnTree.reset(this.columnTree.tree.children,!0),this._cellRangeMap=new Map,{sourceIndex:i.start.row,targetIndex:o,sourceSize:r,targetSize:n.end.row-n.start.row+1,moveType:"row"}}if(this.isSeriesNumberInBody(t.col,t.row))return{sourceIndex:t.row,targetIndex:e.row,sourceSize:1,targetSize:1,moveType:"row"}}return null}toggleHierarchyState(t){const e=t.add.map((t=>({col:0,row:this._table.frozenRowCount+t}))),i=t.remove.map((t=>({col:0,row:this._table.frozenRowCount+t})));return{addCellPositions:e,removeCellPositions:i}}setChartInstance(t,e,i){const r=this.transpose?this._columns[e]:this._columns[t-this.leftRowSeriesNumberColumnCount];"function"!=typeof r.chartSpec&&(r.chartInstance=i)}getChartInstance(t,e){return(this.transpose?this._columns[e]:this._columns[t-this.leftRowSeriesNumberColumnCount]).chartInstance}checkHasChart(){return oE(this)}getAxisConfigInPivotChart(t,e){}isEmpty(t,e){return!1}isAxisCell(t,e){return!1}getChartAxes(t,e){return[]}isShareChartSpec(t,e){const i=this.getBody(t,e),r=i?.chartSpec;return"function"!=typeof r}getChartSpec(t,e){return this.getRawChartSpec(t,e)}getRawChartSpec(t,e){const i=this.getBody(t,e),r=i?.chartSpec;if("function"==typeof r){return r({col:t,row:e,dataValue:this._table.getCellOriginValue(t,e)||"",value:this._table.getCellValue(t,e)||"",rect:this._table.getCellRangeRelativeRect(this._table.getCellRange(t,e)),table:this._table})}return r}getChartDataId(t,e){return iE(t,e,this)}release(){const t=this._table._getActiveChartInstance();t?.release(),this.columnObjects.forEach((t=>{t.chartInstance?.release()}))}clearCellRangeMap(){this._cellRangeMap.clear()}updateColumnTitle(t,e,i){const r=this._table.internalProps.layoutMap.getHeader(t,e);r.title=i,r.define.title=i}getColumnByField(t){const e=this.columnObjects?.reduce(((e,i,r)=>(i.field===t&&e.push({col:r,columnDefine:i}),e)),[]);return e}_getColumnDefine(t,e){if(t>=0)return t<this.leftRowSeriesNumberColumnCount?this.leftRowSeriesNumberColumn[t]:this.transpose?this._columns[e]:this._columns[t-this.leftRowSeriesNumberColumnCount]}}class uE{table;_titleOption;isReleased=!1;_titleComponent;_cacheAttrs;constructor(t,e){this.table=e,this._titleOption=t,!1!==t.visible&&(this._titleComponent=this._createOrUpdateTitleComponent(this._getTitleAttrs()))}_createOrUpdateTitleComponent(t){if(this._titleComponent)_t(t,this._cacheAttrs)||this._titleComponent.setAttributes(t);else{const e=new l_(t);e.name="title",this.table.scenegraph.stage.defaultLayer.appendChild(e),this._titleComponent=e}return this._adjustTableSize(this._titleComponent.attribute),this._titleComponent}resize(){if(!this._titleComponent)return;const t=BA(this._titleOption.padding??10),e=this._titleOption.width??Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width)-t[1]-t[3],i=this._titleOption.height??Math.min(this.table.tableNoFrameHeight,this.table.getDrawRange().height)-t[0]-t[2];this._titleComponent.setAttributes({x:this._titleOption.x??"right"===this._titleOption.orient?this.table.tableX+Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width):this.table.tableX,y:this._titleOption.y??"bottom"===this._titleOption.orient?this.table.tableY+this.table.tableNoFrameHeight:this.table.tableY,width:"top"===this._titleOption.orient||"bottom"===this._titleOption.orient?e:this._titleOption.width,height:"left"===this._titleOption.orient||"right"===this._titleOption.orient?i:this._titleOption.height,textStyle:{width:e,...this._titleOption.textStyle},subtextStyle:{width:e,...this._titleOption.subtextStyle}}),this._adjustTableSize(this._titleComponent.attribute)}_adjustTableSize(t){const e=isFinite(this._titleComponent?.AABBBounds.width())?this._titleComponent.AABBBounds.width():0,i=isFinite(this._titleComponent?.AABBBounds.height())?this._titleComponent.AABBBounds.height():0;"left"===this._titleOption.orient?(this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(e),this.table.tableX+=Math.ceil(e)):"top"===this._titleOption.orient?(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(i),this.table.tableY+=Math.ceil(i)):"right"===this._titleOption.orient?this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(e):"bottom"===this._titleOption.orient&&(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(i)),this._cacheAttrs=t,"right"!==this._titleOption.orient&&"bottom"!==this._titleOption.orient||this._titleComponent.setAttributes({x:this._titleOption.x??"right"===this._titleOption.orient?this.table.tableX+this.table.tableNoFrameWidth:this.table.tableX,y:this._titleOption.y??"bottom"===this._titleOption.orient?this.table.tableY+this.table.tableNoFrameHeight:this.table.tableY})}release(){this._titleComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this._titleComponent),this._titleComponent=null,this.isReleased=!0}_getTitleAttrs(){const t=this._titleOption.text||this._titleOption.subtext?10:0,e=BA(this._titleOption.padding??t),i=this._titleOption.width??Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width)-e[1]-e[3],r=this._titleOption.height??Math.min(this.table.tableNoFrameHeight,this.table.getDrawRange().height)-e[0]-e[2];return{text:this._titleOption.text??"",subtext:this._titleOption.subtext??"",x:this._titleOption.x??"right"===this._titleOption.orient?this.table.tableX+Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width):this.table.tableX,y:this._titleOption.y??"bottom"===this._titleOption.orient?this.table.tableY+this.table.tableNoFrameHeight:this.table.tableY,width:"top"===this._titleOption.orient||"bottom"===this._titleOption.orient?i:this._titleOption.width,height:"left"===this._titleOption.orient||"right"===this._titleOption.orient?r:this._titleOption.height,minWidth:this._titleOption.minWidth,maxWidth:this._titleOption.maxWidth,minHeight:this._titleOption.minHeight,maxHeight:this._titleOption.maxHeight,padding:this._titleOption.padding,align:this._titleOption.align??"left",verticalAlign:this._titleOption.verticalAlign??"top",textStyle:{width:i,...this._titleOption.textStyle},subtextStyle:{width:i,...this._titleOption.subtextStyle}}}}class gE{table;editingEditor;editCell;constructor(t){this.table=t,this.bindEvent()}bindEvent(){const t=this.table.internalProps.handler;this.table.on(ww.DBLCLICK_CELL,(t=>{if(!this.table.options.editCellTrigger||"doubleclick"===this.table.options.editCellTrigger){const{col:e,row:i}=t,r=vP(t.federatedEvent),o=this.table.scenegraph.getResizeColAt(r.abstractPos.x,r.abstractPos.y,r.eventArgs?.targetCell);if(this.table._canResizeColumn(o.col,o.row)&&o.col>=0)return;this.startEditCell(e,i)}})),this.table.on(ww.CLICK_CELL,(t=>{if("click"===this.table.options.editCellTrigger){const{col:e,row:i}=t;this.startEditCell(e,i)}})),t.on(this.table.getElement(),"wheel",(t=>{this.completeEdit()})),t.on(this.table.getElement(),"resize",(t=>{(this.table.autoFillWidth||this.table.autoFillHeight)&&this.completeEdit()}))}startEditCell(t,e){const i=this.table.getEditor(t,e);if(i){if(!this.table.isHeader(t,e)){const i=this.table.getCellRange(t,e);if(i.start.col!==i.end.col||i.start.row!==i.end.row)return}if(this.table.internalProps.layoutMap?.isAggregation?.(t,e))return;this.editingEditor||(this.editCell={col:t,row:e}),this.editingEditor=i;const r=this.table.getCellOriginValue(t,e),o=this.table.getCellRangeRelativeRect(this.table.getCellRange(t,e)),n={rect:{left:o.left,top:o.top,width:o.width,height:o.height}};i.beginEditing,i.beginEditing?.(this.table.getElement(),n,r),i.bindSuccessCallback,i.bindSuccessCallback?.((()=>{this.completeEdit()})),i.onStart?.({value:r,endEdit:()=>{this.completeEdit()},referencePosition:n,container:this.table.getElement(),col:t,row:e})}}completeEdit(t){if(!this.editingEditor)return;const e=t?.target,{editingEditor:i}=this;if(e)if(i.targetIsOnEditor){if(i.targetIsOnEditor(e))return}else if(!i.isEditorElement||i.isEditorElement(e))return;if(this.editingEditor.getValue,!this.editingEditor.validateValue||this.editingEditor.validateValue?.()){const t=this.editingEditor.getValue?.();this.table.changeCellValue(this.editCell.col,this.editCell.row,t),this.editingEditor.exit,this.editingEditor.exit?.(),this.editingEditor.onEnd?.(),this.editingEditor=null}}cancelEdit(){this.editingEditor&&(this.editingEditor.exit?.(),this.editingEditor.onEnd?.(),this.editingEditor=null)}}const pE={startInTotal:0,level:0};class fE{sharedVar;colIndex=0;_showHeader=!0;rowDimensionTree;columnDimensionTree;rowTree;columnTree;cornerHeaderObjs;columnHeaderObjs=[];rowHeaderObjs=[];_cornerHeaderCellIds=[];_columnHeaderCellIds=[];_rowHeaderCellIds=[];_rowHeaderCellIds_FULL=[];_columnWidths=[];_columnHeaderLevelCount;_rowHeaderLevelCount;rowsDefine;columnsDefine;indicatorsDefine;columnPaths=[];_headerObjects=[];_headerObjectMap={};_indicators=[];indicatorTitle;indicatorsAsCol=!0;hideIndicatorName=!1;_showRowHeader=!0;_showColumnHeader=!0;_rowHeaderTitle;_columnHeaderTitle;cornerSetting;_indicatorShowType="column";rowHierarchyType;rowExpandLevel;rowHierarchyIndent;rowHierarchyTextStartAlignment=!1;rowDimensionKeys=[];colDimensionKeys=[];indicatorKeys=[];indicatorDimensionKey=Ow;_largeCellRangeCache;_CellHeaderPathMap;_table;extensionRows;_rowHeaderExtensionTree={};_extensionRowDimensionKeys=[];fullRowDimensionKeys=[];dataset;pagination;currentPageStartIndex;currentPageEndIndex;hasTwoIndicatorAxes;_chartItemSpanSize;_chartPaddingInner;_chartPaddingOuter;_chartItemBandSize;_chartPadding;_lastCellCol;_lastCellRow;_lastCellHeaderPath;rowSeriesNumberColumn;leftRowSeriesNumberColumn;leftRowSeriesNumberColumnCount=0;rightRowSeriesNumberColumn;rightRowSeriesNumberColumnCount=0;constructor(t,e){if(this.sharedVar={seqId:0},this._table=t,"tree"===t.options.rowHierarchyType&&(this.extensionRows=t.options.extensionRows),this.dataset=e,this._largeCellRangeCache=[],this._CellHeaderPathMap=new Map,this.rowTree=t.internalProps.rowTree,this.columnTree=t.internalProps.columnTree,this.rowsDefine=t.internalProps.rows??[],this.columnsDefine=t.internalProps.columns??[],this.indicatorsDefine=t.internalProps.indicators??[],this.indicatorTitle=t.options.indicatorTitle,this.indicatorsAsCol=t.options.indicatorsAsCol??!0,this.hideIndicatorName=t.options.hideIndicatorName??!1,this.showRowHeader=t.options.showRowHeader??!0,this.showColumnHeader=t.options.showColumnHeader??!0,this.rowHeaderTitle=t.options.rowHeaderTitle,this.columnHeaderTitle=t.options.columnHeaderTitle,this.rowHierarchyType=t.options.rowHierarchyType??"grid",this.rowExpandLevel=t.options.rowExpandLevel??1,this.rowHierarchyIndent=t.options.rowHierarchyIndent??20,this.rowHierarchyTextStartAlignment=t.options.rowHierarchyTextStartAlignment,this.cornerSetting=t.options.corner??{titleOnDimension:"column"},e&&(this.rowTree=e.rowHeaderTree,this.columnTree=e.colHeaderTree,this.indicatorsAsCol&&this._table.isPivotChart()&&tE(this))){const t=e=>{e.forEach((e=>{e.children?.length?t(e.children):e.children=[{dimensionKey:"axis",value:""}]}))};this.rowTree?.length?t(this.rowTree):this.rowTree=[{dimensionKey:"axis",value:""}]}if(this.indicatorsDefine?.forEach((t=>{"string"==typeof t?this.indicatorKeys.push(t):this.indicatorKeys.push(t.indicatorKey)})),this.columnDimensionTree=new nE(this.columnTree??[],this.sharedVar),this.rowDimensionTree=new nE(this.rowTree??[],this.sharedVar,this.rowHierarchyType,"tree"===this.rowHierarchyType?this.rowExpandLevel:void 0),this.colDimensionKeys=this.columnDimensionTree.dimensionKeys.valueArr(),this.rowDimensionKeys=this.rowDimensionTree.dimensionKeys.valueArr(),this.fullRowDimensionKeys=this.fullRowDimensionKeys.concat(this.rowDimensionKeys),this.resetRowHeaderLevelCount(),this._generateColHeaderIds(),this.colIndex=0,this._generateRowHeaderIds(),this._table.isPivotChart()&&(this.hasTwoIndicatorAxes=this._indicators.some((t=>{if(t.chartSpec&&t.chartSpec.series&&t.chartSpec.series.length>1){const e=t.chartSpec.axes??this._table.pivotChartAxes??[];if(!e.length||e.every((t=>t.orient!==(this.indicatorsAsCol?"top":"right")||!1!==t.visible)))return!0}return!1}))),this.resetColumnHeaderLevelCount(),this._rowHeaderCellIds_FULL=GC(this._rowHeaderCellIds_FULL),"tree"===t.options.rowHierarchyType&&this.extensionRows?.length>=1&&(this.generateExtensionRowTree(),this.extensionRows.forEach((t=>{const e=[];t.rows.forEach((t=>{"string"==typeof t?e.push(t):e.push(t.dimensionKey)})),this._extensionRowDimensionKeys.push(e),this.fullRowDimensionKeys=this.fullRowDimensionKeys.concat(e)}))),this.sharedVar.seqId=Math.max(this.sharedVar.seqId,this._headerObjects.length),"column"===this.cornerSetting.titleOnDimension)this.cornerHeaderObjs=this._addCornerHeaders(this.columnHeaderTitle?[""].concat(this.colDimensionKeys):this.colDimensionKeys,this.columnsDefine);else if("row"===this.cornerSetting.titleOnDimension)if("tree"===this.rowHierarchyType&&this.extensionRows?.length>=1){const t=[];t.push(this.rowDimensionKeys[0]),this._extensionRowDimensionKeys.forEach((e=>{t.push(e[0])}));const e=this.extensionRows.reduce(((t,e)=>t.concat(e.rows)),[]);this.cornerHeaderObjs=this._addCornerHeaders(this.rowHeaderTitle?[""].concat(t):t,this.rowsDefine.concat(e))}else this.cornerHeaderObjs=this._addCornerHeaders(this.rowHeaderTitle?[""].concat(this.rowDimensionKeys):this.rowDimensionKeys,this.rowsDefine);else this.cornerHeaderObjs=this._addCornerHeaders(null,void 0);this.colIndex=0,this._headerObjectMap=this._headerObjects.reduce(((t,e)=>(t[e.id]=e,t)),{}),this.indicatorsAsCol&&!this.hideIndicatorName?this._indicatorShowType="column":this.indicatorsAsCol||this.hideIndicatorName?this._indicatorShowType="none":this._indicatorShowType="row",this.setPagination(t.options.pagination),this._table.isPivotChart()&&(this._chartItemSpanSize=0,this._chartItemBandSize=0,this._indicators.find((t=>{t?.style?.padding&&(this._chartPadding=t.style.padding),t.chartSpec?.barWidth&&"number"==typeof t.chartSpec.barWidth&&(this._chartItemSpanSize=t.chartSpec?.barWidth);const e=t.chartSpec?.axes?.find((t=>"band"===t.type));return e?.bandSize&&(this._chartItemBandSize=e?.bandSize,this._chartPaddingInner=(et(e.paddingInner)?e.paddingInner[0]:e.paddingInner)??0,this._chartPaddingOuter=(et(e.paddingOuter)?e.paddingOuter[0]:e.paddingOuter)??0),this._chartItemSpanSize>0||(t.chartSpec.series?.find((t=>(t.barWidth&&"number"==typeof t.barWidth&&(this._chartItemSpanSize=t.barWidth),this._chartItemSpanSize>0))),!1)}))),this.handleRowSeriesNumber(t.internalProps.rowSeriesNumber),this.setColumnWidths()}handleRowSeriesNumber(t){t&&(Array.isArray(t)?this.rowSeriesNumberColumn=t.map((t=>({id:"",title:t.title,define:t,cellType:t.cellType??"text",width:t.width,style:t.style,format:t.format,field:t.field,icon:t.icon}))):this.rowSeriesNumberColumn=[{id:"",title:t.title,define:t,cellType:t.cellType??"text",style:t.style,width:t.width,format:t.format,field:"",icon:t.icon,isChildNode:!1}],this.leftRowSeriesNumberColumn=this.rowSeriesNumberColumn.filter((t=>!0)),this.rightRowSeriesNumberColumn=this.rowSeriesNumberColumn.filter((t=>!1)),this.leftRowSeriesNumberColumnCount=this.leftRowSeriesNumberColumn.length,this.rightRowSeriesNumberColumnCount=this.rightRowSeriesNumberColumn.length)}_generateColHeaderIds(){if(this.columnDimensionTree.tree.children?.length>=1&&this._addHeaders(this._columnHeaderCellIds,0,this.columnDimensionTree.tree.children,[],this.columnHeaderObjs),this.columnHeaderTitle){this.sharedVar.seqId=Math.max(this.sharedVar.seqId,this._headerObjects.length);const t=++this.sharedVar.seqId,e=Array(this.colCount-this.rowHeaderLevelCount).fill(t);this._columnHeaderCellIds.unshift(e);const i={id:t,title:"string"==typeof this.columnHeaderTitle.title?this.columnHeaderTitle.title:this.columnsDefine.reduce(((t,e)=>"string"==typeof e?t:t+(t?`/${e.title}`:`${e.title}`)),""),field:void 0,headerType:this.columnHeaderTitle?.headerType??"text",style:this.columnHeaderTitle?.headerStyle,define:{id:t,disableHeaderHover:!!this.columnHeaderTitle?.disableHeaderHover,disableHeaderSelect:!!this.columnHeaderTitle?.disableHeaderSelect}};this.columnHeaderObjs.push(i),this._headerObjects[t]=i}}_generateRowHeaderIds(){if(this.rowDimensionTree.tree.children?.length>=1&&("tree"===this.rowHierarchyType?this._addHeadersForTreeMode(this._rowHeaderCellIds_FULL,0,this.rowDimensionTree.tree.children,[],this.rowDimensionTree.totalLevel,!0,this.rowsDefine,this.rowHeaderObjs):this._addHeaders(this._rowHeaderCellIds_FULL,0,this.rowDimensionTree.tree.children,[],this.rowHeaderObjs)),this.rowHeaderTitle){this.sharedVar.seqId=Math.max(this.sharedVar.seqId,this._headerObjects.length);const t=++this.sharedVar.seqId,e=Array(this._rowHeaderCellIds_FULL[0]?.length??this.rowDimensionTree.tree.size).fill(t);this._rowHeaderCellIds_FULL.unshift(e);const i={id:t,title:"string"==typeof this.rowHeaderTitle.title?this.rowHeaderTitle.title:this.rowsDefine.reduce(((t,e)=>"string"==typeof e?t:t+(t?`/${e.title}`:`${e.title}`)),""),field:void 0,headerType:this.rowHeaderTitle?.headerType??"text",style:this.rowHeaderTitle?.headerStyle,define:{id:t,disableHeaderHover:!!this.rowHeaderTitle?.disableHeaderHover,disableHeaderSelect:!!this.rowHeaderTitle?.disableHeaderSelect}};this.rowHeaderObjs.push(i),this._headerObjects[t]=i}}_addHeaders(t,e,i,r,o){const n=this;t[e]||function(e){const i=t[e]=[];if(0===n.colIndex)return i;const r=t[e-1];for(let t=0;t<r?.length;t++)i[t]=r[t]}(e);for(let n=0;n<i.length;n++){lE(i[n],t,o,r,e,this)}}_addHeadersForTreeMode(t,e,i,r,o,n,s,a){const l=this;t[e]||function(e){const i=t[e]=[];if(0===l.colIndex)return i;const r=t[e-1];for(let t=0;t<r?.length;t++)i[t]=r[t]}(e);for(let l=0;l<i.length;l++){hE(i[l],t,a,r,e,o,n,s,this)}}_addCornerHeaders(t,e){const i=[];if(t)t.forEach(((t,r)=>{const o=++this.sharedVar.seqId,n=e.find((e=>"string"!=typeof e&&e.dimensionKey===t)),s={id:o,title:t===this.indicatorDimensionKey?this.indicatorTitle:n?n.title:"axis"===t?"":t,field:"维度名称",style:this.cornerSetting.headerStyle,headerType:this.cornerSetting.headerType??"text",define:{dimensionKey:"维度名称",id:o,value:t,disableHeaderHover:!!this.cornerSetting.disableHeaderHover,disableHeaderSelect:!!this.cornerSetting.disableHeaderSelect},dropDownMenu:n?.cornerDropDownMenu,pivotInfo:{value:n?.title??"",dimensionKey:t,isPivotCorner:!0},description:n?.cornerDescription};if(i[o]=s,this._headerObjects[o]=s,"column"===this.cornerSetting.titleOnDimension){this._cornerHeaderCellIds[r]||(this._cornerHeaderCellIds[r]=[]);for(let t=0;t<this.rowHeaderLevelCount;t++)this._cornerHeaderCellIds[r][t]=o}else if("row"===this.cornerSetting.titleOnDimension)for(let t=0;t<this.columnHeaderLevelCount;t++)this._cornerHeaderCellIds[t]||(this._cornerHeaderCellIds[t]=[]),this._cornerHeaderCellIds[t][r]=o}));else{const t=++this.sharedVar.seqId,e={id:t,title:"",field:"维度名称",style:this.cornerSetting.headerStyle,headerType:this.cornerSetting.headerType??"text",define:{dimensionKey:"维度名称",id:t,value:"",disableHeaderHover:!!this.cornerSetting.disableHeaderHover,disableHeaderSelect:!!this.cornerSetting.disableHeaderSelect}};i[t]=e,this._headerObjects[t]=e;for(let e=0;e<this.columnHeaderLevelCount;e++)for(let i=0;i<this.rowHeaderLevelCount;i++)this._cornerHeaderCellIds[e]||(this._cornerHeaderCellIds[e]=[]),this._cornerHeaderCellIds[e][i]=t}return i}generateExtensionRowTree(){this.extensionRows.forEach(((t,e)=>{const i=this._rowHeaderCellIds_FULL;this._rowHeaderCellIds_FULL=[],i.forEach(((e,i)=>{const r=e[e.length-1];let o,n;if(this.colIndex=0,"function"==typeof t.rowTree){const i=this.findFullCellIds(e);o=t.rowTree(i.map((t=>({dimensionKey:this._headerObjects[t].field,value:this._headerObjects[t].title}))))}else o=mt(t.rowTree);this._rowHeaderExtensionTree[r]?(this._rowHeaderExtensionTree[r].reset(this._rowHeaderExtensionTree[r].tree.children,!0),n=this._rowHeaderExtensionTree[r]):(n=new nE(o??[],this.sharedVar,this.rowHierarchyType,void 0),this._rowHeaderExtensionTree[r]=n);const s=[];this._addHeadersForTreeMode(s,0,n.tree.children,[],n.totalLevel,!0,t.rows,this.rowHeaderObjs);for(let t=0;t<s[0].length;t++)this._rowHeaderCellIds_FULL.push(e.concat(s[0][t]))}))}))}setColumnWidths(){const t=new Array(this.colCount).fill(void 0);if(this.leftRowSeriesNumberColumnCount&&(t[0]=this.leftRowSeriesNumberColumn[0]),this.showHeader&&this.showRowHeader)if(this.rowHeaderTitle&&(t[0+this.leftRowSeriesNumberColumnCount]={}),"tree"===this.rowHierarchyType){const e=this.rowDimensionKeys[0];if(e){const i=this.rowsDefine?.find((t=>"string"!=typeof t&&t.dimensionKey===e));i&&(t[0+(this.rowHeaderTitle?1:0)+this.leftRowSeriesNumberColumnCount]={width:i.width,minWidth:i.minWidth,maxWidth:i.maxWidth})}this._extensionRowDimensionKeys?.forEach(((e,i)=>{const r=e[0];if(r){const e=this.extensionRows[i].rows?.find((t=>"string"!=typeof t&&t.dimensionKey===r));e&&(t[i+1+(this.rowHeaderTitle?1:0)+this.leftRowSeriesNumberColumnCount]={width:e.width,minWidth:e.minWidth,maxWidth:e.maxWidth})}}))}else this.rowDimensionKeys.forEach(((e,i)=>{const r=this.rowsDefine?.find((t=>"string"!=typeof t&&t.dimensionKey===e));r&&(t[i+(this.rowHeaderTitle?1:0)+this.leftRowSeriesNumberColumnCount]={width:r.width,minWidth:r.minWidth,maxWidth:r.maxWidth})}));if(this.indicatorsAsCol)for(let e=this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount;e<this.colCount;e++){const i=this.getBody(e,this.columnHeaderLevelCount);t[e]={width:i?.width,minWidth:i?.minWidth,maxWidth:i?.maxWidth}}else{let e,i,r,o=0;this._indicators?.forEach(((t,n)=>{"number"==typeof t.width?o=Math.max(t.width,o):"auto"===t.width&&(r=!0),"number"==typeof t.minWidth&&(i=Math.max(t.minWidth,i??0)),"number"==typeof t.maxWidth&&(e=Math.min(t.maxWidth,e??Number.MAX_VALUE))})),o=o>0?o:r?"auto":void 0,t.fill({width:o,minWidth:i,maxWidth:e},this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount,this.colCount-this.rightFrozenColCount)}this._columnWidths=t}get columnWidths(){return this._columnWidths}getColumnWidthDefined(t){return this._columnWidths[t]}get showHeader(){return this._showHeader}set showHeader(t){this._showHeader=t}get showColumnHeader(){return this._showColumnHeader}set showColumnHeader(t){this._showColumnHeader=t}get showRowHeader(){return this._showRowHeader}set showRowHeader(t){this._showRowHeader=t}get columnHeaderTitle(){return this._columnHeaderTitle}set columnHeaderTitle(t){this._columnHeaderTitle=t}get rowHeaderTitle(){return this._rowHeaderTitle}set rowHeaderTitle(t){this._rowHeaderTitle=t}getHeaderFieldKey(t,e){}getCellLocation(t,e){return this.isCornerHeader(t,e)?"cornerHeader":this.isColumnHeader(t,e)?"columnHeader":this.isRowHeader(t,e)?"rowHeader":"body"}isHeader(t,e){return t>=this.leftRowSeriesNumberColumnCount&&t<this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount||(e>=0&&e<this.columnHeaderLevelCount||(t>=this.colCount-this.rightHeaderColCount||e>=this.rowCount-this.bottomHeaderRowCount))}isCornerHeader(t,e){return t>=0&&t<this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount&&e>=0&&e<this.columnHeaderLevelCount}isColumnHeader(t,e){return t>=this.rowHeaderLevelCount&&e>=0&&e<this.columnHeaderLevelCount}isRowHeader(t,e){return t>=this.leftRowSeriesNumberColumnCount&&t<this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount&&e>=this.columnHeaderLevelCount}isFrozen(t,e){return this.isFrozenColumn(t)||this.isRightFrozenColumn(t)||this.isBottomFrozenRow(e)||this.isFrozenRow(e)||this.isSeriesNumberInBody(t,e)||this.isSeriesNumberInHeader(t,e)}isFrozenColumn(t,e){if(Y(e)){if(t>=0&&t<this.frozenColCount&&e>=this.frozenRowCount&&e<this.rowCount-this.bottomFrozenRowCount)return!0}else if(this.frozenColCount>0&&t>=0&&t<this.frozenColCount)return!0;return!1}isRightFrozenColumn(t,e){if(Y(e)){if(t>=this.colCount-this.rightFrozenColCount&&e>=this.frozenRowCount&&e<this.rowCount-this.bottomFrozenRowCount)return!0}else if(this.rightFrozenColCount>0&&t>=this.colCount-this.rightFrozenColCount)return!0;return!1}isFrozenRow(t,e){if(Y(e)){if(e>=0&&e<this.frozenRowCount&&t>=this.frozenColCount&&t<this.colCount-this.rightFrozenColCount)return!0}else if(e=t,this.frozenRowCount>0&&e>=0&&e<this.frozenRowCount)return!0;return!1}isBottomFrozenRow(t,e){if(Y(e)){if(e>=this.rowCount-this.bottomFrozenRowCount&&t>=this.frozenColCount&&t<this.colCount-this.rightFrozenColCount)return!0}else if(e=t,this.bottomFrozenRowCount>0&&e>=this.rowCount-this.bottomFrozenRowCount)return!0;return!1}isLeftBottomCorner(t,e){return t>=0&&t<this.rowHeaderLevelCount&&e>=this.rowCount-this.bottomFrozenRowCount}isRightTopCorner(t,e){return t>=this.colCount-this.rightFrozenColCount&&e>=0&&e<this.columnHeaderLevelCount}isRightBottomCorner(t,e){return t>=this.colCount-this.rightFrozenColCount&&e>=this.rowCount-this.bottomFrozenRowCount}getColumnHeaderRange(){return{start:{col:this.rowHeaderLevelCount,row:0},end:{col:this.colCount-1,row:this.columnHeaderLevelCount-1}}}getRowHeaderRange(){return{start:{col:0,row:this.columnHeaderLevelCount},end:{col:this.rowHeaderLevelCount-1,row:this.rowCount-1}}}getCornerHeaderRange(){return{start:{col:0,row:0},end:{col:this.rowHeaderLevelCount-1,row:this.columnHeaderLevelCount-1}}}getBodyRange(){return{start:{col:this.rowHeaderLevelCount,row:this.columnHeaderLevelCount},end:{col:this.colCount-1,row:this.rowCount-1}}}resetCellIds(){}get frozenColCount(){return this._table.internalProps.frozenColCount?this.colCount>this._table.internalProps.frozenColCount?this._table.internalProps.frozenColCount:this.colCount:0}get frozenRowCount(){return this._table.internalProps.frozenRowCount?this.rowCount>=this._table.internalProps.frozenRowCount?this._table.internalProps.frozenRowCount:this.rowCount:0}get headerLevelCount(){return this.columnHeaderLevelCount}resetColumnHeaderLevelCount(){if(this.showHeader&&this.showColumnHeader){if(this._table.isPivotChart()&&this.indicatorsAsCol&&!this.dataset?.colKeys?.length&&!this.hasTwoIndicatorAxes)return void(this.columnHeaderLevelCount=0);let t=this.indicatorsAsCol&&this.hideIndicatorName&&this.colDimensionKeys[this.colDimensionKeys.length-1]===this.indicatorDimensionKey?this.columnDimensionTree.totalLevel-1:this.columnDimensionTree.totalLevel;return this.columnHeaderTitle&&(t+=1),this._table.isPivotChart()&&this.indicatorsAsCol&&!this.hasTwoIndicatorAxes&&tE(this)&&(t-=1),void(this.columnHeaderLevelCount=t)}this.columnHeaderLevelCount=0}resetRowHeaderLevelCount(){if(this.showHeader&&this.showRowHeader){if("tree"===this.rowHierarchyType){const t=this.extensionRows?.length??0;return this.rowHeaderTitle?void(this.rowHeaderLevelCount=2+t):void(this.rowHeaderLevelCount=1+t)}const t=this.rowDimensionKeys.length;let e=t;return this.indicatorsAsCol||this.hideIndicatorName&&this.rowDimensionKeys[this.rowDimensionKeys.length-1]===this.indicatorDimensionKey&&(e=t-1),this.rowHeaderTitle&&(e+=1),void(this.rowHeaderLevelCount=e)}this.rowHeaderLevelCount=this.indicatorsAsCol||this.hideIndicatorName?0:1}get columnHeaderLevelCount(){return this._columnHeaderLevelCount}set columnHeaderLevelCount(t){this._columnHeaderLevelCount=t}get rowHeaderLevelCount(){return this._rowHeaderLevelCount}set rowHeaderLevelCount(t){this._rowHeaderLevelCount=t}get colCount(){return this.columnDimensionTree.tree.size+this.rowHeaderLevelCount+this.rightHeaderColCount+this.leftRowSeriesNumberColumnCount}get rowCount(){return((!Array.isArray(this._table.records)||this._table.records.length>0)&&this._indicators?.length>0&&!this._rowHeaderCellIds?.length?1:this._rowHeaderCellIds?.length??0)+this.columnHeaderLevelCount+this.bottomHeaderRowCount}get bodyRowSpanCount(){return this.rowDimensionTree.tree.size}get bottomFrozenRowCount(){if(!this._table.isPivotChart())return this._table.internalProps.bottomFrozenRowCount?this.rowCount-this.headerLevelCount>=this._table.internalProps.bottomFrozenRowCount?this._table.internalProps.bottomFrozenRowCount:this.rowCount-this.headerLevelCount:0;if(this.indicatorKeys.length>=1&&tE(this)){const t=this._table.pivotChartAxes.find((t=>"bottom"===t.orient));return!1===t?.visible?0:(this.indicatorsAsCol,1)}return 0}get rightFrozenColCount(){if(!this._table.isPivotChart())return this._table.internalProps.rightFrozenColCount?this.colCount-this.rowHeaderLevelCount>=this._table.internalProps.rightFrozenColCount?this._table.internalProps.rightFrozenColCount:this.colCount-this.rowHeaderLevelCount:0;const t=this._table.pivotChartAxes.find((t=>"right"===t.orient));return!1===t?.visible||this.indicatorsAsCol?0:this.hasTwoIndicatorAxes?1:0}get bodyRowCount(){return this.rowCount-this.bottomFrozenRowCount-this.headerLevelCount}get bodyColCount(){return this.colCount-this.rightFrozenColCount-this.rowHeaderLevelCount}get headerObjects(){return this._headerObjects}get columnObjects(){return this._indicators}getCellId(t,e){if(e>=0&&t>=0){if(this.isSeriesNumber(t,e))return"";if(this.isCornerHeader(t,e))return this._cornerHeaderCellIds[e][t-this.leftRowSeriesNumberColumnCount];if(this.isColumnHeader(t,e))return this._columnHeaderCellIds[e][t-this.rowHeaderLevelCount-this.leftRowSeriesNumberColumnCount];if(this.isRowHeader(t,e))return this._rowHeaderCellIds[e-this.columnHeaderLevelCount]?.[t-this.leftRowSeriesNumberColumnCount];if(this.isRightFrozenColumn(t,e))return this._rowHeaderCellIds[e-this.columnHeaderLevelCount][this.rowHeaderLevelCount-1];if(this.isBottomFrozenRow(t,e))return this._columnHeaderCellIds[this.columnHeaderLevelCount-1]?.[t-this.rowHeaderLevelCount-this.leftRowSeriesNumberColumnCount]}}getHeader(t,e){if(this.isSeriesNumberInHeader(t,e))return this.getSeriesNumberHeader(t,e);const i=this.getCellId(t,e);return this._headerObjectMap[i]??{id:void 0,field:"",headerType:"text",define:void 0}}getHeaderField(t,e){const i=this.getCellId(t,e);return this._headerObjectMap[i]?.field||this.getBody(t,e)?.field}getHeaderCellAdressById(t){for(let e=0;e<this._columnHeaderCellIds.length;e++){const i=this._columnHeaderCellIds[e];for(let r=0;r<i.length;r++)if(i[r]===t)return{col:r+this._table.frozenColCount,row:e}}for(let e=0;e<this._rowHeaderCellIds.length;e++){const i=this._rowHeaderCellIds[e];for(let r=0;r<i.length;r++)if(i[r]===t)return{col:r,row:e+this._table.frozenRowCount}}for(let e=0;e<this._cornerHeaderCellIds.length;e++){const i=this._cornerHeaderCellIds[e];for(let r=0;r<i.length;r++)if(i[r]===t)return{col:r,row:e}}}getHeaderCellAddressByField(t){const e=this.headerObjects.find((e=>e&&e.field===t));return this.getHeaderCellAdressById(e.id)}getBody(t,e){if(this.isSeriesNumber(t,e))return this.getSeriesNumberBody(t,e);const i=this.getCellHeaderPaths(t,e);if(this.indicatorsAsCol){const t=i.colHeaderPaths?.find((t=>t.indicatorKey))?.indicatorKey;return this._indicators?.find((e=>e.indicatorKey===t))??this._indicators[0]??{id:"",field:void 0,indicatorKey:void 0,cellType:"text",define:void 0}}const r=i.rowHeaderPaths?.find((t=>t.indicatorKey))?.indicatorKey;return this._indicators?.find((t=>t.indicatorKey===r))??this._indicators[0]??{id:"",field:void 0,indicatorKey:void 0,cellType:"text",define:void 0}}getCellRange(t,e){const i={start:{col:t,row:e},end:{col:t,row:e}};if(!this.isHeader(t,e)||-1===t||-1===e)return i;if(this.isRightFrozenColumn(t,e)||this.isBottomFrozenRow(t,e))return i;if(this._table.isPivotChart()){if(this.isLeftBottomCorner(t,e))return{start:{col:0,row:this.rowCount-this.bottomFrozenRowCount},end:{col:this.frozenColCount-1,row:this.rowCount-1}};if(this.isRightTopCorner(t,e))return{start:{col:this.colCount-this.rightFrozenColCount,row:0},end:{col:this.colCount-1,row:this.frozenRowCount-1}};if(this.isRightBottomCorner(t,e))return{start:{col:this.colCount-this.rightFrozenColCount,row:this.rowCount-this.bottomFrozenRowCount},end:{col:this.colCount-1,row:this.rowCount-1}}}for(let i=0;i<this._largeCellRangeCache.length;i++){const r=this._largeCellRangeCache[i];if(t>=r.start.col&&t<=r.end.col&&e>=r.start.row&&e<=r.end.row)return r}if(this.isHeader(t,e)&&-1!==t&&-1!==e){const r=this.getCellId(t,e);for(let o=t-1;o>=0&&r===this.getCellId(o,e);o--)i.start.col=o;for(let o=t+1;o<(this.colCount??0)&&r===this.getCellId(o,e);o++)i.end.col=o;for(let o=e-1;o>=0&&r===this.getCellId(t,o);o--)i.start.row=o;for(let o=e+1;o<(this.rowCount??0)&&!(r!==this.getCellId(t,o)||this.isSeriesNumberInHeader(t,e)&&o>=this.columnHeaderLevelCount);o++)i.end.row=o}return(i.end.col-i.start.col>100||i.end.row-i.start.row>100)&&this._largeCellRangeCache.push(i),i}isCellRangeEqual(t,e,i,r){const o=this.getCellRange(t,e),n=this.getCellRange(i,r);return o.start.col===n.start.col&&o.end.col===n.end.col&&o.start.row===n.start.row&&o.end.row===n.end.row}getBodyIndexByRow(t){return t<this.columnHeaderLevelCount||t>=this.rowCount-this.bottomHeaderRowCount?-1:t-this.columnHeaderLevelCount}get bottomHeaderRowCount(){return this._table.isPivotChart()?this.bottomFrozenRowCount:0}get rightHeaderColCount(){return this._table.isPivotChart()?this.rightFrozenColCount:0}getBodyIndexByCol(t){return t<this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount||t>=this.colCount-this.rightHeaderColCount?-1:t-this.rowHeaderLevelCount-this.leftRowSeriesNumberColumnCount}getRecordStartRowByRecordIndex(t){return this.columnHeaderLevelCount+t}getRecordShowIndexByCell(t,e){}getCellHeaderPathsWidthTreeNode(t,e){if(t===this._lastCellCol&&e===this._lastCellRow)return this._lastCellHeaderPath;for(let i=0;i<this._largeCellRangeCache.length;i++){const r=this._largeCellRangeCache[i];if(t>=r.start.col&&t<=r.end.col&&e>=r.start.row&&e<=r.end.row)break}const i=this.getBodyIndexByCol(t),r=this.getBodyIndexByRow(e)+this.currentPageStartIndex;let o=[],n=[];if(e>=0&&i>=0&&(o=this.columnDimensionTree.getTreePath(i,this.showHeader&&this.showColumnHeader?e-(this.columnHeaderTitle?1:0):this.columnDimensionTree.totalLevel)),t>=0&&r>=0)if("tree"===this.rowHierarchyType){const t=this._rowHeaderCellIds[r];let e=this.rowDimensionTree,i=0;for(;e;){const r=[];let o=t[i];for(r.push(o);;){const t=this._headerObjectMap[o];if(!t?.parentCellId)break;r.unshift(t.parentCellId),o=t.parentCellId}const s=e.getTreePathByCellIds(r);n=n.concat(s),e=this._rowHeaderExtensionTree[t[i]],i++}}else n=this.rowDimensionTree.getTreePath(r,this.showHeader&&this.showRowHeader?t-(this.rowHeaderTitle?1:0)-this.leftRowSeriesNumberColumnCount:this.rowDimensionTree.totalLevel);const s={colHeaderPaths:o,rowHeaderPaths:n,cellLocation:this.getCellLocation(t,e)};return this._lastCellHeaderPath=s,this._lastCellCol=t,this._lastCellRow=e,s}getCellHeaderPaths(t,e){const i=this.getCellHeaderPathsWidthTreeNode(t,e),r={colHeaderPaths:[],rowHeaderPaths:[],cellLocation:i.cellLocation};return i.colHeaderPaths?.forEach((t=>{const e={};e.dimensionKey=t.dimensionKey,e.indicatorKey=t.indicatorKey,e.value=t.value??this.getIndicatorInfoByIndicatorKey(t.indicatorKey)?.title??"",r.colHeaderPaths.push(e)})),i.rowHeaderPaths?.forEach((t=>{if("axis"!==t.dimensionKey){const e={};e.dimensionKey=t.dimensionKey,e.indicatorKey=t.indicatorKey,e.value=t.value??this.getIndicatorInfoByIndicatorKey(t.indicatorKey)?.title??"",r.rowHeaderPaths.push(e)}})),r}getIndicatorInfoByIndicatorKey(t){const e=this.indicatorsDefine?.find((e=>"string"!=typeof e&&(!!t&&e.indicatorKey===t)));return e}findFullCellIds(t){const e=[];for(let i=0;i<t.length;i++){let r=t[i];for(e.push(r);;){const t=this._headerObjectMap[r];if(!t?.parentCellId)break;e.unshift(t.parentCellId),r=t.parentCellId}}return e}getHeaderDimension(t,e){if(this.isHeader(t,e)){const i=this.getHeader(t,e);return this.rowsDefine?.find((t=>"string"!=typeof t&&t.dimensionKey===i.field))??this.columnsDefine?.find((t=>"string"!=typeof t&&t.dimensionKey===i.field))}}isColumnIndicatorHeader(t,e){return"column"===this._indicatorShowType&&e===this.columnHeaderLevelCount-1&&t>=this.rowHeaderLevelCount}isRowIndicatorHeader(t,e){return"row"===this._indicatorShowType&&t===this.rowHeaderLevelCount-1&&e>=this.columnHeaderLevelCount}isIndicatorHeader(t,e){return this.isColumnIndicatorHeader(t,e)||this.isRowIndicatorHeader(t,e)}toggleHierarchyState(t,e){const i=this._rowHeaderCellIds_FULL.slice(0),r=i.map(((e,i)=>({col:t,row:i+this.columnHeaderLevelCount}))),o=this.getHeader(t,e);if(o.define.hierarchyState=o.define.hierarchyState===oC.collapse?oC.expand:oC.collapse,this.rowDimensionTree.reset(this.rowDimensionTree.tree.children,!0),this._rowHeaderCellIds_FULL=[],this.rowDimensionKeys=this.rowDimensionTree.dimensionKeys.valueArr(),this.fullRowDimensionKeys=[],this.fullRowDimensionKeys=this.fullRowDimensionKeys.concat(this.rowDimensionKeys),this._addHeadersForTreeMode(this._rowHeaderCellIds_FULL,0,this.rowDimensionTree.tree.children,[],this.rowDimensionTree.totalLevel,!0,this.rowsDefine,this.rowHeaderObjs),this.rowHeaderTitle){const t=++this.sharedVar.seqId,e=Array(this.rowCount-this.columnHeaderLevelCount).fill(t);this._rowHeaderCellIds_FULL.unshift(e);const i={id:t,title:"string"==typeof this.rowHeaderTitle.title?this.rowHeaderTitle.title:this.rowsDefine.reduce(((t,e)=>"string"==typeof e?t:t+(t?`/${e.title}`:`${e.title}`)),""),field:void 0,headerType:this.rowHeaderTitle?.headerType??"text",style:this.rowHeaderTitle?.headerStyle,define:{field:"",headerType:"text",cellType:"text",disableHeaderHover:!!this.rowHeaderTitle?.disableHeaderHover,disableHeaderSelect:!!this.rowHeaderTitle?.disableHeaderSelect}};this.rowHeaderObjs.push(i),this._headerObjects[t]=i}this._rowHeaderCellIds_FULL=GC(this._rowHeaderCellIds_FULL),"tree"===this.rowHierarchyType&&this.extensionRows?.length>=1&&this.generateExtensionRowTree(),this.colIndex=0,this._headerObjectMap=this._headerObjects.reduce(((t,e)=>(t[e.id]=e,t)),{}),this._CellHeaderPathMap=new Map,this._largeCellRangeCache.length=0;const n=function(t,e,i,r,o,n){const s=n.columnHeaderLevelCount,a=[],l=[];for(let t=0;t<i.length;t++)r.includes(i[t])||l.push(o[t]);for(let e=0;e<r.length;e++)if(!i.includes(r[e])){const i={col:t,row:s+e};a.push(i)}let h=n.getParentCellId(t,e),c=n.getRowHeaderCellAddressByCellId(h);const d=[];for(c&&d.push(c);h;)h=n.getParentCellId(c.col,c.row),h&&(c=n.getRowHeaderCellAddressByCellId(h),d.push(c));return{addCellPositions:a,removeCellPositions:l,updateCellPositions:d}}(t,e,i.map((e=>e[t-this.leftRowSeriesNumberColumnCount])),this._rowHeaderCellIds_FULL.map((e=>e[t-this.leftRowSeriesNumberColumnCount])),r,this);return this._rowHeaderCellIds=this._rowHeaderCellIds_FULL.slice(),n}isHeaderForColWidth(t,e){return this.isHeader(t,e)}getHeaderForColWidth(t,e){return this.getHeader(t,e)}getPivotCellAdress(t){if(!Array.isArray(t))return;let e,i,r=this.rowTree,o=this.columnTree;for(let n=0;n<t.length;n++){const s=t[n];if((s.isPivotCorner||!s.value)&&n===t.length-1){if("row"===this?.cornerSetting?.titleOnDimension){let t=0;return"grid"===this.rowHierarchyType&&(t=this.rowDimensionKeys.indexOf(s.dimensionKey)),-1===t?void 0:{col:(this.rowHeaderTitle?t+1:t)+this.leftRowSeriesNumberColumnCount,row:0}}const t=this.colDimensionKeys.indexOf(s.dimensionKey);return-1===t?void 0:{col:0+this.leftRowSeriesNumberColumnCount,row:this.columnHeaderTitle?t+1:t}}let a=!1;for(let t=0;t<o.length;t++){const e=o[t];if((Y(s.dimensionKey)&&e.dimensionKey===s.dimensionKey||Y(s.indicatorKey)&&e.indicatorKey===s.indicatorKey)&&e.value===s.value){o=e.children,i=e,a=!0;break}}if(!a)for(let t=0;t<r.length;t++){const i=r[t];if((Y(s.dimensionKey)&&i.dimensionKey===s.dimensionKey||Y(s.indicatorKey)&&i.indicatorKey===s.indicatorKey)&&i.value===s.value){r=i.children,e=i;break}}}let n=0,s=0;if(e){s=this.columnHeaderLevelCount;const{startInTotal:t,level:i}=e;return s+=t,n="grid"===this.rowHierarchyType?(this.rowHeaderTitle?i+1:i)+this.leftRowSeriesNumberColumnCount:0+this.leftRowSeriesNumberColumnCount,{col:n,row:s}}if(i){n=this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount;const{startInTotal:t,level:e}=i;return n+=t,s=this.columnHeaderTitle?e+1:e,{col:n,row:s}}}getPivotDimensionInfo(t,e){const{colHeaderPaths:i,rowHeaderPaths:r}=this.getCellHeaderPaths(t,e),o=[];return i.length?i.forEach(((t,e)=>{o.push({dimensionKey:t.dimensionKey,value:t.value,isPivotCorner:!1,indicatorKey:t.indicatorKey})})):r.length?r.forEach(((t,e)=>{o.push({dimensionKey:t.dimensionKey,value:t.value,isPivotCorner:!1,indicatorKey:t.indicatorKey})})):this.isCornerHeader(t,e)&&("row"===this?.cornerSetting?.titleOnDimension?o.push({dimensionKey:this.rowDimensionKeys[(this.rowHeaderTitle?t-1:t)-this.leftRowSeriesNumberColumnCount],isPivotCorner:!0}):o.push({dimensionKey:this.colDimensionKeys[this.columnHeaderTitle?e-1:e],isPivotCorner:!0})),o}getIndicatorKey(t,e){return this.getBody(t,e)?.indicatorKey}getParentCellId(t,e){if(0!==e)return this.isColumnHeader(t,e)?this.getCellId(t,e-1):this.isRowHeader(t,e)?this.getCellId(t-1,e):void 0}getRowHeaderCellAddressByCellId(t){let e,i;if(this._rowHeaderCellIds.find(((r,o)=>!!r.find(((i,r)=>i===t&&(e=r,!0)))&&(i=o,!0))),Y(e)&&Y(i))return{col:e,row:i+this.columnHeaderLevelCount}}canMoveHeaderPosition(t,e){if(this.isSeriesNumberInHeader(e.col,e.row)||this.isSeriesNumberInHeader(t.col,t.row))return!1;if(t.col<0||t.row<0||e.col<0||e.row<0)return!1;this.isSeriesNumberInBody(e.col,e.row)&&this.isSeriesNumberInBody(t.col,t.row)&&(t.col=t.col+this.leftRowSeriesNumberColumnCount+this.rowHeaderLevelCount-1,e.col=e.col+this.leftRowSeriesNumberColumnCount+this.rowHeaderLevelCount-1);const i=this.getCellRange(t.col,t.row);if(this.isColumnHeader(t.col,t.row)){return this.getParentCellId(t.col,i.start.row)===this.getParentCellId(e.col,i.start.row)}if(this.isRowHeader(t.col,t.row)){if("tree"!==this.rowHierarchyType){return this.getParentCellId(i.start.col,t.row)===this.getParentCellId(i.start.col,e.row)}{const i=mt(this.getCellHeaderPathsWidthTreeNode(t.col,t.row).rowHeaderPaths),r=mt(this.getCellHeaderPathsWidthTreeNode(e.col,e.row).rowHeaderPaths);if(i.pop(),r.pop(),i.length<=r.length){if(i.length===r.length)return!i.find(((t,e)=>t.dimensionKey!==r[e].dimensionKey||t.value!==r[e].value));if(i.length>0)for(let t=0;t<i.length;t++)if(i[t].startInTotal!==r[t].startInTotal)return!1;return!0}}}return!1}moveHeaderPosition(t,e){if(this.canMoveHeaderPosition(t,e)&&!this.isCellRangeEqual(t.col,t.row,e.col,e.row)){const i=this.getCellRange(t.col,t.row);if(this.isColumnHeader(t.col,t.row)){const r=i.end.col-i.start.col+1;let o;const n=this.getCellRange(e.col,i.start.row);if(o=e.col>=t.col?n.end.col-r+1:n.start.col,o===i.start.col)return null;for(let t=0;t<this._columnHeaderCellIds.length;t++){const e=this._columnHeaderCellIds[t].splice(i.start.col-this.rowHeaderLevelCount-this.leftRowSeriesNumberColumnCount,r);e.unshift(o-this.rowHeaderLevelCount-this.leftRowSeriesNumberColumnCount,0),Array.prototype.splice.apply(this._columnHeaderCellIds[t],e)}const s=this._columnWidths.splice(i.start.col-this.leftRowSeriesNumberColumnCount,r);return s.unshift(o-this.leftRowSeriesNumberColumnCount,0),Array.prototype.splice.apply(this._columnWidths,s),this.columnDimensionTree.movePosition(this.getCellHeaderPathsWidthTreeNode(t.col,t.row).colHeaderPaths.length-1,i.start.col-this.rowHeaderLevelCount-this.leftRowSeriesNumberColumnCount,n.start.col-this.rowHeaderLevelCount-this.leftRowSeriesNumberColumnCount),this.columnDimensionTree.reset(this.columnDimensionTree.tree.children,!0),this._CellHeaderPathMap=new Map,this._largeCellRangeCache.length=0,{sourceIndex:i.start.col,targetIndex:o,sourceSize:r,targetSize:n.end.col-n.start.col+1,moveType:"column"}}if(this.isRowHeader(t.col,t.row)){let r;const o=this.getCellHeaderPathsWidthTreeNode(t.col,t.row).rowHeaderPaths,n=this.getCellHeaderPathsWidthTreeNode(e.col,e.row).rowHeaderPaths,s=o[o.length-1],a=n[o.length-1],l=s.size;if(r=e.row>=t.row?a.startInTotal+a.size-l:a.startInTotal,r===i.start.row-this.columnHeaderLevelCount)return null;const h=this._rowHeaderCellIds.splice(i.start.row-this.columnHeaderLevelCount,l);h.unshift(r-this.currentPageStartIndex,0),Array.prototype.splice.apply(this._rowHeaderCellIds,h);const c=this._rowHeaderCellIds_FULL.splice(i.start.row-this.columnHeaderLevelCount+this.currentPageStartIndex,l);return c.unshift(r,0),Array.prototype.splice.apply(this._rowHeaderCellIds_FULL,c),this.rowDimensionTree.movePosition(o.length-1,i.start.row-this.columnHeaderLevelCount,r+(e.row>t.row?s.size-1:0)),this.rowDimensionTree.reset(this.rowDimensionTree.tree.children,!0),this._CellHeaderPathMap=new Map,this._largeCellRangeCache.length=0,{sourceIndex:i.start.row,targetIndex:r+this.columnHeaderLevelCount,sourceSize:l,targetSize:a.size,moveType:"row"}}}return null}getCellAdressByHeaderPath(t){let e,i,r=!1;if(Array.isArray(t)){if(t.length>this.rowDimensionKeys.length+this.colDimensionKeys.length)return;e=t.filter((t=>this.colDimensionKeys.indexOf(t.dimensionKey)>=0||this.colDimensionKeys.indexOf(this.indicatorDimensionKey)>=0&&t.indicatorKey)),i=t.filter((t=>this.rowDimensionKeys.indexOf(t.dimensionKey)>=0||this.rowDimensionKeys.indexOf(this.indicatorDimensionKey)>=0&&t.indicatorKey))}else e=t.colHeaderPaths,i=t.rowHeaderPaths,"body"===t?.cellLocation&&this._table.isPivotTable()&&(r=!0);if(!Array.isArray(e)&&!Array.isArray(i))return;e?.sort(((t,e)=>this.colDimensionKeys.indexOf(t.dimensionKey??this.indicatorDimensionKey)-this.colDimensionKeys.indexOf(e.dimensionKey??this.indicatorDimensionKey))),i?.sort(((t,e)=>this.fullRowDimensionKeys.indexOf(t.dimensionKey??this.indicatorDimensionKey)-this.fullRowDimensionKeys.indexOf(e.dimensionKey??this.indicatorDimensionKey)));let o,n,s,a,l=!1;e?.length>=1&&i?.length>=1&&(l=!0);let h,c,d=this.rowTree,u=this.columnTree;if(e)for(let t=0;t<e.length;t++){const i=e[t];for(let t=0;t<u.length;t++){const e=u[t];if(!Y(i.indicatorKey)&&e.dimensionKey===i.dimensionKey&&e.value===i.value||Y(i.indicatorKey)&&e.indicatorKey===i.indicatorKey){u=e.children,l&&!u?c=e:l||(c=e);break}}}if(i?.length>=1)if("tree"===this.rowHierarchyType){const t=i[i.length-1],e=this.headerObjects.filter((e=>(e?.field===t.dimensionKey||e?.field===t.indicatorKey)&&e?.title===t.value)).map((t=>t.id)),r=this._rowHeaderCellIds.filter((t=>e.indexOf(t[t.length-1])>=0)).find((t=>{const e=this.findFullCellIds(t);return e.length===i.length&&e.every((t=>{const e=this._headerObjectMap[t];return i.find((t=>t.dimensionKey===e.field&&t.value===e.title))}))}));n=this._rowHeaderCellIds.indexOf(r)+this.columnHeaderLevelCount}else for(let t=0;t<i.length;t++){const e=i[t];for(let t=0;t<d.length;t++){const i=d[t];if(!Y(e.indicatorKey)&&i.dimensionKey===e.dimensionKey&&i.value===e.value||Y(e.indicatorKey)&&i.indicatorKey===e.indicatorKey&&(!e.value||i.value===e.value)){d=i.children,(!l||d&&!d.some((t=>"axis"===t.dimensionKey)))&&l||(h=i);break}}}if(r||!l||(h||Y(n))&&c){if(h||r){n=this.columnHeaderLevelCount;const{startInTotal:t,level:e}=h??pE;n+=t??0,s="grid"===this.rowHierarchyType?(this.rowHeaderTitle?e+1:e)+this.leftRowSeriesNumberColumnCount:0}if(c||r){o=this.rowHeaderLevelCount;const{startInTotal:t,level:e}=c??pE;o+=t??0,a=this.columnHeaderTitle?e+1:e}return Y(o)||Y(n)?{col:o??s,row:n??a}:void 0}}setChartInstance(t,e,i){const r=this.getCellHeaderPaths(t,e);let o;if(this.indicatorsAsCol){const t=r.colHeaderPaths.find((t=>t.indicatorKey))?.indicatorKey;o=this._indicators?.find((e=>e.indicatorKey===t))}else{const t=r.rowHeaderPaths.find((t=>t.indicatorKey))?.indicatorKey;o=this._indicators?.find((e=>e.indicatorKey===t))}"function"!=typeof o?.chartSpec&&o&&(o.chartInstance=i)}getChartInstance(t,e){const i=this.getCellHeaderPaths(t,e);let r;if(this.indicatorsAsCol){const t=i.colHeaderPaths.find((t=>t.indicatorKey))?.indicatorKey;r=this._indicators?.find((e=>e.indicatorKey===t))}else{const t=i.rowHeaderPaths.find((t=>t.indicatorKey))?.indicatorKey;r=this._indicators?.find((e=>e.indicatorKey===t))}return r?.chartInstance}checkHasChart(){return oE(this)}getDimension(t,e){return"column"===e?this.columnsDefine?.find((e=>"string"!=typeof e&&e.dimensionKey===t)):"row"===e?this.rowsDefine?.find((e=>"string"!=typeof e&&e.dimensionKey===t)):void 0}getAxisConfigInPivotChart(t,e){if((this.isFrozenColumn(t,e)||this.isRightFrozenColumn(t,e))&&eE(t,e,"row",this)||(this.isFrozenRow(t,e)||this.isBottomFrozenRow(t,e))&&eE(t,e,"col",this))return wB(t,e,this)}isEmpty(t,e){return!!this._table.isPivotChart()&&(!!this.isLeftBottomCorner(t,e)||(!!this.isRightBottomCorner(t,e)||!!this.isRightTopCorner(t,e)))}isAxisCell(t,e){if(!this._table.isPivotChart())return!1;if(this.indicatorKeys.length>=1&&tE(this)){if(this.isBottomFrozenRow(t,e)&&eE(t,e,"col",this)||this.isRightFrozenColumn(t,e)&&eE(t,e,"row",this))return!0;if(this.isRowHeader(t,e)&&t===this.rowHeaderLevelCount-1&&eE(t,e,"row",this))return!0;if(this.hasTwoIndicatorAxes&&this.indicatorsAsCol&&e===this.columnHeaderLevelCount-1&&eE(t,e,"col",this))return!0}return!1}getChartAxes(t,e){if(function(t,e,i){let r=!0;const o=i.getRawChartSpec(t,e);return o&&"pie"!==o.type&&"funnel"!==o.type&&"rose"!==o.type||(r=!1),r}(t,e,this)||this.isAxisCell(t,e))return function(t,e,i){const r=[];if(i.indicatorsAsCol){const o=i.getIndicatorKeyInChartSpec(t,e),n=i.getColKeysPath(t,e);o.forEach(((s,a)=>{const{range:l,isZeroAlign:h,axisOption:c}=rE(t,e,a,0===a?"bottom":"top",o,n,i);if(h){const r=rE(t,e,o.length-1-a,0===a?"top":"bottom",o,n,i);if(r){const{range:t}=r,e=CB(l,t);e&&(l.min=e.range1[0],l.max=e.range1[1])}}ot(c?.min)&&(l.min=c.min),ot(c?.max)&&(l.max=c.max),r.push(wt({range:l},c,{type:c?.type||"linear",orient:0===a?"bottom":"top",label:{visible:!1},title:{visible:!1},domainLine:{visible:!1},seriesIndex:a,sync:{axisId:QH}}))}));let s=i.getDimensionKeyInChartSpec(i.rowHeaderLevelCount,e);et(s)&&(s=s[0]);const a=(i.dataset.cacheCollectedValues[s]||i.dataset.collectedValues[s]||[])[i.getRowKeysPath(t,e)??""],{axisOption:l,isPercent:h}=vB(t,e,"left",i);r.push(wt({domain:Array.from(a??[])},l,{type:"band",orient:"left",label:{visible:!1},domainLine:{visible:!1},tick:{visible:!1},subTick:{visible:!1},title:{visible:!1}}))}else{const o=i.getIndicatorKeyInChartSpec(t,e),n=i.getRowKeysPath(t,e);o.forEach(((s,a)=>{const{range:l,isZeroAlign:h,axisOption:c}=rE(t,e,a,0===a?"left":"right",o,n,i);if(h){const r=rE(t,e,o.length-1-a,0===a?"right":"left",o,n,i);if(r){const{range:t}=r,e=CB(l,t);e&&(l.min=e.range1[0],l.max=e.range1[1])}}ot(c?.min)&&(l.min=c.min),ot(c?.max)&&(l.max=c.max),r.push(wt({range:l},c,{type:c?.type||"linear",orient:0===a?"left":"right",label:{visible:!1},title:{visible:!1},domainLine:{visible:!1},seriesIndex:a,sync:{axisId:QH}}))}));let s=i.getDimensionKeyInChartSpec(t,i.columnHeaderLevelCount);et(s)&&(s=s[0]);const a=i.dataset.cacheCollectedValues[s]||i.dataset.collectedValues[s]||[],l=i.getColKeysPath(t,e),h=a?.[l??""]??[],{axisOption:c,isPercent:d}=vB(t,e,"bottom",i);r.push(wt({domain:Array.from(h)},c,{type:"band",orient:"bottom",visible:!0,label:{visible:!1},domainLine:{visible:!1},tick:{visible:!1},subTick:{visible:!1},title:{visible:!1}}))}return r}(t,e,this)}getRawChartSpec(t,e){return function(t,e,i){const r=i.getCellHeaderPaths(t,e);let o;if(i.indicatorsAsCol){const t=r.colHeaderPaths.find((t=>t.indicatorKey))?.indicatorKey;o=i.columnObjects.find((e=>e.indicatorKey===t))}else{const t=r.rowHeaderPaths.find((t=>t.indicatorKey))?.indicatorKey;o=i.columnObjects.find((e=>e.indicatorKey===t))}const n=o?.chartSpec;if("function"==typeof n)return n({col:t,row:e,dataValue:i._table.getCellOriginValue(t,e)||"",value:i._table.getCellValue(t,e)||"",rect:i._table.getCellRangeRelativeRect(i._table.getCellRange(t,e)),table:i._table});return n}(t,e,this)}getChartSpec(t,e){return function(t,e,i){let r=i.getRawChartSpec(t,e);return r?i._table.isPivotChart()?(r=jS(r),r.sortDataByAxis=!0,et(r.series)&&r.series.forEach((t=>{t.sortDataByAxis=!0})),r.axes=i.getChartAxes(t,e),r.padding=0,r.dataZoom=[],r):r:null}(t,e,this)}isShareChartSpec(t,e){return function(t,e,i){const r=i.getCellHeaderPaths(t,e);let o;if(i.indicatorsAsCol){const t=r.colHeaderPaths.find((t=>t.indicatorKey))?.indicatorKey;o=i.columnObjects.find((e=>e.indicatorKey===t))}else{const t=r.rowHeaderPaths.find((t=>t.indicatorKey))?.indicatorKey;o=i.columnObjects.find((e=>e.indicatorKey===t))}const n=o?.chartSpec;return"function"!=typeof n}(t,e,this)}getChartDataId(t,e){return iE(t,e,this)}setPagination(t){if(this.clearCellRangeMap(),this.pagination=t,"grid"===this.rowHierarchyType&&Y(this.pagination?.perPageCount)&&Y(this.pagination?.currentPage)){!1===this.indicatorsAsCol&&(this.pagination.perPageCount=Math.ceil(this.pagination.perPageCount/this.indicatorKeys.length)*this.indicatorKeys.length);const{perPageCount:t,currentPage:e}=this.pagination;this.currentPageStartIndex=t*(e||0),this.currentPageEndIndex=this.currentPageStartIndex+t,this._rowHeaderCellIds=this._rowHeaderCellIds_FULL?.slice(this.currentPageStartIndex,this.currentPageEndIndex)}else this.currentPageStartIndex=0,this.currentPageEndIndex=this._rowHeaderCellIds_FULL.length,this._rowHeaderCellIds=this._rowHeaderCellIds_FULL?.slice(this.currentPageStartIndex,this.currentPageEndIndex);this.pagination&&(this.pagination.totalCount=this._rowHeaderCellIds_FULL?.length)}release(){const t=this._table._getActiveChartInstance();t?.release(),this._indicators?.forEach((t=>{t.chartInstance?.release()}))}getHeadNode(t){if(!Array.isArray(t))return;let e,i,r=this.rowTree,o=this.columnTree;for(let n=0;n<t.length;n++){const s=t[n];if((s.isPivotCorner||!s.value)&&n===t.length-1)return;let a=!1;for(let t=0;t<o.length;t++){const e=o[t];if(Y(s.dimensionKey)&&e.dimensionKey===s.dimensionKey&&e.value===s.value||Y(s.indicatorKey)&&e.indicatorKey===s.indicatorKey&&(e.value===s.value||!Y(s.value)||!Y(e.value))){o=e.children,i=e,a=!0;break}}if(!a)for(let t=0;t<r.length;t++){const i=r[t];if(Y(s.dimensionKey)&&i.dimensionKey===s.dimensionKey&&i.value===s.value||Y(s.indicatorKey)&&i.indicatorKey===s.indicatorKey&&(i.value===s.value||!Y(s.value)||!Y(i.value))){r=i.children,e=i;break}}}return e||(i||void 0)}clearCellRangeMap(){this._largeCellRangeCache.length=0,this._CellHeaderPathMap=new Map}getDimensionKeyInChartSpec(t,e){let i;if(!1===this.indicatorsAsCol)for(let t=0;t<this.indicatorsDefine.length;t++){const e=this.indicatorsDefine[t].chartSpec;if(e&&(i=e.xField??e?.series?.[0]?.xField,i))return i}else for(let t=0;t<this.indicatorsDefine.length;t++){const e=this.indicatorsDefine[t].chartSpec;if(e&&(i=e.yField??e?.series?.[0]?.yField,i))return i}return null}_generateChartState(){return{vtable_selected:{filter:t=>{if(this._table._selectedDataItemsInChart.length>=1){return!!this._table._selectedDataItemsInChart.find((e=>{for(const i in e)if(e[i]!==t[i])return!1;return!0}))}if(this._table._selectedDimensionInChart?.length){return!!this._table._selectedDimensionInChart.every((e=>t[e.key]===e.value))}return!1}},vtable_selected_reverse:{filter:t=>{if(this._table._selectedDataItemsInChart.length>=1){return!this._table._selectedDataItemsInChart.find((e=>{for(const i in e)if(e[i]!==t[i])return!1;return!0}))}if(this._table._selectedDimensionInChart?.length){return!this._table._selectedDimensionInChart.every((e=>t[e.key]===e.value))}return!1}}}}updateDataStateToChartInstance(t){t||(t=this._table._getActiveChartInstance());const e=this._generateChartState();this._indicators.forEach((t=>{t.chartInstance.updateState(e)})),t?.updateState(e)}updateDataStateToActiveChartInstance(t){t||(t=this._table._getActiveChartInstance());const e=this._generateChartState();t?.updateState(e)}getIndicatorKeyInChartSpec(t,e){const i=this.getRawChartSpec(t,e),r=[];if(i){if(i.series||i.xField||i.yField)return!1===this.indicatorsAsCol?i.series?i.series.forEach((t=>{const e=t.yField;r.push(e)})):r.push(i.yField):i.series?i.series.forEach((t=>{const e=t.xField;r.push(e)})):r.push(i.xField),r;if(i.valueField&&r.push(i.valueField),r.length>=1)return r}return null}getOptimunHeightForChart(t){const e=this.getCellHeaderPaths(this.rowHeaderLevelCount,t).rowHeaderPaths;let i,r;for(const t in this.dataset.collectValuesBy)if("yField"===this.dataset.collectValuesBy[t].type&&!this.dataset.collectValuesBy[t].range){i=this.dataset.collectedValues[t]?.[e.map((t=>t.value)).join(this.dataset.stringJoinChar)];break}if(this._chartItemBandSize)r=mE(i?.length??0,this._chartItemBandSize,this._chartPaddingInner,this._chartPaddingOuter);else{const t=this._chartItemSpanSize||25;r=(i?.length??0)*(t+t/3)}const o=BA(this._chartPadding??this._table.theme.bodyStyle.padding??0);return r+o[0]+o[2]}getOptimunWidthForChart(t){const e=this.getCellHeaderPaths(t,this.columnHeaderLevelCount).colHeaderPaths;let i,r;for(const t in this.dataset.collectValuesBy)if("xField"===this.dataset.collectValuesBy[t].type&&!this.dataset.collectValuesBy[t].range){i=this.dataset.collectedValues[t]?.[e.map((t=>t.value)).join(this.dataset.stringJoinChar)];break}if(this._chartItemBandSize)r=mE(i?.length??0,this._chartItemBandSize,this._chartPaddingInner,this._chartPaddingOuter);else{const t=this._chartItemSpanSize||25;r=(i?.length??0)*(t+t/3)}const o=BA(this._chartPadding??this._table.theme.bodyStyle.padding??0);return r+o[1]+o[3]}get leftAxesCount(){if(!this._table.isPivotChart())return 0;const t=this._table.pivotChartAxes.find((t=>"left"===t.orient));return!1===t?.visible?0:(this.indicatorsAsCol,1)}get topAxesCount(){if(!this._table.isPivotChart())return 0;const t=this._table.pivotChartAxes.find((t=>"top"===t.orient));return!1===t?.visible?0:this.indicatorsAsCol&&this.hasTwoIndicatorAxes?1:0}get rightAxesCount(){return this.rightFrozenColCount}get bottomAxesCount(){return this.bottomFrozenRowCount}getColKeysPath(t,e){const i=this.getCellHeaderPaths(t,e),r=[];return i.colHeaderPaths.length&&i.colHeaderPaths.forEach((t=>{t.dimensionKey&&r.push(t.value)})),r?.join(this.dataset.stringJoinChar)}getRowKeysPath(t,e){const i=this.getCellHeaderPaths(t,e),r=[];return i.rowHeaderPaths.length&&i.rowHeaderPaths.forEach((t=>{t.dimensionKey&&r.push(t.value)})),r?.join(this.dataset.stringJoinChar)}getIndicatorInfo(t,e=""){const i=this.indicatorsDefine?.find((i=>"string"!=typeof i&&(t?i.indicatorKey===t:!!e&&i.title===e)));return i}getLayoutColumnTree(){const t=[];return sE(t,this.columnDimensionTree.tree.children),t}getLayoutRowTree(){const t=[];return sE(t,this.rowDimensionTree.tree.children),t}getLayoutColumnTreeCount(){return aE(this.columnDimensionTree.tree.children,"tree"===this.rowHierarchyType)}getLayoutRowTreeCount(){let t=aE(this.rowDimensionTree.tree.children,"tree"===this.rowHierarchyType);return this.extensionRows?.forEach((e=>{if("function"!=typeof e.rowTree){const i=aE(e.rowTree,!0);t*=i}})),t}resetHeaderTree(){this._rowHeaderCellIds_FULL=[],this._columnHeaderCellIds=[];const t=this.dataset;this.rowTree=t.rowHeaderTree,this.columnTree=t.colHeaderTree,this.columnDimensionTree=new nE(this.columnTree??[],this.sharedVar),this.rowDimensionTree=new nE(this.rowTree??[],this.sharedVar,this.rowHierarchyType,"tree"===this.rowHierarchyType?this.rowExpandLevel:void 0),this._generateColHeaderIds(),this.colIndex=0,this._generateRowHeaderIds(),this.resetColumnHeaderLevelCount(),this._rowHeaderCellIds_FULL=GC(this._rowHeaderCellIds_FULL),this._headerObjectMap=this._headerObjects.reduce(((t,e)=>(t[e.id]=e,t)),{}),this.setPagination(this.pagination)}isSeriesNumberInHeader(t,e){return this.leftRowSeriesNumberColumnCount>0&&t>=0&&e>=0&&t<this.leftRowSeriesNumberColumnCount&&e<this.headerLevelCount||this.rightRowSeriesNumberColumnCount>0&&e>=0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount&&e<this.headerLevelCount}isSeriesNumberInBody(t,e){return this.leftRowSeriesNumberColumnCount>0&&t>=0&&t<this.leftRowSeriesNumberColumnCount&&e>=this.headerLevelCount||this.rightRowSeriesNumberColumnCount>0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount&&e>=this.headerLevelCount}isSeriesNumber(t,e){return this.leftRowSeriesNumberColumnCount>0&&t>=0&&e>=0&&t<this.leftRowSeriesNumberColumnCount||this.rightRowSeriesNumberColumnCount>0&&e>=0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount}getSeriesNumberHeader(t,e){return this.leftRowSeriesNumberColumnCount>0&&t>=0&&t<this.leftRowSeriesNumberColumnCount&&e<this.headerLevelCount?Object.assign({},this.leftRowSeriesNumberColumn[t],{style:this._table.internalProps.rowSeriesNumber.headerStyle}):this.rightRowSeriesNumberColumnCount>0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount&&e<this.headerLevelCount&&e<this.headerLevelCount?this.rightRowSeriesNumberColumn[t-(this.colCount-this.rightRowSeriesNumberColumnCount)]:void 0}getSeriesNumberBody(t,e){return this.leftRowSeriesNumberColumnCount>0&&t>=0&&t<this.leftRowSeriesNumberColumnCount&&e>=this.headerLevelCount?this.leftRowSeriesNumberColumn[t]:this.rightRowSeriesNumberColumnCount>0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount&&e>=this.headerLevelCount?this.rightRowSeriesNumberColumn[t-(this.colCount-this.rightRowSeriesNumberColumnCount)]:void 0}changeTreeNodeTitle(t,e,i){const r=this.getCellHeaderPaths(t,e);if(r.rowHeaderPaths.length>0){this.getHeadNode(r.rowHeaderPaths.slice(0,r.rowHeaderPaths.length)).value=i}else if(r.colHeaderPaths.length>0){this.getHeadNode(r.colHeaderPaths.slice(0,r.colHeaderPaths.length)).value=i}const o=this.getCellId(t,e);this._headerObjectMap[o].title=i}}function mE(t,e,i,r){1===i&&(i=0);const o=function(t,e,i){let r;r=1===t?t+2*i:t-e+2*i;return t?r>0?r:1:0}(t,i,r),n=e/(1-i);return Math.ceil(o*n)}class bE{dataConfig;records;tree={};beforeChangedTree={};colFlatKeys={};rowFlatKeys={};stringJoinChar=String.fromCharCode(0);rowsIsTotal=[];colsIsTotal=[];colGrandTotalLabel;colSubTotalLabel;rowGrandTotalLabel;rowSubTotalLabel;constructor(t,e){this.dataConfig=t,e&&(this.records=e,"undefined"!=typeof window&&window.performance.now(),this.setRecords(e),"undefined"!=typeof window&&window.performance.now())}changeDataConfig(t){this.dataConfig=t}setRecords(t){this.processRecords()}processRecords(){for(let t=0,e=this.records.length;t<e;t++){const e=this.records[t];this.processRecord(e)}}processRecord(t){const e=[],i=[];for(let e=0,r=this.dataConfig.rows.length;e<r;e++){const r=this.dataConfig.rows[e];void 0!==t[r]&&r!==this.dataConfig.indicatorDimensionKey&&i.push(t[r])}for(let i=0,r=this.dataConfig.columns.length;i<r;i++){const r=this.dataConfig.columns[i];void 0!==t[r]&&r!==this.dataConfig.indicatorDimensionKey&&e.push(t[r])}this.dataConfig.indicators?.forEach((r=>{const o=t[r];void 0!==o&&(this.dataConfig.indicatorsAsCol?e.push(r):i.push(r));const n=i.join(this.stringJoinChar),s=e.join(this.stringJoinChar);0!==i.length&&(this.rowFlatKeys[n]||(this.rowFlatKeys[n]=1)),0!==e.length&&(this.colFlatKeys[s]||(this.colFlatKeys[s]=1)),0===e.length&&0===i.length||(this.tree[n]||(this.tree[n]={}),void 0!==o&&(this.tree[n][s]={value:o,record:t},this.dataConfig.indicatorsAsCol?e.pop():i.pop()))}))}getTreeNode(t=[],e=[],i,r=!0){let o,n;if("string"==typeof t)o=t;else{let e=!1;t.map(((r,o)=>{r===i&&(t.splice(o,1),e=!0)})),e&&t.push(i),o=t.join(this.stringJoinChar)}if("string"==typeof e)n=e;else{let t=!1;e.map(((r,o)=>{r===i&&(e.splice(o,1),t=!0)})),t&&e.push(i),n=e.join(this.stringJoinChar)}return r?this.tree?.[o]?.[n]??void 0:Y(this.beforeChangedTree[o]?.[n])?{value:this.beforeChangedTree[o][n].value,record:this.beforeChangedTree[o][n].record}:void 0}changeTreeNodeValue(t=[],e=[],i,r){let o,n;if("string"==typeof t)o=t;else{let e=!1;t.map(((r,o)=>{r===i&&(t.splice(o,1),e=!0)})),e&&t.push(i),o=t.join(this.stringJoinChar)}if("string"==typeof e)n=e;else{let t=!1;e.map(((r,o)=>{r===i&&(e.splice(o,1),t=!0)})),t&&e.push(i),n=e.join(this.stringJoinChar)}const s=this.tree[o]?.[n]?.value,a=Object.assign({},this.tree[o]?.[n]?.record);this.tree[o]?.[n]?.record?(this.tree[o][n].record[i]=r,this.tree[o][n].value=r):(this.tree[o]||(this.tree[o]={}),this.tree[o][n]={record:this._buildRecord(t,e,i,r),value:r}),this.beforeChangedTree[o]?.[n]||(this.beforeChangedTree[o]={},this.beforeChangedTree[o][n]={record:void 0,value:void 0},this.beforeChangedTree[o][n].record=a,this.beforeChangedTree[o][n].value=s)}_buildRecord(t=[],e=[],i,r){const o={},n=this.dataConfig.rows,s=this.dataConfig.columns;return n.forEach(((e,i)=>{e!==this.dataConfig.indicatorDimensionKey&&(o[e]=t[i])})),s.forEach(((t,i)=>{t!==this.dataConfig.indicatorDimensionKey&&(o[t]=e[i])})),o[i]=r,this.records.push(o),o}addRecords(t){for(let e=0,i=t.length;e<i;e++){const i=t[e];this.processRecord(i)}this.records.push(t)}changeRecordFieldValue(t,e,i){let r=!1;for(let e=0;e<this.dataConfig.indicators.length;e++)this.dataConfig.indicators[e]===t&&(r=!0);if(!r){for(let r=0,o=this.records.length;r<o;r++){const o=this.records[r];o[t]===e&&(o[t]=i)}this.rowFlatKeys={},this.colFlatKeys={},this.tree={},this.processRecords()}}}class yE{dataConfig;records;tree={};changedTree={};colFlatKeys={};rowFlatKeys={};colKeys=[];rowKeys=[];rowOrder="key_a_to_z";colOrder="key_a_to_z";sorted=!1;sortRules;filterRules;aggregationRules;derivedFieldRules;mappingRules;totals;indicatorStatistics=[];aggregators={};stringJoinChar=String.fromCharCode(0);rowsIsTotal=[];colsIsTotal=[];colGrandTotalLabel;colSubTotalLabel;rowGrandTotalLabel;rowSubTotalLabel;needSplitPositiveAndNegative;collectValuesBy;collectedValues={};cacheCollectedValues={};rows;columns;indicatorKeys;customRowTree;customColTree;colHeaderTree;rowHeaderTree;rowHierarchyType;indicators;indicatorsAsCol;totalRecordsTree={};constructor(t,e,i,r,o,n,s,a,l,h,c){if(this.registerAggregators(),this.dataConfig=t,this.rowHierarchyType=a??"grid",this.sortRules=this.dataConfig?.sortRules,this.aggregationRules=this.dataConfig?.aggregationRules,this.derivedFieldRules=this.dataConfig?.derivedFieldRules,this.mappingRules=this.dataConfig?.mappingRules,this.totals=this.dataConfig?.totals,this.rows=e,this.columns=i,this.indicatorKeys=r,this.indicatorsAsCol=n,this.indicators=o,this.customColTree=l,this.customRowTree=h,this.colGrandTotalLabel=this.totals?.column?.grandTotalLabel??"总计",this.colSubTotalLabel=this.totals?.column?.subTotalLabel??"小计",this.rowGrandTotalLabel=this.totals?.row?.grandTotalLabel??"总计",this.rowSubTotalLabel=this.totals?.row?.subTotalLabel??"小计",this.collectValuesBy=this.dataConfig?.collectValuesBy,this.needSplitPositiveAndNegative=c??!1,this.rowsIsTotal=new Array(this.rows?.length??0).fill(!1),this.colsIsTotal=new Array(this.columns?.length??0).fill(!1),this.totals?.row&&!1!==this.totals.row.showSubTotals)for(let t=0,e=this.totals?.row?.subTotalsDimensions?.length;t<e;t++){const e=this.totals.row.subTotalsDimensions[t],i=this.rows.indexOf(e);this.rowsIsTotal[i]=!0}if(this.totals?.column&&!1!==this.totals.column.showSubTotals)for(let t=0,e=this.totals?.column?.subTotalsDimensions?.length;t<e;t++){const e=this.totals.column.subTotalsDimensions[t],i=this.columns.indexOf(e);this.colsIsTotal[i]=!0}this.setRecords(s)}setRecords(t){this.records=t,this.collectedValues={},this.cacheCollectedValues={},this.totalRecordsTree={},this.tree={},this.colFlatKeys={},this.rowFlatKeys={},this.colKeys=[],this.rowKeys=[],t&&(this.records=t,"undefined"!=typeof window&&window.performance.now(),this.processRecords(),this.processCollectedValuesWithSumBy(),this.generateCollectedValuesSortRule(),this.processCollectedValuesWithSortBy(),"undefined"!=typeof window&&window.performance.now(),"undefined"!=typeof window&&window.performance.now(),this.totalStatistics(),"undefined"!=typeof window&&window.performance.now(),"undefined"!=typeof window&&window.performance.now(),this.sortKeys(),"undefined"!=typeof window&&window.performance.now(),"undefined"!=typeof window&&window.performance.now(),this.customRowTree?(this.indicatorsAsCol||(this.customRowTree=this._adjustCustomTree(this.customRowTree)),this.rowHeaderTree=this.customRowTree):"tree"===this.rowHierarchyType?this.rowHeaderTree=this.ArrToTree1(this.rowKeys,this.rows,this.indicatorsAsCol?void 0:this.indicators,this.totals?.row?.showGrandTotals||!this.indicatorsAsCol&&0===this.columns.length||this.indicatorsAsCol&&0===this.rows.length,this.rowGrandTotalLabel):this.rowHeaderTree=this.ArrToTree(this.rowKeys,this.rows,this.indicatorsAsCol?void 0:this.indicators,this.rowsIsTotal,this.totals?.row?.showGrandTotals||this.indicatorsAsCol&&0===this.rows.length,this.rowGrandTotalLabel,this.rowSubTotalLabel,this.totals?.row?.showGrandTotalsOnTop??!1,this.totals?.row?.showSubTotalsOnTop??!1),this.customColTree?(this.indicatorsAsCol&&(this.customColTree=this._adjustCustomTree(this.customColTree)),this.colHeaderTree=this.customColTree):this.colHeaderTree=this.ArrToTree(this.colKeys,this.columns,this.indicatorsAsCol?this.indicators:void 0,this.colsIsTotal,this.totals?.column?.showGrandTotals||!this.indicatorsAsCol&&0===this.columns.length,this.colGrandTotalLabel,this.colSubTotalLabel,this.totals?.column?.showGrandTotalsOnLeft??!1,this.totals?.column?.showSubTotalsOnLeft??!1),"undefined"!=typeof window&&window.performance.now(),this.dataConfig?.isPivotChart&&this.cacheDeminsionCollectedValues())}registerAggregator(t,e){this.aggregators[t]=e}registerAggregators(){this.registerAggregator(nC.RECORD,QS),this.registerAggregator(nC.SUM,iA),this.registerAggregator(nC.COUNT,rA),this.registerAggregator(nC.MAX,nA),this.registerAggregator(nC.MIN,sA),this.registerAggregator(nC.AVG,oA),this.registerAggregator(nC.NONE,tA)}processCollectedValuesWithSumBy(){for(const t in this.collectedValues)if(this.collectValuesBy[t]?.sumBy)for(const e in this.collectedValues[t]){let i;"sum"===this.collectValuesBy[t]?.extendRange?(i=Object.values(this.collectedValues[t][e]).reduce(((t,e)=>t+e.value()),0),i+=Math.round(i/20)):(i=Object.values(this.collectedValues[t][e]).reduce(((t,e)=>e.value()>t?e.value():t),Number.MIN_SAFE_INTEGER),"max"===this.collectValuesBy[t]?.extendRange?i+=Math.round(i/20):"number"==typeof this.collectValuesBy[t]?.extendRange&&(i=Math.max(i,this.collectValuesBy[t]?.extendRange)));const r=Object.values(this.collectedValues[t][e]).reduce(((t,e)=>e.value()<t?e.value():t),Number.MAX_SAFE_INTEGER);let o,n;this.needSplitPositiveAndNegative&&(o=Object.values(this.collectedValues[t][e]).reduce(((t,e)=>e.positiveValue()>t?e.positiveValue():t),Number.MIN_SAFE_INTEGER),n=Object.values(this.collectedValues[t][e]).reduce(((t,e)=>e.negativeValue()<t?e.negativeValue():t),Number.MAX_SAFE_INTEGER)),this.collectedValues[t][e]={},this.collectedValues[t][e].max=i,this.collectedValues[t][e].min=r,this.needSplitPositiveAndNegative&&(this.collectedValues[t][e].positiveMax=o,this.collectedValues[t][e].negativeMin=n)}}processCollectedValuesWithSortBy(){for(const t in this.collectedValues)if(this.collectValuesBy[t]?.sortBy)for(const e in this.collectedValues[t])this.collectedValues[t][e]=this.collectedValues[t][e].sort(((e,i)=>this.collectValuesBy[t]?.sortBy.indexOf(e)-this.collectValuesBy[t]?.sortBy.indexOf(i)))}generateCollectedValuesSortRule(){for(const t in this.collectedValues)if(this.collectValuesBy[t]&&!this.collectValuesBy[t].sortBy){let e=[];for(const i in this.collectedValues[t])Array.isArray(this.collectedValues[t][i])&&(e.push(...this.collectedValues[t][i]),e=Array.from(new Set(e)));e.length>0&&(this.collectValuesBy[t].sortBy=e)}}processRecords(){let t=!1;if(this.dataConfig?.filterRules?.length>=1&&(t=!0),Array.isArray(this.records))for(let e=0,i=this.records.length;e<i;e++){const i=this.records[e];t&&!this.filterRecord(i)||this.processRecord(i)}else for(const e in this.records)for(let i=0,r=this.records[e].length;i<r;i++){const r=this.records[e][i];t&&!this.filterRecord(r)||this.processRecord(r,e)}this.rowFlatKeys={},this.colFlatKeys={}}filterRecord(t){let e=!0;for(let i=0;i<this.dataConfig.filterRules.length;i++){const r=this.dataConfig?.filterRules[i];if(r.filterKey){const i=t[r.filterKey];if(-1===r.filteredValues.indexOf(i)){e=!1;break}}else if(!r.filterFunc?.(t)){e=!1;break}}return e}processRecord(t,e){this.derivedFieldRules?.forEach(((e,i)=>{t[e.fieldName]=e.derivedFunc(t)}));for(const e in this.collectValuesBy)if(t[e]){this.collectedValues[e]||(this.collectedValues[e]={});const i=this.collectValuesBy[e].by.map((e=>t[e])).join(this.stringJoinChar);if(this.collectedValues[e][i]||(this.collectValuesBy[e].sumBy?this.collectedValues[e][i]={}:this.collectValuesBy[e].range?this.collectedValues[e][i]={min:Number.MAX_SAFE_INTEGER,max:Number.MIN_SAFE_INTEGER}:this.collectedValues[e][i]=[]),this.collectValuesBy[e].sumBy){const r=this.collectValuesBy[e].sumBy.map((e=>t[e])).join(this.stringJoinChar);this.collectedValues[e][i][r]||(this.collectedValues[e][i][r]=new this.aggregators[nC.SUM](e,void 0,void 0,this.needSplitPositiveAndNegative)),this.collectedValues[e][i][r].push(t)}else if(this.collectValuesBy[e].range){const r=this.collectedValues[e][i],o=Math.max(t[e],r.max),n=Math.min(t[e],r.min);isNaN(o)||(r.max=o,r.min=n)}else{const r=this.collectedValues[e][i];-1===r.indexOf(t[e])&&r.push(t[e])}}const i=[],r=[];let o=!1;for(let e=0,i=this.rows.length;e<i;e++){const i=this.rows[e];if(i in t)r.push(t[i]);else{if(this.dataConfig?.totals?.row?.showGrandTotals&&0===e&&!this.rows.find((e=>e in t))){r.push(this.rowGrandTotalLabel),o=!0;break}if(this.dataConfig?.totals?.row?.subTotalsDimensions.indexOf(this.rows[e-1])>=0){"grid"===this.rowHierarchyType&&r.push(this.rowSubTotalLabel),o=!0;break}}}for(let e=0,r=this.columns.length;e<r;e++){const r=this.columns[e];if(r in t)i.push(t[r]);else{if(this.dataConfig?.totals?.column?.showGrandTotals&&0===e&&!this.columns.find((e=>e in t))){i.push(this.colGrandTotalLabel),o=!0;break}if(this.dataConfig?.totals?.column?.subTotalsDimensions.indexOf(this.columns[e-1])>=0){i.push(this.colSubTotalLabel),o=!0;break}}}const n=r.join(this.stringJoinChar),s=i.join(this.stringJoinChar);if(o){this.totalRecordsTree[n]||(this.totalRecordsTree[n]={}),this.totalRecordsTree[n][s]||(this.totalRecordsTree[n][s]=[]);for(let e=0;e<this.indicatorKeys.length;e++){const i=this.getAggregatorRule(this.indicatorKeys[e]);this.totalRecordsTree[n]?.[s]?.[e]||(this.totalRecordsTree[n][s][e]=new this.aggregators[i?.aggregationType??nC.SUM](i?.field??this.indicatorKeys[e],i?.formatFun??this.indicators?.find((t=>"string"!=typeof t&&t.indicatorKey===this.indicatorKeys[e]))?.format)),this.indicatorKeys[e]in t&&this.totalRecordsTree[n]?.[s]?.[e].push(t)}}else{0!==r.length&&(this.rowFlatKeys[n]||(this.rowKeys.push(r),this.rowFlatKeys[n]=1)),0!==i.length&&(this.colFlatKeys[s]||(this.colKeys.push(i),this.colFlatKeys[s]=1)),this.tree[n]||(this.tree[n]={}),this.tree[n]?.[s]||(this.tree[n][s]=[]);for(let i=0;i<this.indicatorKeys.length;i++){const r=this.getAggregatorRule(this.indicatorKeys[i]);if(this.tree[n]?.[s]?.[i]||(this.tree[n][s][i]=new this.aggregators[r?.aggregationType??nC.SUM](r?.field??this.indicatorKeys[i],r?.formatFun??this.indicators?.find((t=>"string"!=typeof t&&t.indicatorKey===this.indicatorKeys[i]))?.format)),e)this.indicatorKeys[i]===e&&this.tree[n]?.[s]?.[i].push(t);else if(r?.field)if("string"==typeof r?.field)r?.field in t&&this.tree[n]?.[s]?.[i].push(t);else{const e=r?.field.find((e=>e in t));e&&this.tree[n]?.[s]?.[i].push(t)}else this.indicatorKeys[i]in t&&this.tree[n]?.[s]?.[i].push(t)}if(this.mappingRules)for(let e=0;e<this.indicatorKeys.length;e++){if(!this.indicatorStatistics[e]){const t=this.getAggregatorRule(this.indicatorKeys[e]);this.indicatorStatistics[e]={max:new this.aggregators[nC.MAX](this.indicatorKeys[e]),min:new this.aggregators[nC.MIN](this.indicatorKeys[e]),total:new this.aggregators[t?.aggregationType??nC.SUM](t?.field??this.indicatorKeys[e],t?.formatFun??this.indicators?.find((t=>"string"!=typeof t&&t.indicatorKey===this.indicatorKeys[e]))?.format)}}this.indicatorStatistics[e].max.push(this.tree[n]?.[s]?.[e].value()),this.indicatorStatistics[e].min.push(this.tree[n]?.[s]?.[e].value()),this.indicatorStatistics[e].total.push(t)}}}updateSortRules(t){this.sorted=!1,this.sortRules=t,this.sortKeys(),this.customRowTree||("tree"===this.rowHierarchyType?this.rowHeaderTree=this.ArrToTree1(this.rowKeys,this.rows,this.indicatorsAsCol?void 0:this.indicators,this.totals?.row?.showGrandTotals||!this.indicatorsAsCol&&0===this.columns.length||this.indicatorsAsCol&&0===this.rows.length,this.rowGrandTotalLabel):this.rowHeaderTree=this.ArrToTree(this.rowKeys,this.rows,this.indicatorsAsCol?void 0:this.indicators,this.rowsIsTotal,this.totals?.row?.showGrandTotals||this.indicatorsAsCol&&0===this.rows.length,this.rowGrandTotalLabel,this.rowSubTotalLabel,this.totals?.row?.showGrandTotalsOnTop??!1,this.totals?.row?.showSubTotalsOnTop??!1)),this.customColTree||(this.colHeaderTree=this.ArrToTree(this.colKeys,this.columns,this.indicatorsAsCol?this.indicators:void 0,this.colsIsTotal,this.totals?.column?.showGrandTotals||!this.indicatorsAsCol&&0===this.columns.length,this.colGrandTotalLabel,this.colSubTotalLabel,this.totals?.column?.showGrandTotalsOnLeft??!1,this.totals?.column?.showSubTotalsOnLeft??!1))}updateFilterRules(t,e=!1){if(this.filterRules=t,e)this.tree={};else for(const t in this.tree)for(const e in this.tree[t])for(let i=0;i<this.tree[t][e].length;i++)this.tree[t][e][i].reset();this.collectedValues={},this.processRecords(),this.processCollectedValuesWithSumBy(),this.processCollectedValuesWithSortBy(),this.dataConfig?.isPivotChart&&this.cacheDeminsionCollectedValues()}getAggregatorRule(t){return this.aggregationRules?.find(((e,i)=>t===e.indicatorKey))}getAggregator(t=[],e=[],i,r=!0){const o=this.indicatorKeys.indexOf(i);let n,s;n="string"==typeof t?t:t.join(this.stringJoinChar),s="string"==typeof e?e:e.join(this.stringJoinChar);const a=this.tree[n]?.[s]?.[o];if(r&&Y(this.changedTree[n]?.[s]?.[o])){const t=this.changedTree[n][s][o];return a?{value:()=>t,formatValue:a.formatValue,formatFun:a.formatFun,records:a.records,className:"",recalculate(){},push(){},clearCacheValue(){},reset(){}}:{value:()=>t,className:"",push(){},recalculate(){},formatValue:()=>t,clearCacheValue(){},reset(){}}}return a||{className:"",push(){},recalculate(){},value:()=>null,formatValue:()=>"",clearCacheValue(){},reset(){}}}sortKeys(){const t=this;if(!this.sorted){this.sorted=!0;const e=function(e,i){return t.getAggregator(e,i,"").value()};switch(this.rowOrder){case"value_a_to_z":this.rowKeys.sort((function(t,i){return lA(e(t,[]),e(i,[]))}));break;case"value_z_to_a":this.rowKeys.sort((function(t,i){return-lA(e(t,[]),e(i,[]))}));break;default:this.rowKeys.sort(this.arrSort(this.rows,!0))}switch(this.colOrder){case"value_a_to_z":this.colKeys.sort((function(t,i){return lA(e([],t),e([],i))}));break;case"value_z_to_a":this.colKeys.sort((function(t,i){return-lA(e([],t),e([],i))}));break;default:const t=this.arrSort(this.columns,!1);this.colKeys.sort(t)}}}arrSort(t,e){let i;const r=this,o=function(o){const n=[];for(let o=0,s=t.length;o<s;o++)if(i=t[o],r.sortRules)for(let t=0,s=r.sortRules.length;t<s;t++)r.sortRules[t].sortField===i&&n.push({field:i,fieldIndex:o,sortRule:r.sortRules[t],func:r.getSort(r.sortRules[t],e)});return n}.call(this);return function(i,n){let s,a;for(let l=0;l<o.length;l++){if(a=o[l],a.sortRule?.sortByIndicator){let o=i,l=n;a.fieldIndex<t.length-1&&(o=i.slice(0,a.fieldIndex+1),o.push(e?r.rowSubTotalLabel:r.colSubTotalLabel),l=n.slice(0,a.fieldIndex+1),l.push(e?r.rowSubTotalLabel:r.colSubTotalLabel)),s=a.func(o,l)}else s=a.func?.(i[a.fieldIndex],n[a.fieldIndex]);if(0!==s)return s*(a.sortRule?.sortType===sC.DESC?-1:1)}return 0}}getSort(t,e){const i=this;return t.sortByIndicator?(r,o)=>{const n=function(e,r){return e.length<i.rows.length&&e[e.length-1]!==i.rowSubTotalLabel&&e[e.length-1]!==i.rowGrandTotalLabel&&e.push(i.rowSubTotalLabel),r.length<i.columns.length&&r[r.length-1]!==i.colSubTotalLabel&&r[r.length-1]!==i.colGrandTotalLabel&&r.push(i.colSubTotalLabel),i.getAggregator(e,r,t.sortByIndicator).value()};return e?lA(n(r,t.query),n(o,t.query)):lA(n(t.query,r),n(t.query,o))}:t.sortBy?function(t){let e;const i={},r={};for(let o=0;o<t.length;o++)e=t[o],i[e]=o,"string"==typeof e&&(r[e.toLowerCase()]=o);return function(t,e){return null!==i[t]&&void 0!==i[t]&&null!==i[e]&&void 0!==i[e]?i[t]-i[e]:null!==i[t]&&void 0!==i[t]?-1:null!==i[e]&&void 0!==i[e]?1:null!==r[t]&&void 0!==i[t]&&null!==r[e]&&void 0!==i[e]?r[t]-r[e]:null===r[t]||void 0===i[t]||null===r[e]||void 0===i[e]?0:null!==r[t]&&void 0!==i[t]?-1:null!==r[e]&&void 0!==i[e]?1:lA(t,e)}}(t.sortBy):t.sortType?aA:t.sortFunc?t.sortFunc:lA}totalStatistics(){const t=this;if(t?.totals?.column?.subTotalsDimensions?.length>=1||t?.totals?.row?.subTotalsDimensions?.length>=1||t?.totals?.column?.showGrandTotals||t?.totals?.row?.showGrandTotals){const e=[],i=(e,i)=>{if(this.totalRecordsTree?.[e]?.[i])return void(this.tree[e][i]=this.totalRecordsTree?.[e]?.[i]);const r=i.split(this.stringJoinChar);for(let o=0,n=t.totals?.column?.subTotalsDimensions?.length;o<n;o++){const n=t.totals.column.subTotalsDimensions[o],s=t.columns.indexOf(n);if(s>=0){const o=r.slice(0,s+1);o.push(t.colSubTotalLabel);const n=o.join(this.stringJoinChar);if(this.totalRecordsTree?.[e]?.[n])return void(this.tree[e][n]=this.totalRecordsTree?.[e]?.[n]);this.tree[e][n]||(this.tree[e][n]=[]);for(let r=0;r<this.indicatorKeys.length;r++){if(!this.tree[e][n][r]){const t=this.getAggregatorRule(this.indicatorKeys[r]);this.tree[e][n][r]=new this.aggregators[t?.aggregationType??nC.SUM](t?.field??this.indicatorKeys[r],t?.formatFun??this.indicators?.find((t=>"string"!=typeof t&&t.indicatorKey===this.indicatorKeys[r]))?.format)}this.tree[e][n][r].push(t.tree[e]?.[i]?.[r])}}}if(t.totals?.column?.showGrandTotals||0===this.rows.length){const r=t.colGrandTotalLabel;if(this.totalRecordsTree?.[e]?.[r])return void(this.tree[e][r]=this.totalRecordsTree?.[e]?.[r]);this.tree[e][r]||(this.tree[e][r]=[]);for(let o=0;o<this.indicatorKeys.length;o++){if(!this.tree[e][r][o]){const t=this.getAggregatorRule(this.indicatorKeys[o]);this.tree[e][r][o]=new this.aggregators[t?.aggregationType??nC.SUM](t?.field??this.indicatorKeys[o],t?.formatFun??this.indicators?.find((t=>"string"!=typeof t&&t.indicatorKey===this.indicatorKeys[o]))?.format)}this.tree[e][r][o].push(t.tree[e]?.[i]?.[o])}}};Object.keys(t.tree).forEach((r=>{const o=r.split(this.stringJoinChar);Object.keys(t.tree[r]).forEach((n=>{for(let i=0,s=t.totals?.row?.subTotalsDimensions?.length;i<s;i++){const s=t.totals.row.subTotalsDimensions[i],a=t.rows.indexOf(s);if(a>=0&&a<t.rows.length-1){const i=o.slice(0,a+1);"grid"===this.rowHierarchyType&&i.push(t.rowSubTotalLabel);const s=i.join(this.stringJoinChar);this.tree[s]||(this.tree[s]={},e.push(s)),this.tree[s][n]||(this.tree[s][n]=[]);for(let e=0;e<this.indicatorKeys.length;e++){if(!this.tree[s][n][e]){const t=this.getAggregatorRule(this.indicatorKeys[e]);this.tree[s][n][e]=new this.aggregators[t?.aggregationType??nC.SUM](t?.field??this.indicatorKeys[e],t?.formatFun??this.indicators?.find((t=>"string"!=typeof t&&t.indicatorKey===this.indicatorKeys[e]))?.format)}this.tree[s][n][e].push(t.tree[r]?.[n]?.[e])}}}if(t.totals?.row?.showGrandTotals||0===this.columns.length){const i=t.rowGrandTotalLabel;this.tree[i]||(this.tree[i]={},e.push(i)),this.tree[i][n]||(this.tree[i][n]=[]);for(let e=0;e<this.indicatorKeys.length;e++){if(!this.tree[i][n][e]){const t=this.getAggregatorRule(this.indicatorKeys[e]);this.tree[i][n][e]=new this.aggregators[t?.aggregationType??nC.SUM](t?.field??this.indicatorKeys[e],t?.formatFun??this.indicators?.find((t=>"string"!=typeof t&&t.indicatorKey===this.indicatorKeys[e]))?.format)}this.tree[i][n][e].push(t.tree[r]?.[n]?.[e])}}i(r,n)}))})),e.forEach((e=>{Object.keys(t.tree[e]).forEach((t=>{i(e,t)}))}))}}ArrToTree1(t,e,i,r,o){const n=[],s=this.stringJoinChar,a=new Map;function l(t){const r=[];let o;t.forEach(((l,h)=>{r.push(l);const c=r.join(s);let d=a.get(c);d||(d={value:l,dimensionKey:e[h],children:h===t.length-1&&i?.length>=1?i?.map((t=>"string"==typeof t?{indicatorKey:t,value:t}:{indicatorKey:t.indicatorKey,value:t.title})):[]},a.set(c,d),o?o.children.push(d):n.push(d)),o=d}))}return t.forEach((t=>l(t))),r&&l([o]),n}ArrToTree(t,e,i,r,o,n,s,a,l){let h=[];const c=this.stringJoinChar,d=new Map;if(t?.length?t.forEach((t=>function(t){const o=[];let n;t.forEach(((a,u)=>{o.push(a);const g=o.join(c);let p=d.get(g);if(!p){if(p={value:a,dimensionKey:e[u],children:u===t.length-1&&i?.length>=1?i?.map((t=>"string"==typeof t?{indicatorKey:t,value:t}:{indicatorKey:t.indicatorKey,value:t.title})):[]},r[u]){let t=p.children;const o={value:s,dimensionKey:e[u+1],levelSpan:r.length-u-1,children:i?.length>=1?i?.map((t=>"string"==typeof t?{indicatorKey:t,value:t}:{indicatorKey:t.indicatorKey,value:t.title})):[]};t.push(o),t=o.children}d.set(g,p),n?r[u-1]&&!l?n.children.splice(n.children.length-1,0,p):n.children.push(p):h.push(p)}n=p}))}(t))):i&&(h=i?.map((t=>({indicatorKey:t.indicatorKey,value:t.title??t.indicatorKey})))),o&&t?.length){const t={value:n,dimensionKey:e[0],levelSpan:r.length,children:i?.map((t=>"string"==typeof t?{indicatorKey:t,value:t}:{indicatorKey:t.indicatorKey,value:t.title}))??[]};a?h.unshift(t):h.push(t)}return h}TreeToArr(t){const e=[];function i(t,r){r.push(t.id),t.children.length>0?t.children?.forEach((t=>i(t,[...r]))):e.push(r)}return t.forEach((t=>i(t,[]))),e}cacheDeminsionCollectedValues(){for(const t in this.collectValuesBy)"xField"!==this.collectValuesBy[t].type&&"yField"!==this.collectValuesBy[t].type||(this.dataConfig.dimensionSortArray?this.cacheCollectedValues[t]=CE(this.collectedValues[t],this.dataConfig.dimensionSortArray):this.cacheCollectedValues[t]=this.collectedValues[t])}_adjustCustomTree(t){const e=(t,i)=>{t.forEach((t=>{t.indicatorKey||i||t.children?.length&&t.children?t.children&&Array.isArray(t.children)&&e(t.children,i||!!t.indicatorKey):t.children=this.indicators?.map((t=>({indicatorKey:t.indicatorKey,value:t.title??t.indicatorKey})))}))};return t?.length?e(t,!1):t=this.indicators?.map((t=>({indicatorKey:t.indicatorKey,value:t.title??t.indicatorKey}))),t}changeTreeNodeValue(t=[],e=[],i,r){const o=this.indicatorKeys.indexOf(i);let n,s;n="string"==typeof t?t:t.join(this.stringJoinChar),s="string"==typeof e?e:e.join(this.stringJoinChar),this.changedTree[n]?.[s]?this.changedTree[n][s][o]=r:this.changedTree[n]?(this.changedTree[n][s]=[],this.changedTree[n][s][o]=r):(this.changedTree[n]={},this.changedTree[n][s]=[],this.changedTree[n][s][o]=r)}changeRecordFieldValue(t,e,i){let r=!1;for(let e=0;e<this.indicatorKeys.length;e++)this.indicatorKeys[e]===t&&(r=!0);if(!r){if(Array.isArray(this.records))for(let r=0,o=this.records.length;r<o;r++){const o=this.records[r];o[t]===e&&(o[t]=i)}else for(const r in this.records)for(let o=0,n=this.records[r].length;o<n;o++){const n=this.records[r][o];n[t]===e&&(n[t]=i)}this.rowFlatKeys={},this.colFlatKeys={},this.tree={},this.processRecords()}}}function CE(t,e){return t.sort(((t,i)=>{const r=e.indexOf(t),o=e.indexOf(i);return r<o?-1:r>o?1:0}))}class wE extends hs{constructor(t){t.direction&&(t.flexDirection=t.direction),!t.justifyContent||"start"!==t.justifyContent&&"end"!==t.justifyContent||(t.justifyContent="flex-"+t.justifyContent),!t.alignItems||"start"!==t.alignItems&&"end"!==t.alignItems||(t.alignItems="flex-"+t.alignItems),!t.alignContent||"start"!==t.alignContent&&"end"!==t.alignContent||(t.alignContent="flex-"+t.alignContent),t.display="flex",t.flexDirection||(t.flexDirection="row"),t.clip=!0,t.fill=t?.background?.fill,t.stroke=t?.background?.stroke,t.lineWidth=t?.background?.lineWidth,t.cornerRadius=t?.background?.cornerRadius;const e=et(t.boundsPadding),i=[t.marginTop??(e?t.boundsPadding[0]:t.boundsPadding)??0,t.marginRight??(e?t.boundsPadding[1]:t.boundsPadding)??0,t.marginBottom??(e?t.boundsPadding[2]??t.boundsPadding[0]:t.boundsPadding)??0,t.marginLeft??(e?t.boundsPadding[3]??t.boundsPadding[1]:t.boundsPadding)??0];t.boundsPadding=i,super(t)}}var vE=Object.freeze({__proto__:null,Arc:class extends Dl{constructor(t){const e=et(t.boundsPadding),i=[t.marginTop??(e?t.boundsPadding[0]:t.boundsPadding)??0,t.marginRight??(e?t.boundsPadding[1]:t.boundsPadding)??0,t.marginBottom??(e?t.boundsPadding[2]??t.boundsPadding[0]:t.boundsPadding)??0,t.marginLeft??(e?t.boundsPadding[3]??t.boundsPadding[1]:t.boundsPadding)??0];t.boundsPadding=i,super(t)}},CheckBox:h_,Circle:class extends $s{constructor(t){const e=et(t.boundsPadding),i=[t.marginTop??(e?t.boundsPadding[0]:t.boundsPadding)??0,t.marginRight??(e?t.boundsPadding[1]:t.boundsPadding)??0,t.marginBottom??(e?t.boundsPadding[2]??t.boundsPadding[0]:t.boundsPadding)??0,t.marginLeft??(e?t.boundsPadding[3]??t.boundsPadding[1]:t.boundsPadding)??0];t.boundsPadding=i,super(t)}},Container:wE,Group:class extends hs{constructor(t){const e=et(t.boundsPadding),i=[t.marginTop??(e?t.boundsPadding[0]:t.boundsPadding)??0,t.marginRight??(e?t.boundsPadding[1]:t.boundsPadding)??0,t.marginBottom??(e?t.boundsPadding[2]??t.boundsPadding[0]:t.boundsPadding)??0,t.marginLeft??(e?t.boundsPadding[3]??t.boundsPadding[1]:t.boundsPadding)??0];t.boundsPadding=i,super(t)}},GroupElement:class extends wE{constructor(t){t.flexWrap="nowrap",super(t)}},Icon:class extends Sl{svg;iconName;cache;constructor(t){let e;if(tt(t.iconName)){e=xR()[t.iconName],e&&(t.width=t.width??e.width,t.height=t.height??e.height,t.svg=e.svg,t.cursor=e.cursor)}t.svg&&(t.image=t.svg);const i=et(t.boundsPadding),r=[t.marginTop??(i?t.boundsPadding[0]:t.boundsPadding)??0,t.marginRight??(i?t.boundsPadding[1]:t.boundsPadding)??0,t.marginBottom??(i?t.boundsPadding[2]??t.boundsPadding[0]:t.boundsPadding)??0,t.marginLeft??(i?t.boundsPadding[3]??t.boundsPadding[1]:t.boundsPadding)??0];t.boundsPadding=r,super(t),this.cache=e}},Image:class extends Sl{constructor(t){t.src&&(t.image=t.src),"circle"===t.shape&&(t.cornerRadius=t.width/2);const e=et(t.boundsPadding),i=[t.marginTop??(e?t.boundsPadding[0]:t.boundsPadding)??0,t.marginRight??(e?t.boundsPadding[1]:t.boundsPadding)??0,t.marginBottom??(e?t.boundsPadding[2]??t.boundsPadding[0]:t.boundsPadding)??0,t.marginLeft??(e?t.boundsPadding[3]??t.boundsPadding[1]:t.boundsPadding)??0];t.boundsPadding=i,super(t)}},Radio:c_,Rect:class extends pl{constructor(t){const e=et(t.boundsPadding),i=[t.marginTop??(e?t.boundsPadding[0]:t.boundsPadding)??0,t.marginRight??(e?t.boundsPadding[1]:t.boundsPadding)??0,t.marginBottom??(e?t.boundsPadding[2]??t.boundsPadding[0]:t.boundsPadding)??0,t.marginLeft??(e?t.boundsPadding[3]??t.boundsPadding[1]:t.boundsPadding)??0];t.boundsPadding=i,super(t)}},Tag:class extends yv{constructor(t){const e=et(t.boundsPadding),i=[t.marginTop??(e?t.boundsPadding[0]:t.boundsPadding)??0,t.marginRight??(e?t.boundsPadding[1]:t.boundsPadding)??0,t.marginBottom??(e?t.boundsPadding[2]??t.boundsPadding[0]:t.boundsPadding)??0,t.marginLeft??(e?t.boundsPadding[3]??t.boundsPadding[1]:t.boundsPadding)??0];t.boundsPadding=i,super(t)}getSize(t){this.AABBBounds.width()}},Text:class extends ta{constructor(t){t.textBaseline||(t.textBaseline="top");const e=et(t.boundsPadding),i=[t.marginTop??(e?t.boundsPadding[0]:t.boundsPadding)??0,t.marginRight??(e?t.boundsPadding[1]:t.boundsPadding)??0,t.marginBottom??(e?t.boundsPadding[2]??t.boundsPadding[0]:t.boundsPadding)??0,t.marginLeft??(e?t.boundsPadding[3]??t.boundsPadding[1]:t.boundsPadding)??0];t.boundsPadding=i,t.fill=t.fill??"#000",super(t)}getSize(t){this.AABBBounds.width()}},percentCalc:function(t,e=0){return{percent:t,delta:e}}});function xE(t){const e={isPivotChart:!0},i=t.rows?.reduce(((t,e)=>("string"==typeof e?t.push(e):t.push(e.dimensionKey),t)),[])??[],r=t.columns?.reduce(((t,e)=>("string"==typeof e?t.push(e):t.push(e.dimensionKey),t)),[])??[],o=t.indicators?.reduce(((t,e)=>("string"==typeof e?t.push(e):t.push(e.indicatorKey),t)),[])??[];e.collectValuesBy=function(t,e,i){const r={};for(let o=0,n=t.indicators?.length;o<n;o++)if("string"!=typeof t.indicators[o]&&t.indicators[o].chartSpec)if(!1===t.indicatorsAsCol){const n=t.indicators[o];if(r[n.indicatorKey]={by:i,range:!0,sumBy:!1!==n.chartSpec?.stack&&e.concat(n.chartSpec?.xField)},n.chartSpec.series)n.chartSpec.series.forEach((t=>{const o="string"==typeof t.xField?t.xField:t.xField[0];r[o]={by:e,type:"horizontal"!==t.direction?"xField":void 0,range:"horizontal"===t.direction,sortBy:"horizontal"!==t.direction?t?.data?.fields?.[o]?.domain??n.chartSpec?.data?.fields?.[o]?.domain:void 0};const s=t.yField;r[s]={by:i,range:"horizontal"!==t.direction,sumBy:!1!==t.stack&&e.concat(t?.xField),sortBy:"horizontal"===t.direction?t?.data?.fields?.[s]?.domain??n.chartSpec?.data?.fields?.[s]?.domain:void 0}}));else{const s="string"==typeof n.chartSpec.xField?n.chartSpec.xField:n.chartSpec.xField[0];r[s]={by:e,type:"horizontal"!==n.chartSpec.direction?"xField":void 0,range:"horizontal"===n.chartSpec.direction,sortBy:"horizontal"!==n.chartSpec.direction?n.chartSpec?.data?.fields?.[s]?.domain:void 0};const a=n.chartSpec.yField;r[a]={by:i,range:"horizontal"!==t.indicators[o].chartSpec.direction,sumBy:!1!==n.chartSpec.stack&&e.concat(n.chartSpec?.xField),sortBy:"horizontal"===n.chartSpec.direction?n.chartSpec?.data?.fields?.[a]?.domain:void 0}}}else{const n=t.indicators[o];if(r[n.indicatorKey]={by:e,range:!0,sumBy:!1!==n.chartSpec?.stack&&i.concat(n.chartSpec?.yField)},n.chartSpec.series)n.chartSpec.series.forEach((t=>{const o="string"==typeof t.yField?t.yField:t.yField[0];r[o]={by:i,type:"horizontal"===t.direction?"yField":void 0,range:"horizontal"!==t.direction,sortBy:"horizontal"===t.direction?t?.data?.fields?.[o]?.domain??n.chartSpec?.data?.fields?.[o]?.domain:void 0};const s=t.xField;r[s]={by:e,range:"horizontal"===t.direction,sumBy:!1!==t.stack&&i.concat(t?.yField),sortBy:"horizontal"!==t.direction?t?.data?.fields?.[s]?.domain??n.chartSpec?.data?.fields?.[s]?.domain:void 0}}));else{const s="string"==typeof n.chartSpec.yField?n.chartSpec.yField:n.chartSpec.yField[0];r[s]={by:i,type:"horizontal"===n.chartSpec.direction?"yField":void 0,range:"horizontal"!==n.chartSpec.direction,sortBy:"horizontal"===n.chartSpec.direction?n.chartSpec?.data?.fields?.[s]?.domain:void 0};const a=n.chartSpec.xField;r[a]={by:e,range:"horizontal"===t.indicators[o].chartSpec.direction,sumBy:!1!==n.chartSpec.stack&&i.concat(n.chartSpec?.yField),sortBy:"horizontal"!==n.chartSpec.direction?n.chartSpec?.data?.fields?.[a]?.domain:void 0}}}return r}(t,r,i),e.aggregationRules=function(t){const e=[];return t.indicators?.forEach((i=>{if("string"==typeof i)e.push({indicatorKey:i,field:i,aggregationType:nC.RECORD});else if(i.chartSpec?.series){const r=[];i.chartSpec?.series.forEach((e=>{const i=!1===t.indicatorsAsCol?e.yField:e.xField;-1===r.indexOf(i)&&r.push(i)})),e.push({indicatorKey:i.indicatorKey,field:r,aggregationType:nC.RECORD})}else{const r=!1===t.indicatorsAsCol?i.chartSpec.yField:i.chartSpec.xField;e.push({indicatorKey:i.indicatorKey,field:r??i.indicatorKey,aggregationType:nC.RECORD})}})),e}(t);return new yE(e,i,r,o,t.indicators,t.indicatorsAsCol??!0,t.records,void 0,t.columnTree,t.rowTree,!0)}function _E(t,e,i,r,o,n){if(et(t))for(let l=0;l<t.length;l++)if(n?n(t[l],e):(s=t[l],a=e,JSON.stringify(s)===JSON.stringify(a)))return o.getCellHeaderPaths(i,r);var s,a}tC();t.CustomLayout=vE,t.DataStatistics=JH,t.ListTable=class extends VH{showHeader=!0;editorManager;constructor(t,e){"node"===kC.mode?(e=t,t=null):t instanceof HTMLElement||(e=t,t=t.container?t.container:null),super(t,e);const i=this.internalProps;i.frozenColDragHeaderMode=e.frozenColDragHeaderMode,this.pagination=e.pagination,i.sortState=e.sortState,i.dataConfig={},i.columns=e.columns?jS(e.columns):e.header?jS(e.header):[],e.columns?.forEach(((t,e)=>{t.editor&&(i.columns[e].editor=t.editor)})),this.showHeader=e.showHeader??!0,this.transpose=e.transpose??!1,"node"!==kC.mode&&(this.editorManager=new gE(this)),this.refreshHeader(),e.dataSource?lR(this,e.dataSource):e.records?this.setRecords(e.records,{sortState:i.sortState}):this.setRecords([]),e.title&&(i.title=new uE(e.title,this),this.scenegraph.resize()),setTimeout((()=>{this.fireListeners(ww.INITIALIZED,null)}),0)}isListTable(){return!0}isPivotTable(){return!1}isPivotChart(){return!1}get sortState(){return this.internalProps.sortState}get records(){return this.dataSource?.records}get recordsCount(){return this.dataSource.records.length}updateColumns(t){const e={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.internalProps.columns=jS(t),t.forEach(((t,e)=>{t.editor&&(this.internalProps.columns[e].editor=t.editor)})),this.options.columns=t,this.refreshHeader(),this.scenegraph.clearCells(),this.headerStyleCache=new Map,this.bodyStyleCache=new Map,this.bodyBottomStyleCache=new Map,this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(e.col,e.row),this.renderAsync(),this.eventManager.updateEventBinder()}get columns(){return this.internalProps.layoutMap.columnTree.getCopiedTree()}get header(){return this.internalProps.columns}set header(t){this.internalProps.columns=t,this.options.header=t,this.refreshHeader(),this.renderAsync()}get transpose(){return this.internalProps.transpose??!1}set transpose(t){this.internalProps.transpose!==t&&(this.internalProps.transpose=t,this.options.transpose=t,this.internalProps.layoutMap&&(this.internalProps.layoutMap.transpose=t,this.refreshRowColCount(),this._resetFrozenColCount(),this.renderAsync()))}getCellValue(t,e,i){if(-1===t||-1===e)return null;if(!i){const i=this.getCustomMergeValue(t,e);if(i)return i}const r=this;if(r.internalProps.layoutMap.isSeriesNumber(t,e)){if(r.internalProps.layoutMap.isSeriesNumberInHeader(t,e)){const{title:i}=r.internalProps.layoutMap.getSeriesNumberHeader(t,e);return i}const{format:i}=r.internalProps.layoutMap.getSeriesNumberBody(t,e);return"function"==typeof i?i(t,e,this):e-this.columnHeaderLevelCount+1}if(r.internalProps.layoutMap.isHeader(t,e)){const{title:i}=r.internalProps.layoutMap.getHeader(t,e);return"function"==typeof i?i():i}if(r.internalProps.layoutMap.isAggregation(t,e)){if(r.internalProps.layoutMap.isTopAggregation(t,e)){const i=r.internalProps.layoutMap.getAggregatorOnTop(t,e);return i?.formatValue?i.formatValue(t,e,this):""}if(r.internalProps.layoutMap.isBottomAggregation(t,e)){const i=r.internalProps.layoutMap.getAggregatorOnBottom(t,e);return i?.formatValue?i.formatValue(t,e,this):""}}const{field:o,fieldFormat:n}=r.internalProps.layoutMap.getBody(t,e);return r.getFieldData(n||o,t,e)}getCellOriginValue(t,e){if(-1===t||-1===e)return null;const i=this;if(i.internalProps.layoutMap.isSeriesNumber(t,e)){if(i.internalProps.layoutMap.isSeriesNumberInHeader(t,e)){const{title:r}=i.internalProps.layoutMap.getSeriesNumberHeader(t,e);return r}const{format:r}=i.internalProps.layoutMap.getSeriesNumberBody(t,e);return"function"==typeof r?r(t,e,this):e-this.columnHeaderLevelCount}if(i.internalProps.layoutMap.isHeader(t,e)){const{title:r}=i.internalProps.layoutMap.getHeader(t,e);return"function"==typeof r?r():r}if(i.internalProps.layoutMap.isAggregation(t,e)){if(i.internalProps.layoutMap.isTopAggregation(t,e)){const r=i.internalProps.layoutMap.getAggregatorOnTop(t,e);return r?.value()}if(i.internalProps.layoutMap.isBottomAggregation(t,e)){const r=i.internalProps.layoutMap.getAggregatorOnBottom(t,e);return r?.value()}}const{field:r}=i.internalProps.layoutMap.getBody(t,e);return i.getFieldData(r,t,e)}getCellRawValue(t,e){if(-1===t||-1===e)return null;const i=this;if(i.internalProps.layoutMap.isHeader(t,e)){const{title:r}=i.internalProps.layoutMap.getHeader(t,e);return"function"==typeof r?r():r}const{field:r}=i.internalProps.layoutMap.getBody(t,e);return i.getRawFieldData(r,t,e)}getRecordShowIndexByCell(t,e){const{layoutMap:i}=this.internalProps;return i.getRecordShowIndexByCell(t,e)}getRecordIndexByCell(t,e){const{layoutMap:i}=this.internalProps,r=i.getRecordShowIndexByCell(t,e);return this.dataSource.currentPagerIndexedData[r]}getTableIndexByRecordIndex(t){return this.transpose?this.dataSource.getTableIndex(t)+this.rowHeaderLevelCount:this.dataSource.getTableIndex(t)+this.columnHeaderLevelCount}getTableIndexByField(t){const e=this.internalProps.layoutMap.columnObjects.find((e=>e.field===t)),i=this.internalProps.layoutMap.getBodyLayoutRangeById(e.id);return this.transpose?i.start.row:i.start.col}getCellAddrByFieldRecord(t,e){return this.transpose?{col:this.getTableIndexByRecordIndex(e),row:this.getTableIndexByField(t)}:{col:this.getTableIndexByField(t),row:this.getTableIndexByRecordIndex(e)}}getCellOriginRecord(t,e){const i=this,r=i.getRecordShowIndexByCell(t,e);if(r>-1)return i.dataSource.get(r)}getCellRawRecord(t,e){const i=this,r=i.getRecordShowIndexByCell(t,e);if(r>-1)return i.dataSource.getRaw(r)}_canResizeColumn(t,e){const i=super._canResizeColumn(t,e);if(i&&!this.transpose){const e=this.internalProps.layoutMap.getBody(t,this.columnHeaderLevelCount);if(e?.disableColumnResize)return!1}return i}updateOption(t){const e=this.internalProps;return super.updateOption(t),e.frozenColDragHeaderMode=t.frozenColDragHeaderMode,this.pagination=t.pagination,e.sortState=t.sortState,e.dataConfig={},this.showHeader=t.showHeader??!0,e.columns=t.columns?jS(t.columns):t.header?jS(t.header):[],t.columns.forEach(((t,i)=>{t.editor&&(e.columns[i].editor=t.editor)})),this.transpose=t.transpose??!1,this.refreshHeader(),e.releaseList&&(e.releaseList.forEach((t=>t?.release?.())),e.releaseList=null),t.dataSource?lR(this,t.dataSource):t.records?this.setRecords(t.records,{sortState:t.sortState}):(this._resetFrozenColCount(),this.scenegraph.createSceneGraph(),this.render()),t.title&&(e.title=new uE(t.title,this),this.scenegraph.resize()),new Promise((t=>{setTimeout(t,0)}))}updatePagination(t){this.pagination&&("number"==typeof t.currentPage&&t.currentPage>=0&&(this.pagination.currentPage=t.currentPage),t.perPageCount&&(this.pagination.perPageCount=t.perPageCount||this.pagination.perPageCount),this.internalProps.layoutMap.clearCellRangeMap(),this.scenegraph.clearCells(),this.dataSource.updatePagination(this.pagination),this.refreshRowColCount(),this.scenegraph.createSceneGraph(),this.renderAsync())}refreshHeader(){const t=this,e=t.internalProps,i=t.transpose,r=t.showHeader;(e.layoutMap=new dE(this,e.columns??[],r,t.options.hierarchyIndent)).transpose=i,i||this.setMinMaxLimitWidth(!0),this.refreshRowColCount()}refreshRowColCount(){const t=this,{layoutMap:e}=t.internalProps;e&&(e.recordsCount=(t.internalProps.dataSource?.length??0)+e.hasAggregationOnTopCount+e.hasAggregationOnBottomCount,t.transpose?(t.rowCount=e.rowCount??0,t.colCount=e.colCount??0,t.frozenRowCount=0,this.internalProps.frozenColCount=Math.max((e.headerLevelCount??0)+e.leftRowSeriesNumberColumnCount,this.options.frozenColCount??0),t.bottomFrozenRowCount!==(this.options.bottomFrozenRowCount??0)&&(t.bottomFrozenRowCount=this.options.bottomFrozenRowCount??0),t.rightFrozenColCount!==(this.options.rightFrozenColCount??0)&&(t.rightFrozenColCount=this.options.rightFrozenColCount??0)):(t.colCount=e.colCount??0,t.rowCount=e.recordsCount*e.bodyRowSpanCount+e.headerLevelCount,this.internalProps.frozenColCount=this.options.frozenColCount??0,t.frozenRowCount=e.headerLevelCount,t.bottomFrozenRowCount!==(this.options.bottomFrozenRowCount??0)&&(t.bottomFrozenRowCount=this.options.bottomFrozenRowCount??0),t.rightFrozenColCount!==(this.options.rightFrozenColCount??0)&&(t.rightFrozenColCount=this.options.rightFrozenColCount??0)),this.stateManager.setFrozenCol(this.internalProps.frozenColCount))}getFieldData(t,e,i){if(null===t)return null;const r=this;if(r.internalProps.layoutMap.isHeader(e,i))return null;const o=r.getRecordShowIndexByCell(r.transpose?e-r.internalProps.layoutMap.leftRowSeriesNumberColumnCount:e,i);return r.internalProps.dataSource.getField(o,t,e,i,this)}getRawFieldData(t,e,i){if(null===t)return null;const r=this;if(r.internalProps.layoutMap.isHeader(e,i))return null;const o=r.getRecordShowIndexByCell(e,i);return r.internalProps.dataSource.getRawField(o,t,e,i,this)}_moveHeaderPosition(t,e){const i=this.getCellRange(t.col,t.row),r=this.getCellRange(e.col,e.row),o=this.internalProps.layoutMap.moveHeaderPosition(t,e);return o?("column"===o.moveType?(this.colWidthsMap.exchangeOrder(i.start.col,i.end.col-i.start.col+1,r.start.col,r.end.col-r.start.col+1,o.targetIndex),this.transpose||(this.colWidthsLimit={},this.setMinMaxLimitWidth())):o.targetIndex>o.sourceIndex?this.rowHeightsMap.exchangeOrder(o.sourceIndex,o.sourceSize,o.targetIndex+o.sourceSize-o.targetSize,o.targetSize,o.targetIndex):this.rowHeightsMap.exchangeOrder(o.sourceIndex,o.sourceSize,o.targetIndex,o.targetSize,o.targetIndex),o):null}changeRecordOrder(t,e){this.transpose?(t=this.getRecordShowIndexByCell(t,0),e=this.getRecordShowIndexByCell(e,0)):(t=this.getRecordShowIndexByCell(0,t),e=this.getRecordShowIndexByCell(0,e)),this.dataSource.reorderRecord(t,e)}getCellAddress(t,e){let i;for(let e=0;e<this.internalProps.records.length;e++){const r=this.internalProps.records[e];if("function"==typeof t)t(r)&&(i=e);else{let o=!0;for(const e in t)if(r[e]!==t[e]){o=!1;break}o&&(i=e)}if(Y(i))break}const r=this.getCellRangeByField(e,i);if(r)return{row:r.start.row,col:r.start.col}}getCellRangeByField(t,e){const{layoutMap:i}=this.internalProps,r=i.columnObjects.find((e=>e.field===t));if(r){const t=i.getBodyLayoutRangeById(r.id);let o;return Y(e)&&(o=i.getRecordStartRowByRecordIndex(e)),this.transpose?{start:{row:t.start.row,col:Y(o)?o+t.start.col:void 0},end:{row:t.end.row,col:Y(o)?o+t.end.col:void 0}}:{start:{col:t.start.col,row:Y(o)?o+t.start.row:void 0},end:{col:t.end.col,row:Y(o)?o+t.end.row:void 0}}}return null}getHierarchyState(t,e){if(!this.getBodyColumnDefine(t,e).tree)return oC.none;const i=this.getRecordShowIndexByCell(t,e);return this.dataSource.getHierarchyState(i)}toggleHierarchyState(t,e){this.stateManager.updateHoverIcon(t,e,void 0,void 0);const i=this.getHierarchyState(t,e);if(i===oC.expand)this._refreshHierarchyState(t,e),this.fireListeners(ww.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:oC.collapse});else if(i===oC.collapse){const i=this.getCellOriginRecord(t,e);Array.isArray(i.children)&&this._refreshHierarchyState(t,e),this.fireListeners(ww.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:oC.expand,originData:i})}}_refreshHierarchyState(t,e){let i=!1,r=!1;const o=this.internalProps.layoutMap.checkHasChart();o&&(this.autoFillWidth&&(i=this.getAllColsWidth()<=this.tableNoFrameWidth),this.autoFillHeight&&(r=this.getAllRowsHeight()<=this.tableNoFrameHeight));const n=this.getRecordShowIndexByCell(t,e),s=this.dataSource.toggleHierarchyState(n,this.scenegraph.proxy.rowStart-this.columnHeaderLevelCount,Math.max(this.scenegraph.proxy.rowEnd-this.columnHeaderLevelCount,this.scenegraph.proxy.rowStart-this.columnHeaderLevelCount+this.scenegraph.proxy.rowLimit-1)),a=this.internalProps.layoutMap.toggleHierarchyState(s);this.refreshRowColCount(),this.clearCellStyleCache(),this.internalProps.layoutMap.clearCellRangeMap(),this.scenegraph.updateHierarchyIcon(t,e),this.scenegraph.updateRow(a.removeCellPositions,a.addCellPositions),o&&(this.autoFillWidth&&!i&&(i=this.getAllColsWidth()<=this.tableNoFrameWidth),this.autoFillHeight&&!r&&(r=this.getAllRowsHeight()<=this.tableNoFrameHeight),("adaptive"===this.widthMode||i||"adaptive"===this.heightMode||r)&&this.scenegraph.updateChartSize(0))}_hasHierarchyTreeHeader(){return(this.options.columns??this.options.header)?.some(((t,e)=>t.tree))}getMenuInfo(t,e,i){return{field:this.getHeaderField(t,e),value:this.getCellValue(t,e),cellLocation:this.getCellLocation(t,e),event:void 0}}_getSortFuncFromHeaderOption(t,e,i){if(t||(t=this.internalProps.columns),e&&t&&t.length>0)for(let r=0;r<t.length;r++){const o=t[r];if((i&&i===o.fieldKey||!i&&o.field===e)&&o.sort&&"function"==typeof o.sort)return o.sort;if(o.columns){const t=this._getSortFuncFromHeaderOption(o.columns,e,i);if(t)return t}}}updateSortState(t,e=!0){if(t)this.internalProps.sortState=t;else if(this.internalProps.sortState)if(Array.isArray(this.internalProps.sortState))for(let t=0;t<this.internalProps.sortState.length;t++){this.internalProps.sortState[t].order="normal"}else this.internalProps.sortState.order="normal";let i,r;if(Array.isArray(this.internalProps.sortState)?({order:i,field:r}=this.internalProps.sortState?.[0]):({order:i,field:r}=this.internalProps.sortState),r&&e){const t=this._getSortFuncFromHeaderOption(this.internalProps.columns,r),e=this.internalProps.layoutMap.headerObjects.find((t=>t&&t.field===r));!1!==e.define.sort&&(this.dataSource.sort(e.field,i,t),this.internalProps.layoutMap.clearCellRangeMap(),this.scenegraph.sortCell())}this.stateManager.updateSortState(t)}updateFilterRules(t){this.scenegraph.clearCells(),this.sortState?(this.dataSource.updateFilterRulesForSorted(t),dR(this)):this.dataSource.updateFilterRules(t),this.refreshRowColCount(),this.scenegraph.createSceneGraph()}getCheckboxState(t){return this.stateManager.checkedState.length<this.rowCount-this.columnHeaderLevelCount&&this.stateManager.initLeftRecordsCheckState(this.records),Y(t)?this.stateManager.checkedState.map((e=>e[t])):this.stateManager.checkedState}getCellCheckboxState(t,e){const i=this.getBodyColumnDefine(t,e),r=i?.field,o=this.getCellType(t,e);if(Y(r)&&"checkbox"===o){const i=this.dataSource.getIndexKey(this.getRecordShowIndexByCell(t,e));return this.stateManager.checkedState[i][r]}}getRadioState(t){return Y(t)?this.stateManager.radioState[t]:this.stateManager.radioState}getCellRadioState(t,e){return function(t,e,i){const r=i.getBodyColumnDefine(t,e),o=r?.field,n=i.getCellType(t,e);if(Y(o)&&"checkbox"===n){const r=i.dataSource.getIndexKey(i.getRecordShowIndexByCell(t,e)),n=i.stateManager.radioState?.[o];if(ot(n)){if(n===r)return!0}else if(q(n)){const t=n[r];if(ot(t))return t}}return!1}(t,e,this)}setCellCheckboxState(t,e,i){!function(t,e,i,r){const o=r.scenegraph.getCell(t,e),n=o?.getChildByName("checkbox");if(!n)return;const{checked:s,indeterminate:a}=n.attribute;a?(i||n._handlePointerUp(),n._handlePointerUp()):s?i||n._handlePointerUp():i&&n._handlePointerUp()}(t,e,i,this)}setCellRadioState(t,e,i){!function(t,e,i,r){const o=r.scenegraph.getCell(t,e);if(o)if(ot(i)){const t=o.getChildAt(i);t?._handlePointerUp()}else{const t=o.getChildByName("radio");t?._handlePointerUp()}}(t,e,i,this)}setRecords(t,e){let i;this.internalProps.dataSource?.release(),this.internalProps.releaseList=this.internalProps.releaseList?.filter((t=>!t.dataSourceObj)),this.internalProps.dataSource=null,Array.isArray(e)||e?.order?i=e:e?i=e.sortState:null===e&&(i=null),"undefined"!=typeof window&&window.performance.now();const r={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};if(this.scenegraph.clearCells(),void 0!==i&&(this.internalProps.sortState=i,this.stateManager.setSortState(this.sortState)),t){if(aR(this,t),this.sortState){let t,e;if(Array.isArray(this.sortState)?0!==this.sortState.length&&({order:t,field:e}=this.sortState?.[0]):({order:t,field:e}=this.sortState),t&&e&&"normal"!==t){const i=this._getSortFuncFromHeaderOption(void 0,e),r=this.internalProps.layoutMap.headerObjects.find((t=>t&&t.field===e));!1!==r.define.sort&&this.dataSource.sort(r.field,t,i??XC)}}this.refreshRowColCount()}else aR(this,t);this.stateManager.initCheckedState(t),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(r.col,r.row),this.internalProps.title&&!this.internalProps.title.isReleased&&(this._updateSize(),this.internalProps.title.resize(),this.scenegraph.resize()),this.render(),Y(r.col)&&Y(r.row)&&r.col>=0&&r.row>=0&&setTimeout((()=>{this.internalProps.tooltipHandler.showTooltip(r.col,r.row)}),0)}setRecordChildren(t,e,i){const r=this.getCellOriginRecord(e,i);r.children=t;const o=this.getRecordShowIndexByCell(e,i);this.dataSource.setRecord(r,o),this._refreshHierarchyState(e,i)}startEditCell(t,e){if(Y(t)&&Y(e))this.selectCell(t,e),this.editorManager.startEditCell(t,e);else if(this.stateManager.select?.cellPos){const{col:t,row:e}=this.stateManager.select.cellPos;Y(t)&&Y(e)&&this.editorManager.startEditCell(t,e)}}completeEditCell(){this.editorManager.completeEdit()}getEditor(t,e){const i=this.getBodyColumnDefine(t,e);let r=this.isHeader(t,e)?i?.headerEditor??this.options.headerEditor:i?.editor??this.options.editor;if("function"==typeof r){r=r({col:t,row:e,dataValue:this.getCellOriginValue(t,e),value:this.getCellValue(t,e)||"",table:this})}return"string"==typeof r?$H(r):r}isHasEditorDefine(t,e){const i=this.getBodyColumnDefine(t,e);let r=this.isHeader(t,e)?i?.headerEditor??this.options.headerEditor:i?.editor??this.options.editor;if("function"==typeof r){r=r({col:t,row:e,dataValue:this.getCellOriginValue(t,e),value:this.getCellValue(t,e)||"",table:this})}return Y(r)}changeCellValue(t,e,i,r=!1){if(r&&this.isHasEditorDefine(t,e)||!1===r){const r=this.getRecordShowIndexByCell(t,e),{field:o}=this.internalProps.layoutMap.getBody(t,e),n=this.getCellRawValue(t,e),s=this.getCellOriginValue(t,e);this.isHeader(t,e)?this.internalProps.layoutMap.updateColumnTitle(t,e,i):this.dataSource.changeFieldValue(i,r,o,t,e,this);const a=this.getCellRange(t,e),l=this.internalProps.layoutMap.getAggregatorsByCell(t,e);if(l){if(Array.isArray(l))for(let t=0;t<l?.length;t++)l[t].recalculate();else l.recalculate();const t=this.internalProps.layoutMap.getAggregatorCellAddress(a.start.col,a.start.row,a.end.col,a.end.row);for(let e=0;e<t.length;e++){const i=this.getCellRange(t[e].col,t[e].row);for(let t=i.start.col;t<=i.end.col;t++)for(let e=i.start.row;e<=i.end.row;e++)this.scenegraph.updateCellContent(t,e)}}for(let t=a.start.col;t<=a.end.col;t++)for(let e=a.start.row;e<=a.end.row;e++)this.scenegraph.updateCellContent(t,e);if("adaptive"===this.widthMode||this.autoFillWidth&&this.getAllColsWidth()<=this.tableNoFrameWidth)0===this.internalProps._widthResizedColMap.size&&this.scenegraph.recalculateColWidths();else if(!this.internalProps._widthResizedColMap.has(t)){const e=this.getColWidth(t),i=XM(t,0,this.rowCount-1,this,!1);i!==e&&this.scenegraph.updateColWidth(t,i-e)}if("adaptive"===this.heightMode||this.autoFillHeight&&this.getAllRowsHeight()<=this.tableNoFrameHeight)0===this.internalProps._heightResizedRowMap.size&&this.scenegraph.recalculateRowHeights();else if("autoHeight"===this.heightMode&&!this.internalProps._heightResizedRowMap.has(e)){const t=this.getRowHeight(e),i=VB(e,0,this.colCount-1,this);this.scenegraph.updateRowHeight(e,i-t)}this.fireListeners(ww.CHANGE_CELL_VALUE,{col:t,row:e,rawValue:n,currentValue:s,changedValue:this.getCellOriginValue(t,e)}),this.scenegraph.updateNextFrame()}}changeCellValues(t,e,i,r=!1){let o=t,n=e;for(let s=0;s<i.length&&!(e+s>this.rowCount-1);s++){n=e+s;const a=i[s];let l=t;for(let i=0;i<a.length&&!(t+i>this.colCount-1);i++)if(l=t+i,r&&this.isHasEditorDefine(t+i,e+s)||!1===r){const r=a[i],o=this.getRecordShowIndexByCell(t+i,e+s),{field:n}=this.internalProps.layoutMap.getBody(t+i,e+s),l=this.getCellRawValue(t+i,e+s),h=this.getCellOriginValue(t+i,e+s);this.isHeader(t+i,e+s)?this.internalProps.layoutMap.updateColumnTitle(t+i,e+s,r):this.dataSource.changeFieldValue(r,o,n,t+i,e+s,this),this.fireListeners(ww.CHANGE_CELL_VALUE,{col:t+i,row:e+s,rawValue:l,currentValue:h,changedValue:this.getCellOriginValue(t+i,e+s)})}o=Math.max(o,l)}const s=this.getCellRange(t,e),a=this.getCellRange(o,n),l=this.internalProps.layoutMap.getAggregatorsByCellRange(s.start.col,s.start.row,a.end.col,a.end.row);if(l){for(let t=0;t<l?.length;t++)l[t].recalculate();const t=this.internalProps.layoutMap.getAggregatorCellAddress(s.start.col,s.start.row,a.end.col,a.end.row);for(let e=0;e<t.length;e++){const i=this.getCellRange(t[e].col,t[e].row);for(let t=i.start.col;t<=i.end.col;t++)for(let e=i.start.row;e<=i.end.row;e++)this.scenegraph.updateCellContent(t,e)}}for(let t=s.start.col;t<=a.end.col;t++)for(let e=s.start.row;e<=a.end.row;e++)this.scenegraph.updateCellContent(t,e);if("adaptive"===this.widthMode||this.autoFillWidth&&this.getAllColsWidth()<=this.tableNoFrameWidth)0===this.internalProps._widthResizedColMap.size&&this.scenegraph.recalculateColWidths();else for(let e=t;e<=a.end.col;e++)if(!this.internalProps._widthResizedColMap.has(e)){const t=this.getColWidth(e),i=XM(e,0,this.rowCount-1,this,!1);i!==t&&this.scenegraph.updateColWidth(e,i-t)}if("adaptive"===this.heightMode||this.autoFillHeight&&this.getAllRowsHeight()<=this.tableNoFrameHeight)this.scenegraph.recalculateRowHeights();else if("autoHeight"===this.heightMode){const t=[],i=[];for(let r=e;r<=a.end.row;r++)if(this.rowHeightsMap.get(r)){const e=this.getRowHeight(r),o=VB(r,0,this.colCount-1,this);t.push(r),i.push(o-e)}this.scenegraph.updateRowsHeight(t,i)}this.scenegraph.updateNextFrame()}addRecord(t,e){if(this.sortState)this.dataSource.addRecordForSorted(t),dR(this),this.refreshRowColCount(),this.scenegraph.clearCells(),this.scenegraph.createSceneGraph();else{(void 0===e||e>this.dataSource.sourceLength)&&(e=this.dataSource.sourceLength);const i=this.transpose?this.rowHeaderLevelCount:this.columnHeaderLevelCount;this.dataSource.addRecord(t,e);const r=this.rowCount;if(this.refreshRowColCount(),0===this.scenegraph.proxy.totalActualBodyRowCount)return this.scenegraph.clearCells(),void this.scenegraph.createSceneGraph();const o=this.transpose?this.colCount:this.rowCount;if(this.pagination){const{perPageCount:t,currentPage:n}=this.pagination,s=t*(n||0)+t;if(e<s)if(e<s-t)this.scenegraph.clearCells(),this.scenegraph.createSceneGraph();else{const n=e-(s-t)+i;if(r-i===this.pagination.perPageCount){const t=[];for(let e=n;e<o;e++)this.transpose?t.push({col:e,row:0}):t.push({col:0,row:e});this.transpose?this.scenegraph.updateCol([],[],t):this.scenegraph.updateRow([],[],t)}else{const t=[];for(let e=n;e<Math.min(o,n+1);e++)this.transpose?t.push({col:e,row:0}):t.push({col:0,row:e});this.transpose?this.scenegraph.updateCol([],t,[]):this.scenegraph.updateRow([],t,[])}}}else{const t=[];for(let r=e+i;r<e+i+1;r++)this.transpose?t.push({col:r,row:0}):t.push({col:0,row:r});this.transpose?this.scenegraph.updateCol([],t,[]):this.scenegraph.updateRow([],t,[])}}}addRecords(t,e){if(this.sortState)this.dataSource.addRecordsForSorted(t),dR(this),this.refreshRowColCount(),this.scenegraph.clearCells(),this.scenegraph.createSceneGraph();else{void 0===e||e>this.dataSource.sourceLength?e=this.dataSource.sourceLength:e<0&&(e=0);const i=this.transpose?this.rowHeaderLevelCount:this.columnHeaderLevelCount;this.dataSource.addRecords(t,e);const r=this.transpose?this.colCount:this.rowCount;if(this.refreshRowColCount(),0===this.scenegraph.proxy.totalActualBodyRowCount)return this.scenegraph.clearCells(),void this.scenegraph.createSceneGraph();const o=this.transpose?this.colCount:this.rowCount;if(this.pagination){const{perPageCount:n,currentPage:s}=this.pagination,a=n*(s||0)+n;if(e<a)if(e<a-n)this.scenegraph.clearCells(),this.scenegraph.createSceneGraph();else{const s=e-(a-n)+i;if(r-i===this.pagination.perPageCount){const t=[];for(let e=s;e<o;e++)this.transpose?t.push({col:e,row:0}):t.push({col:0,row:e});this.transpose?this.scenegraph.updateCol([],[],t):this.scenegraph.updateRow([],[],t)}else{const e=[];for(let i=s;i<Math.min(o,s+(Array.isArray(t)?t.length:1));i++)this.transpose?e.push({col:i,row:0}):e.push({col:0,row:i});this.transpose?this.scenegraph.updateCol([],e,[]):this.scenegraph.updateRow([],e,[])}}}else{const r=[];for(let o=e+i;o<e+i+(Array.isArray(t)?t.length:1);o++)this.transpose?r.push({col:o,row:0}):r.push({col:0,row:o});this.transpose?this.scenegraph.updateCol([],r,[]):this.scenegraph.updateRow([],r,[])}}}deleteRecords(t){if(t?.length>0)if(this.sortState)this.dataSource.deleteRecordsForSorted(t),dR(this),this.refreshRowColCount(),this.scenegraph.clearCells(),this.scenegraph.createSceneGraph();else{const e=this.dataSource.deleteRecords(t);if(0===e.length)return;const i=this.transpose?this.colCount:this.rowCount;this.refreshRowColCount();const r=this.transpose?this.colCount:this.rowCount,o=e.sort(((t,e)=>t-e)),n=o[0];if(this.pagination){const{perPageCount:t,currentPage:e}=this.pagination,o=t*(e||0)+t;if(n<o)if(n<o-t)this.scenegraph.clearCells(),this.scenegraph.createSceneGraph();else{const e=[],s=[];for(let i=n-(o-t)+(this.transpose?this.rowHeaderLevelCount:this.columnHeaderLevelCount);i<r;i++)this.transpose?e.push({col:i,row:0}):e.push({col:0,row:i});if(r<i)for(let t=r;t<i;t++)this.transpose?s.push({col:t,row:0}):s.push({col:0,row:t});this.transpose?this.scenegraph.updateCol(s,[],e):this.scenegraph.updateRow(s,[],e)}}else{const t=[];for(let e=0;e<o.length;e++){const i=o[e]+(this.transpose?this.rowHeaderLevelCount:this.columnHeaderLevelCount);this.transpose?t.push({col:i,row:0}):t.push({col:0,row:i})}this.transpose?this.scenegraph.updateCol(t,[],[]):this.scenegraph.updateRow(t,[],[])}}}updateRecords(t,e){if(e?.length>0)if(this.sortState)this.dataSource.updateRecordsForSorted(t,e),dR(this),this.refreshRowColCount(),this.scenegraph.clearCells(),this.scenegraph.createSceneGraph();else{const i=this.dataSource.updateRecords(t,e);if(0===i.length)return;const r=i.sort(((t,e)=>t-e));if(this.pagination){const{perPageCount:t,currentPage:e}=this.pagination,i=t*(e||0)+t,o=[];for(let e=0;e<r.length;e++){const n=r[e];if(n<i&&n>=i-t){const e=n-(i-t)+(this.transpose?this.rowHeaderLevelCount:this.columnHeaderLevelCount);o.push(e)}}if(o.length>=1){const t=[];for(let e=0;e<o.length;e++){const i=o[e];this.transpose?t.push({col:i,row:0}):t.push({col:0,row:i})}this.transpose?this.scenegraph.updateCol([],[],t):this.scenegraph.updateRow([],[],t)}}else{const t=[];for(let e=0;e<r.length;e++){const i=r[e]+(this.transpose?this.rowHeaderLevelCount:this.columnHeaderLevelCount);this.transpose?t.push({col:i,row:0}):t.push({col:0,row:i})}this.transpose?this.scenegraph.updateCol([],[],t):this.scenegraph.updateRow([],[],t)}}}_hasCustomRenderOrLayout(){const{headerObjects:t}=this.internalProps.layoutMap;if(this.options.customRender)return!0;for(let e=0;e<t.length;e++){const i=t[e];if(i?.define?.customLayout||i?.define?.headerCustomLayout||i?.define?.customRender||i?.define?.headerCustomRender)return!0}return!1}getAggregateValuesByField(t){const e=this.internalProps.layoutMap.getColumnByField(t),i=[];for(let t=0;t<e.length;t++){const r=e[t].columnDefine.aggregator;if(delete e[t].columnDefine,r){const o={col:e[t].col,aggregateValue:null};if(o.aggregateValue=[],Array.isArray(r))for(let t=0;t<r.length;t++)o.aggregateValue.push({aggregationType:r[t].type,value:r[t].value()});else o.aggregateValue.push({aggregationType:r.type,value:r.value()});i.push(o)}}return i}},t.PivotChart=class extends VH{pivotSortState;dataset;_selectedDataItemsInChart=[];_selectedDimensionInChart=[];_chartEventMap={};_axes;constructor(t,e){"node"===kC.mode?(e=t,t=null):t instanceof HTMLElement||(e=t,t=t.container?t.container:null),super(t,e),e.layout&&Object.assign(e,e.layout),this.internalProps.columns=mt(e.columns),this.internalProps.rows=mt(e.rows),this.internalProps.indicators=jS(e.indicators),this.internalProps.columnTree=!e.indicatorsAsCol||e.columns?.length||e.columnTree?mt(e.columnTree):[],this.internalProps.rowTree=e.indicatorsAsCol||e.rows?.length||e.rowTree?mt(e.rowTree):[],this.internalProps.records=e.records,this.setCustomStateNameToSpec(),this.internalProps.columnResizeType=e.columnResizeType??"column",this.internalProps.rowResizeType=e.rowResizeType??"row",this.internalProps.dataConfig={isPivotChart:!0},this._axes=et(e.axes)?e.axes:[];const i=e.rows?.reduce(((t,e)=>("string"==typeof e?t.push(e):t.push(e.dimensionKey),t)),[])??[],r=e.columns?.reduce(((t,e)=>("string"==typeof e?t.push(e):t.push(e.dimensionKey),t)),[])??[],o=e.indicators?.reduce(((t,e)=>("string"==typeof e?t.push(e):t.push(e.indicatorKey),t)),[])??[];this.internalProps.dataConfig.collectValuesBy=this._generateCollectValuesConfig(r,i),this.internalProps.dataConfig.aggregationRules=this._generateAggregationRules(),this.internalProps.dataConfig.dimensionSortArray=this._getDimensionSortArray(),this.dataset=new yE(this.internalProps.dataConfig,i,r,o,this.internalProps.indicators,e.indicatorsAsCol??!0,e.records,void 0,this.internalProps.columnTree,this.internalProps.rowTree,!0),this.internalProps.layoutMap=new fE(this,this.dataset),this.refreshHeader(),this.scenegraph.createSceneGraph(),e.title&&(this.internalProps.title=new uE(e.title,this),this.scenegraph.resize()),setTimeout((()=>{this.fireListeners(ww.INITIALIZED,null)}),0)}static get EVENT_TYPE(){return fP}get pivotChartAxes(){return this._axes}get recordsCount(){return this.records?.length}isListTable(){return!1}isPivotTable(){return!0}isPivotChart(){return!0}_canResizeColumn(t,e){const i=super._canResizeColumn(t,e);if(i&&!this.internalProps.layoutMap.indicatorsAsCol){const e=this.internalProps.layoutMap.getBody(t,this.columnHeaderLevelCount);if(e?.disableColumnResize)return!1}return i}updateOption(t){const e=this.internalProps;super.updateOption(t),this.internalProps.columns=mt(t.columns),this.internalProps.rows=mt(t.rows),this.internalProps.indicators=t.indicators?.length?jS(t.indicators):[],this.internalProps.columnTree=!t.indicatorsAsCol||t.columns?.length||t.columnTree?mt(t.columnTree):[],this.internalProps.rowTree=t.indicatorsAsCol||t.rows?.length||t.rowTree?mt(t.rowTree):[],t.records&&(this.internalProps.records=t.records),this.setCustomStateNameToSpec(),this._selectedDataItemsInChart=[],e.columnResizeType=t.columnResizeType??"column",e.rowResizeType=t.rowResizeType??"row",e.dataConfig={isPivotChart:!0},this._axes=et(t.axes)?t.axes:[];const i=t.rows?.reduce(((t,e)=>("string"==typeof e?t.push(e):t.push(e.dimensionKey),t)),[])??[],r=t.columns?.reduce(((t,e)=>("string"==typeof e?t.push(e):t.push(e.dimensionKey),t)),[])??[],o=t.indicators?.reduce(((t,e)=>("string"==typeof e?t.push(e):t.push(e.indicatorKey),t)),[])??[];return this.internalProps.dataConfig.collectValuesBy=this._generateCollectValuesConfig(r,i),this.internalProps.dataConfig.aggregationRules=this._generateAggregationRules(),this.internalProps.dataConfig.dimensionSortArray=this._getDimensionSortArray(),this.dataset=new yE(this.internalProps.dataConfig,i,r,o,this.internalProps.indicators,t.indicatorsAsCol??!0,t.records??this.internalProps.records,void 0,this.internalProps.columnTree,this.internalProps.rowTree,!0),e.layoutMap=new fE(this,this.dataset),this.refreshHeader(),e.releaseList&&(e.releaseList.forEach((t=>t?.release?.())),e.releaseList=null),this.scenegraph.clearCells(),this.scenegraph.createSceneGraph(),t.title&&(this.internalProps.title=new uE(t.title,this),this.scenegraph.resize()),new Promise((t=>{setTimeout(t,0)}))}updatePagination(){}refreshHeader(){this.setMinMaxLimitWidth(!0),this.refreshRowColCount()}refreshRowColCount(){const t=this,{layoutMap:e}=t.internalProps;e&&(t.colCount=e.colCount??0,t.rowCount=e.rowCount??0,t.internalProps.frozenColCount=e.rowHeaderLevelCount??0,t.frozenRowCount=e.headerLevelCount,t.bottomFrozenRowCount!==(e?.bottomFrozenRowCount??0)&&(t.bottomFrozenRowCount=e?.bottomFrozenRowCount??0),t.rightFrozenColCount!==(e?.rightFrozenColCount??0)&&(t.rightFrozenColCount=e?.rightFrozenColCount??0),this.stateManager.setFrozenCol(this.internalProps.frozenColCount))}_getSortFuncFromHeaderOption(t,e,i){}syncHierarchyState(t,e){t.value===e.value&&t.dimensionKey===e.dimensionKey&&(e.hierarchyState=e.hierarchyState??(e?.children?t.hierarchyState:void 0),e?.children?.forEach(((e,i)=>{t?.children?.[i]&&e&&this.syncHierarchyState(t.children[i],e)})))}getRecordShowIndexByCell(t,e){}getTableIndexByRecordIndex(t){}getTableIndexByField(t){}getCellAddrByFieldRecord(t,e){}getBodyIndexByRow(t){const{layoutMap:e}=this.internalProps;return e.getBodyIndexByRow(t)}getBodyIndexByCol(t){const{layoutMap:e}=this.internalProps;return e.getBodyIndexByCol(t)}getCellValue(t,e,i){if(!i){const i=this.getCustomMergeValue(t,e);if(i)return i}if(this.internalProps.layoutMap.isHeader(t,e)){if(this.internalProps.layoutMap.isBottomFrozenRow(t,e)||this.internalProps.layoutMap.isRightFrozenColumn(t,e)){const i=this.internalProps.layoutMap.getIndicatorKeyInChartSpec(t,e);let r;return i?.forEach((t=>{const e=this.internalProps.layoutMap.getIndicatorInfo(t);e&&(r=e)})),r?.title??r?.indicatorKey??""}const{title:i,fieldFormat:r}=this.internalProps.layoutMap.getHeader(t,e);return"function"==typeof r?r(i,t,e,this):i}if(this.dataset){const i=this.internalProps.layoutMap.getCellHeaderPaths(t,e),r=i.colHeaderPaths.map((t=>t.indicatorKey??t.value)),o=i.rowHeaderPaths.map((t=>t.indicatorKey??t.value)),n=this.dataset.getAggregator(this.internalProps.layoutMap.indicatorsAsCol?o:o.slice(0,-1),this.internalProps.layoutMap.indicatorsAsCol?r.slice(0,-1):r,this.internalProps.layoutMap.getIndicatorKey(t,e));return n.value?n.value():void 0}const{fieldFormat:r}=this.internalProps.layoutMap.getBody(t,e),o=this.getBodyIndexByRow(e),n=this.getBodyIndexByCol(t),s=this.records[o]?.[n];if("function"==typeof r){return r(s,t,e,this)}return s}getCellOriginValue(t,e){const i=this;if(i.internalProps.layoutMap.isHeader(t,e)){if(this.internalProps.layoutMap.isBottomFrozenRow(t,e)||this.internalProps.layoutMap.isRightFrozenColumn(t,e)){const i=this.internalProps.layoutMap.getIndicatorKeyInChartSpec(t,e);let r;return i?.forEach((t=>{const e=this.internalProps.layoutMap.getIndicatorInfo(t);e&&(r=e)})),r?.title??r?.indicatorKey??""}const{title:r}=i.internalProps.layoutMap.getHeader(t,e);return"function"==typeof r?r():r}if(this.dataset){const i=this.internalProps.layoutMap.getCellHeaderPaths(t,e),r=i.colHeaderPaths.map((t=>t.indicatorKey??t.value)),o=i.rowHeaderPaths.map((t=>t.indicatorKey??t.value)),n=this.dataset.getAggregator(this.internalProps.layoutMap.indicatorsAsCol?o:o.slice(0,-1),this.internalProps.layoutMap.indicatorsAsCol?r.slice(0,-1):r,this.internalProps.layoutMap.getIndicatorKey(t,e));return n.value?n.value():void 0}const r=this.getBodyIndexByRow(e),o=this.getBodyIndexByCol(t),n=this.records[r]?.[o];return n}getCellRawValue(t,e){return this.getCellOriginValue(t,e)}getCellOriginRecord(t,e){if(!this.internalProps.layoutMap.isHeader(t,e)&&this.dataset){const i=this.internalProps.layoutMap.getCellHeaderPaths(t,e),r=i.colHeaderPaths.map((t=>t.indicatorKey??t.value)),o=i.rowHeaderPaths.map((t=>t.indicatorKey??t.value));return this.dataset.getAggregator(this.internalProps.layoutMap.indicatorsAsCol?o:o.slice(0,-1),this.internalProps.layoutMap.indicatorsAsCol?r.slice(0,-1):r,this.internalProps.layoutMap.getIndicatorKey(t,e)).records}}getCellRawRecord(t,e){return this.getCellOriginRecord(t,e)}updateSortRules(t){this.internalProps.dataConfig.sortRules=t,this.dataset.updateSortRules(t),this.internalProps.layoutMap.resetHeaderTree(),this.scenegraph.clearCells(),this.refreshHeader(),this.scenegraph.createSceneGraph(),this.render()}updatePivotSortState(t){for(let e=0;e<t.length;e++){const{dimensions:i,order:r}=t[e],o=this.internalProps.layoutMap.getPivotCellAdress(i);o&&this.pivotSortState.push({col:o.col,row:o.row,order:r})}}getPivotSortState(t,e){if(!this.pivotSortState)return;const i=this.getCellRange(t,e);for(let t=0;t<this.pivotSortState.length;t++){const{col:e,row:r,order:o}=this.pivotSortState[t];if(dw(i,e,r))return o}}_moveHeaderPosition(t,e){const i=this.internalProps.layoutMap.moveHeaderPosition(t,e);if(i){if("column"===i.moveType){if(this.options.records?.[0]?.constructor===Array)for(let t=0;t<this.internalProps.records.length;t++){const e=this.internalProps.records[t].splice(i.sourceIndex-this.rowHeaderLevelCount,i.sourceSize);e.unshift(i.targetIndex-this.rowHeaderLevelCount,0),Array.prototype.splice.apply(this.internalProps.records[t],e)}this.colWidthsMap.adjustOrder(i.sourceIndex,i.targetIndex,i.sourceSize),this.setMinMaxLimitWidth()}else if("row"===i.moveType){if(this.options.records?.[0]?.constructor===Array){const t=this.internalProps.records.splice(i.sourceIndex-this.columnHeaderLevelCount,i.sourceSize);t.unshift(i.targetIndex-this.columnHeaderLevelCount,0),Array.prototype.splice.apply(this.internalProps.records,t)}this.rowHeightsMap.adjustOrder(i.sourceIndex,i.targetIndex,i.sourceSize)}return i}return null}toggleHierarchyState(t,e){const i=this.getHierarchyState(t,e);i===oC.expand?this.fireListeners(fP.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:oC.collapse}):i===oC.collapse&&this.fireListeners(fP.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:oC.expand,originData:this.getCellOriginRecord(t,e)});const r=this.internalProps.layoutMap.toggleHierarchyState(t,e);this.refreshRowColCount(),this.clearCellStyleCache(),this.scenegraph.updateHierarchyIcon(t,e),this.scenegraph.updateRow(r.removeCellPositions,r.addCellPositions)}getHeaderCellAddressByPath(t){return this.internalProps.layoutMap.getPivotCellAdress(t)}getCellAddressByHeaderPaths(t){return this.internalProps.layoutMap.getCellAdressByHeaderPath(t)}getHeaderPathByXY(t){let e;e=t?this.getCellAt(t.x+this.getFrozenColsWidth()+this.scrollLeft+1,t.y+this.getFrozenRowsHeight()+this.scrollTop+1):this.getCellAt(this.getFrozenColsWidth()+this.scrollLeft+1,this.getFrozenRowsHeight()+this.scrollTop+1);return this.internalProps.layoutMap.getCellHeaderPaths(e.col,e.row)}getHierarchyState(t,e){return this._getHeaderLayoutMap(t,e)?.hierarchyState}_hasHierarchyTreeHeader(){return"tree"===this.internalProps.layoutMap.rowHierarchyType}getMenuInfo(t,e,i){const r=this.internalProps.layoutMap.getPivotDimensionInfo(t,e);return{dimensionKey:r[r.length-1].dimensionKey,value:this.getCellValue(t,e),cellLocation:this.getCellLocation(t,e),isPivotCorner:this.isCornerHeader(t,e),event:void 0}}_generateCollectValuesConfig(t,e){const i=this.internalProps.indicators,r={};for(let o=0,n=i?.length;o<n;o++)if("string"!=typeof i[o]&&i[o].chartSpec){if("pie"===i[o].chartSpec?.type)continue;const n=i[o],s=n.chartSpec;if(!1===this.options.indicatorsAsCol)if(!1!==s?.stack&&("bar"===s?.type||"area"===s?.type)&&(s.stack=!0),r[n.indicatorKey]={by:e,range:!0,sumBy:s?.stack&&t.concat(s?.xField)},s.series)s.series.forEach((i=>{const o="string"==typeof i.xField?i.xField:i.xField[0];r[o]={by:t,type:"horizontal"!==i.direction?"xField":void 0,range:"horizontal"===i.direction,sortBy:"horizontal"!==i.direction?i?.data?.fields?.[o]?.domain??s?.data?.fields?.[o]?.domain:void 0};const n=i.yField;!1!==i.stack&&("bar"===i.type||"area"===i.type)&&(i.stack=!0),r[n]={by:e,range:"horizontal"!==i.direction,sumBy:i.stack&&t.concat(i?.xField),sortBy:"horizontal"===i.direction?i?.data?.fields?.[n]?.domain??s?.data?.fields?.[n]?.domain:void 0,extendRange:gR(s.markLine)}}));else{const i="string"==typeof s.xField?s.xField:s.xField[0];r[i]={by:t,type:"horizontal"!==s.direction?"xField":void 0,range:"horizontal"===s.direction,sortBy:"horizontal"!==s.direction?s?.data?.fields?.[i]?.domain:void 0},!1!==s?.stack&&("bar"===s?.type||"area"===s?.type)&&(s.stack=!0);const o=s.yField;r[o]={by:e,range:"horizontal"!==s.direction,sumBy:s.stack&&t.concat(s?.xField),sortBy:"horizontal"===s.direction?s?.data?.fields?.[o]?.domain:void 0,extendRange:gR(s.markLine)}}else{const n=i[o];if(!1!==s?.stack&&("bar"===s?.type||"area"===s?.type)&&(s.stack=!0),r[n.indicatorKey]={by:t,range:!0,sumBy:s?.stack&&e.concat(s?.yField)},s.series)s.series.forEach((i=>{const o="string"==typeof i.yField?i.yField:i.yField[0];r[o]={by:e,type:"horizontal"===i.direction?"yField":void 0,range:"horizontal"!==i.direction,sortBy:"horizontal"===i.direction?i?.data?.fields?.[o]?.domain??s?.data?.fields?.[o]?.domain:void 0};const n=i.xField;!1!==i.stack&&("bar"===i.type||"area"===i.type)&&(i.stack=!0),r[n]={by:t,range:"horizontal"===i.direction,sumBy:i.stack&&e.concat(i?.yField),sortBy:"horizontal"!==i.direction?i?.data?.fields?.[n]?.domain??s?.data?.fields?.[n]?.domain:void 0,extendRange:gR(s.markLine)}}));else{const i="string"==typeof s.yField?s.yField:s.yField[0];r[i]={by:e,type:"horizontal"===s.direction?"yField":void 0,range:"horizontal"!==s.direction,sortBy:"horizontal"===s.direction?s?.data?.fields?.[i]?.domain:void 0},!1!==s?.stack&&("bar"===s?.type||"area"===s?.type)&&(s.stack=!0);const o=s.xField;r[o]={by:t,range:"horizontal"===s.direction,sumBy:s.stack&&e.concat(s?.yField),sortBy:"horizontal"!==s.direction?s?.data?.fields?.[o]?.domain:void 0,extendRange:gR(s.markLine)}}}}return r}_generateAggregationRules(){const t=[];return this.internalProps.indicators?.forEach((e=>{if("string"==typeof e)t.push({indicatorKey:e,field:e,aggregationType:nC.RECORD});else if(e.chartSpec?.series){const i=[];e.chartSpec?.series.forEach((t=>{const e=!1===this.options.indicatorsAsCol?t.yField:t.xField;-1===i.indexOf(e)&&i.push(e)})),t.push({indicatorKey:e.indicatorKey,field:i,aggregationType:nC.RECORD})}else{const i=!1===this.options.indicatorsAsCol?e.chartSpec.yField:e.chartSpec.xField;t.push({indicatorKey:e.indicatorKey,field:i??e.indicatorKey,aggregationType:nC.RECORD})}})),t}setCustomStateNameToSpec(){const t=t=>{t.bar?.state?.selected&&(t.bar.state.vtable_selected=t.bar.state.selected,t.bar.state.vtable_selected_reverse=t.bar.state.selected_reverse,delete t.bar.state.selected,delete t.bar.state.selected_reverse),t.point?.state?.selected&&(t.point.state.vtable_selected=t.point.state.selected,t.point.state.vtable_selected_reverse=t.point.state.selected_reverse,delete t.point.state.selected,delete t.point.state.selected_reverse),t.line?.state?.selected&&(t.line.state.vtable_selected=t.line.state.selected,t.line.state.vtable_selected_reverse=t.line.state.selected_reverse,delete t.line.state.selected,delete t.line.state.selected_reverse),t.area?.state?.selected&&(t.area.state.vtable_selected=t.area.state.selected,t.area.state.vtable_selected_reverse=t.area.state.selected_reverse,delete t.area.state.selected,delete t.area.state.selected_reverse)};this.internalProps.indicators?.forEach((e=>{if(e.chartSpec){const i=e.chartSpec;i.series?i.series.forEach((e=>{t(e)})):t(i)}}))}updateFilterRules(t){this.internalProps.dataConfig.filterRules=t,this.dataset.updateFilterRules(t),KT(this.scenegraph),function(t){const e=t.table;for(let i=t.proxy.colStart;i<=t.proxy.colEnd;i++){const r=t.getColGroup(i);r?.getChildren()?.forEach((t=>{const i=t.col,r=t.row;t.children.forEach((t=>{if("chart"===t.type){t.updateData(e.getCellValue(i,r));const o=e.internalProps.layoutMap.getChartAxes(i,r);t.setAttribute("axes",o);const n=t.attribute.spec;n.axes=o,t.setAttribute("spec",n)}}))}))}$T(t.rowHeaderGroup,t.table),$T(t.colHeaderGroup,t.table),$T(t.rightFrozenGroup,t.table),$T(t.bottomFrozenGroup,t.table)}(this.scenegraph),this.render()}getLegendSelected(){return this.internalProps.legends.legendComponent._getSelectedLegends().map((t=>t.label))}setLegendSelected(t){this.internalProps.legends.legendComponent.setSelected(t)}getChartDatumPosition(t,e){const{chartInstance:i,bounds:r}=this.getChartInstance(e);if(i){const e=i.convertDatumToPosition(t);return e?{x:Math.round(e.x+r.x1),y:Math.round(e.y+r.y1)}:null}return null}getCellAddressByRecord(t){const e=[],i=[],r={},o=[];this.dataset.dataConfig.aggregationRules.forEach((t=>{if("string"==typeof t.field)r[t.field]=t.indicatorKey,o.push(t.field);else for(let e=0;e<t.field.length;e++)r[t.field[e]]=t.indicatorKey,o.push(t.field[e])}));for(const n in t)this.dataset.rows.indexOf(n)>=0&&e.push({dimensionKey:n,value:t[n]}),this.dataset.columns.indexOf(n)>=0&&i.push({dimensionKey:n,value:t[n]}),o.indexOf(n)>=0&&(this.dataset.indicatorsAsCol?i.push({indicatorKey:r[n]}):e.push({indicatorKey:r[n]}));return this.getCellAddressByHeaderPaths({rowHeaderPaths:e,colHeaderPaths:i,cellLocation:"body"})}getChartInstance(t){const e=this.getCellAddressByHeaderPaths(t);if(e){const t=this.getCellRelativeRect(e.col,e.row),i=this.scenegraph.getCell(e.col,e.row);let r;const o=i?.getChildren()?.[0];if(o.attribute.chartInstance){r=o.attribute.chartInstance;const{dataId:t,data:e,axes:i,spec:n}=o.attribute,s=o.getViewBox();if(i?.forEach(((t,e)=>{"linear"===t.type?r.updateModelSpecSync({type:"axes",index:e},{min:t.range?.min??0,max:t.range?.max??0},!0):"band"===t.type&&r.updateModelSpec({type:"axes",index:e},{domain:t.domain.slice(0)},!0)})),r.updateViewBox({x1:s.x1-o.getRootNode().table.scrollLeft,x2:s.x2-o.getRootNode().table.scrollLeft,y1:s.y1-o.getRootNode().table.scrollTop,y2:s.y2-o.getRootNode().table.scrollTop},!1,!1),"string"==typeof t)r.updateDataSync(t,e??[]);else{const i=[];for(const o in t){const s=t[o],a=n.series.find((t=>t?.data?.id===o));i.push({id:o,values:s?e?.filter((t=>t.hasOwnProperty(s)))??[]:e??[],fields:a?.data?.fields}),r.updateFullDataSync||r.updateDataSync(o,s?e?.filter((t=>t.hasOwnProperty(s)))??[]:e??[])}r.updateFullDataSync?.(i)}this.renderAsync()}return{chartInstance:r,bounds:t.bounds}}return{}}_getDimensionSortArray(){if(this.options?.axes?.length){const t=this.options.indicatorsAsCol?"left":"bottom",e=this.options.axes.find((e=>e.orient===t));if(e&&et(e.domain))return e.domain}}setRecords(t){const e={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.options.records=this.internalProps.records=t,this.options;const i=this.internalProps;this.dataset.setRecords(t),i.layoutMap=new fE(this,this.dataset),this.refreshHeader(),this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(e.col,e.row),this.internalProps.title&&!this.internalProps.title.isReleased&&(this._updateSize(),this.internalProps.title.resize(),this.scenegraph.resize()),this.eventManager.updateEventBinder()}_hasCustomRenderOrLayout(){if(this.options.customRender)return!0;const{columnsDefine:t,rowsDefine:e,indicatorsDefine:i}=this.internalProps.layoutMap;for(let e=0;e<t.length;e++){const i=t[e];if("string"!=typeof i&&(i.headerCustomLayout||i.headerCustomRender))return!0}for(let t=0;t<e.length;t++){const i=e[t];if("string"!=typeof i&&(i.headerCustomLayout||i.headerCustomRender))return!0}for(let t=0;t<i.length;t++){const e=i[t];if("string"!=typeof e&&(e.customLayout||e.headerCustomLayout||e.customRender||e.headerCustomRender))return!0}return!1}changeRecordOrder(t,e){}},t.PivotTable=class extends VH{pivotSortState;editorManager;dataset;flatDataToObjects;constructor(t,e){"node"===kC.mode?(e=t,t=null):t instanceof HTMLElement||(e=t,t=t.container?t.container:null),super(t,e),e.layout&&Object.assign(e,e.layout),this.internalProps.columns=mt(e.columns),this.internalProps.rows=mt(e.rows),this.internalProps.indicators=jS(e.indicators),e.indicators?.forEach(((t,e)=>{"object"==typeof t&&t?.editor&&(this.internalProps.indicators[e].editor=t.editor)})),this.internalProps.columnTree=!e.indicatorsAsCol||e.columns?.length||e.columnTree?mt(e.columnTree):[],this.internalProps.rowTree=e.indicatorsAsCol||e.rows?.length||e.rowTree?mt(e.rowTree):[],this.internalProps.records=e.records,this.pagination=e.pagination,this.internalProps.columnResizeType=e.columnResizeType??"column",this.internalProps.rowResizeType=e.rowResizeType??"row",this.internalProps.dataConfig=mt(e.dataConfig),e.rowTree||e.columnTree?this.internalProps.enableDataAnalysis=!1:this.internalProps.enableDataAnalysis=!0;const i=this.internalProps.records;if(this.internalProps.enableDataAnalysis&&(e.rows||e.columns)){const t=e.rows?.reduce(((t,e)=>("string"==typeof e?t.push(e):t.push(e.dimensionKey),t)),[])??[],i=e.columns?.reduce(((t,e)=>("string"==typeof e?t.push(e):t.push(e.dimensionKey),t)),[])??[],r=e.indicators?.reduce(((t,e)=>("string"==typeof e?t.push(e):t.push(e.indicatorKey),t)),[])??[];this.dataset=new yE(this.internalProps.dataConfig,t,i,r,this.internalProps.indicators,e.indicatorsAsCol??!0,e.records,e.rowHierarchyType,this.internalProps.columnTree,this.internalProps.rowTree),this.internalProps.layoutMap=new fE(this,this.dataset)}else{if(!Array.isArray(this.internalProps.columnTree)&&!Array.isArray(this.internalProps.rowTree))return;this.internalProps.layoutMap=new fE(this,null),i?.[0]?.constructor!==Array&&(this.flatDataToObjects=new bE({rows:this.internalProps.layoutMap.fullRowDimensionKeys,columns:this.internalProps.layoutMap.colDimensionKeys,indicators:this.internalProps.layoutMap.indicatorKeys,indicatorsAsCol:this.internalProps.layoutMap.indicatorsAsCol,indicatorDimensionKey:this.internalProps.layoutMap.indicatorDimensionKey},i))}this.pivotSortState=[],e.pivotSortState&&this.updatePivotSortState(e.pivotSortState),"node"!==kC.mode&&(this.editorManager=new gE(this)),this.refreshHeader(),this.stateManager.initCheckedState(i),this.scenegraph.createSceneGraph(),e.title&&(this.internalProps.title=new uE(e.title,this),this.scenegraph.resize()),setTimeout((()=>{this.fireListeners(ww.INITIALIZED,null)}),0)}static get EVENT_TYPE(){return pP}isListTable(){return!1}isPivotTable(){return!0}isPivotChart(){return!1}get recordsCount(){return this.records?.length}_canResizeColumn(t,e){const i=super._canResizeColumn(t,e);if(i&&!this.internalProps.layoutMap.indicatorsAsCol){const e=this.internalProps.layoutMap.getBody(t,this.columnHeaderLevelCount);if(e?.disableColumnResize)return!1}return i}updateOption(t){const e=this.internalProps;if(super.updateOption(t),this.internalProps.columns=mt(t.columns),this.internalProps.rows=mt(t.rows),this.internalProps.indicators=t.indicators?.length?jS(t.indicators):[],t.indicators?.forEach(((t,e)=>{"object"==typeof t&&t?.editor&&(this.internalProps.indicators[e].editor=t.editor)})),this.internalProps.columnTree=!t.indicatorsAsCol||t.columns?.length||t.columnTree?mt(t.columnTree):[],this.internalProps.rowTree=t.indicatorsAsCol||t.rows?.length||t.rowTree?mt(t.rowTree):[],t.records&&(this.internalProps.records=t.records),this.stateManager.initCheckedState(this.internalProps.records),this.stateManager.updateDrillState(void 0,void 0,!1,!1,-1,-1),this.pagination=t.pagination,e.columnResizeType=t.columnResizeType??"column",e.rowResizeType=t.rowResizeType??"row",e.dataConfig=mt(t.dataConfig),t.rowTree||t.columnTree?e.enableDataAnalysis=!1:e.enableDataAnalysis=!0,"tree"===t?.rowHierarchyType&&"tree"===this.internalProps.layoutMap.rowHierarchyType&&this.internalProps.layoutMap.rowExpandLevel===t?.rowExpandLevel){const t=this.internalProps.layoutMap.rowDimensionTree.tree.children;this.internalProps.rowTree?.forEach(((e,i)=>{const r=t.find((t=>t.dimensionKey===e.dimensionKey&&t.value===e.value));r&&this.syncHierarchyState(r,e)}))}const i=this.internalProps.records;if(this.internalProps.enableDataAnalysis&&(t.rows||t.columns)){const i=t.rows?.reduce(((t,e)=>("string"==typeof e?t.push(e):t.push(e.dimensionKey),t)),[]),r=t.columns?.reduce(((t,e)=>("string"==typeof e?t.push(e):t.push(e.dimensionKey),t)),[]),o=t.indicators?.reduce(((t,e)=>("string"==typeof e?t.push(e):t.push(e.indicatorKey),t)),[]);this.dataset=new yE(e.dataConfig,i,r,o,this.internalProps.indicators,t.indicatorsAsCol??!0,t.records,t.rowHierarchyType,this.internalProps.columnTree,this.internalProps.rowTree),e.layoutMap=new fE(this,this.dataset)}else{if(!Array.isArray(this.internalProps.columnTree)&&!Array.isArray(this.internalProps.rowTree))return this;e.layoutMap=new fE(this,null),i?.[0]?.constructor!==Array&&(this.flatDataToObjects=new bE({rows:e.layoutMap.fullRowDimensionKeys,columns:e.layoutMap.colDimensionKeys,indicators:e.layoutMap.indicatorKeys,indicatorsAsCol:e.layoutMap.indicatorsAsCol,indicatorDimensionKey:e.layoutMap.indicatorDimensionKey},i))}return this.pivotSortState=[],t.pivotSortState&&this.updatePivotSortState(t.pivotSortState),this.refreshHeader(),e.releaseList&&(e.releaseList.forEach((t=>t?.release?.())),e.releaseList=null),this.scenegraph.clearCells(),this.scenegraph.createSceneGraph(),t.title&&(this.internalProps.title=new uE(t.title,this),this.scenegraph.resize()),new Promise((t=>{setTimeout(t,0)}))}updatePagination(t){t?(this.pagination||(this.pagination={currentPage:0,perPageCount:0}),"number"==typeof t.currentPage&&t.currentPage>=0&&(this.pagination.currentPage=t.currentPage),t.perPageCount&&(this.pagination.perPageCount=t.perPageCount||this.pagination.perPageCount),this.scenegraph.clearCells(),this.internalProps.layoutMap.setPagination(this.pagination),this.refreshRowColCount(),this.scenegraph.createSceneGraph(),this.render()):this.pagination&&(this.pagination=void 0,this.scenegraph.clearCells(),this.internalProps.layoutMap.setPagination(void 0),this.refreshRowColCount(),this.scenegraph.createSceneGraph(),this.render())}refreshHeader(){this.setMinMaxLimitWidth(!0),this.refreshRowColCount()}refreshRowColCount(){const t=this,{layoutMap:e}=t.internalProps;e&&(t.colCount=e.colCount??0,t.rowCount=e.rowCount??0,this.internalProps.frozenColCount=Math.max((e.rowHeaderLevelCount??0)+e.leftRowSeriesNumberColumnCount,this.options.frozenColCount??0),t.frozenRowCount=e.headerLevelCount,t.bottomFrozenRowCount!==(this.options.bottomFrozenRowCount??0)&&(t.bottomFrozenRowCount=this.options.bottomFrozenRowCount??0),t.rightFrozenColCount!==(this.options.rightFrozenColCount??0)&&(t.rightFrozenColCount=this.options.rightFrozenColCount??0),this.stateManager.setFrozenCol(this.internalProps.frozenColCount))}_getSortFuncFromHeaderOption(t,e,i){}get rowHierarchyType(){return this.internalProps.layoutMap.rowHierarchyType}syncHierarchyState(t,e){t.value===e.value&&t.dimensionKey===e.dimensionKey&&(e.hierarchyState=e.hierarchyState??(e?.children?t.hierarchyState:void 0),e?.children?.forEach(((e,i)=>{if(t?.children?.[i]&&e){const i=t.children.find((t=>t.dimensionKey===e.dimensionKey&&t.value===e.value));i&&this.syncHierarchyState(i,e)}})))}getRecordShowIndexByCell(t,e){}getTableIndexByRecordIndex(t){}getTableIndexByField(t){}getCellAddrByFieldRecord(t,e){}getBodyIndexByRow(t){const{layoutMap:e}=this.internalProps;return e.getBodyIndexByRow(t)}getBodyIndexByCol(t){const{layoutMap:e}=this.internalProps;return e.getBodyIndexByCol(t)}getFieldData(t,e,i){if(this.internalProps.layoutMap.isHeader(e,i))return;if(this.dataset){const r=this.internalProps.layoutMap.getCellHeaderPaths(e,i);if(r){const o=r.colHeaderPaths.map((t=>t.indicatorKey??t.value)),n=r.rowHeaderPaths.map((t=>t.indicatorKey??t.value)),s=this.dataset.getAggregator(this.internalProps.layoutMap.indicatorsAsCol?n:n.slice(0,-1),this.internalProps.layoutMap.indicatorsAsCol?o.slice(0,-1):o,this.internalProps.layoutMap.getIndicatorKey(e,i));if(s.records&&s.records.length>=1)return s.records[0][t]}}else if(this.flatDataToObjects){const r=this.internalProps.layoutMap.getCellHeaderPaths(e,i),o=r.colHeaderPaths.map((t=>t.indicatorKey??t.value)),n=r.rowHeaderPaths.map((t=>t.indicatorKey??t.value)),s=this.flatDataToObjects.getTreeNode(n,o,this.internalProps.layoutMap.getBody(e,i).indicatorKey,!1);if(s?.record)return s?.record[t]}const r=this.getBodyIndexByRow(i),o=this.getBodyIndexByCol(e);return this.records[r]?.[o]}getCellValue(t,e,i){if(!i){const i=this.getCustomMergeValue(t,e);if(i)return i}if(this.internalProps.layoutMap.isSeriesNumber(t,e)){if(this.internalProps.layoutMap.isSeriesNumberInHeader(t,e)){const{title:i}=this.internalProps.layoutMap.getSeriesNumberHeader(t,e);return i}const{format:i}=this.internalProps.layoutMap.getSeriesNumberBody(t,e);return"function"==typeof i?i(t,e,this):e-this.columnHeaderLevelCount+1}if(this.internalProps.layoutMap.isHeader(t,e)){const{title:i,fieldFormat:r}=this.internalProps.layoutMap.getHeader(t,e);return"function"==typeof r?r(i,t,e,this):i}if(this.dataset){const i=this.internalProps.layoutMap.getCellHeaderPaths(t,e),r=i.colHeaderPaths.map((t=>t.indicatorKey??t.value)),o=i.rowHeaderPaths.map((t=>t.indicatorKey??t.value)),n=this.dataset.getAggregator(this.internalProps.layoutMap.indicatorsAsCol?o:o.slice(0,-1),this.internalProps.layoutMap.indicatorsAsCol?r.slice(0,-1):r,this.internalProps.layoutMap.getIndicatorKey(t,e));return n.formatValue?n.formatValue(t,e,this):""}if(this.flatDataToObjects){const i=this.internalProps.layoutMap.getCellHeaderPaths(t,e),r=i.colHeaderPaths.map((t=>t.indicatorKey??t.value)),o=i.rowHeaderPaths.map((t=>t.indicatorKey??t.value)),n=this.flatDataToObjects.getTreeNode(o,r,this.internalProps.layoutMap.getBody(t,e).indicatorKey),{fieldFormat:s}=this.internalProps.layoutMap.getBody(t,e);return"function"==typeof s?s(n?.value,t,e,this):n?.value??""}const{fieldFormat:r}=this.internalProps.layoutMap.getBody(t,e),o=this.getBodyIndexByRow(e),n=this.getBodyIndexByCol(t),s=this.records[o]?.[n];if("function"==typeof r){return r(s,t,e,this)}return s}getCellOriginValue(t,e){const i=this;if(i.internalProps.layoutMap.isHeader(t,e)){const{title:r}=i.internalProps.layoutMap.getHeader(t,e);return"function"==typeof r?r():r}if(this.dataset){const i=this.internalProps.layoutMap.getCellHeaderPaths(t,e),r=i.colHeaderPaths.map((t=>t.indicatorKey??t.value)),o=i.rowHeaderPaths.map((t=>t.indicatorKey??t.value)),n=this.dataset.getAggregator(this.internalProps.layoutMap.indicatorsAsCol?o:o.slice(0,-1),this.internalProps.layoutMap.indicatorsAsCol?r.slice(0,-1):r,this.internalProps.layoutMap.getIndicatorKey(t,e));return n.value?n.value():void 0}if(this.flatDataToObjects){const i=this.internalProps.layoutMap.getCellHeaderPaths(t,e),r=i.colHeaderPaths.map((t=>t.indicatorKey??t.value)),o=i.rowHeaderPaths.map((t=>t.indicatorKey??t.value)),n=this.flatDataToObjects.getTreeNode(o,r,this.internalProps.layoutMap.getBody(t,e).indicatorKey);return n?.value}const r=this.getBodyIndexByRow(e),o=this.getBodyIndexByCol(t),n=this.records[r]?.[o];return n}getCellRawValue(t,e){const i=this;if(i.internalProps.layoutMap.isHeader(t,e)){const{title:r}=i.internalProps.layoutMap.getHeader(t,e);return"function"==typeof r?r():r}if(this.dataset){const i=this.internalProps.layoutMap.getCellHeaderPaths(t,e),r=i.colHeaderPaths.map((t=>t.indicatorKey??t.value)),o=i.rowHeaderPaths.map((t=>t.indicatorKey??t.value)),n=this.dataset.getAggregator(this.internalProps.layoutMap.indicatorsAsCol?o:o.slice(0,-1),this.internalProps.layoutMap.indicatorsAsCol?r.slice(0,-1):r,this.internalProps.layoutMap.getIndicatorKey(t,e),!1);return n.value?n.value():void 0}if(this.flatDataToObjects){const i=this.internalProps.layoutMap.getCellHeaderPaths(t,e),r=i.colHeaderPaths.map((t=>t.indicatorKey??t.value)),o=i.rowHeaderPaths.map((t=>t.indicatorKey??t.value)),n=this.flatDataToObjects.getTreeNode(o,r,this.internalProps.layoutMap.getBody(t,e).indicatorKey,!1);return n?.value}const r=this.getBodyIndexByRow(e),o=this.getBodyIndexByCol(t),n=this.records[r]?.[o];return n}getCellOriginRecord(t,e){if(this.internalProps.layoutMap.isHeader(t,e))return;if(this.dataset){const i=this.internalProps.layoutMap.getCellHeaderPaths(t,e),r=i.colHeaderPaths.map((t=>t.indicatorKey??t.value)),o=i.rowHeaderPaths.map((t=>t.indicatorKey??t.value));return this.dataset.getAggregator(this.internalProps.layoutMap.indicatorsAsCol?o:o.slice(0,-1),this.internalProps.layoutMap.indicatorsAsCol?r.slice(0,-1):r,this.internalProps.layoutMap.getIndicatorKey(t,e)).records}if(this.flatDataToObjects){const i=this.internalProps.layoutMap.getCellHeaderPaths(t,e),r=i.colHeaderPaths.map((t=>t.indicatorKey??t.value)),o=i.rowHeaderPaths.map((t=>t.indicatorKey??t.value)),n=this.flatDataToObjects.getTreeNode(o,r,this.internalProps.layoutMap.getBody(t,e).indicatorKey);return n?.record}const i=this.getBodyIndexByRow(e),r=this.getBodyIndexByCol(t),o=this.records[i]?.[r];return o}getCellRawRecord(t,e){if(this.internalProps.layoutMap.isHeader(t,e))return;if(this.dataset){const i=this.internalProps.layoutMap.getCellHeaderPaths(t,e),r=i.colHeaderPaths.map((t=>t.indicatorKey??t.value)),o=i.rowHeaderPaths.map((t=>t.indicatorKey??t.value));return this.dataset.getAggregator(this.internalProps.layoutMap.indicatorsAsCol?o:o.slice(0,-1),this.internalProps.layoutMap.indicatorsAsCol?r.slice(0,-1):r,this.internalProps.layoutMap.getIndicatorKey(t,e)).records}if(this.flatDataToObjects){const i=this.internalProps.layoutMap.getCellHeaderPaths(t,e),r=i.colHeaderPaths.map((t=>t.indicatorKey??t.value)),o=i.rowHeaderPaths.map((t=>t.indicatorKey??t.value)),n=this.flatDataToObjects.getTreeNode(o,r,this.internalProps.layoutMap.getBody(t,e).indicatorKey,!1);return n?.record}const i=this.getBodyIndexByRow(e),r=this.getBodyIndexByCol(t),o=this.records[i]?.[r];return o}updateSortRules(t){this.internalProps.dataConfig.sortRules=t,this.dataset.updateSortRules(t),this.internalProps.layoutMap.resetHeaderTree(),this.scenegraph.clearCells(),this.refreshHeader(),this.scenegraph.createSceneGraph(),this.render()}updatePivotSortState(t){for(let e=0;e<t.length;e++){const{dimensions:i,order:r}=t[e],o=this.internalProps.layoutMap.getPivotCellAdress(i);o&&this.pivotSortState.push({col:o.col,row:o.row,order:r})}}getPivotSortState(t,e){if(!this.pivotSortState)return;const i=this.getCellRange(t,e);for(let t=0;t<this.pivotSortState.length;t++){const{col:e,row:r,order:o}=this.pivotSortState[t];if(dw(i,e,r))return o}}_moveHeaderPosition(t,e){const i=this.getCellRange(t.col,t.row),r=this.getCellRange(e.col,e.row),o=this.internalProps.layoutMap.moveHeaderPosition(t,e);if(o){if("column"===o.moveType){if(this.options.records?.[0]?.constructor===Array)for(let t=0;t<this.internalProps.records.length;t++){const e=this.internalProps.records[t].splice(o.sourceIndex-this.rowHeaderLevelCount,o.sourceSize);e.unshift(o.targetIndex-this.rowHeaderLevelCount,0),Array.prototype.splice.apply(this.internalProps.records[t],e)}this.colWidthsMap.exchangeOrder(i.start.col,i.end.col-i.start.col+1,r.start.col,r.end.col-r.start.col+1,o.targetIndex),this.setMinMaxLimitWidth()}else if("row"===o.moveType){if(this.options.records?.[0]?.constructor===Array){const t=this.internalProps.records.splice(o.sourceIndex-this.columnHeaderLevelCount,o.sourceSize);t.unshift(o.targetIndex-this.columnHeaderLevelCount,0),Array.prototype.splice.apply(this.internalProps.records,t)}o.targetIndex>o.sourceIndex?this.rowHeightsMap.exchangeOrder(o.sourceIndex,o.sourceSize,o.targetIndex+o.sourceSize-o.targetSize,o.targetSize,o.targetIndex):this.rowHeightsMap.exchangeOrder(o.sourceIndex,o.sourceSize,o.targetIndex,o.targetSize,o.targetIndex)}return o}return null}toggleHierarchyState(t,e){const i=this.getHierarchyState(t,e);if(i===oC.expand)this._refreshHierarchyState(t,e),this.fireListeners(pP.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:oC.collapse});else if(i===oC.collapse){const i=this.internalProps.layoutMap.getCellHeaderPaths(t,e),r=this.internalProps.layoutMap.getHeadNode(i.rowHeaderPaths.slice(0,i.rowHeaderPaths.length));Array.isArray(r.children)&&this._refreshHierarchyState(t,e),this.fireListeners(pP.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:oC.expand,originData:r})}}_refreshHierarchyState(t,e,i){let r=!1,o=!1;this.stateManager.updateHoverIcon(t,e,void 0,void 0);const n=this.internalProps.layoutMap.checkHasChart();n&&(this.autoFillWidth&&(r=this.getAllColsWidth()<=this.tableNoFrameWidth),this.autoFillHeight&&(o=this.getAllRowsHeight()<=this.tableNoFrameHeight));const s=this.internalProps.layoutMap.toggleHierarchyState(t,e);i&&i(),this.refreshRowColCount(),this.clearCellStyleCache(),this.scenegraph.updateHierarchyIcon(t,e),this.scenegraph.updateRow(s.removeCellPositions,s.addCellPositions,s.updateCellPositions),n&&(this.autoFillWidth&&!r&&(r=this.getAllColsWidth()<=this.tableNoFrameWidth),this.autoFillHeight&&!o&&(o=this.getAllRowsHeight()<=this.tableNoFrameHeight),("adaptive"===this.widthMode||r||"adaptive"===this.heightMode||o)&&this.scenegraph.updateChartSize(0))}getHeaderCellAddressByPath(t){return this.internalProps.layoutMap.getPivotCellAdress(t)}getCellAddressByHeaderPaths(t){return this.internalProps.layoutMap.getCellAdressByHeaderPath(t)}getHeaderPathByXY(t){let e;e=t?this.getCellAt(t.x+this.getFrozenColsWidth()+this.scrollLeft+1,t.y+this.getFrozenRowsHeight()+this.scrollTop+1):this.getCellAt(this.getFrozenColsWidth()+this.scrollLeft+1,this.getFrozenRowsHeight()+this.scrollTop+1);return this.internalProps.layoutMap.getCellHeaderPaths(e.col,e.row)}getHierarchyState(t,e){return this._getHeaderLayoutMap(t,e)?.hierarchyState}getLayoutColumnTree(){return this.internalProps.layoutMap.getLayoutColumnTree()}getLayoutColumnTreeCount(){return this.internalProps.layoutMap.getLayoutColumnTreeCount()}getLayoutRowTree(){return this.internalProps.layoutMap.getLayoutRowTree()}getLayoutRowTreeCount(){return this.internalProps.layoutMap.getLayoutRowTreeCount()}getCellHeaderTreeNodes(t,e){return this.internalProps.layoutMap.getCellHeaderPathsWidthTreeNode(t,e)}_hasHierarchyTreeHeader(){return"tree"===this.internalProps.layoutMap.rowHierarchyType}getMenuInfo(t,e,i){const r=this.internalProps.layoutMap.getPivotDimensionInfo(t,e);return{dimensionKey:r[r.length-1].dimensionKey,value:this.getCellValue(t,e),cellLocation:this.getCellLocation(t,e),isPivotCorner:this.isCornerHeader(t,e),event:void 0}}setRecords(t){const e={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.options.records=this.internalProps.records=t;const i=this.options,r=this.internalProps;this.internalProps.enableDataAnalysis&&(i.rows||i.columns)?(this.dataset.setRecords(t),r.layoutMap=new fE(this,this.dataset),this.pivotSortState=[],i.pivotSortState&&this.updatePivotSortState(i.pivotSortState)):(Array.isArray(this.internalProps.columnTree)||Array.isArray(this.internalProps.rowTree))&&t?.[0]?.constructor!==Array&&(this.flatDataToObjects=new bE({rows:r.layoutMap.fullRowDimensionKeys,columns:r.layoutMap.colDimensionKeys,indicators:r.layoutMap.indicatorKeys,indicatorsAsCol:r.layoutMap.indicatorsAsCol,indicatorDimensionKey:r.layoutMap.indicatorDimensionKey},t)),this.refreshHeader(),this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(e.col,e.row),this.internalProps.title&&!this.internalProps.title.isReleased&&(this._updateSize(),this.internalProps.title.resize(),this.scenegraph.resize()),this.eventManager.updateEventBinder()}startEditCell(t,e){if(Y(t)&&Y(e))this.selectCell(t,e),this.editorManager.startEditCell(t,e);else if(this.stateManager.select?.cellPos){const{col:t,row:e}=this.stateManager.select.cellPos;Y(t)&&Y(e)&&this.editorManager.startEditCell(t,e)}}completeEditCell(){this.editorManager.completeEdit()}getEditor(t,e){let i;if(this.isHeader(t,e)&&!this.isCornerHeader(t,e)){const r=this.getHeaderDefine(t,e);i=r?.headerEditor??this.options.headerEditor}else{const r=this.getBodyColumnDefine(t,e);i=r?.editor??this.options.editor}if("function"==typeof i){i=i({col:t,row:e,dataValue:this.getCellOriginValue(t,e),value:this.getCellValue(t,e)||"",table:this})}return"string"==typeof i?$H(i):i}isHasEditorDefine(t,e){const i=this.getBodyColumnDefine(t,e);let r=i?.editor??this.options.editor;if("function"==typeof r){r=r({col:t,row:e,dataValue:this.getCellOriginValue(t,e),value:this.getCellValue(t,e)||"",table:this})}return Y(r)}changeCellValue(t,e,i,r=!1){if(r&&this.isHasEditorDefine(t,e)||!1===r){let r=i;const o=this.getCellOriginValue(t,e),n=this.getCellRawValue(t,e);"number"==typeof n&&YC(i)&&(r=parseFloat(i)),this._changeCellValueToDataSet(t,e,o,r);const s=this.getCellRange(t,e);for(let t=s.start.col;t<=s.end.col;t++)for(let e=s.start.row;e<=s.end.row;e++)this.scenegraph.updateCellContent(t,e);if("adaptive"===this.widthMode||this.autoFillWidth&&this.getAllColsWidth()<=this.tableNoFrameWidth)0===this.internalProps._widthResizedColMap.size&&this.scenegraph.recalculateColWidths();else if(!this.internalProps._widthResizedColMap.has(t)){const e=this.getColWidth(t),i=XM(t,0,this.rowCount-1,this,!1);i!==e&&this.scenegraph.updateColWidth(t,i-e)}if("adaptive"===this.heightMode||this.autoFillHeight&&this.getAllRowsHeight()<=this.tableNoFrameHeight)0===this.internalProps._heightResizedRowMap.size&&this.scenegraph.recalculateRowHeights();else if("autoHeight"===this.heightMode&&!this.internalProps._heightResizedRowMap.has(e)){const t=this.getRowHeight(e),i=VB(e,0,this.colCount-1,this);this.scenegraph.updateRowHeight(e,i-t)}this.fireListeners(ww.CHANGE_CELL_VALUE,{col:t,row:e,rawValue:n,currentValue:o,changedValue:r}),this.scenegraph.updateNextFrame()}}changeCellValues(t,e,i,r=!1){let o=t,n=e;for(let s=0;s<i.length&&!(e+s>this.rowCount-1);s++){n=e+s;const a=i[s];let l=t;for(let i=0;i<a.length&&!(t+i>this.colCount-1);i++)if(l=t+i,r&&this.isHasEditorDefine(t+i,e+s)||!1===r){const r=a[i];let o=r;const n=this.getCellOriginValue(t+i,e+s),l=this.getCellRawValue(t+i,e+s);"number"==typeof l&&YC(r)&&(o=parseFloat(r)),this._changeCellValueToDataSet(t+i,e+s,n,o),this.fireListeners(ww.CHANGE_CELL_VALUE,{col:t+i,row:e+s,rawValue:l,currentValue:n,changedValue:this.getCellOriginValue(t+i,e+s)})}o=Math.max(o,l)}const s=this.getCellRange(t,e),a=this.getCellRange(o,n);for(let t=s.start.col;t<=a.end.col;t++)for(let e=s.start.row;e<=a.end.row;e++)this.scenegraph.updateCellContent(t,e);if("adaptive"===this.widthMode||this.autoFillWidth&&this.getAllColsWidth()<=this.tableNoFrameWidth)0===this.internalProps._widthResizedColMap.size&&this.scenegraph.recalculateColWidths();else for(let e=t;e<=a.end.col;e++)if(!this.internalProps._widthResizedColMap.has(e)){const t=this.getColWidth(e),i=XM(e,0,this.rowCount-1,this,!1);i!==t&&this.scenegraph.updateColWidth(e,i-t)}if("adaptive"===this.heightMode||this.autoFillHeight&&this.getAllRowsHeight()<=this.tableNoFrameHeight)this.scenegraph.recalculateRowHeights();else if("autoHeight"===this.heightMode){const t=[],i=[];for(let r=e;r<=a.end.row;r++)if(this.rowHeightsMap.get(r)){const e=this.getRowHeight(r),o=VB(r,0,this.colCount-1,this);t.push(r),i.push(o-e)}this.scenegraph.updateRowsHeight(t,i)}this.scenegraph.updateNextFrame()}_changeCellValueToDataSet(t,e,i,r){if(this.dataset){const o=this.internalProps.layoutMap.getCellHeaderPaths(t,e);if(this.isHeader(t,e))this.internalProps.layoutMap.changeTreeNodeTitle(t,e,r),!this.isCornerHeader(t,e)&&this.dataset.changeRecordFieldValue(o.colHeaderPaths?.length?o.colHeaderPaths[o.colHeaderPaths.length-1].indicatorKey??o.colHeaderPaths[o.colHeaderPaths.length-1].dimensionKey:o.rowHeaderPaths[o.rowHeaderPaths.length-1].indicatorKey??o.rowHeaderPaths[o.rowHeaderPaths.length-1].dimensionKey,i,r);else{const i=o.colHeaderPaths.map((t=>t.indicatorKey??t.value)),n=o.rowHeaderPaths.map((t=>t.indicatorKey??t.value));this.dataset.changeTreeNodeValue(this.internalProps.layoutMap.indicatorsAsCol?n:n.slice(0,-1),this.internalProps.layoutMap.indicatorsAsCol?i.slice(0,-1):i,this.internalProps.layoutMap.getIndicatorKey(t,e),r)}}else if(this.flatDataToObjects){const o=this.internalProps.layoutMap.getCellHeaderPaths(t,e);if(this.isHeader(t,e))this.internalProps.layoutMap.changeTreeNodeTitle(t,e,r),!this.isCornerHeader(t,e)&&this.flatDataToObjects.changeRecordFieldValue(o.colHeaderPaths?.length?o.colHeaderPaths[o.colHeaderPaths.length-1].indicatorKey??o.colHeaderPaths[o.colHeaderPaths.length-1].dimensionKey:o.rowHeaderPaths[o.rowHeaderPaths.length-1].indicatorKey??o.rowHeaderPaths[o.rowHeaderPaths.length-1].dimensionKey,i,r);else{const i=o.colHeaderPaths.map((t=>t.indicatorKey??t.value)),n=o.rowHeaderPaths.map((t=>t.indicatorKey??t.value));this.flatDataToObjects.changeTreeNodeValue(n,i,this.internalProps.layoutMap.getBody(t,e).indicatorKey,r)}}else{const i=this.getBodyIndexByRow(e),o=this.getBodyIndexByCol(t);this.records[i][o]=r}}_hasCustomRenderOrLayout(){if(this.options.customRender)return!0;const{columnsDefine:t,rowsDefine:e,indicatorsDefine:i}=this.internalProps.layoutMap;for(let e=0;e<t.length;e++){const i=t[e];if("string"!=typeof i&&(i.headerCustomLayout||i.headerCustomRender))return!0}for(let t=0;t<e.length;t++){const i=e[t];if("string"!=typeof i&&(i.headerCustomLayout||i.headerCustomRender))return!0}for(let t=0;t<i.length;t++){const e=i[t];if("string"!=typeof e&&(e.customLayout||e.headerCustomLayout||e.customRender||e.headerCustomRender))return!0}return!1}changeRecordOrder(t,e){}setTreeNodeChildren(t,e,i,r){if(this.flatDataToObjects){const o=this.internalProps.layoutMap.getCellHeaderPaths(i,r);this.internalProps.layoutMap.getHeadNode(o.rowHeaderPaths.slice(0,o.rowHeaderPaths.length)).children=t,this._refreshHierarchyState(i,r,(()=>{this.flatDataToObjects.changeDataConfig({rows:this.internalProps.layoutMap.fullRowDimensionKeys,columns:this.internalProps.layoutMap.colDimensionKeys,indicators:this.internalProps.layoutMap.indicatorKeys,indicatorsAsCol:this.internalProps.layoutMap.indicatorsAsCol,indicatorDimensionKey:this.internalProps.layoutMap.indicatorDimensionKey}),this.flatDataToObjects.addRecords(e)}))}}},t.TYPES=cC,t.VArc=function(t){return hh.arc(t?t.attribute:{})},t.VArea=function(t){return hh.area(t?t.attribute:{})},t.VCheckBox=function(t){return new h_(t?t.attribute:{})},t.VCircle=function(t){return hh.circle(t?t.attribute:{})},t.VGlyph=function(t){return hh.glyph(t?t.attribute:{})},t.VGroup=function(t){return hh.group(t?t.attribute:{})},t.VImage=function(t){return hh.image(t?t.attribute:{})},t.VLine=function(t){return hh.line(t?t.attribute:{})},t.VPath=function(t){return hh.path(t?t.attribute:{})},t.VPolygon=function(t){return hh.polygon(t?t.attribute:{})},t.VRadio=function(t){return new c_(t?t.attribute:{})},t.VRect=function(t){return hh.rect(t?t.attribute:{})},t.VSymbol=function(t){return hh.symbol(t?t.attribute:{})},t.VTag=function(t){return new yv(t?t.attribute:{})},t.VText=function(t){return hh.text(t?t.attribute:{})},t.clearGlobal=function(){qH()},t.core=UH,t.data=mA,t.getDataCellPath=function(t,e,i){const r=xE(t),o=new fE({options:t,internalProps:t,isPivotChart:()=>!0,pivotChartAxes:[],_selectedDataItemsInChart:[],_getActiveChartInstance:()=>({updateState:()=>{}})},r);for(let t=0;t<o.colCount;t++)for(let n=0;n<o.rowCount;n++){if(o.isHeader(t,n))continue;const s=o.getCellHeaderPaths(t,n),a=s.colHeaderPaths.map((t=>t.indicatorKey??t.value)),l=s.rowHeaderPaths.map((t=>t.indicatorKey??t.value)),h=r.getAggregator(o.indicatorsAsCol?l:l.slice(0,-1),o.indicatorsAsCol?a.slice(0,-1):a,o.getIndicatorKey(t,n)),c=_E(h.value?h.value():void 0,e,t,n,o,i);if(c)return c}},t.getIcons=function(){return xR()},t.graphicUtil=Au,t.jsx=function(t,e){const i=e||{},{key:r,name:o,id:n,attribute:s,stateProxy:a}=i,l=Yg(i,["key","name","id","attribute","stateProxy"]);let h=t;tt(t)&&(h=hh[t]);const c=[];for(var d=arguments.length,u=new Array(d>2?d-2:0),g=2;g<d;g++)u[g-2]=arguments[g];u.length&&qg(1===u.length?u[0]:u,c);const p="Group"===h.name?new h(s):h(e);return function(t,e,i){let r,o=!1;switch(t.type){case"richtext":case"rich/image":break;case"rich/text":r=t.attribute||{},e[0]&&(r.text=e[0]);break;default:o=!0}o?(e.forEach((e=>{e&&t.add(e)})),Object.keys(i).forEach((e=>{const r=Xg[e];r&&t.on(r,i[e])}))):"richtext"===t.type&&(t.attribute.textConfig=e.map((t=>t.attribute)).filter((t=>t)))}(p,c,l),a&&(p.stateProxy=a),p},t.register=ZH,t.renderChart=wM,t.restoreMeasureText=function(){kB="canvas",Xr.load(FB)},t.setCustomAlphabetCharSet=function(t){EB=t,IB.clear()},t.themes=ev,t.updateCell=nB,t.version="0.25.0"}));
