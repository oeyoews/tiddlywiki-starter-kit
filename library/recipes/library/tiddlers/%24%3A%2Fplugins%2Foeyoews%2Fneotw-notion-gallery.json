{"title":"$:/plugins/oeyoews/neotw-notion-gallery","description":"neotw-notion-gallery","author":"oeyoews","version":"0.1.0","core-version":">=5.3.0","type":"application/json","plugin-type":"plugin","name":"neotw-notion-gallery","dependents":"$:/plugins/oeyoews/tiddlywiki-tailwindcss-plus","list":"readme","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/neotw-notion-gallery/readme\":{\"title\":\"$:/plugins/oeyoews/neotw-notion-gallery/readme\",\"description\":\"å¡ç‰‡è§†å›¾\",\"text\":\"!! æ’ä»¶ä»‹ç»\\n\\n> æ”¯æŒä¹¦å•, åšå®¢, æ—¥å¿—ç­‰å¡ç‰‡è§†å›¾\\n\\nps: æ”¯æŒè±†ç“£å›¾ç‰‡é“¾æ¥(ä¸å—é˜²ç›—é“¾å½±å“)\\r\\npss: å»ºè®®å¼€å¯æµè§ˆå™¨GPUåŠ é€Ÿ,æµè§ˆæ•ˆæœæ›´ä½³(tailwindcss å½±å“)\\n\\n!! ä½¿ç”¨æ–¹æ³•\\n\\n```bash\\r\\n<$cards />\\n\\n## å¯é€‰å‚æ•°filter, filter é»˜è®¤ä¸º [!is[system]!has[draft.of]!sort[created]limit[9]]\\r\\n<$cards filter=\\\"[tag[Journal]limit[9]]\\\"/>\\n\\n## æŒ‡å®šæŸä¸€ä¸ª(æˆ–è€…å¤šä¸ª)å›ºå®štiddler\\r\\n<$cards filter=\\\"[[$:/core/ui/ControlPanel/Plugins]] [[GettingStarted]]\\\" />\\n\\n## æ‚åˆ(æ··ç”¨)\\r\\n## tiddler çš„ç­›é€‰å™¨ç”¨æ³•æ²¡æœ‰æ˜ç¡®çš„æœ¯è¯­è¡¨è¾¾,å¯¼è‡´æ•™ç¨‹åªèƒ½`show me the code`, ä¸åƒå¤§ä¼—åŒ–çš„ç¼–ç¨‹è¯­è¨€(æ¯”å¦‚JS,React,Vue),å®˜æ–¹ç»Ÿä¸€åˆ¶å®šäº†æœ¯è¯­, æ¯”è¾ƒæµ…æ˜¾æ˜“æ‡‚\\r\\n<$cards filter=\\\"[[GettingStarted]] [!is[system]!has[draft.of]!sort[modified]!is[shadow]limit[8]]\\\" />\\r\\n```\\n\\n> å›¾ç‰‡é»˜è®¤ä½¿ç”¨æ¯ä¸ªtiddlerçš„page-coverå­—æ®µ, å¦‚æœpage-coverå­—æ®µä¸å­˜åœ¨, åˆ™ä½¿ç”¨ `https://source.unsplash.com/random/1920x1080?fm=blurhash&${title}`\\n\\n> ä¾èµ–æ’ä»¶: tailwindcss\\n\\n> é»˜è®¤ä½¿ç”¨(16:9)1920x1080çš„åˆ†è¾¨ç‡(åˆ†è¾¨ç‡è¶Šå¤§(å›¾ç‰‡è´¨é‡è¶Šé«˜), å›¾ç‰‡åŠ è½½é€Ÿåº¦å°±ç›¸å¯¹è¾ƒæ…¢)\\n\\n> å·²ç»å€ŸåŠ©tailwindcsså¯¹é¡µé¢è¿›è¡Œäº†é˜²æŠ–åŠ¨å¤„ç†, å›¾ç‰‡æŒ‰éœ€åŠ è½½\\n\\n> ä¹‹æ‰€ä»¥ç›®å‰ä»…ä»…æ˜¾ç¤ºå›¾ç‰‡, è€Œä¸æ˜¯åƒnotionçš„galleryå¸ƒå±€, æ˜¯å› ä¸ºç”±äºfilterçš„ä¸åŒä¼šå¯¼è‡´ä¸åŒçš„æ ·å¼, æ­¤æ’ä»¶ç›®å‰å¤„äºbetaé˜¶æ®µ, æš‚æ—¶ä¸æ‰“ç®—æ”¯æŒç±»ä¼¼notionçš„åŠ¨æ€å­—æ®µé…ç½®(æ—¶é—´æœ‰é™, ç†è®ºä¸Šæ˜¯å®Œå…¨å¯ä»¥åšåˆ°)\\n\\n!! Recipes\\n\\n> æ¯ä¸ªtiddlerçš„æ ‡é¢˜ä¸è¦åƒè®ºæ–‡æ ‡é¢˜é‚£æ ·è¿‡é•¿(ä¹Ÿè®¸æˆ‘æ­£æ–‡çš„éƒ¨åˆ†è¿˜æ²¡ä½ çš„æ ‡é¢˜é•¿ ğŸ˜€), å°½é‡ç®€çŸ­æ‰¼è¦\\n\\n!! æ˜¾ç¤ºæœ€è¿‘æ›´æ–°åŠ¨æ€\\n\\n<$cards />\\n\\n!! æœ€è¿‘çš„æ—¥å¿—\\n\\n<$cards filter=\\\"[tag[Journal]limit[9]]\\\"/>\\n\\n<!-- > å…¶å®ä½¿ç”¨wikitextå¯ä»¥å¾ˆå¿«å†™ä¸€ä¸ª, ä½†æ˜¯wikitextçš„enlist, set, var(ç”¨æ³•), æ¯æ¬¡éƒ½è®°ä¸ä½(æ–‡æ¡£æœç´¢çœŸçš„ä¸å¥½ç”¨), å¤´ç–¼ -->\\r\\n<!-- ä¼šæœ‰é—ªçƒ, ç”±äºtailwindcssä¸ºåŠ è½½å®Œæˆåº”ç”¨æ ·å¼ -->\\n\\n<!-- äº‹å®è¯æ˜jså†™çš„widgetæ›´å…·æœ‰æ‰©å±•æ€§,çµæ´»æ€§ -->\\n\\n!! v1.TODO\\n\\n* add title params\\r\\n* support gallery to show all images(æš‚æ—¶ä¸åš)\\r\\n* è‡ªåŠ¨ç”Ÿæˆ today jounal card(use bing today wallpaper)(æš‚æ—¶ä¸åš)\\r\\n* å›¾ç‰‡é»˜è®¤å¯ç”¨, æˆ–è€…éƒ¨åˆ†å¯é€‰æ‹©æ€§å¯ç”¨, å›¾ç‰‡åŠ è½½é€Ÿåº¦è¾ƒæ…¢\\r\\n* ğŸŸ© icon: ä¸ä½¿ç”¨iconå­—æ®µ(æ”¹ç”¨page-icon),è¿™é‡Œå€ŸåŠ©iconifyæ’ä»¶\\r\\n* ğŸŸ¥ sort(filter): add dynamic filter interface\\r\\n* ğŸŸ¥ peek: å®ç°peek, æ”¯æŒå…¨å±, tm-modalå¯ä»¥å€Ÿé‰´(çµæ´»æ€§ä¸å¤Ÿ), ä½†æ˜¯å…¨å±è¿˜æ˜¯è¦å¦å¤–æƒ³åŠæ³•square\\r\\n* ğŸŸ¥ tag: tagå¯ç‚¹å‡», å¯ä»¥ä¿®æ”¹tag\\r\\n* ğŸŸ¥ dropmenu: æ”¯æŒtiddlerçš„åˆ é™¤,å¤åˆ¶(clone), é“¾æ¥å¤åˆ¶, é‡å‘½å, star(favourite æä¾›æ”¯æŒ)\\r\\n* ğŸŸ¥ UI: æ·»åŠ title(æ”¯æŒä¿®æ”¹), tag(tag manager)\\r\\n* ğŸŸ¥ æ”¯æŒæ–°å¢tiddler\\r\\n* ğŸŸ¥ search: current filter tiddler search\\r\\n* ğŸŸ¥ view: æ”¯æŒgallary-table-magazineçš„åˆ‡æ¢, æ”¯æŒå­—æ®µå¯è§†åŒ–å®æ—¶ç¼–è¾‘\\r\\n* æ”¯æŒåˆ—å‡ºæ‰€æœ‰çš„æ’ä»¶: ä½¿ç”¨plugin-name ä»£æ›¿è¿‡é•¿çš„title\\n\\n> å¦‚æœè¿‡äºå¤æ‚å¹¶ä¸”æœ‰æ—¶é—´çš„è¯,å¯èƒ½ä¼šå¼•å…¥xstateè¿›è¡ŒçŠ¶æ€ç®¡ç†\\n\\n> è¿™é‡Œç»å¯¹ä¿è¯ä¸äº†1:1å®Œå…¨å¤åˆ»notion\\n\\n> ps: notion çš„åŠŸèƒ½å¤ªèŠ±å“¨äº†(å¤åˆ»åˆ°tiddlywikiéœ€è¦å¾ˆå¤šç²¾åŠ›), å¦‚æœæƒ³è¦æ›´å¥½çš„ä½“éªŒ, å¯ä»¥ç›´æ¥ä½¿ç”¨notion\\r\\n\"},\"$:/plugins/oeyoews/neotw-notion-gallery/config.js\":{\"title\":\"$:/plugins/oeyoews/neotw-notion-gallery/config.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-notion-gallery/config.js\\ntype: application/javascript\\nmodule-type: library\\n\\n\\\\*/\\nmodule.exports = {\\n  defaultFilter: '[!is[system]!sort[modified]limit[9]]',\\n  imageField: 'page-cover',\\n  // minCards: 9,\\n  maxCards: 60,\\n  resoultion: '1920x1080',\\n  imageSource: 'https://source.unsplash.com/random',\\n};\\n\",\"type\":\"application/javascript\",\"module-type\":\"library\"},\"$:/plugins/oeyoews/neotw-notion-gallery/createCard.js\":{\"title\":\"$:/plugins/oeyoews/neotw-notion-gallery/createCard.js\",\"text\":\"/*\\\\\\r\\ntitle: $:/plugins/oeyoews/neotw-notion-gallery/createCard.js\\r\\ntype: application/javascript\\r\\nmodule-type: library\\r\\n\\r\\n\\\\*/\\r\\n/** create card */\\r\\nmodule.exports = function createCard(\\r\\n  title,\\r\\n  cover,\\r\\n  clickEvents,\\r\\n  icon,\\r\\n  standard = true,\\r\\n) {\\r\\n  const options = {\\r\\n    root: null,\\r\\n    rootMargin: '0px',\\r\\n    threshold: 0.3, // å½“å›¾ç‰‡50%è¿›å…¥å¯è§†åŒºåŸŸæ—¶åŠ è½½\\r\\n  };\\r\\n\\r\\n  const createElement = $tw.utils.domMaker;\\r\\n\\r\\n  function callback(entries, observer) {\\r\\n    entries.forEach((entry) => {\\r\\n      if (entry.isIntersecting) {\\r\\n        const image = entry.target;\\r\\n        image.src = cover;\\r\\n        image.onload = () => {\\r\\n          img.alt = title;\\r\\n          image.classList.remove(...dynamicClassNames.split(' '));\\r\\n          img.classList.add('cursor-pointer');\\r\\n        };\\r\\n        observer.unobserve(image); // åŠ è½½åå–æ¶ˆç›‘æµ‹\\r\\n      }\\r\\n    });\\r\\n  }\\r\\n\\r\\n  const observer = new IntersectionObserver(callback, options);\\r\\n\\r\\n  const dynamicClassNames = 'scale-105 blur-md bg-black/10 cursor-wait';\\r\\n  const itemClassList =\\r\\n    'flex flex-col items-center justify-center p-0 group relative';\\r\\n  const galleryTitleClassList =\\r\\n    'delay-100 text-[22px] cursor-pointer flex justify-center items-center truncate m-0 absolute inset-0 backdrop-blur-lg text-black rounded-md ease-in-out transition-all scale-0 group-hover:scale-105';\\r\\n\\r\\n  const iconify = createElement('iconify-icon', {\\r\\n    class: 'mx-1',\\r\\n    attributes: {\\r\\n      icon: icon || 'simple-icons:tiddlywiki',\\r\\n    },\\r\\n  });\\r\\n\\r\\n  const galleryTitle = createElement('h3', {\\r\\n    class: galleryTitleClassList,\\r\\n    text: title,\\r\\n    children: [iconify],\\r\\n    attributes: {\\r\\n      title: 'ç‚¹å‡»æŸ¥çœ‹',\\r\\n    },\\r\\n  });\\r\\n\\r\\n  const contentNode = createElement('div', {\\r\\n    children: [galleryTitle],\\r\\n  });\\r\\n\\r\\n  galleryTitle.addEventListener('click', () => clickEvents(title));\\r\\n\\r\\n  const img = createElement('img', {\\r\\n    class: `object-cover w-full h-full rounded-md group-hover:scale-105 transition-all duration-800 ease-in-out shadow-md aspect-video ${dynamicClassNames}`,\\r\\n    attributes: {\\r\\n      loading: 'lazy',\\r\\n    },\\r\\n  });\\r\\n\\r\\n  standard === 'false' && img.classList.remove('aspect-video');\\r\\n\\r\\n  const item = createElement('div', {\\r\\n    class: itemClassList,\\r\\n    children: [img, contentNode],\\r\\n  });\\r\\n\\r\\n  observer.observe(img);\\r\\n\\r\\n  item.addEventListener('contextmenu', (e) => {\\r\\n    e.preventDefault();\\r\\n  });\\r\\n\\r\\n  return item;\\r\\n};\\r\\n\",\"type\":\"application/javascript\",\"module-type\":\"library\"},\"$:/plugins/oeyoews/neotw-notion-gallery/meta\":{\"title\":\"$:/plugins/oeyoews/neotw-notion-gallery/meta\",\"tags\":\"$:/tags/RawMarkupWikified/TopHead\",\"text\":\"`<meta name=\\\"referrer\\\" content=\\\"never\\\" />`\\n\"},\"table-view/widget\":{\"title\":\"table-view/widget\",\"text\":\"/*\\\\\\ntitle: table-view/widget\\ntype: application/javascript\\nmodule-type: widget\\n\\ntable-view widget\\n\\n\\\\*/\\n(function () {\\n  /*jslint node: true, browser: true */\\n  /*global $tw: false */\\n  'use strict';\\n\\n  const Widget = require('$:/core/modules/widgets/widget.js').widget;\\n\\n  class TableWidget extends Widget {\\n    constructor(parseTreeNode, options) {\\n      super(parseTreeNode, options);\\n    }\\n\\n    render(parent, nextSibling) {\\n      if (!$tw.browser) return;\\n      this.parentDomNode = parent;\\n      this.computeAttributes();\\n      this.execute();\\n\\n      const createElement = $tw.utils.domMaker;\\n\\n      const titleBtn = createElement('button', {\\n        text: 'titleBtn',\\n      });\\n      const tagBtn = createElement('button', {\\n        text: 'tagBtn',\\n      });\\n\\n      const itemNode = createElement('div', {\\n        class:\\n          'flex flex-row overflow-scroll justify-start space-x-4 border-t border-t-gray-200',\\n        children: [titleBtn, tagBtn],\\n      });\\n\\n      const domNode = createElement('div', {\\n        class: 'ntable',\\n        children: [itemNode],\\n      });\\n\\n      parent.insertBefore(domNode, nextSibling);\\n      this.domNodes.push(domNode);\\n    }\\n  }\\n\\n  exports['ntable'] = TableWidget;\\n})();\",\"type\":\"application/javascript\",\"module-type\":\"widget\"},\"$:/plugins/oeyoews/neotw-notion-gallery/widget.js\":{\"title\":\"$:/plugins/oeyoews/neotw-notion-gallery/widget.js\",\"text\":\"/*\\\\\\r\\ntitle: $:/plugins/oeyoews/neotw-notion-gallery/widget.js\\r\\ntype: application/javascript\\r\\nmodule-type: widget\\r\\n\\r\\nneotw-notion-gallery widget\\r\\n\\r\\n\\\\*/\\r\\n(function () {\\r\\n  /*jslint node: true, browser: true */\\r\\n\\r\\n  /*global $tw: false */\\r\\n  'use strict';\\r\\n\\r\\n  const { widget: Widget } = require('$:/core/modules/widgets/widget.js');\\r\\n  const createCard = require('./createCard');\\r\\n  const config = require('./config');\\r\\n\\r\\n  class CardsWidget extends Widget {\\r\\n    constructor(parseTreeNode, options) {\\r\\n      super(parseTreeNode, options);\\r\\n      this.maxCards = config.maxCards;\\r\\n      this.defaultFilter = config.defaultFilter;\\r\\n      this.realFilter = null;\\r\\n    }\\r\\n\\r\\n    render(parent, nextSibling) {\\r\\n      if (!$tw.browser) return;\\r\\n      // check if tailwind is installed\\r\\n      // need add window on browser\\r\\n      if (!window.tailwind) {\\r\\n        console.warn('tailwind not installed by @neotw-notion-gallery');\\r\\n      }\\r\\n\\r\\n      this.parentDomNode = parent;\\r\\n      this.computeAttributes();\\r\\n      this.execute();\\r\\n\\r\\n      const wiki = $tw.wiki;\\r\\n\\r\\n      // éœ€è¦thisæŒ‡å‘parentWidget, ä½¿ç”¨ç®­å¤´å‡½æ•°\\r\\n      const navigate = (title) => {\\r\\n        this.parentWidget.dispatchEvent({\\r\\n          type: 'tm-navigate',\\r\\n          param: title,\\r\\n          navigateTo: title,\\r\\n        });\\r\\n        return false;\\r\\n      };\\r\\n\\r\\n      const { imageField, resoultion, imageSource } = config;\\r\\n\\r\\n      // update realfilter\\r\\n      this.realFilter = this.getAttribute('filter', this.defaultFilter);\\r\\n      const standard = this.getAttribute('standard');\\r\\n      const cardsTiddlers = this.removedFilterDraftTiddlers();\\r\\n\\r\\n      const prepareCardData = (tiddlers) => {\\r\\n        return tiddlers.slice(0, this.maxCards).map((tiddler) => {\\r\\n          const { fields } = wiki.getTiddler(tiddler) || { fields: {} };\\r\\n          if (!fields) return;\\r\\n          let cover = fields[imageField];\\r\\n          let icon = fields['page-icon'];\\r\\n          if (!cover || !cover.startsWith('http')) {\\r\\n            cover = `${imageSource}/${resoultion}?fm=blurhash&${fields.title}`;\\r\\n          }\\r\\n          return {\\r\\n            title: fields?.title,\\r\\n            cover,\\r\\n            icon,\\r\\n          };\\r\\n        });\\r\\n      };\\r\\n\\r\\n      const container = document.createElement('div');\\r\\n      const containerClassList =\\r\\n        'grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8 m-4';\\r\\n      // å…¶å®å¯ä»¥ç›´æ¥ä½¿ç”¨classNames\\r\\n      container.classList.add(...containerClassList.split(' '));\\r\\n\\r\\n      // TODO: åˆ†é¡µ\\r\\n      if (cardsTiddlers.length > this.maxCards) {\\r\\n        console.warn(\\r\\n          `${cardsTiddlers.length} å¼ å¡ç‰‡å³å°†æ¸²æŸ“, è¶…è¿‡æœ€å¤§é™åˆ¶ ${this.maxCards}, ä»…æ¸²æŸ“å‰ä¸‰åå¼ å¡ç‰‡ @neotw-notion-gallery`,\\r\\n        );\\r\\n      }\\r\\n\\r\\n      const data = prepareCardData(cardsTiddlers);\\r\\n\\r\\n      data.forEach(({ title, cover, icon }) => {\\r\\n        container.appendChild(\\r\\n          createCard(title, cover, navigate, icon, standard),\\r\\n        );\\r\\n      });\\r\\n\\r\\n      parent.insertBefore(container, nextSibling);\\r\\n      this.domNodes.push(container);\\r\\n    }\\r\\n\\r\\n    // å¦‚æœæ›´æ–°æˆ–è€…æ·»åŠ äº†æ–°çš„tiddler, åˆ™éœ€è¦é‡æ–°æ¸²æŸ“\\r\\n    isChanged(changedTiddlers) {\\r\\n      // è·å–æœ€æ–°çš„tiddlersåˆ—è¡¨\\r\\n      let cardsTiddlers = this.removedFilterDraftTiddlers();\\r\\n      const { filteredTiddlers: valuesToCheck, notExistTiddlers } =\\r\\n        this.removedDraftTiddlers(Object.keys(changedTiddlers));\\r\\n\\r\\n      let isChanged = valuesToCheck.some((value) =>\\r\\n        cardsTiddlers.includes(value),\\r\\n      );\\r\\n      // TODO: å¦‚æœåˆ é™¤äº†tiddler, éœ€è¦ç›‘å¬é•¿åº¦çš„å˜åŒ–è¿›è¡Œæ¸²æŸ“\\r\\n      // å¯ä»¥å­˜å‚¨ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„tiddleråˆ—è¡¨, å¦‚æœåˆ é™¤åˆ™éœ€è¦é‡æ–°æ¸²æŸ“, ä½†æ˜¯è¿™æ ·ä¸åˆ©äºä»¥åæ‰©å±•åŠ¨æ€filter\\r\\n      // å¦‚æœåˆ é™¤äº†tiddler,å°±é‡æ–°æ¸²æŸ“, æ— è§†è¿‡æ»¤å™¨\\r\\n      if (notExistTiddlers.length) {\\r\\n        isChanged = true;\\r\\n      }\\r\\n      return isChanged;\\r\\n    }\\r\\n\\r\\n    /**\\r\\n     * @description remove draft.of tiddler\\r\\n     * @param {Array} filterTiddlers\\r\\n     */\\r\\n\\r\\n    removedDraftTiddlers(filterTiddlers) {\\r\\n      let notExistTiddlers = [];\\r\\n\\r\\n      const filteredTiddlers = filterTiddlers.filter((title) => {\\r\\n        // NOTE: å¦‚æœæ˜¯ç³»ç»Ÿæ¡ç›®, å³ä½¿å­˜åœ¨ä¹Ÿä¼šè¿”å›false\\r\\n        const isExist = $tw.wiki.tiddlerExists(title);\\r\\n\\r\\n        if (!isExist) {\\r\\n          notExistTiddlers.push(title);\\r\\n          return false;\\r\\n        }\\r\\n\\r\\n        // NOTE: è¿‡æ»¤æ‰ç³»ç»Ÿæ¡ç›®\\r\\n        return !(title.startsWith('$:/') || title.startsWith('Draft of'));\\r\\n      });\\r\\n\\r\\n      return { filteredTiddlers, notExistTiddlers };\\r\\n    }\\r\\n\\r\\n    /**\\r\\n     * @description remove draft.of tiddler\\r\\n     * @param {string} realFilter\\r\\n     */\\r\\n    removedFilterDraftTiddlers(realFilter = this.realFilter) {\\r\\n      const filterTiddlers = $tw.wiki.filterTiddlers(realFilter);\\r\\n      return this.removedDraftTiddlers(filterTiddlers).filteredTiddlers;\\r\\n    }\\r\\n\\r\\n    refresh(changedTiddlers) {\\r\\n      const isChanged = this.isChanged(changedTiddlers);\\r\\n      if (isChanged) {\\r\\n        this.refreshSelf(); // é‡æ–°æ¸²æŸ“\\r\\n        return true;\\r\\n      } else {\\r\\n        return false;\\r\\n      }\\r\\n    }\\r\\n  }\\r\\n\\r\\n  /**\\r\\n   * @description notion-gallery widget\\r\\n   * @param {string} filter\\r\\n   */\\r\\n  exports.cards = CardsWidget;\\r\\n})();\\r\\n\",\"type\":\"application/javascript\",\"module-type\":\"widget\"}}}"}