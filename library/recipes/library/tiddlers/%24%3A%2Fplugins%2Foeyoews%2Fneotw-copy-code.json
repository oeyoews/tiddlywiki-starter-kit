{"title":"$:/plugins/oeyoews/neotw-copy-code","description":"Neotw Copy Code","author":"oeyoews","version":"0.2.1","core-version":">=5.3.0","type":"application/json","plugin-type":"plugin","name":"Neotw Copy Code","dependents":"$:/plugins/oeyoews/tiddlywiki-tailwindcss-plus $:/plugins/oeyoews/neotw-icons","list":"readme","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/neotw-copy-code/Layout\":{\"title\":\"$:/plugins/oeyoews/neotw-copy-code/Layout\",\"tags\":\"$:/tags/Layout\",\"name\":\"{{$:/plugins/oeyoews/neotw-copy-code/icon}} Neotw Copy Code\",\"description\":\"{{$:/plugins/oeyoews/neotw-copy-code/readme!!description}}\",\"text\":\"\\\\import [[$:/core/ui/PageMacros]] [all[shadows+tiddlers]tag[$:/tags/Macro]!has[draft.of]]\\n\\n<$vars\\n  tv-config-toolbar-icons={{$:/config/Toolbar/Icons}}\\n  tv-config-toolbar-text={{$:/config/Toolbar/Text}}\\n  tv-config-toolbar-class={{$:/config/Toolbar/ButtonClass}}\\n  tv-enable-drag-and-drop={{$:/config/DragAndDrop/Enable}}\\n  tv-show-missing-links={{$:/config/MissingLinks}}\\n  storyviewTitle={{$:/view}}\\n  languageTitle={{{ [{$:/language}get[name]] }}}>\\n\\n<div class=\\\"prose max-w-none prose-indigo m-auto sm:w-auto md:w-2/3\\\">\\n{{{ [[$:/plugins/oeyoews/neotw-copy-code/readme]] ||$:/core/ui/ViewTemplate }}}\\n</div>\"},\"$:/plugins/oeyoews/neotw-copy-code/readme\":{\"title\":\"$:/plugins/oeyoews/neotw-copy-code/readme\",\"description\":\"~Copy Code\",\"text\":\"<div class=\\\"prose max-w-none prose-indigo\\\">\\n\\n!! Neotw Copy Code\\n\\n> 图标支持的 highlgiht 识别的全部语言\\n\\n> This plugin can greatly improve the efficiency and convenience of displaying and sharing code in TiddlyWiki, especially when you need to copy code frequently.\\n\\n> 这个插件可以极大地提高在 TiddlyWiki 中显示和分享代码的效率和便利性，尤其是在需要频繁复制代码时。\\n\\n!! TODO\\n\\n* support filename, such as `main.js`\\n\\n!! Examples\\n\\n```bash\\n#!/bin/bash\\necho \\\"Hello, TiddlyWiki!\\\"\\n```\\n\\n```c\\n#include <stdio.h>\\n\\nint main() {\\n    printf(\\\"Hello, TiddlyWiki!\\\\n\\\");\\n    return 0;\\n}\\n```\\n\\n```cpp\\n#include <iostream>\\n\\nint main() {\\n    std::cout << \\\"Hello, TiddlyWiki!\\\" << std::endl;\\n    return 0;\\n}\\n```\\n\\n```csharp\\nusing System;\\n\\nclass Program {\\n    static void Main(string[] args) {\\n        Console.WriteLine(\\\"Hello, TiddlyWiki!\\\");\\n    }\\n}\\n```\\n\\n```css\\n/* index.css */\\nbody::before {\\n    content: \\\"Hello, TiddlyWiki!\\\";\\n}\\n```\\n\\n```go\\npackage main\\n\\nimport \\\"fmt\\\"\\n\\nfunc main() {\\n    fmt.Println(\\\"Hello, TiddlyWiki!\\\")\\n}\\n```\\n\\n```html\\n<!DOCTYPE html5>\\n<html>\\n<head>\\n    <title>Hello, TiddlyWiki!</title>\\n</head>\\n<body>\\n    <h1>Hello, TiddlyWiki!</h1>\\n</body>\\n</html>\\n```\\n\\n```java\\npublic class HelloWorld {\\n    public static void main(String[] args) {\\n        System.out.println(\\\"Hello, TiddlyWiki!\\\");\\n    }\\n}\\n```\\n\\n```javascript\\nconsole.log(\\\"Hello, TiddlyWiki!\\\");\\n```\\n\\n```json\\n{\\n  \\\"message\\\": \\\"Hello, TiddlyWiki!\\\"\\n}\\n```\\n\\n```kotlin\\nfun main() {\\n    println(\\\"Hello, TiddlyWiki!\\\")\\n}\\n```\\n\\n```less\\n@message: \\\"Hello, TiddlyWiki!\\\";\\nbody::before {\\n    content: @message;\\n}\\n```\\n\\n```lua\\nprint(\\\"Hello, TiddlyWiki!\\\")\\n```\\n\\n```makefile\\nhello:\\n    @echo \\\"Hello, TiddlyWiki!\\\"\\n```\\n\\n```markdown\\n# Hello, TiddlyWiki!\\n```\\n\\n```objective-c\\n#import <Foundation/Foundation.h>\\n\\nint main(int argc, const char * argv[]) {\\n    @autoreleasepool {\\n        NSLog(@\\\"Hello, TiddlyWiki!\\\");\\n    }\\n    return 0;\\n}\\n```\\n\\n```perl\\nprint \\\"Hello, TiddlyWiki!\\\\n\\\";\\n```\\n\\n```php\\n<?php\\necho \\\"Hello, TiddlyWiki!\\\";\\n?>\\n```\\n\\n```\\nHello, TiddlyWiki!\\n```\\n\\n```python\\nprint(\\\"Hello, TiddlyWiki!\\\")\\n```\\n\\n```r\\ncat(\\\"Hello, TiddlyWiki!\\\\n\\\")\\n```\\n\\n```ruby\\nputs \\\"Hello, TiddlyWiki!\\\"\\n```\\n\\n```rust\\nfn main() {\\n    println!(\\\"Hello, TiddlyWiki!\\\");\\n}\\n```\\n\\n```scss\\n$greeting: \\\"Hello, TiddlyWiki!\\\";\\n\\nbody::before {\\n    content: $greeting;\\n}\\n```\\n\\n```sql\\nSELECT 'Hello, TiddlyWiki!';\\n```\\n\\n```\\n$ echo \\\"Hello, TiddlyWiki!\\\"\\n```\\n\\n```swift\\nimport Swift\\n\\nprint(\\\"Hello, TiddlyWiki!\\\")\\n```\\n\\n```toml\\nmessage = \\\"Hello, TiddlyWiki!\\\"\\n```\\n\\n```typescript\\nconsole.log(\\\"Hello, TiddlyWiki!\\\");\\n```\\n\\n```vb\\nModule HelloWorld\\n    Sub Main()\\n        Console.WriteLine(\\\"Hello, TiddlyWiki!\\\")\\n    End Sub\\nEnd Module\\n```\\n\\n```xml\\n<root>\\n    <message>Hello, TiddlyWiki!</message>\\n</root>\\n```\\n\\n```yaml\\nmessage: Hello, TiddlyWiki!\\n```\\n\\n```apache\\n# httpd.conf\\nServerName localhost\\n\\n<VirtualHost *:80>\\n    DocumentRoot \\\"/path/to/www\\\"\\n    ServerName example.com\\n</VirtualHost>\\n```\\n\\n```dockerfile\\nFROM nginx:latest\\n\\nCOPY index.html /usr/share/nginx/html/index.html\\n```\\n\\n```fortran\\nprogram HelloWorld\\n    print *, \\\"Hello, TiddlyWiki!\\\"\\nend program HelloWorld\\n```\\n\\n```latex\\n\\\\documentclass{article}\\n\\n\\\\begin{document}\\nHello, TiddlyWiki!\\n\\\\end{document}\\n```\\n\\n```nginx\\nserver {\\n    listen 80;\\n    server_name example.com;\\n\\n    location / {\\n        root /var/www/html;\\n        index index.html;\\n    }\\n}\\n```\\n\"},\"$:/core/modules/widgets/codeblock.js\":{\"title\":\"$:/core/modules/widgets/codeblock.js\",\"text\":\"/*\\\\\\ntitle: $:/core/modules/widgets/codeblock.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nCode block node widget\\n\\n\\\\*/\\n(function () {\\n  /*jslint node: true, browser: true */\\n  /*global $tw: false */\\n  'use strict';\\n\\n  var Widget = require('$:/core/modules/widgets/widget.js').widget;\\n\\n  class CodeBlockWidget extends Widget {\\n    constructor(parseTreeNode, options) {\\n      super(parseTreeNode, options);\\n    }\\n\\n    render(parent, nextSibling) {\\n      if (!$tw.browser) return;\\n\\n      this.parentDomNode = parent;\\n      this.computeAttributes();\\n      this.execute();\\n\\n      const domNode = this.document.createElement('pre');\\n      const codeNode = this.document.createElement('code');\\n      const fileType = this.language;\\n      const classNames =\\n        'absolute fixed top-0 right-0 delay-200 bg-transparent hover:bg-gray-200 transition-all duration-600 ease-in-out p-1 flex flex-row';\\n\\n      const copyButton = this.document.createElement('button');\\n\\n      codeNode.appendChild(\\n        this.document.createTextNode(this.getAttribute('code')),\\n      );\\n\\n      domNode.appendChild(codeNode);\\n\\n      parent.insertBefore(domNode, nextSibling);\\n      this.domNodes.push(domNode);\\n\\n      if (this.postRender) {\\n        this.postRender();\\n      }\\n\\n      // patch: must be called after postrender\\n      domNode.className = 'relative group';\\n      codeNode.textContent && domNode.appendChild(copyButton);\\n      copyButton?.classList?.add(...classNames.split(' '));\\n      // BUG: plugin template has extra filetype text/plain ??? 这个模板用到了codeblock ???\\n      // copyButton.textContent = fileType || 'copy';\\n\\n      // icon\\n      const fileIcon = this.document.createElement('iconify-icon');\\n      let standardIconLanguage =\\n        codeNode.className.match(/language-(\\\\w+)/)?.[1] || '';\\n      const languageMapping = {\\n        bash: 'gnubash',\\n        css: 'css3',\\n        cpp: 'cplusplus',\\n        java: 'openjdk',\\n        ini: 'toml',\\n        dockerfile: 'docker',\\n        scss: 'sass',\\n        makefile: 'cmake',\\n        sql: 'mysql',\\n        // html: 'html5', // html language-xml bug\\n        xml: 'html5',\\n        '': 'tiddlywiki',\\n      };\\n      if (standardIconLanguage in languageMapping) {\\n        standardIconLanguage = languageMapping[standardIconLanguage];\\n      }\\n\\n      fileIcon.setAttribute('icon', `simple-icons:${standardIconLanguage}`);\\n      fileIcon.className = 'mx-1';\\n      copyButton.appendChild(fileIcon);\\n\\n      copyButton.addEventListener('click', () => {\\n        // NOTE: 0.0.0.0:xxx 自动禁用clipboard, 导致无法复制\\n        // ~~IOS 并不支持navigator, 目前不打断写兼容代码~~ ???\\n        navigator?.clipboard?.writeText(codeNode.textContent).then(() => {\\n          copyButton.textContent = '✅';\\n          setTimeout(() => {\\n            // copyButton.textContent = fileType || 'copy';\\n            copyButton.textContent = '';\\n            copyButton.appendChild(fileIcon);\\n          }, 2000);\\n        });\\n      });\\n    }\\n\\n    execute() {\\n      this.language = this.getAttribute('language');\\n    }\\n\\n    refresh(changedTiddlers) {\\n      const changedAttributes = this.computeAttributes();\\n      if (changedAttributes.code || changedAttributes.language) {\\n        this.refreshSelf();\\n        return true;\\n      } else {\\n        return false;\\n      }\\n    }\\n  }\\n\\n  exports.codeblock = CodeBlockWidget;\\n})();\\n\",\"type\":\"application/javascript\",\"module-type\":\"widget\"},\"$:/plugins/oeyoews/neotw-copy-code/icon\":{\"title\":\"$:/plugins/oeyoews/neotw-copy-code/icon\",\"text\":\"<svg stroke=\\\"currentColor\\\" fill=\\\"none\\\" stroke-width=\\\"2\\\" viewBox=\\\"0 0 24 24\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" height=\\\"1em\\\" width=\\\"1em\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path stroke=\\\"none\\\" d=\\\"M0 0h24v24H0z\\\" fill=\\\"none\\\"></path><path d=\\\"M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z\\\"></path><path d=\\\"M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2\\\"></path></svg>\"},\"$:/plugins/oeyoews/neotw-copy-code/add-copybutton.js\":{\"title\":\"$:/plugins/oeyoews/neotw-copy-code/add-copybutton.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-copy-code/add-copybutton.js\\ntype: application/javascript\\nmodule-type: library\\n\\neotw-copy-code widget\\n\\\\*/\\n\\nmodule.exports = function addCopyButton() {\\n  // 找到当前页面的所有代码块\\n  const codeBlocks = document.querySelectorAll('pre');\\n\\n  Swal.fire({\\n    title: codeBlocks.length ? `Enable copy code` : `当前页面没有发现代码块`,\\n    icon: codeBlocks.length ? 'success' : 'info',\\n    toast: true,\\n    showCancelButton: false,\\n    showConfirmButton: false,\\n    timer: 1500,\\n    position: 'top-end',\\n  });\\n\\n  // 如果没有代码块, 结束\\n  if (!codeBlocks.length) {\\n    return;\\n  }\\n\\n  codeBlocks.forEach((codeBlock) => {\\n    const existingButton = codeBlock.querySelector('[data-copy-button]');\\n\\n    if (!existingButton) {\\n      codeBlock.setAttribute('data-copy-button', '');\\n    } else {\\n      return;\\n    }\\n\\n    codeBlock.classList.add('relative', 'group');\\n\\n    const codeElement = codeBlock.querySelector('code');\\n    // if not have any code, dont add copybutton, show codside only have pre, but no code tag error\\n    if (!codeElement?.textContent) return;\\n\\n    // 获取 code 语言类型\\n    const fileType = codeElement.className.match(/language-(\\\\w+)/)?.[1] || '';\\n    // opacity-0 scale-0 group-hover:opacity-100 group-hover:scale-100\\n    const classNames = `absolute fixed top-0 right-0 delay-200 bg-transparent hover:bg-gray-200 transition-all duration-600 ease-in-out p-1 flex flex-row`;\\n\\n    // 添加 copybutton\\n    const copyButton = $tw.utils.domMaker('button', {\\n      text: fileType || 'copy',\\n      class: classNames,\\n    });\\n\\n    const fileIcon = document.createElement('iconify-icon');\\n    fileIcon.setAttribute('icon', `mdi:language-${fileType}`);\\n    fileIcon.classList.add('mx-1');\\n    fileType && copyButton.appendChild(fileIcon);\\n\\n    copyButton.addEventListener('click', () => {\\n      // NOTE: 0.0.0.0:xxx 自动禁用clipboard, 导致无法复制\\n      // ~~IOS 并不支持navigator, 目前不打断写兼容代码~~ ???\\n      navigator?.clipboard?.writeText(codeElement.textContent).then(() => {\\n        copyButton.textContent = 'Copied';\\n        setTimeout(() => {\\n          copyButton.textContent = fileType || 'copy';\\n          fileType && copyButton.appendChild(fileIcon);\\n        }, 2000);\\n      });\\n    });\\n\\n    codeElement?.parentNode?.insertBefore(copyButton, codeElement);\\n  });\\n};\\n\",\"type\":\"application/javascript\",\"module-type\":\"library\"},\"$:/plugins/oeyoews/neotw-copy-code/copycode-startup.js\":{\"title\":\"$:/plugins/oeyoews/neotw-copy-code/copycode-startup.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-copy-code/copycode-startup.js\\ntype: application/javascript\\n// module-type: startup\\n\\ncopyButton module\\n\\n\\\\*/\\n(function () {\\n  /*jslint node: true, browser: true */\\n  /*global $tw: false */\\n  'use strict';\\n\\n  exports.name = 'copyButton-startup-hook';\\n  exports.platforms = ['browser'];\\n  exports.after = ['startup'];\\n  exports.synchronous = true;\\n  exports.startup = () => {\\n    const addCopyButton = require('$:/plugins/oeyoews/neotw-copy-code/add-copybutton.js');\\n    $tw.rootWidget.addEventListener('om-copy-code', () => {\\n      addCopyButton();\\n    });\\n  };\\n})();\\n\",\"type\":\"application/javascript\",\"// module-type\":\"startup\"},\"$:/plugins/oeyoews/neotw-copy-code/ui\":{\"title\":\"$:/plugins/oeyoews/neotw-copy-code/ui\",\"description\":\"copy code button\",\"caption\":\"Copy Button\",\"text\":\"<!-- tags: $:/tags/PageControls -->\\n<!-- list-before: -->\\n\\n\\\\whitespace trim\\n<$button message=\\\"om-copy-code\\\" tooltip=\\\"Copy Code\\\" aria-label=\\\"copy\\\" class=<<tv-config-toolbar-class>>>\\n<$list filter=\\\"[<tv-config-toolbar-icons>match[yes]]\\\">\\n{{$:/plugins/oeyoews/neotw-copy-code/icon}}\\n</$list>\\n<$list filter=\\\"[<tv-config-toolbar-text>match[yes]]\\\">\\n<span class=\\\"tc-btn-text\\\">\\n<$text text=\\\"Copy\\\"/>\\n</span>\\n</$list>\\n</$button>\\n\"}}}"}