{"title":"$:/plugins/oeyoews/notebook-theme-sidebar-resizer","description":"notebook-theme-sidebar-resizer","author":"oeyoews","version":"0.0.5","core-version":">=5.3.1","type":"application/json","plugin-type":"plugin","name":"notebook-theme-sidebar-resizer","meat#disabled":"yes","qrcode":"yes","created":"2023-12-19","dependents":"$:/plugins/oeyoews/tiddlywiki-tailwindcss-plus","list":"readme","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/readme\":{\"title\":\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/readme\",\"text\":\"## Notebook theme sidebar resizer\\n\\n- support left/right sidebar resizer\\n\\n## TODO\\n\\n- use css file instead of tailwindcss plugin dependency\\n- 拖动时,光标样式会抖动\\n\",\"type\":\"text/markdown\",\"description\":\"notebook-theme-sidebar-resizer\"},\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/widget.js\":{\"title\":\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/widget.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/notebook-theme-sidebar-resizer/widget.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nnotebook-theme-sidebar-resizer widget\\n\\n\\\\*/\\nconst { widget: Widget } = require('$:/core/modules/widgets/widget.js');\\n\\n// TODO: add some button on bar to reset, close or open\\nclass NotebookResizer extends Widget {\\n  constructor(parseTreeNode, options) {\\n    super(parseTreeNode, options);\\n    this.isResizing = false;\\n    this.tiddler = '$:/themes/nico/notebook/metrics/sidebar-width';\\n    this.positionTiddler = '$:/themes/nico/notebook/metrics/sidebar-position';\\n    this.stateSidebar = '$:/state/notebook-sidebar';\\n    this.width;\\n  }\\n\\n  getSidebarPosition() {\\n    if (!$tw.wiki.tiddlerExists(this.positionTiddler)) {\\n      return 'left';\\n    }\\n    const { position = 'left' } = $tw.wiki.getTiddler(\\n      this.positionTiddler,\\n    ).fields;\\n    return position;\\n  }\\n\\n  render(parent, nextSibling) {\\n    if (!$tw.browser) return;\\n    this.parentDomNode = parent;\\n    this.computeAttributes();\\n    this.execute();\\n\\n    const logger = new $tw.utils.Logger('notebook-theme-sidebar-resizer');\\n    if (!$tw.modules.titles['tailwindcss.min.js']) {\\n      logger.alert(\\n        \\\"[notebook-theme-sidebar-resizer]: requires the 'tiddlywiki/tailwindcss-plus' plugin to be installed\\\",\\n      );\\n    }\\n    const createElement = $tw.utils.domMaker;\\n\\n    const resizer = createElement('div', {\\n      class:\\n        'hover:cursor-ew-resize bg-gray-100 dark:bg-gray-500 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-full transition-all h-full w-[5px] absolute top-0',\\n      // attributes: { id: 'om-resizer' },\\n    });\\n\\n    if (this.getSidebarPosition() === 'left') {\\n      resizer.classList.add('right-0');\\n    } else {\\n      resizer.classList.add('left-0');\\n    }\\n\\n    // let width = $tw.wiki.getTiddlerText(this.tiddler).replace('px', '');\\n\\n    // TODO: support reset sidebar width\\n    resizer.addEventListener('pointerdown', (e) => {\\n      this.isResizing = true;\\n      e.preventDefault(); // 阻止默认的文本选择行为\\n      document.addEventListener('pointermove', resize);\\n\\n      document.addEventListener('pointerup', stopResize);\\n    });\\n\\n    const resize = (e) => {\\n      const clientX = e.clientX;\\n      if (this.isResizing) {\\n        if (this.getSidebarPosition() === 'left') {\\n          this.width = clientX;\\n        } else {\\n          this.width = window.innerWidth - clientX;\\n        }\\n        if (this.width / window.innerWidth > 0.75) {\\n          return;\\n        }\\n        if (this.width / window.innerWidth < 0.01) {\\n          this.closeSidebar();\\n          this.isResizing = false;\\n          return;\\n        }\\n        this.updateSidebarWidth(this.width);\\n      }\\n    };\\n\\n    const stopResize = () => {\\n      this.isResizing = false;\\n      document.removeEventListener('pointermove', resize);\\n    };\\n\\n    parent.insertBefore(resizer, nextSibling);\\n    this.domNodes.push(resizer);\\n  }\\n\\n  closeSidebar() {\\n    $tw.wiki.setText(this.stateSidebar, 'text', null, 'no');\\n    this.updateSidebarWidth(350);\\n  }\\n\\n  updateSidebarWidth(width) {\\n    requestAnimationFrame(() => {\\n      $tw.wiki.setText(this.tiddler, null, null, `${width.toFixed(0)}px`);\\n    });\\n  }\\n\\n  refresh(changedTiddlers) {\\n    if (Object.keys(changedTiddlers).includes(this.positionTiddler)) {\\n      this.refreshSelf();\\n      return true;\\n    }\\n    return false;\\n  }\\n}\\n\\n/**\\n * @description notebook-theme-sidebar-resizer widget\\n */\\nexports.nbresizer = NotebookResizer;\\n\",\"type\":\"application/javascript\",\"module-type\":\"widget\"}}}"}