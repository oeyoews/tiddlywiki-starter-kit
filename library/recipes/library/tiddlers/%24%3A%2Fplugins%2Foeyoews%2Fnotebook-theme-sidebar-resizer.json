{"title":"$:/plugins/oeyoews/notebook-theme-sidebar-resizer","description":"notebook-theme-sidebar-resizer","author":"oeyoews","version":"0.2.6","core-version":">=5.3.0","type":"application/json","plugin-type":"plugin","name":"notebook theme sidebar resizer","meat#disabled":"yes","plugin-priority":100,"qrcode":"yes","created":"2023-12-19","list":"readme","dependents":"","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/readme\":{\"title\":\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/readme\",\"text\":\"!! Notebook theme sidebar resizer\\n\\n> support left/right sidebar resizer\\n\\n> 最初仅仅是为了支持 notebook theme 而写的 sidebar resizer, 后来开始支持 vanilla(and based vanilla sidebar theme), captivate, whitespace 等主题.\\n\\n<!-- 在切换主题时，theme 会覆盖掉同名非系统文件，所以需要手动修改 -->\\n\\n!! For captivate theme\\n\\nneed add `<$nbresizer />` in [[$:/themes/cdr/captivate/ui/SideBar]] tiddler.\\n\\n```html\\n<<sidebarTabs>>\\n<!-- here -->\\n<$nbresizer />\\n```\\n\\n!! For Whitespace theme\\n\\n> whitespace theme for two 5.1.17 and 5.1.22 version, if use latest version, maybe have some ui problems.\\n\\nneed add `<$nbresizer />` in [[$:/themes/jd/Whitespace/template/sidebar]] tiddler.\\n\\n```html\\n<!-- add resizer widget here  -->\\n\\n<$transclude/>\\n<$nbresizer />\\n```\\n\\n> 如果你在不同的主题切换, 你会发现一些 UI 上的异常, 那是因为 这个 tiddler 被修改后变成了 shadow tiddler, 在所有的主题下都会起作用.\\n\\n!! Recipes\\n\\n* 之所以部分主题需要手动修改 tiddler, 是因为他们的 sidebar 模板是写死的, 无法通过动态嵌入 tiddler. 这一点建议 学习 notebook theme\"},\"$:/themes/nico/notebook/ui/Sidebar/resizer\":{\"title\":\"$:/themes/nico/notebook/ui/Sidebar/resizer\",\"tags\":\"$:/themes/nico/notebook/tags/Sidebar $:/tags/SideBarSegment\",\"text\":\"<$nbresizer />\"},\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/default-sidebar-width\":{\"title\":\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/default-sidebar-width\",\"text\":\"300px\"},\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/locales/en.js\":{\"title\":\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/locales/en.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/notebook-theme-sidebar-resizer/locales/en.js\\ntype: application/javascript\\nmodule-type: library\\n\\nnotebook-theme-sidebar-resizer locale en\\n\\\\*/\\n\\nmodule.exports = {\\n  pluginname: 'notebook-theme-sidebar-resizer',\\n  warning:\\n    \\\"[notebook-theme-sidebar-resizer]: requires the 'tiddlywiki/tailwindcss-plus' plugin to be installed\\\"\\n};\\n\",\"type\":\"application/javascript\",\"module-type\":\"library\"},\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/locales/zh.js\":{\"title\":\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/locales/zh.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/notebook-theme-sidebar-resizer/locales/zh.js\\ntype: application/javascript\\nmodule-type: library\\n\\nnotebook-theme-sidebar-resizer locale zh\\n\\\\*/\\n\\nmodule.exports = {\\n  pluginname: '侧边栏宽度调整插件',\\n  warning: '需要安装 tailwindcss'\\n};\\n\",\"type\":\"application/javascript\",\"module-type\":\"library\"},\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/style.css\":{\"title\":\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/style.css\",\"text\":\".oresizer-left {\\n  left: 0;\\n}\\n.oresizer-right {\\n  right: 0;\\n}\\n\\n.oresizer {\\n  width: 5px;\\n  border-radius: 5px;\\n  height: 100%;\\n  position: absolute;\\n  top: 0;\\n  background-color: #f3f4f6;\\n}\\n\\n.oresizer:hover {\\n  cursor: e-resize;\\n  background-color: #e5e7eb;\\n  transition: all;\\n}\\n\\n.dark .oresizer {\\n  background-color: #6b7280;\\n}\\n.dark .oresizer:hover {\\n  background-color: #4b5563;\\n}\\n\",\"type\":\"text/css\",\"tags\":\"$:/tags/Stylesheet\"},\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/widget.js\":{\"title\":\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/widget.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/notebook-theme-sidebar-resizer/widget.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nnotebook-theme-sidebar-resizer widget\\n\\\\*/\\n\\nconst { widget: Widget } = require('$:/core/modules/widgets/widget.js');\\nconst en = require('./locales/en');\\n\\nclass NotebookResizer extends Widget {\\n  constructor(parseTreeNode, options) {\\n    super(parseTreeNode, options);\\n    // static\\n    this.VANILLA = 'vanilla';\\n    this.NOTEBOOK = 'notebook';\\n    this.LEFT = 'left';\\n    this.RIGHT = 'right';\\n    // default\\n    this.defaultWidthTiddler =\\n      '$:/themes/tiddlywiki/vanilla/metrics/sidebarwidth';\\n    this.nbWidthTiddler =\\n      '$:/plugins/oeyoews/notebook-theme-sidebar-resizer/default-sidebar-width';\\n    this.themeTiddler = '$:/theme';\\n    this.theme = null;\\n    this.isResizing = false;\\n    this.width = 0;\\n    this.defaultStateTiddler = '$:/state/sidebar';\\n\\n    // notebook\\n    this.notebook = {\\n      name: 'NOTEBOOK',\\n      theme: [\\n        '$:/themes/nico/notebook',\\n        '$:/themes/oeyoews/notebook-plus' // for my custom notebook theme\\n      ],\\n      stateTiddler: '$:/state/notebook-sidebar',\\n      widthTiddler: '$:/themes/nico/notebook/metrics/sidebar-width',\\n      positionTiddler: '$:/themes/nico/notebook/metrics/sidebar-position'\\n    };\\n\\n    // theme: whitespace\\n    this.whitespace = {\\n      name: 'WHITESPACE',\\n      theme: '$:/themes/jd/Whitespace',\\n      positionTiddler: '$:/config/Whitespace/sidebar',\\n      widthTiddler: this.defaultWidthTiddler\\n    };\\n\\n    this.sidebarLayoutTiddler =\\n      '$:/themes/tiddlywiki/vanilla/options/sidebarlayout';\\n\\n    // listen tiddlers\\n    this.listenTiddlers = [\\n      this.notebook.positionTiddler,\\n      '$:/language',\\n      '$:/layout',\\n      this.themeTiddler,\\n      this.whitespace.positionTiddler,\\n      this.sidebarLayoutTiddler\\n    ];\\n  }\\n\\n  render(parent, nextSibling) {\\n    if (!$tw.browser) return;\\n    this.parentDomNode = parent;\\n    this.computeAttributes();\\n    this.execute();\\n\\n    const createElement = $tw.utils.domMaker;\\n\\n    // this.checker();\\n    // update theme\\n    const theme = this.checkTheme();\\n    this.theme = theme;\\n    // after update this.theme\\n    this.presetForVanillaTheme();\\n\\n    // NOTE: Tailwindcss class here, if you dont want install the extra tailwindcss dependency, you can rewrite it use general style()\\n    const resizer = createElement('div', {\\n      class: 'oresizer'\\n    });\\n\\n    if (this.getSidebarPosition() === this.LEFT) {\\n      resizer.classList.add('oresizer-right');\\n    } else {\\n      resizer.classList.add('oresizer-left');\\n    }\\n\\n    resizer.addEventListener('pointerdown', (e) => {\\n      e.preventDefault(); // prevent select text on move sidebar width\\n\\n      this.isResizing = true;\\n      document.addEventListener('pointermove', (e) => this.resize(e));\\n      document.addEventListener('pointerup', (e) => this.stopResize(e));\\n    });\\n\\n    parent.insertBefore(resizer, nextSibling);\\n    this.domNodes.push(resizer);\\n  }\\n\\n  checkTheme() {\\n    // TODO: 或许可以借助split 获取主题\\n    const theme = this.getText(this.themeTiddler);\\n\\n    if (this.notebook.theme.includes(theme)) {\\n      return this.notebook.name;\\n    }\\n\\n    // 或许可以做一个映射\\n    switch (theme) {\\n      case this.whitespace.theme:\\n        return this.whitespace.name;\\n      default:\\n        return this.VANILLA;\\n    }\\n  }\\n\\n  presetForVanillaTheme() {\\n    const sidebarLayout = this.getText(this.sidebarLayoutTiddler);\\n\\n    if (this.theme === this.VANILLA) {\\n      if (sidebarLayout !== 'fluid-fixed') {\\n        console.warn('you should set sidebar layout to fluid-fixed');\\n        $tw.wiki.setText(this.sidebarLayoutTiddler, null, null, 'fluid-fixed');\\n      }\\n    }\\n  }\\n\\n  getText(tiddler) {\\n    return $tw.wiki.getTiddlerText(tiddler);\\n  }\\n\\n  getSidebarPosition() {\\n    // NOTE: before vanilla adjust\\n    if (this.getText(this.themeTiddler) === '$:/themes/cdr/captivate') {\\n      return this.LEFT;\\n    }\\n\\n    switch (this.theme) {\\n      case this.whitespace.name:\\n        if (!$tw.wiki.tiddlerExists(this.whitespace.positionTiddler)) {\\n          return this.LEFT;\\n        }\\n        return this.getText(this.whitespace.positionTiddler);\\n\\n      case this.notebook.name:\\n        if (!$tw.wiki.tiddlerExists(this.notebook.positionTiddler)) {\\n          return this.LEFT;\\n        }\\n\\n        const { position = this.LEFT } = $tw.wiki.getTiddler(\\n          this.notebook.positionTiddler\\n        ).fields;\\n\\n        return position;\\n\\n      default:\\n        return this.RIGHT;\\n    }\\n  }\\n\\n  getDefaultSidebarWidth() {\\n    return this.getText(this.nbWidthTiddler).replace('px', '');\\n  }\\n\\n  resize(e) {\\n    const clientX = e.clientX;\\n    if (this.isResizing) {\\n      if (this.getSidebarPosition() === this.LEFT) {\\n        this.width = clientX;\\n      } else {\\n        this.width = window.innerWidth - clientX;\\n      }\\n      if (this.width / window.innerWidth > 0.75) {\\n        return;\\n      }\\n      if (this.width / window.innerWidth < 0.05) {\\n        this.closeSidebar();\\n        this.isResizing = false;\\n        return;\\n      }\\n      this.updateSidebarWidth(this.width);\\n    }\\n  }\\n\\n  stopResize(e) {\\n    this.isResizing = false;\\n    // 监听事件的this 指向全局window, 如果希望指向当前 class 的this , 可以使用箭头函数, 或者手动修改this 指向\\n    document.removeEventListener('pointermove', (e) => this.resize(e));\\n  }\\n\\n  closeSidebar() {\\n    const stateTiddler =\\n      this.theme === this.notebook.name\\n        ? this.notebook.stateTiddler\\n        : this.defaultStateTiddler;\\n    $tw.wiki.setText(stateTiddler, 'text', null, 'no');\\n    this.updateSidebarWidth(this.getDefaultSidebarWidth());\\n  }\\n\\n  updateSidebarWidth(width) {\\n    const targetTiddler =\\n      this.theme === this.notebook.name\\n        ? this.notebook.widthTiddler\\n        : this.defaultWidthTiddler;\\n    requestAnimationFrame(() => {\\n      $tw.wiki.setText(\\n        targetTiddler,\\n        null,\\n        null,\\n        `${Number(width).toFixed(0)}px`\\n      );\\n    });\\n  }\\n\\n  checker() {\\n    const logger = new $tw.utils.Logger(en.pluginname);\\n    if (!$tw.modules.titles['tailwindcss.min.js']) {\\n      logger.alert(en.warning);\\n    }\\n  }\\n\\n  shouldRefresh(changedTiddlers, tiddlerList) {\\n    const changedKeys = Object.keys(changedTiddlers);\\n    return tiddlerList.some((tiddler) => changedKeys.includes(tiddler));\\n  }\\n\\n  refresh(changedTiddlers) {\\n    // TODO: refresh on change tw languages\\n    if (this.shouldRefresh(changedTiddlers, this.listenTiddlers)) {\\n      this.refreshSelf();\\n      console.warn('refresh', new Date());\\n      return true;\\n    }\\n    return false;\\n  }\\n}\\n\\nexports.nbresizer = NotebookResizer;\\n\",\"type\":\"application/javascript\",\"module-type\":\"widget\"}}}"}